<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="../../../default_typedef.xml"/>
  <Form id="MAG10054S" onkeydown="fn_form_OnKeyDown" onload="form_onload" titletext="식수집계조회" position="absolute 0 0 1252 725" scrollbars="none">
    <Layouts>
      <Layout>
        <Static id="Static08" class="sta_WFSA_Labelbg" position="absolute 0 30 1237 97" anchor="left top right"/>
        <Static id="st_UPJANGQuery" text="업장" userdata="strQuery_Upjang" position="absolute 485 37 533 63" class="sta_WFSA_label"/>
        <Static id="st_center" text="사업부" userdata="strMAQuery_UP_DEPT_ID" position="absolute 15 38 96 64" class="sta_WFSA_label" onclick="st_center_onclick"/>
        <Grid autoenter="select" binddataset="ds_Pivot" cellsizingtype="both" readonly="false" enable="true" cellsizebandtype="allband" id="grid_Slip" useinputpanel="false" oncelldblclick="grid_Slip_OnCellDblClick" onheadclick="grid_Slip_OnHeadClick" taborder="7" tabstop="true" usecontextmenu="true" useselcolor="true" visible="true" wheelscrollrow="1" position="absolute 0 128 1237 710" selecttype="row" anchor="all">
          <Formats>
            <Format id="Default">
              <Columns>
                <Column size="24" band="left"/>
                <Column size="74" band="left"/>
                <Column size="170" band="left"/>
                <Column size="74" band="left"/>
                <Column size="71" band="left"/>
                <Column size="74" band="left"/>
                <Column size="60"/>
                <Column size="60"/>
                <Column size="60"/>
                <Column size="67"/>
                <Column size="65"/>
                <Column size="65"/>
                <Column size="65"/>
                <Column size="65"/>
                <Column size="60"/>
                <Column size="84"/>
                <Column size="83"/>
                <Column size="80"/>
                <Column size="70"/>
                <Column size="70"/>
                <Column size="70"/>
                <Column size="70"/>
                <Column size="70"/>
                <Column size="70"/>
              </Columns>
              <Rows>
                <Row size="0" band="head"/>
                <Row size="30" band="head"/>
                <Row size="24"/>
                <Row size="24" band="summ"/>
                <Row size="24" band="summ"/>
              </Rows>
              <Band id="head">
                <Cell rowspan="2" displaytype="image" class="head_Excel"/>
                <Cell col="1" rowspan="2" displaytype="text" text="운영부서"/>
                <Cell col="2" rowspan="2" displaytype="text" text="사업장"/>
                <Cell col="3" rowspan="2" displaytype="text" text="오픈일"/>
                <Cell col="4" rowspan="2" displaytype="text" text="직군" taborder="undefined">
                  <Cell/>
                  <Cell row="1"/>
                </Cell>
                <Cell col="5" rowspan="2" displaytype="text" text="폐점일"/>
                <Cell col="6" colspan="18" displaytype="text" text="bind:TRX_DATE" expr="expr:iif(TRX_DATE != '계', gfn_subStr(TRX_DATE,0,4)+'-'+gfn_subStr(TRX_DATE,4,2)+'-'+gfn_subStr(TRX_DATE,6,2),'계')" taborder="undefined"/>
                <Cell row="1" col="6" displaytype="text" text="예상식수"/>
                <Cell row="1" col="7" displaytype="text" text="조리식수"/>
                <Cell row="1" col="8" displaytype="text" text="실식수"/>
                <Cell row="1" col="9" text="식수오차"/>
                <Cell row="1" col="10" displaytype="text" text="오차율"/>
                <Cell row="1" col="11" displaytype="text" text="조리오차율"/>
                <Cell row="1" col="12" displaytype="text" text="등록율"/>
                <Cell row="1" col="13" displaytype="text" text="조리등록율"/>
                <Cell row="1" col="14" displaytype="text" text="매출식수"/>
                <Cell row="1" col="15" text="실식수매출"/>
                <Cell row="1" col="16" text="매출차이"/>
                <Cell row="1" col="17" text="매출차이율"/>
                <Cell row="1" col="18" displaytype="text" text="식재료율&#13;&#10;(예상)"/>
                <Cell row="1" col="19" displaytype="text" text="식재료율&#13;&#10;(실적)"/>
                <Cell row="1" col="20" displaytype="text" text="매출계"/>
                <Cell row="1" col="21" displaytype="text" text="식음료"/>
                <Cell row="1" col="22" displaytype="text" text="기타"/>
                <Cell row="1" col="23" displaytype="text" text="상품"/>
              </Band>
              <Band id="body">
                <Cell celltype="body" displaytype="number" style="align:right;" expr="expr:currow+1"/>
                <Cell col="1" celltype="body" displaytype="text" style="align:left;" text="bind:TM_NM" suppress="1"/>
                <Cell col="2" celltype="body" displaytype="text" style="align:left;" text="bind:UPJANGNM"/>
                <Cell col="3" celltype="body" displaytype="text" style="align:center;" text="bind:OPEN_DATE"/>
                <Cell col="4" celltype="body" displaytype="text" text="bind:JOB_CD2"/>
                <Cell col="5" celltype="body" displaytype="text" style="align:center;" text="bind:CLOSE_DATE"/>
                <Cell col="6" displaytype="number" style="align:right;" text="bind:EQTY"/>
                <Cell col="7" displaytype="number" style="align:right;" text="bind:CQTY"/>
                <Cell col="8" displaytype="number" style="align:right;" text="bind:RQTY"/>
                <Cell col="9" text="bind:ERQTY"/>
                <Cell col="10" displaytype="number" style="align:right;" text="bind:MEAL_QTY_RATE" mask="expr:iif(MEAL_QTY_RATE==null||(EQTY+CQTY+RQTY)==0,&quot;-&quot;,&quot;#,##0.0%&quot;)"/>
                <Cell col="11" displaytype="number" style="align:right;" text="bind:COOK_QTY_RATE" mask="expr:iif(CQTY==0||CQTY==null,&quot;-&quot;,&quot;#,##0.0%&quot;)"/>
                <Cell col="12" displaytype="expr:decode(TRX_DATE,&quot;계&quot;,'number','normal')" style="align:right;background:EXPR(decode(&quot;TRX_DATE&quot;,&quot;계&quot;,'',iif(EEXI==0||EEXI==null,'',iif(REXI==0,&quot;RED&quot;,&quot;BLUE&quot;))));background2:EXPR(decode(&quot;TRX_DATE&quot;,&quot;계&quot;,'',iif(EEXI==0||EEXI==null,'',iif(REXI==0,&quot;RED&quot;,&quot;BLUE&quot;))));" text="bind:REXI" expr="expr:decode(TRX_DATE,&quot;계&quot;,decode(EEXI,0,0,Math.round(REXI/EEXI*100,1)),'')" mask="expr:decode(TRX_DATE,&quot;계&quot;,'#,##0.0%','')"/>
                <Cell col="13" displaytype="expr:decode(TRX_DATE,&quot;계&quot;,'number','normal')" style="align:right;background:EXPR(XPR(decode(TRX_DATE,&quot;계&quot;,'',iif(EEXI==0||EEXI==null,'',iif(CEXI==0,&quot;URL('theme://convertImages/img_RC.png')&quot;,&quot;URL('theme://convertImages/img_GC.png')&quot;)))));background2:EXPR(XPR(decode(TRX_DATE,&quot;계&quot;,'',iif(EEXI==0||EEXI==null,'',iif(CEXI==0,&quot;URL('theme://convertImages/img_RC.png')&quot;,&quot;URL('theme://convertImages/img_GC.png')&quot;)))));" text="bind:CEXI" expr="expr:decode(TRX_DATE,&quot;계&quot;,decode(EEXI,0,0,Math.round(CEXI/EEXI*100,1)),'')" mask="expr:decode(TRX_DATE,&quot;계&quot;,'#,##0.0%','')"/>
                <Cell col="14" displaytype="number" style="align:right;" text="0"/>
                <Cell col="15" displaytype="number" text="bind:gfn_nvl(MEAL_UPRICE)"/>
                <Cell col="16" displaytype="number" text="bind:gfn_nvl(MAECHUL_C)"/>
                <Cell col="17" displaytype="number" text="bind:gfn_nvl(MAECHUL_CP)"/>
                <Cell col="18" displaytype="number" style="align:right;" text="bind:gfn_nvl(T_AMT)"/>
                <Cell col="19" displaytype="number" style="align:right;" text="bind:gfn_nvl(T_AMT)"/>
                <Cell col="20" displaytype="number" style="align:right;" text="bind:gfn_nvl(T_AMT)"/>
                <Cell col="21" displaytype="number" style="align:right;" text="bind:gfn_nvl(F_AMT)"/>
                <Cell col="22" displaytype="number" style="align:right;" text="bind:gfn_nvl(S_AMT)"/>
                <Cell col="23" displaytype="number" style="align:right;" text="bind:gfn_nvl(E_AMT)"/>
              </Band>
              <Band id="summary">
                <Cell colspan="6" displaytype="text" style="align:center;" text="합계(오차율평균)"/>
                <Cell col="6" displaytype="number" style="align:left;" expr="expr:getSum('EQTY',pivotindex)"/>
                <Cell col="7" displaytype="number" style="align:left;" expr="expr:getSum('CQTY',pivotindex)"/>
                <Cell col="8" displaytype="number" style="align:left;" expr="expr:getSum('RQTY',pivotindex)"/>
                <Cell col="9"/>
                <Cell col="10" displaytype="number" style="align: ;" expr="expr:Math.round(getCaseAvg('MEAL_QTY_RATE&lt;&gt;null&amp;&amp;(EQTY+CQTY+RQTY)&lt;&gt;0','MEAL_QTY_RATE', 0, getRowCount(), pivotindex),1)" mask="#,##0.0%"/>
                <Cell col="11" displaytype="number" style="align: ;" expr="expr:Math.round(getCaseAvg('CQTY&lt;&gt;0&amp;&amp;CQTY&lt;&gt;null','COOK_QTY_RATE', 0, getRowCount(), pivotindex),1)" mask="#,##0.0%"/>
                <Cell col="12" displaytype="number" style="align: ;" expr="expr:decode(getSum('EEXI',pivotindex),0,0,Math.round(getSum('REXI',pivotindex)/getSum('EEXI',pivotindex)*100,1))" mask="#,##0.0%"/>
                <Cell col="13" displaytype="number" style="align: ;" expr="expr:decode(getSum('EEXI',pivotindex),0,0,Math.round(getSum('CEXI',pivotindex)/getSum('EEXI',pivotindex)*100,1))" mask="#,##0.0%"/>
                <Cell col="14" displaytype="number" style="align:left;" expr="expr:getSum('QTY',pivotindex)"/>
                <Cell col="15" expr="expr:getSum('MEAL_UPRICE',pivotindex)"/>
                <Cell col="16"/>
                <Cell col="17" expr="expr:getSum('MAECHUL_CP',pivotindex)"/>
                <Cell col="18" displaytype="number" style="align:left;" expr="expr:getSum('T_AMT',pivotindex)"/>
                <Cell col="19" displaytype="number" style="align:left;" expr="expr:getSum('T_AMT',pivotindex)"/>
                <Cell col="20" displaytype="number" style="align:left;" expr="expr:getSum('T_AMT',pivotindex)"/>
                <Cell col="21" displaytype="number" style="align:left;" expr="expr:getSum('F_AMT',pivotindex)"/>
                <Cell col="22" displaytype="number" style="align:left;" expr="expr:getSum('S_AMT',pivotindex)"/>
                <Cell col="23" displaytype="number" style="align:left;" expr="expr:getSum('E_AMT',pivotindex)"/>
                <Cell row="1" colspan="6" displaytype="text" style="align:center;" text="합계(오차율합계)"/>
                <Cell row="1" col="6" displaytype="number" style="align:left;" expr="expr:getSum('EQTY',pivotindex)"/>
                <Cell row="1" col="7" displaytype="number" style="align:left;" expr="expr:getSum('CQTY',pivotindex)"/>
                <Cell row="1" col="8" displaytype="number" style="align:left;" expr="expr:getSum('RQTY',pivotindex)"/>
                <Cell row="1" col="9"/>
                <Cell row="1" col="10" displaytype="number" style="align: ;" expr="expr:decode(getSum('EQTY'),0,0,Math.round(getSum('MEAL_QTY_DIFF')/getSum('EQTY')*100,1))" mask="#,##0.0%"/>
                <Cell row="1" col="11" displaytype="number" style="align: ;" expr="expr:decode(getSum('CQTY',pivotindex),0,0,Math.round(getSum('COOK_QTY_DIFF',pivotindex)/getSum('CQTY',pivotindex)*100,1))" mask="#,##0.0%"/>
                <Cell row="1" col="12" displaytype="number" style="align: ;" expr="expr:decode(getSum('EEXI',pivotindex),0,0,Math.round(getSum('REXI',pivotindex)/getSum('EEXI',pivotindex)*100,1))" mask="#,##0.0%"/>
                <Cell row="1" col="13" displaytype="number" style="align: ;" expr="expr:decode(getSum('EEXI',pivotindex),0,0,Math.round(getSum('CEXI',pivotindex)/getSum('EEXI',pivotindex)*100,1))" mask="#,##0.0%"/>
                <Cell row="1" col="14" displaytype="number" style="align:left;" expr="expr:getSum('QTY',pivotindex)"/>
                <Cell row="1" col="15" expr="expr:getSum('MEAL_UPRICE',pivotindex)"/>
                <Cell row="1" col="16"/>
                <Cell row="1" col="17"/>
                <Cell row="1" col="18" displaytype="number" style="align:left;" expr="expr:getSum('T_AMT',pivotindex)"/>
                <Cell row="1" col="19" displaytype="number" style="align:left;" expr="expr:getSum('T_AMT',pivotindex)"/>
                <Cell row="1" col="20" displaytype="number" style="align:left;" expr="expr:getSum('T_AMT',pivotindex)"/>
                <Cell row="1" col="21" displaytype="number" style="align:left;" expr="expr:getSum('F_AMT',pivotindex)"/>
                <Cell row="1" col="22" displaytype="number" style="align:left;" expr="expr:getSum('S_AMT',pivotindex)"/>
                <Cell row="1" col="23" displaytype="number" style="align:left;" expr="expr:getSum('E_AMT',pivotindex)"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Static id="Static0" text="기간" userdata="strMAQuery_UP_DEPT_ID" position="absolute 731 38 811 64" class="sta_WFSA_label"/>
        <Static id="st_UPDEPT_IDQuery" text="팀" userdata="strMAQuery_UP_DEPT_ID" position="absolute 252 38 280 64" class="sta_WFSA_label"/>
        <MaskEdit id="me_From" mask="####-##-##" oneditclick="g_Date_OnFocus" onsetfocus="g_Date_OnFocus" onkillfocus="g_Date_OnKillFocus" taborder="4" type="string" userdata="btn_NEED_DATE" position="absolute 776 41 854 62" class="msk_WF_EssentialCal"/>
        <Button id="btn_NEED_DATE" onclick="g_CalButton_OnClick" taborder="16" userdata="me_From" position="absolute 853 41 875 62" class="btn_WF_cal" text="" image=""/>
        <Static id="Static4" text="~" position="absolute 904 43 919 64"/>
        <MaskEdit id="me_To" mask="####-##-##" oneditclick="g_Date_OnFocus" onsetfocus="g_Date_OnFocus" onkillfocus="g_Date_OnKillFocus" taborder="5" type="string" userdata="btn_NEED_DATE" position="absolute 892 41 970 62" class="msk_WF_EssentialCal"/>
        <Button id="btn_NEED_DATE1" onclick="g_CalButton_OnClick" taborder="17" userdata="me_To" position="absolute 961 41 983 62" class="btn_WF_cal" text="" image=""/>
        <CheckBox falsevalue="N" id="chk_Except1" taborder="19" text="푸드코드/외식 제외" truevalue="Y" value="false" position="absolute 496 73 625 91" anchor="top right" visible="true"/>
        <CheckBox falsevalue="N" id="chk_Except2" taborder="20" text="미오픈업장 제외" truevalue="Y" value="false" position="absolute 643 73 756 91" anchor="top right"/>
        <CheckBox falsevalue="N" id="chk_Except3" taborder="21" text="폐점업장 제외" truevalue="Y" value="false" position="absolute 774 73 871 91" anchor="top right" onclick="chk_Except3_onclick"/>
        <CheckBox falsevalue="N" id="chk_Except4" taborder="22" text="미운영일 제외" truevalue="Y" value="false" position="absolute 889 73 986 91" anchor="top right"/>
        <MPFileDialog AppendExtDefault="TRUE" Filter="Excel File(*.xls,*.xlsx)|*.xls;*.xlsx|" id="FileDialog0" taborder="22" Type="Save" position="absolute 988 104 1012 128"/>
        <CheckBox falsevalue="N" id="chk_Except5" taborder="23" text="폐쇄형업장 제외" truevalue="Y" value="false" position="absolute 998 73 1108 91" anchor="top right" visible="true"/>
        <CheckBox falsevalue="N" id="chk_Except6" taborder="24" text="병원사업장 제외" truevalue="Y" value="false" position="absolute 1116 73 1226 91" anchor="top right"/>
        <Div id="div_cmnBtn" anchor="left top right" taborder="1" url="cmn::CmnBtn.xfdl" text="Div00" scrollbars="none" position="absolute 0 0 1237 30"/>
        <Static id="Static06" text="w15" onclick="Static06_onclick" class="Guide01_AreaRed" visible="false" position="absolute 1237 0 1252 710" anchor="top right"/>
        <Static id="Static18" text="h31" class="Guide01_AreaRed" visible="false" position="absolute 1210 97 1237 128"/>
        <Static id="Static71" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 710 1252 725" anchor="left bottom"/>
        <Static id="Static04" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 30 93 40"/>
        <Static id="Static07" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 40 15 61"/>
        <Static id="Static09" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 232 40 262 61"/>
        <Static id="Static05" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 61 93 71"/>
        <Static id="Static10" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 62 40 72 61" onclick="Static10_onclick"/>
        <Static id="Static03" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 278 40 288 61"/>
        <Static id="Static11" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 454 40 484 61"/>
        <Static id="Static12" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 518 41 528 62" onclick="Static12_onclick"/>
        <Static id="Static13" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 699 41 729 62"/>
        <Static id="Static14" text="글자간격기준 w10" onclick="Static12_onclick" class="Guide01_AreaRed" visible="false" position="absolute 766 42 776 63"/>
        <Static id="Static00" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 97 93 110"/>
        <Static id="Static22" text="식수집계" class="sta_WF_Title01" position="absolute 0 109 450 140" anchor="left top"/>
        <Combo id="cbo_Center" taborder="25" displayrowcount="10" position="absolute 170 1 288 22" visible="false"/>
        <TmSearchComponent id="edt_tmNm" titletext="팀 검색용 Component" taborder="27" onkeydown="edt_tmNm_onkeydown" text="TmSearchComponent00" position="absolute 288 40 458 62" bindDataset="" bindTmCdColumn="" bindTmNmColumn="" qoBuCd="" qoMuCd="" qoUseYn="" eventAfterTrigger="fn_tmChange" eventBeforeTrigger="" isTeamControl="Y"/>
        <UpjangSearchComponent id="edt_upjangNm" titletext="업장 검색용 Component" taborder="28" onkeydown="edt_upjangNm_onkeydown" text="UpjangSearchComponent00" position="absolute 528 40 699 61" bindDataset="" bindUpjangCodeColumn="" bindUpjangNameColumn="" eventBeforeTrigger="" eventAfterTrigger="" roleSetId=""/>
        <MuSearchComponent id="cbo_mu" titletext="사업부 선택 Component" taborder="29" text="MuSearchComponent00" position="absolute 68 40 232 61" bindDataset="" bindMuCdColumn="" appendText="" onItemChangedEvent="fn_muChange"/>
        <CheckBox id="chk_Except7" taborder="30" text="식재료율 제외" value="Y" truevalue="Y" falsevalue="N" position="absolute 1119 102 1229 120" anchor="top right"/>
        <Static id="Static01" text="[ 실식수매출 : 단가 * 실식수 ]  [ 매출차이 : 실식수매출 -매출 ] [ 매출차이율 : (매출차이 / 실식수매출) * 100 ]" position="absolute 473 102 1104 124"/>
        <CheckBox id="chk_bonbu" taborder="31" text="본부전체조회" onclick="chk_0_OnClick" position="absolute 1134 42 1225 60" anchor="top right" style="color:blue;" userdata="007"/>
        <CheckBox id="chk_Homeplus" taborder="32" tabstop="false" text="그룹조회" truevalue="1" position="absolute 1038 41 1126 62"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_cond"/>
      <Dataset id="ds_list">
        <ColumnInfo>
          <Column id="TM_CD" size="255" type="STRING"/>
          <Column id="TM_NM" size="255" type="STRING"/>
          <Column id="UPJANG" size="255" type="STRING"/>
          <Column id="UPJANGNM" size="255" type="STRING"/>
          <Column id="OPEN_DATE" size="255" type="STRING"/>
          <Column id="CLOSE_DATE" size="255" type="STRING"/>
          <Column id="TRX_DATE" size="255" type="STRING"/>
          <Column id="EQTY" size="256" type="STRING"/>
          <Column id="CQTY" size="0" type="BIGDECIMAL"/>
          <Column id="RQTY" size="0" type="BIGDECIMAL"/>
          <Column id="EEXI" size="256" type="STRING"/>
          <Column id="CEXI" size="0" type="BIGDECIMAL"/>
          <Column id="REXI" size="0" type="BIGDECIMAL"/>
          <Column id="MEAL_QTY_DIFF" size="256" type="BIGDECIMAL"/>
          <Column id="COOK_QTY_DIFF" size="256" type="BIGDECIMAL"/>
          <Column id="MEAL_QTY_RATE" size="256" type="BIGDECIMAL"/>
          <Column id="COOK_QTY_RATE" size="256" type="BIGDECIMAL"/>
          <Column id="QTY" size="0" type="BIGDECIMAL"/>
          <Column id="MEAL_UPRICE" type="BIGDECIMAL" size="256"/>
          <Column id="MAECHUL_C" type="BIGDECIMAL" size="256"/>
          <Column id="MAECHUL_CP" type="BIGDECIMAL" size="256"/>
          <Column id="T_AMT" size="0" type="BIGDECIMAL"/>
          <Column id="F_AMT" size="0" type="BIGDECIMAL"/>
          <Column id="S_AMT" size="0" type="BIGDECIMAL"/>
          <Column id="E_AMT" size="0" type="BIGDECIMAL"/>
          <Column id="JOB_CD2" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cbo_Center"/>
      <Dataset id="ds_Pivot" keystring="TM_NM,UPJANGNM,OPEN_DATE,CLOSE_DATE"/>
    </Objects>
    <Bind>
      <BindItem id="item2" compid="edt_upjangNm" propid="visible" datasetid=" " columnid="upjangNm"/>
    </Bind>
    <InitValue>
      <CheckBox id="chk_bonbu" userdata="007"/>
    </InitValue>
    <Script type="xscript4.0"><![CDATA[include "U_lib::lib_conversionCom.xjs";
/*
 ******************************************************************************************
 * 시스템구분   : FS시스템/시스템공통/템플릿 1
 * 프로그램명   : Sam_Form_Basic1.XML
 * 기      능   : 표준 UI Form
 * 작  성  자   : 구종화
 * 작성  일자   : 2007-11-16
 * ----------------------------------------------------------------------------------------
 * HISTORY    : 박은규 2012-04-10 CSR#(CH201204_00108) 요청자:이혜은(fs기획팀)
 *              예상식수, 오차율 추가, 오차율: {(실식수-예상식수)/예상식수}X100 
 *            : 박은규 2012-06-25 CSR#(CH201206_00149) 요청자:이혜은(fs지원팀)
 *              직군 조회 조건삭제 추가, 제외업장 검색조건 4종 추가
 *              예상오차율, 조리오차율, 등록율 추가
 ******************************************************************************************
 */
//=========================================================================================
// [ PART 1 ]
// Form에서 Include 할 내용을 정의
//
//=========================================================================================
//@@컨버터에서 주석처리 #include "lib::sc_comon.js"
//@@컨버터에서 주석처리 #include "lib::sc_sql_common.js"
//@@컨버터에서 주석처리 #include "lib::tit_comm_0001.js"
//@@컨버터에서 주석처리 #include "lib::ma_common.js"


//=========================================================================================
// [ PART 2 ]
// Form에서 사용될 전역변수를 선언
//
//=========================================================================================
var f_Saved_ID,
	f_CurrDate;

var onWork = false,
    onHeaderClick = false;
//=========================================================================================
// [ PART 3 ]
// Form Loading 시 작업 정의
//
//=========================================================================================
function form_onload(obj:Form, e:LoadEventInfo)
{
	gfn_formOnLoad(obj);

    var F_ArrCol          = new Array(-1);
    var F_ArrColType      = new Array(-1);
    
	//init_btn_setup();	// Button 초기화
	fsp_init(this);


	/*
	#############################################################################################################
	공통코드 SETTING
	#############################################################################################################
	*/
			
	//edt_UPDEPT_IDQuery.userdata = g_Tm_Cd;
	//edt_UPDEPT_IDQuery.value     = g_Tm_Nm;
				
	//센터코드
	fn_sql_common("C", strQuery_ScCenter,""," ORDER BY CENTER_CODE","all",cbo_Center,-1,ds_cbo_Center);
	cbo_Center.index = 0;			

	//============================================================================================
	//(2012-06-25 삭제) 시작
	// 박은규 2012-06-25 CSR#(CH201206_00149) 요청자:이혜은(fs지원팀)
	// 직군 조회 조건삭제 추가, 제외업장 검색조건 4종 추가
	//============================================================================================
/*
	//공통코드
	var v_fil_cond;
	var v_ds = fn_common_code("'FM0004', 'FM0021'","","","all","Y");
	
	// 영업직군(ds_CustType, GROUP_CODE : 'FM0004')
	v_fil_cond = "GROUP_CODE == 'FM0004'";
	v_ds.Filter(v_fil_cond);
	ds_cbo_Job.copyf(v_ds.id);	
	cbo_Job.Index = 0;
		
	// 세부경로(ds_BizDetail, GROUP_CODE : 'FM0021')
	v_fil_cond = "GROUP_CODE == 'FM0021'";
	v_ds.Filter(v_fil_cond);
	ds_cbo_SubJob.copyf(v_ds.id);	
	cbo_SubJob.Index = 0;
*/
	//============================================================================================
	//(2012-06-25 삭제) 끝
	//============================================================================================
	 
    f_CurrDate = fn_CurrDateWeek();
	//me_TRANS_MONTHFR.Value   = Substr(f_CurrDate, 0, 6) + "01";		
	me_From.value   = f_CurrDate;			  
    me_To.value     = me_From.value;
    
    edt_tmNm.applyAuthLevel(cbo_mu);
    edt_upjangNm.applyAuthLevel(edt_tmNm);
    //사업장 권한 셋팅#############################################################################
	//fn_SetAuth("edt_UPDEPT_IDQuery","edtBtn_UPDEPT_IDQuery","edt_UPJANGQuery", "edtBtn_UPJANGQuery");
    //사업장 권한 셋팅############################################################################# 
	//팀장권한 이상이면 홈플러스 체크 가능
	if (g_AuthLevel >= "16")   {
	    chk_Homeplus.visible = true;
	}
     
    // 본부장 권한 추가 작업 진행 
	if (g_AuthLevel >= "17")   
	{
		chk_bonbu.visible = true;
	} else {
		chk_bonbu.visible = false;
	}
    //본부장 권한 추가 작업 종료     

	/*
	#############################################################################################################
	공통코드 SETTING
	#############################################################################################################
	*/
}





//=========================================================================================
// [ PART 4 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,도움말,form닫기)
//
//=========================================================================================
function fn_search()
{
	if (!before_SelectCheck())
		return;


	//리스트############################################################
    fsp_clear(this);
    
	ds_cond.clear();
	
	ds_cond.addColumn("CENTER_CODE","STRING",256);	
	ds_cond.addColumn("TM_CD","STRING",256);
	ds_cond.addColumn("MU_CD","STRING",256);
	ds_cond.addColumn("UPJANG","BIGDECIMAL",256);	
	//============================================================================================
	//(2012-06-25 수정) 시작
	// 박은규 2012-06-25 CSR#(CH201206_00149) 요청자:이혜은(fs지원팀)
	// 직군 조회 조건삭제 추가, 제외업장 검색조건 4종 추가
	//============================================================================================
	//ds_cond.AddColumn("SUB_JOB_CD","STRING",256);
	//ds_cond.AddColumn("JOB_CD","STRING",256);
	ds_cond.addColumn("EXCEPT1","STRING",256);
	ds_cond.addColumn("EXCEPT2","STRING",256);
	ds_cond.addColumn("EXCEPT3","STRING",256);
	ds_cond.addColumn("EXCEPT4","STRING",256);
	
	// 폐쇄형, 병원업장 제외 추가 FC지원팀 윤지혜 요청 김장욱 수정
	ds_cond.addColumn("EXCEPT5","STRING",256);
	ds_cond.addColumn("EXCEPT6","STRING",256);
	
	//시작.  식재료율 칼럼 제외 추가 20160616 처리자:맹수영  요청자:윤지혜
	ds_cond.addColumn("EXCEPT7","STRING",256);
	//종료.  식재료율 칼럼 제외 추가 20160616 처리자:맹수영  요청자:윤지혜
		
	//============================================================================================
	//(2012-06-25 수정) 끝
	//============================================================================================
	ds_cond.addColumn("TRX_DATEFR","STRING",256);
	ds_cond.addColumn("TRX_DATETO","STRING",256);
	ds_cond.addColumn("HOMEPLUS","STRING",256);
				
	ds_cond.addRow();
	
	ds_cond.setColumn(ds_cond.rowposition, "CENTER_CODE", cbo_Center.value);
	ds_cond.setColumn(ds_cond.rowposition, "MU_CD", cbo_mu.getMuCode());
	//ds_cond.setColumn(ds_cond.rowposition, "TM_CD",       edt_tmNm.getTmCode() );
	
	// 본부의 팀전체 조회 옵션 추가 2016.07.25
	if(chk_bonbu.value){
		ds_cond.setColumn(ds_cond.rowposition, "TM_CD",       edt_tmNm.getTmCode().substr(0,3) );		
	}
	else {
		ds_cond.setColumn(ds_cond.rowposition, "TM_CD",       edt_tmNm.getTmCode() );
	}
	// 본부의 팀전체 조회 옵션 추가 2016.07.25
	
	ds_cond.setColumn(ds_cond.rowposition, "UPJANG",      edt_upjangNm.getUpjangCode() );
	//============================================================================================
	//(2012-06-25 수정) 시작
	// 박은규 2012-06-25 CSR#(CH201206_00149) 요청자:이혜은(fs지원팀)
	// 직군 조회 조건삭제 추가, 제외업장 검색조건 4종 추가
	//============================================================================================
	//ds_cond.SetColumn(ds_cond.Row, "JOB_CD",      cbo_job.Value);
	//ds_cond.SetColumn(ds_cond.Row, "SUB_JOB_CD",  cbo_Subjob.Value);
	ds_cond.setColumn(ds_cond.rowposition, "EXCEPT1",  chk_Except1.value);
	ds_cond.setColumn(ds_cond.rowposition, "EXCEPT2",  chk_Except2.value);
	ds_cond.setColumn(ds_cond.rowposition, "EXCEPT3",  chk_Except3.value);
	ds_cond.setColumn(ds_cond.rowposition, "EXCEPT4",  chk_Except4.value);
	
	ds_cond.setColumn(ds_cond.rowposition, "EXCEPT5",  chk_Except5.value); // 폐쇄형 업장 제외
	ds_cond.setColumn(ds_cond.rowposition, "EXCEPT6",  chk_Except6.value); // 병원사업장 제외
	
	//시작.  식재료율 칼럼 제외 추가 20160616 처리자:맹수영  요청자:윤지혜
	ds_cond.setColumn(ds_cond.rowposition, "EXCEPT7",  chk_Except7.value);  //식재료율 칼럼 제외
	//종료.  식재료율 칼럼 제외 추가 20160616 처리자:맹수영  요청자:윤지혜
	//============================================================================================
	//(2012-06-25 수정) 끝
	//============================================================================================
	ds_cond.setColumn(ds_cond.rowposition, "TRX_DATEFR",  me_From.value);
	ds_cond.setColumn(ds_cond.rowposition, "TRX_DATETO",  me_To.value);
	ds_cond.setColumn(ds_cond.rowposition, "HOMEPLUS",    chk_Homeplus.value);
	fn_DataSetAllClear();

    http.Sync = true;
    
    fsp_addSearch(this, "ma/mag:MAG10054S_S001");    
    
	fsp_callService(this, "", "", "ds_cond=ds_cond","ds_list=ds_list","","fn_call");

	http.Sync = false;	
	
}
function fn_call()
{
	//ds_Pivot.copyData(ds_list);
	//trace(ds_list.saveXML());
	var objPivotHeadDs = fn_makeHeadDs(ds_list);
 	var objPivotBodyDs = fn_makeBodyDs(ds_list, objPivotHeadDs);
	fn_crossTabGrid(grid_Slip, objPivotHeadDs, objPivotBodyDs);
}

function fn_insert()
{

}

function fn_delete()
{
  
}

function fn_save()
{
   
}


function fn_print()
{	
}
function fn_Close()
{
	this.close();
}
function fn_help()
{
}

//=========================================================================================
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
//
//=========================================================================================

function before_SelectCheck()
{

	if (gfn_length(me_From.value)== 0 || gfn_length(me_To.value)== 0)
	{
	
		gfn_alert("기간을 지정하여 주십시요.");
		me_From.setFocus();
		return false;
	}

	return true;
}

/*
 ******************************************************************************************
 * 함  수  명   : Common_Btn_common_OnClick
 * 입      력   : obj  = Form Component
 * 반      환   : 없음
 * 기      능   : 
 * 작  성  자   : 구종화
 * 작성  일자   : 2007-11-16
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */

//=========================================================================================
// [ PART 6 ]
// component Event 정의 ( User Define function )
// --> component Event의 기요,기능,동작 등 상세내용은 MiPlatform 메뉴얼을 참조하시기 바랍니다.
//=========================================================================================

function Common_Btn_common_OnClick(obj)
{

	switch(obj.name)
	{
		case "btn_search":
		    //alert("d");
			fn_search();
			break;
		case "btn_ins":
			fn_insert();
			break;
		case "btn_del":
			fn_delete();
			break;
		case "btn_save":
			fn_save();
			break;
		case "btn_Print":
			//fn_Print();
			break;
		case "btn_close":
			fn_Close();
			break;
		case "btn_Help":
			//fn_Help();
			break;
		default:
			break;
	}

}


function WorkForm_OnKeyDown(obj,objSenderObj,nChar,bShift,bControl,bAlt,nLLParam,nHLParam)
{
	
	gfn_formKeyDown(obj, e); //(obj,objSenderObj,nChar,bShift,bControl,bAlt,nLLParam,nHLParam);
}





/*function edt_UPJANGQuery_OnKeyDown(obj:Edit, e:KeyEventInfo)
{
	fn_edt_OnKeyDown(obj,e.keycode);	
			
			
	if (e.keycode == 46){
	
		if (obj.name == "edt_UPDEPT_IDQuery"){
				
			fn_DataSetAllClear();
		
			//하위 업장정보  Clear#######################################################
			edt_UPJANGQuery.userdata = "";
			edt_UPJANGQuery.value     = "";
			//하위 업장정보  Clear#######################################################		
		}
		
		if (obj.name == "edt_UPJANGQuery"){
				
			fn_DataSetAllClear();				
		}	


	}
	else {
	
		if (obj.name == "edt_UPDEPT_IDQuery"){
			

		}
		
		if (obj.name == "edt_UPJANGQuery"){
				
				
		}			
	}
}*/


function fn_DataSetAllClear()
{

	ds_list.clearData();		
		
}	





/*function edtBtn_UPJANGQuery_OnClick(obj:Button, e:ClickEventInfo)
{
  var str_Where;
  if (
       (obj.name == "edtBtn_UPJANGQuery") &&
       (gfn_length(gfn_trim(edt_UPDEPT_IDQuery.userdata))!= 0 )  
     )
  str_Where = " AND (TM_CD ='" + edt_UPDEPT_IDQuery.userdata + "')";
  
  fn_edtBtn_OnClick(obj, str_Where);
	
  if (gfn_length(gfn_trim(edt_UPJANGQuery.userdata))== 0 ) {  
	 	
  }     
  else {     
	 
	if (obj.name == "edtBtn_UPDEPT_IDQuery"){
		
		//하위 업장정보  Clear#######################################################
		edt_UPJANGQuery.userdata = "";
		edt_UPJANGQuery.value     = "";
		//하위 업장정보  Clear#######################################################		

	}
	
	if (obj.name == "edtBtn_UPJANGQuery"){
				
	}
	 
  }
  
	  
	    	
	fn_DataSetAllClear();		
}*/








/*function edt_UPJANGQuery_OnChanged(obj:Edit, e:TextChangedEventInfo)
{
	fn_DataSetAllClear();		
}*/



function grid_Slip_OnExpandEdit(obj,nRow,nCell,strVal,nPivotIndex)
{
	// if (NumFormat(ds_list.GetColumn(ds_list.row, "TICKET_SEQ")) == "0") return;
	
	// var str_MenuIDText = "",
	    // str_MenuIDTextDetail = "",
		// str_XMLADDRESS1 = "",
		// str_XMLADDRESS2 = "",	
		// str_ColumnTitle = "",	
		// real_BILL_ID = ds_list.GetColumn(ds_list.row, "BILL_ID");
		
    // str_ColumnTitle = Replace(Replace(fn_Get_ColHeaderTitle(obj, nCell), "▼"), "▲");	
	// gfn_dialog("", "U_MAS::MAS10081P.xml", "str_MenuIDText=" + str_MenuIDText + " str_MenuIDTextDetail=" + str_MenuIDTextDetail + " str_XMLADDRESS1=" + str_XMLADDRESS1 + " str_XMLADDRESS2=" + str_XMLADDRESS2 + " TRID=" + real_BILL_ID );	
}


function grid_Slip_OnHeadClick(obj:Grid, e:GridClickEventInfo)
{
	if (obj.getCellProperty("head",e.cell,"backgroundimage") == "ico_Excel") 
	//obj.ExportExcelEx(this.Title);
	{
		FileDialog0.FileName = this.titletext;
		if (FileDialog0.Open())
			//obj.SaveExcelEX(FileDialog0.FilePath +"\\"+ FileDialog0.FileName,"sheet1");
			SaveExcel(obj,FileDialog0.FilePath +"\\"+ FileDialog0.FileName,"sheet1");
	}
	else gfn_gridSort(obj, e); //(eval(obj.binddataset), obj, e.cell);
}


function me_Date_OnChanged(obj,strText)
{
	fn_DataSetAllClear();		
}

function fn_muChange(obj, data){
	
	edt_tmNm.setTmCode("");
	edt_upjangNm.setUpjangCode("");
}

function fn_tmChange(obj, data){

	edt_upjangNm.setUpjangCode("");
}



function fn_GetLocalUserRole(objOutDs)
{
    
    //잔액체크#####################################################################
    objOutDs.clear();
    objOutDs.addColumn("ROLE_YN","STRING",256);	       
    
	// action 정보 초기화 
    fsp_clear(this);  
	
    // 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "ma/mag:MAG10051S_S003");
	
	//alert(str_ACCTCD);
	//alert(str_DATE_STD);
	// 서버 호출 
	http.Sync = true;
	fsp_callService(this, "", "", "", objOutDs.name + "=ds_list",""
	                                                           ,"");	
	http.Sync = false;
	
                          	
	
	//alert(objOutDs.GetColumn(objOutDs.row, "ACCTCD_DATE") );
	return objOutDs.getColumn(objOutDs.rowposition, "ROLE_YN");
	//잔액체크#####################################################################
	
}

 
//Pivot Head Dataset생성
function fn_makeHeadDs(objDs)
{
	var sPivotHeadDs = objDs.name + "_PivotHead";
	var objPivotHeadDs;
	if ( this.isValidObject(sPivotHeadDs) )
	{
		objPivotHeadDs = eval(sPivotHeadDs);
	}
	else
	{
		objPivotHeadDs = new Dataset();
		objPivotHeadDs.name = sPivotHeadDs;
		this.addChild(objPivotHeadDs.name,objPivotHeadDs);
	}

	objPivotHeadDs.clear();
	
	objDs.keystring = "S:TRX_DATE";
	var sPreKey 	  = "";
	var sCurrCode 	  = "";
	var sCurrText 	  = "";
	var nRow;
	for ( var i = 0; i < objDs.rowcount; i++ )
	{
		sPrevDate = objDs.getColumn(i, "TRX_DATE");
		sNextDate = objDs.getColumn(i-1, "TRX_DATE");
		if ( sPrevDate != sNextDate)	
		{			
			nRow = objPivotHeadDs.addRow();
			objPivotHeadDs.addColumn("TRX_DATE","STRING",255);						
			objPivotHeadDs.addColumn("DISP_HEAD1","STRING",255);
			objPivotHeadDs.addColumn("DISP_HEAD2","STRING",255);
			objPivotHeadDs.addColumn("DISP_HEAD3","STRING",255);
			objPivotHeadDs.addColumn("DISP_HEAD4","STRING",255);
			objPivotHeadDs.addColumn("DISP_HEAD5","STRING",255);
			objPivotHeadDs.addColumn("DISP_HEAD6","STRING",255);
			objPivotHeadDs.addColumn("DISP_HEAD7","STRING",255);
			objPivotHeadDs.addColumn("DISP_HEAD8","STRING",255);
			objPivotHeadDs.addColumn("DISP_HEAD9","STRING",255);
			objPivotHeadDs.addColumn("DISP_HEAD10","STRING",255);
			objPivotHeadDs.addColumn("DISP_HEAD11","STRING",255);
			objPivotHeadDs.addColumn("DISP_HEAD12","STRING",255);
			objPivotHeadDs.addColumn("DISP_HEAD13","STRING",255);
			objPivotHeadDs.addColumn("DISP_HEAD14","STRING",255);
			objPivotHeadDs.addColumn("DISP_HEAD15","STRING",255);
			objPivotHeadDs.addColumn("DISP_HEAD16","STRING",255);
			objPivotHeadDs.addColumn("DISP_HEAD17","STRING",255);	
			objPivotHeadDs.addColumn("DISP_HEAD18","STRING",255);	
			objPivotHeadDs.addColumn("DISP_HEAD19","STRING",255);	
			objPivotHeadDs.addColumn("DISP_HEAD20","STRING",255);			
			
			objPivotHeadDs.setColumn(nRow,"TRX_DATE",sPrevDate);
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD1","예상식수");
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD2","조리식수");
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD3","실식수");
			//식수오차 추가 20161025 맹수영
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD4","식수오차");
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD5","오차율");
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD6","조리오차율");
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD7","등록율");
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD8","조리등록율");
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD9","매출식수");
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD10","실식수매출");
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD11","매출차이");
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD12","매출차이율");			
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD13","식재료율(예상)");
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD14","식재료율(실적)");
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD15","매출계");
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD16","식음료");
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD17","기타");
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD18","상품");
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD19","등록수");
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD20","미등록수");
			
			/*
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD4","오차율");
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD5","조리오차율");
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD6","등록율");
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD7","조리등록율");
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD8","매출식수");
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD9","실식수매출");
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD10","매출차이");
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD11","매출차이율");			
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD12","식재료율(예상)");
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD13","식재료율(실적)");
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD14","매출계");
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD15","식음료");
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD16","기타");
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD17","상품");
			*/
		}
	}
	return objPivotHeadDs;
}


//Pivot Dataset생성
function fn_makeBodyDs(objDs,objPivotHeadDs)
{
	var sPivotDs = objDs.name + "_Pivot";
	var objPivotDs;
	if ( this.isValidObject(sPivotDs) )
	{
		objPivotDs = eval(sPivotDs);
	}
	else
	{
		objPivotDs = new Dataset();
		objPivotDs.name = sPivotDs;
		this.addChild(objPivotDs.name,objPivotDs);
	}
	objPivotDs.clear();
	
	//고정컬럼 추가
	objPivotDs.addColumn("TM_CD","STRING",255);
	objPivotDs.addColumn("TM_NM","STRING",255);
	objPivotDs.addColumn("UPJANG","STRING",255);
	objPivotDs.addColumn("UPJANGNM","STRING",255);
	objPivotDs.addColumn("OPEN_DATE","STRING",255);	
	//직군 추가 20161024 맹수영
	objPivotDs.addColumn("JOB_CD2","STRING",255);
	objPivotDs.addColumn("CLOSE_DATE","STRING",255);
	objPivotDs.addColumn("TRX_DATE","STRING",255);
	objPivotDs.addColumn("EQTY","BIGDECIMAL",39);
	objPivotDs.addColumn("CQTY","BIGDECIMAL",39);
	objPivotDs.addColumn("RQTY","BIGDECIMAL",39);
	//식수오차 추가 20161025 맹수영
	objPivotDs.addColumn("ERQTY","BIGDECIMAL",39);
	objPivotDs.addColumn("EEXI","BIGDECIMAL",39);
	objPivotDs.addColumn("CEXI","BIGDECIMAL",39);
	objPivotDs.addColumn("REXI","BIGDECIMAL",39);
	objPivotDs.addColumn("MEAL_QTY_DIFF","BIGDECIMAL",39);
	objPivotDs.addColumn("COOK_QTY_DIFF","BIGDECIMAL",39);
	objPivotDs.addColumn("MEAL_QTY_RATE","BIGDECIMAL",39);
	objPivotDs.addColumn("COOK_QTY_RATE","BIGDECIMAL",39);
	objPivotDs.addColumn("QTY","BIGDECIMAL",39);
	objPivotDs.addColumn("MEAL_UPRICE","BIGDECIMAL",39);
	objPivotDs.addColumn("MAECHUL_C","BIGDECIMAL",39);
	objPivotDs.addColumn("MAECHUL_CP","BIGDECIMAL",39);
	objPivotDs.addColumn("T_AMT","BIGDECIMAL",39);
	objPivotDs.addColumn("F_AMT","BIGDECIMAL",39);
	objPivotDs.addColumn("S_AMT","BIGDECIMAL",39);
	objPivotDs.addColumn("E_AMT","BIGDECIMAL",39);
	objPivotDs.addColumn("S_RATE","BIGDECIMAL",39);
	objPivotDs.addColumn("EXPECT_RATE","BIGDECIMAL",39);
	
	//Pivot컬럼 추가
	for (var i=0; i<objPivotHeadDs.rowcount; i++)
	{
		objPivotDs.addColumn("P_EQTY"+objPivotHeadDs.getColumn(i,0),"BIGDECIMAL",39);		//예상식수
		objPivotDs.addColumn("P_CQTY"+objPivotHeadDs.getColumn(i,0),"BIGDECIMAL",39);		//조리식수
		objPivotDs.addColumn("P_RQTY"+objPivotHeadDs.getColumn(i,0),"BIGDECIMAL",39);		//실식수
		//식수오차 추가 20161025 맹수영
		objPivotDs.addColumn("P_ERQTY"+objPivotHeadDs.getColumn(i,0),"BIGDECIMAL",39);		//식수오차추가
		objPivotDs.addColumn("P_EEXI"+objPivotHeadDs.getColumn(i,0),"BIGDECIMAL",39);		//실식수
		objPivotDs.addColumn("P_MEAA"+objPivotHeadDs.getColumn(i,0),"BIGDECIMAL",39);		//오차갯수
		objPivotDs.addColumn("P_MEAL"+objPivotHeadDs.getColumn(i,0),"BIGDECIMAL",39);		//오차율
		objPivotDs.addColumn("P_COKK"+objPivotHeadDs.getColumn(i,0),"BIGDECIMAL",39);		//조리갯수
		objPivotDs.addColumn("P_COOK"+objPivotHeadDs.getColumn(i,0),"BIGDECIMAL",39);		//조리오차율
		objPivotDs.addColumn("P_REXI"+objPivotHeadDs.getColumn(i,0),"BIGDECIMAL",39);		//등록율
		objPivotDs.addColumn("P_CEXI"+objPivotHeadDs.getColumn(i,0),"BIGDECIMAL",39);		//조리등록율
		objPivotDs.addColumn("P_QTYY"+objPivotHeadDs.getColumn(i,0),"BIGDECIMAL",39);		//매출식수
		objPivotDs.addColumn("P_MEAL_UPRICE"+objPivotHeadDs.getColumn(i,0),"BIGDECIMAL",39);		//실식수매출		
		objPivotDs.addColumn("P_MAECHUL_C"+objPivotHeadDs.getColumn(i,0),"BIGDECIMAL",39);		//매출차이
		objPivotDs.addColumn("P_MAECHUL_CP"+objPivotHeadDs.getColumn(i,0),"BIGDECIMAL",39);		//매출차이율		
		objPivotDs.addColumn("P_ERAT"+objPivotHeadDs.getColumn(i,0),"BIGDECIMAL",39);		//식재료율(예상)
		objPivotDs.addColumn("P_SRAT"+objPivotHeadDs.getColumn(i,0),"BIGDECIMAL",39);		//식재료율(실적)
		objPivotDs.addColumn("P_TAMT"+objPivotHeadDs.getColumn(i,0),"BIGDECIMAL",39);		//매출계
		objPivotDs.addColumn("P_FAMT"+objPivotHeadDs.getColumn(i,0),"BIGDECIMAL",39);		//식음료
		objPivotDs.addColumn("P_SAMT"+objPivotHeadDs.getColumn(i,0),"BIGDECIMAL",39);		//기타
		objPivotDs.addColumn("P_EAMT"+objPivotHeadDs.getColumn(i,0),"BIGDECIMAL",39);		//상품
	}
	
	//objPivotHeadDs	헤더데이터셋	
	var sPrevSEQ = "";
	var sNextSEQ = "";
	var nAddRow;
	var sYYDD;
	var sPrevUPJANG = "";
	var sNextUPJANG = "";
	objDs.keystring = "S:+TM_NM+UPJANGNM+OPEN_DATE+CLOSE_DATE";
	
	objDs.enableevent = false;
	for(var j=0; j < objDs.rowcount; j++)
	{
	
		sPrevSABUN = objDs.getColumn(j,"UPJANGNM");
		sNextSABUN = objDs.getColumn(j-1, "UPJANGNM");		
		
		if( sPrevSABUN != sNextSABUN )
		{
			nAddRow = objPivotDs.addRow();	
			objPivotDs.setColumn(nAddRow,"TM_CD",objDs.getColumn(j,"TM_CD"));
			objPivotDs.setColumn(nAddRow,"TM_NM",objDs.getColumn(j,"TM_NM"));
			objPivotDs.setColumn(nAddRow,"UPJANG",objDs.getColumn(j,"UPJANG"));
			objPivotDs.setColumn(nAddRow,"UPJANGNM",objDs.getColumn(j,"UPJANGNM"));
			objPivotDs.setColumn(nAddRow,"OPEN_DATE",objDs.getColumn(j,"OPEN_DATE"));
	        //직군 추가 20161024 맹수영 		
			objPivotDs.setColumn(nAddRow,"JOB_CD2",objDs.getColumn(j,"JOB_CD2"));
			objPivotDs.setColumn(nAddRow,"CLOSE_DATE",objDs.getColumn(j,"CLOSE_DATE"));
		}
	}
	
	for(var k=0; k < objDs.rowcount; k++)
	{
		var nRow = objPivotDs.findRow("UPJANG",objDs.getColumn(k,"UPJANG"));
		objPivotDs.setColumn(nRow,"P_EQTY" + objDs.getColumn(k,"TRX_DATE"),gfn_nvl(objDs.getColumn(k,"EQTY"),0));	//예상식수		
		objPivotDs.setColumn(nRow,"P_CQTY" + objDs.getColumn(k,"TRX_DATE"),gfn_nvl(objDs.getColumn(k,"CQTY"),0));	//조리식수
		objPivotDs.setColumn(nRow,"P_RQTY" + objDs.getColumn(k,"TRX_DATE"),gfn_nvl(objDs.getColumn(k,"RQTY"),0));	//실식수
		//식수오차 추가 20161025 맹수영
		objPivotDs.setColumn(nRow,"P_ERQTY" + objDs.getColumn(k,"TRX_DATE"),gfn_nvl(objDs.getColumn(k,"ERQTY"),0));	//식수오차
		objPivotDs.setColumn(nRow,"P_EEXI" + objDs.getColumn(k,"TRX_DATE"),gfn_nvl(objDs.getColumn(k,"EEXI"),0));	//
		objPivotDs.setColumn(nRow,"P_MEAA" + objDs.getColumn(k,"TRX_DATE"),gfn_nvl(objDs.getColumn(k,"MEAL_QTY_DIFF"),0));	//오차갯수
		objPivotDs.setColumn(nRow,"P_MEAL" + objDs.getColumn(k,"TRX_DATE"),gfn_nvl(objDs.getColumn(k,"MEAL_QTY_RATE"),0));	//오차율
		objPivotDs.setColumn(nRow,"P_COKK" + objDs.getColumn(k,"TRX_DATE"),gfn_nvl(objDs.getColumn(k,"COOK_QTY_DIFF"),0));	//조리갯수
		objPivotDs.setColumn(nRow,"P_COOK" + objDs.getColumn(k,"TRX_DATE"),gfn_nvl(objDs.getColumn(k,"COOK_QTY_RATE"),0));	//조리오차율
		objPivotDs.setColumn(nRow,"P_REXI" + objDs.getColumn(k,"TRX_DATE"),gfn_nvl(objDs.getColumn(k,"REXI"),0));	//등록율
		objPivotDs.setColumn(nRow,"P_CEXI" + objDs.getColumn(k,"TRX_DATE"),gfn_nvl(objDs.getColumn(k,"CEXI"),0));	//조리등록율
		objPivotDs.setColumn(nRow,"P_QTYY" + objDs.getColumn(k,"TRX_DATE"),gfn_nvl(objDs.getColumn(k,"QTY"),0));	//매출식수
		objPivotDs.setColumn(nRow,"P_MEAL_UPRICE" + objDs.getColumn(k,"TRX_DATE"),gfn_nvl(objDs.getColumn(k,"MEAL_UPRICE"),0));	//실식수매출
		objPivotDs.setColumn(nRow,"P_MAECHUL_C" + objDs.getColumn(k,"TRX_DATE"),gfn_nvl(objDs.getColumn(k,"MAECHUL_C"),0));	//실식수매출
		objPivotDs.setColumn(nRow,"P_MAECHUL_CP" + objDs.getColumn(k,"TRX_DATE"),gfn_nvl(objDs.getColumn(k,"MAECHUL_CP"),0));	//실식수매출		
		objPivotDs.setColumn(nRow,"P_ERAT" + objDs.getColumn(k,"TRX_DATE"),gfn_nvl(objDs.getColumn(k,"EXPECT_RATE"),0));	//식재료율(예상)
		objPivotDs.setColumn(nRow,"P_SRAT" + objDs.getColumn(k,"TRX_DATE"),gfn_nvl(objDs.getColumn(k,"S_RATE"),0));	//식재료율(실적)
		objPivotDs.setColumn(nRow,"P_TAMT" + objDs.getColumn(k,"TRX_DATE"),gfn_nvl(objDs.getColumn(k,"T_AMT"),0));	//매출계
		objPivotDs.setColumn(nRow,"P_FAMT" + objDs.getColumn(k,"TRX_DATE"),gfn_nvl(objDs.getColumn(k,"F_AMT"),0));	//식음료
		objPivotDs.setColumn(nRow,"P_SAMT" + objDs.getColumn(k,"TRX_DATE"),gfn_nvl(objDs.getColumn(k,"S_AMT"),0));	//기타
		objPivotDs.setColumn(nRow,"P_EAMT" + objDs.getColumn(k,"TRX_DATE"),gfn_nvl(objDs.getColumn(k,"E_AMT"),0));	//상품

	}
	objDs.enableevent = true;


	var curColid = "";
	var sumEQTY = 0;
	var sumCQTY = 0;
	var sumRQTY = 0;
	var sumERQTY = 0;
	var sumEEXI = 0;
	var sumMEAL = 0;
	var sumCOOK = 0;
	var sumREXI = 0;
	var sumCEXI = 0;
	var sumQTYY = 0;
	var sumMEAL_UPRICE = 0;
	var sumMAECHUL_C = 0;
	var sumMAECHUL_CP = 0;
	var sumTAMT = 0;
	var sumFAMT = 0;
	var sumSAMT = 0;
	var sumEAMT = 0;
	var sumERAT = 0;
	var sumSRAT = 0;
	objPivotDs.enableevent = false;
	for(var m=0; m < objPivotDs.rowcount; m++)
	{
		sumEQTY = 0;
		sumCQTY = 0;
		sumRQTY = 0;
		sumERQTY = 0;
		sumEEXI = 0;
		sumMEAL = 0;
		sumCOOK = 0;
		sumREXI = 0;
		sumCEXI = 0;
		sumQTYY = 0;
        sumMEAL_UPRICE = 0;
        sumMAECHUL_C = 0;
        sumMAECHUL_CP = 0;
		sumTAMT = 0;
		sumFAMT = 0;
		sumSAMT = 0;
		sumEAMT = 0;
		sumERAT = 0;
		sumSRAT = 0;
 		for(var l=0;l < objPivotDs.colcount;l++)
		{
			curColid = objPivotDs.getColID(l+25);
			curColid = String(curColid).substr(0, 6);
			
			if(curColid == "P_EQTY")
			{
				sumEQTY += gfn_nvl(objPivotDs.getColumn(m, objPivotDs.getColID(l+25)), 0);
			}
			else if(curColid == "P_CQTY")
			{
				sumCQTY += gfn_nvl(objPivotDs.getColumn(m, objPivotDs.getColID(l+25)), 0);
			}
			else if(curColid == "P_RQTY")
			{
				sumRQTY += gfn_nvl(objPivotDs.getColumn(m, objPivotDs.getColID(l+25)), 0);
			}
			//식수오차 추가 20161025 맹수영
			else if(curColid == "P_ERQTY")
			{
				sumERQTY += gfn_nvl(objPivotDs.getColumn(m, objPivotDs.getColID(l+25)), 0);
			}
			else if(curColid == "P_EEXI")
			{
				sumEEXI += gfn_nvl(objPivotDs.getColumn(m, objPivotDs.getColID(l+25)), 0);
			}
			else if(curColid == "P_MEAL")
			{
				sumMEAL += gfn_nvl(objPivotDs.getColumn(m, objPivotDs.getColID(l+25)), 0);
			}
			else if(curColid == "P_COOK")
			{
				sumCOOK += gfn_nvl(objPivotDs.getColumn(m, objPivotDs.getColID(l+25)), 0);
			}
			else if(curColid == "P_REXI")
			{
				sumREXI += gfn_nvl(objPivotDs.getColumn(m, objPivotDs.getColID(l+25)), 0);
			}
			else if(curColid == "P_CEXI")
			{
				sumCEXI += gfn_nvl(objPivotDs.getColumn(m, objPivotDs.getColID(l+25)), 0);
			}
			else if(curColid == "P_QTYY")
			{
				sumQTYY += gfn_nvl(objPivotDs.getColumn(m, objPivotDs.getColID(l+25)), 0);
			}
			else if(curColid == "P_MEAL_UPRICE")
			{
				sumMEAL_UPRICE += gfn_nvl(objPivotDs.getColumn(m, objPivotDs.getColID(l+25)), 0);
			}
			else if(curColid == "P_MAECHUL_C")
			{
				sumMEAL_UPRICE += gfn_nvl(objPivotDs.getColumn(m, objPivotDs.getColID(l+25)), 0);
			}
			else if(curColid == "P_MAECHUL_CP")
			{
				sumMEAL_UPRICE += gfn_nvl(objPivotDs.getColumn(m, objPivotDs.getColID(l+25)), 0);
			}
			else if(curColid == "P_TAMT")
			{
				sumTAMT += gfn_nvl(objPivotDs.getColumn(m, objPivotDs.getColID(l+25)), 0);
			}
			else if(curColid == "P_FAMT")
			{
				sumFAMT += gfn_nvl(objPivotDs.getColumn(m, objPivotDs.getColID(l+25)), 0);
			}
			else if(curColid == "P_SAMT")
			{
				sumSAMT += gfn_nvl(objPivotDs.getColumn(m, objPivotDs.getColID(l+25)), 0);
			}
			else if(curColid == "P_EAMT")
			{
				sumEAMT += gfn_nvl(objPivotDs.getColumn(m, objPivotDs.getColID(l+25)), 0);
			}
			else if(curColid == "EXPECT_RATE")
			{
				sumERAT += gfn_nvl(objPivotDs.getColumn(m, objPivotDs.getColID(l+25)), 0);
			}
			else if(curColid == "S_RATE")
			{
				sumSRAT += gfn_nvl(objPivotDs.getColumn(m, objPivotDs.getColID(l+25)), 0);
			}
			
 		}
//  		objPivotDs.setColumn(m, "TOT_SCORE", sumTOT_SCORE);
//  		objPivotDs.setColumn(m, "GRADE", sumCNT);
//  		objPivotDs.setColumn(m, "NOT_FIT", sumNOT_FIT);
//  		objPivotDs.setColumn(m, "RST_CNT", sumRST_CNT);
	}
	objPivotDs.enableevent = true;
	return objPivotDs;
}

//Pivot 그리드포맷생성
function fn_crossTabGrid(objGrid,objPivotHeadDs,objPivotBodyDs)
{
	var v_Formats = "";
	var v_Columns = "";
	var v_Rows = "";
	var v_BandHead = "";
	var v_BandBody = "";
	var v_Summary = "";
	
	
	v_Columns +=      '<Column size="24" band="left"/>\n';
    v_Columns +=      '<Column size="74" band="left"/>\n';
	v_Columns +=      '<Column size="170" band="left"/>\n';
	v_Columns +=      '<Column size="74" band="left"/>\n';
	v_Columns +=      '<Column size="74" band="left"/>\n';
	v_Columns +=      '<Column size="74" band="left"/>\n';
	//v_Columns +=      '<Column size="60"/>\n';
	//v_Columns +=      '<Column size="60"/>\n';
	//v_Columns +=      '<Column size="60"/>\n';
	//v_Columns +=      '<Column size="65"/>\n';
	//v_Columns +=      '<Column size="65"/>\n';
	//v_Columns +=      '<Column size="65"/>\n';
	//v_Columns +=      '<Column size="65"/>\n';
	//v_Columns +=      '<Column size="60"/>\n';
	//v_Columns +=      '<Column size="70"/>\n';
	//v_Columns +=      '<Column size="70"/>\n';
	//v_Columns +=      '<Column size="70"/>\n';
	//v_Columns +=      '<Column size="70"/>\n';
	
	v_Rows +=      '<Row size="24" band="head"/>\n';
	v_Rows +=      '<Row size="30" band="head"/>\n';
	v_Rows +=      '<Row size="24"/>\n';
	v_Rows +=      '<Row size="24" band="summ"/>\n';
	v_Rows +=      '<Row size="24" band="summ"/>\n';
	
	v_BandHead +=      '<Cell rowspan="2" displaytype="image" class="head_Excel"/>\n';
	v_BandHead +=      '<Cell col="1" rowspan="2" displaytype="text" text="운영부서"/>\n';
	v_BandHead +=      '<Cell col="2" rowspan="2" displaytype="text" text="사업장"/>\n';
	v_BandHead +=      '<Cell col="3" rowspan="2" displaytype="text" text="오픈일"/>\n';
	//직군추가 20161024 맹수영
	v_BandHead +=      '<Cell col="4" rowspan="2" displaytype="text" text="직군"/>\n';
	v_BandHead +=      '<Cell col="5" rowspan="2" displaytype="text" text="폐점일"/>\n';
	
	//v_BandHead +=      '<Cell col="5" colspan="12" displaytype="text" text="bind:TRX_DATE" expr="expr:iif(TRX_DATE != '계', gfn_subStr(TRX_DATE,0,4)+'-'+gfn_subStr(TRX_DATE,4,2)+'-'+gfn_subStr(TRX_DATE,6,2),'계')"/>\n';
	//v_BandHead +=      '<Cell row="1" col="5" displaytype="text" text="예상식수"/>\n';
	//v_BandHead +=      '<Cell row="1" col="6" displaytype="text" text="조리식수"/>\n';
	//v_BandHead +=      '<Cell row="1" col="7" displaytype="text" text="실식수"/>\n';
	//v_BandHead +=      '<Cell row="1" col="8" displaytype="text" text="오차율"/>\n';
	//v_BandHead +=      '<Cell row="1" col="9" displaytype="text" text="조리오차율"/>\n';
	//v_BandHead +=      '<Cell row="1" col="10" displaytype="text" text="등록율"/>\n';
	//v_BandHead +=      '<Cell row="1" col="11" displaytype="text" text="조리등록율"/>\n';
	//v_BandHead +=      '<Cell row="1" col="12" displaytype="text" text="매출식수"/>\n';
	//v_BandHead +=      '<Cell row="1" col="13" displaytype="text" text="매출계"/>\n';
	//v_BandHead +=      '<Cell row="1" col="14" displaytype="text" text="식음료"/>\n';
	//v_BandHead +=      '<Cell row="1" col="15" displaytype="text" text="기타"/>\n';
	//v_BandHead +=      '<Cell row="1" col="16" displaytype="text" text="상품"/>\n';
	
	v_BandBody +=      '<Cell celltype="body" displaytype="number" style="align:right;" expr="expr:currow+1"/>\n';
	v_BandBody +=      '<Cell col="1" celltype="body" displaytype="text" style="align:left;" text="bind:TM_NM" suppress="1"/>\n';
	v_BandBody +=      '<Cell col="2" celltype="body" displaytype="text" style="align:left;" text="bind:UPJANGNM"/>\n';
	v_BandBody +=      '<Cell col="3" celltype="body" displaytype="text" style="align:center;" text="bind:OPEN_DATE"/>\n';
	//직군추가 20161024 맹수영
	v_BandBody +=      '<Cell col="4" celltype="body" displaytype="text" style="align:center;" text="bind:JOB_CD2"/>\n';
	v_BandBody +=      '<Cell col="5" celltype="body" displaytype="text" style="align:center;" text="bind:CLOSE_DATE"/>\n';
	
	//v_BandBody +=      '<Cell col="5" displaytype="number" style="align:right;" text="bind:EQTY"/>\n';
	//v_BandBody +=      '<Cell col="6" displaytype="number" style="align:right;" text="bind:CQTY"/>\n';
	//v_BandBody +=      '<Cell col="7" displaytype="number" style="align:right;" text="bind:RQTY"/>\n';
	//v_BandBody +=      '<Cell col="8" displaytype="number" style="align:right;" text="bind:MEAL_QTY_RATE" mask="expr:iif(MEAL_QTY_RATE==null||(EQTY+CQTY+RQTY)==0,&quot;-&quot;,&quot;#,##0.0%&quot;)"/>\n';
	//v_BandBody +=      '<Cell col="9" displaytype="number" style="align:right;" text="bind:COOK_QTY_RATE" mask="expr:iif(CQTY==0||CQTY==null,&quot;-&quot;,&quot;#,##0.0%&quot;)"/>\n';
	//v_BandBody +=      '<Cell col="10" displaytype="expr:decode(TRX_DATE,&quot;계&quot;,'number','normal')" style="align:right;background:EXPR(XPR(decode(TRX_DATE,&quot;계&quot;,'',iif(EEXI==0||EEXI==null,'',iif(REXI==0,&quot;URL('theme://convertImages/img_RC.png')&quot;,&quot;URL('theme://convertImages/img_GC.png')&quot;)))));background2:EXPR(XPR(decode(TRX_DATE,&quot;계&quot;,'',iif(EEXI==0||EEXI==null,'',iif(REXI==0,&quot;URL('theme://convertImages/img_RC.png')&quot;,&quot;URL('theme://convertImages/img_GC.png')&quot;)))));" text="bind:REXI" expr="expr:decode(TRX_DATE,&quot;계&quot;,decode(EEXI,0,0,Math.round(REXI/EEXI*100,1)),'')" mask="expr:decode(TRX_DATE,&quot;계&quot;,'#,##0.0%','')"/>\n';
	//v_BandBody +=      '<Cell col="11" displaytype="expr:decode(TRX_DATE,&quot;계&quot;,'number','normal')" style="align:right;background:EXPR(XPR(decode(TRX_DATE,&quot;계&quot;,'',iif(EEXI==0||EEXI==null,'',iif(CEXI==0,&quot;URL('theme://convertImages/img_RC.png')&quot;,&quot;URL('theme://convertImages/img_GC.png')&quot;)))));background2:EXPR(XPR(decode(TRX_DATE,&quot;계&quot;,'',iif(EEXI==0||EEXI==null,'',iif(CEXI==0,&quot;URL('theme://convertImages/img_RC.png')&quot;,&quot;URL('theme://convertImages/img_GC.png')&quot;)))));" text="bind:CEXI" expr="expr:decode(TRX_DATE,&quot;계&quot;,decode(EEXI,0,0,Math.round(CEXI/EEXI*100,1)),'')" mask="expr:decode(TRX_DATE,&quot;계&quot;,'#,##0.0%','')"/>\n';
	//v_BandBody +=      '<Cell col="12" displaytype="number" style="align:right;" text="bind:QTY"/>\n';
	//v_BandBody +=      '<Cell col="13" displaytype="number" style="align:right;" text="bind:T_AMT"/>\n';
	//v_BandBody +=      '<Cell col="14" displaytype="number" style="align:right;" text="bind:F_AMT"/>\n';
	//v_BandBody +=      '<Cell col="15" displaytype="number" style="align:right;" text="bind:S_AMT"/>\n';
	//v_BandBody +=      '<Cell col="16" displaytype="number" style="align:right;" text="bind:E_AMT"/>\n';
	
	// 포맷 생성
	var v_HeadText = '';
	var v_HeadColIdx = 6;
	var v_BodyColIdx = 6;

	for (var i=0; i<objPivotHeadDs.getRowCount(); i++)
	{
		// Column 생성
		v_Columns +=      '<Column size="60"/>\n';
		v_Columns +=      '<Column size="60"/>\n';
		v_Columns +=      '<Column size="60"/>\n';
		//식수오차 추가 20161025 맹수영
		v_Columns +=      '<Column size="65"/>\n';
		v_Columns +=      '<Column size="65"/>\n';
		v_Columns +=      '<Column size="70"/>\n';
		v_Columns +=      '<Column size="70"/>\n';
		v_Columns +=      '<Column size="65"/>\n';
		v_Columns +=      '<Column size="70"/>\n';
		v_Columns +=      '<Column size="70"/>\n';
		v_Columns +=      '<Column size="70"/>\n';
		v_Columns +=      '<Column size="70"/>\n';
		//추가
		v_Columns +=      '<Column size="70"/>\n';
		v_Columns +=      '<Column size="70"/>\n';
		v_Columns +=      '<Column size="70"/>\n';
		//추가
		v_Columns +=      '<Column size="90"/>\n';
		v_Columns +=      '<Column size="90"/>\n';
		v_Columns +=      '<Column size="90"/>\n';
		//v_Columns +=      '<Column size="90"/>\n';

        //등록, 미등록수 추가
		v_Columns +=      '<Column size="90"/>\n';
		v_Columns +=      '<Column size="90"/>\n';
		// Head 생성
		if (v_HeadText != objPivotHeadDs.getColumn(i, "TRX_DATE"))
		{
			v_HeadText = objPivotHeadDs.getColumn(i, "TRX_DATE");
			var headC;
			
			if(v_HeadText == "계")
			{
				headC= v_HeadText;
			}
			else
			{
				headC= gfn_getFormat(v_HeadText,"@@@@-@@-@@")
			}			
							
			// Row 1			
		//	v_BandHead += '<Cell col="'+v_HeadColIdx+'" colspan="'+14+'" text="'+headC+'"/>\n';
		//변경
		v_BandHead += '<Cell col="'+v_HeadColIdx+'" colspan="'+20+'" text="'+headC+'"/>\n';
			
			// Row 2
			for (var j=i; j<objPivotHeadDs.getRowCount(); j++)
			{
				if (v_HeadText == objPivotHeadDs.getColumn(j, "TRX_DATE"))
				{
					v_BandHead += '<Cell row="1" col="'+v_HeadColIdx+'" text="예상식수"/>\n';
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+1)+'" text="조리식수"/>\n';
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+2)+'" text="실식수"/>\n';
					//식수오차 추가 20161025 맹수영
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+3)+'" text="식수오차"/>\n';
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+4)+'" text="오차율"/>\n';
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+5)+'" text="조리오차율"/>\n';
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+6)+'" text="등록율"/>\n';
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+7)+'" text="조리등록율"/>\n';
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+8)+'" text="매출식수"/>\n';
					//추가
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+9)+'" text="실식수매출"/>\n';
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+10)+'" text="매출차이"/>\n';
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+11)+'" text="매출차이율"/>\n';										
					//추가					
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+12)+'" text="식재료율&#13;&#10;(예상)"/>\n';
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+13)+'" text="식재료율&#13;&#10;(실적)"/>\n';
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+14)+'" text="매출계"/>\n';
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+15)+'" text="식음료"/>\n';
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+16)+'" text="기타"/>\n';
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+17)+'" text="상품"/>\n';
					//if (objPivotHeadDs.getColumn(j, "TRX_DATE") == "계" ) {
					//v_BandHead += '<Cell col="'+v_HeadColIdx+'" colspan="'+20+'" text="'+headC+'"/>\n';
					
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+18)+'" text="등록수"/>\n';
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+19)+'" text="미등록수"/>\n';
					v_HeadColIdx += 20
					//}
					//else
					//{
					//v_HeadColIdx += 18
					//}
					
					/*
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+3)+'" text="오차율"/>\n';
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+4)+'" text="조리오차율"/>\n';
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+5)+'" text="등록율"/>\n';
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+6)+'" text="조리등록율"/>\n';
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+7)+'" text="매출식수"/>\n';
					//추가
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+8)+'" text="실식수매출"/>\n';
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+9)+'" text="매출차이"/>\n';
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+10)+'" text="매출차이율"/>\n';										
					//추가					
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+11)+'" text="식재료율&#13;&#10;(예상)"/>\n';
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+12)+'" text="식재료율&#13;&#10;(실적)"/>\n';
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+13)+'" text="매출계"/>\n';
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+14)+'" text="식음료"/>\n';
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+15)+'" text="기타"/>\n';
					v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+16)+'" text="상품"/>\n';
					v_HeadColIdx += 17
					*/
				}
			}
		}

		// Body 생성
		v_BandBody += '<Cell col="'+v_BodyColIdx+'" displaytype="number" style="align:right;" text="expr:P_EQTY'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'"/>\n';
		v_BandBody += '<Cell col="'+(v_BodyColIdx+1)+'" displaytype="number" style="align:right;" text="expr:P_CQTY'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'"/>\n';
		v_BandBody += '<Cell col="'+(v_BodyColIdx+2)+'" displaytype="number" style="align:right;" text="expr:P_RQTY'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'"/>\n';
		//식수오차추가 20161025 맹수영
		v_BandBody += '<Cell col="'+(v_BodyColIdx+3)+'" displaytype="number" style="align:right;" text="expr:P_ERQTY'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'"/>\n';
		v_BandBody += '<Cell col="'+(v_BodyColIdx+4)+'" displaytype="number" style="align:right;" text="expr:P_MEAL'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'" mask="expr:iif(P_MEAL'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'==null||(P_EQTY'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'+P_EQTY'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'+P_EQTY'+objPivotHeadDs.getColumn(i, "TRX_DATE")+')==0,&quot;-&quot;,&quot;#,##0.0%&quot;)"/>\n';
		v_BandBody += '<Cell col="'+(v_BodyColIdx+5)+'" displaytype="number" style="align:right;" text="expr:P_COOK'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'" mask="expr:iif(P_CQTY'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'==0||P_CQTY'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'==null,&quot;-&quot;,&quot;#,##0.0%&quot;)"/>\n';
		v_BandBody += '<Cell col="'+(v_BodyColIdx+6)+'" displaytype="expr:decode(&quot;'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;,&quot;계&quot;,&quot;number&quot;,&quot;image&quot;)" style="background2:&#32;;" text="bind:P_REXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'" expr="expr:decode(&quot;'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;,&quot;계&quot;,decode(&quot;P_EEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;,0,0,gfn_parseFloat(Math.round(P_REXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'/P_EEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'*100,1))),iif(P_EEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'==0||P_EEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'==null,&quot;&quot;,iif(P_REXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'==0,&quot;URL(&apos;theme://convertImages/img_RC.png&apos;)&quot;,&quot;URL(&apos;theme://convertImages/img_GC.png&apos;)&quot;)))" mask="expr:decode(&quot;'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;,&quot;계&quot;,&quot;#,##0.0%&quot;,&quot;&quot;)"/>\n';
		//등록일 숫자로 표시 테스트
		//v_BandBody += '<Cell col="'+(v_BodyColIdx+6)+'" displaytype="expr:decode(&quot;'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;,&quot;계&quot;,&quot;number&quot;,&quot;image&quot;)" style="background2:&#32;;" text="bind:P_REXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'" expr="expr:decode(&quot;'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;,&quot;계&quot;,decode(&quot;P_EEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;,0,0,P_REXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'),iif(P_EEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'==0||P_EEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'==null,&quot;&quot;,iif(P_REXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'==0,&quot;URL(&apos;theme://convertImages/img_RC.png&apos;)&quot;,&quot;URL(&apos;theme://convertImages/img_GC.png&apos;)&quot;)))" mask="expr:decode(&quot;'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;,&quot;계&quot;,&quot;#,##0.0%&quot;,&quot;&quot;)"/>\n';
		v_BandBody += '<Cell col="'+(v_BodyColIdx+7)+'" displaytype="expr:decode(&quot;'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;,&quot;계&quot;,&quot;number&quot;,&quot;image&quot;)" style="align:&#32;;" text="bind:P_CEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'" expr="expr:decode(&quot;'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;,&quot;계&quot;,decode(&quot;P_EEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;,0,0,gfn_parseFloat(Math.round(P_CEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'/P_EEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'*100,1))),iif(P_EEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'==0||P_EEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'==null,&quot;&quot;,iif(P_CEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'==0,&quot;URL(&apos;theme://convertImages/img_RC.png&apos;)&quot;,&quot;URL(&apos;theme://convertImages/img_GC.png&apos;)&quot;)))" mask="expr:decode(&quot;'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;,&quot;계&quot;,&quot;#,##0.0%&quot;,&quot;&quot;)"/>\n';		
		v_BandBody += '<Cell col="'+(v_BodyColIdx+8)+'" displaytype="number" style="align:right;" text="expr:P_QTYY'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'"/>\n';
		//추가
		v_BandBody += '<Cell col="'+(v_BodyColIdx+9)+'" displaytype="number" style="align:right;" text="expr:P_MEAL_UPRICE'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'"/>\n';
		v_BandBody += '<Cell col="'+(v_BodyColIdx+10)+'" displaytype="number" style="align:right;" text="expr:P_MAECHUL_C'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'"/>\n';
		//v_BandBody += '<Cell col="'+(v_BodyColIdx+10)+'" displaytype="number" style="align:right;" text="expr:P_MAECHUL_CP'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'"/>\n';		
		//v_BandBody += '<Cell col="'+(v_BodyColIdx+10)+'" displaytype="number" style="align:right;" text="expr:decode(&quot;'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;,&quot;계&quot;,decode( P_MAECHUL_C'+objPivotHeadDs.getColumn(i, "TRX_DATE")+',0,0, Math.round((P_MAECHUL_C'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'/P_MEAL_UPRICE'+objPivotHeadDs.getColumn(i, "TRX_DATE")+')*100,1)),P_MAECHUL_CP'+objPivotHeadDs.getColumn(i, "TRX_DATE")+')"/>\n';
		v_BandBody += '<Cell col="'+(v_BodyColIdx+11)+'" displaytype="number" style="align:right;" text="expr:decode(&quot;'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;,&quot;계&quot;,decode( P_MAECHUL_C'+objPivotHeadDs.getColumn(i, "TRX_DATE")+',0,0, Math.round((decode(P_MEAL_UPRICE'+objPivotHeadDs.getColumn(i, "TRX_DATE")+',0,P_MAECHUL_C'+objPivotHeadDs.getColumn(i, "TRX_DATE")+', P_MAECHUL_C'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'/P_MEAL_UPRICE'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'))*100,1)),P_MAECHUL_CP'+objPivotHeadDs.getColumn(i, "TRX_DATE")+')"/>\n';
		//추가		
		v_BandBody += '<Cell col="'+(v_BodyColIdx+12)+'" displaytype="number" style="align:right;" text="expr:P_ERAT'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'" mask="expr:iif(P_ERAT'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'==0||P_ERAT'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'==null,&quot;-&quot;,&quot;#,##0.0%&quot;)"/>\n';
		v_BandBody += '<Cell col="'+(v_BodyColIdx+13)+'" displaytype="number" style="align:right;" text="expr:P_SRAT'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'" mask="expr:iif(P_SRAT'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'==0||P_SRAT'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'==null,&quot;-&quot;,&quot;#,##0.0%&quot;)"/>\n';
		v_BandBody += '<Cell col="'+(v_BodyColIdx+14)+'" displaytype="number" style="align:right;" text="expr:P_TAMT'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'"/>\n';
		v_BandBody += '<Cell col="'+(v_BodyColIdx+15)+'" displaytype="number" style="align:right;" text="expr:P_FAMT'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'"/>\n';
		v_BandBody += '<Cell col="'+(v_BodyColIdx+16)+'" displaytype="number" style="align:right;" text="expr:P_SAMT'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'"/>\n';
		v_BandBody += '<Cell col="'+(v_BodyColIdx+17)+'" displaytype="number" style="align:right;" text="expr:P_EAMT'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'"/>\n';
		
        //if (objPivotHeadDs.getColumn(j, "TRX_DATE") == "계" ) {
        //v_BandBody += '<Cell col="'+(v_BodyColIdx+18)+'" displaytype="number" style="background2:&#32;;" text="bind:P_REXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'" expr="expr:decode(&quot;'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;,&quot;계&quot;,decode(&quot;P_EEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;,0,0,P_REXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+')" />\n';
    	v_BandBody += '<Cell col="'+(v_BodyColIdx+18)+'" displaytype="expr:decode(&quot;'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;,&quot;계&quot;,&quot;number&quot;,&quot;image&quot;)" style="background2:&#32;;" text="bind:P_REXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'" expr="expr:decode(&quot;'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;,&quot;계&quot;,decode(&quot;P_EEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;,0,0,P_REXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'),iif(P_EEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'==0||P_EEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'==null,&quot;&quot;,iif(P_REXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'==0,&quot;URL(&apos;theme://convertImages/img_RC.png&apos;)&quot;,&quot;URL(&apos;theme://convertImages/img_GC.png&apos;)&quot;)))" mask="expr:decode(&quot;'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;,&quot;계&quot;,&quot;,&quot;&quot;)"/>\n';
		v_BandBody += '<Cell col="'+(v_BodyColIdx+19)+'" displaytype="expr:decode(&quot;'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;,&quot;계&quot;,&quot;number&quot;,&quot;image&quot;)" style="background2:&#32;;" text="bind:P_REXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'" expr="expr:decode(&quot;'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;,&quot;계&quot;,decode(&quot;P_EEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;,0,0,(P_EEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+' - P_REXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+')),iif(P_EEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'==0||P_EEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'==null,&quot;&quot;,iif(P_REXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'==0,&quot;URL(&apos;theme://convertImages/img_RC.png&apos;)&quot;,&quot;URL(&apos;theme://convertImages/img_GC.png&apos;)&quot;)))" mask="expr:decode(&quot;'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;,&quot;계&quot;,&quot; ,&quot;&quot;)"/>\n';
		//v_BodyColIdx+=18;
		v_BodyColIdx+=20;
	 
		//}
		//else {
		//v_BodyColIdx+=18;
		//} 

	}

	v_Summary += '<Cell colspan="6" displaytype="text" style="align:center;" text="합계(오차율평균)"/>\n';

	// 포맷 생성
	v_BodyColIdx = 6;
	for (var i=0; i<objPivotHeadDs.getRowCount(); i++)
	{
		v_Summary += '<Cell col="'+v_BodyColIdx+'" displaytype="number" style="align:right middle;" expr="expr:ds_list_Pivot.getSum(&quot;P_EQTY'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)"/>\n';
		v_Summary += '<Cell col="'+(v_BodyColIdx+1)+'" displaytype="number" style="align:right middle;" expr="expr:ds_list_Pivot.getSum(&quot;P_CQTY'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)"/>\n';
		v_Summary += '<Cell col="'+(v_BodyColIdx+2)+'" displaytype="number" style="align:right middle;" expr="expr:ds_list_Pivot.getSum(&quot;P_RQTY'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)"/>\n';
		v_Summary += '<Cell col="'+(v_BodyColIdx+3)+'" displaytype="number" style="align:right middle;" expr="expr:ds_list_Pivot.getSum(&quot;P_ERQTY'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)"/>\n';
		v_Summary += '<Cell col="'+(v_BodyColIdx+4)+'" displaytype="number" style="align:right middle;" expr="expr:Math.round(ds_list_Pivot.getCaseAvg(&quot;P_MEAL'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&lt;&gt;null&amp;&amp;(P_EQTY'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'+P_CQTY'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'+P_RQTY'+objPivotHeadDs.getColumn(i, "TRX_DATE")+')&lt;&gt;0&quot;,&quot;P_MEAL'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;),1)" mask="#,##0.0%"/>\n';
		v_Summary += '<Cell col="'+(v_BodyColIdx+5)+'" displaytype="number" style="align:right middle;" expr="expr:gfn_parseFloat(Math.round(ds_list_Pivot.getCaseAvg(&quot;P_CQTY'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&lt;&gt;0&amp;&amp;P_CQTY'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&lt;&gt;null&quot;,&quot;P_COOK'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;),1))" mask="#,##0.0%"/>\n';
		v_Summary += '<Cell col="'+(v_BodyColIdx+6)+'" displaytype="number" style="align:right middle;" expr="expr:decode(ds_list_Pivot.getSum(&quot;P_EEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;),0,0,Math.round(ds_list_Pivot.getSum(&quot;P_REXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)/ds_list_Pivot.getSum(&quot;P_EEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)*100,1))" mask="#,##0.0%"/>\n';	
		v_Summary += '<Cell col="'+(v_BodyColIdx+7)+'" displaytype="number" style="align:right middle;" expr="expr:decode(ds_list_Pivot.getSum(&quot;P_EEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;),0,0,Math.round(ds_list_Pivot.getSum(&quot;P_CEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)/ds_list_Pivot.getSum(&quot;P_EEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)*100,1))" mask="#,##0.0%"/>\n';
		v_Summary += '<Cell col="'+(v_BodyColIdx+8)+'" displaytype="number" style="align:right middle;" expr="expr:ds_list_Pivot.getSum(&quot;P_QTYY'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)"/>\n';
		//추가 조회 칼럼 추가  처리:맹수영, 요청:윤지혜 20160622  (CH201606_00175)
		v_Summary += '<Cell col="'+(v_BodyColIdx+9)+'" displaytype="number" style="align:right middle;" expr="expr:ds_list_Pivot.getSum(&quot;P_MEAL_UPRICE'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)"/>\n';
		v_Summary += '<Cell col="'+(v_BodyColIdx+10)+'" displaytype="number" style="align:right middle;" expr="expr:ds_list_Pivot.getSum(&quot;P_MAECHUL_C'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)"/>\n';		
		
		//v_Summary += '<Cell col="'+(v_BodyColIdx+10)+'" displaytype="number" style="align:right middle;" expr="expr:gfn_parseFloat(Math.round(ds_list_Pivot.getCaseAvg(&quot;P_MAECHUL_CP'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&lt;&gt;0&amp;&amp;P_MAECHUL_CP'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&lt;&gt;null&quot;,&quot;P_MAECHUL_CP'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;),1))" mask="#,##0.0%"/>\n';
		//매출차이율 계산식 변경 처리:맹수영, 요청:윤지혜 20160704  (CH201607_00047)
		v_Summary += '<Cell col="'+(v_BodyColIdx+11)+'" displaytype="number" style="align:right middle;" expr="expr:Math.round((ds_list_Pivot.getSum(&quot;P_MAECHUL_C'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)/ds_list_Pivot.getSum(&quot;P_MEAL_UPRICE'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)) * 100,2)"  mask="#,##0.00%"/>\n';
		//추가	
		v_Summary += '<Cell col="'+(v_BodyColIdx+12)+'" displaytype="number" style="align:right middle;" expr="expr:gfn_parseFloat(Math.round(ds_list_Pivot.getCaseAvg(&quot;P_ERAT'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&lt;&gt;0&amp;&amp;P_ERAT'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&lt;&gt;null&quot;,&quot;P_ERAT'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;),1))" mask="#,##0.0%"/>\n';
		v_Summary += '<Cell col="'+(v_BodyColIdx+13)+'" displaytype="number" style="align:right middle;" expr="expr:gfn_parseFloat(Math.round(ds_list_Pivot.getCaseAvg(&quot;P_SRAT'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&lt;&gt;0&amp;&amp;P_SRAT'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&lt;&gt;null&quot;,&quot;P_SRAT'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;),1))" mask="#,##0.0%"/>\n';
		v_Summary += '<Cell col="'+(v_BodyColIdx+14)+'" displaytype="number" style="align:right middle;" expr="expr:ds_list_Pivot.getSum(&quot;P_TAMT'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)"/>\n';
		v_Summary += '<Cell col="'+(v_BodyColIdx+15)+'" displaytype="number" style="align:right middle;" expr="expr:ds_list_Pivot.getSum(&quot;P_FAMT'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)"/>\n';
		v_Summary += '<Cell col="'+(v_BodyColIdx+16)+'" displaytype="number" style="align:right middle;" expr="expr:ds_list_Pivot.getSum(&quot;P_SAMT'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)"/>\n';
		v_Summary += '<Cell col="'+(v_BodyColIdx+17)+'" displaytype="number" style="align:right middle;" expr="expr:ds_list_Pivot.getSum(&quot;P_EAMT'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)"/>\n';
		
		//등록수, 미등록수 추가
		v_Summary += '<Cell col="'+(v_BodyColIdx+18)+'" displaytype="number" style="align:right middle;" expr="expr:ds_list_Pivot.getSum(&quot;P_REXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)"/>\n';
		v_Summary += '<Cell col="'+(v_BodyColIdx+19)+'" displaytype="number" style="align:right middle;" expr="expr:ds_list_Pivot.getSum(&quot;(P_EEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+' - P_REXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+')&quot;)" />\n';
		
		v_BodyColIdx += 20;
	}
	
	v_Summary += '<Cell row="1" colspan="6" displaytype="text" style="align:center;" text="합계(오차율합계)"/>\n';
	
	// 포맷 생성
	v_BodyColIdx = 6;
	for (var i=0; i<objPivotHeadDs.getRowCount(); i++)
	{
		v_Summary += '<Cell row="1" col="'+v_BodyColIdx+'" displaytype="number" style="align:right middle;" expr="expr:ds_list_Pivot.getSum(&quot;P_EQTY'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)"/>\n';
		v_Summary += '<Cell row="1" col="'+(v_BodyColIdx+1)+'" displaytype="number" style="align:right middle;" expr="expr:ds_list_Pivot.getSum(&quot;P_CQTY'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)"/>\n';
		v_Summary += '<Cell row="1" col="'+(v_BodyColIdx+2)+'" displaytype="number" style="align:right middlle;" expr="expr:ds_list_Pivot.getSum(&quot;P_RQTY'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)"/>\n';
		v_Summary += '<Cell row="1" col="'+(v_BodyColIdx+3)+'" displaytype="number" style="align:right middlle;" expr="expr:ds_list_Pivot.getSum(&quot;P_ERQTY'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)"/>\n';
		v_Summary += '<Cell row="1" col="'+(v_BodyColIdx+4)+'" displaytype="number" style="align:right middel;" expr="expr:decode(getSum(&apos;P_EQTY'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&apos;),0,0,Math.round(getSum(&apos;P_MEAA'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&apos;)/getSum(&apos;P_EQTY'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&apos;)*100,1))" mask="#,##0.0%"/>\n';
		v_Summary += '<Cell row="1" col="'+(v_BodyColIdx+5)+'" displaytype="number" style="align:right&#32;middle;" expr="expr:decode(ds_list_Pivot.getSum(&quot;P_CQTY'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;),0,0,Math.round(ds_list_Pivot.getSum(&quot;P_COKK'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)/ds_list_Pivot.getSum(&quot;P_CQTY'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)*100,1))" mask="#,##0.0%"/>\n';
		v_Summary += '<Cell row="1" col="'+(v_BodyColIdx+6)+'" displaytype="number" style="align:right middle;" expr="expr:decode(ds_list_Pivot.getSum(&quot;P_EEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;),0,0,Math.round(ds_list_Pivot.getSum(&quot;P_REXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)/ds_list_Pivot.getSum(&quot;P_EEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)*100,1))" mask="#,##0.0%"/>\n';
		v_Summary += '<Cell row="1" col="'+(v_BodyColIdx+7)+'" displaytype="number" style="align:right middle;" expr="expr:decode(ds_list_Pivot.getSum(&quot;P_EEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;),0,0,Math.round(ds_list_Pivot.getSum(&quot;P_CEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)/ds_list_Pivot.getSum(&quot;P_EEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)*100,1))" mask="#,##0.0%"/>\n';
		v_Summary += '<Cell row="1" col="'+(v_BodyColIdx+8)+'" displaytype="number" style="align:right middle;" expr="expr:ds_list_Pivot.getSum(&quot;P_QTYY'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)"/>\n';
		//추가
		v_Summary += '<Cell row="1" col="'+(v_BodyColIdx+9)+'" displaytype="number" style="align:right middle;" expr="expr:ds_list_Pivot.getSum(&quot;P_MEAL_UPRICE'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)"/>\n';
		v_Summary += '<Cell row="1" col="'+(v_BodyColIdx+10)+'" displaytype="number" style="align:right middle;" expr="expr:ds_list_Pivot.getSum(&quot;P_MAECHUL_C'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)"/>\n';
	
		//v_Summary += '<Cell row="1" col="'+(v_BodyColIdx+10)+'" displaytype="number" style="align:right middle;" expr="expr:gfn_parseFloat(Math.round(ds_list_Pivot.getCaseAvg(&quot;P_MAECHUL_CP'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&lt;&gt;0&amp;&amp;P_MAECHUL_CP'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&lt;&gt;null&quot;,&quot;P_MAECHUL_CP'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;),1))" mask="#,##0.0%"/>\n';
		v_Summary += '<Cell row="1" col="'+(v_BodyColIdx+11)+'" displaytype="number" style="align:right middle;" expr="expr:Math.round((ds_list_Pivot.getSum(&quot;P_MAECHUL_C'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)/ds_list_Pivot.getSum(&quot;P_MEAL_UPRICE'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)) * 100,2)"  mask="#,##0.00%"/>\n';
		//추가	
		v_Summary += '<Cell row="1" col="'+(v_BodyColIdx+12)+'" displaytype="number" style="align:right middle;" expr="expr:gfn_parseFloat(Math.round(ds_list_Pivot.getCaseAvg(&quot;P_ERAT'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&lt;&gt;0&amp;&amp;P_ERAT'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&lt;&gt;null&quot;,&quot;P_ERAT'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;),1))" mask="#,##0.0%"/>\n';
		v_Summary += '<Cell row="1" col="'+(v_BodyColIdx+13)+'" displaytype="number" style="align:right middle;" expr="expr:gfn_parseFloat(Math.round(ds_list_Pivot.getCaseAvg(&quot;P_SRAT'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&lt;&gt;0&amp;&amp;P_SRAT'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&lt;&gt;null&quot;,&quot;P_SRAT'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;),1))" mask="#,##0.0%"/>\n';
		v_Summary += '<Cell row="1" col="'+(v_BodyColIdx+14)+'" displaytype="number" style="align:right middle;" expr="expr:ds_list_Pivot.getSum(&quot;P_TAMT'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)"/>\n';
		v_Summary += '<Cell row="1" col="'+(v_BodyColIdx+15)+'" displaytype="number" style="align:right middle;" expr="expr:ds_list_Pivot.getSum(&quot;P_FAMT'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)"/>\n';
		v_Summary += '<Cell row="1" col="'+(v_BodyColIdx+16)+'" displaytype="number" style="align:right middle;" expr="expr:ds_list_Pivot.getSum(&quot;P_SAMT'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)"/>\n';
		v_Summary += '<Cell row="1" col="'+(v_BodyColIdx+17)+'" displaytype="number" style="align:right middle;" expr="expr:ds_list_Pivot.getSum(&quot;P_EAMT'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)"/>\n';	
		
		
		v_Summary += '<Cell row="1" col="'+(v_BodyColIdx+18)+'" displaytype="number" style="align:right middle;" expr="expr:ds_list_Pivot.getSum(&quot;P_REXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+'&quot;)"/>\n';
		v_Summary += '<Cell row="1" col="'+(v_BodyColIdx+19)+'" displaytype="number" style="align:right middle;" expr="expr:ds_list_Pivot.getSum(&quot;(P_EEXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+' - P_REXI'+objPivotHeadDs.getColumn(i, "TRX_DATE")+')&quot;)"/>\n';	
		
		v_BodyColIdx += 20;
	}

	v_Formats = '<Formats>\n';
	v_Formats += '<Format id="default">\n';
	v_Formats += '<Columns>\n';
	v_Formats += v_Columns;
	v_Formats += '</Columns>\n';
	v_Formats += '<Rows>\n';
	v_Formats += v_Rows;
	v_Formats += '</Rows>\n';
	v_Formats += '<Band id="head">\n';
	v_Formats += v_BandHead;
	v_Formats += '</Band>\n';	
	v_Formats += '<Band id="body">\n';
	v_Formats += v_BandBody;
	v_Formats += '</Band>\n';
	v_Formats += '<Band id="summary">\n';
	v_Formats += v_Summary;
	v_Formats += '</Band>\n';
	v_Formats += '</Format>\n';	
	v_Formats += '</Formats>\n';

	//trace(objPivotBodyDs.saveXML());
	//trace(v_Formats)
	objGrid.enableredraw = false;
	objGrid.formats = v_Formats;
	objGrid.binddataset = objPivotBodyDs.name;
	objGrid.enableredraw = true;
}
 ]]></Script>
  </Form>
</FDL>
