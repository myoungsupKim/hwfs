<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="..\..\..\default_typedef.xml"/>
  <Form id="NewPrWrite" classname="COMP_GUIDE_13" inheritanceid="" position="absolute 0 0 1155 712" titletext="신규주문신청" scrollbars="autoboth" onload="form_onload">
    <Layouts>
      <Layout>
        <Static id="Static06" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1140 0 1155 710" anchor="top right"/>
        <Static id="Static71" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 698 1150 713" anchor="left bottom"/>
        <Static id="Static18" text="신규주문정보" class="sta_WF_Title01" position="absolute 15 94 465 112" anchor="left top"/>
        <Static id="Static19" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 0 81 450 94"/>
        <Static id="Static20" text="글자기준간격 h08" class="Guide01_AreaRed" visible="false" position="absolute 0 107 450 115" anchor="left top"/>
        <Grid id="grd_list" taborder="4" autoenter="select" useinputpanel="false" cellsizingtype="col" position="absolute 15 115 1141 698" anchor="all" autofittype="none" binddataset="ds_list" selecttype="multirow">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="40"/>
                <Column size="40"/>
                <Column size="70"/>
                <Column size="259"/>
                <Column size="54"/>
                <Column size="152"/>
                <Column size="60"/>
                <Column size="62"/>
                <Column size="45"/>
                <Column size="59"/>
                <Column size="52"/>
                <Column size="73"/>
                <Column size="87"/>
                <Column size="62"/>
                <Column size="263"/>
                <Column size="0"/>
                <Column size="233"/>
              </Columns>
              <Rows>
                <Row size="26" band="head"/>
                <Row size="24"/>
                <Row size="24" band="summ"/>
              </Rows>
              <Band id="head">
                <Cell class="head_Excel"/>
                <Cell col="1" text="처리"/>
                <Cell col="2" class="grd_WF_Essential" text="자재코드"/>
                <Cell col="3" class="grd_WF_Essential" text="자재명" taborder="undefined"/>
                <Cell col="4" taborder="undefined"/>
                <Cell col="5" text="규격"/>
                <Cell col="6" text="구매단위"/>
                <Cell col="7" text="과세구분"/>
                <Cell col="8" text="배송"/>
                <Cell col="9" text="단가"/>
                <Cell col="10" class="grd_WF_Essential" text="수량"/>
                <Cell col="11" text="금액"/>
                <Cell col="12" text="실발주자"/>
                <Cell col="13" text="진행상황"/>
                <Cell col="14" text="비고  (반려 시 반려사유)"/>
                <Cell col="15" text="마감"/>
                <Cell col="16" text="구매수발주 오류 메시지"/>
              </Band>
              <Band id="body">
                <Cell text="expr:currow+1"/>
                <Cell col="1" displaytype="text" style="align:center middle;color:red;color2:red;" text="expr:getRowType(currow)==2?'신규':''"/>
                <Cell col="2" displaytype="text" style="align:center middle;background:EXPR(error=='Y'?'gold':'');background2:EXPR(error=='Y'?'gold':'');" text="bind:itemCode"/>
                <Cell col="3" displaytype="text" style="linetype:onlyhorz;background:EXPR(error=='Y'?'gold':'');background2:EXPR(error=='Y'?'gold':'');" text="bind:itemName"/>
                <Cell col="4" displaytype="image" style="background:EXPR(error=='Y'?'gold':'');background2:EXPR(error=='Y'?'gold':'');" text="bind:featureIcon"/>
                <Cell col="5" displaytype="text" style="background:EXPR(error=='Y'?'gold':'');background2:EXPR(error=='Y'?'gold':'');" text="bind:itemSize"/>
                <Cell col="6" displaytype="text" style="align:center middle;background:EXPR(error=='Y'?'gold':'');background2:EXPR(error=='Y'?'gold':'');" text="bind:itemUnit"/>
                <Cell col="7" style="background:EXPR(error=='Y'?'gold':'');background2:EXPR(error=='Y'?'gold':'');" text="expr:taxCode=='100'?'과세':taxCode=='210'?'면세':'영세'"/>
                <Cell col="8" style="background:EXPR(error=='Y'?'gold':'');background2:EXPR(error=='Y'?'gold':'');" text="expr:centerFlag=='VC'?'직송':centerFlag"/>
                <Cell col="9" displaytype="number" edittype="expr:fn_statusPrice(currow)" style="background:EXPR(error=='Y'?'gold':'');background2:EXPR(error=='Y'?'gold':'');" text="bind:salePrice" editautoselect="true"/>
                <Cell col="10" displaytype="number" edittype="expr:fn_statusQty(currow)" style="background:EXPR(error=='Y'?'gold':'');background2:EXPR(error=='Y'?'gold':'');" text="bind:prQty" mask="#,##0.#0" editautoselect="true"/>
                <Cell col="11" displaytype="number" style="background:EXPR(error=='Y'?'gold':'');background2:EXPR(error=='Y'?'gold':'');" text="bind:prAmt" mask="#,##0.#0"/>
                <Cell col="12" displaytype="text" edittype="text" text="bind:tOrder"/>
                <Cell col="13" displaytype="text" style="align:center middle;background:EXPR(error=='Y'?'gold':'');background2:EXPR(error=='Y'?'gold':'');color:EXPR(fn_statusColor(currow));color2:EXPR(fn_statusColor(currow));" text="bind:soStatusNm"/>
                <Cell col="14" displaytype="text" edittype="expr:fn_statusRem(currow)" style="background:EXPR(error=='Y'?'gold':'');background2:EXPR(error=='Y'?'gold':'');" text="bind:prRemark" editautoselect="true"/>
                <Cell col="15" displaytype="text" style="align:center middle;color:red;color2:red;" text="bind:closeStatus"/>
                <Cell col="16" displaytype="text" style="background:EXPR(error=='Y'?'gold':'');background2:EXPR(error=='Y'?'gold':'');color:red;color2:red;" text="bind:msg"/>
              </Band>
              <Band id="summary">
                <Cell/>
                <Cell col="1"/>
                <Cell col="2" style="align:center middle;" text="합계"/>
                <Cell col="3"/>
                <Cell col="4"/>
                <Cell col="5"/>
                <Cell col="6"/>
                <Cell col="7"/>
                <Cell col="8"/>
                <Cell col="9"/>
                <Cell col="10" displaytype="number" text="expr:getSum('prQty')" mask="#,##0.#0"/>
                <Cell col="11" displaytype="number" text="expr:getSum('prAmt')" mask="#,##0.#0"/>
                <Cell col="12"/>
                <Cell col="13"/>
                <Cell col="14"/>
                <Cell col="15"/>
                <Cell col="16"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Static id="Static08" class="sta_WFSA_Labelbg" position="absolute 0 40 1140 81" anchor="left top right"/>
        <Static id="Static28" text="창고" class="sta_WFSA_label" position="absolute 15 50 50 71" anchor="left top"/>
        <Static id="Static04" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 40 93 50" anchor="left top"/>
        <Static id="Static05" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 71 93 81" anchor="left top"/>
        <Static id="Static07" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 50 15 71" anchor="left top"/>
        <Static id="Static11" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 49 50 59 71" anchor="left top"/>
        <Static id="Static10" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 297 50 307 71" anchor="left top"/>
        <Static id="Static01" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 304 41 397 51" anchor="left top"/>
        <Static id="Static02" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 449 51 479 77" anchor="left top"/>
        <Static id="Static09" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 636 41 729 51" anchor="left top"/>
        <Static id="Static13" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 543 51 553 72" anchor="left top"/>
        <Static id="Static25" text="h05" class="Guide01_AreaRed" visible="false" position="absolute 1052 111 1136 116" anchor="top right"/>
        <Static id="Static27" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 653 51 683 77" anchor="left top"/>
        <Static id="Static30" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 747 51 757 72" anchor="left top"/>
        <ObjCalendar id="cal_prDate" anchor="left top" titletext="캘린더" taborder="2" scrollbars="none" position="absolute 553 51 653 72" enable="false" style="align:left top;"/>
        <Static id="Static52" text="신청일자" class="sta_WFSA_label" position="absolute 480 51 556 72" anchor="left top" style="align:left middle;"/>
        <Static id="Static31" text="입고일자" class="sta_WFSA_label" position="absolute 684 51 760 72" anchor="left top" style="align:left middle;"/>
        <ObjCalendar id="cal_needDate" anchor="left top" titletext="캘린더" taborder="3" scrollbars="none" position="absolute 757 51 857 72" enable="false"/>
        <Static id="st_Days" text="(발주 마감 : D-0 00시)" position="absolute 581 12 738 33" style="font:Gulim,9, bold;" visible="false"/>
        <Static id="st_Week" text="(월)" position="absolute 544 12 572 33" style="font:Gulim,9,bold;" visible="false"/>
        <Static id="st_Timer" text="마감시간 : 00일 00시간 00분 전" class="sta_WF_RedhelpB" position="absolute 734 16 932 28" anchor="top right" style="color:red;align:right middle;font:굴림,9,bold;" visible="false"/>
        <Static id="Static00" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 0 1100 10"/>
        <Static id="Static12" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 0 15 341"/>
        <Static id="sta_title" text="타이틀 표시" class="sta_WF_Title" position="absolute 15 16 341 40"/>
        <Static id="Static03" text="아이콘기준 h08" class="Guide01_AreaRed" visible="false" position="absolute 15 32 215 40"/>
        <Static id="Static17" text="h06" class="Guide01_AreaRed" visible="false" position="absolute 15 10 215 16"/>
        <Static id="Static15" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 690 81 1140 94"/>
        <Button id="btn_delete" taborder="6" text="삭제" onclick="fn_delete" class="btn_WF_CRUD" position="absolute 1001 10 1046 35" anchor="top right" visible="true"/>
        <Button id="btn_save" taborder="7" text="저장" onclick="fn_save" class="btn_WF_CRUD" position="absolute 1048 10 1093 35" anchor="top right"/>
        <Button id="btn_close" taborder="8" text="닫기" onclick="btn_close_onclick" class="btn_WF_CRUD" position="absolute 1095 10 1140 35" anchor="top right"/>
        <Static id="Static14" text="W102" visible="false" position="absolute 1093 10 1095 35" anchor="top right" style="background:#ff000055;align:center middle;"/>
        <Static id="Static16" text="W102" visible="false" position="absolute 1046 10 1048 35" anchor="top right" style="background:#ff000055;align:center middle;"/>
        <Button id="btn_insert" taborder="5" text="입력" class="btn_WF_CRUD" position="absolute 954 10 999 35" anchor="top right" onclick="fn_insert" visible="true"/>
        <Static id="Static21" text="W102" visible="false" position="absolute 999 10 1001 35" anchor="top right" style="background:#ff000055;align:center middle;"/>
        <Static id="st_Credit" text="발주가능금액" class="sta_WFDA_Label01" visible="false" position="absolute 406 91 498 112"/>
        <Edit id="ed_credit" taborder="16" tabstop="false" autoselect="true" enable="false" visible="false" position="absolute 508 91 618 112" style="align:right; :disabled {background:#ffffffff;color:red;}"/>
        <Static id="st_Bond" text="채권잔액" class="sta_WFDA_Label01" visible="false" position="absolute 628 91 723 112" style="align:center middle;"/>
        <Edit id="ed_bond" taborder="17" tabstop="false" autoselect="true" enable="false" visible="false" position="absolute 733 91 843 112" style="align:right; :disabled {background:#ffffffff;color:red;}"/>
        <Static id="Static26" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 723 91 733 112" anchor="left top"/>
        <Static id="Static22" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 618 91 628 112" anchor="left top"/>
        <Static id="Static23" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 498 91 508 112" anchor="left top"/>
        <Edit id="edt_subinv" taborder="0" readonly="true" class="edt_WF_Essential" position="absolute 58 50 429 71" style=":disabled {cursor:arrowwait;}" userdata="" onkeydown="edt_subinv_onkeydown"/>
        <Button id="btn_subinv" taborder="1" tabstop="false" class="btn_WF_popSearchEssential" position="absolute 428 50 449 71" onclick="btn_subinv_onclick"/>
        <CheckBox id="chk1" taborder="18" text="본인관리 업장기준 창고조회" position="absolute 870 51 1072 71" anchor="left top"/>
        <ProgressBar id="pbr_status" taborder="20" text="구매 기획자재,DC자재,SPOT발주 체크" max="100" min="0" position="absolute 819 87 1141 111" anchor="top right"/>
        <Grid id="Grid00" taborder="21" useinputpanel="false" position="absolute 99 340 1030 524" binddataset="ds_list" cellsizingtype="col" visible="false">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="57"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
              </Columns>
              <Rows>
                <Row size="24" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell/>
                <Cell col="1" text="itemCode"/>
                <Cell col="2" text="itemName"/>
                <Cell col="3" text="itemSize"/>
                <Cell col="4" text="itemUnit"/>
                <Cell col="5" text="marginPrice"/>
                <Cell col="6" text="prQty"/>
                <Cell col="7" text="prAmt"/>
                <Cell col="8" text="subinvCode"/>
                <Cell col="9" text="needDate"/>
                <Cell col="10" text="prRemark"/>
                <Cell col="11" text="unitPrice"/>
                <Cell col="12" text="taxCode"/>
                <Cell col="13" text="custCd"/>
                <Cell col="14" text="approver"/>
                <Cell col="15" text="centerFlag"/>
                <Cell col="16" text="centerCode"/>
                <Cell col="17" text="prDate"/>
                <Cell col="18" text="prDeptId"/>
                <Cell col="19" text="prUpjang"/>
                <Cell col="20" text="acctcd"/>
                <Cell col="21" text="budCls"/>
                <Cell col="22" text="rcMuCd"/>
                <Cell col="23" text="rcDeptId"/>
                <Cell col="24" text="rcUpjang"/>
                <Cell col="25" text="invatFlag"/>
                <Cell col="26" text="outvatFlag"/>
                <Cell col="27" text="minOrdQty"/>
                <Cell col="28" text="maxOrdQty"/>
                <Cell col="29" text="stockFlag"/>
                <Cell col="30" text="salePrice"/>
                <Cell col="31" text="strategyPrice"/>
                <Cell col="32" text="planningPrice"/>
                <Cell col="33" text="subsidyPrice"/>
                <Cell col="34" text="opPrice"/>
                <Cell col="35" text="multiplierQty"/>
                <Cell col="36" text="pointFlag"/>
                <Cell col="37" text="buddeptId"/>
                <Cell col="38" text="dDays"/>
                <Cell col="39" text="dTimes"/>
                <Cell col="40" text="prId"/>
                <Cell col="41" text="prNum"/>
                <Cell col="42" text="approveNum"/>
                <Cell col="43" text="poType"/>
                <Cell col="44" text="lineStatus"/>
                <Cell col="45" text="lineStatusNm"/>
                <Cell col="46" text="vdSn"/>
                <Cell col="47" text="applySd"/>
                <Cell col="48" text="closeStatus"/>
                <Cell col="49" text="upjangGrp"/>
                <Cell col="50" text="error"/>
                <Cell col="51" text="msg"/>
                <Cell col="52" text="soStatus"/>
                <Cell col="53" text="soStatusNm"/>
                <Cell col="54" text="featureIcon"/>
              </Band>
              <Band id="body">
                <Cell text="expr:getRowType(currow)"/>
                <Cell col="1" text="bind:itemCode"/>
                <Cell col="2" text="bind:itemName"/>
                <Cell col="3" text="bind:itemSize"/>
                <Cell col="4" text="bind:itemUnit"/>
                <Cell col="5" text="bind:marginPrice"/>
                <Cell col="6" text="bind:prQty"/>
                <Cell col="7" text="bind:prAmt"/>
                <Cell col="8" text="bind:subinvCode"/>
                <Cell col="9" text="bind:needDate"/>
                <Cell col="10" text="bind:prRemark"/>
                <Cell col="11" text="bind:unitPrice"/>
                <Cell col="12" text="bind:taxCode"/>
                <Cell col="13" text="bind:custCd"/>
                <Cell col="14" text="bind:approver"/>
                <Cell col="15" text="bind:centerFlag"/>
                <Cell col="16" text="bind:centerCode"/>
                <Cell col="17" text="bind:prDate"/>
                <Cell col="18" text="bind:prDeptId"/>
                <Cell col="19" text="bind:prUpjang"/>
                <Cell col="20" text="bind:acctcd"/>
                <Cell col="21" text="bind:budCls"/>
                <Cell col="22" text="bind:rcMuCd"/>
                <Cell col="23" text="bind:rcDeptId"/>
                <Cell col="24" text="bind:rcUpjang"/>
                <Cell col="25" text="bind:invatFlag"/>
                <Cell col="26" text="bind:outvatFlag"/>
                <Cell col="27" text="bind:minOrdQty"/>
                <Cell col="28" text="bind:maxOrdQty"/>
                <Cell col="29" text="bind:stockFlag"/>
                <Cell col="30" text="bind:salePrice"/>
                <Cell col="31" text="bind:strategyPrice"/>
                <Cell col="32" text="bind:planningPrice"/>
                <Cell col="33" text="bind:subsidyPrice"/>
                <Cell col="34" text="bind:opPrice"/>
                <Cell col="35" text="bind:multiplierQty"/>
                <Cell col="36" text="bind:pointFlag"/>
                <Cell col="37" text="bind:buddeptId"/>
                <Cell col="38" text="bind:dDays"/>
                <Cell col="39" text="bind:dTimes"/>
                <Cell col="40" text="bind:prId"/>
                <Cell col="41" text="bind:prNum"/>
                <Cell col="42" text="bind:approveNum"/>
                <Cell col="43" text="bind:poType"/>
                <Cell col="44" text="bind:lineStatus"/>
                <Cell col="45" text="bind:lineStatusNm"/>
                <Cell col="46" text="bind:vdSn"/>
                <Cell col="47" text="bind:applySd"/>
                <Cell col="48" text="bind:closeStatus"/>
                <Cell col="49" text="bind:upjangGrp"/>
                <Cell col="50" text="bind:error"/>
                <Cell col="51" text="bind:msg"/>
                <Cell col="52" text="bind:soStatus"/>
                <Cell col="53" text="bind:soStatusNm"/>
                <Cell col="54" text="bind:featureIcon"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
      </Layout>
    </Layouts>
    <Bind>
      <BindItem id="item2" compid="cal_prDate" propid="text" datasetid="ds_search" columnid="schPrDate"/>
      <BindItem id="item3" compid="cal_needDate" propid="text" datasetid="ds_search" columnid="schNeedDate"/>
      <BindItem id="item1" compid="edt_subinv" propid="userdata" datasetid="ds_search" columnid="GUBUN"/>
      <BindItem id="item0" compid="edt_subinv" propid="UserData" datasetid="ds_search" columnid="GUBUN"/>
    </Bind>
    <Objects>
      <Dataset id="ds_grd" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="자재코드" type="STRING" size="256"/>
          <Column id="자재명" type="STRING" size="256"/>
          <Column id="규격" type="STRING" size="256"/>
          <Column id="구매단위" type="STRING" size="256"/>
          <Column id="과세코드" type="STRING" size="256"/>
          <Column id="직송" type="STRING" size="256"/>
          <Column id="단가" type="STRING" size="256"/>
          <Column id="수량" type="STRING" size="256"/>
          <Column id="금액" type="STRING" size="256"/>
          <Column id="비고" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="자재코드">01010101003</Col>
            <Col id="자재명">쌀(유창농산)경기미</Col>
            <Col id="규격">국내산20KG/포</Col>
            <Col id="과세코드">면세</Col>
            <Col id="구매단위">포</Col>
            <Col id="직송">센터경유</Col>
            <Col id="단가">820.00</Col>
            <Col id="수량">1.00</Col>
            <Col id="금액">820.00</Col>
          </Row>
          <Row>
            <Col id="자재코드">01010101004</Col>
            <Col id="자재명">경기미(무술정미소)</Col>
            <Col id="규격">국내산20KG/포</Col>
            <Col id="과세코드">면세</Col>
            <Col id="구매단위">포</Col>
            <Col id="직송">센터경유</Col>
            <Col id="단가">820.00</Col>
            <Col id="수량">1.00</Col>
            <Col id="금액">820.00</Col>
          </Row>
          <Row>
            <Col id="자재코드">01010101017</Col>
            <Col id="자재명">(센터직송)쌀(유창농산)경기</Col>
            <Col id="규격">국내산20KG/포</Col>
            <Col id="과세코드">면세</Col>
            <Col id="구매단위">포</Col>
            <Col id="수량">1.00</Col>
            <Col id="금액">820.00</Col>
            <Col id="직송">센터경유</Col>
            <Col id="단가">820.00</Col>
          </Row>
          <Row>
            <Col id="자재코드">01010101020</Col>
            <Col id="자재명">(센터직송)쌀(유창농산)경기</Col>
            <Col id="규격">국내산20KG/포</Col>
            <Col id="과세코드">면세</Col>
            <Col id="구매단위">포</Col>
            <Col id="직송">센터경유</Col>
            <Col id="단가">820.00</Col>
            <Col id="수량">1.00</Col>
            <Col id="금액">820.00</Col>
          </Row>
          <Row>
            <Col id="자재코드">01010101020</Col>
            <Col id="자재명">백옥쌀(용인시농협)경기미</Col>
            <Col id="규격">국내산20KG/포</Col>
            <Col id="과세코드">면세</Col>
            <Col id="구매단위">포</Col>
            <Col id="직송">센터경유</Col>
            <Col id="단가">820.00</Col>
            <Col id="수량">1.00</Col>
            <Col id="금액">820.00</Col>
          </Row>
          <Row>
            <Col id="자재코드">01010101004</Col>
            <Col id="자재명">경기미(무술정미소)</Col>
            <Col id="규격">국내산20KG/포</Col>
            <Col id="과세코드">면세</Col>
            <Col id="구매단위">EA</Col>
            <Col id="직송">센터경유</Col>
            <Col id="단가">820.00</Col>
            <Col id="수량">1.00</Col>
            <Col id="금액">820.00</Col>
          </Row>
          <Row>
            <Col id="자재코드">01010101004</Col>
            <Col id="자재명">백옥쌀(용인시농협)경기미</Col>
            <Col id="규격">국내산20KG/포</Col>
            <Col id="과세코드">면세</Col>
            <Col id="구매단위">EA</Col>
            <Col id="직송">센터경유</Col>
            <Col id="단가">820.00</Col>
            <Col id="수량">1.00</Col>
            <Col id="금액">820.00</Col>
          </Row>
          <Row>
            <Col id="자재코드">01010101017</Col>
            <Col id="자재명">쌀(유창농산)경기미</Col>
            <Col id="규격">국내산20KG/포</Col>
            <Col id="과세코드">면세</Col>
            <Col id="구매단위">EA</Col>
            <Col id="직송">센터경유</Col>
            <Col id="단가">820.00</Col>
            <Col id="수량">1.00</Col>
            <Col id="금액">820.00</Col>
          </Row>
          <Row>
            <Col id="자재코드">01010101004</Col>
            <Col id="자재명">경기미(무술정미소)</Col>
            <Col id="규격">국내산20KG/포</Col>
            <Col id="과세코드">면세</Col>
            <Col id="구매단위">EA</Col>
            <Col id="직송">센터경유</Col>
            <Col id="단가">820.00</Col>
            <Col id="수량">1.00</Col>
            <Col id="금액">820.00</Col>
          </Row>
          <Row>
            <Col id="자재코드">01010101017</Col>
            <Col id="자재명">(센터직송)쌀(유창농산)경기</Col>
            <Col id="규격">국내산20KG/포</Col>
            <Col id="과세코드">면세</Col>
            <Col id="구매단위">EA</Col>
            <Col id="직송">센터경유</Col>
            <Col id="단가">820.00</Col>
            <Col id="수량">1.00</Col>
            <Col id="금액">820.00</Col>
          </Row>
          <Row>
            <Col id="자재코드">01010101020</Col>
            <Col id="자재명">(센터직송)쌀(유창농산)경기</Col>
            <Col id="규격">국내산20KG/포</Col>
            <Col id="과세코드">면세</Col>
            <Col id="구매단위">EA</Col>
            <Col id="직송">센터경유</Col>
            <Col id="단가">820.00</Col>
            <Col id="수량">1.00</Col>
            <Col id="금액">820.00</Col>
          </Row>
          <Row>
            <Col id="자재코드">01010101017</Col>
            <Col id="자재명">(센터직송)쌀(유창농산)경기</Col>
            <Col id="규격">국내산20KG/포</Col>
            <Col id="구매단위">포</Col>
            <Col id="과세코드">면세</Col>
            <Col id="직송">센터경유</Col>
            <Col id="단가">820.00</Col>
            <Col id="수량">1.00</Col>
            <Col id="금액">820.00</Col>
            <Col id="비고"/>
          </Row>
          <Row>
            <Col id="자재코드">01010101020</Col>
            <Col id="자재명">(센터직송)쌀(유창농산)경기</Col>
            <Col id="규격">국내산20KG/포</Col>
            <Col id="구매단위">포</Col>
            <Col id="과세코드">면세</Col>
            <Col id="직송">센터경유</Col>
            <Col id="단가">820.00</Col>
            <Col id="수량">1.00</Col>
            <Col id="금액">820.00</Col>
            <Col id="비고"/>
          </Row>
          <Row>
            <Col id="자재코드">01010101020</Col>
            <Col id="자재명">백옥쌀(용인시농협)경기미</Col>
            <Col id="규격">국내산20KG/포</Col>
            <Col id="구매단위">포</Col>
            <Col id="과세코드">면세</Col>
            <Col id="직송">센터경유</Col>
            <Col id="단가">840.00</Col>
            <Col id="수량">1.00</Col>
            <Col id="금액">840.00</Col>
            <Col id="비고"/>
          </Row>
          <Row>
            <Col id="자재코드">01010101004</Col>
            <Col id="자재명">경기미(무술정미소)</Col>
            <Col id="규격">국내산20KG/포</Col>
            <Col id="구매단위">EA</Col>
            <Col id="과세코드">면세</Col>
            <Col id="직송">센터경유</Col>
            <Col id="단가">840.00</Col>
            <Col id="수량">1.00</Col>
            <Col id="금액">840.00</Col>
            <Col id="비고"/>
          </Row>
          <Row>
            <Col id="자재코드">01010101017</Col>
            <Col id="자재명">(센터직송)쌀(유창농산)경기</Col>
            <Col id="규격">국내산20KG/포</Col>
            <Col id="구매단위">EA</Col>
            <Col id="과세코드">면세</Col>
            <Col id="직송">센터경유</Col>
            <Col id="단가">840.00</Col>
            <Col id="수량">1.00</Col>
            <Col id="금액">840.00</Col>
            <Col id="비고"/>
          </Row>
          <Row>
            <Col id="자재코드">01010101020</Col>
            <Col id="자재명">(센터직송)쌀(유창농산)경기</Col>
            <Col id="규격">국내산20KG/포</Col>
            <Col id="구매단위">EA</Col>
            <Col id="과세코드">면세</Col>
            <Col id="직송">센터경유</Col>
            <Col id="단가">840.00</Col>
            <Col id="수량">1.00</Col>
            <Col id="금액">840.00</Col>
            <Col id="비고"/>
          </Row>
          <Row>
            <Col id="자재코드">01010101017</Col>
            <Col id="자재명">(센터직송)쌀(유창농산)경기</Col>
            <Col id="규격">국내산20KG/포</Col>
            <Col id="구매단위">포</Col>
            <Col id="과세코드">면세</Col>
            <Col id="직송">센터경유</Col>
            <Col id="단가">840.00</Col>
            <Col id="수량">1.00</Col>
            <Col id="금액">840.00</Col>
            <Col id="비고"/>
          </Row>
          <Row>
            <Col id="자재코드">01010101020</Col>
            <Col id="자재명">(센터직송)쌀(유창농산)경기</Col>
            <Col id="규격">국내산20KG/포</Col>
            <Col id="구매단위">포</Col>
            <Col id="과세코드">면세</Col>
            <Col id="직송">센터경유</Col>
            <Col id="단가">840.00</Col>
            <Col id="수량">1.00</Col>
            <Col id="금액">840.00</Col>
            <Col id="비고"/>
          </Row>
          <Row>
            <Col id="자재코드">01010101020</Col>
            <Col id="자재명">백옥쌀(용인시농협)경기미</Col>
            <Col id="규격">국내산20KG/포</Col>
            <Col id="구매단위">포</Col>
            <Col id="과세코드">면세</Col>
            <Col id="직송">센터경유</Col>
            <Col id="단가">840.00</Col>
            <Col id="수량">1.00</Col>
            <Col id="금액">840.00</Col>
            <Col id="비고"/>
          </Row>
          <Row>
            <Col id="자재코드">01010101004</Col>
            <Col id="자재명">경기미(무술정미소)</Col>
            <Col id="규격">국내산20KG/포</Col>
            <Col id="구매단위">EA</Col>
            <Col id="과세코드">면세</Col>
            <Col id="직송">센터경유</Col>
            <Col id="단가">840.00</Col>
            <Col id="수량">1.00</Col>
            <Col id="금액">840.00</Col>
            <Col id="비고"/>
          </Row>
          <Row>
            <Col id="자재코드">01010101017</Col>
            <Col id="자재명">(센터직송)쌀(유창농산)경기</Col>
            <Col id="규격">국내산20KG/포</Col>
            <Col id="구매단위">EA</Col>
            <Col id="과세코드">면세</Col>
            <Col id="직송">센터경유</Col>
            <Col id="단가">840.00</Col>
            <Col id="수량">1.00</Col>
            <Col id="금액">840.00</Col>
            <Col id="비고"/>
          </Row>
          <Row>
            <Col id="자재코드">01010101020</Col>
            <Col id="자재명">(센터직송)쌀(유창농산)경기</Col>
            <Col id="규격">국내산20KG/포</Col>
            <Col id="구매단위">EA</Col>
            <Col id="과세코드">면세</Col>
            <Col id="직송">센터경유</Col>
            <Col id="단가">840.00</Col>
            <Col id="수량">1.00</Col>
            <Col id="금액">840.00</Col>
            <Col id="비고"/>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_subinv" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="subinvCode" type="STRING" size="256"/>
          <Column id="subinvName" type="STRING" size="256"/>
          <Column id="upjang" type="STRING" size="256"/>
          <Column id="consumYn" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_search" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" oncolumnchanged="ds_search_oncolumnchanged">
        <ColumnInfo>
          <Column id="schType" type="STRING" size="256"/>
          <Column id="schTypeNm" type="STRING" size="256"/>
          <Column id="schSabun" type="STRING" size="256"/>
          <Column id="schSubinvCode" type="STRING" size="256"/>
          <Column id="schUpjang" type="STRING" size="256"/>
          <Column id="schPrNum" type="STRING" size="256"/>
          <Column id="schApNum" type="STRING" size="256"/>
          <Column id="schPrDate" type="STRING" size="256"/>
          <Column id="schNeedDate" type="STRING" size="256"/>
          <Column id="schNeedDate2" type="STRING" size="256"/>
          <Column id="schHeadCreditYn" type="STRING" size="256"/>
          <Column id="schMainUpjang" type="STRING" size="256"/>
          <Column id="schChk" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row/>
        </Rows>
      </Dataset>
      <Dataset id="ds_searchValid" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="schType" type="STRING" size="256"/>
          <Column id="schTypeNm" type="STRING" size="256"/>
          <Column id="schSabun" type="STRING" size="256"/>
          <Column id="schSubinvCode" type="STRING" size="256"/>
          <Column id="schUpjang" type="STRING" size="256"/>
          <Column id="schPrNum" type="STRING" size="256"/>
          <Column id="schPrDate" type="STRING" size="256"/>
          <Column id="schNeedDate" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="schSabun">title:신청자사번,required:true</Col>
            <Col id="schSubinvCode">title:창고,required:true,focus:edt_subinv</Col>
            <Col id="schUpjang">title:업장,required:true,focus:edt_subinv</Col>
            <Col id="schPrDate">title:신청일자,required:true,date;true,focus:cal_prDate</Col>
            <Col id="schNeedDate">title:입고일자,required:true,date;true,focus:cal_needDate</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_days" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="dDays" type="STRING" size="256"/>
          <Column id="dTimes" type="STRING" size="256"/>
          <Column id="days" type="STRING" size="256"/>
          <Column id="dOverDays" type="STRING" size="256"/>
          <Column id="qtyControlYn" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_creYn" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="crdYn" type="STRING" size="256"/>
          <Column id="headCreditYn" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_headCre" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="headCreditYn" type="STRING" size="256"/>
          <Column id="mainUpjang" type="STRING" size="256"/>
          <Column id="upjang" type="STRING" size="256"/>
          <Column id="schNeedDate" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_needDate" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="needDate" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_creInfo" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="creditTurnDays" type="STRING" size="256"/>
          <Column id="creditTurnDaysTot" type="STRING" size="256"/>
          <Column id="creditAmount" type="STRING" size="256"/>
          <Column id="creditAmountTot" type="STRING" size="256"/>
          <Column id="creditOverAmount" type="STRING" size="256"/>
          <Column id="rmnAmt" type="STRING" size="256"/>
          <Column id="preAmt" type="STRING" size="256"/>
          <Column id="trAmt" type="STRING" size="256"/>
          <Column id="poAmt" type="STRING" size="256"/>
          <Column id="prAmt" type="STRING" size="256"/>
          <Column id="bondAmt" type="STRING" size="256"/>
          <Column id="creditRmnAmt" type="STRING" size="256"/>
          <Column id="creditAvailAmt" type="STRING" size="256"/>
          <Column id="lBillDate" type="STRING" size="256"/>
          <Column id="lBillDateDisp" type="STRING" size="256"/>
          <Column id="lastTurnCnt" type="STRING" size="256"/>
          <Column id="creditTurnControlYn" type="STRING" size="256"/>
          <Column id="creditAmountControlYn" type="STRING" size="256"/>
          <Column id="creditControlYn" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_list" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" oncolumnchanged="ds_list_oncolumnchanged" cancolumnchange="ds_list_cancolumnchange">
        <ColumnInfo>
          <Column id="itemCode" type="STRING" size="256"/>
          <Column id="itemName" type="STRING" size="256"/>
          <Column id="itemSize" type="STRING" size="256"/>
          <Column id="itemUnit" type="STRING" size="256"/>
          <Column id="marginPrice" type="STRING" size="256"/>
          <Column id="prQty" type="BIGDECIMAL" size="256"/>
          <Column id="prAmt" type="BIGDECIMAL" size="256"/>
          <Column id="subinvCode" type="STRING" size="256"/>
          <Column id="needDate" type="STRING" size="256"/>
          <Column id="prRemark" type="STRING" size="256"/>
          <Column id="unitPrice" type="STRING" size="256"/>
          <Column id="taxCode" type="STRING" size="256"/>
          <Column id="custCd" type="STRING" size="256"/>
          <Column id="approver" type="STRING" size="256"/>
          <Column id="centerFlag" type="STRING" size="256"/>
          <Column id="centerCode" type="STRING" size="256"/>
          <Column id="prDate" type="STRING" size="256"/>
          <Column id="prDeptId" type="STRING" size="256"/>
          <Column id="prUpjang" type="STRING" size="256"/>
          <Column id="acctcd" type="STRING" size="256"/>
          <Column id="budCls" type="STRING" size="256"/>
          <Column id="rcMuCd" type="STRING" size="256"/>
          <Column id="rcDeptId" type="STRING" size="256"/>
          <Column id="rcUpjang" type="STRING" size="256"/>
          <Column id="invatFlag" type="STRING" size="256"/>
          <Column id="outvatFlag" type="STRING" size="256"/>
          <Column id="minOrdQty" type="STRING" size="256"/>
          <Column id="maxOrdQty" type="STRING" size="256"/>
          <Column id="stockFlag" type="STRING" size="256"/>
          <Column id="salePrice" type="STRING" size="256"/>
          <Column id="strategyPrice" type="STRING" size="256"/>
          <Column id="planningPrice" type="STRING" size="256"/>
          <Column id="subsidyPrice" type="STRING" size="256"/>
          <Column id="opPrice" type="STRING" size="256"/>
          <Column id="multiplierQty" type="STRING" size="256"/>
          <Column id="pointFlag" type="STRING" size="256"/>
          <Column id="buddeptId" type="STRING" size="256"/>
          <Column id="dDays" type="STRING" size="256"/>
          <Column id="dTimes" type="STRING" size="256"/>
          <Column id="prId" type="STRING" size="256"/>
          <Column id="prNum" type="STRING" size="256"/>
          <Column id="approveNum" type="STRING" size="256"/>
          <Column id="poType" type="STRING" size="256"/>
          <Column id="lineStatus" type="STRING" size="256"/>
          <Column id="lineStatusNm" type="STRING" size="256"/>
          <Column id="vdSn" type="STRING" size="256"/>
          <Column id="applySd" type="STRING" size="256"/>
          <Column id="closeStatus" type="STRING" size="256"/>
          <Column id="upjangGrp" type="STRING" size="256"/>
          <Column id="error" type="STRING" size="256"/>
          <Column id="msg" type="STRING" size="256"/>
          <Column id="soStatus" type="STRING" size="256"/>
          <Column id="soStatusNm" type="STRING" size="256"/>
          <Column id="featureIcon" type="STRING" size="256"/>
          <Column id="tOrder" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_subinvInfo" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="deptId" type="STRING" size="256"/>
          <Column id="upjang" type="STRING" size="256"/>
          <Column id="materialAcctcd" type="STRING" size="256"/>
          <Column id="apUnitpriceUpjang" type="STRING" size="256"/>
          <Column id="centerCode" type="STRING" size="256"/>
          <Column id="muCd" type="STRING" size="256"/>
          <Column id="invatFlag" type="STRING" size="256"/>
          <Column id="outvatFlag" type="STRING" size="256"/>
          <Column id="stockFlag" type="STRING" size="256"/>
          <Column id="buddeptId" type="STRING" size="256"/>
          <Column id="materialBudCls" type="STRING" size="256"/>
          <Column id="prDeptId" type="STRING" size="256"/>
          <Column id="prUpjang" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_ordCtl" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="chkType" type="STRING" size="256"/>
          <Column id="ctrlType" type="STRING" size="256"/>
          <Column id="itemType" type="STRING" size="256"/>
          <Column id="mon" type="STRING" size="256"/>
          <Column id="tue" type="STRING" size="256"/>
          <Column id="wed" type="STRING" size="256"/>
          <Column id="thu" type="STRING" size="256"/>
          <Column id="fri" type="STRING" size="256"/>
          <Column id="sat" type="STRING" size="256"/>
          <Column id="sun" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_subinvInfoValid" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" onrowposchanged="ds_subinv_onrowposchanged">
        <ColumnInfo>
          <Column id="deptId" type="STRING" size="256"/>
          <Column id="upjang" type="STRING" size="256"/>
          <Column id="materialAcctcd" type="STRING" size="256"/>
          <Column id="apUnitpriceUpjang" type="STRING" size="256"/>
          <Column id="centerCode" type="STRING" size="256"/>
          <Column id="muCd" type="STRING" size="256"/>
          <Column id="invatFlag" type="STRING" size="256"/>
          <Column id="outvatFlag" type="STRING" size="256"/>
          <Column id="stockFlag" type="STRING" size="256"/>
          <Column id="buddeptId" type="STRING" size="256"/>
          <Column id="materialBudCls" type="STRING" size="256"/>
          <Column id="prDeptId" type="STRING" size="256"/>
          <Column id="prUpjang" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="upjang">title:검수업장,required:true</Col>
            <Col id="materialAcctcd">title:계정코드,required:true</Col>
            <Col id="deptId">title:검수부서,required:true</Col>
            <Col id="muCd">title:검수MU,required:true</Col>
            <Col id="buddeptId">title:예산통제부서,required:true</Col>
            <Col id="prUpjang">title:신청업장,required:true</Col>
            <Col id="prDeptId">title:신청부서,required:true</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_master" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" oncolumnchanged="ds_search_oncolumnchanged">
        <ColumnInfo>
          <Column id="schSabun" type="STRING" size="256"/>
          <Column id="schSubinvCode" type="STRING" size="256"/>
          <Column id="schPrNum" type="STRING" size="256"/>
          <Column id="schApNum" type="STRING" size="256"/>
          <Column id="schPrDate" type="STRING" size="256"/>
          <Column id="schNeedDate" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row/>
        </Rows>
      </Dataset>
      <Dataset id="ds_check" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="itemCode" type="STRING" size="256"/>
          <Column id="prQty" type="BIGDECIMAL" size="256"/>
          <Column id="needDate" type="STRING" size="256"/>
          <Column id="centerFlag" type="STRING" size="256"/>
          <Column id="centerCode" type="STRING" size="256"/>
          <Column id="vdSn" type="STRING" size="256"/>
          <Column id="applySd" type="STRING" size="256"/>
          <Column id="oldRow" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_checkRow" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="itemCode" type="STRING" size="256"/>
          <Column id="prQty" type="BIGDECIMAL" size="256"/>
          <Column id="needDate" type="STRING" size="256"/>
          <Column id="centerFlag" type="STRING" size="256"/>
          <Column id="centerCode" type="STRING" size="256"/>
          <Column id="vdSn" type="STRING" size="256"/>
          <Column id="applySd" type="STRING" size="256"/>
          <Column id="oldRow" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Script type="xscript4.0"><![CDATA[/*
  화 면 명 : SalePriceStChg
  파 일 명 : SalePriceStChg.xfdl
  기    능 : 식재영업 / 주문관리 / 주문신청

    수정일    수정자                  수정내용
  ----------   -------  --------------------------------------------------
  2015.06.08   최성연   최초 생성
  2015.07.01   최성연   창고COMBO -> 팝업 형태로 변경
  2016-01-14   최성연   버튼 재정의 (정상적으로 저장이후 저장, 삭제 버튼 비활성화)
                         기 처리된 주문건에 대한 삭제 시 현재는 PR_NUM 및 PR_ID의 값을 받아올 수 없음
  
  1) 공통 버튼 정의
  - 조회, 입력, 삭제, 저장,  닫기, 도움말 활성화
  - 엑셀업로드 버튼 추가

  2) 주요처리 사항
  - 구매유형이 "29.식자재_식재영업_NO단가"인 경우는 단가항목 EDIT 가능하게
  
  
  3) 검토사항
  가) 조건
  - 창고정보 LIST : Query 확인 필요
  - 승인자 항목 삭제
  - 신청일, 입고일 항목 비활성화

  다) 진행 순서
  - fn_searchSubinv() : 창고리스트 조회 - 사용 X
   --> fn_subinv_init() : 창고리스트 Call Back
    .-- fn_getDays() : 창고선택 시 마감일자정보 기본 SET : 사용 X
      --> fn_setDays() : 발주마감일정 정보 SET : 사용 X
        -- fn_setTimer() : 마감시간 설정
    .-- fn_getCrdYn() : 여신정보관리 여부 CHECK    
      --> fn_setCrdYn() : 여신정보관리 여부 SET
       -- fn_getHeadCrd() : 본사통합여신여부 GET (여신관리여부 = "Y")
         --> fn_setHeadCrd() : 본사통합여신정보 SET
           -- fn_getCrdNeedDate() : 최종발주일자 GET	- 사용  X
             --> fn_setCrdNeedDate() : 최종발주일자 SET - 사용 X
                -- fn_getCrdInfo() : 여신관련 정보 
    .-- fn_getSubinvInfo() : 창고기본정보 GET           
*/

/************************************************************************************************
 * 공통 라이브러리 INCLUDE 영역 (필수)
************************************************************************************************/
include "lib::lib_com.xjs";
include "U_lib::lib_conversionCom.xjs";


/************************************************************************************************
 * FORM 변수 선언 영역 (필수)
************************************************************************************************/
var fv_processCnt = 0;			//처리건수
var fv_objColInfo;				//데이터셋 컬럼정보
var fv_closeFlag = "";			//닫기 버튼 클릭 시 작업여부를 CHECK 하여 Parent 창에서
// [속도개선 Project 시작] 2017. 8. 21. 최범주 여신정보조회 함수 대체
//var fv_crdYn = "N";				//여신관리여부(Y/N)
// [속도개선 Project   끝] 2017. 8. 21. 최범주
var fv_excelFlag = false;		//엑셀업로드 여부 CHECK
var fv_flag = "";				//팝업창 작업 MODE(I/U)

// CHECK용 변수
var fv_needFlag = false;		//주문통제일 CHECK FLAG	
var fv_dateFlag = "N";			//마감통제관련 CHECK 변수(Y/N)	

// PO CHECK용 변수
var fv_errorFlag;				//에러발생 여부(Y/N)
var fv_errorMsg;				//에러발생 메시지
var fv_checkRowCnt;				//체크대상 Row Count
var fv_checkRow;				//체크대상 Row Index
var fv_row;						//체크대상 ROW ID 
var fv_custList;				//구매IF실패 거래처


/************************************************************************************************
 * FORM EVENT 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : Form Load (필수)
 *---------------------------------------------------------------------------------------------*/
function form_onload(obj:Form, e:LoadEventInfo)
{	
	// Form Load 시 공통 기능 처리(obj:Form, bCreateEvent:이벤트 생성 여부)
	gfn_formOnLoad(this);
	
	// 초기값 셋팅
	fn_init();
	
	if (fv_flag=="U") {
		// 조회
		fn_search();
	} else {
		// 창고리스트 조회
		//fn_searchSubinv();
	}
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 초기값 셋팅
 *---------------------------------------------------------------------------------------------*/
function fn_init()
{
	// Argument Dataset으로 받기
 	try {
 		//trace("P_DATASET Dataset :\n" + P_DATASET.saveXML());
		ds_search.setColumn(0, "schType", P_DATASET.getColumn(0, "schType"));
		ds_search.setColumn(0, "schTypeNm", P_DATASET.getColumn(0, "schTypeNm"));
		
		// 화면 제목 표시
		sta_title.text = ds_search.getColumn(ds_search.rowposition, "schType") + "." + ds_search.getColumn(ds_search.rowposition, "schTypeNm");

		if (P_DATASET.getColumn(0, "schFlag")=="I") {
			fv_flag = "I";
			ds_search.setColumn(0, "schSabun", P_DATASET.getColumn(0, "schSabun"));
			ds_search.setColumn(0, "schUpjang", P_DATASET.getColumn(0, "schUpjang"));
			ds_search.setColumn(0, "schPrDate", P_DATASET.getColumn(0, "schPrDate"));
			ds_search.setColumn(0, "schNeedDate", P_DATASET.getColumn(0, "schNeedDate"));
			ds_search.setColumn(0, "schPrNum", "");


			// 입고일선택
			cal_prDate.fn_initMonthCal(this, "", "", ds_search, "schPrDate", "Y");	
			cal_needDate.fn_initMonthCal(this, "", "", ds_search, "schNeedDate", "Y");	
		} else {
			fv_flag = "U";
			ds_search.setColumn(0, "schPrNum", P_DATASET.getColumn(0, "schPrNum"));
		}
 	} catch(err) {
 	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 화면 닫기 전 변경 유무 체크 (필수-Frame에서 창 닫힐때 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_close(retResult)
{	
    var retVal = new Array();
    retVal[0] = retResult;
    close(retVal);
}


/************************************************************************************************
 * 공통기능 FUNCTION 영역 (필수)
 * 선택한 신청번호 기준 SELECT
 * master DataSet으로 SET 후 ds_search로 값 전달
************************************************************************************************/
function fn_search()
{
   	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
	fv_objColInfo = gfn_getDatasetInfo (ds_master);
    
    var strSvcID    = "searchPrMaster";
    var strURL      = "fm/fmo/orderRequest/selectPrMaster.xdo";
    var strInDs     = "ds_search=ds_search:A";
    var strOutDs    = "ds_master=ds_master";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 신규 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 * 자재검색 팝업 호출
 *---------------------------------------------------------------------------------------------*/
function fn_insert()
{
	// 조회조건 기준으로 CHECK
	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;
	
	// 창고기본정보 CHECK : ds_subinvInfo Count CHECK --> IRIS 참조
	if (ds_subinvInfo.getRowCount()==0) {
		var sMsg = "단가계약업장 설정 및 센터관리업장 설정이 되어있지 않습니다.";
		gfn_alert(sMsg, "", "A");
		return;
	}
	
	// 단가계약업장 코드 CHECK : 필수 조건
	if (gfn_nvl(ds_subinvInfo.getColumn(0, "apUnitpriceUpjang"), "") == "") {
		var sMsg = "단가계약업장 설정이 되어있지 않습니다.";
		gfn_alert(sMsg, "", "A");
		return;
	}


	fn_itemAdd();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 삭제 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_delete()
{
	var nRow = ds_list.rowposition;
	var nRowCnt = ds_list.getRowCount();	// DataSet Count
	var sMsg = "";
	var iCnt = 0;
	var sCnt = 0;

	for (var i = 0 ; i < nRowCnt ; i++)
	{
 		// Dataset이 선택된 것만 적용
 		if (ds_list.getSelect(i))	
 		{
			if (ds_list.getRowType(i) == Dataset.ROWTYPE_INSERT) {
				iCnt++;
 			} else {
				sCnt++;
 			}
 		}
	}

	if(iCnt == 0)
	{
		sMsg = "삭제할 자재 정보가 없습니다.\n\n";
		sMsg = sMsg + "※ 신규 등록건만 삭제가능 합니다.";
		gfn_alert(sMsg, "", "A");
		return;
	}	
	
	if(sCnt > 0)
	{
		sMsg = "이미 처리된 주문정보는 삭제불가합니다.\n\n";
		sMsg = sMsg + "※ 신청서취소 및 반려처리 하세요";
		gfn_alert(sMsg, "", "A");
		return;
	}	
	

// 	if(nRow == -1) 
// 	{
// 		gfn_alert("msg.err.grid.noselect", "삭제할 row");	// 선택된 항목이 없습니다.
// 		return;
// 	}


// 	// 마감여부 CHECK : 사용 X
// 	if (ds_list.getColumn(nRow,"closeStatus") == "마감")
// 	{
// 		sMsg = "해당자재는 마감이 완료되어 삭제가 불가합니다.\r\r작업을 취소합니다.";
// 		gfn_alert(sMsg, "", "A");
// 		return;
// 	}


	//기존 자료인 경우 디데이 체크
// 	if (ds_list.getRowType(nRow) <> Dataset.ROWTYPE_INSERT) {
// 		if (fn_getDayStatus(ds_list.getColumn(nRow,"dDays"), ds_list.getColumn(nRow,"dTimes")) == "0")
// 		{
// 			sMsg = "해당자재는 마감시간(D-Days)이 초과되어 삭제가 불가합니다.\r\r작업을 취소합니다.";
// 			gfn_alert(sMsg, "", "A");
// 			return;
// 		}
//     }


	//기존 자료인 경우 진행상태 체크
// 	if (ds_list.getRowType(nRow) <> Dataset.ROWTYPE_INSERT) {
// 		if (ds_list.getColumn(nRow,"soStatus")=="002" || ds_list.getColumn(nRow,"soStatus")=="007")
// 		{
// 			sMsg = "진행상태가 신청확정 또는 결의승인 상태는 삭제가 불가합니다.\r\r작업을 취소합니다.";
// 			gfn_alert(sMsg, "", "A");
// 			return;
// 		}
//     }

	if(gfn_confirm("해당 자재를 삭제 하시겠습니까?")){
		//var nRowCnt = ds_list.getRowCount();	// DataSet Count
// 		for (var i = nRowCnt+1 ; i >= 0 ; i--)//삭제는 역순.
// 		{
// 			// Dataset이 선택된 것만 적용
// 			if (ds_list.getSelect(i))	
// 			{
// 				// 해당 ROW를 삭제
// 				ds_list.deleteRow(i);
// 			}
// 		}
		
		// 선택되어진 Dataset에 대한 자료 일괄 삭제
		var nSucc = ds_list.deleteSelectedRows();
		
		trace("nSucc : " + nSucc);
		
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 저장 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 * 저장 !!!!!!
 *---------------------------------------------------------------------------------------------*/
function fn_save()
{
	var nRowCnt = ds_list.getRowCount();	// DataSet Count
	var nRow = ds_search.rowposition;
	var sMsg = "";

	// 조회조건 기준으로 CHECK
	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;

	// 저장할 자료 여부 CHECK
	if(nRowCnt == 0) 
	{
		gfn_alert("msg.save.nodata", "저장할 데이터");	// 저장할 데이터가 없습니다.
		return;
	}

	 // v_ds_check 미사용시 변경사항 체크 : 엑셀업로드 시에는 CHECK X
 	if (gfn_dsIsUpdated(ds_list) == false && fv_excelFlag == false)
 	{
 		gfn_alert("msg.save.nochange");	// 변경된 내역이 없습니다.
 		return;
 	}

	//발주량 0상품 확인
	var iFindRowIdx;
	iFindRowIdx = ds_list.findRowExpr("prQty==0");
	if (iFindRowIdx >= 0)
	{
		sMsg = "주문수량이 0인 자재가 존재합니다.\r작업을 취소합니다.";
		gfn_alert(sMsg, "", "A");
		ds_list.rowposition = iFindRowIdx;
		grd_list.setFocus();
		grd_list.setCellPos(grd_list.getBindCellIndex("Body", "prQty"));
		return;
	}
	
	// 기본필수 값 CHECK
	if (! fn_validCheck()) return;
	
	// 발주가능시간 CHECK
	// 마감시간 설정
	//fn_setTimer();	
	//발주가능 체크(창고)
	if (! fn_prCheck1()) return;
	
	// 데이타체크(여신및 상품별 디데이체크)
	//var sRtn = fn_ChkData();
	
	// 구매수발주 제한 FUNCTION 호출 : 저장할 LIST 만큼 처리
	// 기획자재 한정수량, DC자재 가용수량, SPOT 발주계약 횟수  CHECK
	fn_getPoQtyCheck();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 출력 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_print()
{
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 도움말 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_help()
{
}


/************************************************************************************************
 * TRANSACTION 및 CallBack 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 트랜잭션 콜백 함수 (필수)
 *---------------------------------------------------------------------------------------------*/
function fn_callBack(strSvcID, nErrorCode, strErrorMsg)
{
	var sMsg = "";

	// 에러시 gfn_callBack에서 메시지 제공, 화면별 특정 에러 발생시에만 사용하세요.
	if (nErrorCode < 0) 
	{
		if(strSvcID=="searchPoQtyCheck")
		{
			fv_errorFlag="Y";
			fv_errorMsg = strErrorMsg;
			fn_processStep();
			return;
		}
		else 
		{
			return;
		}
	}


	
    switch(strSvcID)
    {
		// 선택한 구매신청정보 MASTER GET
		case "searchPrMaster" :
            if (ds_master.getRowCount() == 0) {
				//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
				gfn_loadDatasetInfo (ds_master, fv_objColInfo);
            }
            // 초기화
            fn_search_init();
			break;

    
		// 선택한 구매신청정보 리스트 GET
		case "searchPrDetail" :
            if (ds_list.getRowCount() == 0) {
				//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
				gfn_loadDatasetInfo (ds_list, fv_objColInfo);
            } else fn_setItem_Close();
			break;
    
    
		// 창고리스트 조회
        case "searchSubinv" :
            if (ds_subinv.getRowCount() == 0) {
				//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
				gfn_loadDatasetInfo (ds_subinv, fv_objColInfo);
            }
            // 초기화
            fn_subinv_init();
            break;
            
            
        // 마감기본일자정보 조회
		case "searchDays" :
            if (ds_days.getRowCount() == 0) {
				//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
				gfn_loadDatasetInfo (ds_days, fv_objColInfo);
            }
            // 마감정보 SET
            fn_setDays();
            break;

        // 여신관리여부 CHECK
// [속도개선 Project 시작] 2017. 8. 21. 최범주 여신정보조회 함수 대체
// 		case "searchCreYn" :
//             if (ds_creYn.getRowCount() == 0) {
// 				//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
// 				gfn_loadDatasetInfo (ds_creYn, fv_objColInfo);
//             }
//             // 여신여부 SET
//             fn_setCrdYn();
//             break;
// [속도개선 Project   끝] 2017. 8. 21. 최범주
						
		// 본사통합여신여부 조회
// [속도개선 Project 시작] 2017. 8. 21. 최범주 여신정보조회 함수 대체
// 		case "searchHeadCre" :
//             if (ds_headCre.getRowCount() == 0) {
// 				//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
// 				gfn_loadDatasetInfo (ds_headCre, fv_objColInfo);
//             }
//             // 본사통합여신여부 SET
//             fn_setHeadCrd();
// 			break;
// [속도개선 Project   끝] 2017. 8. 21. 최범주
			
		// 발주마감일자 : 여신체크용도
		case "searchNeedDate" :
            if (ds_needDate.getRowCount() == 0) {
				//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
				gfn_loadDatasetInfo (ds_needDate, fv_objColInfo);
            }
            // 발주마감일자 SET
            fn_setCrdNeedDate();
			break;
					

		// 여신정보 SELECT
// [속도개선 Project 시작] 2017. 8. 21. 최범주 여신정보조회 함수 대체
		case "searchCreInfo" :
            if (ds_creInfo.getRowCount() == 0) {
				//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
				gfn_loadDatasetInfo (ds_creInfo, fv_objColInfo);
            }

			////////////////////////////////////////////////////////////////////////////////////////////////////////
            // 여신정보 셋팅
			if ( ds_creInfo.getRowCount() > 0 ) {
				ds_search.setColumn(0, "schHeadCreditYn", ds_creInfo.getColumn(0, "headCreditYn"));
				ds_search.setColumn(0, "schMainUpjang", ds_creInfo.getColumn(0, "mainUpjang"));
				
				if ( ds_creInfo.getColumn(0, "creditAmountControlYn") == "Y" ) {
					ed_credit.value = gfn_numFormat(ds_creInfo.getColumn(0, "creditRmnAmt")) + " 원";
					ed_bond.value = gfn_numFormat(ds_creInfo.getColumn(0,"bondAmt")) + " 원";
				} else {
					ed_credit.value = "무 제 한";
				}
			} else {
				gfn_alert("업장여신정보를 확인할 수 없습니다.\n\n관리자에게 문의하십시오.", "", "A");
			}
		break;
// [속도개선 Project   끝] 2017. 8. 21. 최범주


        // 여신정보 SELECT : 저장 시
		case "searchCreInfoSave" :						
            if (ds_creInfo.getRowCount() == 0) {
				//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
				gfn_loadDatasetInfo (ds_creInfo, fv_objColInfo);
            }
            // 여신정보 SET
            fn_setCrdInfoSave();
            break;
				
				
		// 창고 기본정보 SELECT
		case "searchSubinvInfo" :				
            if (ds_subinvInfo.getRowCount() == 0) {
				//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
				gfn_loadDatasetInfo (ds_subinvInfo, fv_objColInfo);
            }
						//창고
			if(!fn_prCheck1()){
				edt_subinv.value    = "";
				edt_subinv.userdata = "";
			}
            break;
            
            
		// 주문통제일자 CHECK
		case "searchOrdCtrlDays" :
			trace("조회건수 : " + fv_processCnt);
			if (fv_processCnt > 0) fv_needFlag = true;
			else fv_needFlag = false;
			// 주문통제 다음 CHECK
			//fn_prCheck2();
			break;	

		// 주문통제정보 GET
		case "searchOrdCtrl" :
            if (ds_ordCtl.getRowCount() == 0) {
				//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
				gfn_loadDatasetInfo (ds_ordCtl, fv_objColInfo);
            }
			break;	
    
		// 주문내역 저장
        case "save" :
			trace("저장건수 : " + fv_processCnt);
			fv_closeFlag = "OK";
			if(gfn_length(fv_custList) > 0){
				fv_custList = gfn_subStr(fv_custList,0,gfn_length(fv_custList)-1);
				var arr = fv_custList.split(",");
				for(var i = 0; i < arr.length; i++){
					ds_list.filter("custCd == " + arr[i] +"");
					for(var j = 0; j < ds_list.getRowCount();j++){
						ds_list.setColumn(j,"error" , "Y");
						ds_list.setColumn(j,"msg", "구매 I/F 실패 하였습니다.관리자에게 문의 해 주세요.");
					}
					ds_list.filter("");
				}
			}
			
			if (fv_processCnt > 0) {
				sMsg = "총 " + fv_processCnt + "건의 신청자료가 저장 되었습니다.";
				gfn_alert(sMsg, "", "A");
				//fn_close(fv_closeFlag);
				btn_save.enable = false;
			} else {
				btn_save.enable = true;
			}

            break;    
            
            
		// 구매수발주 제한 CHECK
		case "searchPoQtyCheck" :
			if (fv_processCnt > 0) {	
				fv_errorFlag="";
				fv_errorMsg="";
			} 
			fn_processStep();
            break;  			
		
    }
}

/************************************************************************************************
 * 사용자 FUNCTION 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 저장 버튼 클릭 시 여신관련 CHECK 후 CalllBack 처리
 * 저장 !!!!!!
 *---------------------------------------------------------------------------------------------*/
function fn_saveProc()
{
	// 상품별 CHECK
	if (! fn_itemCheck()) return;
	
	sMsg = "주문정보를 저장합니다.\n\n계속 진행 하시겠습니까?\n";

	if (!gfn_confirm(sMsg, "", "C")) return;

	// 저장 Transaction
    var strSvcID    = "save";
    var strURL      = "fm/fmo/orderRequest/saveList.xdo";
	var strInDs     = "ds_list=ds_list:U";
    var strOutDs    = "";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 구매신청 MASTER 초기화
 *---------------------------------------------------------------------------------------------*/
function fn_search_init()
{
	if (ds_master.getRowCount() > 0) {
		ds_search.setColumn(ds_search.rowposition, "schSabun", ds_master.getColumn(0, "schSabun"));
		ds_search.setColumn(ds_search.rowposition, "schSubinvCode", ds_master.getColumn(0, "schSubinvCode"));
		ds_search.setColumn(ds_search.rowposition, "schPrNum", ds_master.getColumn(0, "schPrNum"));
		ds_search.setColumn(ds_search.rowposition, "schApNum", ds_master.getColumn(0, "schApNum"));
		ds_search.setColumn(ds_search.rowposition, "schPrDate", ds_master.getColumn(0, "schPrDate"));
		ds_search.setColumn(ds_search.rowposition, "schNeedDate", ds_master.getColumn(0, "schNeedDate"));
		
		// 입고일선택
		cal_prDate.fn_initMonthCal(this, "", "", ds_search, "schPrDate", "Y");	
		cal_needDate.fn_initMonthCal(this, "", "", ds_search, "schNeedDate", "Y");	
	}
	// 창고리스트 조회 : 단일건에 대한 창고정보 조회용도로 변경
	fn_searchSubinv();
	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 구매신청내역 조회
 *---------------------------------------------------------------------------------------------*/
function fn_searchDetail()
{
   	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
	fv_objColInfo = gfn_getDatasetInfo (ds_list);
    
    var strSvcID    = "searchPrDetail";
    var strURL      = "fm/fmo/orderRequest/selectPrDetail.xdo";
    var strInDs     = "ds_search=ds_search:A";
    var strOutDs    = "ds_list=ds_list";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}



/*----------------------------------------------------------------------------------------------
 * 설명      : 사용자에 대한 창고리스트 가져오기
 *---------------------------------------------------------------------------------------------*/
function fn_searchSubinv()
{
   	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
	fv_objColInfo = gfn_getDatasetInfo (ds_subinv);
    
    var strSvcID    = "searchSubinv";
	var strURL		= "";
	//if (fv_flag == "I")
	//	strURL      = "fm/fmo/orderRequest/selectSubinv.xdo";
	//else
		strURL      = "fm/fmo/orderRequest/selectSubinv2.xdo";
    var strInDs     = "ds_search=ds_search:A";
    var strOutDs    = "ds_subinv=ds_subinv";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 창고 팝업 선택 시 처리
 *---------------------------------------------------------------------------------------------*/
function fn_subinv_init()
{
	if (fv_flag == "U") {
		// 기본창고에 대한 업장을 조건에 복사
		ds_search.setColumn(ds_search.rowposition, "schUpjang", ds_subinv.getColumn(0, "upjang"));
		// 기본창고에 대한 COMP 표시
		edt_subinv.value    = ds_subinv.getColumn(0, "subinvName");
		edt_subinv.userdata = ds_subinv.getColumn(0, "subinvCode");
		
		// 창고팝업 비활성화 처리
		edt_subinv.enable = false;
		btn_subinv.enable = false;
		// 주문내역 조회
		fn_searchDetail();
	} else {
		// 조건 SET
		ds_search.setColumn(ds_search.rowposition, "schSubinvCode", ds_subinv.getColumn(0, "subinvCode"));
		// 기본창고에 대한 업장을 조건에 복사
		ds_search.setColumn(ds_search.rowposition, "schUpjang", ds_subinv.getColumn(0, "upjang"));
	}
	//trace("schUpjang : " + ds_search.getColumn(0, "schUpjang"));
	
	// 창고기본값 선택 시 : 발주마감일자 GET
	fn_getDays();
	// 주문통제정보 조회 
	fn_getOrdCtrl();
	
// [속도개선 Project 시작] 2017. 8. 21. 최범주 여신정보조회 함수 대체
	// 창고기본값 선택 시 : 여신관리여부 SET
// 	fn_getCrdYn();
	fn_getCrdInfo();  // 여신정보를 조회한다.
// [속도개선 Project   끝] 2017. 8. 21. 최범주
	// 창고기본값 선택 시 : 창고기본정보(부서,업장,계정 등)
	fn_getSubinvInfo();
}



/*----------------------------------------------------------------------------------------------
 * 설명      : 선택한 창고에 대한 D-DAY 표시
 * 사용 X - 제외
 *---------------------------------------------------------------------------------------------*/
function fn_getDays()
{
	// 조건 SET
	ds_search.setColumn(ds_search.rowposition, "schUpjang", ds_subinv.getColumn(ds_subinv.rowposition, "upjang"));
	
	// CHECK : 창고, 신청일자, 입고일자
	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;

   	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
	fv_objColInfo = gfn_getDatasetInfo (ds_days);
    
    var strSvcID    = "searchDays";
    var strURL      = "fm/fmo/orderRequest/selectDays.xdo";
    var strInDs     = "ds_search=ds_search:A";
    var strOutDs    = "ds_days=ds_days";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 선택한 창고에 대한 D-DAY 표시
 * 사용 X
 *---------------------------------------------------------------------------------------------*/
function fn_setDays()
{
	if (ds_days.getRowCount() > 0) {
		st_Days.text = "(발주 마감 : " + ds_days.getColumn(0,"days") + ")";
	} else {
		st_Days.text = "(발주 마감 : 확인불가)";
		g_Message("EE","발주마감정보를 확인할 수 없습니다.!" + "\n\n" + "관리자에게 문의하세요.");
		return;
	}
	// 마감시간 설정
	fn_setTimer();	
	// 주문통제정보 조회
	fn_getOrdCtrl();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 마감시간 관련 정보 표시
 * fn_getDays() 이후에 호출
 *---------------------------------------------------------------------------------------------*/
function fn_setTimer()
{
	fsp_init(this);			// 고도화관련 Frame 관련 SET

	fn_CurrDateWeek();
	
	var sChkDate, sDay, sTime;
	var sNeesDate = ds_search.getColumn(ds_search.rowposition, "schNeedDate");		// 입고일자

	trace("#----- fn_setTimer  -----#");
	trace("dTimes : " + ds_days.getColumn(0,"dTimes"));
	trace("ymd_tm : " + gfn_subStr(gds_currdate.getColumn(0, "YMD_TM"),8,4));

	if ( gfn_subStr(gds_currdate.getColumn(0, "YMD_TM"),8,4)>= gfn_trim(ds_days.getColumn(0,"dTimes")) )
	{
		sChkDate = gfn_addDate(sNeesDate, (-1 * (toNumber(gfn_trim(ds_days.getColumn(0,"dDays"))) + 1)));	
		sTime = G_fn_GapTime("1", gfn_subStr(gds_currdate.getColumn(0, "YMD_TM"),8,4), toNumber(gfn_trim(ds_days.getColumn(0,"dTimes"))), "");	
	}
	else
	{
		sChkDate = gfn_addDate(sNeesDate, (-1 * toNumber(gfn_trim(ds_days.getColumn(0,"dDays")))));
		trace("sChkDate : " + sChkDate);
		sTime = G_fn_GapTime("0", gfn_subStr(gds_currdate.getColumn(0, "YMD_TM"),8,4), gfn_trim(ds_days.getColumn(0,"dTimes")), "");
		trace("sTime : " + sTime);
	}
	
	if (parseInt(gds_currdate.getColumn(0, "YMD")) <= parseInt(sChkDate))
		sDay = G_fn_CalcDay(gds_currdate.getColumn(0, "YMD"), sChkDate);		
	else
		sDay = G_fn_CalcDay(sChkDate, gds_currdate.getColumn(0, "YMD")) * (-1);		
	
	if ((toNumber(sDay) >= 0) && (toNumber(sDay) < 10)) sDay = "0" + sDay;	
	st_Timer.text = "마감시간 : " + sDay + "일 " + gfn_left(sTime,2)+ "시간 " + gfn_right(sTime,2)+ "분 전";
	
	st_Week.text = "(" + ffn_DayToWeek(sNeesDate) + ")";
	if (st_Week.text == "(토)")
		st_Week.style.color = "blue";
	else if (st_Week.text == "(일)")
		st_Week.style.color = "red";
	else
		st_Week.style.color = "black";
		
	//fa_sDay = sDay;	
	//trace("sDay : " + sDay);
	if (toNumber(sDay) < 0) fv_dateFlag = "Y";
	else fv_dateFlag = "N";
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 마감시간에 따른 내역 마감표시
 * fn_setTimer() 이후에 호출
 *---------------------------------------------------------------------------------------------*/
function fn_setItem_Close()
{
	var nRowCnt = ds_list.getRowCount();	// DataSet Count

	if (fv_dateFlag == "N") return;

	for (var i = 0 ; i < nRowCnt ; i++)
	{	
		ds_list.setColumn(i, "closeStatus", "마감");
	}

}

/*----------------------------------------------------------------------------------------------
 * 설명      : 선택한 창고(사업장)의 여신관리여부 CHECK
 *---------------------------------------------------------------------------------------------*/
// [속도개선 Project 시작] 2017. 8. 21. 최범주 여신정보조회 함수 대체
// function fn_getCrdYn()
// {
// 	// 여신관리 여부 CHECK 초기화
// 	fv_crdYn = "N";
// 
//    	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
// 	fv_objColInfo = gfn_getDatasetInfo (ds_creYn);
//     
//     // 여신관리 여부 CHECK
//     var strSvcID    = "searchCreYn";
//     var strURL      = "fm/fmo/orderRequest/selectCreYn.xdo";
//     var strInDs     = "ds_search=ds_search:A";
//     var strOutDs    = "ds_creYn=ds_creYn";
//     var strArg      = "";
//     var strCallback = "fn_callBack";
//     var bAsync      = true;
//     
//     gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
// }
// [속도개선 Project   끝] 2017. 8. 21. 최범주

/*----------------------------------------------------------------------------------------------
 * 설명      : 선택한 창고(사업장)의 여신관리여부 CHECK SET
 *---------------------------------------------------------------------------------------------*/
// [속도개선 Project 시작] 2017. 8. 21. 최범주 여신정보조회 함수 대체
// function fn_setCrdYn()
// {
// 	// 여신관리여부
// 	if (ds_creYn.getRowCount() == 0) {
// 		ed_credit.value = "무 제 한";
// 		return;
// 	} else {
// 		//return;		// 속도문제로 일단 PASS : FMS_TRANSACTION_V
// 		fn_getHeadCrd();	// 본사통합여신여부 조회	
// 	}
// 	
// }
// [속도개선 Project   끝] 2017. 8. 21. 최범주


/*----------------------------------------------------------------------------------------------
 * 설명      : 본사통합 여신여부를 조회한다
 *---------------------------------------------------------------------------------------------*/
// [속도개선 Project 시작] 2017. 8. 21. 최범주 여신정보조회 함수 대체
// function fn_getHeadCrd()
// {
//    	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
// 	fv_objColInfo = gfn_getDatasetInfo (ds_headCre);
//     
//     // 여신정보 조회
//     var strSvcID    = "searchHeadCre";
//     var strURL      = "fm/fmo/orderRequest/selectHeadCre.xdo";
//     var strInDs     = "ds_search=ds_search:A";
//     var strOutDs    = "ds_headCre=ds_headCre";
//     var strArg      = "";
//     var strCallback = "fn_callBack";
//     var bAsync      = true;
//     
//     gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
// }
// [속도개선 Project   끝] 2017. 8. 21. 최범주

/*----------------------------------------------------------------------------------------------
 * 설명      : 본사통합 여신여부를 SET
 *---------------------------------------------------------------------------------------------*/
// [속도개선 Project 시작] 2017. 8. 21. 최범주 여신정보조회 함수 대체
// function fn_setHeadCrd()
// {
// 	// 본사통합여신 여부 SET
// 	if (ds_headCre.getRowCount() > 0) {
// 		// 조건 SET
// 		ds_search.setColumn(ds_search.rowposition, "schHeadCreditYn", ds_headCre.getColumn(ds_headCre.rowposition, "headCreditYn"));
// 		ds_search.setColumn(ds_search.rowposition, "schMainUpjang", ds_headCre.getColumn(ds_headCre.rowposition, "mainUpjang"));
// 	
// 		// 발주일자 SET : 본사통합여부에 따라 분기(Query) -- 사용 X
// 		//fn_getCrdNeedDate();
// 		
// 		// 여신정보 GET  : 저장 시에만 호출하도록 변경, 조회 시에는 제외
// 		//fn_getCrdInfo();
// 		
// 	} else {
// 		// Error 표시
// 	}
// 	
// }
// [속도개선 Project   끝] 2017. 8. 21. 최범주

/*----------------------------------------------------------------------------------------------
 * 설명      : 최종발주일자 조회 - 여신체크 용도
 *---------------------------------------------------------------------------------------------*/
function fn_getCrdNeedDate()
{
   	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
	fv_objColInfo = gfn_getDatasetInfo (ds_needDate);
    
    // 여신정보 조회
    var strSvcID    = "searchNeedDate";
    var strURL      = "fm/fmo/orderRequest/selectNeedDate.xdo";
    var strInDs     = "ds_headCre=ds_headCre:A";
    var strOutDs    = "ds_needDate=ds_needDate";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 최종발주일자를 SET - 여신체크 용도
 *---------------------------------------------------------------------------------------------*/
function fn_setCrdNeedDate()
{
	// 발주일자 SET
	if (ds_needDate.getRowCount() > 0) {
		trace("발주일자 : " + ds_needDate.getColumn(0, "needDate"));
	} else {
		// 없으면, 조건(ds_search) 입고일자를 SET
		ds_needDate.clearData();
		ds_needDate.addRow();
		ds_needDate.setColumn(ds_needDate.rowposition, "needDate", ds_search.getColumn(ds_search.rowposition, "schNeedDate"));
	}
	// 조건 SET
	ds_search.setColumn(ds_search.rowposition, "schNeedDate2", ds_needDate.getColumn(ds_needDate.rowposition, "needDate"));
	
	// 여신정보 GET
	//fn_getCrdInfo();
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 여신관리여부가 "Y"인 경우는 여신정보를 조회한다
 * fn_setCrdYn 에서 여신관리 시 fn_getHeadCrd -> fn_getCrdNeedDate -> fn_getCrdInfo
 *---------------------------------------------------------------------------------------------*/
function fn_getCrdInfo()
{
// [속도개선 Project 시작] 2017. 8. 21. 최범주 여신정보조회 함수 대체
	ds_creInfo.clearData();
// [속도개선 Project   끝] 2017. 8. 21. 최범주
   	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
	fv_objColInfo = gfn_getDatasetInfo (ds_creInfo);
    
    // 여신정보 조회
    var strSvcID    = "searchCreInfo";
    var strURL      = "fm/fmo/orderRequest/selectCreInfo.xdo";
    var strInDs     = "ds_search=ds_search:A";
    var strOutDs    = "ds_creInfo=ds_creInfo";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 여신정보를 조회한다
 *---------------------------------------------------------------------------------------------*/
// [속도개선 Project 시작] 2017. 8. 21. 최범주 여신정보조회 함수 대체
// function fn_setCrdInfo()
// {
// 	trace(ds_creInfo.saveXML());
// 	
// 	//여신 표시
// 	if (ds_creInfo.getRowCount() > 0) {
// 		if (ds_creInfo.getColumn(ds_creInfo.rowposition,"creditAmountControlYn") == "Y") {
// 			ed_credit.value = gfn_numFormat(ds_creInfo.getColumn(ds_creInfo.rowposition,"creditRmnAmt"))+ " 원";
// 			ed_bond.value = gfn_numFormat(ds_creInfo.getColumn(ds_creInfo.rowposition,"bondAmt"))+ " 원";
// 		} else {
// 			ed_credit.value = "무 제 한";
// 		}
// 	} else {
// 		var sMsg = "업장여신정보를 확인할 수 없습니다.\n\n";
// 		sMsg = sMsg + "관리자에게 문의하세요.";
// 		gfn_alert(sMsg, "", "A");
// 		return;
// 	}
// 	
// }
// [속도개선 Project   끝] 2017. 8. 21. 최범주

/*----------------------------------------------------------------------------------------------
 * 설명      : 선택한 창고에 대한 창고기본정보를 가져온다
 * 부서, 업장, MU 등
 *---------------------------------------------------------------------------------------------*/
function fn_getSubinvInfo()
{
   	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
	fv_objColInfo = gfn_getDatasetInfo (ds_subinvInfo);
    
    // 창고 기본정보 조회
    var strSvcID    = "searchSubinvInfo";
    var strURL      = "fm/fmo/orderRequest/selectSubinvInfo.xdo";
    var strInDs     = "ds_search=ds_search:A";
    var strOutDs    = "ds_subinvInfo=ds_subinvInfo";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 자재 추가 팝업 호출
 *---------------------------------------------------------------------------------------------*/
function fn_itemAdd()
{
	// 팝업창을 호출한다
	var strId       = "OrderRequestItemSearchPop";
	var strURL      = "X_FMO::OrderRequestItemSearchPop.xfdl";
	var objArgument = {
		P_DATASET : ds_search
	};
	
	var nWidth      = 1200;
	var nHeight     = 695;
	var strStyle    = "";
	var nLeft       = -1;
	var nTop        = -1;
	var isModeless  = false;
	var bShowTitle  = true;
	var strAlign    = "-1";
	
	// 리턴값을 배열로 받을 경우	
 	var arrRtn = gfn_dialog(strId, strURL, objArgument, nWidth, nHeight, strStyle, nLeft, nTop, isModeless, bShowTitle, strAlign, true);
 	
 	//trace("arrRtn : " + arrRtn);

 	if (arrRtn instanceof Object)
 	{
// 		// 자재코드 추가 관련 Dataset Clear
// 		ds_searchItem.clearData();
// 		ds_searchItem.addRow();	
// 		// DataSet SET
// 		ds_searchItem.setColumn(ds_searchItem.rowposition, "schCenter", arrRtn["centerCode"]);		
// 		ds_searchItem.setColumn(ds_searchItem.rowposition, "schUpjang", arrRtn["upjang"]);		
// 		ds_searchItem.setColumn(ds_searchItem.rowposition, "schDate", arrRtn["stdDate"]);		
// 		ds_searchItem.setColumn(ds_searchItem.rowposition, "schCust", arrRtn["custCd"]);		
// 		ds_searchItem.setColumn(ds_searchItem.rowposition, "schItemCode", arrRtn["itemCode"]);		
// 		ds_searchItem.setColumn(ds_searchItem.rowposition, "schContractStart", arrRtn["contractStart"]);	
// 		ds_searchItem.setColumn(ds_searchItem.rowposition, "schPdate", v_Pdate);	// 전략이익율 기준일자 SET	
// 			
// 		fn_itemSet();	
			
 	}

// 	// 리턴값을  Dataset으로 받을 경우
//  	var dsRtn = new Dataset();
//  	var dsObj = gfn_dialog(strId, strURL, objArgument, nWidth, nHeight, strStyle, nLeft, nTop, isModeless, bShowTitle, strAlign);
//  
//  	dsRtn.copyData(dsObj);
//  	
//  	if(dsRtn.rowcount > 0) {
//  		trace(dsRtn.saveXML());
//  	}

}


/*----------------------------------------------------------------------------------------------
 * 설명      : 자재 추가 팝업에서 전달되어진 Dataset
 *---------------------------------------------------------------------------------------------*/
function fn_itemRerutn(dsObj)
{
	// 구매유형 GET
	var v_type = ds_search.getColumn(ds_search.rowposition, "schType");

	if(dsObj != null)
	{
		btn_save.enable = true;
	
		for(var i=0; i<dsObj.rowcount; i++)
		{	
			//trace("itemCode : " + i + " : " + dsObj.getColumn(i, "itemCode"));
		
			ds_list.addRow();
			ds_list.setColumn(ds_list.rowposition, "itemCode", dsObj.getColumn(i, "itemCode"));	
			ds_list.setColumn(ds_list.rowposition, "itemName", dsObj.getColumn(i, "itemName"));	
			ds_list.setColumn(ds_list.rowposition, "itemSize", dsObj.getColumn(i, "itemSize"));	
			ds_list.setColumn(ds_list.rowposition, "itemUnit", dsObj.getColumn(i, "itemUnit"));	
			ds_list.setColumn(ds_list.rowposition, "marginPrice", dsObj.getColumn(i, "marginPrice"));	
			ds_list.setColumn(ds_list.rowposition, "unitPrice", dsObj.getColumn(i, "unitPrice"));	
			ds_list.setColumn(ds_list.rowposition, "taxCode", dsObj.getColumn(i, "taxCode"));
			ds_list.setColumn(ds_list.rowposition, "centerFlag", dsObj.getColumn(i, "centerFlag"));
			ds_list.setColumn(ds_list.rowposition, "custCd", dsObj.getColumn(i, "custCd"));
			ds_list.setColumn(ds_list.rowposition, "centerCode", dsObj.getColumn(i, "centerCode"));
			ds_list.setColumn(ds_list.rowposition, "minOrdQty", dsObj.getColumn(i, "minOrdQty"));
			ds_list.setColumn(ds_list.rowposition, "maxOrdQty", dsObj.getColumn(i, "maxOrdQty"));
			ds_list.setColumn(ds_list.rowposition, "salePrice", dsObj.getColumn(i, "salePrice"));
			ds_list.setColumn(ds_list.rowposition, "strategyPrice", dsObj.getColumn(i, "strategyPrice"));
			ds_list.setColumn(ds_list.rowposition, "planningPrice", dsObj.getColumn(i, "planningPrice"));
			ds_list.setColumn(ds_list.rowposition, "subsidyPrice", dsObj.getColumn(i, "subsidyPrice"));
			ds_list.setColumn(ds_list.rowposition, "opPrice", dsObj.getColumn(i, "opPrice"));
			ds_list.setColumn(ds_list.rowposition, "multiplierQty", dsObj.getColumn(i, "multiplierQty"));
			ds_list.setColumn(ds_list.rowposition, "pointFlag", dsObj.getColumn(i, "pointFlag"));
			ds_list.setColumn(ds_list.rowposition, "dDays", dsObj.getColumn(i, "dDays"));
			ds_list.setColumn(ds_list.rowposition, "dTimes", dsObj.getColumn(i, "dTimes"));
			ds_list.setColumn(ds_list.rowposition, "vdSn", dsObj.getColumn(i, "vdSn"));
			ds_list.setColumn(ds_list.rowposition, "applySd", dsObj.getColumn(i, "applySd"));
			ds_list.setColumn(ds_list.rowposition, "prQty", dsObj.getColumn(i, "prQty"));
			ds_list.setColumn(ds_list.rowposition, "poType", v_type);
			ds_list.setColumn(ds_list.rowposition, "lineStatus", "002");						// LINE_STATUS(002)를 SET	
			ds_list.setColumn(ds_list.rowposition, "soStatus", "999");							// PO_STATUS(001:신청저장)를 SET	
			ds_list.setColumn(ds_list.rowposition, "soStatusNm", "신청저장");					// PO_STATUS(001:신청저장)를 SET	
			ds_list.setColumn(ds_list.rowposition, "upjangGrp", dsObj.getColumn(i, "upjangGrp"));	// 업장군
			ds_list.setColumn(ds_list.rowposition, "featureIcon", dsObj.getColumn(i, "featureIcon"));	// Icon
			ds_list.setColumn(ds_list.rowposition, "error", "");
			ds_list.setColumn(ds_list.rowposition, "msg", "");
		}
	}

}

/*----------------------------------------------------------------------------------------------
 * 설명      : 수량, 단가 변경 시 금액 자동계산
 *---------------------------------------------------------------------------------------------*/
function fn_calcAmt(row)
{
	var v_qty = 0.00; 	// 수량
	var v_price = 0;	// 단가
	var v_amt = 0;		// 금액
	
	v_qty = ds_list.getColumn(row, "prQty");
	v_price = ds_list.getColumn(row, "salePrice");

	v_amt = v_qty * v_price;
	
	return v_amt;
} 


/*----------------------------------------------------------------------------------------------
 * 설명      : 주문신청관련 필수 입력필드 및 value SET
 *---------------------------------------------------------------------------------------------*/
function fn_validCheck()
{
	var nRowCnt = ds_list.getRowCount();	// DataSet Count


	// 신청업장, 부서, MU 로그인정보 SET
	//ds_subinvInfo.setColumn(ds_subinvInfo.rowposition, "prMuCd", g_Mu_Cd); 
	ds_subinvInfo.setColumn(ds_subinvInfo.rowposition, "prDeptId", g_Deptid); 
	ds_subinvInfo.setColumn(ds_subinvInfo.rowposition, "prUpjang", g_Upjang); 

	// 신청업장, 부서, MU
	// 검수업장, 부서, MU
	// 조건 기준으로 CHECK
	if (gfn_validCheck(ds_subinvInfo, ds_subinvInfoValid, true) == false) return false;


	for (var i = 0 ; i < nRowCnt ; i++)
	{
		if (ds_list.getRowType(i)==Dataset.ROWTYPE_INSERT || ds_list.getRowType(i)==Dataset.ROWTYPE_UPDATE) 
		{
			//ds_list.setColumn(i, "prMuCd", ds_subinvInfo.getColumn(ds_subinvInfo.rowposition, "prMuCd"));				// 신청_MU
			ds_list.setColumn(i, "prDeptId", ds_subinvInfo.getColumn(ds_subinvInfo.rowposition, "prDeptId"));			// 신청_DEPT_ID
			ds_list.setColumn(i, "prUpjang", ds_subinvInfo.getColumn(ds_subinvInfo.rowposition, "prUpjang"));			// 신청_업장
			ds_list.setColumn(i, "rcMuCd", ds_subinvInfo.getColumn(ds_subinvInfo.rowposition, "muCd"));					// 검수_MU
			ds_list.setColumn(i, "rcDeptId", ds_subinvInfo.getColumn(ds_subinvInfo.rowposition, "deptId"));				// 검수_DEPT_ID
			ds_list.setColumn(i, "rcUpjang", ds_subinvInfo.getColumn(ds_subinvInfo.rowposition, "upjang"));				// 검수_업장	
			ds_list.setColumn(i, "invatFlag", ds_subinvInfo.getColumn(ds_subinvInfo.rowposition, "invatFlag"));			// 의제 매입 여부	
			ds_list.setColumn(i, "outvatFlag", ds_subinvInfo.getColumn(ds_subinvInfo.rowposition, "outvatFlag"));		// 불공제 매입 여부	
			ds_list.setColumn(i, "acctcd", ds_subinvInfo.getColumn(ds_subinvInfo.rowposition, "materialAcctcd"));		// 계정코드
			ds_list.setColumn(i, "buddeptId", ds_subinvInfo.getColumn(ds_subinvInfo.rowposition, "buddeptId"));			// 예산부서
			
			
			// 조건Dataset 관련 LIST SET : ds_search 관련
			ds_list.setColumn(i, "subinvCode", ds_search.getColumn(ds_search.rowposition, "schSubinvCode"));		// SUBINV_CODE 를 SET	
			ds_list.setColumn(i, "needDate", ds_search.getColumn(ds_search.rowposition, "schNeedDate"));			// NEED_DATE 를 SET	
			ds_list.setColumn(i, "prNum", gfn_nvl(ds_search.getColumn(ds_search.rowposition, "schPrNum"),""));		// PR NUM 를 SET	
			ds_list.setColumn(i, "prDate", gfn_nvl(ds_search.getColumn(ds_search.rowposition, "schPrDate"),""));	// PR DATE 를 SET	
			ds_list.setColumn(i, "approveNum", gfn_nvl(ds_search.getColumn(ds_search.rowposition, "schApNum"),""));	// AP NUM 를 SET	
			ds_list.setColumn(i, "poType", ds_search.getColumn(ds_search.rowposition, "schType"));					// PO TYPE 를 SET	
			//ds_list.setColumn(i, "lineStatus", "001");						// LINE_STATUS(001:신청저장)를 SET	
			//ds_list.setColumn(i, "lineStatusNm", "신청저장");				// LINE_STATUS(001:신청저장)를 SET	
		}
	}	
	
	return true;
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 발주가능 CHECK  == 1 STEP 
 * 변경 : 2015-12-23, 창고주문통제요일 공통 추가
 *---------------------------------------------------------------------------------------------*/
function fn_prCheck1()
{
	var sMsg = "";
	if (ds_search.getColumn(0,"schType") == "29" || ds_search.getColumn(0,"schType") == "97") {//긴급이면 PASS
		return true;
	}
	// 창고기본값 선택 시 : 발주마감일자 GET
	// 마감시간 설정 : fn_setTimer() 포함
	fn_getDays();

	// 주문통제일자 호출
	fn_getNeedDate(false);
	
	// 주문통제일자 CHECK
	if (fv_needFlag) {
		sMsg = "일자별통제가 되었습니다.\r작업을 취소합니다.";
		gfn_alert(sMsg, "", "A");
		return false;
	}

	var sNeedDate = ds_search.getColumn(ds_search.rowposition, "schNeedDate");
	
	//발주통제일자
 	if (toNumber(ds_days.getColumn(0,"dOverDays")) > 0)
 	{
 		if (sNeedDate > gfn_addDate(gds_currdate.getColumn(0, "YMD"),toNumber(ds_days.getColumn(0,"dOverDays"))))
 		{
 			sMsg = ds_days.getColumn(0,"dOverDays") + " 일을 초과하여 입고예정일을 지정할 수 없습니다.\r작업을 취소합니다.";
 			gfn_alert(sMsg, "", "A");
 			return false;
 		}
 	}
	
	//발주제한일자
 	if (toNumber(ds_days.getColumn(0,"dDays")) > 0)
 	{
 		if (sNeedDate < gfn_addDate(gds_currdate.getColumn(0, "YMD"),toNumber(ds_days.getColumn(0,"dDays"))))
 		{
 			sMsg = "발주마감은 " + ds_days.getColumn(0,"days") + " 입니다.\r작업을 취소합니다.";
 			gfn_alert(sMsg, "", "A");
 			return false;
 		}
		// 창고마감시간 체크 제외 : 2015-11-26, HLDC_PO_SUBINVENTORY의 D_DAYS, D_TIMES 체크, selectDays(HQML)
//  		if (sNeedDate == gfn_addDate(gds_currdate.getColumn(0, "YMD"),toNumber(ds_days.getColumn(0,"dDays"))))
//  		{
//  			if (gfn_subStr(gds_currdate.getColumn(0, "YMD_TM"),8,6)> ds_days.getColumn(0,"dTimes"))
//  			{
//  				sMsg = "발주마감은 " + ds_days.getColumn(0,"days") + " 입니다.\r작업을 취소합니다.";
//  				gfn_alert(sMsg, "", "A");
//  				return false;
//  			}
//  		}
 	}
	
	//창고가 식재 또는 소모품, 공통 전용창고인 경우 주문통제 점검
	trace(ds_subinv.getColumn(ds_subinv.rowposition,"consumYn"));
	trace(ds_ordCtl.getRowCount());
	trace(ds_subinv.getRowCount());
	// 소모품(consumYn == 'Y'),  식자재(consumYn == 'N'), 공통(consumYn == NULL) : 2015-12-23
	if (!gfn_isNull(ds_subinv.getColumn(ds_subinv.rowposition,"consumYn")))
	{
		//주문통제(주문일자)
		var nRow;
		
		nRow = ds_ordCtl.findRowExpr("ctrlType=='주문'&&itemType==decode('" + ds_subinv.getColumn(ds_subinv.rowposition,"consumYn") + "','Y','소모품','식자재')");
		trace("nRow 1  : " + nRow);
		if (nRow >= 0)
		{
			if (ds_ordCtl.getColumn(nRow,ToLower(gds_currdate.getColumn(0, "WEEK_ENG"))) == "Y")
			{
				sMsg = gds_currdate.getColumn(0, "WEEK_KOR") + "요일은 주문불가 요일입니다.\r작업을 취소합니다.";
				gfn_alert(sMsg, "", "A");
				return false;
			}
		}
		//주문통제(입고일자)
		nRow = ds_ordCtl.findRowExpr("ctrlType=='입고'&&itemType==decode('" + ds_subinv.getColumn(ds_subinv.rowposition,"consumYn") + "','Y','소모품','식자재')");
		trace("nRow 2  : " + nRow);
		if (nRow >= 0)
		{
			if (ds_ordCtl.getColumn(nRow,ToLower(ffn_DayToWeek(sNeedDate,"1"))) == "Y")
			{
				sMsg = ffn_DayToWeek(sNeedDate) + "요일은 입고불가 요일입니다.\r입고예정일을 변경하세요.";
				gfn_alert(sMsg, "", "A");
				return false;
			}
		}
	} else {
		// 공통창고인 경우
		//주문통제(주문일자)
		var nRow;
		
		nRow = ds_ordCtl.findRowExpr("ctrlType=='주문'&&itemType=='공통'");
		trace("nRow 3  : " + nRow);
		if (nRow >= 0)
		{
			if (ds_ordCtl.getColumn(nRow,ToLower(gds_currdate.getColumn(0, "WEEK_ENG"))) == "Y")
			{
				sMsg = gds_currdate.getColumn(0, "WEEK_KOR") + "요일은 주문불가 요일입니다.\r작업을 취소합니다.";
				gfn_alert(sMsg, "", "A");
				return false;
			}
		}
		//주문통제(입고일자)
		nRow = ds_ordCtl.findRowExpr("ctrlType=='입고'&&itemType=='공통'");
		trace("nRow 2  : " + nRow);
		if (nRow >= 0)
		{
			if (ds_ordCtl.getColumn(nRow,ToLower(ffn_DayToWeek(sNeedDate,"1"))) == "Y")
			{
				sMsg = ffn_DayToWeek(sNeedDate) + "요일은 입고불가 요일입니다.\r입고예정일을 변경하세요.";
				gfn_alert(sMsg, "", "A");
				return false;
			}
		}
	}
	
	
	return true;
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 구매 수발주 제한, 신청수량 관련 CHECK
 * 오류 표시가 있는 경우 다음 로직을 실행하지 않음, 에러 메시지 표시
 *---------------------------------------------------------------------------------------------*/
function fn_getPoQtyCheck()
{
	var nRowCnt = ds_list.getRowCount();	// DataSet Count
	var iCnt = 0;
	var iRow = 0;

	// 체크할 Dataset Clear
	ds_check.clearData();

	// 체크 대상 개수 
	for (var i = 0 ; i < nRowCnt ; i++)
	{
		// 삭제된 행은 제외
		if (ds_list.getRowType(i) <> Dataset.ROWTYPE_DELETE) {
	
			iCnt++;
			
			// 결과를 ds_list로 복사
			ds_check.addRow();
			iRow = ds_check.rowposition;
			
			// 항목별 복사
			ds_check.setColumn(iRow, "itemCode", ds_list.getColumn(i, "itemCode"));
			ds_check.setColumn(iRow, "prQty", ds_list.getColumn(i, "prQty"));
			ds_check.setColumn(iRow, "needDate", ds_list.getColumn(i, "needDate"));
			ds_check.setColumn(iRow, "centerFlag", ds_list.getColumn(i, "centerFlag"));
			ds_check.setColumn(iRow, "centerCode", ds_list.getColumn(i, "centerCode"));
			ds_check.setColumn(iRow, "vdSn", ds_list.getColumn(i, "vdSn"));
			ds_check.setColumn(iRow, "applySd", ds_list.getColumn(i, "applySd"));
			// transaction 처리 후 ds_list의 row 위치를 지정
			ds_check.setColumn(iRow, "oldRow", i);
		}
	}
		
	// 체크 대상 ROW
	fv_checkRowCnt = iCnt;

	if(fv_checkRowCnt>0)
	{
		// progress bar 초기 set
		pbr_status.max = fv_checkRowCnt;
		pbr_status.step = 1;
	
		// 최초 process 실행 호출
		fv_checkRow = 0;
		fn_process(fv_checkRow);
	}
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 구매 체크 로직 처리, 1 Row 씩 처리
 * arg : 처리 Index(row id)
 *---------------------------------------------------------------------------------------------*/
function fn_process(arg)
{
	// 최초 실행 시 첫번째 Row
	if (arg=="") arg = 0;

	// 선택 Row 가 최대 Row보다 클 경우 종료
	if ((arg+1) > fv_checkRowCnt) {
		// 여신정보 관련 CHECK 호출
		//gfn_alert("msg.action.success");	// 처리 되었습니다.
		fn_processReturn();
		return;
	}

	trace("arg : " + arg);
	
	// checkRow Dataset Clear
	ds_checkRow.clearData();
	
	// checkRow Dataset 에 복사 
	var iIdx = ds_checkRow.addRow();
	
	ds_checkRow.copyRow(iIdx, ds_check, arg);		
	// Find Row Value 지정	
	fv_row = ds_check.getColumn(arg, "oldRow");

    // 구매수발주 체크
    var strSvcID    = "searchPoQtyCheck";
    var strURL      = "fm/fmo/orderRequest/selectPoQtyCheck.xdo";
    var strInDs     = "ds_checkRow=ds_checkRow:A";
    var strOutDs    = "";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
	
	gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}


/*----------------------------------------------------------------------------------------------
 * 설명      : Callback 후 작업진행 여부 CHECK 및 프로세스 호출
 *---------------------------------------------------------------------------------------------*/
function fn_processStep()
{
	if(fv_errorFlag=="Y")
	{
		// ERROR 발생 시 결과 표시 후 중단
		fn_error();
	}

	var msg = "";
	
	//trace("fv_errorFlag : " + fv_errorFlag);

	// 해당 ROW POSITION 위치 : 최종 ROW
	ds_list.rowposition = fv_row;
	
	// Progress Bar SET
	pbr_status.text = "구매 기획자재,DC자재,SPOT발주 체크 ("+(fv_checkRow+1)+"/"+ fv_checkRowCnt+")";
	
	
	pbr_status.pos = fv_checkRow+1;
	pbr_status.stepIt();
	this.updateWindow(); // 이 부분 추가
	//trace("iRow : " + iRow);

	//다음 Transaction 처리 실행
	fv_checkRow++;
		
	trace("fv_checkRow : " + fv_checkRow); 
	fn_process(fv_checkRow);
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 구매 수발주제한 체크, 시스템오류 발생 시 오류메시지 저장
 *---------------------------------------------------------------------------------------------*/
function fn_error()
{
	//Error 메시지 출력
	ds_list.setColumn(fv_row, "error", "Y");
	ds_list.setColumn(fv_row, "msg", fv_errorMsg);		// 오류메시지 표시
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 구매 수발주제한 체크 작업 종료 후 여신체크 할지 선택
 *---------------------------------------------------------------------------------------------*/
function fn_processReturn()
{
	var nRowCnt = ds_list.getRowCount();	// DataSet Count
	var iCnt = 0;
	
	// 오류 개수 CHECK
	for (var i = 0 ; i < nRowCnt ; i++)
	{
		if (ds_list.getColumn(i, "error") == "Y") iCnt++;
	}

	// 오류가 있으면 메시지 표시, 없으면 여신한도 체크 호출
	if (iCnt > 0) {
		// 에러표시 후 작업중단 창 표시
		var sMsg = "구매 주문신청 수량 관련 오류가 발생했습니다.\n\n";
		sMsg = sMsg + "  오류 메시지를 확인한 후 재 작업하세요";
		gfn_alert(sMsg, "", "A");
		return;
	}

// [속도개선 Project 시작] 2017. 8. 21. 최범주 여신정보조회 함수 대체
	if ( ds_creInfo.getRowCount() == 0 ) {
		gfn_alert("업장여신정보를 확인할 수 없습니다.\n\n관리자에게 문의하십시오.", "", "A");
		return;
	} else {
		// 여신통제를 하지 않을 경우
		if ( ds_creInfo.getColumn(0, "creditControlYn") == "N" ) {
			fn_saveProc();        // 정상적인 Save 호출
		} else {
			fn_getCrdInfoSave();  // 여신관련 CHECK 호출
		}
	}
// 	// 여신체크가 필요없으면 바로 저장 처리 : 2015-10-05
// 	if (ds_creYn.getRowCount() == 0) {
// 		// 정상적인 Save 호출
// 		fn_saveProc();
// 	} else {
// 		// 여신관련 CHECK 호출 
// 		fn_getCrdInfoSave();	
// 	}
// [속도개선 Project   끝] 2017. 8. 21. 최범주
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 여신정보 조회 (저장용)
 * fn_getCrdInfo 동일
 *---------------------------------------------------------------------------------------------*/
function fn_getCrdInfoSave()
{
   	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
	fv_objColInfo = gfn_getDatasetInfo (ds_creInfo);
    
    // 여신정보 조회
    var strSvcID    = "searchCreInfoSave";
    var strURL      = "fm/fmo/orderRequest/selectCreInfo.xdo";
    var strInDs     = "ds_search=ds_search:A";
    var strOutDs    = "ds_creInfo=ds_creInfo";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 여신정보를 조회한다 (저장용)
 * fn_setCrdInfo 동일
 *---------------------------------------------------------------------------------------------*/
function fn_setCrdInfoSave()
{
	trace(ds_creInfo.saveXML());
	
	//여신 표시
	if (ds_creInfo.getRowCount() > 0) {
		if (ds_creInfo.getColumn(ds_creInfo.rowposition,"creditAmountControlYn") == "Y") {
			ed_credit.value = gfn_numFormat(ds_creInfo.getColumn(ds_creInfo.rowposition,"creditRmnAmt"))+ " 원";
			ed_bond.value = gfn_numFormat(ds_creInfo.getColumn(ds_creInfo.rowposition,"bondAmt"))+ " 원";
		} else {
			ed_credit.value = "무 제 한";
		}
	} else {
		var sMsg = "업장여신정보를 확인할 수 없습니다.\n\n";
		sMsg = sMsg + "관리자에게 문의하세요.";
		gfn_alert(sMsg, "", "A");
		return;
	}

	// 여신한도관련 CHECK :  저장 호출
	fn_crdCheck();
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 여신한도 관련 CHECK
 *---------------------------------------------------------------------------------------------*/
function fn_crdCheck()
{
	var sMsg = "";
	
	if (ds_creInfo.rowcount > 0)
	{
		//여신금액
		if (ds_creInfo.getColumn(0,"creditAmountControlYn") == "Y")
		{
			var nAmt = 0;
			for (i = 0; i < ds_list.getRowCount(); i++)
				nAmt += Math.round(ds_list.getColumn(i,"prAmt") * iif(ds_list.getColumn(i,"taxCode")=="100",1.1,1));
				
				//alert("주문금액 : " + nAmt);
				//alert("주문가능금액 : " + toNumber(ds_creInfo.getColumn(0,"creditAvailAmt")));
			if (nAmt > toNumber(ds_creInfo.getColumn(0,"creditAvailAmt")))
			{
				sMsg = "주문가능한 여신한도를 초과하여 주문이 불가합니다.\n\n";
				sMsg = sMsg + " - 여신한도 : " + gfn_numFormat(ds_creInfo.getColumn(0,"creditAvailAmt")) + "\n";
				sMsg = sMsg + " - 주문금액(합계) : " + gfn_numFormat(nAmt) + "\n";
				gfn_alert(sMsg, "", "A");
				return;
			}
		}
		//여신회전일
		if (ds_creInfo.getColumn(0,"creditTurnControlYn") == "Y")
		{
			if (toNumber(ds_creInfo.getColumn(0,"lastTurnCnt")) >= 0)
			{
				if (toNumber(ds_creInfo.getColumn(0,"lastTurnCnt")) > toNumber(ds_creInfo.getColumn(0,"creditTurnDaysTot")))
				{
					sMsg = gfn_getFormat(ds_creInfo.getColumn(0,"lBillDate"), "@@@@-@@-@@")  + "에 매출채권이 존재하여 주문이 불가합니다.";
					gfn_alert(sMsg, "", "A");
					return;
				}
			}
		}
	}
	
	// 정상적인 Save 호출
	fn_saveProc();
}





/*----------------------------------------------------------------------------------------------
 * 설명      : 자재별 저장 관련 CHECK
 *---------------------------------------------------------------------------------------------*/
function fn_itemCheck()
{
	var nRowCnt = ds_list.getRowCount();	// DataSet Count
	var v_itemCode = "";
	var sMsg = "";
	
	for (var i = 0 ; i < nRowCnt ; i++)
	{
		if (ds_list.getRowType(i)==Dataset.ROWTYPE_INSERT || ds_list.getRowType(i)==Dataset.ROWTYPE_UPDATE) 
		{
			// 통제가 없는 자재는 제외
			if ( gfn_nvl(ds_list.getColumn(i,"dDays"), "0")== "0" ) continue;


			// 긴급(29)일 경우에는 PASS
			if (ds_list.getColumn(i,"poType") == "07" ) {
				// D-DAY, D_TIME CHECK
				if (fn_getDayStatus(ds_list.getColumn(i,"dDays"), ds_list.getColumn(i,"dTimes")) == "0")
				{
					ds_list.rowposition = i;
					sMsg = "[" + ds_list.getColumn(i,"itemName") + "] 자재는 마감시간(D-Days)을 초과하여 주문이 불가합니다.";
					gfn_alert(sMsg, "", "A");
					return false;
				}
			}
			/* 2015-10-22 PM
			if (ds_list.getColumn(i,"poType") == "29" ) {
				// D-DAY, D_TIME CHECK
				if (fn_getDayStatus(ds_list.getColumn(i,"dDays"), "00") == "0")
				{
					ds_list.rowposition = i;
					sMsg = "[" + ds_list.getColumn(i,"itemName") + "] 자재는 마감시간(D-Days)을 초과하여 주문이 불가합니다.";
					gfn_alert(sMsg, "", "A");
					return false;
				}
			}
			*/
		}
	
		// 동일한 상품에 대한 최대발주량 CHECK
// 		if ((ds_list.getColumn(i,"maxOrdQty") > 0) && ( ds_list.getCaseSum("itemCode=='"+ds_list.getColumn(i,"itemCode")+"'&& (lineStatus <> '005' && lineStatus <> '003') && DOCU_SOURCE <> '01 BO'","PR_QTY") > ds_list.getColumn(i,"maxOrdQty")))  
// 		{   
//        	    ds_list.rowposition = i;
// 			sMsg = "[" + ds_list.getColumn(i,"itemName") + "] 자재는 최대 발주량" + ds_list.getColumn(i,"maxOrdQty") + ")를 초과하여 주문이 불가합니다.";
// 			gfn_alert(sMsg, "", "A");
// 			return false;
// 		}		
	}	

	return true;

}


/*----------------------------------------------------------------------------------------------
 * 설명      : 상품별 D-DAY CHECK FUNCTION
 *---------------------------------------------------------------------------------------------*/
function fn_getDayStatus(nDdays, nDtimes)
{
	var sNeedDate = ds_search.getColumn(ds_search.rowposition, "schNeedDate");		// 입고일자
	
	if (gfn_length(nDtimes)==2) nDtimes = nDtimes + "00";

	trace("nDdays : " + nDdays);
	trace("nDtimes : " +nDtimes);
	trace("test : " + gfn_addDate(gds_currdate.getColumn(0,"YMD"),nDdays)); 
	//무통제면 패스...
	if (gfn_nvl(nDdays, "0")== "0" ) return "2";
	//디데이체크
	if (gfn_addDate(gds_currdate.getColumn(0,"YMD"),nDdays) > sNeedDate )
		return "0";
	else if ( gfn_addDate(gds_currdate.getColumn(0,"YMD"),nDdays) == sNeedDate )
	{
		
		if ( nDtimes == "0000" ) return "2";
		//디타임체크
		if ( gfn_subStr(gds_currdate.getColumn(0, "YMD_TM"),8,4)> nDtimes )
			return "0";
		else if ( G_fn_GapTime(0, gfn_subStr(gds_currdate.getColumn(0, "YMD_TM"),8,4), nDtimes, "") <= "0030" )
			return "1";
		else
			return "2";
	}
	else
		return "2";
}




/*----------------------------------------------------------------------------------------------
 * 설명      : 주문통제일자 CHECK GET, FMP_ORD_CTRL_DAYS
 * 관련함수  : fn_prCheck에서 호출
 *---------------------------------------------------------------------------------------------*/
function fn_getNeedDate(bAsync)
{
	fv_needFlag = false;

    // 주문통제 CHECK
    var strSvcID    = "searchOrdCtrlDays";
    var strURL      = "fm/fmo/orderRequest/selectOrdCtrlDays.xdo";
    var strInDs     = "ds_search=ds_search:A";
    var strOutDs    = "";
    var strArg      = "";
    var strCallback = "fn_callBack";
    //var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 선택한 업장에 대한 주문통제 정보 표시
 * FMP_ORD_CTRL : 통제요일 CHECK, 2015-12-23 
 *---------------------------------------------------------------------------------------------*/
function fn_getOrdCtrl()
{
   	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
	fv_objColInfo = gfn_getDatasetInfo (ds_ordCtl);


    // 주문통제 정보 GET
    var strSvcID    = "searchOrdCtrl";
    var strURL      = "fm/fmo/orderRequest/selectOrdCtrl.xdo";
    var strInDs     = "ds_search=ds_search:A";
    var strOutDs    = "ds_ordCtl=ds_ordCtl";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}


/*----------------------------------------------------------------------------------------------
 * 설명      : Return할 Array 생성 및 창 닫기
 *---------------------------------------------------------------------------------------------*/
function fn_return()
{
	var arrRtn = gfn_setPopupArray(ds_list);
	this.close(arrRtn);	
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 진행상태에 따른 COLOR 표시
 * 신청확정, 결의승인 = blue   신청취소, 결의반려 = red
 *---------------------------------------------------------------------------------------------*/
function fn_statusColor(row)
{
	var v_color = "";
	 
	if (ds_list.getColumn(row, "soStatus")=="002" || ds_list.getColumn(row, "soStatus")=="007") {
		v_color = "blue";
	} else if (ds_list.getColumn(row, "soStatus")=="003" || ds_list.getColumn(row, "soStatus")=="005" || ds_list.getColumn(row, "soStatus")=="PD") {
		v_color = "red";
	} else 	{
		v_color = "";
	}

	return v_color;
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 진행상태에 따른 수량 Edit 여부 표시
 * 신청확정, 결의승인 = edit 불가   그외 = edit 가능
 *---------------------------------------------------------------------------------------------*/
function fn_statusQty(row)
{
	var v_edit = "";
	 
	//if (ds_list.getColumn(row, "soStatus")=="002" || ds_list.getColumn(row, "soStatus")=="007") {
	if (ds_list.getRowType(row) == Dataset.ROWTYPE_INSERT) {
		v_edit = "masknumber";
	} else 	{
		v_edit = "none";
	}

	return v_edit;
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 진행상태에 따른 단가 Edit 여부 표시
 * 신청확정, 결의승인 = edit 불가   NO_단가일 경우 = edit 가능
 *---------------------------------------------------------------------------------------------*/
function fn_statusPrice(row)
{
	var v_edit = "";
	 
	//if (ds_list.getColumn(row, "soStatus")=="002" || ds_list.getColumn(row, "soStatus")=="007") {
	if (ds_list.getRowType(row) == Dataset.ROWTYPE_INSERT) {
		if ( ds_list.getColumn(row, "poType") == "29" || ds_list.getColumn(row, "poType") == "97" ) v_edit = "masknumber";
		else v_edit = "none";
	} else 	{
		v_edit = "none";
	}

	return v_edit;
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 진행상태에 따른 비고 Edit 여부 표시
 * 신청확정, 결의승인 = edit 불가   그외 = edit 가능
 *---------------------------------------------------------------------------------------------*/
function fn_statusRem(row)
{
	var v_edit = "";
	 
	//if (ds_list.getColumn(row, "soStatus")=="002" || ds_list.getColumn(row, "soStatus")=="007") {
	if (ds_list.getRowType(row) == Dataset.ROWTYPE_INSERT) {
		v_edit = "text";
	} else 	{
		v_edit = "none";
	}

	return v_edit;
}



/*----------------------------------------------------------------------------------------------
 * 설명      : 창고정보에 대한 팝업화면 호출
 * 
 *---------------------------------------------------------------------------------------------*/
function fn_subinvPop()
{
	// 본인관리 창고만 조회 CHECK
	if(chk1.value) ds_search.setColumn(ds_search.rowposition, "schChk", "1");		// CHECK_1
	else ds_search.setColumn(ds_search.rowposition, "schChk", "");		


	// 팝업창을 호출한다	
	var strId       = "OrderRequestSubinvPop";
	var strURL      = "X_FMO::OrderRequestSubinvPop.xfdl";
	var objArgument = {
		P_DATASET : ds_search
	};
	
	var nWidth      = 513;
	var nHeight     = 495;
	var strStyle    = "";
	var nLeft       = -1;
	var nTop        = -1;
	var isModeless  = false;
	var bShowTitle  = true;
	var strAlign    = "-1";
	
	// 리턴값을 배열로 받을 경우	
	var arrRtn = gfn_dialog(strId, strURL, objArgument, nWidth, nHeight, strStyle, nLeft, nTop, isModeless, bShowTitle, strAlign);
	
	if (arrRtn instanceof Object)
	{
		// 선택한 창고를 대입
		edt_subinv.value    = arrRtn["subinvName"];
		edt_subinv.userdata = arrRtn["subinvCode"];
		
		ds_subinv.clearData();
		ds_subinv.addRow();
		ds_subinv.setColumn(0, "subinvCode", arrRtn["subinvCode"]);
		ds_subinv.setColumn(0, "subinvName", arrRtn["subinvName"]);
		ds_subinv.setColumn(0, "upjang", arrRtn["upjang"]);
		ds_subinv.setColumn(0, "consumYn", arrRtn["consumYn"]);
		
		// 창고선택 시 호출
		fn_subinv_init();
	}

}


/*----------------------------------------------------------------------------------------------
 * 설명      : Edit 관련 이벤트 실제 처리
 *---------------------------------------------------------------------------------------------*/
function fn_Trigger_edBtn(obj)
{
	switch(obj)
	{
		// 창고
		case edt_subinv:
			ds_search.setColumn(ds_search.rowposition, "schSubinvCode", "");	// 창고코드
			ds_search.setColumn(ds_search.rowposition, "schUpjang", "");		// 업장
			break;
	
		default:

			break;
	}
}


/************************************************************************************************
 * 각 COMPONENT 별 EVENT 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 창고리스트 DataSet 변경 시
 *---------------------------------------------------------------------------------------------*/
function ds_subinv_onrowposchanged(obj:Dataset, e:DSRowPosChangeEventInfo)
{
	//fn_subinv_change();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 닫기버튼 클릭
 *---------------------------------------------------------------------------------------------*/
function btn_close_onclick(obj:Button,  e:ClickEventInfo)
{
 	var sMsg = "저장되지 않은 정보가 있습니다.\n\n계속 진행 하시겠습니까?";
// 
// 	// v_ds_check 미사용시 변경사항 체크
 	if (gfn_dsIsUpdated(ds_list) == true) 
 	{
 		if (!gfn_confirm(sMsg, "", "C")) return;
 	}


	fn_close(fv_closeFlag);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : ds_list 변경 시 이벤트 처리
 *---------------------------------------------------------------------------------------------*/
function ds_list_oncolumnchanged(obj:Dataset, e:DSColChangeEventInfo)
{
	var v_amt;
	
    switch(e.columnid)
    {
		case "prQty" :			// 수량
			v_amt = fn_calcAmt(e.row);
			ds_list.setColumn(e.row, "prAmt", v_amt); 
			break;

		case "salePrice" :	// 단가
			v_amt = fn_calcAmt(e.row);
			ds_list.setColumn(e.row, "prAmt", v_amt); 
			break;
	}	

	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : ds_search 변경 시 이벤트 처리
 *---------------------------------------------------------------------------------------------*/
function ds_search_oncolumnchanged(obj:Dataset, e:DSColChangeEventInfo)
{
    switch(e.columnid)
    {
		case "schSubinvCode" :			// 창고
			ds_list.clearData();
			break;

	}	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : ds_list 변경 전 이벤트 처리
 *---------------------------------------------------------------------------------------------*/
function ds_list_cancolumnchange(obj:Dataset, e:DSColChangeEventInfo)
{
	var sMsg = "";
	
    switch(e.columnid)
    {
		case "prQty" :			// 수량
			//(-)발주여부
			if ( toNumber(e.newvalue) < 0 )
			{
				sMsg = "(-)발주는 불가합니다.";
				gfn_alert(sMsg, "", "A");
				obj.setColumn(e.row, "prQty", e.oldvalue);
				return false;
			}
			fsp_init(this);			// 고도화관련 Frame 관련 SET
			// 발주마감체크
			fn_CurrDateWeek();
			
			// 긴급(29)일 경우에는 PASS
			if (obj.getColumn(e.row,"poType") == "07") {
				if (fn_getDayStatus(obj.getColumn(e.row,"dDays"), obj.getColumn(e.row,"dTimes")) == "0")
				{
					sMsg = obj.getColumn(e.row,"itemName")+"해당 자재는 마감시간(D-Days)이 초과되어 수정이 불가합니다.";
					gfn_alert(sMsg, "", "A");
					return false;
				}
			}
			
			//수량통제 안하는 업장의 경우 소숫점발주가 Y이면 무조건 최소발주량/발주승수량을 무조건 0.1로 세팅하여 조회
			if ( toNumber(e.newvalue) > 0 )
			{
				/*
				//최소발주량 체크
				if ( (toNumber(obj.getColumn(e.row,"minOrdQty")) > 0) && (toNumber(obj.getColumn(e.row,"minOrdQty")) > toNumber(e.newvalue)) )
				{
					sMsg = "해당 자재는 최소발주량이 " + obj.getColumn(e.row,"minOrdQty") + " 입니다.";
					gfn_alert(sMsg, "", "A");
					return false;
				}
				*/
				//최대발주량 체크
				if (obj.getColumn(e.row,"poType") == "07") {
					
					if ( (toNumber(obj.getColumn(e.row,"maxOrdQty")) > 0) && (toNumber(obj.getColumn(e.row,"maxOrdQty")) < toNumber(e.newvalue)) )
					{
						sMsg = obj.getColumn(e.row,"itemName")+"해당 자재는 최대발주량이 " + obj.getColumn(e.row,"maxOrdQty") + " 입니다.";
						gfn_alert(sMsg, "", "A");
						return false;
					}
				}
				//소숫점발주여부
				/*
				if ( (obj.getColumn(e.row,"pointFlag") != "Y") && (Math.ceil(toNumber(e.newvalue)) != toNumber(e.newvalue)) )
				{
					sMsg = "해당 자재는 소숫점 발주가 불가합니다.";
					gfn_alert(sMsg, "", "A");
					return false;
				}
				*/
				//발주승수량	2015-09-21 제거
				/*
				if ( (toNumber(obj.getColumn(e.row,"multiplierQty")) > 0) && ((Math.round(toNumber(e.newvalue) * 1000) % Math.round(toNumber(obj.getColumn(e.row,"multiplierQty")) * 1000)) <> 0) )
				{
					sMsg = "해당 자재는 발주승수량이 " + obj.getColumn(e.row,"multiplierQty") + " 입니다.";
					gfn_alert(sMsg, "", "A");
					return false;
				}
				*/
			}
			break;
	}	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 창고 검색 팝업 이벤트
 *              
 *---------------------------------------------------------------------------------------------*/
function btn_subinv_onclick(obj:Button,  e:ClickEventInfo)
{
	fn_subinvPop();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 창고 검색 팝업관련 KEY 이벤트 처리
 *              
 *---------------------------------------------------------------------------------------------*/
function edt_subinv_onkeydown(obj:Edit, e:KeyEventInfo)
{
	// Del Key의 경우 삭제
	if (e.keycode == 46) fn_Trigger_edBtn(obj);
	
	// Enter 키
	if(e.keycode == 13) 
	{	
		if (ds_subinv.getRowCount() > 0 )
			fn_insert();
		else
			fn_subinvPop();
	}		
}]]></Script>
  </Form>
</FDL>
