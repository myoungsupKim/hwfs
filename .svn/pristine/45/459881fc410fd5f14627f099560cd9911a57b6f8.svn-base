<?xml version="1.0" encoding="utf-8"?>
<Script type="xscript4.0"><![CDATA[/*================================================================================
 *  프로그램 설명 : MA 관련 공통 스크립트 
 *  작성일자 : 2007/11/28
 *  버전 : 1.0
 *  변경 이력 
    일자            작성자          비고
    ------------------------------------------------------------
    2007/11/28    조은영     최초 작성 
================================================================================*/
/*===============================================================================
*   상수 선언 
================================================================================*/

/*===============================================================================
*   메소드 선언 
================================================================================*/
/*
 ******************************************************************************************
 * 함  수  명   : mfn_openAcctWin
 * 입      력   : sAcctClass = 계정코드 그룹 
                  pGubun = 조회 범위 ( 1 : 세세절까지 조회 , 2 : 절만 조회 )
                  sGubun = 화면에서 현재 입력한 값 구분 
                           1 - 절 코드 
                           2 - 절 명칭
                           3 - 세세절 코드 
                           4 - 세세절 명 
                  sWord = 구분에 따른 입력 값 
                  ( sGubun 과 sWord가 존재할 경우 Popup이 Open됨과 동시에 조회 처리를 한다.  )
 * 반      환   :  배열로 
                   0 - 절 코드 
                   1 - 절 명칭 
                   2 - 세세절 코드 ( 세세절 조회 안할 경우 "") 
                   3 - 세세절 명 ( 세세절 조회 안할 경우 "" )
 * 기      능   : 계정 코드 조회 화면 Open 
 * 작  성  자   : 조은영
 * 작성  일자   : 2007-11-28
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
*/
function mfn_openAcctWin(sAcctClass, pGubun, sGubun, sWord) {
    if ( pGubun == null || pGubun < 0 || gfn_length(pGubun)== 0 ) {
        pGubun = "1";
    }
    
    var arg = "p_gubun=" + wrapQuote(pGubun) + " p_class=" + wrapQuote( sAcctClass);
    arg += " p_sGubun=" + wrapQuote(sGubun) + " p_sWord=" + wrapQuote(sWord);
	var arr = gfn_openPopup("U_MAP::MAP30010P.xml",true, -1, -1, arg);
    return arr; 
}
/*
 ******************************************************************************************
 * 함  수  명   : mfn_searchScenario
 * 입      력   : dsName = 데이터셋 이름
                  callFncNm = callback 함수 명 ( 옵션 )
 * 반      환   :  없음.
 * 기      능   : 시나리오 정보 조회 
 * 작  성  자   : 조은영
 * 작성  일자   : 2007-12-05
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
*/
var MF_TEMP = null;
function mfn_searchScenario(dsName, callFncNm, mstCd, dsMstName) {
    _fn_searchScenario( "ma/mac:MAC_SCENARIO_REG_S001", 
        dsName, callFncNm, mstCd, dsMstName);
}
function mfn_searchScenario2(dsName, callFncNm, mstCd, dsMstName) {
    _fn_searchScenario( "ma/mac:MAC_SCENARIO_REG_S002", 
        dsName, callFncNm, mstCd, dsMstName);
}
function mfn_searchScenario3(dsName, callFncNm, mstCd, dsMstName) {
    _fn_searchScenario( "ma/mac:MAC_SCENARIO_REG_S003", 
        dsName, callFncNm, mstCd, dsMstName);
}
function _fn_searchScenario(sqlId, dsName, callFncNm, mstCd, dsMstName) {
    // 시나리오 정보 조회 
    fsp_init(this);
    fsp_addSearch(this, sqlId);
    MF_TEMP = callFncNm;
    
    var outDs = dsName + "=ds_out";
    if ( sqlId == "ma/mac:MAC_SCENARIO_REG_S001" ) {    //id가 틀림. 
        outDs = dsName + "=ds_sceout";
    }
    var arg = "";
    if ( gfn_length( mstCd )> 0 ) {
        fsp_addSearch(this, "ma/mac:MAC_CD_DTL_S001");	 // 상세코드 조회 
        arg = "MST_CD=" + wrapQuote( mstCd);
        outDs += " " + dsMstName + "=ds_cd_out";
    }
    
    fsp_callService(this, "", "", "", outDs, arg, "_fn_afterInit", null, true);
}
function _fn_afterInit(errCode, errMsg) {
    if ( gfn_length( MF_TEMP )> 0 ) {
        eval(MF_TEMP + "(errCode, errMsg)");
    }
}
/*
 ******************************************************************************************
 * 함  수  명   : frm_InitSearchDS
 * 입      력   : sAcctClass = 계정코드 그룹 
                  pGubun = 조회 범위 ( 1 : 세세절까지 조회 , 2 : 절만 조회 )
                  sGubun = 화면에서 현재 입력한 값 구분 
                           1 - 절 코드 
                           2 - 절 명칭
                           3 - 세세절 코드 
                           4 - 세세절 명 
                  sWord = 구분에 따른 입력 값 
                  ( sGubun 과 sWord가 존재할 경우 Popup이 Open됨과 동시에 조회 처리를 한다.  )
 * 반      환   :  배열로 
                   0 - 절 코드 
                   1 - 절 명칭 
                   2 - 세세절 코드 ( 세세절 조회 안할 경우 "") 
                   3 - 세세절 명 ( 세세절 조회 안할 경우 "" )
 * 기      능   : 계정 코드 조회 화면 Open 
 * 작  성  자   : 황승한
 * 작성  일자   : 2007-11-28
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
*/
function frm_InitSearchDS(objInDs, objOutDs, F_ArrCol, F_ArrColType, str_WhereCol, str_WhereColValue, str_SearchActionInfo, str_CallbackFn)
{

 	objInDs.clear();
	
	for (i=0;i<gfn_length(F_ArrCol);i++){
	    //alert(F_ArrCol[i]);
		objInDs.addColumn(F_ArrCol[i],F_ArrColType[i],256);			
	}

	
	objInDs.addRow();
	objInDs.setColumn(0, str_WhereCol, str_WhereColValue);
	
	// action 정보 초기화 
    fsp_clear(this);  
	
    // 서버에서 조회할 정보 추가 
	fsp_addSearch(this, str_SearchActionInfo);
	
	// 서버 호출 
	http.Sync = true;
	fsp_callService(this, "", "", "ds_cond=" + objInDs.name, objOutDs.name + "=ds_list","",str_CallbackFn);	
	http.Sync = false;
	//Combo DATASET Composition#########################	  	
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_GetIsACCTCD_DATE_Save
 * 입      력   : sAcctClass = 계정코드 그룹 
                  pGubun = 조회 범위 ( 1 : 세세절까지 조회 , 2 : 절만 조회 )
                  sGubun = 화면에서 현재 입력한 값 구분 
                           1 - 절 코드 
                           2 - 절 명칭
                           3 - 세세절 코드 
                           4 - 세세절 명 
                  sWord = 구분에 따른 입력 값 
                  ( sGubun 과 sWord가 존재할 경우 Popup이 Open됨과 동시에 조회 처리를 한다.  )
 * 반      환   :  배열로 
                   0 - 절 코드 
                   1 - 절 명칭 
                   2 - 세세절 코드 ( 세세절 조회 안할 경우 "") 
                   3 - 세세절 명 ( 세세절 조회 안할 경우 "" )
 * 기      능   : 계정 코드 조회 화면 Open 
 * 작  성  자   : 황승한
 * 작성  일자   : 2007-11-28
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
*/
function fn_GetIsACCTCD_DATE_Save(objOutDs, str_ACCTCD, str_DATE_STD)
{

    objOutDs.clear();
    objOutDs.addColumn("ACCTCD_DATE","STRING",256);	
    
	// action 정보 초기화 
    fsp_clear(this);  
	
    // 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "ma/mac:GetIsACCTCD_DATE_Save");
	
	//alert(str_ACCTCD);
	//alert(str_DATE_STD);
	// 서버 호출 
	http.Sync = true;
	fsp_callService(this, "", "", "", objOutDs.name + "=ds_list","ACCTCD=" + wrapQuote(str_ACCTCD) +" DATE_STD=" + wrapQuote(str_DATE_STD),"");	
	http.Sync = false;
	
	//alert(objOutDs.GetColumn(objOutDs.row, "ACCTCD_DATE") );
	if (objOutDs.getColumn(objOutDs.rowposition, "ACCTCD_DATE") == "Y"){
	
		return true;
	}
	else {
	
		return false;
	}
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_GetAditemConst
 * 입      력   : sAcctClass = 계정코드 그룹 
                  pGubun = 조회 범위 ( 1 : 세세절까지 조회 , 2 : 절만 조회 )
                  sGubun = 화면에서 현재 입력한 값 구분 
                           1 - 절 코드 
                           2 - 절 명칭
                           3 - 세세절 코드 
                           4 - 세세절 명 
                  sWord = 구분에 따른 입력 값 
                  ( sGubun 과 sWord가 존재할 경우 Popup이 Open됨과 동시에 조회 처리를 한다.  )
 * 반      환   :  배열로 
                   0 - 절 코드 
                   1 - 절 명칭 
                   2 - 세세절 코드 ( 세세절 조회 안할 경우 "") 
                   3 - 세세절 명 ( 세세절 조회 안할 경우 "" )
 * 기      능   : 계정 코드 조회 화면 Open 
 * 작  성  자   : 황승한
 * 작성  일자   : 2007-11-28
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
*/
function fn_GetAditemConst(str_AditemCode)
{
    var F_ArrCol          = new Array(-1);
    						    
    if (str_AditemCode =="002") {
		
		F_ArrCol = [];
		F_ArrCol[0] = strMAQuery_Vat_AdvCustAll;
		F_ArrCol[1] = strMAQuery_Vat_AdvCustAllKeyField;
		F_ArrCol[2] = strMAQuery_Vat_AdvCustAllValueField;		
		F_ArrCol[3] = strMAQuery_Vat_AdvCustAllKeyFieldNM;		
		F_ArrCol[4] = strMAQuery_Vat_AdvCustAllValueFieldNM;		
		F_ArrCol[5] = strMAQuery_Vat_AdvCustAllCaption;		
		    
        return   F_ArrCol;
    }
    else if (str_AditemCode =="009") {

		F_ArrCol = [];
		F_ArrCol[0] = strMAQuery_CARD;
		F_ArrCol[1] = strMAQuery_CARDKeyField;
		F_ArrCol[2] = strMAQuery_CARDValueField;		
		F_ArrCol[3] = strMAQuery_CARDKeyFieldNM;		
		F_ArrCol[4] = strMAQuery_CARDValueFieldNM;		
		F_ArrCol[5] = strMAQuery_CARDCaption;		
		    
        return   F_ArrCol;
    }
    else if (str_AditemCode =="010") {

		F_ArrCol = [];
		F_ArrCol[0] = strMAQuery_SABUN;
		F_ArrCol[1] = strMAQuery_SABUNKeyField;
		F_ArrCol[2] = strMAQuery_SABUNValueField;		
		F_ArrCol[3] = strMAQuery_SABUNKeyFieldNM;		
		F_ArrCol[4] = strMAQuery_SABUNValueFieldNM;		
		F_ArrCol[5] = strMAQuery_SABUNCaption;		
		    
        return   F_ArrCol;   
    }
    else if (str_AditemCode =="017") {
		
		F_ArrCol = [];
		F_ArrCol[0] = "기간";
		
		return   F_ArrCol; 
    }
    else if (str_AditemCode =="021") {

		F_ArrCol = [];
		F_ArrCol[0] = "발생일자";   
		     
		return   F_ArrCol; 
    }
    else if (str_AditemCode =="033") {
    
		F_ArrCol = [];
		F_ArrCol[0] = strMAQuery_GwaGubunCost;
		F_ArrCol[1] = strMAQuery_GwaGubunCostKeyField;
		F_ArrCol[2] = strMAQuery_GwaGubunCostValueField;		
		F_ArrCol[3] = strMAQuery_GwaGubunCostKeyFieldNM;		
		F_ArrCol[4] = strMAQuery_GwaGubunCostValueFieldNM;		
		F_ArrCol[5] = strMAQuery_GwaGubunCostCaption;
		    
        return   F_ArrCol;    
    }
    else if (str_AditemCode =="049") {

		F_ArrCol = [];
		F_ArrCol[0] = strMAQuery_DONATIONAll;
		F_ArrCol[1] = strMAQuery_DONATIONAllKeyField;
		F_ArrCol[2] = strMAQuery_DONATIONAllValueField;		
		F_ArrCol[3] = strMAQuery_DONATIONAllKeyFieldNM;		
		F_ArrCol[4] = strMAQuery_DONATIONAllValueFieldNM;		
		F_ArrCol[5] = strMAQuery_DONATIONAllCaption;		
		    
        return   F_ArrCol; 
    }
    else if (str_AditemCode =="PROJECT") {
    
		F_ArrCol = [];
		F_ArrCol[0] = strMAQuery_PROJECT;
		F_ArrCol[1] = strMAQuery_PROJECTKeyField;
		F_ArrCol[2] = strMAQuery_PROJECTValueField;		
		F_ArrCol[3] = strMAQuery_PROJECTKeyFieldNM;		
		F_ArrCol[4] = strMAQuery_PROJECTValueFieldNM;		
		F_ArrCol[5] = strMAQuery_PROJECTCaption;		
		    
        return   F_ArrCol;   
    }
    else if (str_AditemCode =="BUD_CLS") {

		F_ArrCol = [];
		F_ArrCol[0] = strMAQuery_BUDCLS;
		F_ArrCol[1] = strMAQuery_BUDCLSKeyField;
		F_ArrCol[2] = strMAQuery_BUDCLSValueField;		
		F_ArrCol[3] = strMAQuery_BUDCLSKeyFieldNM;		
		F_ArrCol[4] = strMAQuery_BUDCLSValueFieldNM;		
		F_ArrCol[5] = strMAQuery_BUDCLSCaption;		
		    
        return   F_ArrCol;   
    }
}


/*
 ******************************************************************************************
 * 함  수  명   : fn_searchEisClose
 * 입      력   : objOutDs = 데이터셋 이름
                  dsClass  = 파라미터 
 * 반      환   :  없음.
 * 기      능   : 마감 조회(경영관리)
 * 작  성  자   : 김영진
 * 작성  일자   : 2007-12-05
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
*/
function fn_searchEisClose(objOutDs, dsClass) {
    
    objOutDs.clear();
    objOutDs.addColumn("YY_MM","STRING",256);	
    
    fsp_clear(this);
    fsp_addSearch(this, "ma/mac:MAC_CLOSE_S001");
    
    http.Sync = true;
    fsp_callService(this, "", "", "", objOutDs.name + "=ds_close_out", "MOD_CLASS=" + wrapQuote(dsClass), "");
    http.Sync = false;   
     
    return objOutDs.getColumn(0, "YY_MM");
}



/*
 ******************************************************************************************
 * 함  수  명   : fn_PlanClose_Count
 * 입      력   : objOutDs = 데이터셋 이름
                  dsClass  = 파라미터 
 * 반      환   :  없음.
 * 기      능   : 마감 관리 사업장 여부 CHECK (사업계획)
 * 작  성  자   : 김영진
 * 작성  일자   : 2008-02-13
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
*/
function fn_PlanClose_Count(objOutDs, dsSce, dsYy, dsClose, dsUpjang ) {
    
    objOutDs.clear();
    objOutDs.addColumn("CNT","STRING",256);
    
    fsp_clear(this);
    fsp_addSearch(this, "ma/mac:MAC_PLAN_CLOSE_S002");
    
    http.Sync = true;
    fsp_callService(this, "", "", "", objOutDs.name + "=ds_cnt_out", "SCENARIO_CODE=" + wrapQuote(dsSce) + " YY=" + wrapQuote(dsYy) + " CLOSE_CD=" + wrapQuote(dsClose) + " UPJANG=" + wrapQuote(dsUpjang), "");
    http.Sync = false;   
     
    return objOutDs.getColumn(0, "CNT");
}


/*
 ******************************************************************************************
 * 함  수  명   : fn_PlanClose
 * 입      력   : objOutDs = 데이터셋 이름
                  dsClass  = 파라미터 
 * 반      환   :  없음.
 * 기      능   : 업장별 입력 마감 체크 (사업계획)
 * 작  성  자   : 김영진
 * 작성  일자   : 2008-02-13
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
*/
function fn_PlanClose(objOutDs, dsSce, dsYy, dsClose, dsUpjang ) {
    
    objOutDs.clear();
    objOutDs.addColumn("LOCK_YN","STRING",256);
    
    fsp_clear(this);
    fsp_addSearch(this, "ma/mac:MAC_PLAN_CLOSE_S001");
    
    http.Sync = true;
    fsp_callService(this, "", "", "", objOutDs.name + "=ds_close_out", "SCENARIO_CODE=" + wrapQuote(dsSce) + " YY=" + wrapQuote(dsYy) + " CLOSE_CD=" + wrapQuote(dsClose) + " UPJANG=" + wrapQuote(dsUpjang), "");
    http.Sync = false;   
     
    return objOutDs.getColumn(0, "LOCK_YN");
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_PlanClose_YN
 * 입      력   : objOutDs = 데이터셋 이름
                  dsClass  = 파라미터 
 * 반      환   :  없음.
 * 기      능   : 마감 여부 Return(사업계획)
 * 작  성  자   : 김영진
 * 작성  일자   : 2008-02-13
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
*/
function fn_PlanClose_YN(objOutDs, dsSce, dsYy, dsClose, dsUpjang) {
    
    objOutDs.clear();
    objOutDs.addColumn("LOCK_YN","STRING",256);
    
    var v_cnt;
    var v_lock;
    
    v_cnt = fn_PlanClose_Count(objOutDs, dsSce, dsYy, dsClose, dsUpjang);
    
    
    objOutDs.clear();
    objOutDs.addColumn("LOCK_YN","STRING",256);
    
    if (v_cnt == 0) {
       v_lock = fn_PlanClose(objOutDs, dsSce, dsYy, dsClose, "000000");
     }
    else {
       v_lock = fn_PlanClose(objOutDs, dsSce, dsYy, dsClose, dsUpjang);
     }
    
    return v_lock;
    
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_FstClose_Count
 * 입      력   : objOutDs = 데이터셋 이름
                  dsClass  = 파라미터 
 * 반      환   :  없음.
 * 기      능   : 마감 관리 사업장 여부 CHECK (전망/추정) 
 * 작  성  자   : 김영진
 * 작성  일자   : 2008-02-15
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
*/
function fn_FstClose_Count(objOutDs, dsSce, dsYy, dsClass, dsClose, dsUpjang) {
    
    objOutDs.clear();
    objOutDs.addColumn("CNT","STRING",256);
    
    fsp_clear(this);
    fsp_addSearch(this, "ma/mac:MAC_FST_CLOSE_S002");
    
    http.Sync = true;
    fsp_callService(this, "", "", "", objOutDs.name + "=ds_cnt_out", "SCENARIO_CODE=" + wrapQuote(dsSce) + " YY=" + wrapQuote(dsYy) + " DATA_CLASS=" + wrapQuote(dsClass) + " CLOSE_CD=" + wrapQuote(dsClose) + " UPJANG=" + wrapQuote(dsUpjang), "");
    http.Sync = false;   
     
    return objOutDs.getColumn(0, "CNT");
}


/*
 ******************************************************************************************
 * 함  수  명   : fn_FstClose
 * 입      력   : objOutDs = 데이터셋 이름
                  dsClass  = 파라미터 
 * 반      환   :  없음.
 * 기      능   : 업장별 입력 마감 체크 (전망/추정)
 * 작  성  자   : 김영진
 * 작성  일자   : 2008-02-15
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
*/
function fn_FstClose(objOutDs, dsSce, dsYy, dsClass, dsClose, dsUpjang) {
    
    objOutDs.clear();
    objOutDs.addColumn("LOCK_YN","STRING",256);
    
    fsp_clear(this);
    fsp_addSearch(this, "ma/mac:MAC_FST_CLOSE_S001");
    
    http.Sync = true;
    fsp_callService(this, "", "", "", objOutDs.name + "=ds_close_out", "SCENARIO_CODE=" + wrapQuote(dsSce) + " YY=" + wrapQuote(dsYy) + " DATA_CLASS=" + wrapQuote(dsClass) + " CLOSE_CD=" + wrapQuote(dsClose) + " UPJANG=" + wrapQuote(dsUpjang), "");
    http.Sync = false;   
     
    return objOutDs.getColumn(0, "LOCK_YN");
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_FstClose_YN
 * 입      력   : objOutDs = 데이터셋 이름
                  dsClass  = 파라미터 
 * 반      환   :  없음.
 * 기      능   : 마감 여부 Return (전망/추정)
 * 작  성  자   : 김영진
 * 작성  일자   : 2008-02-15
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
*/
function fn_FstClose_YN(objOutDs, dsSce, dsYy, dsClass, dsClose, dsUpjang) {
    
    objOutDs.clear();
    objOutDs.addColumn("LOCK_YN","STRING",256);
    
    var v_cnt;
    var v_lock;
    
    v_cnt = fn_FstClose_Count(objOutDs, dsSce, dsYy, dsClass, dsClose, dsUpjang);
    
    objOutDs.clear();
    objOutDs.addColumn("LOCK_YN","STRING",256);
    
    if (v_cnt == 0) {
       v_lock = fn_FstClose(objOutDs, dsSce, dsYy, dsClass, dsClose, "000000");
     }
    else {
       v_lock = fn_FstClose(objOutDs, dsSce, dsYy, dsClass, dsClose, dsUpjang);
     }
    
    return v_lock;
    
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_GetDEPT_IDPerUPJANG
 * 입      력   : sAcctClass = 계정코드 그룹 
                  pGubun = 조회 범위 ( 1 : 세세절까지 조회 , 2 : 절만 조회 )
                  sGubun = 화면에서 현재 입력한 값 구분 
                           1 - 절 코드 
                           2 - 절 명칭
                           3 - 세세절 코드 
                           4 - 세세절 명 
                  sWord = 구분에 따른 입력 값 
                  ( sGubun 과 sWord가 존재할 경우 Popup이 Open됨과 동시에 조회 처리를 한다.  )
 * 반      환   :  배열로 
                   0 - 절 코드 
                   1 - 절 명칭 
                   2 - 세세절 코드 ( 세세절 조회 안할 경우 "") 
                   3 - 세세절 명 ( 세세절 조회 안할 경우 "" )
 * 기      능   : 계정 코드 조회 화면 Open 
 * 작  성  자   : 황승한
 * 작성  일자   : 2007-11-28
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
*/



//해당업장의 DEPT_ID GET #################################################################
function fn_GetDEPT_IDPerUPJANG(objOutDs, str_UPJANG)
{


		objOutDs.clear();
		objOutDs.addColumn("DEPT_ID","INT",256);
				
		// action 정보 초기화
		fsp_clear(this);

		// 서버에서 조회할 정보 추가
		fsp_addSearch(this, "ma/mac:GetDEPT_IDPerUPJANG");

		// 서버 호출
		http.Sync = true;
		fsp_callService(this, "", "", "", objOutDs.name + "=ds_list","UPJANG=" + wrapQuote(str_UPJANG),"");
		http.Sync = false;

		if (numFormat(objOutDs.getColumn(objOutDs.rowposition, "DEPT_ID"))!= "0"){

			return objOutDs.getColumn(objOutDs.rowposition, "DEPT_ID");
		}

}
//해당업장의 DEPT_ID GET #################################################################


//Popup Button Key에 따른 처리 ###########################################################
function fn_edt_OnKeyDown(obj,nChar)
{
	if (nChar == 13){
        
        if (gfn_isNull(obj.text))
        {
			//trace("edtBtn_" + gfn_subStr(obj.name, 4));
			eval("edtBtn_" + gfn_subStr(obj.name, 4)).click(); 			
			//GetNextComponent().setFocus();
		}
	}	
	else if (nChar == 46){
	
		obj.userdata = "";
		obj.value     = "";			
		//eval(obj.id + "_OnChanged(" + obj.id + ", " + "" + ")");
	}	
}
//Popup Button Key에 따른 처리 ###########################################################

//Column Title 가져오기 ##################################################################
function fn_Get_ColHeaderTitle(Grid, nCell){

	return Grid.getCellProperty("head",nCell,"text");
}

function fn_Get_HeaderTitleColIdx(Grid, str_HeaderTitle){
     
    for (i=0;i<Grid.getCellCount("head");i++){

		if (Grid.getCellProperty("head",i,"text") == str_HeaderTitle){
			
			return i;
		}
    }	
}
//Column Title 가져오기 ##################################################################



//edtBtn OnClick 가져오기 ################################################################
function fn_edtBtn_OnClick(obj, str_Where)
{
	if(!gfn_isNull(str_Where))
	{
		var strType = str_Where.toString().toUpperCase();
		if(strType == "[OBJECT CLICKEVENTINFO]") str_Where = "";
	}
	else {
		str_Where = "";
	}
	
    //권한에 따른 업장 팝업 내역 설정######################################################
    //fn_sql_common_setup 함수 호출시 첫번째 파라메터인 SQL을 fn_MakeUpjangSQL() 지정한다.
    var strQuery_SqlTitle,
		strQuery_NewSqlData;
    
    strQuery_SqlTitle    =  eval("st_" + gfn_subStr(obj.name, 7)).userdata;
    strQuery_NewSqlData  =  eval(eval("st_" + gfn_subStr(obj.name, 7)).userdata);
    
    if (
         (strQuery_SqlTitle == "strMAQuery_Upjang") ||
         (strQuery_SqlTitle == "strQueryLocal_Upjang")
       )
    {

		strQuery_NewSqlData = fn_MakeUpjangSQL();
    }
    //권한에 따른 업장 팝업 내역 설정######################################################
    //fn_sql_common_setup 함수 호출시 첫번째 파라메터인 SQL을 fn_MakeUpjangSQL() 지정한다.


	fn_sql_common_setup(strQuery_NewSqlData,
						eval(eval("st_" + gfn_subStr(obj.name, 7)).userdata + "KeyField"),
						eval(eval("st_" + gfn_subStr(obj.name, 7)).userdata + "ValueField"),
						eval(eval("st_" + gfn_subStr(obj.name, 7)).userdata + "KeyFieldNM"),
						eval(eval("st_" + gfn_subStr(obj.name, 7)).userdata + "ValueFieldNM"),
						"",
						"",
						str_Where,
						eval(eval("st_" + gfn_subStr(obj.name, 7)).userdata + "Caption"),
						eval(eval("st_" + gfn_subStr(obj.name, 7)).userdata + "AllField") );	
	
	if (!gfn_isNull(gds_sql_common.getColumn(0, "ret_code"))){
	
		eval("edt_" + gfn_subStr(obj.name, 7)).userdata = gds_sql_common.getColumn(0, "ret_code");
		eval("edt_" + gfn_subStr(obj.name, 7)).value     = gds_sql_common.getColumn(0, "ret_name");	
			
		//obj.UserData = Object("edt_" + Substr(obj.id, 7)).value;
	}
	else {
	    
	    /* 
		if (obj.UserData != Object("edt_" + Substr(obj.id, 7)).value)
		{
		    Object("edt_" + Substr(obj.id, 7)).UserData = "";
		    Object("edt_" + Substr(obj.id, 7)).value     = "";
		    
			obj.UserData = "";						
		}
		*/
	}
}
//edtBtn OnClick 가져오기 ################################################################










/*
 ******************************************************************************************
 * 함  수  명   : fn_CheckMAClosing
 * 입      력   : real_UPJANG : 업장코드
	              str_DATE : 일자
	              str_GUBUN : 마감구분
 * 반      환   :  배열로 
                   리턴
 * 기      능   : 영업마감체크
 * 작  성  자   : 황승한
 * 작성  일자   : 2007-11-28
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
*/
function fn_CheckMAClosing(objOutDs, real_UPJANG, str_DATE, str_GUBUN)
{

    if (str_DATE < '20070101'){
    
		g_Message("EE", "일자는 2007-01-01 이전으로 등록될 수 없습니다.\n" +
						"확인하여 주십시요.");
		return false;				
    }
    
    //일마감체크#####################################################################
    if (str_GUBUN != "003")
    {
    
		if (!fn_IsCloseDate(objOutDs, real_UPJANG, str_DATE, str_GUBUN)){
		 
		 
			g_Message("EE", "해당일자는 이미 마감되었읍니다.\n단지 조회만 가능합니다.");	
			return false;     
		 }    
	}
	//일마감체크#####################################################################
	
	
	//이전일자일마감체크############################################################
    if (str_GUBUN != "003")
    {
    	
		objOutDs.clear();
		objOutDs.addColumn("CNT","INT",256);	       
		
		// action 정보 초기화 
		fsp_clear(this);  
		
		// 서버에서 조회할 정보 추가 
		fsp_addSearch(this, "ma/mac:GetMAS_CLOSE_MGMT_PreDate");
		
		//alert(str_ACCTCD);
		//alert(str_DATE_STD);
		// 서버 호출 
		http.Sync = true;
		fsp_callService(this, "", "", "", objOutDs.name + "=ds_list","UPJANG=" + wrapQuote(real_UPJANG) + " CLOSE_DATE=" + wrapQuote(str_DATE) + " CLOSE_GUBUN=" + wrapQuote(str_GUBUN),"");	
		http.Sync = false;
		
		//alert(objOutDs.GetColumn(objOutDs.row, "ACCTCD_DATE") );
		if (objOutDs.getColumn(objOutDs.rowposition, "CNT") > 1){
		
			g_Message("EE", "등록일자 이전 날짜에 대해\n일일마감이 처리되지 않은 것이 있습니다.\n" + 
							"일일마감에서 처리되지 않은\n일자에 대해 마감처리를\n완료하시기 바랍니다.");	
			return false;
		}	
	}
	//이전일자일마감체크############################################################
	
	
	
	//전표마감체크###################################################################
	if (!fn_CheckGAClosing(objOutDs, real_UPJANG, str_DATE, str_GUBUN))
	{
		return false;
	}
	//전표마감체크###################################################################
	
	
    return true;
}

function fn_IsCloseDate(objOutDs, real_UPJANG, str_DATE, str_GUBUN)
{


    //일마감체크#####################################################################
    objOutDs.clear();
    objOutDs.addColumn("CNT","INT",256);	       
    
	// action 정보 초기화 
    fsp_clear(this);  
	
    // 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "ma/mac:GetMAS_CLOSE_MGMT");
	
	//alert(str_ACCTCD);
	//alert(str_DATE_STD);
	// 서버 호출 
	http.Sync = true;
	fsp_callService(this, "", "", "", objOutDs.name + "=ds_list","UPJANG=" + wrapQuote(real_UPJANG) + " CLOSE_DATE=" + wrapQuote(str_DATE) + " CLOSE_GUBUN=" + wrapQuote(str_GUBUN),"");	
	http.Sync = false;
	
	//alert(objOutDs.GetColumn(objOutDs.row, "ACCTCD_DATE") );
	if (objOutDs.getColumn(objOutDs.rowposition, "CNT") > 0){
			
		return false;
	}
	//일마감체크#####################################################################
		
    return true;
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_CheckMAClosing
 * 입      력   : real_UPJANG : 업장코드
	              str_DATE : 일자
	              str_GUBUN : 마감구분
 * 반      환   :  배열로 
                   리턴
 * 기      능   : 영업마감체크
 * 작  성  자   : 황승한
 * 작성  일자   : 2007-11-28
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
*/
function fn_CheckGAClosing(objOutDs, real_UPJANG, str_DATE, str_GUBUN)
{
  
	str_DATE = gfn_subStr(str_DATE, 0, 6);
	//전표마감체크###################################################################
	var str_TableName, str_DateField;
	
	if (str_GUBUN == "001") //매출마감
	{
		
			str_TableName = "MAS_TRX";
			str_DateField = "TRX_DATE";
	}
    else if (str_GUBUN == "002") //입금마감
    {
    
			str_TableName = "MAS_RCP";
			str_DateField = "RCP_DATE";    
    }
    else if (str_GUBUN == "003") //전도금마감
    {
    
			str_TableName = "MAS_ADVANCE";
			str_DateField = "ADJ_DATE";    
    }
    else if (str_GUBUN == "100") //이체마감
    {
    
			str_TableName = "MAS_RMT";
			str_DateField = "RMT_DATE";    
    }
    else if (str_GUBUN == "200") //세금계산서마감
    {
    
			str_TableName = "MAS_BILL";
			str_DateField = "BILL_DATE";    
    }       
    else if (str_GUBUN == "300") //복리후생비마감
    {
    
			str_TableName = "MAS_WELFARE";
			str_DateField = "APPLY_MM";    
    }
    else if (str_GUBUN == "400") //영업대체마감
    {
    
			str_TableName = "MAS_TRX_SUBST";
			str_DateField = "ADJ_DATE";    
    }      
    else {
    
		return true;
    }
	
    objOutDs.clear();
    objOutDs.addColumn("SLIPNO","INT",256);	       
    
	// action 정보 초기화 
    fsp_clear(this);  
	
    // 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "ma/mac:GetGA_CLOSE");
	
	//alert(str_ACCTCD);
	//alert(str_DATE_STD);
	// 서버 호출 
	http.Sync = true;
	fsp_callService(this, "", "", "", objOutDs.name + "=ds_list","UPJANG=" + wrapQuote(real_UPJANG) + " CLOSE_DATE=" + wrapQuote(str_DATE) + 
	                                                           " str_TableName=" + str_TableName + 
	                                                           " str_DateField=" + str_DateField,"");	
	http.Sync = false;
	
	//alert(objOutDs.GetColumn(objOutDs.row, "ACCTCD_DATE") );
	if (gfn_length(objOutDs.getColumn(objOutDs.rowposition, "SLIPNO"))> 0){
	
		g_Message("EE", "전표번호 " +  objOutDs.getColumn(objOutDs.rowposition, "SLIPNO") + " 으로 발행된 전표가 있습니다.\n" + 
		                "확인하여 주십시요.");	
		return false;
	}	
	//전표마감체크###################################################################
	
	return true;	
}






/*
 ******************************************************************************************
 * 함  수  명   : fn_GetALT_AcctcdCHECK
 * 입      력   : ACCTCD_GUBUN1
	              ACCTCD_GUBUN2
	              ACCTCD_GUBUN3
 * 반      환   :  배열로 
                   리턴
 * 기      능   : 유형별 대체계정
 * 작  성  자   : 황승한
 * 작성  일자   : 2007-11-28
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
*/
//유형별 대체계정######################################################################
function fn_GetALT_AcctcdCHECK(objOutDs, ACCTCD_GUBUN1, ACCTCD_GUBUN2, ACCTCD_GUBUN3, ACCTCD_GUBUN4)
{

    
    //대체계정체크#####################################################################
    objOutDs.clear();
    objOutDs.addColumn("ACCTCD","STRING",256);	       
    objOutDs.addColumn("ACCTNM","STRING",256);	       
    
    
	// action 정보 초기화 
    fsp_clear(this);  
	
    // 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "ma/mac:GetALT_AcctcdCHECK");
	
	//alert(str_ACCTCD);
	//alert(str_DATE_STD);
	// 서버 호출 
	http.Sync = true;
	fsp_callService(this, "", "", "", objOutDs.name + "=ds_list","ACCTCD_GUBUN1=" + wrapQuote(ACCTCD_GUBUN1) + 
															   " ACCTCD_GUBUN2=" + wrapQuote(ACCTCD_GUBUN2) + 
	                                                           " ACCTCD_GUBUN3=" + wrapQuote(ACCTCD_GUBUN3) +
	                                                           " ACCTCD_GUBUN4=" + wrapQuote(ACCTCD_GUBUN4)
	                                                           ,"");	
	http.Sync = false;
	
                          	
	
	//alert(objOutDs.GetColumn(objOutDs.row, "ACCTCD_DATE") );
	return objOutDs.getColumn(objOutDs.rowposition, "ACCTCD");
	//대체계정체크#####################################################################
}
//유형별 대체계정######################################################################




/*
 ******************************************************************************************
 * 함  수  명   : fn_GetIsSupenseJanAmtOK
 * 입      력   : ACCTCD_GUBUN1
	              ACCTCD_GUBUN2
	              ACCTCD_GUBUN3
 * 반      환   :  배열로 
                   리턴
 * 기      능   : 유형별 대체계정
 * 작  성  자   : 황승한
 * 작성  일자   : 2007-11-28
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
*/
//가수금 잔액체크######################################################################
function fn_GetIsSupenseJanAmtOK(objOutDs, real_SUS_SEQ, real_AMT)
{


    objOutDs.clear();
    objOutDs.addColumn("JANAMT","INT",256);	       
        
    
	// action 정보 초기화 
    fsp_clear(this);  
	
    // 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "ma/mac:GetIsSupenseJanAmtOK");
	
	//alert(str_ACCTCD);
	//alert(str_DATE_STD);
	// 서버 호출 
	http.Sync = true;
	fsp_callService(this, "", "", "", objOutDs.name + "=ds_list","SUS_SEQ=" + real_SUS_SEQ + 
															   " AMT="    + real_AMT
	                                                           ,"");	
	http.Sync = false;
	
                          	
	if (toNumber(objOutDs.getColumn(objOutDs.rowposition, "JANAMT")) < 0){
	
		g_Message("EE", "해당가수금은 잔액이 초과합니다.\n" + 
		                "확인하여 주십시요.");	
		return false;
	}	
	
	return true;
}
//가수금 잔액체크######################################################################










/*
 ******************************************************************************************
 * 함  수  명   : fn_GetBalanceLine
 * 입      력   : objOutDs
	              objInDs
	              str_GUBUN
 * 반      환   :  배열로 
                   리턴
 * 기      능   : 유형별 대체계정
 * 작  성  자   : 황승한
 * 작성  일자   : 2007-11-28
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
*/
//LINE별 잔액체크######################################################################
function fn_GetBalanceLine(objOutDs, objInDs, str_GUBUN)
{

    
    //잔액체크#####################################################################
    objOutDs.clear();
    objOutDs.addColumn("JANAMT","INT",256);	       
    
	// action 정보 초기화 
    fsp_clear(this);  
	
    // 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "ma/mas:GetMAS_GETBALANCE_LINE");
	
	//alert(str_ACCTCD);
	//alert(str_DATE_STD);
	// 서버 호출 
	
	var real_ORGID,
		real_ID,
		real_AMT,
		str_TYPE_CD,
		str_CloseErr,
		str_ORG_GUBUN;
	
	str_ORG_GUBUN = str_GUBUN;	
	//alert(objInDs.saveXML());
	http.Sync = true;
	for (i=0;i<objInDs.rowcount;i++){
	
		if (str_GUBUN == "매출잔액체크"){
		
			real_ORGID = objInDs.getColumn(i, "RCP_ID");
			real_ID    = objInDs.getColumn(i, "TRX_ID");
			real_AMT   = objInDs.getColumn(i, "AMT");
			
			str_TYPE_CD = "NONE";
		}
		
		if (str_GUBUN == "입금잔액체크"){
		
			real_ORGID = objInDs.getColumn(i, "TRX_ID");
			real_ID    = objInDs.getColumn(i, "RCP_ID");
			real_AMT   = objInDs.getColumn(i, "AMT");
			
			str_TYPE_CD = "NONE";
		}		
			
		if (str_GUBUN == "세금계산서잔액체크"){
		
			real_ORGID = objInDs.getColumn(i, "BILL_ID");
			real_ID    = objInDs.getColumn(i, "TRX_ID");
			real_AMT   = objInDs.getColumn(i, "AMT") + objInDs.getColumn(i, "VAT");
			
			str_TYPE_CD = "NONE";
		}
			
		if (str_GUBUN == "고객사대체잔액체크"){
		
			real_ORGID = objInDs.getColumn(i, "ORG_TRX_ID");
			real_ID    = 0;
			real_AMT   = objInDs.getColumn(i, "AMT");
			
			str_TYPE_CD = objInDs.getColumn(i, "SUBST_TYPE");
		}
				
		if (str_GUBUN == "영업대체잔액체크"){
		    
		    if (numFormat(objInDs.getColumn(i, "ORG_TRX_ID"))!= "0"){
		    
				real_ORGID    = 0;
				real_ID       = objInDs.getColumn(i, "ORG_TRX_ID");
				real_AMT      = objInDs.getColumn(i, "AMT");	
				
				str_ORG_GUBUN = "영업대체매출잔액체크";
			}
			
		    if (numFormat(objInDs.getColumn(i, "ORG_RCP_ID"))!= "0"){
		    
				real_ORGID = 0;
				real_ID    = objInDs.getColumn(i, "ORG_RCP_ID");
				real_AMT   = objInDs.getColumn(i, "AMT");			
				
				str_ORG_GUBUN = "영업대체입금잔액체크";
			}
			
			if (
				(numFormat(objInDs.getColumn(i, "ORG_TRX_ID"))== "0") &&
			    (numFormat(objInDs.getColumn(i, "ORG_RCP_ID"))== "0")
			   ) 
			{
				continue;
			}
						
			str_TYPE_CD = "NONE";
						
		}
		
		if (str_GUBUN == "식권판매잔액체크"){
		
			real_ORGID = objInDs.getColumn(i, "RCP_ID");
			real_ID    = objInDs.getColumn(i, "TICKET_SEQ");
			real_AMT   = objInDs.getColumn(i, "QTY");
			
			str_TYPE_CD = "NONE";			
		}		
		
		
		if (str_GUBUN == "식권불용폐기잔액체크"){
		
			real_ORGID = objInDs.getColumn(i, "CURR_TICKET_SEQ");
			real_ID    = objInDs.getColumn(i, "TICKET_SEQ");
			real_AMT   = objInDs.getColumn(i, "QTY");
			
			str_TYPE_CD = "NONE";			
		}	
				
		
		if (str_GUBUN == "식권로스폐기잔액체크"){
		
			real_ORGID = objInDs.getColumn(i, "CURR_TICKET_SEQ");
			real_ID    = objInDs.getColumn(i, "TICKET_SEQ");
			real_AMT   = objInDs.getColumn(i, "QTY");
			
			str_TYPE_CD = "NONE";			
		}	
					
					
		if (str_GUBUN == "식권회수잔액체크"){
		
			real_ORGID = objInDs.getColumn(i, "TRX_ID");
			real_ID    = objInDs.getColumn(i, "UPJANG");
			real_AMT   = objInDs.getColumn(i, "QTY");
			
			str_TYPE_CD = objInDs.getColumn(i, "ITEM_CODE");
		}	
										
			
		if (str_GUBUN == "식권환불잔액체크"){
		
			real_ORGID = objInDs.getColumn(i, "SUBST_ID");
			real_ID    = objInDs.getColumn(i, "UPJANG");
			real_AMT   = objInDs.getColumn(i, "QTY");
			
			str_TYPE_CD = objInDs.getColumn(i, "ITEM_CODE");
		}			
				
				
		if (str_GUBUN == "식권회수폐기잔액체크"){
		
			real_ORGID = objInDs.getColumn(i, "CURR_TICKET_SEQ");
			real_ID    = objInDs.getColumn(i, "UPJANG");
			real_AMT   = objInDs.getColumn(i, "QTY");
			
			str_TYPE_CD = objInDs.getColumn(i, "ITEM_CODE");
			
			//alert(SaveXML(objInDs,null));
		}				
				
				
		if (str_GUBUN == "식권환불폐기잔액체크"){
		
			real_ORGID = objInDs.getColumn(i, "CURR_TICKET_SEQ");
			real_ID    = objInDs.getColumn(i, "UPJANG");
			real_AMT   = objInDs.getColumn(i, "QTY");
			
			str_TYPE_CD = objInDs.getColumn(i, "ITEM_CODE");
		}					

												
		fsp_callService(this, "", "", "", objOutDs.name + "=ds_list","V_GUBUN="  + wrapQuote(str_ORG_GUBUN) + 
																   " V_TYPE_CD="  + wrapQuote(str_TYPE_CD) +
																   " V_ORGID=" + real_ORGID + 
																   " V_ID="    + real_ID +
																   " V_AMT="   + real_AMT
																   ,"");	
		
		
		
		
		
        if (objOutDs.getColumn(objOutDs.rowposition, "JANAMT") < 0) str_CloseErr = "잔액초과 데이터가 있습니다.";
        
        
        
		if (gfn_length(str_CloseErr )!= 0){
		
			g_Message("EE", str_CloseErr + "\n" +
							"확인하여 주십시요.");
            http.Sync = false;										  
			return false;        
		}        
		
	}
	http.Sync = false;
                          		
	return true;
	//잔액체크#####################################################################
	
}
//LINE별 잔액체크######################################################################



/*
 ******************************************************************************************
 * 함  수  명   : fn_GetUpjangAcntcd
 * 입      력   : objOutDs
	              objInDs
	              str_GUBUN
 * 반      환   :  배열로 
                   리턴
 * 기      능   : 유형별 대체계정
 * 작  성  자   : 황승한
 * 작성  일자   : 2007-11-28
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
*/
//입금유형별 계좌가져오기############################################################
function fn_GetUpjangAcntcd(objOutDs, real_UPJANG, str_DR_ACCTCD)
{
   
    objOutDs.clear();    
    objOutDs.addColumn("ACNTCD","STRING",256);	       

	// action 정보 초기화 
    fsp_clear(this);  
	
    // 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "ma/mac:GetUpjangAcntcd");
	
	
	//미수금(신용카드) 1110815/ 미수금(식권) 1110822 일경우 => 가계좌
	if (
		(str_DR_ACCTCD == "1110815") ||
		(str_DR_ACCTCD == "1110822")
	   )
	{
	
		str_DR_ACCTCD = "1110114";
	}
		
	// 서버 호출 
	http.Sync = true;
	fsp_callService(this, "", "", "", objOutDs.name + "=ds_list","UPJANG=" + real_UPJANG + 
															   " DR_ACCTCD=" + wrapQuote(str_DR_ACCTCD)
	                                                           ,"");	
	http.Sync = false;
	
    return objOutDs.getColumn(objOutDs.rowposition, "ACNTCD");    
 
}			 
//입금유형별 계좌가져오기############################################################



/*
 ******************************************************************************************
 * 함  수  명   : fn_GetMAS_TICKET_MST_GROUP_S
 * 입      력   : objOutDs
	              objInDs
	              str_GUBUN
 * 반      환   :  배열로 
                   리턴
 * 기      능   : 유형별 대체계정
 * 작  성  자   : 황승한
 * 작성  일자   : 2007-11-28
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
*/
//식권 MAS_TICKET_MST_GROUP_S가져오기############################################################
function fn_GetMAS_TICKET_MST_GROUP_S(objOutDs)
{
   
    objOutDs.clear();    
    objOutDs.addColumn("MAS_TICKET_MST_GROUP_S","STRING",256);	       

	// action 정보 초기화 
    fsp_clear(this);  
	
    // 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "ma/mas:MAS10250E_S008");
	
	//alert(str_ACCTCD);
	//alert(str_DATE_STD);
	// 서버 호출 
	http.Sync = true;
	fsp_callService(this, "", "", "", objOutDs.name + "=ds_list",""
	                                                          ,"");	
	http.Sync = false;
	
    return objOutDs.getColumn(objOutDs.rowposition, "MAS_TICKET_MST_GROUP_S");    
 
}			 
//입금유형별 계좌가져오기############################################################



/*
 ******************************************************************************************
 * 함  수  명   : fn_ImportantImgSetting
 * 입      력   : objOutDs
	              objInDs
	              str_GUBUN
 * 반      환   :  배열로 
                   리턴
 * 기      능   : 유형별 대체계정
 * 작  성  자   : 황승한
 * 작성  일자   : 2007-11-28
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
*/
//필수입력사항 important image 처리 ##################################################
function fn_ImportantImgSetting(objForm)
{
	return;
	for (i=0 ; i < objForm.components.length;i++)
	{	
		// Object를 구한다.
		objComponent = objForm.all[i];
		strName = objForm.components[i].name;
		if (gfn_subStr(objComponent.name, 0, 12)== "img_imp_edt_"){

			if (eval("edt_" + gfn_subStr(objComponent.name, 12)) != null){
				objComponent.visible = false;
				if (eval("edt_" + gfn_subStr(objComponent.name, 12)).enable == true){
				
					objComponent.visible = true;
				}
			}			
		}
		else if (gfn_subStr(objComponent.name, 0, 11)== "img_imp_me_"){
		
			if (eval("me_" + gfn_subStr(objComponent.name, 11)) != null){
			
				objComponent.visible = false;
				if (eval("me_" + gfn_subStr(objComponent.name, 11)).enable == true){
				
					objComponent.visible = true;
				}
			}
		}
		else if (gfn_subStr(objComponent.name, 0, 12)== "img_imp_cbo_"){
		
			if (eval("cbo_" + gfn_subStr(objComponent.name, 12)) != null){
			
				objComponent.visible = false;
				if (eval("cbo_" + gfn_subStr(objComponent.name, 12)).enable == true){
				
					objComponent.visible = true;
				}
			}
		}	
		else if (gfn_subStr(objComponent.name, 0, 12)== "img_imp_cal_"){
				trace("fn_ImportantImgSetting : strName : " + strName);
		
			if (eval("cal_" + gfn_subStr(objComponent.name, 12)) != null){
			
				objComponent.visible = false;
				if (eval("cal_" + gfn_subStr(objComponent.name, 12)).enable == true){
				
					objComponent.visible = true;
				}
			}
		}			
	}
}
//필수입력사항 important image 처리 ##################################################










/*
 ******************************************************************************************
 * 함  수  명   : fn_GetSystemOpenDateCheck
 * 입      력   : objOutDs
	              objInDs
	              str_GUBUN
 * 반      환   :  배열로 
                   리턴
 * 기      능   : 유형별 대체계정
 * 작  성  자   : 황승한
 * 작성  일자   : 2007-11-28
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
*/
//시스템 오픈 등록일자는 계산처리 ##################################################
function fn_GetSystemOpenDateCheck(str_Date)
{

	if (gfn_length(str_Date)== 6){
	
		if (str_Date <= "200801"){
		
				g_Message("EE", "등록월은 2008년01월 이전으로 등록할 수 없습니다.\n" +
				                "확인하여 주십시요.");				
				return false;		
		}
	}
	else if (gfn_length(str_Date)== 8){
	
		if (str_Date <= "20080101"){
		
				g_Message("EE", "등록일자는 2008년01월01일 이전으로 등록할 수 없습니다.\n" +
				                "확인하여 주십시요.");				
				return false;				
		}	
	}
	else {
	
				g_Message("EE", "시스템 오픈 등록일자는 계산 오류\n" +
				                "확인하여 주십시요.");				
				return false;			
	}
	
	return true;
}
//시스템 오픈 등록일자는 계산처리 ##################################################





/*
 ******************************************************************************************
 * 함  수  명   : fn_GetTicketSubulYN
 * 입      력   : objOutDs
	              objInDs
	              str_GUBUN
 * 반      환   :  배열로 
                   리턴
 * 기      능   : 유형별 대체계정
 * 작  성  자   : 황승한
 * 작성  일자   : 2007-11-28
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
*/
//식권수불여부 정보취득##############################################################################
function fn_GetTicketSubulYN(objOutDs, str_ITEM_TYPE)
{

    
    //잔액체크#####################################################################
    objOutDs.clear();
    objOutDs.addColumn("CNT","INT",256);	       
    
	// action 정보 초기화 
    fsp_clear(this);  
	
    // 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "ma/mas:MAS10210E_S006");
	
	//alert(str_ACCTCD);
	//alert(str_DATE_STD);
	// 서버 호출 
	http.Sync = true;
	fsp_callService(this, "", "", "", objOutDs.name + "=ds_list","ITEM_TYPE=" + wrapQuote(str_ITEM_TYPE)
	                                                           ,"");	
	http.Sync = false;
	
                          	
	
	//alert(objOutDs.GetColumn(objOutDs.row, "ACCTCD_DATE") );
	return objOutDs.getColumn(objOutDs.rowposition, "CNT");
	//잔액체크#####################################################################
	
}
//식권수불여부 정보취득##############################################################################


/*
 ******************************************************************************************
 * 함  수  명   : fn_GetTicketMasterGubun
 * 입      력   : objOutDs
	              objInDs
	              str_GUBUN
 * 반      환   :  배열로 
                   리턴
 * 기      능   : 유형별 대체계정
 * 작  성  자   : 황승한
 * 작성  일자   : 2007-11-28
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
*/
//식권관리자 정보취득##############################################################################
function fn_GetTicketMasterGubun(objOutDs)
{
	
		objOutDs.clear();
		objOutDs.addColumn("CODE","STRING",256);
		objOutDs.addColumn("CODE_NAME","STRING",256);
		
					
		// action 정보 초기화
		fsp_clear(this);

		// 서버에서 조회할 정보 추가
		fsp_addSearch(this, "ma/mas:MAS10290E_S010");

		// 서버 호출
		http.Sync = true;
		fsp_callService(this, "", "", "", objOutDs.name + "=ds_list","","");
		http.Sync = false;	
	
}
//식권관리자 정보취득##############################################################################




/*
 ******************************************************************************************
 * 함  수  명   : fn_GetUpjangMasterGubun
 * 입      력   : objOutDs
	              objInDs
	              str_GUBUN
 * 반      환   :  배열로 
                   리턴
 * 기      능   : 유형별 대체계정
 * 작  성  자   : 황승한
 * 작성  일자   : 2007-11-28
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
*/
//업장관리자 정보취득##############################################################################
function fn_GetUpjangMasterGubun(objOutDs, real_UPJANG)
{
	
		objOutDs.clear();
			
					
		// action 정보 초기화
		fsp_clear(this);

		// 서버에서 조회할 정보 추가
		fsp_addSearch(this, "ma/mac:GetUpjangMaster");

		// 서버 호출
		http.Sync = true;
		fsp_callService(this, "", "", "", objOutDs.name + "=ds_list","UPJANG=" + wrapQuote(real_UPJANG)
		                                                           ,"");
		http.Sync = false;	
		
		return true;
		
	
}
//업장관리자 정보취득##############################################################################


//해당월 말일자취득################################################################################
function fn_GetMonthLastDate(objOutDs, str_MonthDate)
{
	
		objOutDs.clear();
			
					
		// action 정보 초기화
		fsp_clear(this);

		// 서버에서 조회할 정보 추가
		fsp_addSearch(this, "ma/mac:GetMonthLastDate");

		// 서버 호출
		http.Sync = true;
		fsp_callService(this, "", "", "", objOutDs.name + "=ds_list","MONTH_DATE=" + wrapQuote(str_MonthDate)
		                                                           ,"");
		http.Sync = false;	
		
		return objOutDs.getColumn(0, "LAST_DATE");
		
	
}
//해당월 말일자취득################################################################################




//GANO 세팅#######################################################################
function fn_GetHLDC_GA_GETMAXNO(str_V_GAMU, str_V_GADATE)
{

    
    if (gfn_length(str_V_GADATE)== 0){    

		g_Message("EE", "전표일자가 선택되어 있지 않습니다.\n" +
						"확인하여 주십시요."); 						               
        return false;
    }    
    
    
    
    
	ds_cond.clear();
	ds_cond.addColumn("V_GANO","INT",256);
				
	// action 정보 초기화
	fsp_clear(this);

	// 서버에서 조회할 정보 추가
	fsp_addSearch(this, "ma/mas:MAS10309E_S003");

	// 서버 호출
	http.Sync = true;
	fsp_callService(this, "", "", "", ds_cond.name + "=ds_list","V_GAMU=" + wrapQuote(str_V_GAMU) + 
	                                                          " V_GADATE=" + wrapQuote(str_V_GADATE)
	                                                         ,"");
	http.Sync = false;

    return ds_cond.getColumn(ds_cond.rowposition, "V_GANO");
}
//GANO 세팅#######################################################################


//각 구분별 전표초기화체크###############################################################################
function fn_GetGA_INIT_CLOSE(objOutDs, str_DeleteFlag, str_GAGUBUN_TITLE, str_GAMU, str_GADATE, real_GANO)
{

    //대체마감체크#####################################################################
    var str_CloseErr = "";
    
    objOutDs.clear();
    objOutDs.addColumn("GA_TRX_YN","STRING",256);	       
    objOutDs.addColumn("GA_RCP_YN","STRING",256);	       
    objOutDs.addColumn("GA_BILL_YN","STRING",256);	      
    objOutDs.addColumn("GA_ADV_YN","STRING",256);	         
    objOutDs.addColumn("GA_ADV_REQ_YN","STRING",256);	 
    objOutDs.addColumn("GA_COST_YN","STRING",256);	 
    
        
	// action 정보 초기화 
    fsp_clear(this);  
	
    // 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "ma/mas:MAS10309E_S004");
		
	
	// 서버 호출 
	http.Sync = true;
	fsp_callService(this, "", "", "", objOutDs.name + "=ds_list","GAGUBUN_TITLE=" + wrapQuote(str_GAGUBUN_TITLE) + 
															   " GAMU=" + wrapQuote(str_GAMU) + 
															   " GADATE=" + wrapQuote(str_GADATE) + 
															   " GANO=" + wrapQuote(real_GANO)
	                                                           ,"");	
	http.Sync = false;
	    

	if (	
	     ( (str_GAGUBUN_TITLE == "매출전표") && (objOutDs.getColumn(objOutDs.rowposition, "GA_TRX_YN") == "N") ) ||
	     ( (str_GAGUBUN_TITLE == "입금전표") && (objOutDs.getColumn(objOutDs.rowposition, "GA_RCP_YN") == "N") ) ||
	     ( (str_GAGUBUN_TITLE == "세금계산서전표") && (objOutDs.getColumn(objOutDs.rowposition, "GA_BILL_YN") == "N") ) ||
	     ( (str_GAGUBUN_TITLE == "전도금정산전표") && (objOutDs.getColumn(objOutDs.rowposition, "GA_ADV_YN") == "N") ) ||
	     ( (str_GAGUBUN_TITLE == "전도금신청전표") && (objOutDs.getColumn(objOutDs.rowposition, "GA_ADV_REQ_YN") == "N") ) ||
	     ( (str_GAGUBUN_TITLE == "원가전표") && (objOutDs.getColumn(objOutDs.rowposition, "GA_COST_YN") == "N") )
	   )
	{
	     
	     str_CloseErr = "해당전표번호는 [" + str_GAGUBUN_TITLE + "] 가 아닙니다.";
	}
	
	if (
	     (str_DeleteFlag == "Y") &&
	     (objOutDs.getColumn(objOutDs.rowposition, "GA_POSTING_YN") == "Y")
	   )
	{
	
		str_CloseErr = "해당전표번호는 회계이관된 전표입니다.";
	}
	
	if (gfn_length(str_CloseErr )!= 0){
	
		g_Message("EE", str_CloseErr + "\n" +
						"확인하여 주십시요.");			 
		return false;        
	}

	return true;
	//대체마감체크#####################################################################
 
}			 
//각 구분별 전표초기화체크###############################################################################










//권한에 따른 저장/삭제 가능체크#########################################################################
function fn_GetSaveAuthBy_AuthLevel(real_UPJANG)
{
	if (g_AuthLevel != "10") //영양사
	{
		if (real_UPJANG != g_Upjang)
		{
			g_Message("EE", "해당 사용자는 소속업장에 대해서만\n저장/삭제 가능합니다." + "\n" +
							"확인하여 주십시요.");
			return false;
		}
	}
	//
	return true;
}			 
//권한에 따른 저장/삭제 가능체크#########################################################################











//권한에 따른 조회세팅 (파트추가)########################################################################
function fn_SetSelectAuthBy_AuthLevelPlusPart(objOutDs, obj_Team, obj_Part, obj_Sabun)
{
    
    var str_CloseErr = "";
    
    
    //Component Enable초기화###########################################
    if (obj_Team != null){               
		obj_Team.enable = false;
		eval("edtBtn_" + gfn_subStr(obj_Team.name, 4)).enable = false;
    }
        
    if (obj_Part != null){                
		obj_Part.enable = false;
		eval("edtBtn_" + gfn_subStr(obj_Part.name, 4)).enable = false;
    }
    		
    if (obj_Sabun != null){              		
		obj_Sabun.enable = false;
		eval("edtBtn_" + gfn_subStr(obj_Sabun.name, 4)).enable = false;
	}
    //Component Enable초기화###########################################

 
    /*
    objOutDs.Clear();
    objOutDs.AddColumn("GA_TRX_YN","STRING",256);	       
    */
        
	// action 정보 초기화 
    fsp_clearActionInfo(this);  
	
    // 서버에서 조회할 정보 추가 
	fsp_addSearchActionInfo(this, "ma/mac:GetSelectAuthBy_AuthLevelPlusPart");		
	
	// 서버 호출 
	http.Sync = true;
	fsp_callService(this, "", "", "", objOutDs.name + "=ds_list",""
	                                                          ,"");	
	http.Sync = false;
	
	
	//Component 초기값 및 Enable세팅###################################
    if (obj_Team != null){      	
		obj_Team.userdata  = g_Deptid;
		obj_Team.value      = g_DeptNm;
    }
    	
    if (obj_Part != null){          	
		obj_Part.userdata  = objOutDs.getColumn(objOutDs.rowposition, "PART_CODE");
		obj_Part.value      = objOutDs.getColumn(objOutDs.rowposition, "PART_CODENM");
    }
    		
    if (obj_Sabun != null){      
        		
		obj_Sabun.userdata = g_EmpNo;
		obj_Sabun.value     = g_Name;	
	}
	//Component 초기값 및 Enable세팅###################################
	
	
	
	//팀장 권한일때는 Team 이외의 조회조건 Enable처리/팀장 상위 일경우 전체 Enable처리#####
	if (g_AuthLevel >= "16"){
	
	    if (g_AuthLevel > "16"){
	    
		    if (obj_Team != null){       			
				obj_Team.enable = true;
				eval("edtBtn_" + gfn_subStr(obj_Team.name, 4)).enable = true;	    
			}	
	    }
	    
		if (obj_Part != null){       		    		
			obj_Part.enable = true;
			eval("edtBtn_" + gfn_subStr(obj_Part.name, 4)).enable = true;
        }
        		
		if (obj_Sabun != null){      	        				
			obj_Sabun.enable = true;
			eval("edtBtn_" + gfn_subStr(obj_Sabun.name, 4)).enable = true;	
		}
	}

	var bColChk = objOutDs.getColumnInfo("PART_MGR_CODE");	// 컬럼정보가 있는지 체크
   
	if(!gfn_isNull(bColChk))
	{
		if (gfn_length(objOutDs.getColumn(objOutDs.rowposition, "PART_MGR_CODE"))!= 0){
		
			if (obj_Sabun != null){      	        				
				obj_Sabun.enable = true;
				eval("edtBtn_" + gfn_subStr(obj_Sabun.name, 4)).enable = true;	
			}	
		}
	}
	//팀장 권한일때는 Team 이외의 조회조건 Enable처리/팀장 상위 일경우 전체 Enable처리#####
	

	return true;
}			 
//권한에 따른 조회세팅 (파트추가)########################################################################








//권한에 따른 EXCEL DOWN세팅 #############################################################################
function fn_SetBlockExcelAuth(objOutDs, obj_Grid)
{
    
    var str_CloseErr = "";
    

    /*
    objOutDs.Clear();
    objOutDs.AddColumn("GA_TRX_YN","STRING",256);	       
    */
        
	// action 정보 초기화 
    fsp_clearActionInfo(this);  
	
    // 서버에서 조회할 정보 추가 
	fsp_addSearchActionInfo(this, "ma/mac:GetBlockExcelAuth");		
	
	// 서버 호출 
	http.Sync = true;
	fsp_callService(this, "", "", "", objOutDs.name + "=ds_list",""
	                                                          ,"");	
	http.Sync = false;
	
	
	//Component 초기값 및 Enable세팅###################################
    if (objOutDs.getColumn(objOutDs.rowposition, "EXCEL_BLOCK_YN") == "Y"){
		obj_Grid.setCellProperty("head",0,"backgroundimage", "");
    }
	//Component 초기값 및 Enable세팅###################################

	return true;
}			 
//권한에 따른 EXCEL DOWN세팅 #############################################################################


//============================================================================================
//(2012-06-04 추가) 시작
//박은규 2012-06-04 CSR#(CH201205_00175) 요청자:박현주(FS지원팀)
//월마감작업 추가(월-마감구분, 공통코드:MA0044)
//============================================================================================
function mfn_GetClsStatus(strMonth)
{
	fn_sql_common("P", "SELECT A.CODE, A.CODE_NAME FROM SCC_COMMON_CODE A WHERE A.GROUP_CODE = 'MA0044' AND A.CODE = '" + strMonth + "' AND A.CODE_NAME = 'Y'", " AND A.USE_YN = 'Y'");
}
//============================================================================================
//(2012-06-04 추가) 끝
//============================================================================================


//CC별 월마감 작업 추가
//============================================================================================
function mfn_GetCcMonthClsYn(strOrgType, strOrg, strMonth, strGubun)
{
	fn_sql_common("P", "SELECT MAS_GET_CLOSE_MONTH_FUN('" + strOrgType + "', '" + strOrg + "','" + strMonth + "','" + strGubun + "') FROM DUAL");
}
]]></Script>
