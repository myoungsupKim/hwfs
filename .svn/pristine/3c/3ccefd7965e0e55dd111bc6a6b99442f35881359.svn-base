<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="../../../default_typedef.xml"/>
  <Form id="FMU00090E" onkeydown="fn_FormKeyDown" onload="form_onload" titletext="공급업체 단가작업" position="absolute 0 0 1252 725" scrollbars="none">
    <Layouts>
      <Layout>
        <Static id="sta_detail05" class="sta_WFDA_Labelbg" position="absolute 0 112 1237 139" anchor="left top right"/>
        <Static id="Static29" class="sta_WFSA_Labelbg" position="absolute 0 30 1237 97" anchor="left top right"/>
        <Div id="div_cmnBtn" anchor="left top right" taborder="42" url="cmn::CmnBtn.xfdl" text="Div00" scrollbars="none" position="absolute 0 0 1237 30"/>
        <Grid autoenter="select" binddataset="ds_List" cellmovingtype="col" cellsizingtype="both" readonly="false" enable="true" id="gd_list" useinputpanel="false" selecttype="row" onheadclick="gd_list_OnHeadClick" taborder="17" tabstop="true" usecontextmenu="true" useselcolor="true" visible="true" wheelscrollrow="1" position="absolute 0 154 1237 712" autofittype="col" anchor="all">
          <Formats>
            <Format id="Default">
              <Columns>
                <Column size="31"/>
                <Column size="25"/>
                <Column size="100"/>
                <Column size="300"/>
                <Column size="200"/>
                <Column size="50"/>
                <Column size="90"/>
                <Column size="90"/>
                <Column size="90"/>
                <Column size="90"/>
                <Column size="90"/>
                <Column size="53"/>
              </Columns>
              <Rows>
                <Row size="26" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell displaytype="text" text="No."/>
                <Cell col="1" displaytype="checkbox" edittype="checkbox"/>
                <Cell col="2" displaytype="text" text="상품코드"/>
                <Cell col="3" displaytype="text" text="상     품     명"/>
                <Cell col="4" displaytype="text" text="규     격"/>
                <Cell col="5" displaytype="text" text="단위"/>
                <Cell col="6" displaytype="text" text="시작일자"/>
                <Cell col="7" displaytype="text" text="종료일자"/>
                <Cell col="8" displaytype="text" text="이전 판매단가"/>
                <Cell col="9" displaytype="text" text="매입원가"/>
                <Cell col="10" displaytype="text" text="판매단가"/>
                <Cell col="11" displaytype="text" text="사용"/>
              </Band>
              <Band id="body">
                <Cell celltype="head" displaytype="number" style="align:right;" expr="expr:currow + 1"/>
                <Cell col="1" displaytype="checkbox" edittype="checkbox" style="align: ;" text="bind:CHK"/>
                <Cell col="2" displaytype="text" style="align:center;" text="bind:ITEM_CODE"/>
                <Cell col="3" displaytype="text" style="align:left;" text="bind:ITEM_NAME"/>
                <Cell col="4" displaytype="text" style="align:left;" text="bind:ITEM_SIZE"/>
                <Cell col="5" displaytype="text" style="align:center;" text="bind:PO_UOM"/>
                <Cell col="6" displaytype="date" style="align:center;" text="bind:SDATE" mask="####-##-##" calendardisplaynulltype="none"/>
                <Cell col="7" displaytype="date" style="align:center;" text="bind:EDATE" mask="####-##-##" calendardisplaynulltype="none"/>
                <Cell col="8" displaytype="number" style="align:right;" text="bind:PRE_SALE_PRICE"/>
                <Cell col="9" displaytype="number" edittype="text" editfilter="number" style="align:right;background:lightyellow;background2:lightyellow;" text="bind:UNIT_PRICE" mask="#,##0" editautoselect="true"/>
                <Cell col="10" displaytype="number" edittype="text" editfilter="number" style="align:right;background:lightyellow;background2:lightyellow;" text="bind:SALE_PRICE" mask="#,##0" editautoselect="true"/>
                <Cell col="11" displaytype="combo" edittype="combo" style="align:center;background:lightyellow;background2:lightyellow;" text="bind:USE_YN" combodataset="ds_Yn" combocodecol="CD" combodatacol="NM"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <MPFileDialog id="fd_Excel" taborder="19" position="absolute 1256 95 1280 119"/>
        <Div id="div_Error" taborder="20" text="Div0" visible="false" position="absolute 152 226 1099 561" scrollbars="none" class="div_WF_Pop">
          <Layouts>
            <Layout width="923" height="331">
              <Grid binddataset="ds_ErrLst" cellmovingtype="col" cellsizingtype="both" enable="true" id="grd_ErrLst" useinputpanel="false" onheadclick="gd_list_OnHeadClick" taborder="2" tabstop="true" usecontextmenu="true" useselcolor="true" visible="true" wheelscrollrow="1" position="absolute 15 33 930 318" readonly="true" selecttype="row" anchor="default" autofittype="col">
                <Formats>
                  <Format id="Default">
                    <Columns>
                      <Column size="30"/>
                      <Column size="704"/>
                      <Column size="146"/>
                    </Columns>
                    <Rows>
                      <Row size="26" band="head"/>
                      <Row size="24"/>
                    </Rows>
                    <Band id="head">
                      <Cell displaytype="text" text="No."/>
                      <Cell col="1" displaytype="text" text="오류내용"/>
                      <Cell col="2" displaytype="text" text="오류코드"/>
                    </Band>
                    <Band id="body">
                      <Cell celltype="head" displaytype="text" style="align:right;" expr="expr:currow + 1"/>
                      <Cell col="1" displaytype="text" edittype="normal" style="align:left;" text="bind:errmsg"/>
                      <Cell col="2" displaytype="text" style="align:left;" text="bind:errcode"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
              <Button id="btn_Hidden" onclick="div_Error_btn_Hidden_OnClick" taborder="3" text="확인" position="absolute 889 8 930 28" class="btn_WF_Function" image="" anchor="default"/>
              <Static id="Static5" text="오류목록" position="absolute 16 15 139 36" class="sta_WF_Title01" anchor="default"/>
            </Layout>
          </Layouts>
        </Div>
        <Static id="Static7" text="이전 판매단가(       )%" position="absolute 729 115 883 136" anchor="top right"/>
        <Edit autoselect="true" id="ed_Per" inputtype="number" taborder="12" tabstop="false" value="100" position="absolute 811 115 837 136" style="align:right;" anchor="top right"/>
        <Button id="btn_Per" onclick="btn_Per_OnClick" taborder="13" tabstop="false" text="판매단가 적용" position="absolute 855 115 955 136" class="btn_WF_Custom" image="" anchor="top right"/>
        <Radio codecolumn="code" columncount="2" datacolumn="name" id="rd_UpDown" index="-1" innerdataset="ds_Radio" taborder="14" value="10" position="absolute 987 116 1125 137" anchor="top right"/>
        <Button id="btn_Up" onclick="btn_Up_OnClick" taborder="15" tabstop="false" text="절상" position="absolute 1129 115 1180 136" class="btn_WF_Custom" image="" anchor="top right"/>
        <Button id="btn_Down" onclick="btn_Up_OnClick" taborder="16" tabstop="false" text="절하" position="absolute 1182 115 1233 136" class="btn_WF_Custom" image="" anchor="top right"/>
        <TextArea id="ta_Sql" readonly="true" taborder="40" tabstop="false" visible="false" position="absolute 381 0 495 30"/>
        <Static id="Static71" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 710 1252 725" anchor="left bottom"/>
        <Static id="Static17" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 139 450 154"/>
        <Static id="Static01" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 167 228 617 241"/>
        <Static id="Static10" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 167 256 1121 261"/>
        <Static id="Static06" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1237 0 1252 710" anchor="top right"/>
        <Static id="Static13" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1283 8 1298 718" anchor="top right"/>
        <Static id="Static14" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1660 16 1675 726" anchor="top right"/>
        <Static id="Static19" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 1292 80 1744 95" anchor="left bottom"/>
        <Static id="Static00" text="h15" class="Guide01_AreaRed" visible="false" position="absolute -1 97 1251 112" anchor="left bottom"/>
        <Static id="Static18" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 175 546 1025 561"/>
        <Static id="Static20" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 154 216 169 622" anchor="top right"/>
        <Static id="Static22" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1084 208 1099 614" anchor="top right"/>
        <Static id="st_Otcust" text="공급업체" class="sta_WFSA_label" position="absolute 527 40 587 61" userdata="strQuery_FMOtcust"/>
        <Static id="Static2" text="시작일자" class="sta_WFSA_label" position="absolute 15 66 75 87"/>
        <Static id="st_MainUpjang" text="본사" class="sta_WFSA_label" position="absolute 15 40 76 61" userdata="strQuery_FMMainUpjang"/>
        <Static id="Static12" text="파일" class="sta_WFSA_label" position="absolute 268 66 329 87"/>
        <Static id="st_PriceUpjang" text="대표사업장" class="sta_WFSA_label" position="absolute 268 40 347 61" userdata="strQuery_FMUpjang"/>
        <Static id="Static15" text="단가목록" class="sta_WFSA_label" position="absolute 780 40 854 61"/>
        <Edit id="ed_Otcust" taborder="4" readonly="true" autoselect="true" onkeydown="fn_edBtn_OnKeyDown" position="absolute 595 40 730 61" class="edt_WF_Essential"/>
        <Button id="btn_Otcust" taborder="5" tabstop="false" onclick="fn_edBtn_OnClick" class="btn_WF_popSearchEssential" position="absolute 729 40 750 61"/>
        <Edit id="ed_MainUpjang" taborder="0" readonly="true" autoselect="true" onkeydown="fn_edBtn_OnKeyDown" position="absolute 83 40 219 61" class="edt_WF_Essential"/>
        <Button id="btn_MainUpjang" taborder="1" tabstop="false" onclick="fn_edBtn_OnClick" class="btn_WF_popSearchEssential" position="absolute 218 40 239 61"/>
        <Edit id="ed_PriceUpjang" taborder="2" readonly="true" autoselect="true" onkeydown="fn_edBtn_OnKeyDown" position="absolute 350 40 477 61" class="edt_WF_Essential"/>
        <Button id="btn_PriceUpjang" taborder="3" tabstop="false" onclick="fn_edBtn_OnClick" class="btn_WF_popSearchEssential" position="absolute 476 40 497 61"/>
        <Combo id="cbo_OtcustPrice" taborder="6" innerdataset="ds_PriceListO" codecolumn="SDATE" datacolumn="SDATE_D" onitemchanged="cbo_OtcustPrice_OnChanged" position="absolute 847 40 963 61"/>
        <MaskEdit id="me_Sdate" taborder="7" type="string" mask="####-##-##" onsetfocus="g_Date_OnFocus" onkillfocus="g_Date_OnKillFocus" oneditclick="g_Date_OnFocus" position="absolute 83 66 161 87"/>
        <Button id="btn_Sdate" taborder="8" tabstop="false" onclick="g_CalButton_OnClick" class="btn_WF_cal" position="absolute 160 66 182 87" userdata="me_Sdate"/>
        <Edit id="ed_File" taborder="9" tabstop="false" readonly="true" autoselect="true" position="absolute 350 66 577 87"/>
        <Button id="btn_ExlImp" taborder="53" tabstop="false" text="엑셀 불러오기" onclick="fn_Exl_Import" class="btn_WF_Custom" position="absolute 594 66 693 87"/>
        <Button id="btn_ExlExp" taborder="54" tabstop="false" text="엑셀 양식생성" onclick="fn_Exl_Export" class="btn_WF_Custom" position="absolute 695 66 794 87"/>
        <Button id="btn_UpjangLst" taborder="55" tabstop="false" text="단가그룹 조회" onclick="btn_UpjangLst_OnClick" class="btn_WF_Custom" position="absolute 796 66 907 87"/>
        <Button id="btn_MultiUpj" taborder="56" tabstop="false" text="다중업장 등록" onclick="btn_MultiUpj_OnClick" class="btn_WF_Custom" position="absolute 909 66 1008 87"/>
        <Static id="Static34" text="W10" visible="false" position="absolute 585 40 595 61" style="background:#ff000055;align:center middle;"/>
        <Static id="Static43" text="W10" visible="false" position="absolute 15 30 278 40" style="background:#ff000055;align:center middle;"/>
        <Static id="Static03" text="W30" visible="false" position="absolute 238 40 268 61" style="background:#ff000055;align:center middle;"/>
        <Static id="Static02" text="W10" visible="false" position="absolute 73 40 83 61" style="background:#ff000055;align:center middle;"/>
        <Static id="Static05" text="W30" visible="false" position="absolute 497 40 527 61" style="background:#ff000055;align:center middle;"/>
        <Static id="Static08" text="W10" visible="false" position="absolute 340 40 350 61" style="background:#ff000055;align:center middle;"/>
        <Static id="Static09" text="W30" visible="false" position="absolute 750 40 780 61" style="background:#ff000055;align:center middle;"/>
        <Static id="Static11" text="W10" visible="false" position="absolute 837 40 847 61" style="background:#ff000055;align:center middle;"/>
        <Static id="Static04" text="W10" visible="false" position="absolute 73 66 83 87" style="background:#ff000055;align:center middle;"/>
        <Static id="Static21" text="W30" visible="false" position="absolute 238 66 268 87" style="background:#ff000055;align:center middle;"/>
        <Static id="Static23" text="W10" visible="false" position="absolute 340 66 350 87" style="background:#ff000055;align:center middle;"/>
        <Static id="Static51" text="W05." visible="false" position="absolute 15 61 248 66" style="background:#ff000055;align:center middle;"/>
        <Static id="Static30" text="W15" visible="false" position="absolute 1222 29 1237 96" style="background:#ff000055;align:center middle;"/>
        <Static id="Static45" text="W15" visible="false" position="absolute 0 30 15 97" style="background:#ff000055;align:center middle;"/>
        <Static id="Static44" text="W10" visible="false" position="absolute 15 87 278 97" style="background:#ff000055;align:center middle;"/>
        <Combo displayrowcount="10" id="cbo_" imemode="none" index="1" taborder="41" position="absolute 706 115 805 136" codecolumn="codecolumn" datacolumn="datacolumn" anchor="top right">
          <Dataset id="innerdataset">
            <ColumnInfo>
              <Column id="codecolumn" size="256"/>
              <Column id="datacolumn" size="256"/>
            </ColumnInfo>
            <Rows>
              <Row>
                <Col id="codecolumn">PRE_SALE_PRICE</Col>
                <Col id="datacolumn">이전 판매단가</Col>
              </Row>
              <Row>
                <Col id="codecolumn">UNIT_PRICE</Col>
                <Col id="datacolumn">매입원가</Col>
              </Row>
            </Rows>
          </Dataset>
        </Combo>
        <Div id="dv_MultiUpj" taborder="39" tabstop="false" text="Div0" visible="false" position="absolute 1283 96 1675 473" class="div_WFGRD_graybg" scrollbars="none">
          <Layouts>
            <Layout>
              <Grid autoenter="select" binddataset="ds_MultiUpj" cellmovingtype="col" cellsizingtype="both" readonly="false" enable="true" id="gd_list" useinputpanel="false" selecttype="row" onheadclick="gd_list_OnHeadClick" taborder="1" tabstop="true" usecontextmenu="true" useselcolor="true" visible="true" wheelscrollrow="1" position="absolute 14 38 376 329" anchor="default" autofittype="col">
                <Formats>
                  <Format id="Default">
                    <Columns>
                      <Column size="60"/>
                      <Column size="180"/>
                      <Column size="60"/>
                      <Column size="30"/>
                    </Columns>
                    <Rows>
                      <Row size="26" band="head"/>
                      <Row size="24"/>
                    </Rows>
                    <Band id="head">
                      <Cell text="사업장"/>
                      <Cell col="1" text="사업장명"/>
                      <Cell col="2" displaytype="text" text="기등록건"/>
                      <Cell col="3" displaytype="checkbox" edittype="checkbox"/>
                    </Band>
                    <Band id="body">
                      <Cell displaytype="text" style="align:center;" text="bind:UPJANG"/>
                      <Cell col="1" displaytype="text" style="align:left;" text="bind:UPJANGNM_DISP" editimemode="native"/>
                      <Cell col="2" displaytype="number" style="align: ;" text="bind:SAVE_CNT" mask="#,##0"/>
                      <Cell col="3" displaytype="checkbox" edittype="checkbox" style="align: ;" text="bind:CHK"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
              <Static id="Static0" text="☞ 해당 일자에 이미 단가가 등록된 사업장은" position="absolute 15 333 259 346" anchor="default"/>
              <Static id="Static2" text="해당 품목은 초기화되고 저장됩니다." position="absolute 31 350 267 363" anchor="default"/>
              <Button id="btn_Hidden" onclick="dv_MultiUpj_btn_Hidden_OnClick" taborder="4" text="등록저장" position="absolute 312 340 376 361" class="btn_WF_Custom" image="" anchor="default"/>
              <Static id="Static23" text="☞ 복사할 사업장을 선택하세요." position="absolute 14 14 376 36" style="background:#f2eee5ff;" anchor="default"/>
              <Button id="btn_CloseDiv" taborder="5" text="닫기" class="btn_WF_Custom" position="absolute 266 340 308 361" anchor="default" onclick="dv_MultiUpj_btn_CloseDiv_onclick"/>
            </Layout>
          </Layouts>
        </Div>
        <Static id="Static16" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 1294 458 1746 473" anchor="left bottom"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_Cond">
        <ColumnInfo>
          <Column id="CUSER" size="9" type="STRING"/>
          <Column id="SDATE" size="8" type="STRING"/>
          <Column id="UPJANG" size="22" type="INT"/>
          <Column id="OTCUSTCD" size="50" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_Excel"/>
      <Dataset id="ds_Radio">
        <ColumnInfo>
          <Column id="code" size="256" type="INT"/>
          <Column id="name" size="256" type="STRING"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="code">10</Col>
            <Col id="name">1원단위</Col>
          </Row>
          <Row>
            <Col id="code">100</Col>
            <Col id="name">10원단위</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_PriceListO">
        <ColumnInfo>
          <Column id="SDATE" size="8" type="STRING"/>
          <Column id="SDATE_D" size="14" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_List">
        <ColumnInfo>
          <Column id="CHK" size="256" type="STRING"/>
          <Column id="CUSER" size="9" type="STRING"/>
          <Column id="EDATE" size="8" type="STRING"/>
          <Column id="ITEM_CODE" size="50" type="STRING"/>
          <Column id="ITEM_NAME" size="200" type="STRING"/>
          <Column id="ITEM_SIZE" size="100" type="STRING"/>
          <Column id="PO_UOM" size="10" type="STRING"/>
          <Column id="PRE_UNIT_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="PRE_SALE_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="UNIT_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="SALE_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="SDATE" size="8" type="STRING"/>
          <Column id="USE_YN" size="1" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_ErrLst">
        <ColumnInfo>
          <Column id="errmsg" size="500" type="STRING"/>
          <Column id="errcode" size="100" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_Yn">
        <ColumnInfo>
          <Column id="CD" size="256" type="STRING"/>
          <Column id="NM" size="256" type="STRING"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="CD">1</Col>
            <Col id="NM">Y</Col>
          </Row>
          <Row>
            <Col id="CD">0</Col>
            <Col id="NM">N</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_MultiUpj">
        <ColumnInfo>
          <Column id="UPJANG" size="255" type="STRING"/>
          <Column id="UPJANGNM_DISP" size="255" type="STRING"/>
          <Column id="SAVE_CNT" size="22" type="BIGDECIMAL"/>
          <Column id="CHK" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_ListTmp"/>
    </Objects>
    <Bind>
      <BindItem id="item5" compid="sta_detail05" propid="text" datasetid="ds_view" columnid="D_1"/>
    </Bind>
    <Script type="xscript4.0"><![CDATA[include "U_lib::lib_conversionCom.xjs";
/*
 ******************************************************************************************
 * 시스템구분   : 식재영업/단가관리/공급업체관리/공급업체 단가작업
 * 프로그램명   : FMU00090E.XML
 * 기      능   : 공급업체 단가작업
 * 작  성  자   : 박은규
 * 작성  일자   : 2007-12-12
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
*/
//=========================================================================================
// [ PART 1 ]
// Form에서 Include 할 내용을 정의
//
//=========================================================================================
//@@컨버터에서 주석처리 #include "lib::sc_comon.js"				// 시스템 공통
//@@컨버터에서 주석처리 #include "LIB::lib_comm_0001.js"		//JAVA 코딩시
//@@컨버터에서 주석처리 #include "LIB::tit_comm_0001.js"		// X-Framework Lib
//@@컨버터에서 주석처리 #include "lib::sc_sql_common.js"		// 공통팝업
//@@컨버터에서 주석처리 #include "lib::fm_common.js"			// FM공통
//=========================================================================================
// [ PART 2 ]
// Form에서 사용될 전역변수를 선언
//
//=========================================================================================
var fa_Sql;
//=========================================================================================
// [ PART 3 ]
// Form Loading 시 작업 정의
//=========================================================================================
function form_onload(obj:Form, e:LoadEventInfo)
{
	gfn_formOnLoad(obj, false);

	//초기화
   	fsp_init(this);
   	v_ds_check = "ds_List";
   	//ta_Sql.Visible = (global.g_AuthLevel == "999");

	//본부직원은 모든 본사/공급업체 가능,  본사직원은 공급업체만 조회가능,  공급업체직원은 본사만 조회가능
	btn_MainUpjang.enable  = ((application.g_UserKind == '본부') || (application.g_UserGroup == '공급업체'));
	btn_Otcust.enable      = ((application.g_UserKind == '본부') || (application.g_UserKind == '본사'));
	ed_MainUpjang.enable   = btn_MainUpjang.enable;
	ed_Otcust.enable       = btn_Otcust.enable;
	ed_MainUpjang.userdata = application.g_Main_Upjang;
	ed_MainUpjang.value     = application.g_Main_UpjangNm;
	ed_Otcust.userdata     = application.g_OtCustCd;
	ed_Otcust.value         = application.g_OtCustNm;
	
	decode(application.g_OtCustNm == "[Undefined]",ed_Otcust.value="",application.g_OtCustNm);
	
	//
	div_Error.position.left = 152; div_Error.position.top = 226;
	div_Error.position.right = 1099; div_Error.position.bottom = 561;
	dv_MultiUpj.position.left = 845; dv_MultiUpj.position.top = 96;
	dv_MultiUpj.position.right = 1237; dv_MultiUpj.position.bottom = 473;
	//

	me_Sdate.value = fn_CurrDateWeek();
	
	if (ed_MainUpjang.enable) ed_MainUpjang.setFocus();
	else if (ed_PriceUpjang.enable) ed_PriceUpjang.setFocus();
	else if (ed_Otcust.enable) ed_Otcust.setFocus();
	
}

//=========================================================================================
// [ PART 4 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,도움말,form닫기)
//
//=========================================================================================
/*------------------------------------------------------------(60)
	1. Function ID : fn_Search()
	2. 개       요 : 업무프로세스에 따른 조회작업
	3. 기       능 : 검색조건에 해당하는 정보를 조회
	4. 인 수 설 명 : 
*/
function fn_search()
{
	//필수항목 
	var sRtn = fn_ChkManNull();
	if (sRtn != null)
	{
		g_Message("EE", sRtn);
		return;
	}

	// 초기화
	ds_Cond.clearData();
	ds_List.clearData();
	ds_Cond.addRow();
	ds_Cond.setColumn(0, "UPJANG", ed_PriceUpjang.userdata);
	ds_Cond.setColumn(0, "OTCUSTCD", ed_Otcust.userdata);
	ds_Cond.setColumn(0, "SDATE", me_Sdate.value);
	ds_Cond.setColumn(0, "CUSER", application.g_EmpNo);
	
	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	// 파라미터셋팅
    inData		= "ds_Cond=ds_Cond";
    outData		= "ds_List=ds_List";
    callBackFnc	= "fn_CallBack_Search";
	
	//action 정보 초기화 
	fsp_clear(this); 
    // 서버에서 조회할 정보 추가 
    //if (cbo_OtcustPrice.Index == 0)
		fsp_addSearch(this, "fm/fmu:FMU00090E_S001");
	//else
		//tit_addSearchActionInfo(this, "fm/fmu:FMU00090E_S002");
	// 서버 호출 
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);		// 서비스 호출 
}

/*------------------------------------------------------------
	1. Function ID : fn_Insert()
	2. 개       요 : 업무프로세스에 따른 입력작업
	3. 기       능 : 입력버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*/
function fn_insert()
{
	//신규입력 상태로
	cbo_OtcustPrice.index = 0;
	fn_Cbo_OnChanged(cbo_OtcustPrice,0);
}

/*------------------------------------------------------------
	1. Function ID : fn_Delete()
	2. 개       요 : 업무프로세스에 따른 입력작업
	3. 기       능 : 입력버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*/
function fn_delete()
{
	if (ds_List.rowcount < 1)
	{
		g_Message("EE", fn_AlertMsg("006"));
		return;
	}
	if (! g_Confirm("01", '선택하신 데이터를 삭제하시겠습니까?!')) return;
	
	//ds_List.deleteSelectedRows();
	for ( var i=ds_List.rowcount-1; i>=0; i-- ) {
		if ( ds_List.getColumn(i, "CHK") == "1" ) { 
			ds_List.deleteRow(i);
		}
	}
}

/*------------------------------------------------------------
	1. Function ID : fn_Save()
	2. 개       요 : 업무프로세스에 따른 입력작업
	3. 기       능 : 입력버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*/
function fn_save(vsUpjang)
{
	var sRtn = fn_ChkManNull();
	if (sRtn != null)
	{
		g_Message("EE", sRtn);
		return;
	}
	//데이타체크
	var sRtn = fn_ChkData();
	if (sRtn != null)
	{
		g_Message("EE", sRtn);
		return;
	}
	//다중업장 복사일 경우는 데이터변경 여부 체크 불필요
	if (ffn_ChkNull(vsUpjang))
	{
		// 변경여부 확인
		if(! gfn_dsIsUpdated(ds_List))
		{
			g_Message("EE", fn_AlertMsg("007"));
			return;
		}
		if (! g_Confirm("02", '변경사항을 저장하시겠습니까?!')) return;
	}

	//이전단가와 같은 품목은 제외...(이러면 단가표에서 빠지게 되는데.. 다 넣다보면 쓸데없이 데이타가 많아지고..)
	//다중업장 복사할 때 다른 업장의 경우는 이전단가가 틀릴 수 있어서 무조건 조회업장 기준으로 제외하면 안된다.
	//다중업장 복사가 아닐 때만 제외하는 것으로 해도 되지만 일단 주석처리...
	//if (ffn_ChkNull(vsUpjang))
		//fn_RmvEqual();

   	// action 정보 초기화
    fsp_clear(this);
	// 초기화
	ds_Cond.clearData();
	ds_Cond.addRow();
	//다중업장 복사의 경우 매게변수로 넘어온 업장 사용
	if (ffn_ChkNull(vsUpjang))
		ds_Cond.setColumn(0, "UPJANG", ed_PriceUpjang.userdata);
	else
		ds_Cond.setColumn(0, "UPJANG", vsUpjang);
	ds_Cond.setColumn(0, "OTCUSTCD", ed_Otcust.userdata);
	ds_Cond.setColumn(0, "SDATE", me_Sdate.value);
	// 파라미터셋팅
    // 서비스셋팅
    var actionName, cmdName, inData, outData, otherArg, callBackFnc;
    var singleSql, sqlId, insertSql, updateSql, deleteSql, saveFlagColumn, keySqlName, keyIncrement, callbackSql;
	//다중업장 복사의 경우 선택된 품목만 필터링한 별도의 품목 데이터셑 사용
	if (ffn_ChkNull(vsUpjang))
		inData		= "ds_IUD=ds_List ds_Cond=ds_Cond";
	else
		inData		= "ds_IUD=ds_ListTmp ds_Cond=ds_Cond";
    //outData		= "ds_List=ds_List";
	//다중업장 복사의 경우 콜백 스킵...
	if (ffn_ChkNull(vsUpjang))
		callBackFnc	= "fn_CallBack_Save";
	// 단일처리 Sql셋팅
	//singleSql	= "fm/fmu:FMU00090E_D001"; //단가정보 초기화
    // 서버에서 작업할 단일 처리 SaveAction 정보 생성 
	//tit_addSingleActionInfo(this, SingleSql, keySqlName, keyIncrement, callbackSql);
	// 다중처리 Sql셋팅
	sqlId	= "fm/fmu:FMU00090E_D001"; //단가정보 삭제
    // 서버에서 작업할 다중 처리 Action 정보 생성 
    fsp_addMulti(this, sqlId, keySqlName, keyIncrement, callbackSql);
	// 다중처리 Sql셋팅
	sqlId	= "fm/fmu:FMU00090E_U001"; //이전 단가 종료일 세팅
    // 서버에서 작업할 다중 처리 Action 정보 생성 
    fsp_addMulti(this, sqlId, keySqlName, keyIncrement, callbackSql);
	// 다중처리 Sql셋팅
	sqlId	= "fm/fmu:FMU00090E_I001"; //단가정보 입력
    // 서버에서 작업할 다중 처리 Action 정보 생성
    fsp_addMulti(this, sqlId, keySqlName, keyIncrement, callbackSql);
/*
	// 다중처리 Sql셋팅
    insertSql	= "fm/fmu:FMU00090E_I001";
    updateSql	= "";
    deleteSql	= "";
    saveFlagColumn = "";
    //callbackSql	= "fm/fmu:FMU00090E_S002";
    // 서버에서 작업할 다중 처리 SaveAction 정보 생성 
    tit_addSaveActionInfo(this, insertSql, updateSql, deleteSql, saveFlagColumn, keySqlName, keyIncrement, callbackSql);
*/
	// 서버 호출
	var bSync = http.Sync;
	http.Sync = true;
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);		// 서비스 호출 
	http.Sync = bSync;
}

/*------------------------------------------------------------
	1. Function ID : fn_Print()
	2. 개       요 : 업무프로세스에 따른 입력작업
	3. 기       능 : 입력버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*/
function fn_print()
{
}

/*------------------------------------------------------------
	1. Function ID : fn_Close()
	2. 개       요 : 업무프로세스에 따른 입력작업
	3. 기       능 : 입력버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*/
function fn_Close()
{
	This.close();
}

/*------------------------------------------------------------
	1. Function ID : fn_Help()
	2. 개       요 : 업무프로세스에 따른 입력작업
	3. 기       능 : 입력버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*/
function fn_help()
{
}

//=========================================================================================
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
//
//=========================================================================================
/*------------------------------------------------------------
	1. Function ID : fn_AlertMsg(cd)
	2. 개       요 : 메세지 처리
	3. 기       능 : 화면에 나타나는 메시지 코드및 텍스트 리턴
	4. 인 수 설 명 : cd : 원하는 메시지 코드
*/
function fn_AlertMsg(cd)
{
	var v_Msg="";
	switch(cd)
	{
		case "000":
			v_Msg= "이(가) 저장되었습니다.";
			break;
		case "001":
			v_Msg= "버튼이 정의 되어 있지않습니다.";
			break;
		case "002":
			v_Msg="서비스 오류:시스템 관리자에게 문의하십시오";
			break;
		case "003":
			v_Msg="필수항목은 반드시 선택하시기 바랍니다.";
			break;	
		case "004":
			v_Msg="작업대상 본사를 선택하세요.";
			break;
		case "005":
			v_Msg="을(를) 입력하세요";
			break;
		case "006":
			v_Msg="삭제할 데이터가 없습니다.";
			break;
		case "007":
			v_Msg="변경된 데이터가 없습니다.";
			break;
		case "008":
			v_Msg="시스템ID가 없습니다.";
			break;			
/*			
		case "":
			v_Msg="";
			break;
*/			
		default:
			break;			
	}
	return v_Msg;
}

//=========================================================================================
// [ PART 6 ]
// component Event 정의 ( User Define function )
// --> component Event의 기요,기능,동작 등 상세내용은 MiPlatform 메뉴얼을 참조하시기 바랍니다.
//=========================================================================================
//콜백
function fn_CallBack_Search(errCode, errMsg)
{
	if (errCode == 0)
	{
		if (ds_List.rowcount == 0)
			g_Message("EE","단가계약 대상자료가 존재하지 않습니다.");
		else
			gd_list.setFocus();
	}
	else
		g_Message("EE",fn_AlertMsg("002"));
}

function fn_CallBack_Save(errCode, errMsg)
{
	if (errCode == 0)
	{
		g_Message("02","단가작업" + fn_AlertMsg("000"));
		
		var nRow = ds_PriceListO.findRowExpr("SDATE=='" + me_Sdate.value + "'");
		if (nRow < 0)
		{
			var iRow = ds_PriceListO.insertRow(1);
			ds_PriceListO.setColumn(iRow, 0, me_Sdate.value);
			ds_PriceListO.setColumn(iRow, 1, gfn_subStr(me_Sdate.value,0,4)+ "년" + gfn_subStr(me_Sdate.value,4,2)+ "월" + gfn_subStr(me_Sdate.value,6,2)+ "일");
			nRow = ds_PriceListO.rowposition;
		}
		cbo_OtcustPrice.index = nRow;
		fn_Cbo_OnChanged(cbo_OtcustPrice,nRow);
		fn_search();
	}
	else
		g_Message("EE",fn_AlertMsg("002"));
}

function fn_ChkManNull()
{
	//필수항목 
	if (ffn_ChkNull(ed_PriceUpjang.userdata))
	{
		ed_PriceUpjang.setFocus();
		return "대표사업장" + fn_AlertMsg("005");
	}
	if (ffn_ChkNull(ed_Otcust.userdata))
	{
		ed_Otcust.setFocus();
		return "공급업체" + fn_AlertMsg("005");
	}
	if (ffn_ChkNull(me_Sdate.value) || (gfn_length(gfn_trim(me_Sdate.value))< 8))
	{
		if (me_Sdate.enable) me_Sdate.setFocus();
		return "시작일자" + fn_AlertMsg("005");
	}
}

function fn_ChkData()
{
/*
	// 변경여부 확인
	if(! ds_List.GetUpdate())
	{
		return fn_AlertMsg("007");
	}
*/
}

function fn_RmvEqual()
{
	for (var i=ds_List.rowcount-1; i>=0; i--)
	{
		//if (ds_List.GetColumn(i, "PRE_SALE_PRICE") == ds_List.GetColumn(i, "SALE_PRICE"))
		if ((ds_List.getColumn(i, "PRE_SALE_PRICE") == ds_List.getColumn(i, "SALE_PRICE")) &&
			(ds_List.getColumn(i, "PRE_UNIT_PRICE") == ds_List.getColumn(i, "UNIT_PRICE")))
			ds_List.deleteRow(i);
	}
	if (ds_List.rowcount > 0) ds_List.rowposition = 0;
}

function fn_PriceList()
{
	ds_Cond.clearData();
	ds_PriceListO.clearData();
	ds_Cond.addRow();
	ds_Cond.setColumn(0, "UPJANG", ed_PriceUpjang.userdata);
	ds_Cond.setColumn(0, "OTCUSTCD", ed_Otcust.userdata);
	
	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	
	// 파라미터셋팅
    inData		= "ds_Cond=ds_Cond";
    outData		= "ds_PriceListO=ds_PriceListO";
	callBackFnc = "fn_CallBack_Price";
	//action 정보 초기화 
	fsp_clear(this); 
    // 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "fm/fmu:FMU00090E_S003");
	// 서버 호출 
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);		// 서비스 호출 
}

function fn_CallBack_Price(errCode, errMsg)
{
	ds_PriceListO.insertRow(0);
	ds_PriceListO.setColumn(0, 0, "");
	ds_PriceListO.setColumn(0, 1, "신규단가");
	cbo_OtcustPrice.index = 0;
}					

function fn_FormKeyDown(obj:Form, e:KeyEventInfo)
{
	gfn_formKeyDown(obj, e); //(obj,e.fromreferenceobject,e.keycode,e.shiftKey,e.ctrlKey,e.altKey,-1,-1);
	if (e.keycode == 13)
	{
		if (e.fromreferenceobject == me_Sdate) fn_search();
		else if ((! me_Sdate.enable) && (e.fromreferenceobject == cbo_OtcustPrice)) fn_search();
	}
}

function gd_list_OnHeadClick(obj:Grid, e:GridClickEventInfo)
{
	gfn_gridSort(obj, e); //(eval(obj.binddataset), obj, e.cell);
}


function fn_edBtn_OnClick(obj:Button, e:ClickEventInfo)
{
	var sAddWhere = "";
	
	switch(obj.name)
	{
		case "btn_Otcust":
			if (ffn_ChkNull(ed_MainUpjang.userdata))
			{
				g_Message("EE", fn_AlertMsg("004"));
				if (ed_MainUpjang.enable) ed_MainUpjang.setFocus();
				return;
			}
			if (ffn_ChkNull(ed_PriceUpjang.userdata))
			{
				g_Message("EE", "단가 대표사업장" + fn_AlertMsg("005"));
				if (ed_PriceUpjang.enable) ed_PriceUpjang.setFocus();
				return;
			}
			sAddWhere = " AND A.OTCUSTCD <> '0000' AND A.USE_YN = 'Y' AND EXISTS (SELECT 1 FROM FMP_OTCUST_LINK B WHERE B.OTCUSTCD = A.OTCUSTCD AND B.USE_YN = 'Y' AND B.UPJANG = " + ed_MainUpjang.userdata + ") ";
			sAddWhere += " AND NOT EXISTS (SELECT 1 FROM FMP_OTCUST_LINK Z WHERE Z.OTCUSTCD = A.OTCUSTCD AND Z.USE_YN = 'N' AND Z.UPJANG = " + ed_PriceUpjang.userdata + ") ";

			break;
			
		case "btn_MainUpjang":
			if ((application.g_UserGroup == '공급업체') && (ffn_ChkNull(ed_Otcust.userdata)))
			{
				g_Message("EE", "공급업체" + fn_AlertMsg("005"));
				if (ed_Otcust.enable) ed_Otcust.setFocus();
				return;
			}
			sAddWhere = " AND A.USE_YN = 'Y' AND A.MAIN_UPJANG = A.UPJANG ";
			//공급업체인 경우 해당 공급업체를 사용하는 본사만 조회
			if (application.g_UserGroup == '공급업체')
				sAddWhere += " AND EXISTS (SELECT 1 FROM FMP_OTCUST_LINK B WHERE B.UPJANG = A.UPJANG AND B.USE_YN = 'Y' AND B.OTCUSTCD = '" + ed_Otcust.userdata + "') ";

			break;
			
		case "btn_PriceUpjang":
			if (ffn_ChkNull(ed_MainUpjang.userdata))
			{
				g_Message("EE", fn_AlertMsg("004"));
				if (ed_MainUpjang.enable) ed_MainUpjang.setFocus();
				return;
			}
			sAddWhere = " AND A.USE_YN = 'Y' AND A.OTCUST_PRICE_UPJANG = A.UPJANG AND A.MAIN_UPJANG = " + ed_MainUpjang.userdata;

			break;
			
		default:
		
			break;
	}
	//fm공통 팝업클릭 호출
	if (ffn_btn_OnClick(obj, sAddWhere)) fn_Trigger_edBtn(eval("ed_" + gfn_subStr(obj.name, 4)));
}

function fn_edBtn_OnKeyDown(obj:Edit, e:KeyEventInfo)
{
	if (ffn_ed_OnKeyDown(obj,e.keycode)) fn_Trigger_edBtn(obj);
}

function fn_Trigger_edBtn(obj)
{
	switch(obj)
	{
		case ed_Otcust:
			//ed_MainUpjang.UserData = "";  ed_MainUpjang.Text = "";
			//ed_PriceUpjang.UserData = ""; ed_PriceUpjang.Text = "";
			ds_PriceListO.clearData();
			ds_List.clearData();
			if ((! ffn_ChkNull(ed_PriceUpjang.userdata)) && (! ffn_ChkNull(ed_Otcust.userdata)))
				fn_PriceList();

			break;
			
		case ed_MainUpjang:
			//ed_Otcust.UserData = ""; ed_Otcust.Text = "";
			ed_PriceUpjang.userdata = ""; ed_PriceUpjang.value = "";
			ds_PriceListO.clearData();
			ds_List.clearData();

			break;
			
		case ed_PriceUpjang:
/*
			if (ffn_ChkNull(ed_PriceUpjang.UserData))
				ds_PriceListO.ClearData();
			else
				fn_PriceList();
*/
			ds_PriceListO.clearData();
			ds_List.clearData();
			if ((! ffn_ChkNull(ed_PriceUpjang.userdata)) && (! ffn_ChkNull(ed_Otcust.userdata)))
				fn_PriceList();

			break;
			
		default:
			break;
	}
}

function btn_Per_OnClick(obj:Button, e:ClickEventInfo)
{
	//선택 유무 체크
	if(ds_List.findRow("CHK",'1') < 0)
	{
		g_Message('EE',"선택대상이 없습니다!");
		return;
	}
 
	//비율 유무 체크
	if(ffn_ChkNull(ed_Per.value))
	{
		g_Message('EE',"적용율을 입력하세요.");
		ed_Per.setFocus();
		return;
	}
 
	//메세지 알림
	if(! g_Confirm('04', cbo_.text + " " + ed_Per.value + '%를 적용하시겠습니까?!')) return;
 
	//로직구현
	for (i=0; i<ds_List.rowcount; i++)
	{
		//체크한 항목만 가격 적용
		if(ds_List.getColumn(i,"CHK") == '1')
		{
			ds_List.setColumn(i, "SALE_PRICE", Math.round(ds_List.getColumn(i,cbo_.value) * toNumber(ed_Per.value) / 100));
		}
		//ds_List.SetColumn(i,"CHK",'0'); //체크 해제
	}
}

function btn_Up_OnClick(obj:Button, e:ClickEventInfo)
{
	var Dig = rd_UpDown.value;

	//선택 유무 체크
	if(ds_List.findRow("CHK",'1') < 0)
	{
		g_Message('EE',"선택대상이 없습니다!");
		return;
	}
 
	//메세지 알림
	if(! g_Confirm('04','일괄 절상/절하를 적용하시겠습니까?!')) return;
 
	//로직구현
	for (i=0; i<ds_List.rowcount; i++)
	{
		if(ds_List.getColumn(i,"CHK") == '1') //선택된 것만 적용
		{
			if (obj == btn_Up)
			{
				ds_List.setColumn(i, "UNIT_PRICE", Math.ceil(ds_List.getColumn(i,"UNIT_PRICE") / toNumber(Dig)) * toNumber(Dig));
				ds_List.setColumn(i, "SALE_PRICE", Math.ceil(ds_List.getColumn(i,"SALE_PRICE") / toNumber(Dig)) * toNumber(Dig));
			}
			else
			{
				ds_List.setColumn(i, "UNIT_PRICE", Math.floor(ds_List.getColumn(i,"UNIT_PRICE") / toNumber(Dig)) * toNumber(Dig));
				ds_List.setColumn(i, "SALE_PRICE", Math.floor(ds_List.getColumn(i,"SALE_PRICE") / toNumber(Dig)) * toNumber(Dig));
			}
		}
		//ds_List.SetColumn(i,"CHK",'0'); //체크 해제
	}
}

function cbo_OtcustPrice_OnChanged(obj:Combo, e:ItemChangeEventInfo)
{
	fn_Cbo_OnChanged(obj,e.postindex);
}

function fn_Cbo_OnChanged(obj,nIndex)
{
	ds_List.clearData();
	if ( nIndex == 0 )
	{
		//me_Sdate.Value = fn_CurrDateWeek();
		me_Sdate.enable = true;
		btn_Sdate.enable = true;
	}
	else
	{
		me_Sdate.value = obj.value;
		me_Sdate.enable = false;
		btn_Sdate.enable = false;
		//fn_Search();
	}
}

function fn_Exl_Export(obj:Button, e:ClickEventInfo)
{
	gfn_exportExcel(gd_list, "단가표양식");
}

function fn_Exl_Import(obj:Button, e:ClickEventInfo)
{
	//필수항목 
	if (ds_List.rowcount < 1)
	{
		g_Message("EE", "작업대상 자료가 없습니다. 조회 후 작업하세요.");
		return;
	}
	
	//엑셀 임포트
	fd_Excel.Type = "OPEN";
	//fd_Excel.Filter = "All(*.*)|*.*|Excel File(*.xls)|*.xls|";
	fd_Excel.Filter = "Excel File(*.xls;*.xlsx)|*.xls;*.xlsx|All(*.*)|*.*|";

	if( fd_Excel.Open() )
	{
		ed_File.value = fd_Excel.FilePath + '\\' + fd_Excel.FileName;
		//gd_list.Redraw = false;
		ds_Excel.clearData();
		//ext_ExcelImportByIndex(파일풀패스, 시트순번, 깡통데이타셑);
		ext_ExcelImportByIndex(ed_File.value, 0, "ds_Excel");
		fn_SetImpData();
		//gd_list.Redraw = true;
	}
}

function fn_SetImpData()
{
	var nRow, nCnt, sErrMsg, sErrCode;

	ds_ErrLst.clearData();
	for (i = 1; i < ds_Excel.rowcount; i++)
	{
		//상품코드 등록여부
		if (gfn_length(gfn_trim(ds_Excel.getColumn(i,"Col03")))== 0)
		{
			ds_ErrLst.addRow();
			ds_ErrLst.setColumn(ds_ErrLst.rowposition, "errmsg", numFormat(i+1)+ "행) 상품코드 미등록");
			continue;
		}
		//상품코드 존재여부
		nRow = ds_List.findRowExpr("ITEM_CODE=='" + ds_Excel.getColumn(i,"Col03") + "'");
		if (nRow < 0)
		{
			ds_ErrLst.addRow();
			ds_ErrLst.setColumn(ds_ErrLst.rowposition, "errmsg", numFormat(i+1)+ "행) 해당하는 상품코드(" + ds_Excel.getColumn(i,"Col03") + " " + ds_Excel.getColumn(i,"Col04") + ")를 찾을 수가 없습니다");
			continue;
		}
		//단가오류
		if (! isNumeric(ds_Excel.getColumn(i,"Col10")))
		{
			ds_ErrLst.addRow();
			ds_ErrLst.setColumn(ds_ErrLst.rowposition, "errmsg", numFormat(i+1)+ "행) " + ds_Excel.getColumn(i,"Col03") + " " + ds_Excel.getColumn(i,"Col04") + " 상품 단가오류(" + ds_Excel.getColumn(i,"Col10") + ")");
			continue;
		}
		if (! isNumeric(ds_Excel.getColumn(i,"Col11")))
		{
			ds_ErrLst.addRow();
			ds_ErrLst.setColumn(ds_ErrLst.rowposition, "errmsg", numFormat(i+1)+ "행) " + ds_Excel.getColumn(i,"Col03") + " " + ds_Excel.getColumn(i,"Col04") + " 상품 단가오류(" + ds_Excel.getColumn(i,"Col11") + ")");
			continue;
		}
		//사용여부 설정오류
		//if ((ds_Excel.GetColumn(i,"Col12") <> "0") && (ds_Excel.GetColumn(i,"Col12") <> "1"))
		if ((ds_Excel.getColumn(i,"Col12") <> "N") && (ds_Excel.getColumn(i,"Col12") <> "Y"))
		{
			ds_ErrLst.addRow();
			ds_ErrLst.setColumn(ds_ErrLst.rowposition, "errmsg", numFormat(i+1)+ "행) " + ds_Excel.getColumn(i,"Col03") + " " + ds_Excel.getColumn(i,"Col04") + " 상품 사용구분오류(" + ds_Excel.getColumn(i,"Col12") + ")");
			continue;
		}
		gd_list.enableredraw = false;
		ds_List.rowposition = nRow;
		//단가설정
		ds_List.setColumn(nRow, "UNIT_PRICE", iif(gfn_length(gfn_trim(ds_Excel.getColumn(i,"Col09")))==0,0,ds_Excel.getColumn(i,"Col10")));
		ds_List.setColumn(nRow, "SALE_PRICE", iif(gfn_length(gfn_trim(ds_Excel.getColumn(i,"Col10")))==0,0,ds_Excel.getColumn(i,"Col11")));
		//사용여부 설정
		//ds_List.SetColumn(nRow, "USE_YN", ds_Excel.GetColumn(i,"Col12"));
		ds_List.setColumn(nRow, "USE_YN", iif(ds_Excel.getColumn(i,"Col12")=="Y",1,0));
		gd_list.enableredraw = true;
	}
	ds_List.rowposition = 0;
	
	var sMsg;
	if (ds_ErrLst.rowcount < ds_Excel.rowcount)
	{
		sMsg = '정상적으로 업로드 되었습니다.';
		if (ds_ErrLst.rowcount > 0)
		{
			sMsg += '\n\n오류 데이타가 존재합니다.\n확인하시겠습니까?!';
			ds_ErrLst.rowposition = 0;
			div_Error.visible = (g_Confirm("04", sMsg));
			if (div_Error.visible) div_Error.grd_ErrLst.setFocus();
		}
		else
			g_Message("02", sMsg);
	}
}

function div_Error_btn_Hidden_OnClick(obj:Button, e:ClickEventInfo)
{
	div_Error.visible = false;
}

function btn_UpjangLst_OnClick(obj:Button, e:ClickEventInfo)
{
	//필수항목 
	if (ffn_ChkNull(ed_MainUpjang.userdata))
	{
		g_Message("EE", "본사" + fn_AlertMsg("005"));
		ed_MainUpjang.setFocus();
		return;
	}
	gfn_dialog("", "U_FMU::FMU00091P.xfdl",{fa_MainUpjang:ed_MainUpjang.userdata});
}

function btn_MultiUpj_OnClick(obj:Button, e:ClickEventInfo)
{
	if (dv_MultiUpj.visible == false)
	{
		var sRtn = fn_ChkManNull();
		if (sRtn != null)
		{
			g_Message("EE", sRtn);
			return;
		}
		// 초기화
		ds_Cond.clearData();
		ds_MultiUpj.clearData();
		ds_Cond.addRow();
		ds_Cond.setColumn(0, "UPJANG", ed_PriceUpjang.userdata);
		ds_Cond.setColumn(0, "OTCUSTCD", ed_Otcust.userdata);
		ds_Cond.setColumn(0, "SDATE", me_Sdate.value);
		var strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc;
		// 경로 설정
		strSvcID = "FMU00090E_T001";
		strURL   = "U_svc::" + "fm/fmu/FMU00090E_T001.jsp";
		// 데이터셋 설정
		strInDatasets = "ds_Cond=ds_Cond";
		strOutDatasets = "ds_MultiUpj=ds_List";
		// 파라메터 설정
		strArgument = "strMainUpjang=" + wrapQuote(ed_MainUpjang.userdata);
		// 서버 호출 
		jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, false, false, true);
ta_Sql.value = fa_Sql;
	}
	//
	dv_MultiUpj.visible = (! dv_MultiUpj.visible);
}

function dv_MultiUpj_btn_Hidden_OnClick(obj:Button, e:ClickEventInfo)
{
	// 데이타체크
	var sRtn = fn_ChkManNull();
	if (sRtn != null)
	{
		g_Message("EE", sRtn);
		return;
	}
	//필수항목 
	if (ds_List.rowcount < 1)
	{
		g_Message("EE","단가 조회 후 작업하세요.");
		return;
	}
	//선택 유무 체크
	if(ds_List.findRow("CHK",'1') < 0)
	{
		g_Message('EE',"단가적용할 상품을 선택하세요!");
		gd_list.setFocus();
		return;
	}
	if (ds_MultiUpj.findRowExpr("CHK=='1'") < 0)
	{
		g_Message("EE","복사할 업장을 선택하세요!");
		dv_MultiUpj.gd_list.setFocus();
		return;
	}
	if (! g_Confirm("01", '다중업장 등록 작업을 하시겠습니까?!')) return;
	//선택된 품목만 복사해야하므로 별도로 데이터셑 구성
	gd_list.enableredraw = false;
	ds_List.filter("CHK=='1'");
	CopyF(ds_ListTmp,ds_List);
	ds_List.filter("");
	gd_list.enableredraw = true;
	for (var iRow=0; iRow<ds_MultiUpj.rowcount; iRow++)
	{
		if (ds_MultiUpj.getColumn(iRow,"CHK") <> "1") continue;
		//
		fn_save(ds_MultiUpj.getColumn(iRow,"UPJANG"));
	}
	g_Message("02","단가 복사작업이 완료되었습니다!");
	dv_MultiUpj.visible = false;
}


function dv_MultiUpj_btn_CloseDiv_onclick(obj:Button,  e:ClickEventInfo)
{
	dv_MultiUpj.visible = false;
}
]]></Script>
  </Form>
</FDL>
