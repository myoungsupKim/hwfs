<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="../../../default_typedef.xml"/>
  <Form id="FSC91020E" onkeydown="frm_OnKeyDown" onload="form_onload" titletext="신규입사자교육관리" position="absolute 0 0 1252 725" scrollbars="none">
    <Layouts>
      <Layout>
        <Static id="Static84" class="sta_WFDA_Labelbg" position="absolute 708 293 930 465" anchor="left top"/>
        <Grid id="grd_list" taborder="0" binddataset="ds_Detail" autoenter="select" useinputpanel="false" cellsizingtype="col" position="absolute 936 293 1225 687" anchor="left top right" scrollbars="autoboth" enable="true" autofittype="col">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="22"/>
                <Column size="0"/>
                <Column size="81"/>
                <Column size="261"/>
                <Column size="0"/>
              </Columns>
              <Rows>
                <Row size="30" band="head"/>
                <Row size="23"/>
              </Rows>
              <Band id="head">
                <Cell class="head_Excel" taborder="undefined"/>
                <Cell col="1" text="진행상태"/>
                <Cell col="2" text="번호"/>
                <Cell col="3" class="grd_WF_Essential" text="정답"/>
                <Cell col="4"/>
              </Band>
              <Band id="body">
                <Cell displaytype="normal" text="expr:currow+1"/>
                <Cell col="1" displaytype="normal" text="bind:STATUSNM"/>
                <Cell col="2" displaytype="normal" edittype="none" style="align:center middle;background: ;" text="expr:iif(STATUS==&quot;10&quot; || STATUS==&quot;20&quot;, &quot;&quot;, SEQNO)"/>
                <Cell col="3" displaytype="normal" edittype="none" style="align:left middle;" text="expr:iif(STATUS==&quot;30&quot;, ANSWER, START_DT + &quot; ~ &quot; + END_DT)"/>
                <Cell col="4" text="bind:STATUS"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Edit id="ed_Answer" taborder="28" readonly="true" autoselect="true" position="absolute 0 500 926 687" style="compositecolor:#ffffffff;background:bisque;border:1 solid #c2c2c2ff ;align:left top;font:Gulim,16; :disabled {align:left top;}" enable="true" visible="true" anchor="left top" onkillfocus="ed_Answer_onkillfocus" onkeydown="ed_Answer_onkeydown"/>
        <Radio id="RadioSel" taborder="31" columncount="0" rowcount="9" position="absolute -2 498 926 675" innerdataset="@ds_select" codecolumn="Seq" datacolumn="Example" direction="vertical" visible="false" onitemchanged="RadioSel_onitemchanged" style="buttonborder:1 solid #8e8f8fff ;buttonsize:20;textpadding:0 0 0 5;color:black;font:Gulim,16;background:bisque;border:1 none #808080ff ;"/>
        <Splitter id="sp_down" position="absolute 0 424 710 430" type="vertical" onmove="sp_down_onmove"/>
        <TextArea id="txt_Test" taborder="22" scrollbars="fixedvert" imemode="hangul" wordwrap="word" position="absolute 0 293 707 465" anchor="left top" style="font:Gulim,14, bold;" readonly="true"/>
        <ImageViewer id="img_viewer" taborder="34" stretch="fixaspectratio" class="img_WF_NoImage" position="absolute 711 295 928 463" anchor="left top" style="border:1 solid #808080ff ;cursor:hand;" moveX="0" moveY="0" resizeX="100" resizeY="100" onclick="img_viewer_onclick"/>
        <Static id="Static19" text="정답" class="sta_WF_Title01" position="absolute 0 482 48 500" anchor="left top"/>
        <Static id="Static03" position="absolute 0 174 1237 201" class="sta_WFDA_Labelbg" anchor="default"/>
        <Static id="Static1" position="absolute 0 200 1237 227" class="sta_WFDA_Labelbg" anchor="default"/>
        <Static id="Static10" class="sta_WFDA_Labelbg" position="absolute 0 226 1237 253" anchor="default"/>
        <Combo id="cbo_TEST_TYPE" taborder="12" innerdataset="ds_TEST_TYPE" codecolumn="CODE" datacolumn="CODE_NAME" class="cmb_WF_Essential" position="absolute 87 176 201 198" anchor="default" onitemchanged="cbo_TEST_TYPE_onitemchanged"/>
        <Button enable="false" id="btn_CHARGE_SABUN" onclick="btn_CHARGE_SABUN_OnClick" taborder="9" text="" position="absolute 612 203 633 224" class="btn_WF_popSearch" image="" anchor="default"/>
        <Button enable="false" id="btn_UPJANGNM2" onclick="btn_UPJANGNM2_OnClick" taborder="10" text="" position="absolute 295 203 316 224" class="btn_WF_popSearch" image="" anchor="default"/>
        <Static id="Static00" text="유형구분" position="absolute 0 174 85 201" class="sta_WFDA_Label01" anchor="default"/>
        <Static id="Static6" text="소      속" position="absolute 0 200 85 227" class="sta_WFDA_Label01" anchor="default"/>
        <Static id="Static8" text="점      장" position="absolute 317 200 402 227" class="sta_WFDA_Label01" anchor="default"/>
        <Static id="Static15" text="테  스  트" position="absolute 317 174 402 201" class="sta_WFDA_Label01" anchor="default"/>
        <Static id="Static22" text="수료여부" position="absolute 820 200 905 227" class="sta_WFDA_Label01" anchor="default"/>
        <Static id="Static29" text="교육점수" position="absolute 1030 200 1115 227" class="sta_WFDA_Label01" anchor="default"/>
        <Edit autoselect="true" id="ed_UPJANGNM2" imemode="native" readonly="true" taborder="5" position="absolute 87 203 295 224" anchor="default"/>
        <Edit autoselect="true" id="ed_CHARGE_NM" imemode="native" readonly="true" taborder="6" position="absolute 404 203 612 224" anchor="default"/>
        <Edit id="ed_TRAINEE" taborder="13" autoselect="true" position="absolute 655 177 819 198" class="edt_WF_Essential" readonly="true" anchor="default" onkillfocus="ed_TRAINEE_onkillfocus" imemode="hangul" maxlength="10" lengthunit="utf16"/>
        <Static id="Static16" text="수강일자" class="sta_WFDA_Label01" position="absolute 820 174 905 201" anchor="default"/>
        <MaskEdit id="me_TEST_DATE" taborder="14" type="string" mask="####-##-##" onsetfocus="g_Date_OnFocus" onkillfocus="g_Date_OnKillFocus" oneditclick="g_Date_OnFocus" class="msk_WF_EssentialCal" enable="false" position="absolute 906 177 1024 198" userdata="" style=":disabled {align:center middle;}" readonly="true" anchor="default"/>
        <Combo id="cbo_FORM_CD" taborder="15" innerdataset="@ds_FORM_CD" codecolumn="FORM_CD" datacolumn="FORM_NAME" class="cmb_WF_Essential" position="absolute 405 176 567 198" anchor="default" onitemchanged="cbo_FORM_CD_onitemchanged"/>
        <MaskEdit id="edt_distribution" taborder="16" mask="##0" autoselect="true" position="absolute 1116 202 1234 224" anchor="default" style="background:#ffffffff;border:1 solid #aaaaaaff ;" inputtype="number" maxlength="10" readonly="true"/>
        <Edit id="ed_COMPLETEYN" taborder="17" readonly="true" autoselect="true" position="absolute 906 202 1025 224" style="align:center middle;" anchor="default"/>
        <Static id="Static11" text="동영상 교육 링크" class="sta_WFDA_Label01" position="absolute 0 226 160 253" anchor="default"/>
        <Edit id="ed_URL_LINK" taborder="18" readonly="true" autoselect="true" position="absolute 160 229 635 251" style="align:left middle;" anchor="default"/>
        <Button id="btn_urllink" taborder="19" text="동영상보기" class="btn_WF_Function" position="absolute 638 230 703 250" anchor="default" enable="false" onclick="btn_urllink_onclick"/>
        <Button id="btn_test" taborder="21" text="시험보기" class="btn_WF_Function" enable="false" position="absolute 1115 230 1180 250" onclick="btn_test_onclick"/>
        <Static id="Static17" text="문제" class="sta_WF_Title01" position="absolute 0 275 48 293" anchor="left top"/>
        <Button id="btn_Prev" taborder="26" text="이전문제" class="btn_WF_Function" enable="false" position="absolute 573 267 629 287" onclick="btn_Prev_onclick"/>
        <Button id="btn_Next" taborder="27" text="다음문제" class="btn_WF_Function" enable="false" position="absolute 642 267 698 287" onclick="btn_Next_onclick"/>
        <Button id="btn_imgView" taborder="30" text="[클릭] 이미지 크게 보기" position="absolute 715 267 926 287" anchor="left top" enable="false" onclick="btn_imgView_onclick" onmouseenter="btn_imgView_onmouseenter" onmouseleave="btn_imgView_onmouseleave" visible="false" style=":disabled {color:coral;align:center middle;gradation:linear 0,0 coral 0,100 coral;}" class="btn_WF_searchCm"/>
        <Button id="btn_result" taborder="33" text="제 출" onclick="btn_result_onclick" class="btn_WF_Function" enable="false" position="absolute 937 267 993 287"/>
        <Static id="Static04" text="수강자" class="sta_WFDA_Label01" position="absolute 568 174 653 201" anchor="default"/>
        <Static id="Static01" position="absolute 0 30 1237 71" class="sta_WFSA_Labelbg" anchor="left top right"/>
        <Static id="st_UPJANG" text="사 업 장" position="absolute 15 40 77 61" class="sta_WFSA_label"/>
        <MaskEdit id="me_FROM_DT" mask="####-##-##" oneditclick="g_Date_OnFocus" onsetfocus="g_Date_OnFocus" onkillfocus="g_Date_OnKillFocus" taborder="1" type="string" userdata="btn_FROM_DT" position="absolute 411 40 491 61" class="msk_WF_EssentialCal"/>
        <Button id="btn_FROM_DT" onclick="g_CalButton_OnClick" taborder="2" tabstop="false" userdata="me_FROM_DT" position="absolute 490 40 511 61" class="btn_WF_calEssential" text="" image="" anchor="default"/>
        <Static id="Static7" text="~" position="absolute 519 40 527 61" style="align:center middle;"/>
        <MaskEdit id="me_TO_DT" mask="####-##-##" oneditclick="g_Date_OnFocus" onsetfocus="g_Date_OnFocus" onkillfocus="g_Date_OnKillFocus" taborder="3" type="string" userdata="btn_TO_DT" position="absolute 535 40 615 61" class="msk_WF_EssentialCal"/>
        <Button id="btn_TO_DT" onclick="g_CalButton_OnClick" taborder="4" tabstop="false" userdata="me_TO_DT" position="absolute 614 40 635 61" class="btn_WF_calEssential" text="" image="" anchor="default"/>
        <Static id="Static14" text="기    간" position="absolute 348 40 405 61" class="sta_WFSA_label"/>
        <Div id="div_cmnBtn" taborder="7" text="Div0" url="cmn::CmnBtn.xfdl" position="absolute 0 0 1237 30" anchor="left top right" scrollbars="none"/>
        <Static id="Static06" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1237 0 1252 710" anchor="top right"/>
        <Static id="Static71" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 710 1252 725" anchor="left bottom"/>
        <Static id="Static36" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 71 40 81 61" anchor="left top"/>
        <Static id="Static09" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 318 40 348 61" anchor="left top"/>
        <Static id="Static37" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 401 40 411 61" anchor="left top"/>
        <Static id="Static38" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 635 40 665 61" anchor="left top"/>
        <Static id="Static05" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 159 450 174" anchor="left top"/>
        <Div id="div_bk" onsize="div_bk_OnSize" taborder="8" text="Div0" position="absolute 0 86 1237 164" scrollbars="none" anchor="left top right" style="border:0 none #808080ff ;">
          <Layouts>
            <Layout>
              <Grid autoenter="select" binddataset="ds_list" cellsizingtype="both" readonly="false" enable="true" id="grd_list" useinputpanel="false" onheadclick="grd_List_OnHeadClick" taborder="1" tabstop="true" tooltiptype="hover" usecontextmenu="true" useselcolor="true" visible="true" wheelscrollrow="1" position="absolute 0 0 1237 78" selecttype="row" anchor="left top right" style="background:white;" autofittype="col" oncellclick="div_bk_grd_list_oncellclick" onexpanddown="div_bk_grd_list_onexpanddown">
                <Formats>
                  <Format id="Default">
                    <Columns>
                      <Column size="40" band="left"/>
                      <Column size="160"/>
                      <Column size="0"/>
                      <Column size="100"/>
                      <Column size="90"/>
                      <Column size="80"/>
                      <Column size="120"/>
                      <Column size="123"/>
                      <Column size="193"/>
                      <Column size="90"/>
                      <Column size="72"/>
                    </Columns>
                    <Rows>
                      <Row size="26" band="head"/>
                      <Row size="24"/>
                    </Rows>
                    <Band id="head">
                      <Cell displaytype="image" class="head_Excel"/>
                      <Cell col="1" displaytype="text" text="사업장"/>
                      <Cell col="2" text="생년월일"/>
                      <Cell col="3" text="수강자"/>
                      <Cell col="4" displaytype="text" text="테스트일자"/>
                      <Cell col="5" displaytype="text" text="진행상태"/>
                      <Cell col="6" displaytype="text" text="소속"/>
                      <Cell col="7" displaytype="text" text="점장"/>
                      <Cell col="8" displaytype="text" text="테스트유형"/>
                      <Cell col="9" displaytype="text" text="수료여부"/>
                      <Cell col="10" text="점수"/>
                    </Band>
                    <Band id="body">
                      <Cell displaytype="text" style="align:center middle;background:white;background2:white;" expr="expr:currow+1"/>
                      <Cell col="1" displaytype="text" style="background:white;background2:white;" text="bind:UPJANGNM" suppress="0"/>
                      <Cell col="2" text="bind:BIRTHDAY"/>
                      <Cell col="3" text="bind:TRAINEE"/>
                      <Cell col="4" displaytype="date" style="background:white;background2:white;" text="bind:TEST_DATE"/>
                      <Cell col="5" displaytype="normal" style="align:center middle;background:white;background2:white;" text="bind:STATUSNM"/>
                      <Cell col="6" displaytype="text" style="align:center middle;background:white;background2:white;" text="bind:TM_NM"/>
                      <Cell col="7" displaytype="normal" style="background:white;background2:white;" text="bind:CHARGE_NM"/>
                      <Cell col="8" displaytype="text" style="background:white;background2:white;" text="bind:FORM_NAME"/>
                      <Cell col="9" displaytype="expr:iif(gfn_isNull(RPT_DATE), 'none', 'date')" style="background:white;background2:white;" text="bind:COMPLETEYN"/>
                      <Cell col="10" edittype="expand" text="bind:SCORE" expandshow="show"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
            </Layout>
          </Layouts>
        </Div>
        <UpjangSearchComponent id="edt_upjang" titletext="업장 검색용 Component" taborder="11" text="UpjangSearchComponent00" position="absolute 81 40 318 61" bindDataset="ds_input" bindUpjangCodeColumn="UPJANG" bindUpjangNameColumn="UPJANG_NM" eventBeforeTrigger="" eventAfterTrigger="" roleSetId="ScoAuthLevel01" onclick="edt_upjang_onclick"/>
        <Static id="Static40" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 71 450 86" anchor="left top"/>
        <Static id="Static12" text="생년월일" class="sta_WFDA_Label01" position="absolute 1310 145 1395 172" anchor="default" visible="false"/>
        <MaskEdit id="me_BIRTHDAY" taborder="20" readonly="true" type="string" mask="####-##-##" enable="true" position="absolute 1397 148 1515 169" style="align:center middle; :disabled {align:center middle;}" userdata="" class="msk_WF_Essential" anchor="default" onkillfocus="me_BIRTHDAY_onkillfocus" visible="false"/>
        <Static id="st_playtime" position="absolute 708 229 1022 250" style="align:left middle;" visible="false"/>
        <Static id="Static13" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 0 262 450 275" anchor="left top"/>
        <Static id="Static18" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 0 288 450 293" anchor="left top"/>
        <Static id="st_Seqno" position="absolute 48 272 79 293" style="align:center middle;font:arial,11,bold;"/>
        <Static id="Static79" text="w10" class="Guide01_AreaRed" visible="false" position="absolute 929 290 935 712"/>
        <Static id="Static02" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 0 469 450 482" anchor="left top"/>
        <Static id="Static20" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 0 495 450 500" anchor="left top"/>
        <TextArea id="txt_Example" taborder="23" scrollbars="fixedvert" imemode="hangul" wordwrap="word" readonly="true" position="absolute -2 1100 705 1329" anchor="left top" style="font:Gulim,14,bold;" visible="false"/>
        <Static id="Static21" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 930 262 1175 275" anchor="left top"/>
        <Static id="Static23" text="배점" class="sta_WF_Title01" position="absolute 721 740 769 758" anchor="left top" enable="false" visible="false"/>
        <Static id="Static24" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 937 288 1175 293" anchor="left top"/>
        <Static id="st_Seqno00" position="absolute 773 272 804 293" style="align:center middle;"/>
        <Edit id="ed_Distribution" taborder="25" readonly="true" autoselect="true" position="absolute 721 758 840 882" style="align:center middle;font:Gulim,16;" enable="false" visible="false"/>
        <Static id="Static26" text="정답" class="sta_WF_Title01" position="absolute 721 905 769 923" anchor="left top" enable="false" visible="false"/>
        <Static id="st_Seqno01" position="absolute 773 437 804 458" style="align:center middle;"/>
        <Static id="Static87" text="h06" class="Guide01_AreaRed" visible="false" position="absolute 480 262 926 270" anchor="left top"/>
        <Static id="Static86" text="h05" class="Guide01_AreaRed" visible="false" position="absolute 482 287 926 293" anchor="left top"/>
        <Edit id="ed_TIME_LIMIT" taborder="32" readonly="true" autoselect="true" position="absolute 1310 88 1785 110" style="align:left middle;" visible="false"/>
        <Splitter id="sp_left" min="166" max="640" type="vertical" position="absolute 0 166 1237 171" anchor="left top right">
          <Formats>
            <Format id="default">
              <SplitterItems id="items">
                <SplitterItem id="item00" position="leftortop" bindtype="resize" componentid="div_bk"/>
              </SplitterItems>
            </Format>
          </Formats>
        </Splitter>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_list">
        <ColumnInfo>
          <Column id="UPJANG" type="STRING" size="256"/>
          <Column id="UPJANGNM" type="STRING" size="256"/>
          <Column id="BIRTHDAY" type="STRING" size="256"/>
          <Column id="TRAINEE" type="STRING" size="256"/>
          <Column id="TEST_DATE" type="STRING" size="256"/>
          <Column id="STATUS" type="STRING" size="256"/>
          <Column id="STATUSNM" type="STRING" size="256"/>
          <Column id="TM_CD" type="STRING" size="256"/>
          <Column id="TM_NM" type="STRING" size="256"/>
          <Column id="CHARGE_SABUN" type="STRING" size="256"/>
          <Column id="CHARGE_NM" type="STRING" size="256"/>
          <Column id="COMPLETEYN" type="STRING" size="256"/>
          <Column id="SCORE" type="BIGDECIMAL" size="256"/>
          <Column id="TEST_TYPE" type="STRING" size="256"/>
          <Column id="FORM_CD" type="STRING" size="256"/>
          <Column id="FORM_NAME" type="STRING" size="256"/>
          <Column id="UUSER" type="STRING" size="256"/>
          <Column id="URL_LINK" type="STRING" size="256"/>
          <Column id="TIME_LIMIT" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_input" onvaluechanged="ds_input_onvaluechanged">
        <ColumnInfo>
          <Column id="UPJANG" size="256" type="STRING"/>
          <Column id="UPJANG_NM" type="STRING" size="256"/>
          <Column id="TEST_DATE" size="256" type="STRING"/>
          <Column id="TRAINEE" size="256" type="STRING"/>
          <Column id="FROM_DT" type="STRING" size="256"/>
          <Column id="TO_DT" type="STRING" size="256"/>
          <Column id="MST_UPJANG" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="TEST_DATE"/>
            <Col id="TRAINEE"/>
            <Col id="UPJANG"/>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_Detail" cancolumnchange="ds_CanColumnChange">
        <ColumnInfo>
          <Column id="UPJANG" type="STRING" size="256"/>
          <Column id="TEST_DATE" type="STRING" size="256"/>
          <Column id="TRAINEE" type="STRING" size="256"/>
          <Column id="STATUS" type="STRING" size="256"/>
          <Column id="STATUSNM" type="STRING" size="256"/>
          <Column id="SEQNO" type="BIGDECIMAL" size="256"/>
          <Column id="START_DT" type="STRING" size="256"/>
          <Column id="END_DT" type="STRING" size="256"/>
          <Column id="ANSWER" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_common">
        <ColumnInfo>
          <Column id="code" size="256" type="STRING"/>
          <Column id="codename" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_Master" oncolumnchanged="ds_Master_oncolumnchanged">
        <ColumnInfo>
          <Column id="UPJANG" type="STRING" size="256"/>
          <Column id="UPJANGNM" type="STRING" size="256"/>
          <Column id="BIRTHDAY" type="STRING" size="256"/>
          <Column id="TRAINEE" type="STRING" size="256"/>
          <Column id="TEST_DATE" type="STRING" size="256"/>
          <Column id="STATUS" type="STRING" size="256"/>
          <Column id="STATUSNM" type="STRING" size="256"/>
          <Column id="TM_CD" type="STRING" size="256"/>
          <Column id="TM_NM" type="STRING" size="256"/>
          <Column id="CHARGE_SABUN" type="STRING" size="256"/>
          <Column id="CHARGE_NM" type="STRING" size="256"/>
          <Column id="COMPLETEYN" type="STRING" size="256"/>
          <Column id="SCORE" type="BIGDECIMAL" size="256"/>
          <Column id="TEST_TYPE" type="STRING" size="256"/>
          <Column id="FORM_CD" type="STRING" size="256"/>
          <Column id="FORM_NAME" type="STRING" size="256"/>
          <Column id="UUSER" type="STRING" size="256"/>
          <Column id="URL_LINK" type="STRING" size="256"/>
          <Column id="TIME_LIMIT" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_TEST_TYPE">
        <ColumnInfo>
          <Column id="CODE" size="256" type="STRING"/>
          <Column id="code_name" size="256" type="STRING"/>
          <Column id="SET1" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_FORM_CD">
        <ColumnInfo>
          <Column id="FORM_CD" size="256" type="STRING"/>
          <Column id="FORM_NAME" size="256" type="STRING"/>
          <Column id="TEST_TYPE" size="256" type="STRING"/>
          <Column id="URL_LINK" type="STRING" size="256"/>
          <Column id="TIME_LIMIT" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_TEST_EXAM" oncolumnchanged="ds_TEST_TYPE_oncolumnchanged">
        <ColumnInfo>
          <Column id="TEST_TYPE" size="256" type="STRING"/>
          <Column id="FORM_CD" size="256" type="STRING"/>
          <Column id="SEQ" size="256" type="BIGDECIMAL"/>
          <Column id="TEST" type="STRING" size="256"/>
          <Column id="EXAMPLE1" type="STRING" size="256"/>
          <Column id="EXAMPLE2" type="STRING" size="256"/>
          <Column id="EXAMPLE3" type="STRING" size="256"/>
          <Column id="EXAMPLE4" type="STRING" size="256"/>
          <Column id="APPEND_FILENM" type="STRING" size="256"/>
          <Column id="SERVER_FILENM" type="STRING" size="256"/>
          <Column id="DISTRIBUTION" type="BIGDECIMAL" size="256"/>
          <Column id="ANSWER" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_UpjangInfo">
        <ColumnInfo>
          <Column id="UPJANG" type="STRING" size="256"/>
          <Column id="UPJANGNM" type="STRING" size="256"/>
          <Column id="TM_CD" type="STRING" size="256"/>
          <Column id="TM_NM" type="STRING" size="256"/>
          <Column id="TEAM_MST_SABUN" type="STRING" size="256"/>
          <Column id="TEAM_MST_SABIUNNM" type="STRING" size="256"/>
          <Column id="SUBTEAM_MST_SABUN" type="STRING" size="256"/>
          <Column id="SUBTEAM_MST_SABUNNM" type="STRING" size="256"/>
          <Column id="CHARGE_SABUN" type="STRING" size="256"/>
          <Column id="CHARGE_SABUNNM" type="STRING" size="256"/>
          <Column id="PERMISSION_TYPE" type="STRING" size="256"/>
          <Column id="PERMISSION_NM" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_select" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="Seq" type="STRING" size="256"/>
          <Column id="Example" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="Seq">a</Col>
            <Col id="Example">1</Col>
          </Row>
          <Row>
            <Col id="Seq">b</Col>
            <Col id="Example">2</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_inputCp" onvaluechanged="ds_input_onvaluechanged">
        <ColumnInfo>
          <Column id="UPJANG" size="256" type="STRING"/>
          <Column id="UPJANG_NM" type="STRING" size="256"/>
          <Column id="TEST_DATE" size="256" type="STRING"/>
          <Column id="TRAINEE" size="256" type="STRING"/>
          <Column id="FROM_DT" type="STRING" size="256"/>
          <Column id="TO_DT" type="STRING" size="256"/>
          <Column id="MST_UPJANG" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="TEST_DATE"/>
            <Col id="TRAINEE"/>
            <Col id="UPJANG"/>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_MasterCp" oncolumnchanged="ds_Master_oncolumnchanged">
        <ColumnInfo>
          <Column id="UPJANG" type="STRING" size="256"/>
          <Column id="UPJANGNM" type="STRING" size="256"/>
          <Column id="BIRTHDAY" type="STRING" size="256"/>
          <Column id="TRAINEE" type="STRING" size="256"/>
          <Column id="TEST_DATE" type="STRING" size="256"/>
          <Column id="STATUS" type="STRING" size="256"/>
          <Column id="STATUSNM" type="STRING" size="256"/>
          <Column id="TM_CD" type="STRING" size="256"/>
          <Column id="TM_NM" type="STRING" size="256"/>
          <Column id="CHARGE_SABUN" type="STRING" size="256"/>
          <Column id="CHARGE_NM" type="STRING" size="256"/>
          <Column id="COMPLETEYN" type="STRING" size="256"/>
          <Column id="SCORE" type="BIGDECIMAL" size="256"/>
          <Column id="TEST_TYPE" type="STRING" size="256"/>
          <Column id="FORM_CD" type="STRING" size="256"/>
          <Column id="FORM_NAME" type="STRING" size="256"/>
          <Column id="UUSER" type="STRING" size="256"/>
          <Column id="URL_LINK" type="STRING" size="256"/>
          <Column id="TIME_LIMIT" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_DetailCp" cancolumnchange="ds_CanColumnChange">
        <ColumnInfo>
          <Column id="UPJANG" type="STRING" size="256"/>
          <Column id="TEST_DATE" type="STRING" size="256"/>
          <Column id="TRAINEE" type="STRING" size="256"/>
          <Column id="STATUS" type="STRING" size="256"/>
          <Column id="STATUSNM" type="STRING" size="256"/>
          <Column id="SEQNO" type="BIGDECIMAL" size="256"/>
          <Column id="START_DT" type="STRING" size="256"/>
          <Column id="END_DT" type="STRING" size="256"/>
          <Column id="ANSWER" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_deleteAvailable" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="code" type="STRING" size="255"/>
          <Column id="codeName" type="STRING" size="255"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Bind>
      <BindItem id="item34" compid="img_viewer" propid="image" datasetid="ds_Detail1" columnid="IMG_FILE"/>
      <BindItem id="me_FROM_DT_value" compid="me_FROM_DT" propid="value" datasetid="ds_input" columnid="FROM_DT"/>
      <BindItem id="me_TO_DT_value" compid="me_TO_DT" propid="value" datasetid="ds_input" columnid="TO_DT"/>
      <BindItem id="ed_UPJANGNM2_value" compid="ed_UPJANGNM2" propid="value" datasetid="ds_Master" columnid="TM_NM"/>
      <BindItem id="ed_CHARGE_NM_value" compid="ed_CHARGE_NM" propid="value" datasetid="ds_Master" columnid="CHARGE_NM"/>
      <BindItem id="item1" compid="cbo_TEST_TYPE" propid="value" datasetid="ds_Master" columnid="TEST_TYPE"/>
      <BindItem id="item2" compid="ed_TRAINEE" propid="value" datasetid="ds_Master" columnid="TRAINEE"/>
      <BindItem id="me_CHECK_DATE_value" compid="me_TEST_DATE" propid="value" datasetid="ds_Master" columnid="TEST_DATE"/>
      <BindItem id="item3" compid="cbo_FORM_CD" propid="value" datasetid="ds_Master" columnid="FORM_CD"/>
      <BindItem id="item32" compid="edt_distribution" propid="value" datasetid="ds_Master" columnid="SCORE"/>
      <BindItem id="item4" compid="ed_COMPLETEYN" propid="value" datasetid="ds_Master" columnid="COMPLETEYN"/>
      <BindItem id="item5" compid="me_BIRTHDAY" propid="value" datasetid="ds_Master" columnid="BIRTHDAY"/>
      <BindItem id="item0" compid="ed_URL_LINK" propid="value" datasetid="ds_Master" columnid="URL_LINK"/>
      <BindItem id="item6" compid="ed_TIME_LIMIT" propid="value" datasetid="ds_Master" columnid="TIME_LIMIT"/>
    </Bind>
    <Script type="xscript4.0"><![CDATA[include "U_lib::lib_conversionCom.xjs";
include "lib::LimsUtil.xjs";
/*
 ******************************************************************************************
 * 시스템구분   : 위생관리/신규입사자교육관리
 * 프로그램명   : FSC091020E.XML
 * 기      능   : 교육관리
 * 작  성  자   : 김명섭
 * 작성  일자   : 2019-07-08
 * 비      고   : 
 * ----------------------------------------------------------------------------------------
******************************************************************************************
*/
//=========================================================================================
// [ PART 1 ]
// Form에서 Include 할 내용을 정의
//
//=========================================================================================
//@@컨버터에서 주석처리 #include "lib::sc_comon.js"
//@@컨버터에서 주석처리 #include "LIB::lib_comm_0001.js"
//@@컨버터에서 주석처리 #include "lib::tit_comm_0001.js"		// X-Framework Lib
//@@컨버터에서 주석처리 #include "LIB::fm_common.js"			// 사업장팝업용 Lib
//=========================================================================================
// [ PART 2 ]
// Form에서 사용될 전역변수를 선언
//
//=========================================================================================
var fstrFormQuery = "SELECT FORM_CD, FORM_NAME, TEST_TYPE, ATTR01 AS URL_LINK, ATTR02 AS TIME_LIMIT FROM FSC_TEST_FORM_MST WHERE USE_YN = 'Y'   AND TO_CHAR(SYSDATE,'YYYYMMDD') BETWEEN START_DATE AND NVL(END_DATE,'99999999') ORDER BY START_DATE DESC, FORM_CD";
var strDt;
var fbAble = true;							// true = 수정가능 false = 수정불가
var daAble = false;							// true = 삭제가능 false = 삭제불가
var isInsert = true;						// true = 입력 , false = 수정

var fv_retVal;
var nSeqNo = 0; //테스트순번
var nFseqno, nLseqno; //문제시작번호,최종번호
var strFinishYn;
var imgAble;
var strAllYn;

//=========================================================================================
// [ PART 3 ]
// Form Loading 시 작업 정의
//
//=========================================================================================
function form_onload(obj:Form, e:LoadEventInfo)
{
	gfn_formOnLoad(obj, false);

	// 업데이트 DS
	v_ds_check = "ds_Master;ds_Detail";
	
	// X-Framework : Action 정보 생성 
	fsp_init(this);
	
	//공통코드조회
	var v_fil_cond;
	var v_ds = fn_common_code("'FS9100'","","","blk","Y");

	// 문제유형(ds_TEST_TYPE, GROUP_CODE : 'FS9100')
	v_fil_cond = "GROUP_CODE == 'FS9100'";
	v_ds.filter(v_fil_cond);
	CopyF(ds_TEST_TYPE,v_ds.name);	

	// 양식조회
	fn_sql_common("C", fstrFormQuery,"","","non",cbo_FORM_CD,-1,ds_FORM_CD);
	
	strDt = fn_CurrDateWeek();
	ds_input.setColumn(0, "FROM_DT", gfn_left(strDt,6)+"01");				// 일자
	ds_input.setColumn(0, "TO_DT", strDt);							// 일자

	//사업장인경우
	if (g_AuthLevel <= g_Leader_AuthLevel)
	{
		fbAble = false;
	}
	
	//2020.02.12 김중한: 삭제 가능 사용자(공통코드: DELETE_AVAILABLE)
	LimsUtil.selectCodeBatchList(this, null, "DELETE_AVAILABLE");
}

function frm_OnKeyDown(obj:Form, e:KeyEventInfo)
{
	gfn_formKeyDown(obj, e); //(obj,e.fromreferenceobject,e.keycode,e.shiftKey,e.ctrlKey,e.altKey,-1,-1);
}
//=========================================================================================
// [ PART 4 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,도움말,form닫기)
//
//=========================================================================================
/*
 ******************************************************************************************
 * 함  수  명   : fn_Search()
 * 기      능   : [조회버튼] 검색조건에 해당하는 정보를 조회
 ******************************************************************************************
 */
function fn_search()
{
	if (!fn_SearchCheck())		// 조회조건체크
	{
		return;
	}
	
	// 초기화
	ds_list.clearData();
	ds_Master.clearData();
	ds_Detail.clearData();
	//trace(ds_input.saveXML());
	
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	
	actionName		= "FSC91020E_T001";
	cmdName			= "U_svc::" + "fs/fsc/FSC91020E_T001.jsp";
	inData			= "ds_input=ds_input";
	outData			= "ds_list=ds_list ds_Master=ds_list";
	callBackFnc		= "fn_afterSearchList";
	
	jsp_transaction(this,actionName, cmdName ,inData ,outData,otherArg,callBackFnc,true,false,false);
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_Insert()
 * 기      능   : [입력버튼] 입력 시 처리되는 작업
 * 비      고	: 팝업사용
 ******************************************************************************************
 */
function fn_insert()
{
	//trace(ds_input.saveXML());
	if (gfn_length(ds_input.getColumn(0,"UPJANG"))== 0 || gfn_isNull(ds_UpjangInfo.getColumn(0,"UPJANG")) || gfn_length(ds_UpjangInfo.getColumn(0,"UPJANG")) == 0)
	{
		g_Message("EE", "사업장을 입력하세요.");
		edt_upjang.setFocus();
		return false;
	}
	
	if (gfn_dsIsUpdated(ds_Master)==true || gfn_dsIsUpdated(ds_Detail)==true)
	{
		if(! confirm('변경된 데이터가 있습니다.\n 입력하시겠습니까?')) return;
	}
	
	fbAble 					= true;
	ed_TRAINEE.readonly     = false;
	me_BIRTHDAY.readonly    = false;
	btn_urllink.enable		= true;
	btn_test.enable			= true;

	cbo_TEST_TYPE.enable	= true;
	cbo_FORM_CD.enable		= true;
	ed_TRAINEE.enable		= true
	
	btn_UPJANGNM2.enable	 = true;
	btn_CHARGE_SABUN.enable	 = true;
	
	ed_URL_LINK.value = "";
	ed_TIME_LIMIT.value = "";
	st_playtime.text = "";
	st_Seqno.text = "";
	
	isInsert = true;
	
	ds_TEST_EXAM.clearData();
	txt_Test.value = "";
	RadioSel.visible = false;
	ed_Answer.value = "";
	ed_Answer.visible = true;
	img_viewer.image = "";

	var nARow;
	
	ds_Master.clearData();
	nARow = ds_Master.addRow();
	
	ds_Master.setColumn(nARow, "UPJANG", ds_UpjangInfo.getColumn(0,"UPJANG"));
	ds_Master.setColumn(nARow, "UPJANGNM", ds_UpjangInfo.getColumn(0,"UPJANGNM"));
	ds_Master.setColumn(nARow, "TM_CD", ds_UpjangInfo.getColumn(0,"TM_CD"));
	ds_Master.setColumn(nARow, "TM_NM", ds_UpjangInfo.getColumn(0,"TM_NM"));
	ds_Master.setColumn(nARow, "CHARGE_SABUN", ds_UpjangInfo.getColumn(0,"CHARGE_SABUN"));
	ds_Master.setColumn(nARow, "CHARGE_NM", ds_UpjangInfo.getColumn(0,"CHARGE_SABUNNM"));
	ds_Master.setColumn(nARow, "TEST_DATE", strDt);
	ds_Master.setColumn(nARow, "COMPLETEYN", "N");
	ds_Master.setColumn(nARow, "STATUS", "10"); //진행상태(등록)
	
	ds_Detail.clearData();
	
	fn_Dsdetail_Setcolumn("10", 0, "START_DT", gfn_todayTime());
	
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_Save()
 * 기      능   : [저장버튼] 저장 시 처리되는 작업
 ******************************************************************************************
 */
function fn_save()
{
	// 변경여부 확인
	if(gfn_dsIsUpdated(ds_Master)==false && gfn_dsIsUpdated(ds_Detail)==false)
	{
		g_Message("EE", "변경된 데이터가 없습니다.");
		return;
	}
	
	if(!fn_SaveCheck())
	{
		return;
	}
	
	if(!isInsert)
	{
		if(! confirm('저장하시겠습니까?')) return;
	}
	
	ds_Detail.filter("");
	//trace(ds_Master.saveXML());
	//trace(ds_Detail.saveXML());
	//return;
	
    // 서비스셋팅
    var actionName, cmdName, inData, outData, otherArg, callBackFnc;

	actionName		= "FSC91020E_T003";
	cmdName			= "U_svc::" + "fs/fsc/FSC91020E_T003.jsp";
	inData			= "ds_Master=ds_Master:U ds_Detail=ds_Detail:U";
    outData			= "";
    callBackFnc		= "fn_afterSave";
	
	jsp_transaction(this,actionName, cmdName ,inData ,outData,otherArg,callBackFnc);
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_Delete()
 * 기      능   : [삭제버튼] 삭제 시 처리되는 작업
 ******************************************************************************************
 */
function fn_delete()
{
	if(ds_list.getRowCount()==0)
	{
		g_Message("EE", "삭제할 데이터가 없습니다.");
		return;
	}
	
	//2020.02.12 김중한: 삭제 가능 사용자(공통코드: DELETE_AVAILABLE)
	daAble = false;
	for(var i=0;i<ds_deleteAvailable.rowcount;i++)
	{
		if(ds_deleteAvailable.getColumn(i,"code") ==  gfn_getUserId()) //삭제가능자가 일 경우
		{
			daAble = true;
		}
	}	

	if (!daAble) //삭제가능자 적용
	{
		if (!fbAble) //기존 삭제 조건 적용
		{
			g_Message("EE", "삭제하실 수 없습니다.");
			return;
		}	
	}
	
	if (gfn_dsIsUpdated(ds_Master)==true || gfn_dsIsUpdated(ds_Detail)==true)
	{
		g_Message("EE", "변경된 데이터가 있습니다.\n 저장 후 삭제하십시오.");
		return;
	}
	
	var strMsg,btp,nRow,nFRow;
	
	nRow 	= ds_list.rowposition;
	for(var i=0 ; i<ds_Master.getRowCount() ; i++)
	{
		if(ds_list.getColumn(nRow,"UPJANG") == ds_Master.getColumn(i,"UPJANG") && ds_list.getColumn(nRow,"TEST_DATE") == ds_Master.getColumn(i,"TEST_DATE") && ds_list.getColumn(nRow,"TRAINEE") == ds_Master.getColumn(i,"TRAINEE"))
		{
			nFRow = i;
		}
	}
	
	strMsg = "[" + ds_list.getColumn(nRow,"TRAINEE") + "] " + "를 삭제하시겠습니까?";
	
	// 삭제확인
	if(!g_Confirm("01",strMsg))
	{
		return false;
	}
	
	// Data삭제
	ds_list.deleteRow(nRow);
	ds_Master.deleteRow(nFRow);
	ds_Master.rowposition = -1;
	ds_Detail.clearData();
	
	// 삭제
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	
	actionName		= "FSC91020E_T004";
	cmdName			= "U_svc::" + "fs/fsc/FSC91020E_T004.jsp";
	inData			= "ds_Master=ds_Master:U";
	callBackFnc		= "fn_afterDelete"
	
	jsp_transaction(this,actionName, cmdName ,inData ,outData,otherArg,callBackFnc);
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_Print()
 * 기      능   : [출력버튼] 출력 시 처리되는 작업
 ******************************************************************************************
 */
function fn_print()
{
	if (ds_list.rowcount <= 0)
	{
		g_Message("EE", "출력오류 : 출력 할 내역이 없습니다.");
		return;
	}
	
	//if(ds_input.getColumn(0,"FROM_DT") <> ds_input.getColumn(0,"TO_DT"))
	//{
	//	g_Message("EE", "확인 : 기간(FROM, TO)은 같아야 합니다.");
	//	return;
	//}
	
	//레포트에 전달할 파라메터 생성
	var arrParams	= SCReport.newParams ();
	
	//--------------------------------------------------
	//방법1)서버에서 Query에 의해 처리하는 경우 예
	//(필수) 레포트명
	SCReport.setParams (arrParams, SCReport.RPT_NAME, "/IFIS/FSC91020E_R02.ozr");

	//출력 옵션 설정
	//-창 타이틀 (디폴트는 "ReportViewer")
	SCReport.setParams (arrParams, SCReport.RPT_TITLE, "신규입사자 위생교육 결과보고서");
	
	//레포트에 맞게 전달되는 개발자 정의 파라미터
	SCReport.setParams (arrParams, "PARAM1", ds_input.getColumn(0,"UPJANG"));// 
	SCReport.setParams (arrParams, "PARAM2", ds_input.getColumn(0,"FROM_DT"));// 
	SCReport.setParams (arrParams, "PARAM3", ds_input.getColumn(0,"TO_DT"));	// 
	
	SCReport.setParams (arrParams, "zoom", 120);		
	//--------------------------------------------------
	SCReport.viewReport (this, arrParams);
}

function fn_print_single()
{
	if (ds_Master.rowcount <= 0)
	{
		g_Message("EE", "출력오류 : 출력 할 내역이 없습니다.");
		return;
	}
	
	var nRow,p1,p2,p3,p4,p5,p6,p7;
	
	nRow = ds_Master.rowposition;
	
	//trace(nRow);
	//return;
	
	//레포트에 전달할 파라메터 생성
	var arrParams	= SCReport.newParams ();
	
	//--------------------------------------------------
	//방법1)서버에서 Query에 의해 처리하는 경우 예
	//(필수) 레포트명
	SCReport.setParams (arrParams, SCReport.RPT_NAME, "/IFIS/FSC91020E_R01.ozr");

	//출력 옵션 설정
	//-창 타이틀 (디폴트는 "ReportViewer")
	SCReport.setParams (arrParams, SCReport.RPT_TITLE, "신규입사자 위생교육 결과보고서");
	
	//레포트에 맞게 전달되는 개발자 정의 파라미터
	SCReport.setParams (arrParams, "PARAM1", ds_Master.getColumn(nRow,"UPJANG"));// 
	SCReport.setParams (arrParams, "PARAM2", ds_Master.getColumn(nRow,"TRAINEE"));// 
	SCReport.setParams (arrParams, "PARAM3", ds_Master.getColumn(nRow,"TEST_DATE"));	// 
	
	SCReport.setParams (arrParams, "zoom", 120);		
	//--------------------------------------------------
	SCReport.viewReport (this, arrParams);
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_Excel()
 * 기      능   : [엑셀버튼] 엑셀 시 처리되는 작업
 ******************************************************************************************
 */
function fn_Excel()
{
	gfn_exportExcel(grd_Detail, "Sheet1");
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_Close()
 * 기      능   : [닫기버튼] 화면을 닫을때 처리되는 작업
 ******************************************************************************************
 */
function fn_Close()
{
	this.close();
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_Help()
 * 기      능   : [도움말버튼] 도움말
 ******************************************************************************************
 */
function fn_help()
{
}
//=========================================================================================
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
//
//=========================================================================================
/*
 ******************************************************************************************
 * 함  수  명   : fn_SearchCheck()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 조회시 필수조회조건 체크
 ******************************************************************************************
 */
function fn_SearchCheck()
{
	/*
	if (length(ds_input.GetColumn(0,"UPJANG")) == 0)
	{
		g_Message("EE", "사업장을 입력하세요.");
		ed_UPJANG_NM.SetFocus();
		return false;
	}
	*/

	if (gfn_length(ds_input.getColumn(0,"FROM_DT"))== 0)
	{
		g_Message("EE", "날짜를 입력하세요");
		me_FROM_DT.setFocus();
		return false;
	}

	if (gfn_length(ds_input.getColumn(0,"TO_DT"))== 0)
	{
		g_Message("EE", "날짜를 입력하세요");
		me_TO_DT.setFocus();
		return false;
	}

	if (ds_input.getColumn(0,"FROM_DT") > ds_input.getColumn(0,"TO_DT"))
	{
		g_Message("EE", "검색기간을 확인해 주십시오.");
		me_FROM_DT.setFocus();
		return false;
	}
	
    return true;
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_SaveCheck()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 저상시 필수입력 체크
 ******************************************************************************************
 */
function fn_SaveCheck()
{
	var nFRow,nRow;
	
	nRow = ds_Master.rowposition;
	
	// 필수 입력 사항 확인 
	if(gfn_length(ds_Master.getColumn(nRow,"TEST_TYPE"))== 0)
	{
		g_Message("EE", "유형구분을 입력해주십시오.");
		cbo_TEST_TYPE.setFocus();
		return false;
	}
	if(gfn_length(ds_Master.getColumn(nRow,"FORM_CD"))== 0)
	{
		g_Message("EE", "테스트을 입력해주십시오.");
		cbo_FORM_CD.setFocus();
		return false;
	}
	if(gfn_length(ds_Master.getColumn(nRow,"TRAINEE"))== 0)
	{
		g_Message("EE", "수강자를 입력해주십시오.");
		ed_TRAINEE.setFocus();
		return false;
	}
	//생년월일미사용_20190830
	//if(gfn_length(ds_Master.getColumn(nRow,"BIRTHDAY"))== 0)
	//{
	//	g_Message("EE", "생년월일을 입력해주십시오.");
	//	me_BIRTHDAY.setFocus();
	//	return false;
	//}
	if(gfn_length(ds_Master.getColumn(nRow,"TM_CD"))== 0)
	{
		g_Message("EE", "소속을 입력해주십시오.");
		return false;
	}
	if(gfn_length(ds_Master.getColumn(nRow,"CHARGE_SABUN"))== 0)
	{
		g_Message("EE", "점장을 입력해주십시오.");
		ed_CHARGE_NM.setFocus();
		return false;
	}

    return true;
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_afterSearchList()
 * 입      력   : errCode 	= 에러코드
				  errMsg	= 에러메세지
 * 반      환   : 없음
 * 기      능   : 
 ******************************************************************************************
 */
function fn_afterSearchList(errCode, errMsg)
{
	if(errCode!=0)
	{
		g_Message("EE", "서비스 오류:시스템 관리자에게 문의하십시오");
		return;
	}
	
	//trace(ds_list.saveXML());
	//trace(ds_Master.saveXML());
	
	ds_Master.copyData(ds_list);
	ds_Master.rowposition = -1;
	
	fn_enable_sett(false);
	fn_readonly_sett(true);
	fn_clear_sett();
	
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_afterSearch()
 * 입      력   : errCode 	= 에러코드
				  errMsg	= 에러메세지
 * 반      환   : 없음
 * 기      능   : 사업장 조회 후 실행 함수
 ******************************************************************************************
 */
function fn_afterSearch(errCode, errMsg)
{
	if(errCode!=0)
	{
		g_Message("EE", "서비스 오류:시스템 관리자에게 문의하십시오");
		return;
	}
	
	//trace(ds_Detail.saveXML());
	
	st_playtime.text = "";
	
	var nRowCnt = ds_Detail.getRowCount();
	for(var i=0 ; i<nRowCnt ; i++)
	{
		if(ds_Detail.getColumn(i,"STATUS") == "30")
		{
			st_playtime.text = ds_Detail.getColumn(i,"START_DT") + " ~ " + ds_Detail.getColumn(i,"END_DT");
			break;
		}
	}

}

/*
 ******************************************************************************************
 * 함  수  명   : fn_afterSave()
 * 입      력   : errCode 	= 에러코드
				  errMsg	= 에러메세지
 * 반      환   : 없음
 * 기      능   : 저장후 실행 함수
 ******************************************************************************************
 */
function fn_afterSave(errCode, errMsg)
{
	if(errCode!=0)
	{
		g_Message("EE", "서비스 오류:시스템 관리자에게 문의하십시오");
		return;
	}
	else
		g_Message("03", "저장되었습니다.");

	fn_enable_sett(false);
	fn_readonly_sett(true);
	fn_clear_sett();
	
	//결과보고서출력
	if(isInsert) fn_print_single();
	
	//대상자추가
	if(confirm('다른 수강자로 시험을 보시겠습니까?'))
	{
		fn_add_insert();
		return;
	}
	
	//CopyF(ds_TEST_TYPE,v_ds.name);	
	//ds_TEST_TYPE.filter("");
	//ds_FORM_CD.filter("");
	
	fn_search();

}

function fn_add_insert()
{
	if (gfn_length(ds_input.getColumn(0,"UPJANG"))== 0)
	{
		g_Message("EE", "사업장을 입력하세요.");
		edt_upjang.setFocus();
		return false;
	}
	
	if (gfn_dsIsUpdated(ds_Master)==true || gfn_dsIsUpdated(ds_Detail)==true)
	{
		g_Message("EE", "변경된 데이터가 있습니다.\n 저장 후 입력해주십시오.");
		return;
	}
	
	ds_MasterCp.clearData();
	ds_DetailCp.clearData();
	ds_MasterCp.copyData(ds_Master);
	ds_DetailCp.copyData(ds_Detail);
	ds_inputCp.copyData(ds_input);
	
	var nARow;
	
	ds_Master.clearData();
	nARow = ds_Master.addRow();
	
	ds_Master.setColumn(nARow, "UPJANG", ds_MasterCp.getColumn(0,"UPJANG"));
	ds_Master.setColumn(nARow, "UPJANGNM", ds_MasterCp.getColumn(0,"UPJANGNM"));
	ds_Master.setColumn(nARow, "TRAINEE", "");
	ds_Master.setColumn(nARow, "TEST_DATE", ds_MasterCp.getColumn(0,"TEST_DATE"));
	ds_Master.setColumn(nARow, "STATUS", "20"); //동영상시청
	ds_Master.setColumn(nARow, "STATUSNM", ds_MasterCp.getColumn(0,"STATUSNM"));
	ds_Master.setColumn(nARow, "TM_CD", ds_MasterCp.getColumn(0,"TM_CD"));
	ds_Master.setColumn(nARow, "TM_NM", ds_MasterCp.getColumn(0,"TM_NM"));
	ds_Master.setColumn(nARow, "CHARGE_SABUN", ds_MasterCp.getColumn(0,"CHARGE_SABUN"));
	ds_Master.setColumn(nARow, "CHARGE_NM", ds_MasterCp.getColumn(0,"CHARGE_NM"));
	ds_Master.setColumn(nARow, "COMPLETEYN", ds_MasterCp.getColumn(0,"COMPLETEYN"));
	ds_Master.setColumn(nARow, "SCORE", 0);
	ds_Master.setColumn(nARow, "TEST_TYPE", ds_MasterCp.getColumn(0,"TEST_TYPE"));
	ds_Master.setColumn(nARow, "FORM_CD", ds_MasterCp.getColumn(0,"FORM_CD"));
	ds_Master.setColumn(nARow, "URL_LINK", ds_MasterCp.getColumn(0,"URL_LINK"));
	ds_Master.setColumn(nARow, "TIME_LIMIT", ds_MasterCp.getColumn(0,"TIME_LIMIT"));
	
	ds_Detail.clearData();

	var nRowCnt = ds_DetailCp.getRowCount();
	for(var i=0 ; i<nRowCnt ; i++)
	{
		if(ds_DetailCp.getColumn(i, "STATUS") <> "30")
		{
			nARow = ds_Detail.addRow();
			ds_Detail.setColumn(nARow, "UPJANG", ds_DetailCp.getColumn(i,"UPJANG"));
			ds_Detail.setColumn(nARow, "TEST_DATE", ds_DetailCp.getColumn(i,"TEST_DATE"));
			ds_Detail.setColumn(nARow, "TRAINEE", "");
			ds_Detail.setColumn(nARow, "STATUS", ds_DetailCp.getColumn(i,"STATUS"));
			ds_Detail.setColumn(nARow, "STATUSNM", ds_DetailCp.getColumn(i,"STATUSNM"));
			ds_Detail.setColumn(nARow, "SEQNO", ds_DetailCp.getColumn(i,"SEQNO"));
			ds_Detail.setColumn(nARow, "START_DT", ds_DetailCp.getColumn(i,"START_DT"));
			ds_Detail.setColumn(nARow, "END_DT", ds_DetailCp.getColumn(i,"END_DT"));
			ds_Detail.setColumn(nARow, "ANSWER", ds_DetailCp.getColumn(i,"ANSWER"));
		}
	}
	
	ds_Detail.filter("STATUS=='30'");
	
	//수강자,시험보기활성화
	ed_TRAINEE.enable = true;
	ed_TRAINEE.readonly = false;
	btn_test.enable = true;
	ed_TRAINEE.setFocus();
	
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_afterDelete()
 * 입      력   : errCode 	= 에러코드
				  errMsg	= 에러메세지
 * 반      환   : 없음
 * 기      능   : 삭제후 실행 함수
 ******************************************************************************************
 */
function fn_afterDelete(errCode, errMsg)
{
	if(errCode!=0)
	{
		g_Message("EE", "서비스 오류:시스템 관리자에게 문의하십시오.");
		return;
	}
	else
		g_Message("02", "삭제되었습니다.");
	
	ds_list.clearData();
	ds_Master.clearData();
	ds_Detail.clearData();

	fn_enable_sett(false);
	fn_readonly_sett(true);
	fn_clear_sett();
	
}


//=========================================================================================
// [ PART 6 ]
// component Event 정의 ( User Define function )
// --> component Event의 기요,기능,동작 등 상세내용은 MiPlatform 메뉴얼을 참조하시기 바랍니다.
//=========================================================================================
 /******************************************************************************************
 * 함  수  명   : grd_List_OnHeadClick(obj,nCell,nX,nY,nPivotIndex)
 * 기      능   : 그리드헤드 더블클릭시 Sort
 ******************************************************************************************
 */
function grd_List_OnHeadClick(obj:Grid, e:GridClickEventInfo)
{
	gfn_gridSort(obj, e); //(eval(obj.binddataset), obj, e.cell);
}
/*
 ******************************************************************************************
 * 함  수  명   : btn_Date_OnClick(obj,nX,nY)
 * 기      능   : 달력
 ******************************************************************************************
 */
function btn_Date_OnClick(obj:Button, e:ClickEventInfo)
{
	var objme = eval(obj.userdata);
	
	var retDate = gfn_dialog("", "U_SCC::SCC_CALENDAR.xfdl","fa_Date="+wrapQuote(objme.value),-1,-1,"Title=false Status=false");

	objme.value  = retDate;
}
/*
 ******************************************************************************************
 * 함  수  명   : ed_pop_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam)
 * 기      능   : 업장엔터시팝업
 ******************************************************************************************
 */
function ed_pop_OnKeyDown(obj:Edit, e:KeyEventInfo)
{
	if (e.keycode == 13)
	{
		var objme = eval(obj.userdata);
		objme.click();
	}
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_Pop_OnKeyDown(obj,nChar,bShift,bCtrl,bAlt,nLLParam,nHLParam)
 * 기      능   : 팝업edit키입력시
 ******************************************************************************************
 */
function fn_Pop_OnKeyDown(obj:Edit, e:KeyEventInfo)
{
	if( e.keycode == 13 ) {
		if( gfn_length(gfn_trim(obj.value))== 0 ) {
			var objme = eval(obj.userdata);
			objme.click();
		}
	}
}

function div_bk_grd_list_oncellclick(obj:Grid, e:GridClickEventInfo)
{
	if(e.row < 0) return;
	
	var strMsg = "변경된 내역이 있습니다. 저장하시겠습니까?\n(취소하신 경우 자료는 초기화됩니다.)";
	var nFRow,strSts;

	nFRow = ds_Master.findRowExpr("UPJANG=='" + ds_list.getColumn(e.row,"UPJANG") + "'&&TEST_DATE=='" + ds_list.getColumn(e.row,"TEST_DATE") + "'&&TRAINEE=='" + ds_list.getColumn(e.row,"TRAINEE") + "'");
	//trace(nFRow+"-"+ds_Master.rowposition);

	if (nFRow != ds_Master.rowposition)
	{
		if (gfn_dsIsUpdated(ds_Master)==true || gfn_dsIsUpdated(ds_Detail)==true)
		{
			if (g_Confirm("02",strMsg))
			{
				fn_save();
				return;
			}
			else
			{
				fn_search();
				return;
			}
		}
	}
	
	st_playtime.text = "";

	ds_Master.rowposition = nFRow;
	
	//trace(ds_Master.saveXML());
	
	//진행상태(10:등록, 20:동영상교육, 30:테스트, 90:완료)
	strSts = ds_Master.getColumn(ds_Master.rowposition,"STATUS");
	
	if(strSts != "10" && strSts != "20" && strSts != "30" && strSts != "90")
	{
		g_Message("EE", "진행상태를 확인해주세요.");
		return;
	}

	btn_UPJANGNM2.enable	 = false;
	btn_CHARGE_SABUN.enable	     = false;
	btn_urllink.enable		= false;
	btn_test.enable			= false;

	ed_TRAINEE.readonly     = true;
	me_BIRTHDAY.readonly    = true;
	cbo_TEST_TYPE.eadonly   = true;
	cbo_FORM_CD.eadonly     = true;
	ed_TRAINEE.eadonly      = true;

	//cbo_TEST_TYPE.enable	= false;
	//cbo_FORM_CD.enable		= false;
	//ed_TRAINEE.enable		= false
	
	var btp;
	if (g_AuthLevel > g_Leader_AuthLevel)	// 수정가능 
	{
		btp = true;
		
		if(strSts == "90")
		{
			btp = false; //완료상태 수정불가
		}
	}
	else
	{
		btp = false;
	}
	
	btn_UPJANGNM2.enable	 = btp;
	btn_CHARGE_SABUN.enable	     = btp;
	btn_urllink.enable		= btp;
	btn_test.enable			= btp;

	ed_TRAINEE.readonly     = !btp;
	me_BIRTHDAY.readonly    = !btp;

	cbo_TEST_TYPE.enable	= btp;
	cbo_FORM_CD.enable		= btp;
	ed_TRAINEE.enable		= btp

	isInsert = false;
	
	fbAble = btp;

	// 초기화
	ds_Detail.clearData();
	fn_clear_sett();

	if(strSts == "90")
	{
		return;
	}

	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	
	nRow = ds_list.rowposition;

	strAllYn = "Y";
	
	ds_input.setColumn(0,"UPJANG",ds_Master.getColumn(nRow,"UPJANG"));
	ds_input.setColumn(0,"TRAINEE",ds_Master.getColumn(nRow,"TRAINEE"));
	ds_input.setColumn(0,"TEST_DATE",ds_Master.getColumn(nRow,"TEST_DATE"));
	
	strAllYn = "N";
	
	actionName		= "FSC91020E_T005";
	cmdName			= "U_svc::" + "fs/fsc/FSC91020E_T005.jsp";
	inData			= "ds_input=ds_input";
	outData			= "ds_Detail=ds_Detail";
	callBackFnc		= "fn_afterSearch";
	
	jsp_transaction(this,actionName, cmdName ,inData ,outData,otherArg,callBackFnc);
}
 
/*
 ******************************************************************************************
 * 함  수  명   : ds_Master_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
 * 기      능   : 마스터 변경시
 ******************************************************************************************
 */
function ds_Master_OnColumnChanged(obj:Dataset, e:DSColChangeEventInfo)
{

}

/*
 ******************************************************************************************
 * 함  수  명   : ds_CanColumnChange(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
 * 기      능   : 수정불가인 경우 수정불가
 ******************************************************************************************
 */
function ds_CanColumnChange(obj:Dataset, e:DSColChangeEventInfo)
{
	if (!fbAble)
	{
		return false;
	}
}

/*
 ******************************************************************************************
 * 함  수  명   : div_bk_OnSize(obj,nCx,nCy)
 * 기      능   : 리스트 div가 변경될때 그리드 크기변경
 ******************************************************************************************
 */
function div_bk_OnSize(obj:Div, e:SizeEventInfo)
{
	div_bk.grd_list.position.height = obj.position.height -4;
}

//================================================================
// 점장 조회 팝업 클릭 이벤트
//================================================================
function btn_CHARGE_SABUN_OnClick(obj:Button, e:ClickEventInfo){
	fn_sql_common_setup( strMAQuery_SABUN
						,strMAQuery_SABUNKeyField
						,strMAQuery_SABUNValueField
						,strMAQuery_SABUNKeyFieldNM
						,strMAQuery_SABUNValueFieldNM
						,""
						,""
						,""
						,strMAQuery_SABUNCaption
						,strMAQuery_SABUNAllField
						);
	
	ds_Master.setColumn(ds_Master.rowposition, "CHARGE_NM",    gds_sql_common.getColumn(0, "ret_name"));
	ds_Master.setColumn(ds_Master.rowposition, "CHARGE_SABUN", gds_sql_common.getColumn(0, "ret_code"));
}


function btn_UPJANGNM2_OnClick(obj:Button, e:ClickEventInfo)
{
	fn_sql_common_setup( strMAQuery_Team
						,strMAQuery_TeamKeyField
						,strMAQuery_TeamValueField
						,strMAQuery_TeamKeyFieldNM
						,strMAQuery_TeamValueFieldNM
						,""
						,""
						,""
						,strMAQuery_TeamCaption
						,strMAQuery_TeamAllField
						);

	
	ds_Master.setColumn(ds_Master.rowposition, "TM_NM", gds_sql_common.getColumn(0, "ret_name"));
	ds_Master.setColumn(ds_Master.rowposition, "TM_CD", gds_sql_common.getColumn(0, "ret_code"));
}

/***************************************************************************
 * 설명   : 그리드에서 커서로 버튼 이동시 결재버튼 제어
 ***************************************************************************/

function edt_upjang_onclick(obj:UpjangSearchComponent,  e:ClickEventInfo)
{
	
}

function sp_down_onmove(obj:Splitter, e:MoveEventInfo)
{
}

function ds_Master_oncolumnchanged(obj:Dataset, e:DSColChangeEventInfo)
{
	if (e.columnid == "TEST_TYPE")
	{
		ds_FORM_CD.filter("");

		if(e.newvalue != "" && e.newvalue != "undefined")
		{
			ds_FORM_CD.filter("TEST_TYPE==" + wrapQuote(e.newvalue));
		}
		
	}
	if (e.columnid == "FORM_CD")
	{
		ed_URL_LINK.value = "";
		ed_TIME_LIMIT.value = "";

		if(e.newvalue != "" && e.newvalue != "undefined")
		{
			var nRowCnt = ds_FORM_CD.getRowCount();
			for(var i=0 ; i<nRowCnt ; i++)
			{
				if(ds_FORM_CD.getColumn(i,"FORM_CD") == e.newvalue)
				{
					ed_URL_LINK.value = ds_FORM_CD.getColumn(i,"URL_LINK");
					ed_TIME_LIMIT.value = ds_FORM_CD.getColumn(i,"TIME_LIMIT");
					break;
				}
			}
		}
	}
	if (e.columnid == "TRAINEE")
	{
		ds_Detail.filter("");
		for(var j=0 ; j<ds_Detail.getRowCount(); j++)
		{
			ds_Detail.setColumn(j, "TRAINEE", e.newvalue);
		}
		ds_Detail.filter("STATUS=='30'");
	}
}

//동영상보기클릭
function btn_urllink_onclick(obj:Button,  e:ClickEventInfo)
{
	if(!fn_SaveCheck())
	{
		return;
	}
	
	if(ed_URL_LINK.value == "")
	{
		g_Message("EE", "동영상교육링크를 확인해주십시오.");
		return;
	}

	//재 동영상시청 시 기존 DataSet 삭제
	for(var i=0 ; i<ds_Detail.getRowCount() ; i++)
	{
		if(ds_Detail.getColumn(i,"STATUS") == "20")
		{
			ds_Detail.deleteRow(i);
		}
	}
	
	//MST 징행상태&수료여부반영
	ds_Master.setColumn(ds_Master.rowposition, "STATUS", "10"); //진행상태(동영상교육)
	ds_Master.setColumn(ds_Master.rowposition, "COMPLETEYN", "N"); //수료여부

	//등록상태 종료일시 set
	fn_Dsdetail_Setcolumn("10", 0, "END_DT", gfn_todayTime());
	fn_Dsdetail_Setcolumn("10", 0, "ANSWER", "");
	
	var strSdate, strEdate;
	
	strSdate = gfn_todayTime();

	var v_arg = {};
	v_arg["fa_UTL_LINK"] = ed_URL_LINK.value;
	var nWidth      = 896;
	var nHeight     = 580;
	var strStyle    = "";
	var nLeft       = -1;
	var nTop        = -1;
	var isModeless  = false;
	var bShowTitle  = true;
	var strAlign    = "-1";

	var rtnVal = gfn_dialog("", "U_FSC::FSC91020P.xfdl",v_arg, nWidth, nHeight, strStyle, nLeft, nTop, isModeless, bShowTitle, strAlign);
	
	strEdate = gfn_todayTime();

	//MST 징행상태&수료여부반영
	ds_Master.setColumn(ds_Master.rowposition, "STATUS", "20"); //진행상태(동영상교육)
	
	//동영상시청시간체크
	if(fn_playTime_Chk(strSdate.substring(8, 14), strEdate.substring(8, 14), ds_Master.getColumn(ds_Master.rowposition,"TIME_LIMIT")))
	{
		ds_Master.setColumn(ds_Master.rowposition, "COMPLETEYN", "Y"); //수료여부
		cbo_TEST_TYPE.enable = false;
		cbo_FORM_CD.enable = false;
	}

	fn_Dsdetail_Setcolumn("20", 0, "START_DT", strSdate);
	fn_Dsdetail_Setcolumn("20", 0, "END_DT", strEdate);
	fn_Dsdetail_Setcolumn("20", 0, "ANSWER", "");
	
	//play time disp
	st_playtime.text = strSdate.substring(0,4)+"-"+strSdate.substring(4,6)+"-"+strSdate.substring(6,8)+" "+strSdate.substring(8,10)+":"+strSdate.substring(10,12)+":"+strSdate.substring(12,14)+" ~ "+strEdate.substring(0,4)+"-"+strEdate.substring(4,6)+"-"+strEdate.substring(6,8)+" "+strEdate.substring(8,10)+":"+strEdate.substring(10,12)+":"+strEdate.substring(12,14);

}

//동영상시청시간체크
function fn_playTime_Chk(sTime, eTime, lTime)
{
	if(gfn_getDiffTime(sTime, eTime, "ss") < toNumber(lTime))
	{
		return false;
	}
	return true;
}

//시험보기클릭
function btn_test_onclick(obj:Button,  e:ClickEventInfo)
{
	if(ds_Master.getColumn(ds_Master.rowposition,"STATUS") == "20" && ds_Master.getColumn(ds_Master.rowposition,"COMPLETEYN") <> "Y")
	{
		g_Message("EE", "영상을 끝까지 시청하셔야합니다.");
		return;
	}

	if(ds_Master.getColumn(ds_Master.rowposition,"COMPLETEYN") <> "Y")
	{
		g_Message("EE", "수강자등록 및 동영상교육을 진행해주십시오.");
		return;
	}

	if(ds_Master.getColumn(ds_Master.rowposition,"STATUS") == "10") //진행상태(등록)
	{
		g_Message("EE", "동영상교육을 진행해주십시오.");
		return;
	}

	//테스트진행체크
	if(ds_Master.getColumn(ds_Master.rowposition,"STATUS") == "30") //진행상태(테스트)
	{
		if(! confirm('테스트를 다시 진행하시겠습니까?')) return;
	}
	
	txt_Test.value = "";
	RadioSel.visible = false;
	ed_Answer.value = "";
	ed_Answer.visible = true;
	img_viewer.image = "";

	ds_Detail.clearData();
	
	seqNo = 0;
	
	btn_result.enable		= true;

	// 문제조회
	ds_TEST_EXAM.clearData();
	
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	
	actionName		= "FSC91020E_T002";
	cmdName			= "U_svc::" + "fs/fsc/FSC91020E_T002.jsp";
	inData			= "ds_Master=ds_Master";
	outData			= "ds_TEST_EXAM=ds_TEST_EXAM";
	callBackFnc		= "fn_afterSearchTest";
	
	jsp_transaction(this,actionName, cmdName ,inData ,outData,otherArg,callBackFnc,true,false,false);

}

function fn_Dsdetail_Setcolumn(sts, seq, id, value)
{
	var nARow;
	var sFlag = "N";

	ds_Detail.filter("");
	
	for(var i=0 ; i<ds_Detail.getRowCount() ; i++)
	{
		if(ds_Detail.getColumn(i,"STATUS") == sts && ds_Detail.getColumn(i,"SEQNO") == seq)	//수정
		{
			ds_Detail.setColumn(i, id, value);
			sFlag = "Y";
			break;
		}
	}
	
	//입력
	if(sFlag == "N")
	{
		nARow = ds_Detail.addRow();
		ds_Detail.setColumn(nARow, "UPJANG", ds_Master.getColumn(ds_Master.rowposition,"UPJANG"));
		ds_Detail.setColumn(nARow, "TEST_DATE", ds_Master.getColumn(ds_Master.rowposition,"TEST_DATE"));
		ds_Detail.setColumn(nARow, "TRAINEE", ds_Master.getColumn(ds_Master.rowposition,"TRAINEE"));
		ds_Detail.setColumn(nARow, "STATUS", sts); //진행상태
		ds_Detail.setColumn(nARow, "SEQNO", seq);
		ds_Detail.setColumn(nARow, id, value);
	}
	
	ds_Detail.filter("STATUS=='30'");
}

function fn_Dsdetail_Getcolumn(sts, seq, id)
{
	var value = "";
	
	for(var i=0 ; i<ds_Detail.getRowCount() ; i++)
	{
		if(ds_Detail.getColumn(i,"STATUS") == sts && ds_Detail.getColumn(i,"SEQNO") == seq)
		{
			value = ds_Detail.getColumn(i, id);
			break;
		}
	}

	return value;
}

//테스트문제조회callback
function fn_afterSearchTest(errCode, errMsg)
{
	if(errCode!=0)
	{
		g_Message("EE", "서비스 오류:시스템 관리자에게 문의하십시오");
		return;
	}
	//trace(ds_TEST_EXAM.saveXML());

	//시작,끝번호
	var nRowCnt = ds_TEST_EXAM.getRowCount();
	
	if(nRowCnt == 0)
	{
		g_Message("EE", "테스트 시험정보가 없습니다.");
		return;
	}
	
	btn_Prev.enable = true;
	btn_Next.enable = true;
	ed_Answer.readonly = false;
	RadioSel.readonly = false;
	
	nFseqno = 1;
	nLseqno = nRowCnt;

	var strSdate = gfn_todayTime();

	//MST 진행상태&수료여부반영
	ds_Master.setColumn(ds_Master.rowposition, "STATUS", "30"); //진행상태(테스트)
	
	//순번초기화
	nSeqNo = 0;

	nSeqNo = nSeqNo + 1;
	
	fn_testStep(nSeqNo);
	
}

//문제Step
function fn_testStep(seqNo)
{
	if(seqNo > nLseqno)
	{
		nSeqNo = nSeqNo -1;
		return;
	}
	if(seqNo < nFseqno)
	{
		nSeqNo = nSeqNo +1;
		return;
	}
	
	fn_Dsdetail_Setcolumn("30", seqNo, "START_DT", gfn_todayTime());
	fn_Dsdetail_Setcolumn("30", seqNo, "END_DT", "");
	
	st_Seqno.text = seqNo;
	txt_Test.value = ds_TEST_EXAM.getColumn(seqNo-1, "TEST");
	//txt_Example.value = ds_TEST_EXAM.getColumn(seqNo-1, "EXAMPLE");
	ed_Distribution.value = ds_TEST_EXAM.getColumn(seqNo-1, "DISTRIBUTION");
	
	//보기RadioSet
	var nARow;
	var sAns;
	ds_select.clearData();
	
	sAns = fn_Dsdetail_Getcolumn("30",seqNo,"ANSWER");

	if (gfn_isNull(ds_TEST_EXAM.getColumn(seqNo-1,"EXAMPLE1")) && gfn_isNull(ds_TEST_EXAM.getColumn(seqNo-1,"EXAMPLE2")) && gfn_isNull(ds_TEST_EXAM.getColumn(seqNo-1,"EXAMPLE3")) && gfn_isNull(ds_TEST_EXAM.getColumn(seqNo-1,"EXAMPLE4")))
	{
		RadioSel.visible = false;
		ed_Answer.visible = true;
		RadioSel.enable = false;
		ed_Answer.enable = true;
		ed_Answer.value = sAns;
	}
	else
	{
		nARow = ds_select.addRow();
		ds_select.setColumn(nARow, "Seq", "1");
		ds_select.setColumn(nARow, "Example", ds_TEST_EXAM.getColumn(seqNo-1,"EXAMPLE1"));
		nARow = ds_select.addRow();
		ds_select.setColumn(nARow, "Seq", "2");
		ds_select.setColumn(nARow, "Example", ds_TEST_EXAM.getColumn(seqNo-1,"EXAMPLE2"));
		nARow = ds_select.addRow();
		ds_select.setColumn(nARow, "Seq", "3");
		ds_select.setColumn(nARow, "Example", ds_TEST_EXAM.getColumn(seqNo-1,"EXAMPLE3"));
		nARow = ds_select.addRow();
		ds_select.setColumn(nARow, "Seq", "4");
		ds_select.setColumn(nARow, "Example", ds_TEST_EXAM.getColumn(seqNo-1,"EXAMPLE4"));

		RadioSel.visible = true;
		ed_Answer.visible = false;
		RadioSel.enable = true;
		ed_Answer.enable = false;
		RadioSel.value = sAns;
	}

	img_viewer.image = "";
	fn_imgFileView(seqNo);
	
	ds_Detail.selectRow(seqNo-1);
	
	ed_Answer.setFocus();
	
}

/***************************************************************************
 * 설명   : 서버에 저장된 이미지파일 view
 ***************************************************************************/
function fn_imgFileView(seqNo)
{
	var imgVal = ds_TEST_EXAM.getColumn(seqNo-1, "SERVER_FILENM");
	
    if (!gfn_isNull(imgVal))
    {
		//trace(application.services["svc"].url + "upload/fs/" + imgVal);
		img_viewer.stretch = "fit"; //fixaspectratio, none, fit
		img_viewer.image = application.services["svc"].url + "upload/fs/" + imgVal;
		btn_imgView.enable = true;
		btn_imgView.visible = true;
	}
	else
	{
		btn_imgView.enable = false
		btn_imgView.visible = false;
	}
}

//이전클릭
function btn_Prev_onclick(obj:Button,  e:ClickEventInfo)
{
	if(nSeqNo < nFseqno)
	{
		nSeqNo = nSeqNo +1;
		ed_Answer.setFocus();
		return;
	}
	if(nSeqNo == 1)
	{
		ed_Answer.setFocus();
		return;
	}
	nSeqNo = nSeqNo - 1;
	
	fn_testStep(nSeqNo);
	
	if(nSeqNo == nFseqno)
	{
		btn_Prev.enable = false;
		btn_Next.enable = true;
	}
	else
	{
		btn_Prev.enable = true;
		btn_Next.enable = true;
	}
	
}

//다음클릭
function btn_Next_onclick(obj:Button,  e:ClickEventInfo)
{
	if(nSeqNo > nLseqno)
	{
		nSeqNo = nSeqNo -1;
		ed_Answer.setFocus();
		return;
	}
	if(nSeqNo == nLseqno)
	{
		ed_Answer.setFocus();
		return;
	}
	nSeqNo = nSeqNo + 1;
	
	fn_testStep(nSeqNo);

	if(nSeqNo == nLseqno)
	{
		btn_Next.enable = false;
		btn_Prev.enable = true;
	}
	else
	{
		btn_Next.enable = true;
		btn_Prev.enable = true;
	}
}

function cbo_TEST_TYPE_onitemchanged(obj:Combo, e:ItemChangeEventInfo)
{
	cbo_FORM_CD.setFocus();
}

function cbo_FORM_CD_onitemchanged(obj:Combo, e:ItemChangeEventInfo)
{
	ed_TRAINEE.setFocus();
}

function ed_TRAINEE_onkillfocus(obj:Edit, e:KillFocusEventInfo)
{
	fn_Dsdetail_Setcolumn("10", 0, "TRAINEE", ed_TRAINEE.value);

	//me_BIRTHDAY.setFocus();
	me_TEST_DATE.setFocus();
}

function me_BIRTHDAY_onkillfocus(obj:MaskEdit, e:KillFocusEventInfo)
{
//	fn_Dsdetail_Setcolumn("10", 0, "BIRTHDAY", me_BIRTHDAY.value);
}

function ed_Answer_onkillfocus(obj:Edit, e:KillFocusEventInfo)
{
	if(nSeqNo == 0) return;
	
	//이미지보기
	if(imgAble) return;
	
	if(ed_Answer.value == "" || ed_Answer.value == "undefined" || ed_Answer.value == null)
	{
		fn_Dsdetail_Setcolumn("30", nSeqNo, "END_DT", "");
		fn_Dsdetail_Setcolumn("30", nSeqNo, "ANSWER", "");
	}
	else
	{
		fn_Dsdetail_Setcolumn("30", nSeqNo, "END_DT", gfn_todayTime());
		fn_Dsdetail_Setcolumn("30", nSeqNo, "ANSWER", ed_Answer.value);
		
		if(nSeqNo < nLseqno)
		{
			ed_Answer.value = "";
		}
	}
	
	//이미지보기 실행 전 Next Step 처리로 주석처리
	//f_resultChk();
}

//제출클릭
function btn_result_onclick(obj:Button,  e:ClickEventInfo)
{
	var nExamCnt = 0;
	var nAnswerCnt = 0;
	var nScore = 0;
	
	nExamCnt = ds_TEST_EXAM.getRowCount();
	
	for(var i=0 ; i<ds_Detail.getRowCount() ; i++)
	{
		if(ds_Detail.getColumn(i,"ANSWER") != "" && ds_Detail.getColumn(i,"ANSWER") != "undefined" && ds_Detail.getColumn(i,"ANSWER") != null)
		{
			nAnswerCnt = nAnswerCnt + 1;
		}
		//채점
		for(var j=0 ; j<ds_TEST_EXAM.getRowCount() ; j++)
		{
			if(ds_TEST_EXAM.getColumn(j,"SEQ") == ds_Detail.getColumn(i,"SEQNO"))
			{
				if(ds_Detail.getColumn(i,"ANSWER") == ds_TEST_EXAM.getColumn(j,"ANSWER"))	//정답
				{
					nScore = nScore + ds_TEST_EXAM.getColumn(j,"DISTRIBUTION");
				}
				else	//오답
				{
				}
			}
		}
	}
	
	if(nExamCnt <> nAnswerCnt)
	{
		if(! confirm('미등록답이 있습니다. 제출하시겠습니까?'))
		{
			ed_Answer.setFocus();
			return;
		}
	}
	else
	{
		if(! confirm('제출하시겠습니까?'))
		{
			ed_Answer.setFocus();
			return;
		}
	}
		
	//교육점수
	ds_Master.setColumn(ds_Master.rowposition, "SCORE", nScore);

	ds_Master.setColumn(ds_Master.rowposition, "STATUS", "90"); //진행상태(완료)

	//저장
	fn_save();

	//trace(ds_Master.saveXML());
	//trace("=======================================");
	//trace(ds_Detail.saveXML());
}

function fn_enable_sett(iBool)
{
	btn_urllink.enable = iBool;
	btn_test.enable = iBool;
	btn_Prev.enable = iBool;
	btn_Next.enable = iBool;
	btn_result.enable = iBool;
	btn_imgView.enable = iBool;
	RadioSel.enable = iBool;
	ed_Answer.enable = iBool;
	//RadioSel.visible = iBool;
	//ed_Answer.visible = !iBool;
}

function fn_readonly_sett(iBool)
{
	ed_TRAINEE.readonly     = iBool;
	me_BIRTHDAY.readonly    = iBool;
	RadioSel.readonly = iBool;
	ed_Answer.readonly = iBool;
}

function fn_clear_sett()
{
	st_playtime.text = "";
	st_Seqno.text = "";
	txt_Test.value = "";
	txt_Example.value = "";
	ed_Distribution.value = "";
	ed_Answer.value = "";
	img_viewer.image = "";
	RadioSel.index = -1;
	ds_TEST_TYPE.filter("");
	ds_FORM_CD.filter("");
}

function ds_input_onvaluechanged(obj:Dataset,  e:DSColChangeEventInfo)
{
	//trace("ds_input_onvaluechanged");

	if(strAllYn == "Y") return;

	if(e.columnid == "UPJANG")
	{
		fn_upjangChangedEvent();
	}
}

function fn_upjangChangedEvent() {
	
	//trace("fn_upjangChangedEvent");

	// 초기화
	ds_list.clearData();
	ds_Master.clearData();
	ds_Detail.clearData();

	btn_UPJANGNM2.enable = false;
	btn_CHARGE_SABUN.enable = false;
	
	if(gfn_isNull(ds_input.getColumn(0, "UPJANG"))) {
		return;
	}

	// 초기화
	ds_UpjangInfo.clearData();
	
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	
	actionName		= "FSC91030E_T002";
	cmdName			= "U_svc::" + "fs/fsc/FSC91030E_T002.jsp";
	inData			= "ds_input=ds_input";
	outData			= "ds_UpjangInfo=ds_UpjangInfo";
	callBackFnc		= "fn_afterUpjangInfo";
	
	jsp_transaction(this,actionName, cmdName ,inData ,outData,otherArg,callBackFnc,true,false,false);
	
}

function fn_afterUpjangInfo(errCode, errMsg)
{
	if(errCode!=0)
	{
		g_Message("EE", "서비스 오류:시스템 관리자에게 문의하십시오");
		return;
	}
	if(ds_UpjangInfo.rowcount == 0)
	{
		g_Message("EE", "사업장을 재검색해 주세요");
		edt_upjang.setFocus();
		return;
	}
}

function RadioSel_onitemchanged(obj:Radio, e:ItemChangeEventInfo)
{
	if(nSeqNo == 0) return;
	
	fn_Dsdetail_Setcolumn("30", nSeqNo, "END_DT", gfn_todayTime());
	fn_Dsdetail_Setcolumn("30", nSeqNo, "ANSWER", obj.value);
	
	f_resultChk();
}

function btn_imgView_onclick(obj:Button,  e:ClickEventInfo)
{
	if(gfn_isNull(img_viewer.image) || gfn_indexOf(img_viewer.image, "theme://", 0) > -1)
	{
		return;
	}

	var sImage = encodeURI(gfn_subStr(img_viewer.image,5,gfn_length(img_viewer.image)-7));
	//trace(sImage);
	system.execBrowser(sImage);	
}

function f_resultChk()
{
	var nAnswerCnt = 0;
	var nRowCnt = ds_TEST_EXAM.getRowCount();

	if(nRowCnt ==0) return;
	
	for(var i=0 ; i<ds_Detail.getRowCount() ; i++)
	{
		if(ds_Detail.getColumn(i,"ANSWER") != "" && ds_Detail.getColumn(i,"ANSWER") != "undefined" && ds_Detail.getColumn(i,"ANSWER") != null)
		{
			nAnswerCnt = nAnswerCnt + 1;
		}
	}
	
	if(nRowCnt == nAnswerCnt)
	{
		if(! confirm('제출하시겠습니까?'))
		{
			return;
		}
		f_submit();
	}
	else
	{
		f_Next();
	}
}

function f_submit()
{
	var nScore = 0;
	
	//채점
	for(var i=0 ; i<ds_Detail.getRowCount() ; i++)
	{
		for(var j=0 ; j<ds_TEST_EXAM.getRowCount() ; j++)
		{
			if(ds_TEST_EXAM.getColumn(j,"SEQ") == ds_Detail.getColumn(i,"SEQNO"))
			{
				if(ds_Detail.getColumn(i,"ANSWER") == ds_TEST_EXAM.getColumn(j,"ANSWER"))	//정답
				{
					nScore = nScore + ds_TEST_EXAM.getColumn(j,"DISTRIBUTION");
				}
				else	//오답
				{
				}
			}
		}
	}
		
	//교육점수
	ds_Master.setColumn(ds_Master.rowposition, "SCORE", nScore);

	ds_Master.setColumn(ds_Master.rowposition, "STATUS", "90"); //진행상태(완료)

	//저장
	fn_save();

	//trace(ds_Master.saveXML());
	//trace("=======================================");
	//trace(ds_Detail.saveXML());
}

function f_Next()
{
	if(nSeqNo > nLseqno)
	{
		nSeqNo = nSeqNo -1;
		ed_Answer.setFocus();
		return;
	}
	if(nSeqNo == nLseqno)
	{
		ed_Answer.setFocus();
		return;
	}
	nSeqNo = nSeqNo + 1;
	
	fn_testStep(nSeqNo);

	if(nSeqNo == nLseqno)
	{
		btn_Next.enable = false;
		btn_Prev.enable = true;
	}
	else
	{
		btn_Next.enable = true;
		btn_Prev.enable = true;
	}
}

function btn_imgView_onmouseenter(obj:Button, e:MouseEventInfo)
{
	imgAble = true;
}

function btn_imgView_onmouseleave(obj:Button, e:MouseEventInfo)
{
	imgAble = false;
}

function ed_Answer_onkeydown(obj:Edit, e:KeyEventInfo)
{
/*
	if (e.keycode == 13 && ed_Answer.value != "" && ed_Answer.value != "undefined" && ed_Answer.value != null)
	 {
		if(nSeqNo == 0) return;
		
		//이미지보기
		if(imgAble) return;

		fn_Dsdetail_Setcolumn("30", nSeqNo, "END_DT", gfn_todayTime());
		fn_Dsdetail_Setcolumn("30", nSeqNo, "ANSWER", ed_Answer.value);
		
		if(nSeqNo < nLseqno)
		{
			ed_Answer.value = "";
		}

		f_resultChk();
	 }
*/
}

function div_bk_grd_list_onexpanddown(obj:Grid, e:GridMouseEventInfo)
{
    //점수 클릭
	if (e.cell == 10) {
		var strUpjang = ds_list.getColumn(e.row, "UPJANG");
		var strUpjangNm = ds_list.getColumn(e.row, "UPJANGNM");
		var strTrainee = ds_list.getColumn(e.row, "TRAINEE");
		var strTestDate = ds_list.getColumn(e.row, "TEST_DATE");
		var strScore = ds_list.getColumn(e.row, "SCORE");

		var sParam = {
			  strUpjang:strUpjang
			, strUpjangNm:strUpjangNm
			, strTrainee:strTrainee
			, strTestDate:strTestDate
			, strScore:strScore
		};
		var vRtn = gfn_dialog("", "U_FSC::FSC91021P.xfdl", sParam);
	}
}

function img_viewer_onclick(obj:ImageViewer,  e:ClickEventInfo)
{
	if(gfn_isNull(img_viewer.image) || gfn_indexOf(img_viewer.image, "theme://", 0) > -1)
	{
		return;
	}

	var sImage = encodeURI(gfn_subStr(img_viewer.image,5,gfn_length(img_viewer.image)-7));
	//trace(sImage);
	system.execBrowser(sImage);	
}
]]></Script>
  </Form>
</FDL>
