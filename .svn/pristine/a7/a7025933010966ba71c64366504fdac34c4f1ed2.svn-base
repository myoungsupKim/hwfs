<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="../../../default_typedef.xml"/>
  <Form id="FMO00410E" onload="form_onload" titletext="월운영계획등록" position="absolute 0 0 1252 725" scrollbars="none" onkeydown="frm_OnKeyDown">
    <Layouts>
      <Layout>
        <Static id="Static08" class="sta_WFSA_Labelbg" position="absolute 0 30 1237 71" anchor="left top right"/>
        <Grid autoenter="select" binddataset="ds_Monthlist" readonly="false" enable="true" id="grd_list" useinputpanel="false" taborder="7" tabstop="true" usecontextmenu="true" useselcolor="true" visible="true" wheelscrollrow="1" position="absolute 0 102 654 710" selecttype="row" autofittype="col" anchor="left top bottom">
          <Formats>
            <Format id="Default">
              <Columns>
                <Column size="80"/>
                <Column size="70"/>
                <Column size="85"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
              </Columns>
              <Rows>
                <Row size="26" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell displaytype="text" text="일자"/>
                <Cell col="1" displaytype="text" text="요일"/>
                <Cell col="2" displaytype="text" text="구분"/>
                <Cell col="3" displaytype="text" text="예상매출"/>
                <Cell col="4" displaytype="text" text="예상재료비율"/>
                <Cell col="5" displaytype="text" text="예상재료비"/>
                <Cell col="6" displaytype="text" text="직원식수"/>
                <Cell col="7" displaytype="text" text="직원식단가"/>
              </Band>
              <Band id="body">
                <Cell displaytype="date" style="align:center middle;color:EXPR(decode(WEEKDAY,'1','#cc3300ff','7','#0033ccff','BLACK'));color2:EXPR(decode(WEEKDAY,'1','#cc3300ff','7','#0033ccff','BLACK'));" expr="expr:YYMM+DD" calendardisplaynulltype="none"/>
                <Cell col="1" displaytype="combo" style="align:center middle;color:EXPR(decode(WEEKDAY,'1','#cc3300ff','7','#0033ccff','BLACK'));color2:EXPR(decode(WEEKDAY,'1','#cc3300ff','7','#0033ccff','BLACK'));" text="bind:WEEKDAY" combodataset="ds_week" combocodecol="cd" combodatacol="nm"/>
                <Cell col="2" displaytype="combo" edittype="combo" style="align:center middle;" text="bind:SALEDAY_YN" combodataset="ds_daygbn" combocodecol="cd" combodatacol="nm"/>
                <Cell col="3" displaytype="number" edittype="expr:iif(SALEDAY_YN=='Y','text','none')" editfilter="expr:iif(SALEDAY_YN=='Y','number','none')" style="align:center middle;" text="bind:EXP_AMT" editautoselect="true"/>
                <Cell col="4" displaytype="number" edittype="expr:iif(SALEDAY_YN=='Y','text','none')" editfilter="expr:iif(SALEDAY_YN=='Y','number','none')" style="align:center middle;" text="bind:EXP_RATE" expr="expr:gfn_numFormat(EXP_RATE,1)" editlimit="2" editautoselect="true"/>
                <Cell col="5" displaytype="number" style="align:center middle;background:cornsilk;background2:cornsilk;" text="bind:EXP_RATE_AMT"/>
                <Cell col="6" displaytype="number" edittype="expr:iif(SALEDAY_YN=='Y','text','none')" editfilter="expr:iif(SALEDAY_YN=='Y','number','none')" style="align:center middle;" text="bind:EMP_QTY" editautoselect="true"/>
                <Cell col="7" displaytype="number" style="align:center middle;background:cornsilk;background2:cornsilk;" text="bind:EMP_UPRICE"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Button id="btn_Apply" onclick="btn_Apply_OnClick" taborder="5" text=" 일괄적용" position="absolute 978 77 1043 97" class="btn_WF_Function" image="" anchor="top right"/>
        <Static id="Static00" text="총직원식대는 식재료비 계산에서 제외됩니다." position="absolute 0 81 488 97" class="sta_WF_DiscInfo"/>
        <Grid autoenter="select" binddataset="ds_View1" readonly="false" enable="false" fillareatype="allrow" id="grd_Sum1" useinputpanel="false" taborder="9" tabstop="true" usecontextmenu="true" useselcolor="false" visible="true" wheelscrollrow="1" position="absolute 664 185 1237 237" selecttype="row" autofittype="col" anchor="left top right">
          <Formats>
            <Format id="Default">
              <Columns>
                <Column size="184"/>
                <Column size="184"/>
                <Column size="184"/>
              </Columns>
              <Rows>
                <Row size="26" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell displaytype="text" text="영업일"/>
                <Cell col="1" displaytype="text" text="비영업일"/>
                <Cell col="2" displaytype="text" text="예상총매출"/>
              </Band>
              <Band id="body">
                <Cell displaytype="number" style="align:right middle;" text="bind:ILSU"/>
                <Cell col="1" displaytype="number" style="align:right middle;background:#f6fcfcff;background2:#f6fcfcff;" text="bind:BIILSU" editlimit="2"/>
                <Cell col="2" displaytype="number" style="align:right middle;background:#f6fcfcff;background2:#F6FCFC;" text="bind:TOTAMT"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Grid autoenter="select" binddataset="ds_View2" readonly="false" enable="false" fillareatype="allrow" id="grd_Sum2" useinputpanel="false" taborder="10" tabstop="true" usecontextmenu="true" useselcolor="false" visible="true" wheelscrollrow="1" position="absolute 664 252 1237 304" selecttype="row" autofittype="col" anchor="left top right">
          <Formats>
            <Format id="Default">
              <Columns>
                <Column size="184"/>
                <Column size="184"/>
                <Column size="184"/>
              </Columns>
              <Rows>
                <Row size="26" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell displaytype="text" text="평균재료비율"/>
                <Cell col="1" displaytype="text" text="총직원식수"/>
                <Cell col="2" displaytype="text" text="총직원식대"/>
              </Band>
              <Band id="body">
                <Cell displaytype="number" edittype="text" editfilter="number" style="align:right middle;" text="bind:RATIO"/>
                <Cell col="1" displaytype="number" edittype="text" editfilter="number" style="align:right middle;background:#f6fcfcff;background2:#f6fcfcff;" text="bind:TOTEMP" editlimit="2"/>
                <Cell col="2" displaytype="number" edittype="text" editfilter="number" style="align:right middle;background:#f6fcfcff;background2:#f6fcfcff;" text="bind:EMPTPRICE"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Div id="div_cmnBtn" taborder="2" text="Div0" url="cmn::CmnBtn.xfdl" position="absolute 0 0 1237 30" anchor="left top right" scrollbars="none"/>
        <Static id="Static6" text="기간" position="absolute 261 40 312 61" class="sta_WFSA_label"/>
        <Button id="btn_ApplyWeek" onclick="btn_ApplyWeek_OnClick" taborder="6" text="토,일 비영업일 적용" userdata="비영업일" position="absolute 1112 77 1237 97" class="btn_WF_Function" image="" anchor="top right"/>
        <Static id="st_Upjang" text="사업장" userdata="strQuery_FMUpjang" position="absolute 15 40 69 61" class="sta_WFSA_label"/>
        <Edit id="ed_Upjang" imemode="none" onkeydown="fn_edBtn_OnKeyDown" readonly="true" taborder="0" position="absolute 71 40 211 61" class="edt_WF_Essential"/>
        <Button id="btn_Upjang" onclick="fn_edBtn_OnClick" taborder="3" text="" position="absolute 210 40 231 61" class="btn_WF_popSearchEssential" image=""/>
        <MaskEdit id="me_FROM_DT" mask="####-##" onkeydown="ed_pop_OnKeyDown" taborder="1" type="string" userdata="btn_FROM_DT" position="absolute 304 40 384 61" class="msk_WF_EssentialCal" oneditclick="g_Date_OnFocus" onkillfocus="g_Date_OnKillFocus" onsetfocus="g_Date_OnFocus"/>
        <Button id="btn_FROM_DT" onclick="g_CalButton_OnClick" taborder="4" userdata="me_FROM_DT" position="absolute 383 40 404 61" class="btn_WF_calEssential" text="" image=""/>
        <Static id="Static0" text="(단위:원, VAT별도)" position="absolute 549 81 659 102"/>
        <Static id="Static8" text="일괄적용" position="absolute 664 84 754 102" class="sta_WF_Title01"/>
        <Static id="Static1" text="월 누계" position="absolute 664 167 754 185" class="sta_WF_Title01"/>
        <Static id="Static05" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1237 0 1252 710" anchor="top right"/>
        <Static id="Static71" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 710 1252 725" anchor="left bottom"/>
        <Static id="Static15" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 667 71 802 84"/>
        <Static id="Static16" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 667 97 802 102"/>
        <Static id="Static02" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 664 154 799 167"/>
        <Static id="Static03" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 664 180 799 185"/>
        <Static id="Static21" text="w10" class="Guide01_AreaRed" visible="false" position="absolute 654 71 664 679"/>
        <Static id="Static19" text="h05" class="Guide01_AreaRed" visible="false" position="absolute 1092 97 1236 102" anchor="top right"/>
        <Static id="Static10" text="h06" class="Guide01_AreaRed" visible="false" position="absolute 1092 71 1236 77" anchor="top right"/>
        <Static id="Static45" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 665 237 1231 252"/>
        <Grid id="Grid0" taborder="8" binddataset="ds_Apply" wheelscrollrow="1" autoenter="select" useinputpanel="false" autofittype="col" fillareatype="allrow" useselcolor="false" position="absolute 664 102 1237 154" anchor="left top right">
          <Formats>
            <Format id="Default">
              <Columns>
                <Column size="138"/>
                <Column size="138"/>
                <Column size="138"/>
                <Column size="138"/>
              </Columns>
              <Rows>
                <Row size="26" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell displaytype="text" text="예상매출"/>
                <Cell col="1" displaytype="text" text="예상재료비율"/>
                <Cell col="2" displaytype="text" text="직원식수"/>
                <Cell col="3" displaytype="text" text="직원식단가"/>
              </Band>
              <Band id="body">
                <Cell displaytype="number" edittype="text" editfilter="number" style="align:right middle;background:seashell;background2:seashell;" text="bind:EXP_AMT" editautoselect="true"/>
                <Cell col="1" displaytype="number" edittype="text" editfilter="number" style="align:right middle;background:seashell;background2:seashell;" text="bind:EXP_RATE" editlimit="2" editautoselect="true"/>
                <Cell col="2" displaytype="number" edittype="text" editfilter="number" style="align:right middle;background:seashell;background2:seashell;" text="bind:EMP_QTY" editautoselect="true"/>
                <Cell col="3" displaytype="number" edittype="text" editfilter="number" style="align:right middle;background:seashell;background2:seashell;" text="bind:EMP_UPRICE" editautoselect="true"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Button id="btn_AllDel" taborder="11" text=" 일괄삭제" class="btn_WF_Function" position="absolute 1045 77 1110 97" anchor="top right" onclick="btn_AllDel_onclick"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_Apply" oncolumnchanged="ds_Apply_OnColumnChanged">
        <ColumnInfo>
          <Column id="EXP_AMT" size="256" type="INT"/>
          <Column id="EXP_RATE" size="256" type="BIGDECIMAL"/>
          <Column id="EMP_QTY" size="256" type="INT"/>
          <Column id="EMP_UPRICE" size="256" type="INT"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="EMP_QTY"/>
            <Col id="EMP_UPRICE"/>
            <Col id="EXP_AMT"/>
            <Col id="EXP_RATE"/>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_week">
        <ColumnInfo>
          <Column id="cd" size="256" type="STRING"/>
          <Column id="nm" size="256" type="STRING"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="cd">1</Col>
            <Col id="nm">일요일</Col>
          </Row>
          <Row>
            <Col id="cd">2</Col>
            <Col id="nm">월요일</Col>
          </Row>
          <Row>
            <Col id="cd">3</Col>
            <Col id="nm">화요일</Col>
          </Row>
          <Row>
            <Col id="cd">4</Col>
            <Col id="nm">수요일</Col>
          </Row>
          <Row>
            <Col id="cd">5</Col>
            <Col id="nm">목요일</Col>
          </Row>
          <Row>
            <Col id="cd">6</Col>
            <Col id="nm">금요일</Col>
          </Row>
          <Row>
            <Col id="cd">7</Col>
            <Col id="nm">토요일</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_daygbn">
        <ColumnInfo>
          <Column id="cd" size="256" type="STRING"/>
          <Column id="nm" size="256" type="STRING"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="cd">Y</Col>
            <Col id="nm">영업일</Col>
          </Row>
          <Row>
            <Col id="cd">N</Col>
            <Col id="nm">비영업일</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_Input">
        <ColumnInfo>
          <Column id="YYMM" size="255" type="STRING"/>
          <Column id="UPJANG" size="256" type="BIGDECIMAL"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_Monthlist" oncolumnchanged="ds_Monthlist_OnColumnChanged">
        <ColumnInfo>
          <Column id="ATTR01" size="0" type="STRING"/>
          <Column id="ATTR02" size="0" type="STRING"/>
          <Column id="ATTR03" size="0" type="STRING"/>
          <Column id="ATTR04" size="0" type="STRING"/>
          <Column id="ATTR05" size="0" type="STRING"/>
          <Column id="ATTR06" size="0" type="STRING"/>
          <Column id="ATTR07" size="0" type="STRING"/>
          <Column id="ATTR08" size="0" type="STRING"/>
          <Column id="ATTR09" size="0" type="STRING"/>
          <Column id="ATTR10" size="0" type="STRING"/>
          <Column id="CONTENTS" size="0" type="STRING"/>
          <Column id="CUSER" size="0" type="STRING"/>
          <Column id="DD" size="4" type="STRING"/>
          <Column id="EMP_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="EMP_UPRICE" size="22" type="BIGDECIMAL"/>
          <Column id="EXP_AMT" size="22" type="BIGDECIMAL"/>
          <Column id="EXP_RATE" size="22" type="BIGDECIMAL"/>
          <Column id="EXP_RATE_AMT" size="22" type="BIGDECIMAL"/>
          <Column id="REMARK" size="0" type="STRING"/>
          <Column id="SALEDAY_YN" size="1" type="STRING"/>
          <Column id="UPJANG" size="0" type="STRING"/>
          <Column id="USE_YN" size="1" type="STRING"/>
          <Column id="UUSER" size="0" type="STRING"/>
          <Column id="WEEKDAY" size="1" type="STRING"/>
          <Column id="YYMM" size="6" type="STRING"/>
          <Column id="YYMMDD" size="10" type="STRING"/>
          <Column id="GBN" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_Combo">
        <ColumnInfo>
          <Column id="UPJANG" size="255" type="BIGDECIMAL"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_Combolist">
        <ColumnInfo>
          <Column id="DETAIL_GBN" size="22" type="BIGDECIMAL"/>
          <Column id="GBN" size="22" type="BIGDECIMAL"/>
          <Column id="MAIN_UPJANG" size="22" type="BIGDECIMAL"/>
          <Column id="UPJANG" size="22" type="BIGDECIMAL"/>
          <Column id="UPJANGNM_DISP" size="100" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_Temp">
        <ColumnInfo>
          <Column id="ATTR01" size="0" type="STRING"/>
          <Column id="ATTR02" size="0" type="STRING"/>
          <Column id="ATTR03" size="0" type="STRING"/>
          <Column id="ATTR04" size="0" type="STRING"/>
          <Column id="ATTR05" size="0" type="STRING"/>
          <Column id="ATTR06" size="0" type="STRING"/>
          <Column id="ATTR07" size="0" type="STRING"/>
          <Column id="ATTR08" size="0" type="STRING"/>
          <Column id="ATTR09" size="0" type="STRING"/>
          <Column id="ATTR10" size="0" type="STRING"/>
          <Column id="CONTENTS" size="0" type="STRING"/>
          <Column id="CUSER" size="0" type="STRING"/>
          <Column id="DD" size="4" type="STRING"/>
          <Column id="EMP_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="EMP_UPRICE" size="22" type="BIGDECIMAL"/>
          <Column id="EXP_AMT" size="22" type="BIGDECIMAL"/>
          <Column id="EXP_RATE" size="22" type="BIGDECIMAL"/>
          <Column id="EXP_RATE_AMT" size="22" type="BIGDECIMAL"/>
          <Column id="REMARK" size="0" type="STRING"/>
          <Column id="SALEDAY_YN" size="1" type="STRING"/>
          <Column id="UPJANG" size="0" type="STRING"/>
          <Column id="USE_YN" size="1" type="STRING"/>
          <Column id="UUSER" size="0" type="STRING"/>
          <Column id="WEEKDAY" size="1" type="STRING"/>
          <Column id="YYMM" size="6" type="STRING"/>
          <Column id="YYMMDD" size="10" type="STRING"/>
          <Column id="GBN" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_View1">
        <ColumnInfo>
          <Column id="ILSU" size="256" type="BIGDECIMAL"/>
          <Column id="BIILSU" size="256" type="BIGDECIMAL"/>
          <Column id="TOTAMT" size="256" type="BIGDECIMAL"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="BIILSU">0</Col>
            <Col id="ILSU">0</Col>
            <Col id="TOTAMT">0</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_Master"/>
      <Dataset id="ds_View2">
        <ColumnInfo>
          <Column id="RATIO" size="256" type="BIGDECIMAL"/>
          <Column id="TOTEMP" size="256" type="BIGDECIMAL"/>
          <Column id="EMPTPRICE" size="256" type="BIGDECIMAL"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="EMPTPRICE">0</Col>
            <Col id="RATIO">0</Col>
            <Col id="TOTEMP">0</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_cmnAuth" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="srcYn" type="STRING" size="256" sumtext="조회"/>
          <Column id="insYn" type="STRING" size="256" sumtext="추가"/>
          <Column id="delYn" type="STRING" size="256" sumtext="삭제"/>
          <Column id="savYn" type="STRING" size="256" sumtext="저장"/>
          <Column id="prtYn" type="STRING" size="256" sumtext="출력"/>
          <Column id="exlYn" type="STRING" size="256" sumtext="엑셀"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="srcYn">1</Col>
            <Col id="insYn">0</Col>
            <Col id="delYn">0</Col>
            <Col id="savYn">1</Col>
            <Col id="prtYn">0</Col>
            <Col id="exlYn">0</Col>
          </Row>
        </Rows>
      </Dataset>
    </Objects>
    <Script type="xscript4.0"><![CDATA[include "U_lib::lib_conversionCom.xjs";
/*
 ******************************************************************************************
 * 시스템구분   : 시스템공통/공통코드/사용자 관리
 * 프로그램명   : SCC00040E.XML
 * 기      능   : 사용자 관리 등록
 * 작  성  자   : 윤상혁
 * 작성  일자   : 20071116
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 *  1) 
 ******************************************************************************************
 */
//******************************************************************************************(90)
// [ PART 1 ]
// Form에서 Include 할 내용을 정의
//
//******************************************************************************************
//@@컨버터에서 주석처리 #include "lib::sc_comon.js"				// 시스템 공통
//@@컨버터에서 주석처리 #include "LIB::lib_comm_0001.js"		//JAVA 코딩시
//@@컨버터에서 주석처리 #include "LIB::tit_comm_0001.js"		// X-Framework Lib
//@@컨버터에서 주석처리 #include "lib::sc_sql_common.js"		// 공통팝업
//@@컨버터에서 주석처리 #include "lib::fm_common.js"			// FM공통
//******************************************************************************************
// [ PART 2 ]
// Form에서 사용될 전역변수를 선언
//
//******************************************************************************************
////글로벌 변수 테스트
// var g_Upjang=105626;
// var g_UserGroup="리조트";
// var g_Empno="200200996";
//******************************************************************************************
// [ PART 3 ]
// Form Loading 시 작업 정의
// 로그인 정보에 따른 콤보리스트출력
//******************************************************************************************
function form_onload(obj:Form, e:LoadEventInfo)
{
	//gfn_formOnLoad(obj, false);
	gfn_formOnLoad(obj, true); // Focus이동

	// 업데이트 DS
	//v_ds_check = "ds_Monthlist";
	
	fsp_init(this);
	
	// 초기값 셋팅
	ed_Upjang.userdata	= application.g_Upjang;
	ed_Upjang.value		= application.g_UpjangNm;
	me_FROM_DT.value	= gfn_left(fn_CurrDateWeek(),6);								// 일자
	
	fn_search();
}

function frm_OnKeyDown(obj:Form, e:KeyEventInfo)
{
	gfn_formKeyDown(obj, e); //(obj,e.fromreferenceobject,e.keycode,e.shiftKey,e.ctrlKey,e.altKey,-1,-1);
	if ( (e.keycode == 13) && (e.fromreferenceobject == me_FROM_DT) ) fn_search();
}

// 서비스 콜백 처리부
function fn_call_back(cd,errmsg)
{
	if(cd!=0)
	{
		//alert(fn_AlertMsg("002"));
		return;
	}
	else
	{
		ds_Monthlist.filter("");
		
		if(ds_Monthlist.findRow("GBN", "1") != -1)
		{
			// 기존 데이타가 존재하면 그대로 보여준다
			ds_Monthlist.filter("GBN==1");
			grd_list.binddataset="ds_Monthlist";
			// 예상 재료비의 산출
			fn_calc_rate();
			// 우측 합계 그리드 값 산출
			fn_sum();
			// 예상 재료비의 산출로 업데이트된 데이타 셋을 normal로 돌린다.
			ds_Monthlist.applyChange();
			ds_Monthlist.reset();
						
			for(var i=0;i<ds_Monthlist.rowcount;i++)
			{
			
				if(ds_Monthlist.getColumn(i,"SALEDAY_YN")=="N")
				{
					btn_ApplyWeek.userdata = "영업일";
					btn_ApplyWeek.text = "토,일 " + btn_ApplyWeek.userdata + " 적용";
					return;
				}
			}
				
		}
		else
		{
			// 존재하지 않으면 신규로 생성시킨다.
			ds_Monthlist.filter("GBN==2");
			ds_Temp.clearData();
			for(i=0;i<ds_Monthlist.getRowCount();i++)
			{
				ds_Temp.addRow();
				ds_Temp.copyRow(i,ds_Monthlist,i);
				ds_Temp.setColumn(i,"UPJANG",gfn_trim(ed_Upjang.userdata));
				ds_Temp.setColumn(i,"CUSER",g_EmpNo);
				ds_Temp.setColumn(i,"UUSER",g_EmpNo);
				
			}
			ds_Monthlist.clearData();
			ds_Monthlist.assign(ds_Temp);
			grd_list.binddataset="ds_Monthlist";
			// 예상 재료비의 산출
			fn_calc_rate();
			// 우측 합계 그리드 값 산출
			fn_sum();	
		}

	}	
}

//******************************************************************************************
// [ PART 4 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,도움말,form닫기)
//
//******************************************************************************************

/*
 ******************************************************************************************
 * 함  수  명   : fn_Search()
 * 입      력   : 검색조건
 * 반      환   : 없음
 * 기      능   : 월 운영계획 등록조회
 * 작  성  자   : 윤상혁
 * 작성  일자   : 20071127
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 *  1) 
 ******************************************************************************************
 */
function fn_search()
{
	ds_View1.clearData();
	ds_View1.addRow();
	ds_View2.clearData();
	ds_View2.addRow();
	
	ds_Apply.setColumn(0,"EXP_AMT","");
	ds_Apply.setColumn(0,"EXP_RATE","");
	ds_Apply.setColumn(0,"EMP_QTY","");
	ds_Apply.setColumn(0,"EMP_UPRICE","");
	
	grd_list.binddataset="";
	
	if(gfn_length(gfn_trim(ed_Upjang.userdata))==0)
	{
		gfn_alert(fn_AlertMsg("003"));
		return;
	}
	if(gfn_length(me_FROM_DT.value)<6 || me_FROM_DT.value == null )
	{
		gfn_alert(fn_AlertMsg("005"));
		return;
	}

	ds_Input.clearData();
	ds_Input.addRow();
    ds_Input.setColumn(0,"YYMM",gfn_subStr(me_FROM_DT.value,0,6));
    ds_Input.setColumn(0,"UPJANG",gfn_trim(ed_Upjang.userdata));
    fsp_clear(this);
    ds_Monthlist.clearData();
    fsp_addSearch(this, "fm/fmo:FMO00410E_S001");
    fsp_callService(this, "", "", "ds_Input=ds_Input", "ds_Monthlist=ds_Monthlist", "", "fn_call_back");
}

function fn_insert()
{
	
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_Save()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 저장
 * 작  성  자   : 윤상혁
 * 작성  일자   : 20071127
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 *  1) 
 ******************************************************************************************
 */

function fn_save()
{
	fsp_clear(this);

    // 서비스셋팅
    var actionName, cmdName, inData, outData, otherArg, callBackFnc;
    var insertSql1,insertSql2, updateSql, deleteSql,saveFlagColumn, keySqlName, keyIncrement, callbackSql;	
				

	if(gfn_dsIsUpdated(ds_Monthlist)==false)
	{
		g_Message("EE", "변경된 내역이 없습니다.");
		return;
	}
	if(!g_Confirm("02"))
	{
		return;
	}	
	
	//신규로 생성된 데이타이면 마스터 테이블에 마스터 정보인서트 한다.
	//if(GetRowType(ds_Monthlist,0)=="insert")	As-Is
	if (ds_Monthlist.getRowType(0) == Dataset.ROWTYPE_INSERT)
	{//ds_Master
		ds_Master.clear();
		ds_Master.addColumn("UPJANG","string");
		ds_Master.addColumn("YYMM","string");
		ds_Master.addColumn("CONTENTS","string");
		ds_Master.addColumn("REMARK","string");
		ds_Master.addColumn("USE_YN","string");
		ds_Master.addColumn("ATTR01","string");
		ds_Master.addColumn("ATTR02","string");
		ds_Master.addColumn("ATTR03","string");
		ds_Master.addColumn("ATTR04","string");
		ds_Master.addColumn("ATTR05","string");
		ds_Master.addColumn("ATTR06","string");
		ds_Master.addColumn("ATTR07","string");
		ds_Master.addColumn("ATTR08","string");
		ds_Master.addColumn("ATTR09","string");
		ds_Master.addColumn("CUSER","string");
		ds_Master.addColumn("UUSER","string");
		ds_Master.addRow();
		ds_Master.setColumn(0,"UPJANG",ds_Monthlist.getColumn(0,"UPJANG"));
		ds_Master.setColumn(0,"YYMM",ds_Monthlist.getColumn(0,"YYMM"));
		ds_Master.setColumn(0,"CONTENTS","");
		ds_Master.setColumn(0,"REMARK","");
		ds_Master.setColumn(0,"USE_YN","Y");
		ds_Master.setColumn(0,"ATTR01","");
		ds_Master.setColumn(0,"ATTR02","");
		ds_Master.setColumn(0,"ATTR03","");
		ds_Master.setColumn(0,"ATTR04","");
		ds_Master.setColumn(0,"ATTR05","");
		ds_Master.setColumn(0,"ATTR06","");
		ds_Master.setColumn(0,"ATTR07","");
		ds_Master.setColumn(0,"ATTR08","");
		ds_Master.setColumn(0,"ATTR09","");
		ds_Master.setColumn(0,"CUSER",g_EmpNo);
		ds_Master.setColumn(0,"UUSER",g_EmpNo);
		//입력 저장
		inData		= "ds_Monthlist=ds_Monthlist:U ds_Master=ds_Master:U";
		outData		= "";
		callBackFnc	= "";
		insertSql1	= "fm/fmo:FMO00410E_I001";
		insertSql2 	= "fm/fmo:FMO00410E_I002";
		updateSql	= "";
		deleteSql	= "";
		keyIncrement= -1;
		callbackSql	= "";
		
		fsp_addSave(this, insertSql1, updateSql, deleteSql,saveFlagColumn, keySqlName, keyIncrement, callbackSql);
		fsp_addSave(this, insertSql2, updateSql, deleteSql,saveFlagColumn, keySqlName, keyIncrement, callbackSql);		
	}
	
	//if(GetRowType(ds_Monthlist,0)!="insert" && gfn_dsIsUpdated(ds_Monthlist)==true)	As-Is
	if(ds_Monthlist.getRowType(0) != Dataset.ROWTYPE_INSERT && gfn_dsIsUpdated(ds_Monthlist)==true)
	{	
		//업데이트 저장
		inData		= "ds_Monthlist=ds_Monthlist:U";
		outData		= "";
		callBackFnc	= "";
		insertSql1	= "";
		updateSql	= "fm/fmo:FMO00410E_U001";
		deleteSql	= "";
		keyIncrement= -1;
		callbackSql	= "";
		
		fsp_addSave(this, insertSql1, updateSql, deleteSql,saveFlagColumn, keySqlName, keyIncrement, callbackSql);
	}
	
	fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);		// 서비스 호출 
}
function fn_Trans()
{
	fsp_clear(this);

    // 서비스셋팅
    var actionName, cmdName, inData, outData, otherArg, callBackFnc;
    var insertSql1,insertSql2, updateSql, deleteSql,saveFlagColumn, keySqlName, keyIncrement, callbackSql;	
	
	//신규로 생성된 데이타이면 마스터 테이블에 마스터 정보인서트 한다.
	if(GetRowType(ds_Monthlist,0)=="insert")
	{//ds_Master
		ds_Master.clear();
		ds_Master.addColumn("UPJANG");
		ds_Master.addColumn("YYMM");
		ds_Master.addColumn("CONTENTS");
		ds_Master.addColumn("REMARK");
		ds_Master.addColumn("USE_YN");
		ds_Master.addColumn("ATTR01");
		ds_Master.addColumn("ATTR02");
		ds_Master.addColumn("ATTR03");
		ds_Master.addColumn("ATTR04");
		ds_Master.addColumn("ATTR05");
		ds_Master.addColumn("ATTR06");
		ds_Master.addColumn("ATTR07");
		ds_Master.addColumn("ATTR08");
		ds_Master.addColumn("ATTR09");
		ds_Master.addColumn("CUSER");
		ds_Master.addColumn("UUSER");
		ds_Master.addRow();
		ds_Master.setColumn(0,"UPJANG",ds_Monthlist.getColumn(0,"UPJANG"));
		ds_Master.setColumn(0,"YYMM",ds_Monthlist.getColumn(0,"YYMM"));
		ds_Master.setColumn(0,"CONTENTS","");
		ds_Master.setColumn(0,"REMARK","");
		ds_Master.setColumn(0,"USE_YN","Y");
		ds_Master.setColumn(0,"ATTR01","");
		ds_Master.setColumn(0,"ATTR02","");
		ds_Master.setColumn(0,"ATTR03","");
		ds_Master.setColumn(0,"ATTR04","");
		ds_Master.setColumn(0,"ATTR05","");
		ds_Master.setColumn(0,"ATTR06","");
		ds_Master.setColumn(0,"ATTR07","");
		ds_Master.setColumn(0,"ATTR08","");
		ds_Master.setColumn(0,"ATTR09","");
		ds_Master.setColumn(0,"CUSER",g_EmpNo);
		ds_Master.setColumn(0,"UUSER",g_EmpNo);
		//입력 저장
		inData		= "ds_Monthlist=ds_Monthlist:U ds_Master=ds_Master:U";
		outData		= "";
		callBackFnc	= "";
		insertSql1	= "fm/fmo:FMO00410E_I001";
		insertSql2 	= "fm/fmo:FMO00410E_I002";
		updateSql	= "";
		deleteSql	= "";
		keyIncrement= -1;
		callbackSql	= "";
		
		fsp_addSave(this, insertSql1, updateSql, deleteSql,saveFlagColumn, keySqlName, keyIncrement, callbackSql);
		fsp_addSave(this, insertSql2, updateSql, deleteSql,saveFlagColumn, keySqlName, keyIncrement, callbackSql);		
	}
	if(GetRowType(ds_Monthlist,0)!="insert" && gfn_dsIsUpdated(ds_Monthlist)==true)
	{	
		//업데이트 저장
		inData		= "ds_Monthlist=ds_Monthlist:U";
		outData		= "";
		callBackFnc	= "";
		insertSql1	= "";
		updateSql	= "fm/fmo:FMO00410E_U001";
		deleteSql	= "";
		keyIncrement= -1;
		callbackSql	= "";
		
		fsp_addSave(this, insertSql1, updateSql, deleteSql,saveFlagColumn, keySqlName, keyIncrement, callbackSql);
	}
	
	fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);		// 서비스 호출 

}
/*
 ******************************************************************************************
 * 함  수  명   : fn_Delete()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 삭제
 * 작  성  자   : 윤상혁
 * 작성  일자   : 20071127
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 *  1) 
 ******************************************************************************************
 */
function fn_delete()
{

}

/*
 ******************************************************************************************
 * 함  수  명   : fn_Print()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 인쇄
 * 작  성  자   : 윤상혁
 * 작성  일자   : 20071127
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 *  1) 
 ******************************************************************************************
 */
function fn_print()
{
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_Close()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 화면닫기전 저장 체크
 * 작  성  자   : 윤상혁
 * 작성  일자   : 20071127
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 *  1) 
 ******************************************************************************************
 */
function fn_Close()
{
	if(gfn_dsIsUpdated(ds_Monthlist)==true)
	{
		if(g_Confirm("04",fn_AlertMsg("006"))==true)
		{
			fn_Trans();
			return;
		}
	}
	this.close();
}

/******************************************************************************************
 * 함  수  명   : fn_Help()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 도움말
 * 작  성  자   : 윤상혁
 * 작성  일자   : 20071127
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 *  1) 
 ******************************************************************************************
 */
function fn_help()
{

}
//******************************************************************************************
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
//
//******************************************************************************************

/******************************************************************************************
 * 함  수  명   : fn_AlertMsg(cd)
 * 입      력   : 메시지 코드
 * 반      환   : 메세지 텍스트
 * 기      능   : 메시지 처리
 * 작  성  자   : 윤상혁
 * 작성  일자   : 20071127
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 *  1) 
 ******************************************************************************************
 */

function fn_AlertMsg(cd)
{
	var v_Msg="";
	switch(cd)
	{
		case "001":
			v_Msg= "버튼이 정의 되어 있지않습니다.";
			break;
		case "002":
			v_Msg="서비스 오류:시스템 관리자에게 문의하십시오.";
			break;
		case "003":
			v_Msg="로그인 정보에 문제가 있습니다.\n\n시스템 관리자에게 문의하십시오.";
			break;
		case "004":
			v_Msg="조회된 데이타가 없습니다.";
			break;
		case "005":
			v_Msg="기간을 확인하세요.";
			break;
		case "006":
			v_Msg="변경되 정보가 있습니다.\n\n저장하시겠습니까?";
			break;						
/*			
		case "":
			v_Msg="";
			break;
*/			
		default:
			break;			
	}
	return v_Msg;
}
/******************************************************************************************
 * 함  수  명   : fn_sum(cd)
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 우측 합계 그리드 출력 데이타 산정
 * 작  성  자   : 윤상혁
 * 작성  일자   : 20071127
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 *  1) 
 ******************************************************************************************
 */
//	우측 합계 그리드 출력 데이타 산정
function fn_sum()
{
	var v_cnt=0;
	var v_CntEmp=0;			
	var v_TotEmp=0;			// 총직원식수
	var v_TPrice=0;			//	총직원식대
	var v_Ilsu=0;			//	영업일
	var v_BiIlsu=0;			//	비영업일
	var v_TotAmt=0;			//	예상총매출
	var v_Ratio=0.0;		//	평균재료비율(재료비율합/총영업일)==>xx.x
	var v_EmpTPrice=0;		
	for(i=0;i<ds_Monthlist.getRowCount();i++)
	{
		if(ds_Monthlist.getColumn(i,"SALEDAY_YN")=="Y")
		{
			v_cnt=v_cnt+1;	//	총 영업일
			v_EmpTPrice=ds_Monthlist.getColumn(i,"EMP_QTY")*ds_Monthlist.getColumn(i,"EMP_UPRICE");	//	일별 직원식대계
			v_TPrice=v_TPrice+v_EmpTPrice;	// 총 직원식대
			v_CntEmp=ds_Monthlist.getColumn(i,"EMP_QTY");	// 일별 식수
			v_TotEmp=v_TotEmp+v_CntEmp;						// 영업일 총 식수
		}
		
	}
	v_Ilsu=v_cnt;	//	총 영업일
	v_BiIlsu=ds_Monthlist.getRowCount()-v_cnt;		// 총 비영업일
	v_TotAmt=ds_Monthlist.getSum("EXP_AMT");		// 총 예상매출액( 일별 예상매출액 합계 )
	v_Ratio=gfn_numFormat(ds_Monthlist.getSum("EXP_RATE")/v_cnt,1); // 평균 재료비율( 재료비율합/총영업일 )
	
	ds_View1.setColumn(0,"ILSU",v_Ilsu);			//	총 영업일
	ds_View1.setColumn(0,"BIILSU",v_BiIlsu);		// 총 비영업일
	ds_View1.setColumn(0,"TOTAMT",v_TotAmt);		// 총 예상매출액

	ds_View2.setColumn(0,"RATIO",v_Ratio);			// 평균 재료비율
	ds_View2.setColumn(0,"TOTEMP",v_TotEmp);		// 영업일 총 식수	
	ds_View2.setColumn(0,"EMPTPRICE",v_TPrice);		// 총 직원식대
}
/******************************************************************************************
 * 함  수  명   : fn_calc_rate()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 예상 재료비 산출
 * 작  성  자   : 윤상혁
 * 작성  일자   : 20071127
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 *  1) 
 ******************************************************************************************
 */
// 예상 재료비 산출
function fn_calc_rate()
{
	var v_Exp_Rate_Amt=0;
	for(var i=0;i<ds_Monthlist.getRowCount();i++)
	{
		v_Exp_Rate_Amt=0;
		v_Exp_Rate_Amt=Math.round((parseInt(ds_Monthlist.getColumn(i,"EXP_AMT")) * toNumber(ds_Monthlist.getColumn(i,"EXP_RATE")) )/100,0);
		ds_Monthlist.setColumn(i,"EXP_RATE_AMT",v_Exp_Rate_Amt);
	}
	fn_sum();	
}
//******************************************************************************************
// [ PART 6 ]
// component Event 정의 ( User Define function )
// --> component Event의 기요,기능,동작 등 상세내용은 MiPlatform 메뉴얼을 참조하시기 바랍니다.
//******************************************************************************************
/******************************************************************************************
 * 함  수  명   : Common_Btn_common_OnClick
 * 입      력   : 화면공통버튼 
 * 반      환   : 없음
 * 기      능   : 화면공통버튼이벤트처리 :함수호출
 * 작  성  자   : 윤상혁
 * 작성  일자   : 20071116
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 *  1) 
 ******************************************************************************************
 */
function Common_Btn_common_OnClick(obj)
{
	switch(obj.name)
	{
		case "btn_Search":
			fn_search();
			break;
		case "btn_Insert":
			fn_insert();
			break;
		case "btn_Delete":
			fn_delete();
			break;
		case "btn_Save":
			fn_save();
			break;
		case "btn_Print":
			fn_print();
			break;
		case "btn_Close":
			fn_Close();
			break;
		case "btn_Help":
			fn_help();
			break;
		default:
			gfn_alert(fn_AlertMsg("001"));
			break;
	}
}

/******************************************************************************************
 * 함  수  명   : btn_Apply_OnClick()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 예상 매출,재료,식수 일괄반영
 * 작  성  자   : 윤상혁
 * 작성  일자   : 20071127
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 *  1) 
 ******************************************************************************************
 */
// 예상 매출,재료,식수 일괄반영
function btn_Apply_OnClick(obj:Button, e:ClickEventInfo)
{
	var strColID = "";
	var strCopy = "";
	
	grd_list.enableredraw=false;
	grd_Sum1.enableredraw=false;
	grd_Sum2.enableredraw=false;
	
	for(var i=0;i<ds_Apply.colcount;i++)
	{
		if( gfn_length(gfn_toString(ds_Apply.getColumn(0,i)))> 0 )
		{
			strColID = ds_Apply.getColID(i);
			
			strCopy += " " + strColID + "=" + strColID + " ";
		}
		
	}
	strCopy = gfn_replace(strCopy,"  ",",");

	for(var i=0;i<ds_Monthlist.getRowCount();i++)
	{
		if( ds_Monthlist.getColumn(i,"SALEDAY_YN")=="Y" )
		{
			ds_Monthlist.copyRow(i,ds_Apply,0,strCopy);
		}
	}
	fn_calc_rate();
	grd_list.enableredraw=true;
	grd_Sum1.enableredraw=true;
	grd_Sum2.enableredraw=true;
	fn_sum();	
}
/******************************************************************************************
 * 함  수  명   : btn_AllDel_onclick()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 예상 매출,재료,식수 일괄삭제
 * 작  성  자   : 윤상혁
 * 작성  일자   : 20071127
 * ----------------------------------------------------------------------------------------
 * HISTORY    : 2015-05-14 PI 요청 사항
 *  1) 
 ******************************************************************************************
 */
// 예상 매출,재료,식수 일괄삭제
function btn_AllDel_onclick(obj:Button,  e:ClickEventInfo)
{
	for(var i=0;i<ds_Monthlist.getRowCount();i++)
	{
		ds_Monthlist.setColumn(i, "EXP_AMT", 0);
		ds_Monthlist.setColumn(i, "EXP_RATE", 0);
		ds_Monthlist.setColumn(i, "EXP_RATE_AMT", 0);
		ds_Monthlist.setColumn(i, "EMP_QTY", 0);
		ds_Monthlist.setColumn(i, "EMP_UPRICE", 0);
	}
	ds_Apply.setColumn(0, "EXP_AMT", "");
	ds_Apply.setColumn(0, "EXP_RATE", "");
	ds_Apply.setColumn(0, "EMP_QTY", "");
	ds_Apply.setColumn(0, "EMP_UPRICE", "");
}
/******************************************************************************************
 * 함  수  명   : ds_Apply_OnColumnChanged()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 일괄적용값 빈값일대 초기화
 * 작  성  자   : 윤상혁
 * 작성  일자   : 20071127
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 *  1) 
 ******************************************************************************************
 */
// 일괄적용값 빈값일대 초기화
function ds_Apply_OnColumnChanged(obj:Dataset, e:DSColChangeEventInfo)
{
	/*
	switch(strColumnID)
	{
		case "EXP_RATE":
			if(varNewValue.trim.Length()==0 || varNewValue.trim() ==null )
			{
				ds_Apply.SetColumn(0,"EXP_RATE",0.0);
			}
			break;
		case "EXP_AMT":
			if(varNewValue.trim.Length() < 1 || varNewValue == null)
			{
				ds_Apply.SetColumn(0,"EXP_AMT",0);
			}		
			break;
		case "EMP_QTY":
			if(varNewValue.trim.Length()==0 || varNewValue.trim() ==null )
			{
				ds_Apply.SetColumn(0,"EMP_QTY",0);
			}		
			break;
		case "EMP_UPRICE":
			if(varNewValue.trim.Length()==0 || varNewValue.trim() ==null )
			{
				ds_Apply.SetColumn(0,"EMP_UPRICE",0);
			}		
			break;									
	}	
	*/
}
/******************************************************************************************
 * 함  수  명   : ds_Monthlist_OnColumnChanged()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 메인 데이타 칼럼값 변경시 계산값 일괄 적용 프로세스
 * 작  성  자   : 윤상혁
 * 작성  일자   : 20071127
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 *  1) 
 ******************************************************************************************
 */
// 메인 데이타 칼럼값 변경시 계산값 일괄 적용 프로세스
function ds_Monthlist_OnColumnChanged(obj:Dataset, e:DSColChangeEventInfo)
{
	var v_row;
	switch(e.columnid)
	{
		case "EXP_RATE":
			fn_calc_rate();
			break;
		case "EXP_AMT":
			fn_calc_rate();
			break;		
		case "SALEDAY_YN":
			if(e.newvalue=="N")
			{
				ds_Monthlist.setColumn(e.row,"EXP_AMT",0 );
				ds_Monthlist.setColumn(e.row,"EXP_RATE",0 );
				ds_Monthlist.setColumn(e.row,"EXP_RATE_AMT",0 );
				ds_Monthlist.setColumn(e.row,"EMP_QTY",0 );
				ds_Monthlist.setColumn(e.row,"EMP_UPRICE",0 );
			}
			else
			{
				v_row=ds_Monthlist.findRowExpr("EMP_UPRICE>0");
				ds_Monthlist.setColumn(e.row,"EMP_UPRICE",toNumber(ds_Monthlist.getColumn(v_row,"EMP_UPRICE"),0));
			}
			break;
	}
	fn_sum();
}

/*
 ******************************************************************************************
 * 함  수  명   : btn_pop1_OnClick(obj)
 * 기      능   : 팝업버튼 클릭 -> 사업장 조회
 * 작  성  자   : 박지영
 * 작성  일자   : 2008-04-25  
 ******************************************************************************************
 */
function fn_edBtn_OnClick(obj:Button, e:ClickEventInfo)
{
	var sAddWhere = "";
	
	switch(obj.name)
	{	
		case "btn_Upjang":
			if (application.g_UserKind == '사업장'){
				sAddWhere = " AND A.USE_YN = 'Y' AND A.MAIN_UPJANG = " + g_Main_Upjang;			
				sAddWhere += " AND ( A.UPJANG = " + application.g_Upjang + " OR EXISTS (SELECT 1 FROM FMS_USER_UPJANG B WHERE B.USE_YN = 'Y' AND B.UPJANG = A.UPJANG AND B.SABUN = '" + application.g_EmpNo + "') )";													
				break;
			}
			else if (application.g_UserKind == '본사'){		
				sAddWhere = " AND A.USE_YN = 'Y' AND A.MAIN_UPJANG = " + g_Main_Upjang;							
				break;
			}
			
			if (application.g_UserKind == '본부'){
				sAddWhere = " AND A.USE_YN = 'Y' " ;
				break;
			}
		
		default:
			break;
	}
	//fm공통 팝업클릭 호출
	if (ffn_btn_OnClick(obj, sAddWhere)) fn_Trigger_edBtn(eval("ed_" + gfn_subStr(obj.name, 4)));
	
}

function fn_edBtn_OnKeyDown(obj:Edit, e:KeyEventInfo)
{
	//ffn_ed_OnKeyDown(obj,e.keycode);
	//Del의 경우 뒷처리
// 	if (e.keycode == 46) fn_Trigger_edBtn(obj);		
// 	else if( obj.name == "ed_Upjang" ) 
// 	{
// 		if ( e.keycode == 13 ) 
// 		{
// 			if (ffn_ChkNull(me_FROM_DT.value))
// 			{
// 				g_Message("EE", "기간" + fn_AlertMsg("005"));
// 				me_FROM_DT.setFocus();
// 				return;
// 			}
// 		}		
// 	}	
	ffn_ed_OnKeyDown(obj,e.keycode);
	//Del의 경우 뒷처리
	if (e.keycode == 46) fn_Trigger_edBtn(obj);
}

function fn_Trigger_edBtn(obj)
{
	switch(obj)
	{
		case ed_Upjang:
			ds_Monthlist.clearData();
			ds_View1.clearData();
			ds_View2.clearData();
			
			break;
		default:
			break;
	}
}

/*
 ******************************************************************************************
 * 함  수  명   : btn_ApplyWeek_OnClick(obj)
 * 기      능   : 토,일 적용
 * 작  성  자   : 박지영
 * 작성  일자   : 2008-04-25  
 ******************************************************************************************
 */
function btn_ApplyWeek_OnClick(obj:Button, e:ClickEventInfo)
{
	grd_list.enableredraw=false;
	grd_Sum1.enableredraw=false;
	grd_Sum2.enableredraw=false;

	if(obj.userdata=="비영업일")
	{
		for(var i=0;i<ds_Monthlist.rowcount;i++)
		{
		
			if(ds_Monthlist.getColumn(i,"WEEKDAY")=="1" || ds_Monthlist.getColumn(i,"WEEKDAY")=="7" )
			{
				ds_Monthlist.setColumn(i,"SALEDAY_YN","N");
				ds_Monthlist.setColumn(i,"EXP_AMT",0);
				ds_Monthlist.setColumn(i,"EXP_RATE",0.0);
				ds_Monthlist.setColumn(i,"EXP_RATE_AMT",0);
				ds_Monthlist.setColumn(i,"EMP_QTY",0);
			}
		}
		
		obj.userdata = "영업일";
	}
	else
	{
		for(var i=0;i<ds_Monthlist.rowcount;i++)
		{		
			if(ds_Monthlist.getColumn(i,"WEEKDAY")=="1" || ds_Monthlist.getColumn(i,"WEEKDAY")=="7" )
			{			
				ds_Monthlist.setColumn(i,"SALEDAY_YN","Y");
				ds_Monthlist.setColumn(i,"EXP_AMT",ds_Apply.getColumn(0, "EXP_AMT"));
				ds_Monthlist.setColumn(i,"EXP_RATE",ds_Apply.getColumn(0, "EXP_RATE"));
				ds_Monthlist.setColumn(i,"EXP_RATE_AMT",ds_Apply.getColumn(0, "EMP_UPRICE"));
				ds_Monthlist.setColumn(i,"EMP_QTY",ds_Apply.getColumn(0, "EMP_QTY"));
			}
		}
		
		obj.userdata = "비영업일";
	}
	
	obj.text = "토,일 " + obj.userdata + " 적용";
	fn_sum();
	
	grd_list.enableredraw=true;
	grd_Sum1.enableredraw=true;
	grd_Sum2.enableredraw=true;	
}

// function ed_pop_OnKeyDown(obj:MaskEdit, e:KeyEventInfo)
// {
// 	if(e.keycode==13)
// 	{
// 		fn_search();
// 	}	
// }]]></Script>
  </Form>
</FDL>
