<?xml version="1.0" encoding="UTF-8"?>
<hqml xmlns="http://hone.hanwha.co.kr/schema/hqml" name="fm.fmc.claimProcDAO">
	<desc>클레임처리 HQML Query</desc>

	
	<!-- 반품자재 목록을 조회한다. -->
	<statement name="returnItemSearch" type="select">
		/*+ com.hwfs.fm.fmc.dao.ClaimProcDAO.returnItemSearch */
		<![CDATA[
		SELECT A.ITEM_CODE AS CODE, A.ITEM_NAME AS NAME
		FROM HLDC_PO_ITEM_MST A
		     ,(SELECT ITEM_CODE
		         FROM PO_CLAIM_LIST
		        WHERE NEED_DATE BETWEEN :schFromDate AND :schToDate
		        --<#if schCenterCode?has_content>
		        --AND   CENTER_CODE = :schCenterCode
		        --</#if>
        		<#if schCode?has_content>
        			AND CENTER_CODE IN (${schCode})
        		</#if>
		        AND   PRCS_STATUS > '04'
		        <#if ctKind?has_content>
		        AND   CT_KIND = :ctKind
		        </#if>
		       )B
		WHERE A.ITEM_CODE = B.ITEM_CODE   
        <#if code?has_content>
        AND A.ITEM_CODE LIKE '%'|| :code ||'%'
        </#if>
        <#if name?has_content>
        AND A.ITEM_NAME LIKE '%'|| :name ||'%'
        </#if>
        GROUP BY A.ITEM_CODE, A.ITEM_NAME
		]]>
	</statement>


	<!-- 클레임처리 목록을 조회한다. -->
	<statement name="selectList" type="select">
		/*+ com.hwfs.fm.fmc.dao.ClaimProcDAO.selectList */
		<![CDATA[
		SELECT * FROM (
		 SELECT
                 0 AS CHK		/*체크박스*/
                , A.UPJANG		/*사업장*/
                , (SELECT UPJANGNM FROM ST_UPJANG C WHERE C.UPJANG = A.UPJANG) AS UPJANGNM	/*사업장명*/
                , A.ITEM_CODE	/*상품코드*/
                , A.ITEM_NAME    /*상품명*/
                , A.ITEM_SIZE    /*상품규격*/
                , A.PO_UOM       /*단위*/
                , A.PO_QTY		/*발주수량*/
                , A.REQ_QTY      /*요청량*/
                , A.REQ_DATE		/*요청일*/
                , A.REQ_TIME		/*요청시간*/
                , NVL(A.TRANS_DATE,TO_CHAR(SYSDATE,'YYYYMMDD')) AS  TRANS_DATE		/*수정일*/
                , B.TRANS_MAMOUNT					/*기반품금액*/
                , NVL(D.RETURNED_QTY,0) AS RETURNED_QTY		/*기반품량*/
                , NVL(A.PROC_QTY,A.REQ_QTY) AS PROC_RT_QTY 	/*반품수량*/
                , D.SALE_PRICE 		/* 판매단가 */
                , A.CT_CLAIM_KIND  /*클레임유형 IF*/
                , A.CLAIM_MEMO   /*클레임상세내역*/
                , A.REQ_KIND     /*요청사항 IF*/
                , (SELECT CODE_NAME FROM SCC_COMMON_CODE WHERE GROUP_CODE = 'C02' AND CODE= A.REQ_KIND) REQ_KIND_NM     /*요청사항 IF*/
                , A.CT_KIND      /*센터처리내역 IF*/
                , A.CT_MEMO 		/*센터상세처리내역 IF*/
                , A.PART_TM_CD  	/*담당 팀*/
		        , (SELECT DISTINCT(TM_NM) FROM HLDC_SC_TM C WHERE C.TM_CD = A.PART_TM_CD) AS PART_TM_NM	/*담당 팀명*/ 
		        , A.MNG_SABUN  	/*처리자*/
		        , (SELECT NM_KOR FROM HR_PERSONAL C WHERE C.SABUN = A.MNG_SABUN) AS NM_KOR	/*처리자명*/
		        , A.PRCS_STATUS  /*처리상태*/
                , B.TRANS_MPRICE /*매입단가*/
                , NVL(B.TRANS_QTY,0) AS TRANS_QTY	/*매입수량*/
                , A.PROC_AMT		/*반품금액*/	
                , A.PO_ID		/*주문번호*/
                , A.PO_NUM       /*주문번호 항번*/
                , A.CLAIM_NUM    /*클레임번호*/
                , NVL((SELECT CLS_FLAG FROM HLDC_PO_CLOSING C WHERE CLS_YM >= TRIM(SUBSTR(TO_CHAR(SYSDATE,'YYYYMMDD'),0,6)) AND SUBINV_CODE = A.SUBINV_CODE AND C.CLS_FLAG = 'Y' AND ROWNUM =1),'N') AS CLS_FLAG
                , EPROCUSR.FC_GET_FCUS_CLAIM_QTY_YN(A.PO_NUM,A.PO_ID,A.SUBINV_CODE,A.ITEM_CODE,A.REQ_QTY) CLAIM_QTY
				, NVL(C.MIN_ORD_QTY, 0) AS MIN_ORD_QTY
		        , NVL(C.MAX_ORD_QTY, 0) AS MAX_ORD_QTY
		        , C.MULTIPLIER_QTY
        	    , C.POINT_FLAG	                
                , A.SUBINV_CODE    /*창고코드*/
                , A.LINK_DEPT   	  /*책임소재 IF*/
                , A.ETC_MEMO   	  /*기타사항 IF*/
                , (SELECT SUBINV_NAME FROM VO_SUBINVENTORY E WHERE A.SUBINV_CODE = E.SUBINV_CODE) SUBINV_NAME  /*창고명*/        	    
        	    , :loginSabun LOGIN_SABUN
        	    , D.PO_COMP_YN												/*	EAI : PO완료 여부*/
     	    	, NVL(D.LEGCY_REQ_NO,'EAI') LEGCY_REQ_NO					/*	EAI : 일반자재 구분(LEGCY_REQ_NO가 NULL 이면 일반자재)*/
        	    , D.PO_NO													/*	EAI : PO_NO*/
                , D.PO_LNO													/*	EAI : PO_LNO*/
                , D.PR_NO													/*	EAI : PR_NO*/
                , D.PR_LNO													/*	EAI : PR_LNO*/
                , D.UNIT_PRICE												/*	EAI : 구매단가*/
                , (D.UNIT_PRICE * NVL(A.PROC_QTY,A.REQ_QTY)) AS PO_AMT		/*	EAI : 반품액**/
                , '' AS MG_NO												/*	EAI : MG_NO	**/
                , '' AS MOVEMENT											/*	EAI : MOVEMENT**/
                , D.ACCTCD		/*계정코드*/
                , D.PO_DATE  	/*신청일*/
                , D.NEED_DATE  /*입고일*/
          		, TO_CHAR(SYSDATE,'YYYYMMDD') PR_DATE	/*	EAI : 처리일*/
                , (SELECT  DISTINCT MU_CD FROM ST_UPJANG T, HLDC_SC_DEPT_V D WHERE  T.CC_CD = D.CC_CD AND  T.UPJANG = A.UPJANG) BU_CD
                --, (SELECT  DISTINCT CC_CD FROM ST_UPJANG T  WHERE  T.UPJANG = A.UPJANG) CC_CD
                , DECODE(D.PJT_NO,null,(SELECT  DISTINCT CC_CD FROM ST_UPJANG T  WHERE  T.UPJANG = A.UPJANG),'') CC_CD 	/* EAI : CC_CD  */
                , D.PJT_NO 	/* EAI : PJT_NO  , 프로젝트 자제일경우 IO 코드 */
                , NVL((SELECT 'Y' FROM MAS_TICKET_STD T WHERE T.UPJANG = A.UPJANG AND T.ITEM_CODE = A.ITEM_CODE GROUP BY UPJANG,ITEM_CODE),'N') TICKET_YN   /*	식권 여부	*/
                , EPROCUSR.FC_GET_WH_CLOSE_YN('100','HFC',A.SUBINV_CODE,A.NEED_DATE) WH_CLOSE			/*구매 마감 여부*/
                , (SELECT IMG_PATH FROM SCO_UPJANG_MST WHERE UPJANG = A.UPJANG) MAP	/* 약도 파일 */
                , TO_CHAR(A.UPDATE_DATE,'YYYYMMDDHH24MI') UPDATE_DATE	/*	최종 수정 일자*/
                , DECODE(SUBSTR(A.SUBINV_CODE,1,2),'S1',(SELECT REPLACE(Z.CC_NM,'식재') FROM HLDC_SC_DEPT_V Z WHERE Z.CC_CD = E.CC_CD),'직영') AS GUBUN		/*구분*/
                , F.VD_NM AS CUST_NM	/*고객사명*/
                , D.CENTER_FLAG		/*센터구분*/
                , D.LINE_STATUS		/*구매상태*/
                , D.DELIVERED_QTY  AS DLVY_QTY  /*입고수량*/
			    , A.CENTER_CODE
                , (SELECT CENTER_NAME FROM HLDC_PO_CENTER WHERE CENTER_CODE = A.CENTER_CODE) AS CENTER_NAME
				, (SELECT COUNT(1) FROM FMC_CLAIM_PHOTO_MNGT C WHERE C.PO_NUM = A.PO_NUM AND  C.PO_ID = A.PO_ID AND C.CLAIM_NUM = A.CLAIM_NUM) AS PHOTO        /*사진 유무*/
				, B.TRANS_ID
				, '' AS MG_NO_TRG 
 				, EPROCUSR.FN_GET_FROM_CENTER_INFO('100', 'HFC', D.ITEM_CODE, D.CNTR_NO, D.CNTR_REV) AS FROM_CNTR_NM 
        FROM PO_CLAIM_LIST A, HLDC_PO_TRANSACTION_SALE B , HLDC_PO_ITEM_MST C , HLDC_PO_PO D ,VO_SUBINVENTORY E , VO_FC_VENDOR F
        WHERE 1=1
        AND   A.SUBINV_CODE = E.SUBINV_CODE(+) 
    	AND   D.PO_NO = B.PO_NO(+)
        AND   D.PO_LNO = B.PO_LNO(+)
        AND   TO_CHAR(A.CUSTCD) = F.VD_CD(+)
 		AND   B.TRANS_QTY(+) > 0	/* HLDC_PO_TRANSACTION_SALE 반품 수량 행 제거	*/
        AND   A.ITEM_CODE = C.ITEM_CODE
        AND   A.PO_ID = D.PO_ID
        AND   A.PO_NUM = D.PO_NUM      
        <#if schPrcsStatus?has_content>
        AND   A.PRCS_STATUS = :schPrcsStatus
        <#else>
        AND   A.PRCS_STATUS IN (01,08,09,11)
        </#if>
        <#if schGubun == '1'>
			AND   A.NEED_DATE BETWEEN :schFromDate AND :schToDate
		<#else>
			AND   TO_CHAR(A.MNG_DATE,'YYYYMMDD') BETWEEN :schFromDate AND :schToDate
		</#if>
		--<#if schCenterCode != '*'>	
		--	AND   A.CENTER_CODE = :schCenterCode	
		--</#if>
        <#if schCode?has_content>AND A.CENTER_CODE IN (${schCode})</#if>
		<#if schCtKind?has_content>
		AND  A.CT_KIND = :schCtKind  --처리유형
		</#if>
		<#if schReturnItem?has_content>
		AND  A.ITEM_CODE = :schReturnItem  --반품자재
		</#if>
		<#if schSabun?has_content>
		AND  A.MNG_SABUN = :schSabun  --처리자
		</#if>
		<#if schSubinv?has_content>
		AND  A.SUBINV_CODE = :schSubinv  --창고
		</#if>
		<#if schUpjang?has_content>
		AND  A.UPJANG = :schUpjang  --업장
		</#if>
		<#if schReqKind?has_content>
		AND  A.REQ_KIND = :schReqKind  --요청사항
		</#if>				
		
		<#if schReturnDate?has_content>
		--AND  '반품일자' = :schReturnDate
		</#if>  
		<#if schReturnNum?has_content>
		--AND  '반송번호' = :schReturnNum
		</#if> 
		<#if schCust?has_content>
		AND  A.CUSTCD = :schCust
		</#if> 
		<#if schMuCd?has_content>
		AND  (SELECT  DISTINCT MU_CD FROM ST_UPJANG T, HLDC_SC_DEPT_V D
               WHERE  T.CC_CD = D.CC_CD
                 AND  T.UPJANG = A.UPJANG) IN (${schMuCd})
		</#if> 
		<#if schTmCd?has_content>
		AND  (SELECT  DISTINCT TM_CD FROM ST_UPJANG T, HLDC_SC_DEPT_V D
               WHERE  T.DEPT_ID = D.DEPT_ID
               AND  T.UPJANG = A.UPJANG) IN (${schTmCd})
		</#if>
		<#if schTransDt?has_content>
		AND A.TRANS_DATE = :schTransDt
		</#if>
		UNION ALL
		
				 SELECT
                  0 AS CHK		/*체크박스*/
                , A.UPJANG		/*사업장*/
                , (SELECT UPJANGNM FROM ST_UPJANG C WHERE C.UPJANG = A.UPJANG) AS UPJANGNM	/*사업장명*/
                , A.ITEM_CODE	/*상품코드*/
                , A.ITEM_NAME    /*상품명*/
                , A.ITEM_SIZE    /*상품규격*/
                , A.PO_UOM       /*단위*/
                , A.PO_QTY		/*발주수량*/
                , A.REQ_QTY      /*요청량*/
                , A.REQ_DATE		/*요청일*/
                , A.REQ_TIME		/*요청시간*/
                , NVL(A.TRANS_DATE,TO_CHAR(SYSDATE,'YYYYMMDD')) AS  TRANS_DATE		/*수정일*/
                , B.TRANS_MAMOUNT					/*기반품금액*/
                , NVL(D.RETURNED_QTY,0) AS RETURNED_QTY		/*기반품량*/
                , NVL(A.PROC_QTY,A.REQ_QTY) AS PROC_RT_QTY 	/*반품수량*/
                , D.SALE_PRICE 		/* 판매단가 */
                , A.CT_CLAIM_KIND  /*클레임유형 IF*/
                , A.CLAIM_MEMO   /*클레임상세내역*/
                , A.REQ_KIND     /*요청사항 IF*/
                , (SELECT CODE_NAME FROM SCC_COMMON_CODE WHERE GROUP_CODE = 'C02' AND CODE= A.REQ_KIND) REQ_KIND_NM     /*요청사항 IF*/
                , A.CT_KIND      /*센터처리내역 IF*/
                , A.CT_MEMO 		/*센터상세처리내역 IF*/
                , A.PART_TM_CD  	/*담당 팀*/
		        , (SELECT DISTINCT(TM_NM) FROM HLDC_SC_TM C WHERE C.TM_CD = A.PART_TM_CD) AS PART_TM_NM	/*담당 팀명*/ 
		        , A.MNG_SABUN  	/*처리자*/
		        , (SELECT NM_KOR FROM HR_PERSONAL C WHERE C.SABUN = A.MNG_SABUN) AS NM_KOR	/*처리자명*/
		        , A.PRCS_STATUS  /*처리상태*/
                , B.TRANS_MPRICE /*매입단가*/
                , NVL(B.TRANS_QTY,0) AS TRANS_QTY	/*매입수량*/
                , A.PROC_AMT		/*반품금액*/	
                , A.PO_ID		/*주문번호*/
                , A.PO_NUM       /*주문번호 항번*/
                , 0 CLAIM_NUM    /*클레임번호 HIST에는 클레임번호 없음.*/
                , NVL((SELECT CLS_FLAG FROM HLDC_PO_CLOSING C WHERE CLS_YM >= TRIM(SUBSTR(TO_CHAR(SYSDATE,'YYYYMMDD'),0,6)) AND SUBINV_CODE = A.SUBINV_CODE AND C.CLS_FLAG = 'Y' AND ROWNUM =1),'N') AS CLS_FLAG
                , EPROCUSR.FC_GET_FCUS_CLAIM_QTY_YN(A.PO_NUM,A.PO_ID,A.SUBINV_CODE,A.ITEM_CODE,A.REQ_QTY) CLAIM_QTY
				, NVL(C.MIN_ORD_QTY, 0) AS MIN_ORD_QTY
		        , NVL(C.MAX_ORD_QTY, 0) AS MAX_ORD_QTY
		        , C.MULTIPLIER_QTY
        	    , C.POINT_FLAG	                
                , A.SUBINV_CODE    /*창고코드*/
                , A.LINK_DEPT   	  /*책임소재 IF*/
                , A.ETC_MEMO   	  /*기타사항 IF*/
                , (SELECT SUBINV_NAME FROM VO_SUBINVENTORY E WHERE A.SUBINV_CODE = E.SUBINV_CODE) SUBINV_NAME  /*창고명*/        	    
        	    , :loginSabun LOGIN_SABUN
        	    , D.PO_COMP_YN												/*	EAI : PO완료 여부*/
     	    	, NVL(D.LEGCY_REQ_NO,'EAI') LEGCY_REQ_NO					/*	EAI : 일반자재 구분(LEGCY_REQ_NO가 NULL 이면 일반자재)*/
        	    , D.PO_NO													/*	EAI : PO_NO*/
                , D.PO_LNO													/*	EAI : PO_LNO*/
                , D.PR_NO													/*	EAI : PR_NO*/
                , D.PR_LNO													/*	EAI : PR_LNO*/
                , D.UNIT_PRICE												/*	EAI : 구매단가*/
                , (D.UNIT_PRICE * NVL(A.PROC_QTY,A.REQ_QTY)) AS PO_AMT		/*	EAI : 반품액**/
                , '' AS MG_NO												/*	EAI : MG_NO	**/
                , '' AS MOVEMENT											/*	EAI : MOVEMENT**/
                , D.ACCTCD
                , D.PO_DATE
                , D.NEED_DATE
          		, TO_CHAR(SYSDATE,'YYYYMMDD') PR_DATE	/*	EAI : 처리일*/
                , (SELECT  DISTINCT MU_CD FROM ST_UPJANG T, HLDC_SC_DEPT_V D WHERE  T.CC_CD = D.CC_CD AND  T.UPJANG = A.UPJANG) BU_CD
                --, (SELECT  DISTINCT CC_CD FROM ST_UPJANG T  WHERE  T.UPJANG = A.UPJANG) CC_CD
                , DECODE(D.PJT_NO,null,(SELECT  DISTINCT CC_CD FROM ST_UPJANG T  WHERE  T.UPJANG = A.UPJANG),'') CC_CD 	/* EAI : CC_CD  */
                , D.PJT_NO 	/* EAI : PJT_NO  , 프로젝트 자제일경우 IO 코드 */
                , NVL((SELECT 'Y' FROM MAS_TICKET_STD T WHERE T.UPJANG = A.UPJANG AND T.ITEM_CODE = A.ITEM_CODE GROUP BY UPJANG,ITEM_CODE),'N') TICKET_YN   /*	식권 여부	*/
                , EPROCUSR.FC_GET_WH_CLOSE_YN('100','HFC',A.SUBINV_CODE,A.NEED_DATE) WH_CLOSE			/*구매 마감 여부*/
                , (SELECT IMG_PATH FROM SCO_UPJANG_MST WHERE UPJANG = A.UPJANG) MAP	/* 약도 파일 */
                , TO_CHAR(A.UPDATE_DATE,'YYYYMMDDHH24MI') UPDATE_DATE	/*	최종 수정 일자*/
                , DECODE(SUBSTR(A.SUBINV_CODE,1,2),'S1',(SELECT REPLACE(Z.CC_NM,'식재') FROM HLDC_SC_DEPT_V Z WHERE Z.CC_CD = E.CC_CD),'직영') AS GUBUN		/*구분*/
                , F.VD_NM AS CUST_NM	/*고객사명*/
                , D.CENTER_FLAG
                , D.LINE_STATUS
                , D.DELIVERED_QTY  AS DLVY_QTY	/*입고수량*/
			    , A.CENTER_CODE
                , (SELECT CENTER_NAME FROM HLDC_PO_CENTER WHERE CENTER_CODE = A.CENTER_CODE) AS CENTER_NAME
				, 0 AS PHOTO        /*사진 유무*/
				, B.TRANS_ID
				, '' AS MG_NO_TRG
				, EPROCUSR.FN_GET_FROM_CENTER_INFO('100', 'HFC', D.ITEM_CODE, D.CNTR_NO, D.CNTR_REV) AS FROM_CNTR_NM
        FROM PO_CLAIM_LIST_HIST A, HLDC_PO_TRANSACTION_SALE B , HLDC_PO_ITEM_MST C , HLDC_PO_PO D ,VO_SUBINVENTORY E, VO_FC_VENDOR F
        WHERE 1=1
        AND   A.SUBINV_CODE = E.SUBINV_CODE(+) 
    	AND   D.PO_NO = B.PO_NO(+)
        AND   D.PO_LNO = B.PO_LNO(+)
        AND   TO_CHAR(A.CUSTCD) = F.VD_CD(+)        
 		AND   B.TRANS_QTY(+) > 0	/* HLDC_PO_TRANSACTION_SALE 반품 수량 행 제거	*/
        AND   A.ITEM_CODE = C.ITEM_CODE
        AND   A.PO_ID = D.PO_ID
        AND   A.PO_NUM = D.PO_NUM      
        <#if schPrcsStatus?has_content>
        AND   A.PRCS_STATUS = :schPrcsStatus
        <#else>
        AND   A.PRCS_STATUS IN (01,08,09,11)
        </#if>
        <#if schGubun == '1'>
			AND   A.NEED_DATE BETWEEN :schFromDate AND :schToDate
		<#else>
			AND   TO_CHAR(A.MNG_DATE,'YYYYMMDD') BETWEEN :schFromDate AND :schToDate
		</#if>
		--<#if schCenterCode != '*'>	
		--	AND   A.CENTER_CODE = :schCenterCode	
		--</#if>
        <#if schCode?has_content>AND A.CENTER_CODE IN (${schCode})</#if>
		<#if schCtKind?has_content>
		AND  A.CT_KIND = :schCtKind  --처리유형
		</#if>
		<#if schReturnItem?has_content>
		AND  A.ITEM_CODE = :schReturnItem  --반품자재
		</#if>
		<#if schSabun?has_content>
		AND  A.MNG_SABUN = :schSabun  --처리자
		</#if>
		<#if schSubinv?has_content>
		AND  A.SUBINV_CODE = :schSubinv  --창고
		</#if>
		<#if schUpjang?has_content>
		AND  A.UPJANG = :schUpjang  --업장
		</#if>		
		<#if schReqKind?has_content>
		AND  A.REQ_KIND = :schReqKind  --요청사항
		</#if>		
		<#if schReturnDate?has_content>
		--AND  '반품일자' = :schReturnDate
		</#if>  
		<#if schReturnNum?has_content>
		--AND  '반송번호' = :schReturnNum
		</#if> 
		<#if schCust?has_content>
		AND  A.CUSTCD = :schCust
		</#if> 		
		<#if schMuCd?has_content>
		AND  (SELECT  DISTINCT MU_CD FROM ST_UPJANG T, HLDC_SC_DEPT_V D
               WHERE  T.CC_CD = D.CC_CD
                 AND  T.UPJANG = A.UPJANG) IN (${schMuCd})
		</#if> 
		<#if schTmCd?has_content>
		AND  (SELECT  DISTINCT TM_CD FROM ST_UPJANG T, HLDC_SC_DEPT_V D
               WHERE  T.DEPT_ID = D.DEPT_ID
                 AND  T.UPJANG = A.UPJANG) IN (${schTmCd})
		</#if>
		<#if schTransDt?has_content>
		AND A.TRANS_DATE = :schTransDt
		</#if>
		)ORDER BY PO_ID DESC
		]]>
	</statement>
	
	<!-- 클레임처리(을)를 수정한다. -->
	<statement name="update" type="update">
		/*+ com.hwfs.fm.fmc.dao.ClaimProcDAO.update */
		<![CDATA[
		UPDATE PO_CLAIM_LIST
		SET   
		        PRCS_STATUS = :prcsStatus
		        <#if procRtQty?has_content>,PROC_QTY = :procRtQty</#if>
			    <#if ctKind?has_content> ,CT_KIND  = :ctKind </#if>
			    <#if ctMemo?has_content> ,CT_MEMO  = :ctMemo </#if>
			    <#if prcsStatus == '09'>,MNG_DATE = SYSDATE</#if>
			    <#if mngSabun?has_content>,MNG_SABUN = :mngSabun </#if> 
			    <#if reqQty?has_content>,REQ_QTY     = :reqQty </#if>   
			    <#if reqKind?has_content>,REQ_KIND     = :reqKind </#if>
		        <#if reqDate?has_content>,REQ_DATE     = :reqDate </#if>
		        <#if reqTime?has_content>,REQ_TIME     = :reqTime </#if>
		        <#if partTmCd?has_content> ,PART_TM_CD = :partTmCd </#if>          
			    <#if linkDept?has_content> ,LINK_DEPT = :linkDept </#if>
			    <#if claimRemark?has_content> ,CLAIM_REMARK = :claimRemark </#if>
			    <#if ctClaimKind?has_content> ,CT_CLAIM_KIND = :ctClaimKind </#if>
			    ,TRANS_DATE = :transDate
				,UPDATE_BY = :loginSabun
				,UPDATE_DATE = SYSDATE 
		 WHERE PO_ID = :poId
		   AND PO_NUM = :poNum
		   AND CLAIM_NUM = :claimNum
		]]>
	</statement>
	
	<!-- 클레임요청(을)를 삭제한다. -->
	<statement name="delete" type="delete">
		/*+ com.hwfs.fm.fmc.dao.ClaimProcDAO.delete */
		<![CDATA[
		DELETE 
		FROM   PO_CLAIM_LIST 
		WHERE  PO_ID = :poId
		  AND  PO_NUM = :poNum
		  AND  CLAIM_NUM = :claimNum
		]]>
	</statement>

	<!-- 클레임처리 [처리취소] 처리된 클레임을 다시 요청상태로 변경한다.  - 교환 처리된 클레임만 가능. -->
	<statement name="cancelUpdate" type="update">
		/*+ com.hwfs.fm.fmc.dao.ClaimProcDAO.cancelUpdate */
		<![CDATA[
		UPDATE PO_CLAIM_LIST
		SET PRCS_STATUS = '01'
		 , UPDATE_DATE = SYSDATE
		 , UPDATE_BY = :loginSabun
		WHERE  PO_ID = :poId
		  AND  PO_NUM = :poNum
		  AND  CLAIM_NUM = :claimNum
		  AND  PRCS_STATUS = :prcsStatus
		]]>
	</statement>

	<!-- 요청 취소 클레임 저장. -->
	<statement name="claimHistorySave" type="update">
	/*+ com.hwfs.fm.fmc.dao.ClaimProcDAO.claimHistorySave */
		<![CDATA[	
			INSERT 
			  INTO PO_CLAIM_LIST_HIST
			       ( 
			           PO_ID
			         ,PO_NUM
			         ,NEED_DATE
			         ,CENTER_CODE
			         ,UPJANG
			         ,SUBINV_CODE
			         ,CUSTCD
			         ,ITEM_CODE
			         ,ITEM_NAME
			         ,ITEM_SIZE
			         ,PO_UOM
			         ,PO_QTY
			         ,DLVY_QTY
			         ,UNDLVY_QTY
			         ,REQ_QTY
			         ,CLAIM_KIND
			         ,REQ_KIND
			         ,REQ_DATE
			         ,REQ_TIME
			         ,CLAIM_MEMO
			         ,ETC_MEMO
			         ,CT_KIND
			         ,CT_MEMO
			         ,PT_KIND
			         ,DLVY_TIME
			         ,DLVY_KIND
			         ,PRCS_STATUS
			         ,CT_CLAIM_KIND
			         ,PT_MEMO
			         ,LINK_DEPT
			         ,ACP_DATE
			         ,MNG_DATE
			         ,MNG_SABUN
			         ,UPJANG_AREA
			         ,PROD_KIND
			         ,PART_TM_CD
			         ,PART_SABUN
			         ,CLAIM_REMARK
			         ,NEED_DATE_EDIT
			         ,PROC_QTY
			         ,PROC_AMT
			         ,CONFIRM_DATE
			         ,RESULT_CD
			         ,RESULT_MSG
			         ,MOBILE_GUBUN
			         ,CENTER_GUBUN
			         ,REQ_SABUN
			         ,CREATE_DATE
			         ,CREATE_BY
			         ,UPDATE_DATE
			         ,UPDATE_BY
			         ,TRANS_DATE 
			       ) 
			       
			SELECT A.PO_ID,
			       A.PO_NUM,
			       A.NEED_DATE,
			       A.CENTER_CODE,
			       A.UPJANG,
			       A.SUBINV_CODE,
			       A.CUSTCD,
			       A.ITEM_CODE,
			       A.ITEM_NAME,
			       A.ITEM_SIZE,
			       A.PO_UOM,
			       A.PO_QTY,
			       A.DLVY_QTY,
			       A.UNDLVY_QTY,
			       A.REQ_QTY,
			       A.CLAIM_KIND,
			       A.REQ_KIND,
			       A.REQ_DATE,
			       A.REQ_TIME,
			       A.CLAIM_MEMO,
			       A.ETC_MEMO,
			       A.CT_KIND,
			       A.CT_MEMO,
			       A.PT_KIND,
			       A.DLVY_TIME,
			       A.DLVY_KIND,
			       '08' PRCS_STATUS,
			       A.CT_CLAIM_KIND,
			       A.PT_MEMO,
			       A.LINK_DEPT,
			       A.ACP_DATE,
			       A.MNG_DATE,
			       A.MNG_SABUN,
			       A.UPJANG_AREA,
			       A.PROD_KIND,
			       A.PART_TM_CD,
			       A.PART_SABUN,
			       A.CLAIM_REMARK,
			       A.NEED_DATE_EDIT,
			       A.PROC_QTY,
			       A.PROC_AMT,
			       A.CONFIRM_DATE,
			       A.RESULT_CD,
			       A.RESULT_MSG,
			       A.MOBILE_GUBUN,
			       A.CENTER_GUBUN,
			       A.REQ_SABUN,
			       A.CREATE_DATE,
			       A.CREATE_BY,
			       SYSDATE UPDATE_DATE,
			       :loginSabun UPDATE_BY,
			       A.TRANS_DATE
			  FROM PO_CLAIM_LIST A
			  WHERE A.PO_ID = :poId
			  AND A.PO_NUM = :poNum
			  AND A.CLAIM_NUM = :claimNum
			]]>
    </statement>
    <!-- 클레임처리시 판매단가 테이블의 trans_date2 컬럼에 회계일자 수정하는 트리거를 발생하기 위한 업데이트 -->
	<statement name="transDate2Update" type="update">
		<![CDATA[
		/*+ com.hwfs.fm.fmc.dao.ClaimProcDAO.transDate2Update */
		UPDATE EPROCUSR.ESISALP
		SET    MOD_DT = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
		WHERE  SYS_ID      = '100'
		AND    COMP_CD     = 'HFC'
		AND    MG_NO       = :mgNoTrg
		]]>
	</statement>
	
	<!-- 클레임처리상태 재조회. -->
	<statement name="selectPrcsStatus" type="select">
		<![CDATA[
		/*+ com.hwfs.fm.fmc.dao.ClaimProcDAO.selectProcStatus */	
		SELECT A.PO_ID
		       ,A.PO_NUM
		       ,A.CLAIM_NUM
		       ,A.ITEM_CODE
		       ,A.ITEM_NAME
		       ,A.PRCS_STATUS
		FROM   PO_CLAIM_LIST A
		WHERE  A.PO_ID     = :poId
		AND    A.PO_NUM    = :poNum
		AND    A.CLAIM_NUM = :claimNum
		]]>
	</statement>
</hqml>



