<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="../../../default_typedef.xml"/>
  <Form id="MAS10080E" onkeydown="fn_form_OnKeyDown" onload="form_onload" titletext="매출등록" position="absolute 0 0 1252 725" scrollbars="none">
    <Layouts>
      <Layout>
        <Static id="sta_detail03" class="sta_WFDA_Labelbg" position="absolute 991 86 1237 113" anchor="left top right"/>
        <Static id="sta_detail02" class="sta_WFDA_Labelbg" position="absolute 687 86 913 113"/>
        <Static id="sta_detail01" class="sta_WFDA_Labelbg" position="absolute 79 86 305 113"/>
        <Static id="st_TRX_TYPE" text="매출유형" userdata="strMAQuery_UPJANG_TYPE_CD" position="absolute 0 86 80 113" class="sta_WFDA_Label01"/>
        <Static id="st_TRX_DESC" text="적요" position="absolute 0 138 80 165" class="sta_WFDA_Label01"/>
        <Static id="st_PRICE" text="단가" position="absolute 0 112 80 139" class="sta_WFDA_Label01"/>
        <Static id="st_SUBINV_CODE" text="창고" userdata="strMAQuery_SUBINV_CODE" position="absolute 304 86 384 113" class="sta_WFDA_Label01"/>
        <Static id="st_QTY" text="식수" position="absolute 304 112 384 139" class="sta_WFDA_Label01"/>
        <Static id="st_CUSTCD" text="고객사" userdata="strMAQuery_UPJANG_CUST" position="absolute 608 86 688 113" class="sta_WFDA_Label01"/>
        <Static id="st_AMT" text="금액" position="absolute 608 112 688 139" class="sta_WFDA_Label01"/>
        <Static id="st_ADITEM1" text="식구분" userdata="strMAQuery_MGUBUN" position="absolute 608 138 688 165" class="sta_WFDA_Label01"/>
        <Static id="st_TRX_ID" text="매출코드" position="absolute 912 86 992 113" class="sta_WFDA_Label01"/>
        <Static id="st_TAX_KIND" text="과세여부" userdata="strMAQuery_GwaGubun" position="absolute 912 112 992 139" class="sta_WFDA_Label01"/>
        <Static id="st_TCK_WTD_SEQ" text="식권차수" position="absolute 912 138 992 165" class="sta_WFDA_Label01"/>
        <Edit autoselect="true" id="edt_TRX_TYPE" imemode="none" onkeydown="edt_TRX_TYPE_OnKeyDown" readonly="true" taborder="4" position="absolute 82 89 283 110" class="msk_WF_Essential"/>
        <Button id="edtBtn_TRX_TYPE" onclick="edtBtn_TRX_TYPE_OnClick" taborder="16" tabstop="false" position="absolute 282 89 302 110" class="btn_WF_popSearchEssential" text="" image=""/>
        <Edit autoselect="true" id="edt_CUSTCD" onkeydown="edt_TRX_TYPE_OnKeyDown" readonly="true" taborder="6" position="absolute 690 89 891 110" class="msk_WF_Essential"/>
        <Button id="edtBtn_CUSTCD" onclick="edtBtn_TRX_TYPE_OnClick" taborder="19" tabstop="false" position="absolute 890 89 910 110" class="btn_WF_popSearchEssential" text="" image=""/>
        <Edit enable="false" id="edt_TRX_ID" readonly="true" taborder="7" position="absolute 994 89 1234 110"/>
        <Static id="sta_detail00" class="sta_WFDA_Labelbg" position="absolute 383 86 609 113"/>
        <Edit autoselect="true" id="edt_SUBINV_CODE" onkeydown="edt_TRX_TYPE_OnKeyDown" readonly="true" taborder="5" position="absolute 386 89 587 110" class="msk_WF_Essential"/>
        <Button id="edtBtn_SUBINV_CODE" onclick="edtBtn_TRX_TYPE_OnClick" taborder="18" tabstop="false" position="absolute 586 89 606 110" class="btn_WF_popSearchEssential" text="" image=""/>
        <Static id="sta_detail04" class="sta_WFDA_Labelbg" position="absolute 79 112 305 139"/>
        <Static id="sta_detail05" class="sta_WFDA_Labelbg" position="absolute 79 138 609 165"/>
        <MaskEdit id="me_PRICE" mask="###,##0" taborder="8" value="MaskEdit00" position="absolute 82 115 302 136" class="msk_WF_Essential"/>
        <Static id="sta_detail06" class="sta_WFDA_Labelbg" position="absolute 383 112 609 139"/>
        <Static id="sta_detail07" class="sta_WFDA_Labelbg" position="absolute 687 112 913 139"/>
        <Static id="sta_detail08" class="sta_WFDA_Labelbg" position="absolute 991 112 1237 139" anchor="left top right"/>
        <Edit autoselect="true" enable="false" id="edt_TAX_KIND" onkeydown="edt_TRX_TYPE_OnKeyDown" readonly="true" taborder="11" position="absolute 994 115 1215 136"/>
        <Button id="edtBtn_TAX_KIND" onclick="edtBtn_TRX_TYPE_OnClick" taborder="22" tabstop="false" position="absolute 1214 115 1234 136" text="" image="" class="btn_WF_popSearch"/>
        <MaskEdit id="me_QTY" mask="###,##0" taborder="9" value="MaskEdit00" position="absolute 386 115 606 136" class="msk_WF_Essential"/>
        <MaskEdit id="me_AMT" mask="###,##0" taborder="10" value="MaskEdit00" position="absolute 690 115 910 136" class="msk_WF_Essential"/>
        <Static id="sta_detail09" class="sta_WFDA_Labelbg" position="absolute 687 138 913 165"/>
        <Static id="sta_detail10" class="sta_WFDA_Labelbg" position="absolute 991 138 1237 165" anchor="left top right"/>
        <Edit autoselect="true" enable="false" id="edt_TCK_WTD_SEQ" onkeydown="edt_TRX_TYPE_OnKeyDown" readonly="true" taborder="14" position="absolute 994 141 1215 162"/>
        <Button enable="false" id="edtBtn_TCK_WTD_SEQ" onclick="edtBtn_TCK_WTD_SEQ_OnClick" taborder="21" tabstop="false" position="absolute 1214 141 1234 162" text="" image="" class="btn_WF_popSearch"/>
        <Edit autoselect="true" lengthunit="asciii" id="edt_TRX_DESC" imemode="native" maxlength="100" onkeydown="edt_TRX_DESC_OnKeyDown" taborder="12" position="absolute 82 141 606 162" class="edt_WF_Essential"/>
        <Edit autoselect="true" id="edt_ADITEM1" imemode="none" onkeydown="edt_ADITEM1_OnKeyDown" readonly="true" taborder="13" position="absolute 690 141 891 162" class="edt_WF_Essential"/>
        <Button id="edtBtn_ADITEM1" onclick="edtBtn_TRX_TYPE_OnClick" taborder="23" tabstop="false" position="absolute 890 141 910 162" class="btn_WF_popSearchEssential" text="" image=""/>
        <Static id="Static15" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 165 1252 180" anchor="left bottom"/>
        <Grid autoenter="select" binddataset="ds_list" cellsizingtype="both" readonly="false" enable="true" cellsizebandtype="allband" id="grid_List" useinputpanel="false" onexpanddown="grid_List_OnExpandEdit" onheadclick="grid_List_OnHeadClick" taborder="20" tabstop="false" usecontextmenu="true" useselcolor="true" visible="true" wheelscrollrow="1" position="absolute 0 180 1237 710" selecttype="row" autofittype="col" anchor="all">
          <Formats>
            <Format id="Default">
              <Columns>
                <Column size="27"/>
                <Column size="120"/>
                <Column size="100"/>
                <Column size="211"/>
                <Column size="44"/>
                <Column size="59"/>
                <Column size="45"/>
                <Column size="80"/>
                <Column size="213"/>
                <Column size="40"/>
                <Column size="40"/>
                <Column size="40"/>
                <Column size="40"/>
                <Column size="40"/>
                <Column size="120"/>
              </Columns>
              <Rows>
                <Row size="26" band="head"/>
                <Row size="24"/>
                <Row size="24" band="summ"/>
              </Rows>
              <Band id="head">
                <Cell displaytype="text" class="head_Excel"/>
                <Cell col="1" displaytype="text" text="매출유형"/>
                <Cell col="2" displaytype="text" text="창고"/>
                <Cell col="3" displaytype="text" text="고객사"/>
                <Cell col="4" displaytype="text" text="과세"/>
                <Cell col="5" displaytype="text" text="단가"/>
                <Cell col="6" displaytype="text" text="식수"/>
                <Cell col="7" displaytype="text" text="금액"/>
                <Cell col="8" displaytype="text" text="적요"/>
                <Cell col="9" displaytype="text" text="입금"/>
                <Cell col="10" displaytype="text" text="대체"/>
                <Cell col="11" displaytype="text" text="발행"/>
                <Cell col="12" displaytype="text" text="자동"/>
                <Cell col="13" displaytype="text" text="마감"/>
                <Cell col="14" displaytype="text" text="매출전표"/>
              </Band>
              <Band id="body">
                <Cell displaytype="text" style="align:center;background:white;background2:#F6FCFC;" expr="expr:currow+1"/>
                <Cell col="1" displaytype="text" style="align:left;background:white;background2:#F6FCFC;" text="bind:TYPE_NAME"/>
                <Cell col="2" displaytype="text" style="align:left;background:white;background2:#F6FCFC;" text="bind:SUBINV_CODENM"/>
                <Cell col="3" displaytype="text" style="align:left;background:white;background2:#F6FCFC;" text="bind:CUSTCDNM"/>
                <Cell col="4" displaytype="text" style="align:center;background:white;background2:#F6FCFC;" text="bind:TAX_KINDNM"/>
                <Cell col="5" displaytype="number" style="align:right;background:white;background2:#F6FCFC;" text="bind:PRICE"/>
                <Cell col="6" displaytype="number" style="align:right;background:white;background2:#F6FCFC;" text="bind:QTY"/>
                <Cell col="7" displaytype="number" style="align:right;background:white;background2:#F6FCFC;" text="bind:AMT"/>
                <Cell col="8" displaytype="text" style="align:left;background:white;background2:#F6FCFC;" text="bind:TRX_DESC"/>
                <Cell col="9" displaytype="text" edittype="expr:iif(RCP_YN=='Y', 'expand', 'none')" style="align:center;background:EXPR(fn_GetBackColorClose(&quot;1&quot;, CROSS_YN));background2:EXPR(fn_GetBackColorClose(&quot;1&quot;, CROSS_YN));" text="bind:RCP_YN" expandshow="expr:iif(RCP_YN=='Y', 'show', 'hide')"/>
                <Cell col="10" displaytype="text" edittype="expr:iif(SUBST_YN=='Y', 'expand', 'none')" style="align:center;background:EXPR(fn_GetBackColorClose(&quot;1&quot;, SUBST_YN));background2:EXPR(fn_GetBackColorClose(&quot;2&quot;, SUBST_YN));" text="bind:SUBST_YN" expandshow="expr:iif(SUBST_YN=='Y', 'show', 'hide')"/>
                <Cell col="11" displaytype="text" edittype="expr:iif(BIL_YN=='Y', 'expand', 'none')" style="align:center;background:EXPR(fn_GetBackColorClose(&quot;1&quot;, BIL_YN));background2:EXPR(fn_GetBackColorClose(&quot;2&quot;, BIL_YN));" text="bind:BIL_YN" expandshow="expr:iif(BIL_YN=='Y', 'show', 'hide')"/>
                <Cell col="12" displaytype="text" edittype="expr:iif(AUTO_YN=='Y', 'expand', 'none')" style="align:center;background:EXPR(fn_GetBackColorClose(&quot;1&quot;, AUTO_YN));background2:EXPR(fn_GetBackColorClose(&quot;2&quot;, AUTO_YN));" text="bind:AUTO_YN" expandshow="expr:iif(AUTO_YN=='Y', 'show', 'hide')"/>
                <Cell col="13" displaytype="text" style="align:center;background:EXPR(fn_GetBackColorClose(&quot;1&quot;, CLS_YN));background2:EXPR(fn_GetBackColorClose(&quot;2&quot;, CLS_YN));" text="bind:CLS_YN"/>
                <Cell col="14" displaytype="text" style="align:center;background:white;background2:#F6FCFC;" expr="expr:iif(gfn_length(GAMU)==0, &quot;&quot;, GAMU+&quot;-&quot;+GADATE+&quot;-&quot;+GANO)"/>
              </Band>
              <Band id="summary">
                <Cell style="align:left;"/>
                <Cell col="1" colspan="5" style="align:center;" text="합계"/>
                <Cell col="6" displaytype="number" style="align:right;" expr="expr:getSum('QTY')"/>
                <Cell col="7" displaytype="number" style="align:right;" expr="expr:getSum('AMT')"/>
                <Cell col="8" colspan="7" style="align:left;"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Div id="dv_Copy" taborder="36" tabstop="false" text="Div0" visible="false" position="absolute 1272 72 1528 281" class="div_WFGRD_graybg" scrollbars="none">
          <Layouts>
            <Layout>
              <Static id="sta_detail03" class="sta_WFDA_Labelbg" position="absolute 94 39 240 66"/>
              <Button id="btn_DataCopy" onclick="dv_Copy_btn_DataCopy_OnClick" taborder="6" text="매 출 복 사" position="absolute 18 172 236 193" class="btn_WF_Custom" image="" anchor="default"/>
              <Static id="Static23" text="☞ 지정한 날짜의 매출이 복사됩니다." position="absolute 14 14 236 35" anchor="default"/>
              <Static id="Static1" text="복사일자" position="absolute 13 39 95 66" class="sta_WFDA_Label01" anchor="default"/>
              <MaskEdit id="me_TRX_DATEC" mask="####-##-##" readonly="true" taborder="1" type="string" position="absolute 97 42 175 63" anchor="default"/>
              <Button id="btn_TRX_DATEC" onclick="g_CalButton_OnClick" taborder="2" tabstop="false" userdata="dv_Copy.me_TRX_DATEC" position="absolute 174 42 195 63" class="btn_WF_popSearch" text="" image="" anchor="default"/>
              <Static id="Static0" text="매출유형" position="absolute 13 65 95 167" class="sta_WFDA_Label01" anchor="default"/>
              <CheckBox id="chk1" taborder="3" tabstop="false" value="false" position="absolute 98 65 236 85" anchor="default"/>
              <CheckBox id="chk2" taborder="4" tabstop="false" value="false" position="absolute 98 85 236 105" anchor="default"/>
              <CheckBox id="chk3" taborder="5" tabstop="false" value="false" position="absolute 98 105 236 125" anchor="default"/>
              <CheckBox id="chk4" taborder="10" tabstop="false" value="false" position="absolute 98 125 236 145" anchor="default"/>
              <CheckBox id="chk5" taborder="11" tabstop="false" value="false" position="absolute 98 145 236 165" anchor="default"/>
            </Layout>
          </Layouts>
        </Div>
        <MPFileDialog id="fd_Excel" taborder="56" position="absolute 1261 38 1285 62" visible="false"/>
        <Static id="Static06" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1237 0 1252 710" anchor="top right"/>
        <Static id="Static71" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 710 1252 725" anchor="left bottom"/>
        <Div id="div_cmnBtn" anchor="left top right" taborder="1" url="cmn::CmnBtn.xfdl" scrollbars="none" position="absolute 0 0 1237 30"/>
        <Static id="Static01" class="sta_WFSA_Labelbg" position="absolute 0 30 1237 71" anchor="left top right"/>
        <Static id="st_UPJANGQuery" text="업장" userdata="strMAQuery_Upjang" position="absolute 15 40 96 61" class="sta_WFSA_label"/>
        <Static id="Static1" text="매출일자" position="absolute 288 40 370 61" class="sta_WFSA_label"/>
        <Edit autoselect="true" id="edt_UPJANGQuery" imemode="native" ontextchanged="edt_UPJANGQuery_OnChanged" onkeydown="edt_UPJANGQuery_OnKeyDown" readonly="true" taborder="1" position="absolute 57 40 238 61" class="edt_WF_Essential" oneditclick="edt_UPJANGQuery_oneditclick"/>
        <Button id="edtBtn_UPJANGQuery" onclick="edtBtn_UPJANGQuery_OnClick" taborder="2" tabstop="false" position="absolute 237 40 258 61" class="btn_WF_popSearchEssential" text="" image=""/>
        <MaskEdit id="me_TRX_DATE" mask="####-##-##" ontextchanged="me_TRX_DATE_OnChanged" oneditclick="g_Date_OnFocus" onsetfocus="g_Date_OnFocus" onkillfocus="g_Date_OnKillFocus" taborder="3" type="string" position="absolute 357 40 435 61" class="msk_WF_Essential"/>
        <Button id="edtBtn_Date" onclick="edtBtn_Date_OnClick" taborder="15" tabstop="false" position="absolute 434 40 455 61" class="btn_WF_popSearchEssential" text="" image="" userdata="me_TRX_DATE"/>
        <CheckBox id="chk_Auto" taborder="24" tabstop="false" text="자동저장기능" position="absolute 612 40 719 61" value="true"/>
        <Static id="Static0" text="[단위:식,원,VAT포함]" position="absolute 459 41 586 62"/>
        <Button id="btn_Copy" onclick="btn_Copy_OnClick" taborder="37" tabstop="false" text="전일매출 복사" position="absolute 1034 40 1133 61" class="btn_WF_Custom" image="" anchor="top right"/>
        <Button id="Button0" onclick="fn_Exl_Import" taborder="56" tabstop="false" text="매출엑셀등록" position="absolute 1135 40 1234 61" class="btn_WF_Custom" image="" anchor="top right"/>
        <Static id="Static05" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 30 93 40"/>
        <Static id="Static09" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 40 15 61"/>
        <Static id="Static02" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 47 40 57 61"/>
        <Static id="Static07" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 61 120 71"/>
        <Static id="Static08" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 258 40 288 61"/>
        <Static id="Static10" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 347 39 357 60"/>
        <Static id="Static04" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1272 71 1287 357" anchor="top right"/>
        <Static id="Static11" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1513 79 1528 365" anchor="top right"/>
        <Static id="Static12" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 1280 266 1596 281" anchor="left bottom"/>
        <Static id="Static13" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 1280 72 1596 87" anchor="left bottom"/>
        <Static id="Static14" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 71 1252 86" anchor="left bottom"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_cond"/>
      <Dataset id="ds_list" onrowposchanged="ds_list_OnRowPosChanged">
        <ColumnInfo>
          <Column id="ADITEM1" size="255" type="STRING"/>
          <Column id="ADITEM1NM" size="255" type="STRING"/>
          <Column id="ALT_AMT" size="0" type="BIGDECIMAL"/>
          <Column id="AMT" size="0" type="BIGDECIMAL"/>
          <Column id="AUTO_GUBUN" size="255" type="STRING"/>
          <Column id="AUTO_KIND" size="255" type="STRING"/>
          <Column id="CR_ACCTCD" size="255" type="STRING"/>
          <Column id="CUSTCD" size="0" type="BIGDECIMAL"/>
          <Column id="CUSTCDNM" size="255" type="STRING"/>
          <Column id="DR_ACCTCD" size="255" type="STRING"/>
          <Column id="GADATE" size="255" type="STRING"/>
          <Column id="GALINE" size="0" type="BIGDECIMAL"/>
          <Column id="GAMU" size="255" type="STRING"/>
          <Column id="GANO" size="0" type="BIGDECIMAL"/>
          <Column id="PRICE" size="0" type="BIGDECIMAL"/>
          <Column id="QTY" size="0" type="BIGDECIMAL"/>
          <Column id="SUBINV_CODE" size="255" type="STRING"/>
          <Column id="SUBINV_CODENM" size="255" type="STRING"/>
          <Column id="TAX_KIND" size="255" type="STRING"/>
          <Column id="TAX_KINDNM" size="255" type="STRING"/>
          <Column id="TCK_WTD_SEQ" size="0" type="BIGDECIMAL"/>
          <Column id="TRX_DATE" size="255" type="STRING"/>
          <Column id="TRX_DESC" size="255" type="STRING"/>
          <Column id="TRX_ID" size="0" type="BIGDECIMAL"/>
          <Column id="TRX_TYPE" size="255" type="STRING"/>
          <Column id="TYPE_NAME" size="255" type="STRING"/>
          <Column id="UPJANG" size="0" type="BIGDECIMAL"/>
          <Column id="UPJANGNM" size="255" type="STRING"/>
          <Column id="RCP_YN" size="256" type="STRING"/>
          <Column id="BIL_YN" size="256" type="STRING"/>
          <Column id="CLS_YN" size="256" type="STRING"/>
          <Column id="SUBST_YN" size="256" type="STRING"/>
          <Column id="PARENT_ID" size="256" type="BIGDECIMAL"/>
          <Column id="AUTO_YN" size="256" type="STRING"/>
          <Column id="CROSS_YN" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_listInput" cancolumnchange="ds_listInput_CanColumnChange" oncolumnchanged="ds_listInput_OnColumnChanged">
        <ColumnInfo>
          <Column id="ADITEM1" size="255" type="STRING"/>
          <Column id="ADITEM1NM" size="255" type="STRING"/>
          <Column id="ALT_AMT" size="0" type="BIGDECIMAL"/>
          <Column id="AMT" size="0" type="BIGDECIMAL"/>
          <Column id="AUTO_GUBUN" size="255" type="STRING"/>
          <Column id="AUTO_KIND" size="255" type="STRING"/>
          <Column id="CR_ACCTCD" size="255" type="STRING"/>
          <Column id="CUSTCD" size="0" type="BIGDECIMAL"/>
          <Column id="CUSTCDNM" size="255" type="STRING"/>
          <Column id="DR_ACCTCD" size="255" type="STRING"/>
          <Column id="GADATE" size="255" type="STRING"/>
          <Column id="GALINE" size="0" type="BIGDECIMAL"/>
          <Column id="GAMU" size="255" type="STRING"/>
          <Column id="GANO" size="0" type="BIGDECIMAL"/>
          <Column id="PRICE" size="0" type="BIGDECIMAL"/>
          <Column id="QTY" size="0" type="BIGDECIMAL"/>
          <Column id="SUBINV_CODE" size="255" type="STRING"/>
          <Column id="SUBINV_CODENM" size="255" type="STRING"/>
          <Column id="TAX_KIND" size="255" type="STRING"/>
          <Column id="TAX_KINDNM" size="255" type="STRING"/>
          <Column id="TCK_WTD_SEQ" size="0" type="BIGDECIMAL"/>
          <Column id="TRX_DATE" size="255" type="STRING"/>
          <Column id="TRX_DESC" size="255" type="STRING"/>
          <Column id="TRX_ID" size="0" type="BIGDECIMAL"/>
          <Column id="TRX_TYPE" size="255" type="STRING"/>
          <Column id="TYPE_NAME" size="255" type="STRING"/>
          <Column id="UPJANG" size="0" type="BIGDECIMAL"/>
          <Column id="UPJANGNM" size="255" type="STRING"/>
          <Column id="RCP_YN" size="256" type="STRING"/>
          <Column id="BIL_YN" size="256" type="STRING"/>
          <Column id="CLS_YN" size="256" type="STRING"/>
          <Column id="SUBST_YN" size="256" type="STRING"/>
          <Column id="PARENT_ID" size="256" type="BIGDECIMAL"/>
          <Column id="AUTO_YN" size="256" type="STRING"/>
          <Column id="CROSS_YN" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_Type">
        <ColumnInfo>
          <Column id="ADITEM1_CD" size="20" type="STRING"/>
          <Column id="ADITEM1_CDNM" size="100" type="STRING"/>
          <Column id="ADITEM1_CHK_YN" size="20" type="STRING"/>
          <Column id="ADITEM1_CHK_YNNM" size="100" type="STRING"/>
          <Column id="ADITEM2_CD" size="20" type="STRING"/>
          <Column id="ADITEM2_CDNM" size="100" type="STRING"/>
          <Column id="ADITEM2_CHK_YN" size="20" type="STRING"/>
          <Column id="ADITEM2_CHK_YNNM" size="100" type="STRING"/>
          <Column id="ALL_YN" size="20" type="STRING"/>
          <Column id="AUTO_AMT_YN" size="20" type="STRING"/>
          <Column id="BIZ_CHK_YN" size="20" type="STRING"/>
          <Column id="BIZ_CHK_YNNM" size="100" type="STRING"/>
          <Column id="BOND_CHK_YN" size="20" type="STRING"/>
          <Column id="CMP_ACCTCD" size="20" type="STRING"/>
          <Column id="CMP_ACCTCDNM" size="60" type="STRING"/>
          <Column id="CMP_AUTO_YN" size="20" type="STRING"/>
          <Column id="CMP_CLASS" size="20" type="STRING"/>
          <Column id="CMP_CLASSNM" size="100" type="STRING"/>
          <Column id="CMP_GRP" size="20" type="STRING"/>
          <Column id="CMP_GRPNM" size="100" type="STRING"/>
          <Column id="CMP_SPLS_ACCTCD" size="20" type="STRING"/>
          <Column id="CMP_SPLS_ACCTCDNM" size="60" type="STRING"/>
          <Column id="CMP_SPLS_YN" size="20" type="STRING"/>
          <Column id="CMP_TYPE" size="20" type="STRING"/>
          <Column id="CMP_TYPENM" size="200" type="STRING"/>
          <Column id="CR_ACCTCD" size="20" type="STRING"/>
          <Column id="CR_ACCTCDNM" size="60" type="STRING"/>
          <Column id="CUST_CHK_YN" size="20" type="STRING"/>
          <Column id="CUST_CHK_YNNM" size="100" type="STRING"/>
          <Column id="DR_ACCTCD" size="20" type="STRING"/>
          <Column id="DR_ACCTCDNM" size="60" type="STRING"/>
          <Column id="FEE_ACCTCD" size="20" type="STRING"/>
          <Column id="FEE_ACCTCDNM" size="60" type="STRING"/>
          <Column id="FEE_REG_YN" size="20" type="STRING"/>
          <Column id="SUBINV_CHK_YN" size="20" type="STRING"/>
          <Column id="SUBINV_CHK_YNNM" size="100" type="STRING"/>
          <Column id="TYPE_CD" size="20" type="STRING"/>
          <Column id="TYPE_GRP" size="20" type="STRING"/>
          <Column id="TYPE_GRPNM" size="100" type="STRING"/>
          <Column id="TYPE_NAME" size="200" type="STRING"/>
          <Column id="TYPE_TYPE" size="20" type="STRING"/>
          <Column id="TYPE_TYPENM" size="100" type="STRING"/>
          <Column id="USE_YN" size="1" type="STRING"/>
          <Column id="TYPE_CLASS" size="256" type="STRING"/>
          <Column id="TYPE_DESC" size="256" type="STRING"/>
          <Column id="TCK_YN" size="1" type="STRING"/>
          <Column id="ITEM_TYPE" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_MAS_TRX_LINE">
        <ColumnInfo>
          <Column id="RCP_ID" size="256" type="BIGDECIMAL"/>
          <Column id="AMT" size="256" type="BIGDECIMAL"/>
          <Column id="TRX_ID" size="256" type="BIGDECIMAL"/>
          <Column id="SOURCE_FR" size="256" type="STRING"/>
          <Column id="SOURCE_TO" size="256" type="STRING"/>
          <Column id="LINE_DATE" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_listInput_Exc">
        <ColumnInfo>
          <Column id="ADITEM1" size="255" type="STRING"/>
          <Column id="ADITEM1NM" size="255" type="STRING"/>
          <Column id="ALT_AMT" size="0" type="BIGDECIMAL"/>
          <Column id="AMT" size="0" type="BIGDECIMAL"/>
          <Column id="AUTO_GUBUN" size="255" type="STRING"/>
          <Column id="AUTO_KIND" size="255" type="STRING"/>
          <Column id="CR_ACCTCD" size="255" type="STRING"/>
          <Column id="CUSTCD" size="0" type="BIGDECIMAL"/>
          <Column id="CUSTCDNM" size="255" type="STRING"/>
          <Column id="DR_ACCTCD" size="255" type="STRING"/>
          <Column id="GADATE" size="255" type="STRING"/>
          <Column id="GALINE" size="0" type="BIGDECIMAL"/>
          <Column id="GAMU" size="255" type="STRING"/>
          <Column id="GANO" size="0" type="BIGDECIMAL"/>
          <Column id="PRICE" size="0" type="BIGDECIMAL"/>
          <Column id="QTY" size="0" type="BIGDECIMAL"/>
          <Column id="SUBINV_CODE" size="255" type="STRING"/>
          <Column id="SUBINV_CODENM" size="255" type="STRING"/>
          <Column id="TAX_KIND" size="255" type="STRING"/>
          <Column id="TAX_KINDNM" size="255" type="STRING"/>
          <Column id="TCK_WTD_SEQ" size="0" type="BIGDECIMAL"/>
          <Column id="TRX_DATE" size="255" type="STRING"/>
          <Column id="TRX_DESC" size="255" type="STRING"/>
          <Column id="TRX_ID" size="0" type="BIGDECIMAL"/>
          <Column id="TRX_TYPE" size="255" type="STRING"/>
          <Column id="TYPE_NAME" size="255" type="STRING"/>
          <Column id="UPJANG" size="0" type="BIGDECIMAL"/>
          <Column id="UPJANGNM" size="255" type="STRING"/>
          <Column id="RCP_YN" size="256" type="STRING"/>
          <Column id="BIL_YN" size="256" type="STRING"/>
          <Column id="CLS_YN" size="256" type="STRING"/>
          <Column id="SUBST_YN" size="256" type="STRING"/>
          <Column id="PARENT_ID" size="256" type="BIGDECIMAL"/>
          <Column id="AUTO_YN" size="256" type="STRING"/>
          <Column id="CROSS_YN" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_listInput_AutoLine">
        <ColumnInfo>
          <Column id="UPJANG" size="256" type="BIGDECIMAL"/>
          <Column id="ID" size="256" type="BIGDECIMAL"/>
          <Column id="AMT" size="256" type="BIGDECIMAL"/>
          <Column id="DATE" size="256" type="STRING"/>
          <Column id="CUSTCD" size="256" type="BIGDECIMAL"/>
          <Column id="SUBINV_CODE" size="256" type="STRING"/>
          <Column id="CMP_CLASS" size="256" type="STRING"/>
          <Column id="CMP_GRP" size="256" type="STRING"/>
          <Column id="CMP_TYPE" size="256" type="STRING"/>
          <Column id="CMP_ACCTCD" size="256" type="STRING"/>
          <Column id="ALL_YN" size="256" type="STRING"/>
          <Column id="RTN" size="256" type="STRING"/>
          <Column id="RTNMSG" size="256" type="STRING"/>
          <Column id="GUBUN" size="256" type="STRING"/>
          <Column id="TRX_ID" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_listInput_AutoLineReturn">
        <ColumnInfo>
          <Column id="RTN" size="256" type="STRING"/>
          <Column id="RTNMSG" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_MAS_TICKET_MST">
        <ColumnInfo>
          <Column id="TICKET_SEQ" size="256" type="BIGDECIMAL"/>
          <Column id="QTY" size="256" type="BIGDECIMAL"/>
          <Column id="TRX_ID" size="256" type="BIGDECIMAL"/>
          <Column id="TICKET_GROUP_SEQ" size="256" type="STRING"/>
          <Column id="TRX_DATE" size="256" type="STRING"/>
          <Column id="PRICE" size="256" type="STRING"/>
          <Column id="TRX_DESC" size="256" type="STRING"/>
          <Column id="UPJANG" size="256" type="BIGDECIMAL"/>
          <Column id="ITEM_CODE" size="256" type="STRING"/>
          <Column id="ITEM_TYPE" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_common"/>
      <Dataset id="ds_Excel"/>
    </Objects>
    <Bind>
      <BindItem id="edt_TRX_TYPE_value" compid="edt_TRX_TYPE" propid="value" datasetid="ds_listInput" columnid="TYPE_NAME"/>
      <BindItem id="edt_SUBINV_CODE_value" compid="edt_SUBINV_CODE" propid="value" datasetid="ds_listInput" columnid="SUBINV_CODENM"/>
      <BindItem id="edt_CUSTCD_value" compid="edt_CUSTCD" propid="value" datasetid="ds_listInput" columnid="CUSTCDNM"/>
      <BindItem id="edt_TCK_WTD_SEQ_value" compid="edt_TCK_WTD_SEQ" propid="value" datasetid="ds_listInput" columnid="TCK_WTD_SEQ"/>
      <BindItem id="edt_TAX_KIND_value" compid="edt_TAX_KIND" propid="value" datasetid="ds_listInput" columnid="TAX_KINDNM"/>
      <BindItem id="edt_TRX_ID_value" compid="edt_TRX_ID" propid="value" datasetid="ds_listInput" columnid="TRX_ID"/>
      <BindItem id="edt_TRX_DESC_value" compid="edt_TRX_DESC" propid="value" datasetid="ds_listInput" columnid="TRX_DESC"/>
      <BindItem id="me_PRICE_value" compid="me_PRICE" propid="value" datasetid="ds_listInput" columnid="PRICE"/>
      <BindItem id="me_QTY_value" compid="me_QTY" propid="value" datasetid="ds_listInput" columnid="QTY"/>
      <BindItem id="me_AMT_value" compid="me_AMT" propid="value" datasetid="ds_listInput" columnid="AMT"/>
      <BindItem id="edt_ADITEM1_value" compid="edt_ADITEM1" propid="value" datasetid="ds_listInput" columnid="ADITEM1NM"/>
      <BindItem id="item1" compid="sta_detail01" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item0" compid="sta_detail00" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item2" compid="sta_detail02" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item3" compid="sta_detail03" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item4" compid="sta_detail04" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item5" compid="sta_detail05" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item6" compid="sta_detail06" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item7" compid="sta_detail07" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item8" compid="sta_detail08" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item9" compid="sta_detail09" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item10" compid="sta_detail10" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item11" compid="dv_Copy.sta_detail03" propid="text" datasetid="ds_view" columnid="D_1"/>
    </Bind>
    <Script type="xscript4.0"><![CDATA[/*
 ******************************************************************************************
 * 시스템구분   : FS시스템/시스템공통/템플릿 1
 * 프로그램명   : MAS10080E
 * 기      능   : 매출등록
 * 작  성  자   : 구종화
 * 작성  일자   : 2007-11-16
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
                1)박은규 2012-11-05 CSR#(CH201210_00143) 요청자:박현정(FS기획팀)
                  매출복사기능
                2)박은규 2013-06-10 CSR#(CH201306_00051) 요청자:이남석, 김진옥(컨세션사업팀팀)
                  매출/입금 엑셀자료 일괄 업로드 기능개발
 ******************************************************************************************
 */
//=========================================================================================
// [ PART 1 ]
// Form에서 Include 할 내용을 정의
//
//=========================================================================================
include "U_lib::lib_conversionCom.xjs";
//@@컨버터에서 주석처리 #include "lib::sc_comon.js"
//@@컨버터에서 주석처리 #include "lib::sc_sql_common.js"
//@@컨버터에서 주석처리 #include "lib::tit_comm_0001.js"
//@@컨버터에서 주석처리 #include "lib::ma_common.js"


//=========================================================================================
// [ PART 2 ]
// Form에서 사용될 전역변수를 선언
//
//=========================================================================================
var f_Saved_ID,
	f_AfterCallServerCheck;
	
var f_NewDataCheck;	
var f_BatchJob = false;


//=========================================================================================
// [ PART 3 ]
// Form Loading 시 작업 정의
//
//=========================================================================================
function form_onload(obj:Form, e:LoadEventInfo)
{
	gfn_formOnLoad(obj, false);

    var F_ArrCol          = new Array(-1);
    var F_ArrColType      = new Array(-1);
    
	//init_btn_setup();	// Button 초기화
	fsp_init(this);

//============================================================================================
//(2012-11-05 추가) 시작
// 박은규 2012-11-05 CSR#(CH201210_00143) 요청자:박현정(FS기획팀)
// 매출복사기능
//============================================================================================
	//dv_Copy.position.top = 64;
	//dv_Copy.position.bottom = dv_Copy.position.top + 196;
	//dv_Copy.position.left = 740;
	//dv_Copy.position.right = dv_Copy.position.left + 243;
	dv_Copy.position.left = 981;
	dv_Copy.position.top = 70;
	dv_Copy.position.right = 1237;
	dv_Copy.position.bottom = 279;
	fn_SetChkBox();
//============================================================================================
//(2012-11-05 추가) 끝
//============================================================================================
	/*
	#############################################################################################################
	공통코드 SETTING
	#############################################################################################################
	*/	
	edt_UPJANGQuery.userdata = g_Upjang;
	edt_UPJANGQuery.value     = g_UpjangNm;

	me_TRX_DATE.value = fn_CurrDateWeek();
	dv_Copy.me_TRX_DATEC.value = gfn_addDate(me_TRX_DATE.value,-1);

	//사업장 권한 셋팅#############################################################################
	fn_SetAuth("","","edt_UPJANGQuery", "edtBtn_UPJANGQuery");
	//사업장 권한 셋팅#############################################################################  

	fn_insert();
}





//=========================================================================================
// [ PART 4 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,도움말,form닫기)
//
//=========================================================================================
function fn_search()
{
	if (!before_SelectCheck())
		return;


	//매출리스트############################################################
    fsp_clear(this);
    
	fsp_addSearch(this, "ma/mas:MAS10080E_S001");	

	ds_cond.clear();
	ds_cond.addColumn("UPJANG","BIGDECIMAL",256);
	ds_cond.addColumn("TRX_DATE","STRING",256);
			
	ds_cond.addRow();
		
	ds_cond.setColumn(ds_cond.rowposition, "UPJANG",    edt_UPJANGQuery.userdata);
	ds_cond.setColumn(ds_cond.rowposition, "TRX_DATE",  me_TRX_DATE.value);
					
	fn_DataSetAllClear();

    http.Sync = true;
	fsp_callService(this, "", "", "ds_cond=ds_cond","ds_list=ds_list","","fn_SearchDetail()");
	http.Sync = false;	
	//매출리스트############################################################
		
	//일마감체크#####################################################################
	if (!fn_IsCloseDate(ds_cond, edt_UPJANGQuery.userdata, me_TRX_DATE.value, "001")){
	 	 
		for (i=0;i<ds_list.rowcount;i++){
			
			ds_list.setColumn(i, "CLS_YN", "Y");
		}
	 }    
	//일마감체크#####################################################################
		
}

function fn_insert()
{
	if (!before_SelectCheck()) return;
	
	ds_listInput.clearData();

	//edtBtn Component 초기화############################
	Set_edtBtn_UserData("Clear");	
	//edtBtn Component 초기화############################

	ds_listInput.addRow();
	ds_listInput.setColumn(ds_listInput.rowposition, "UPJANG", gfn_nvl(edt_UPJANGQuery.userdata));	  
	ds_listInput.setColumn(ds_listInput.rowposition, "UPJANGNM", gfn_nvl(edt_UPJANGQuery.value));
	ds_listInput.setColumn(ds_listInput.rowposition, "TRX_DATE", gfn_nvl(me_TRX_DATE.value));	   
	//fn_ds_listInput_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex) 
	fn_ds_listInput_OnColumnChanged(ds_listInput,0,"TRX_TYPE","", ds_listInput.getColumn(ds_listInput.rowposition, "TRX_TYPE"),0);
	//Setds_listInput_OnColumnChanged();
		 
	//Disabled항목 Enabled처리####################################
	edt_TRX_TYPE.enable       = true;
	edtBtn_TRX_TYPE.enable    = true;
	
	edt_SUBINV_CODE.enable    = true;
	edtBtn_SUBINV_CODE.enable = true;
	
	edt_CUSTCD.enable         = true;
	edtBtn_CUSTCD.enable      = true;	
			
	edtBtn_TCK_WTD_SEQ.enable      = false;			
    //Disabled항목 Enabled처리####################################
		 
	edt_TRX_TYPE.setFocus();
}

function fn_delete()
{
    if (!before_DeleteCheck("Master") ){

		return;
    }
}

function fn_save()
{

    if (!before_SaveCheck("Master") ){

        if (f_NewDataCheck){
			ds_listInput.setColumn(ds_listInput.rowposition, "TRX_ID", "");
        }
                
		return;
    }
}


function fn_print()
{
}
function fn_Close()
{
	this.close();
}
function fn_help()
{
}

//=========================================================================================
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
//
//=========================================================================================

function fn_SearchDetail(int_TabIndex)
{
	/*
	if (Length(Tab_UPJANG.tab1.st_CC_CD.Value) == 0)
		return;


	//업장정보GET############################################################
    tit_clearActionInfo(this);
	tit_addSearchActionInfo(this, "ma/mas:MAS10020E_S002");

	ds_cond.Clear();
	ds_cond.AddColumn("CC_CD","VARCHAR",256);
	ds_cond.AddRow();

	ds_cond.SetColumn(ds_cond.Row, "CC_CD",  Tab_UPJANG.tab1.st_CC_CD.Value);


	tit_callService(this, "", "", "ds_cond=ds_cond","ds_deptHis=ds_list","","");
	//업장정보GET############################################################



	*/
}

function before_SelectCheck()
{

	if (numFormat(edt_UPJANGQuery.userdata)== "0")
	{
	
		gfn_alert("업장을 지정하여 주십시요.");
		edt_UPJANGQuery.setFocus();
		return false;
	}

	if (gfn_length(me_TRX_DATE.value)== 0)
	{
	
		gfn_alert("매출일자를 지정하여 주십시요.");
		me_TRX_DATE.setFocus();
		return false;
	}
		
	return true;
}


function before_SaveCheck(str_Gubun)
{
		
		//권한에 따른 저장/삭제 가능체크#########################################################################
		if (
//				(g_AuthLevel != "99") &&
				(g_AuthLevel < "99") &&
				(!fn_GetSaveAuthBy_AuthLevel(ds_listInput.getColumn(ds_listInput.rowposition, "UPJANG")))
		    )  return false;		    
		//권한에 따른 저장/삭제 가능체크#########################################################################
				
		
        /*
        업무구분별로 addAction 지정세팅##########################################        
        */
        
        f_Saved_ID = 0;
        f_NewDataCheck = false;
        
        //자동비교여부가 'N'일 경우 입금비교 팝업창을 띄운다.
		ds_MAS_TRX_LINE.clearData();		
		
        //자동비교일경우 입금내역에 대해 자동으로 라인저장여부
		ds_listInput_AutoLine.clearData();
		ds_listInput_AutoLineReturn.clearData();
		
		//초과금액을 처리해야 하는경우
		ds_listInput_Exc.clearData();
		
		
		//식권관리유형일 경우 식권비교 팝업창을 띄운다.
		ds_MAS_TICKET_MST.clearData();
		
        /*
        업무구분별로 addAction 지정세팅##########################################        
        */
		
		
 		if (ds_listInput.rowcount == 0){

			return;
		}

	    if (str_Gubun == "Master"){

			if (numFormat(ds_listInput.getColumn(ds_listInput.rowposition, "UPJANG"))== "0")
			{
			
				g_Message("EE", "업장을 지정하여 주십시요.");
				edt_UPJANGQuery.setFocus();
				return false;
			}
		
			if (gfn_length(ds_listInput.getColumn(ds_listInput.rowposition, "TRX_DATE"))== 0)
			{
			
				g_Message("EE", "매출일자가 누락되었습니다.");
				me_TRX_DATE.setFocus();
				return false;
			}
	        
	        //입력일때 Confirm체크##################################
	        if ( 
	             (ds_listInput.rowcount > 0) &&
                 (numFormat(ds_listInput.getColumn(ds_listInput.rowposition, "TRX_ID"))== "0") &&
	             (chk_Auto.value == "0") 
	           )
	        {
				if (!g_Confirm("02")) return false;	             
	        }     
	        //입력일때 Confirm체크##################################
	             
	             
	        //수정일때 Confirm체크##################################
            if (
                 (ds_listInput.rowcount > 0) &&
                 (numFormat(ds_listInput.getColumn(ds_listInput.rowposition, "TRX_ID"))!= "0")
               )
            {	        
				if (!g_Confirm("02", "데이터를 수정하시겠습니까?")) return false;
			}
	        //수정일때 Confirm체크##################################
	        
			//각 구분별 대체 마감체크##############################
            if (
                 (ds_listInput.rowcount > 0) &&
                 (numFormat(ds_listInput.getColumn(ds_listInput.rowposition, "TRX_ID"))!= "0")
               )
            {			
				if (!fn_GetALT_CLOSE(ds_cond, ds_listInput.getColumn(ds_listInput.rowposition, "TRX_ID"), ds_listInput.getColumn(ds_listInput.rowposition, "DR_ACCTCD"))) return false;
			}
			//각 구분별 대체 마감체크##############################	        

			//마감체크###############################################
			if (!fn_CheckMAClosing(ds_cond, edt_UPJANGQuery.userdata, me_TRX_DATE.value, "001"))
				return false;
			//마감체크###############################################

			if (gfn_length(ds_listInput.getColumn(ds_listInput.rowposition, "TRX_TYPE"))== 0){
				
				g_Message("EE", "매출유형이 누락되었습니다.\n" +
				                "확인하여 주십시요.");
                edt_TRX_TYPE.setFocus();
				return false;                
			}
			
			if (ds_Type.getColumn(0, "SUBINV_CHK_YN") == "R"){
	
				if (gfn_length(ds_listInput.getColumn(ds_listInput.rowposition, "SUBINV_CODE"))== 0){
		
					g_Message("EE", "창고가 누락되었습니다.\n" +
									"확인하여 주십시요.");
					edt_SUBINV_CODE.setFocus();
					return false;     
				}
			}
			
			
			if (ds_Type.getColumn(0, "CUST_CHK_YN") == "R"){
	
				if (numFormat(ds_listInput.getColumn(ds_listInput.rowposition, "CUSTCD"))== "0"){
		
					g_Message("EE", "고객사가 누락되었습니다.\n" +
									"확인하여 주십시요.");
					edt_CUSTCD.setFocus();
					return false;     
				}
			}
		
			if (gfn_length(ds_listInput.getColumn(ds_listInput.rowposition, "TAX_KIND"))== 0){
				
				g_Message("EE", "과세여부가 누락되었습니다.\n" +
				                "확인하여 주십시요.");
                edt_TAX_KIND.setFocus();
				return false;                
			}		
		
		
		
			if (ds_Type.getColumn(0, "AUTO_AMT_YN") == "Y"){
	
				if (numFormat(ds_listInput.getColumn(ds_listInput.rowposition, "PRICE"))== "0"){
		
					g_Message("EE", "단가가 누락되었습니다.\n" +
									"확인하여 주십시요.");
					me_PRICE.setFocus();
					return false;     
				}
				
				if (numFormat(ds_listInput.getColumn(ds_listInput.rowposition, "QTY"))== "0"){
		
					g_Message("EE", "식수가 누락되었습니다.\n" +
									"확인하여 주십시요.");
					me_QTY.setFocus();
					return false;     
				}	
							
				if (
				    (ds_listInput.getColumn(ds_listInput.rowposition, "PRICE") <= 10) &&
				    (ds_listInput.getColumn(ds_listInput.rowposition, "QTY")   >  1000)
				   )
				{
		
					g_Message("EE", "단가와 식수 설정이 비정상적입니다.n" +
									"확인하여 주십시요.");
					me_PRICE.setFocus();
					return false;     
				}							
			}	
				
			if (toNumber(numFormat(ds_listInput.getColumn(ds_listInput.rowposition, "AMT"))) <= 0){
	
				g_Message("EE", "금액이 누락되었습니다.\n" +
								"확인하여 주십시요.");
				me_AMT.setFocus();
				return false;     
			}				
			
	
			if (gfn_length(ds_listInput.getColumn(ds_listInput.rowposition, "TRX_DESC"))== 0){
				
				//alert(ds_listInput.GetColumn(ds_listInput.row, "TRX_DESC"));
				g_Message("EE", "적요가 누락되었습니다.\n" +
				                "확인하여 주십시요.");
                edt_TRX_DESC.setFocus();
				return false;                
			}			
		
		
			if (ds_Type.getColumn(0, "ADITEM1_CHK_YN") == "R"){
	
				if (gfn_length(ds_listInput.getColumn(ds_listInput.rowposition, "ADITEM1"))== 0){
		
					g_Message("EE", "식구분이 누락되었습니다.\n" +
									"확인하여 주십시요.");
					edt_ADITEM1.setFocus();
					return false;     
				}
			}		
		
		

		    // 입금액 비교 작업 시작 ###################################################
		    var real_TrxAmt = ds_listInput.getColumn(ds_listInput.rowposition, "AMT");
		    var real_JANAMT = 0;
			var real_ExcAmt = 0;
				
			if (ds_Type.getColumn(0, "CMP_CLASS") != "N"){			
				
	            real_JANAMT = fn_GetBalance(ds_cond, 
											ds_listInput.getColumn(ds_listInput.rowposition, "UPJANG"), 
											ds_listInput.getColumn(ds_listInput.rowposition, "TRX_ID"), 
											ds_listInput.getColumn(ds_listInput.rowposition, "TRX_DATE"), 											
											ds_Type.getColumn(0, "CMP_CLASS"), 
											ds_Type.getColumn(0, "CMP_GRP"), 
											ds_Type.getColumn(0, "CMP_TYPE"), 
											ds_Type.getColumn(0, "CMP_ACCTCD"), 
											ds_Type.getColumn(0, "ALL_YN"), 											
											ds_listInput.getColumn(ds_listInput.rowposition, "CUSTCD"), 
											ds_listInput.getColumn(ds_listInput.rowposition, "SUBINV_CODE"));
											
				
				//alert(real_TrxAmt);
				//alert(real_JANAMT);
				
				real_ExcAmt = real_TrxAmt - real_JANAMT;
				if (
				    (real_ExcAmt > 0) && //초과금액
				    (ds_Type.getColumn(0, "CMP_SPLS_YN") == "N") //초과금액처리여부
				   )
				{
		
					g_Message("EE", "매출액이 입금액을 초과했습니다.\n" +
									"확인하여 주십시요.");
					me_AMT.setFocus();
					return false;     
				}
				
				// 초과금액 비교 후 매출액 다시 설정.
				if (real_ExcAmt > 0)
				{
					real_TrxAmt = real_TrxAmt - real_ExcAmt; 
				}
				

				if (real_TrxAmt < 0)
			    {
					g_Message("EE", "매출액이 -일수는 없습니다.\n" +
									"확인하여 주십시요.");
					me_AMT.setFocus();
					return false;   		    			    
			    }
			    
			    //alert(real_JANAMT);
				if (real_JANAMT > 0)
				{
				
					//자동비교여부가 'N'일 경우 입금비교 팝업창을 띄운다.
					if (ds_Type.getColumn(0, "CMP_AUTO_YN") == "N")
					{
						
						if(!fn_OpenLineWindow(ds_listInput.getColumn(ds_listInput.rowposition, "TRX_ID"), real_TrxAmt)) return false;
					}
					//자동비교일경우 입금내역에 대해 자동으로 라인저장
					else {
										
						if(!fn_InsertAutoLine(ds_listInput.getColumn(ds_listInput.rowposition, "TRX_ID"), real_TrxAmt)) return false;
					}				
				}
				
				//초과금액을 처리해야 하는경우
				if (
				    (real_ExcAmt > 0) &&
				    (ds_Type.getColumn(0, "CMP_SPLS_YN") == "Y")
				   )
				{

					if(!fn_SaveExcTrxData(real_ExcAmt)) return false;					
				}				
				
			}
			// 입금액 비교 작업 시작 ###################################################						
			
			
			
			//식권관리유형일 경우 식권비교 팝업창을 띄운다.#########################
			if (ds_Type.getColumn(0, "TCK_YN") == "Y"){
	
				if(!fn_OpenTicketLineWindow("INSERT", ds_listInput.getColumn(ds_listInput.rowposition, "QTY"))) return false;
			}	
			//식권관리유형일 경우 식권비교 팝업창을 띄운다.#########################
						
						
			//TRX_ID 지정#################################################################
            if (
					(real_TrxAmt > 0)||
					(
						(real_ExcAmt > 0) &&
						(ds_Type.getColumn(0, "CMP_SPLS_YN") == "Y")
					)
               )               
			{
				if(!fn_SaveTrxData(ds_listInput.getColumn(ds_listInput.rowposition, "TRX_ID"))) return false;
			}


		}			

        
		//저장#############################################################
	    if (str_Gubun == "Master"){


		    //입금액 비교 작업 시작 ###############################저장전 중복확인
		    var real_TrxAmt = ds_listInput.getColumn(ds_listInput.rowposition, "AMT");
			var real_JANAMT = 0;
			var real_ExcAmt = 0;		    
			
			if (ds_Type.getColumn(0, "CMP_CLASS") != "N"){
				

	            real_JANAMT = fn_GetBalance(ds_cond, 
											ds_listInput.getColumn(ds_listInput.rowposition, "UPJANG"), 
											ds_listInput.getColumn(ds_listInput.rowposition, "TRX_ID"), 
											ds_listInput.getColumn(ds_listInput.rowposition, "TRX_DATE"), 											
											ds_Type.getColumn(0, "CMP_CLASS"), 
											ds_Type.getColumn(0, "CMP_GRP"), 
											ds_Type.getColumn(0, "CMP_TYPE"), 
											ds_Type.getColumn(0, "CMP_ACCTCD"), 
											ds_Type.getColumn(0, "ALL_YN"), 											
											ds_listInput.getColumn(ds_listInput.rowposition, "CUSTCD"), 
											ds_listInput.getColumn(ds_listInput.rowposition, "SUBINV_CODE"));
											
				real_ExcAmt = real_TrxAmt - real_JANAMT;
				if (
				    (real_ExcAmt > 0) && //초과금액
				    (ds_Type.getColumn(0, "CMP_SPLS_YN") == "N") //초과금액처리여부
				   )
				{
		
					g_Message("EE", "매출액이 입금액을 초과했습니다.\n" +
									"확인하여 주십시요.");
					me_AMT.setFocus();
					return false;     
				}
				
				// 초과금액 비교 후 매출액 다시 설정.
				if (real_ExcAmt > 0)
				{
					real_TrxAmt = real_TrxAmt - real_ExcAmt; 
				}
				
				if (real_TrxAmt < 0)
			    {
					g_Message("EE", "매출액이 -일수는 없습니다.\n" +
									"확인하여 주십시요.");
					me_AMT.setFocus();
					return false;   		    			    
			    }
			}
			//입금액 비교 작업 시작 ###############################저장전 중복확인
			
			
			//각 구분별 대체 마감체크##############################저장전 중복확인
            if (
                 (ds_listInput.rowcount > 0) &&
                 (numFormat(f_Saved_ID)!= "0")
               )
            {			
				if (!fn_GetALT_CLOSE(ds_cond, ds_listInput.getColumn(ds_listInput.rowposition, "TRX_ID"), ds_listInput.getColumn(ds_listInput.rowposition, "DR_ACCTCD"))) return false;
			}
			//각 구분별 대체 마감체크##############################저장전 중복확인
			
			
			//대체잔액체크##########################################저장전 중복확인
			if (ds_MAS_TRX_LINE.rowcount > 0){
				if (!fn_GetBalanceLine(ds_cond, ds_MAS_TRX_LINE, "입금잔액체크"))
					return false;   
	        }    
			//대체잔액체크##########################################저장전 중복확인			
			
			
			//식권잔액체크##########################################저장전 중복확인
			if (ds_MAS_TICKET_MST.rowcount > 0){
			    
			    var real_MAS_TICKET_MST_GROUP_S;
			    			
				real_MAS_TICKET_MST_GROUP_S = fn_GetMAS_TICKET_MST_GROUP_S(ds_cond);
								
				for (i=0;i<ds_MAS_TICKET_MST.rowcount;i++){
					
					ds_MAS_TICKET_MST.setColumn(i, "TICKET_GROUP_SEQ", real_MAS_TICKET_MST_GROUP_S);			
					ds_MAS_TICKET_MST.setColumn(i, "TRX_ID", ds_listInput.getColumn(ds_listInput.rowposition, "TRX_ID"));
					ds_MAS_TICKET_MST.setColumn(i, "TRX_DATE", ds_listInput.getColumn(ds_listInput.rowposition, "TRX_DATE"));					
					ds_MAS_TICKET_MST.setColumn(i, "TRX_DESC", ds_listInput.getColumn(ds_listInput.rowposition, "TRX_DESC"));					
				}
				
				if (!fn_GetBalanceLine(ds_cond, ds_MAS_TICKET_MST, "식권회수잔액체크"))
					return false;   				
				
				ds_listInput.setColumn(ds_listInput.rowposition, "TCK_WTD_SEQ", real_MAS_TICKET_MST_GROUP_S);	
	        }    
			//식권잔액체크##########################################저장전 중복확인			
			
			
			
			// action 정보 초기화
			fsp_clear(this);	  		
										    		        
	    
            //기존 라인 및 매출 데이터 삭제.            
            if (
                 (ds_listInput.rowcount > 0) &&
                 (numFormat(f_Saved_ID)!= "0")
               )
            {
  
			    fsp_addSingle(this, "ma/mas:MAS10080E_D003");
				fsp_addSingle(this, "ma/mas:MAS10080E_D002");
				fsp_addSingle(this, "ma/mas:MAS10080E_D001");
            }   
            
            
       

            //매출 저장
            if (real_TrxAmt > 0){
            
				ds_listInput.setColumn(ds_listInput.rowposition, "AMT", real_TrxAmt);
				fsp_addSingle(this, "ma/mas:MAS10080E_I001");
            }                  		
			
            //자동비교여부가 'N'일 경우 입금비교 팝업창
            if (ds_MAS_TRX_LINE.rowcount > 0){
            
				fsp_addMulti(this, "ma/mas:MAS10080E_I002");
            }
            
            //자동비교일경우 입금내역에 대해 자동으로 라인저장
            //alert(ds_listInput_AutoLine.SaveXML());
            if (ds_listInput_AutoLine.rowcount > 0){
          
			    ds_listInput_AutoLine.setColumn(ds_listInput_AutoLine.rowposition, "ID", ds_listInput.getColumn(ds_listInput.rowposition, "TRX_ID"));
				fsp_addSingle(this, "ma/mas:MAS10080E_I003");
            }      
                  			
            //초과금액을 처리해야 하는경우
            if (ds_listInput_Exc.rowcount > 0){
            
				ds_listInput_Exc.setColumn(ds_listInput_Exc.rowposition, "PARENT_ID", ds_listInput.getColumn(ds_listInput.rowposition, "TRX_ID"));
				fsp_addSingle(this, "ma/mas:MAS10080E_I004");
            }     
                              			
            //식권관리유형일 경우 식권비교 팝업창
            if (ds_MAS_TICKET_MST.rowcount > 0){
                				
				fsp_addMulti(this, "ma/mas:MAS10080E_I005");
            }   	            			
			
			f_Saved_ID = ds_listInput.getColumn(ds_listInput.rowposition, "TRX_ID");

			//TRX실행
			//http.Sync = true; //저장을 반드시 싱크로 저장해야 일괄등록 시 저장완료 후에 다음 자료가 순차적으로 저장될 수 있다.(안그러면 잔액체크 못함)
			//싱크방식으로 할 경우 개별등록 할때 저장 후에 커서가 매출유형으로 안가고 창고로 간다. 이유불명으로 일단 배치일 경우만 싱크로 설정.
			if (f_BatchJob) http.Sync = true;
			fsp_callService(this, "", "", "ds_cond=ds_listInput:A ds_listInput_Exc=ds_listInput_Exc:A ds_listInput_AutoLine=ds_listInput_AutoLine:A ds_MAS_TRX_LINE=ds_MAS_TRX_LINE:A ds_MAS_TICKET_MST=ds_MAS_TICKET_MST:A", "ds_listInput_AutoLineReturn=ds_listInput_AutoLineReturn",  "", "fn_AfterSaveSearch()");
			//
		}

		return true;
}


function fn_AfterSaveSearch(errCode, errMsg)
{
	if (errCode != 0){
		
		g_Message("EE");		
		return;
	}
		

	fn_search();	
	fn_insert();

	http.Sync = true;
	if (chk_Auto.value == "0") ds_list.rowposition = ds_list.findRowExpr("TRX_ID==" + f_Saved_ID);
	http.Sync = false;
	/*
	for(i=0;i<ds_list.rowcount;i++){
	
		if (f_Saved_ID == ds_list.GetColumn(i, "TRX_ID")){
					
			ds_list.row = i;
		}
	}
	*/
	
}

/*
 ******************************************************************************************
 * 함  수  명   : Common_Btn_common_OnClick
 * 입      력   : obj  = Form Component
 * 반      환   : 없음
 * 기      능   : 
 * 작  성  자   : 구종화
 * 작성  일자   : 2007-11-16
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */

//=========================================================================================
// [ PART 6 ]
// component Event 정의 ( User Define function )
// --> component Event의 기요,기능,동작 등 상세내용은 MiPlatform 메뉴얼을 참조하시기 바랍니다.
//=========================================================================================
function edt_UPJANGQuery_OnKeyDown(obj:Edit, e:KeyEventInfo)
{
	gfn_formKeyDown(obj,e);	
			
	if (e.keycode == 46){
			
		if (obj.name == "edt_UPJANGQuery"){
				
			fn_DataSetAllClear();				
		}		
	}
}


function fn_DataSetAllClear()
{

	ds_list.clearData();	

	ds_listInput.clearData();	
	
	ds_Type.clearData();	
	
	//자동비교여부가 'N'일 경우 입금비교 팝업창을 띄운다.
	ds_MAS_TRX_LINE.clearData();		
	
	//자동비교일경우 입금내역에 대해 자동으로 라인저장여부
	ds_listInput_AutoLine.clearData();
	ds_listInput_AutoLineReturn.clearData();
	
	//초과금액을 처리해야 하는경우
	ds_listInput_Exc.clearData();
	
	//식권관리유형일 경우 식권비교 팝업창을 띄운다.
	ds_MAS_TICKET_MST.clearData();

}	



function edtBtn_Date_OnClick(obj:Button, e:ClickEventInfo)
{
	g_CalButton_OnClick(obj)
	
	fn_DataSetAllClear();	
}


function edtBtn_UPJANGQuery_OnClick(obj:Button, e:ClickEventInfo)
{
    
	fn_edtBtn_OnClick(obj);
	fn_DataSetAllClear();		
}

function grid_List_OnHeadClick(obj:Grid, e:GridClickEventInfo)
{
	
	
	if (obj.getCellProperty("head",e.cell,"backgroundimage") == "ico_Excel"){
		gfn_exportExcel(obj, this.titletext);
	}
	else {
	
		gfn_gridSort(obj, e); //(eval(obj.binddataset), obj, e.cell);	
		fn_ds_list_OnRowPosChanged(obj,-1,0);	
	}
	//obj.ExportExcel(this.Title, , False);	
}

function me_TRX_DATE_OnChanged(obj:MaskEdit, e:TextChangedEventInfo)
{

	fn_DataSetAllClear();	
}


function edtBtn_TRX_TYPE_OnClick(obj:Button, e:ClickEventInfo)
{   

	if (numFormat(ds_listInput.getColumn(ds_listInput.rowposition, "UPJANG"))== "0") return;

	var str_Where = "";
/*    
    //매출유형####################################################################################
    if (obj.id == "edtBtn_TRX_TYPE"){	
		
		str_Where += "  AND (A.TYPE_TYPE = 'T') AND  (V.UPJANG = " + edt_UPJANGQuery.UserData + ") AND (V.USE_YN = 'Y')  ";
    }
    
    //창고코드####################################################################################
    if (obj.id == "edtBtn_SUBINV_CODE"){	
		
		str_Where += " AND  (UPJANG = " + edt_UPJANGQuery.UserData + ")";
		
		//식재료매출일경우 식재료 창고만 뜬다.
		if (ds_Type.GetColumn(0, "CR_ACCTCD") == "4010221"){
			
			str_Where += "  AND (SUBINV_CODE LIKE 'C%')";
		}	
        
        //매점상품매출 일 경우 매점창고만 뜨게 한다.
		else if (ds_Type.GetColumn(0, "CR_ACCTCD") == "4010233")
		{
			
			str_Where += "  AND (SUBINV_CODE LIKE 'A20%')";
		}
		
        //상품 매출일 경우 일반상품원가 해당창고만 뜨게 한다.
		else if (ds_Type.GetColumn(0, "CR_ACCTCD") == "4010231")
		{
			
			str_Where += "  AND (EXPENSE_ACCTCD = '4020211')";
		}		
		
        //상품매출(유류) 혹은 휴게소상품매출 일 경우 해당창고만 뜨게 한다.
		else if (
		         (ds_Type.GetColumn(0, "CR_ACCTCD") == "4010234") ||
		         (ds_Type.GetColumn(0, "CR_ACCTCD") == "4010235")
		        )
		{
			if (ds_Type.GetColumn(0, "CR_ACCTCD") == "4010234"){ //상품매출(유류)
				
				str_Where += "  AND (EXPENSE_ACCTCD = '4020215')";
			}
			else if (ds_Type.GetColumn(0, "CR_ACCTCD") == "4010235"){ //휴게소상품매출
				
				str_Where += "  AND (EXPENSE_ACCTCD = '4020216')";
			}
		}		
		else {		
		
		}		      
    }   
     
    //고객사코드####################################################################################
    if (obj.id == "edtBtn_CUSTCD"){	
		
		str_Where += " AND  (A.UPJANG = " + edt_UPJANGQuery.UserData + ") AND (A.USE_YN = 'Y') ";			
    }         
*/
	str_Where = getAddWhere(obj);
	
	fn_edtBtn_OnClick(obj, str_Where);

    if (gfn_length(eval("edt_" + gfn_subStr(obj.name, 7)).userdata)!= 0)
	ds_listInput.setColumn(ds_listInput.rowposition, gfn_subStr(obj.name, 7), eval("edt_" + gfn_subStr(obj.name, 7)).userdata);	
			    		
}

function getAddWhere(obj)
{
	var str_Where = "";
    //매출유형####################################################################################
    if (obj.name == "edtBtn_TRX_TYPE"){	
		
		str_Where += "  AND (A.TYPE_TYPE = 'T') AND  (V.UPJANG = " + edt_UPJANGQuery.userdata + ") AND (V.USE_YN = 'Y')  ";
    }
    
    //창고코드####################################################################################
    if (obj.name == "edtBtn_SUBINV_CODE"){	
		
		str_Where += " AND  (UPJANG = " + edt_UPJANGQuery.userdata + ")";
		
		//식재료매출일경우 식재료 창고만 뜬다.
		if (ds_Type.getColumn(0, "CR_ACCTCD") == "4010221"){
			
			str_Where += "  AND (SUBINV_CODE LIKE 'C%')";
		}	
        
        //매점상품매출 일 경우 매점창고만 뜨게 한다.
		else if (ds_Type.getColumn(0, "CR_ACCTCD") == "4010233")
		{
			
			str_Where += "  AND (SUBINV_CODE LIKE 'A20%')";
		}
		
        //상품 매출일 경우 일반상품원가 해당창고만 뜨게 한다.
		else if (ds_Type.getColumn(0, "CR_ACCTCD") == "4010231")
		{
			
			str_Where += "  AND (EXPENSE_ACCTCD = '4020211')";
		}		
		
        //상품매출(유류) 혹은 휴게소상품매출 일 경우 해당창고만 뜨게 한다.
		else if (
		         (ds_Type.getColumn(0, "CR_ACCTCD") == "4010234") ||
		         (ds_Type.getColumn(0, "CR_ACCTCD") == "4010235")
		        )
		{
			if (ds_Type.getColumn(0, "CR_ACCTCD") == "4010234"){ //상품매출(유류)
				
				str_Where += "  AND (EXPENSE_ACCTCD = '4020215')";
			}
			else if (ds_Type.getColumn(0, "CR_ACCTCD") == "4010235"){ //휴게소상품매출
				
				str_Where += "  AND (EXPENSE_ACCTCD = '4020216')";
			}
		}		
		else {		
		
		}		      
    }   
     
    //고객사코드####################################################################################
    if (obj.name == "edtBtn_CUSTCD"){	
		
		str_Where += " AND  (A.UPJANG = " + edt_UPJANGQuery.userdata + ") AND (A.USE_YN = 'Y') ";			
    }         

	return str_Where;
}

function edt_TRX_TYPE_OnKeyDown(obj:Edit, e:KeyEventInfo)
{
	fn_edt_OnKeyDown(obj,e.keycode);	
	
	if (e.keycode == 46)
	ds_listInput.setColumn(ds_listInput.rowposition, gfn_subStr(obj.name, 4), "");			
}



function ds_list_OnRowPosChanged(obj:Dataset, e:DSRowPosChangeEventInfo)
{
	fn_ds_list_OnRowPosChanged(obj, e.oldrow, e.newrow);
}

function fn_ds_list_OnRowPosChanged(obj, nOldRow, nNewRow)
{
    if (ds_list.rowcount == 0) return;
    
	ds_listInput.clearData();
	var row = ds_listInput.addRow();
	ds_listInput.copyRow(row, ds_list, nNewRow);
	ds_listInput.applyChange();

	//edtBtn Component 복사############################
	Set_edtBtn_UserData("Clear");
	Set_edtBtn_UserData("Copy");
	
	ds_listInput.setColumn(ds_listInput.rowposition, "UPJANG", edt_UPJANGQuery.userdata);	   
	ds_listInput.setColumn(ds_listInput.rowposition, "UPJANGNM", edt_UPJANGQuery.value);
	ds_listInput.setColumn(ds_listInput.rowposition, "TRX_DATE", me_TRX_DATE.value);	
	//edtBtn Component 복사############################
	
	
	Setds_listInput_OnColumnChanged();
	//edt_TYPE_CD.Enable        = False;

	//edt_TYPE_NAME.SetFocus();
}

//edtBtn Component 세팅/초기화####################################################################
function Set_edtBtn_UserData(str_Gubun)
{

	if (str_Gubun == "Copy"){

		//edtBtn Component 초기화############################  		 
		for (i=0;i<components.length;i++){
							
			if (
				(gfn_subStr(components[i].name, 0, 3)== "st_") &&
				(gfn_subStr(components[i].userdata, 0, 10)== "strMAQuery")
			   )	
			{

			    if (gfn_length(eval("edt_" + gfn_subStr(components[i].name, 3)).Column)!= 0)
				eval("edt_" + gfn_subStr(components[i].name, 3)).userdata = ds_listInput.getColumn(ds_listInput.rowposition, gfn_subStr(components[i].name, 3));
			}
		}		 
		//edtBtn Component 초기화############################
	}
	else if (str_Gubun == "Clear"){

		//edtBtn Component 초기화############################
		for (i=0;i<components.length;i++){
				
				
			if (
				(gfn_subStr(components[i].name, 0, 3)== "st_") &&
				(gfn_subStr(components[i].userdata, 0, 10)== "strMAQuery")
			   )	
			{
				if (gfn_length(components[i].Column)!= 0)
				eval("edt_" + gfn_subStr(components[i].name, 3)).userdata = "";
			}
		}  
		//edtBtn Component 초기화############################
	}
}

function Setds_listInput_OnColumnChanged()
{

	fn_ds_listInput_OnColumnChanged(ds_listInput,0,"TRX_TYPE","",ds_listInput.getColumn(ds_listInput.rowposition, "TRX_TYPE"),0);
	fn_ds_listInput_OnColumnChanged(ds_listInput,0,"SUBINV_CODE","",ds_listInput.getColumn(ds_listInput.rowposition, "SUBINV_CODE"),0);
	/*
	fn_ds_listInput_OnColumnChanged(ds_listInput,0,"BIZ_CHK_YN","",ds_listInput.GetColumn(ds_listInput.row, "BIZ_CHK_YN"),0);
	fn_ds_listInput_OnColumnChanged(ds_listInput,0,"FEE_REG_YN","",ds_listInput.GetColumn(ds_listInput.row, "FEE_REG_YN"),0);
	fn_ds_listInput_OnColumnChanged(ds_listInput,0,"ADITEM1_CHK_YN","",ds_listInput.GetColumn(ds_listInput.row, "ADITEM1_CHK_YN"),0);
	fn_ds_listInput_OnColumnChanged(ds_listInput,0,"ADITEM2_CHK_YN","",ds_listInput.GetColumn(ds_listInput.row, "ADITEM2_CHK_YN"),0);
	*/
}

function ds_listInput_OnColumnChanged(obj:Dataset, e:DSColChangeEventInfo)
{
	fn_ds_listInput_OnColumnChanged(obj, e.row, e.columnid, e.oldvalue, e.newvalue, -1);
}

function fn_ds_listInput_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
{
	var F_ArrCol          = new Array(-1);
	var F_ArrColType      = new Array(-1);
	
	if (strColumnID == "TRX_TYPE"){
	
		//alert(ds_list.GetRowType(ds_list.row));
		//Combo DATASET Composition#########################
		F_ArrCol = [];
		
		F_ArrCol[0]     = "TYPE_CD";		
		F_ArrColType[0] = "STRING";
		
	    frm_InitSearchDS(ds_cond, ds_Type, F_ArrCol, F_ArrColType, "TYPE_CD", ds_listInput.getColumn(ds_listInput.rowposition, "TRX_TYPE"), "ma/mae:MAE10020E_S001");	
	  
	    
		edt_SUBINV_CODE.enable    = false;
		edtBtn_SUBINV_CODE.enable = false;
		
		edt_CUSTCD.enable      = false;
		edtBtn_CUSTCD.enable   = false;
		
		me_AMT.enable    = true;
		
		edt_ADITEM1.enable    = false;
		edtBtn_ADITEM1.enable = false;
	
						
	    if (nPivotIndex == -1){
	
			ds_listInput.setColumn(ds_listInput.rowposition, "SUBINV_CODE", "");
			ds_listInput.setColumn(ds_listInput.rowposition, "SUBINV_CODENM", "");
			ds_listInput.setColumn(ds_listInput.rowposition, "CUSTCD", "");
			ds_listInput.setColumn(ds_listInput.rowposition, "CUSTCDNM", "");			
			ds_listInput.setColumn(ds_listInput.rowposition, "PRICE", "");
			ds_listInput.setColumn(ds_listInput.rowposition, "QTY", "");
			ds_listInput.setColumn(ds_listInput.rowposition, "AMT", "");
			ds_listInput.setColumn(ds_listInput.rowposition, "TAX_KIND", "");
			ds_listInput.setColumn(ds_listInput.rowposition, "TAX_KINDNM", "");
			ds_listInput.setColumn(ds_listInput.rowposition, "TRX_DESC", "");
			ds_listInput.setColumn(ds_listInput.rowposition, "ADITEM1", "");
			ds_listInput.setColumn(ds_listInput.rowposition, "ADITEM1NM", "");
			ds_listInput.setColumn(ds_listInput.rowposition, "TCK_WTD_SEQ", "");	
					
            if (gfn_length(varNewValue)== 0) ds_Type.clearData();					
		}
		
		if (ds_Type.getColumn(0, "SUBINV_CHK_YN") == "R"){
		
			edt_SUBINV_CODE.enable    = true;
			edtBtn_SUBINV_CODE.enable = true;
		}
		
		if (ds_Type.getColumn(0, "SUBINV_CHK_YN") == "O"){
		
			edt_SUBINV_CODE.enable    = true;
			edtBtn_SUBINV_CODE.enable = true;
		}		
		
		if (ds_Type.getColumn(0, "CUST_CHK_YN") == "R"){
		
			edt_CUSTCD.enable      = true;
			edtBtn_CUSTCD.enable   = true;
		}
						
		if (ds_Type.getColumn(0, "CUST_CHK_YN") == "O"){
		
			edt_CUSTCD.enable      = true;
			edtBtn_CUSTCD.enable   = true;
		}
								
								
		if (ds_Type.getColumn(0, "AUTO_AMT_YN") == "Y"){
		
			me_AMT.enable    = false;
		}
										
		if (ds_Type.getColumn(0, "ADITEM1_CHK_YN") == "R"){
		
			edt_ADITEM1.enable    = true;
			edtBtn_ADITEM1.enable = true;
		}
												
		if (ds_Type.getColumn(0, "ADITEM1_CHK_YN") == "O"){
		
			edt_ADITEM1.enable    = true;
			edtBtn_ADITEM1.enable = true;
		}				
			
	
	    if (
	        (nRow >= 0) &&
	        (ds_Type.rowcount > 0)
	       )
	    {
			             
			ds_listInput.setColumn(nRow, "DR_ACCTCD", ds_Type.getColumn(ds_Type.rowposition, "DR_ACCTCD"));
			ds_listInput.setColumn(nRow, "CR_ACCTCD", ds_Type.getColumn(ds_Type.rowposition, "CR_ACCTCD"));			
		}	
				
		             
	}

	if (strColumnID == "SUBINV_CODE"){
	
		F_ArrCol = [];
		
		F_ArrCol[0]     = "SUBINV_CODE";		
		F_ArrColType[0] = "STRING";
		
	    frm_InitSearchDS(ds_cond, ds_cond, F_ArrCol, F_ArrColType, "SUBINV_CODE", ds_listInput.getColumn(ds_listInput.rowposition, "SUBINV_CODE"), "ma/mas:MAS10080E_S002");	

	
		edt_TAX_KIND.enable    = false;
		edtBtn_TAX_KIND.enable = false;
	    

		if (ds_listInput.getColumn(ds_listInput.rowposition, "TRX_TYPE") != "T018"){
		
		    //불공제창고일경우 면세처리#########################################
			if (ds_cond.getColumn(0, "OUTVAT_FLAG") == "Y"){
			
				edt_TAX_KIND.userdata = "410";
				edt_TAX_KIND.value     = "면세";	
							
                ds_listInput.setColumn(ds_listInput.rowposition, "TAX_KIND", edt_TAX_KIND.userdata);							
			}
			//불공제창고일경우 면세처리#########################################
			
			
			//불공제창고가 아니면서 식재료창고이면 과세처리###################
			else {
			
				if (gfn_subStr(ds_listInput.getColumn(ds_listInput.rowposition, "SUBINV_CODE"), 0, 1)== "C"){
				
					edt_TAX_KIND.userdata = "310";
					edt_TAX_KIND.value     = "과세";		
							
					ds_listInput.setColumn(ds_listInput.rowposition, "TAX_KIND", edt_TAX_KIND.userdata);	
				}	
				else {
				
					edt_TAX_KIND.enable    = true;
					edtBtn_TAX_KIND.enable = true;				
				}
			}
			//불공제창고가 아니면서 식재료창고이면 과세처리###################
			
		}
		// 고객사에 식재료 영업행위를 하는 경우
        // 사용자가 과/면세를 선택할 수 있도록 한다.
		else {

			edt_TAX_KIND.enable    = true;
			edtBtn_TAX_KIND.enable = true;
		}
	

	}
		
	if (strColumnID == "PRICE"){
		    		
		me_AMT.value = Math.round(ds_listInput.getColumn(ds_listInput.rowposition, "PRICE") * ds_listInput.getColumn(ds_listInput.rowposition, "QTY"));
	}	
	
	if (strColumnID == "QTY"){
	
		me_AMT.value = Math.round(ds_listInput.getColumn(ds_listInput.rowposition, "PRICE") * ds_listInput.getColumn(ds_listInput.rowposition, "QTY"));
	}	
	
	edtBtn_TCK_WTD_SEQ.enable = false;
	if (numFormat(ds_listInput.getColumn(ds_listInput.rowposition, "TRX_ID"))!= "0"){
	
		edt_TRX_TYPE.enable       = false;
		edtBtn_TRX_TYPE.enable    = false;
		
		edt_SUBINV_CODE.enable    = false;
		edtBtn_SUBINV_CODE.enable = false;
		
		edt_CUSTCD.enable      = false;
		edtBtn_CUSTCD.enable   = false;
		
					
		if (numFormat(ds_listInput.getColumn(ds_listInput.rowposition, "TCK_WTD_SEQ"))!= "0")
		edtBtn_TCK_WTD_SEQ.enable = true;	
	}
	
    fn_ImportantImgSetting(this);
    
    //단가, 식수 선택요소 이미지 세팅#######################
    //img_imp_me_PRICE.visible = false;
    me_PRICE.class = "";
    //img_imp_me_QTY.visible   = false;
    me_QTY.class = "";
    
    if (ds_Type.getColumn(0, "AUTO_AMT_YN") == "Y"){
		//img_imp_me_PRICE.visible = true;
		me_PRICE.class = "msk_WF_Essential";
		//img_imp_me_QTY.visible   = true;    
		me_QTY.class = "msk_WF_Essential";
    }
    //단가, 식수 선택요소 이미지 세팅#######################
}

//각 구분별 대체마감체크############################################################
function fn_GetALT_CLOSE(objOutDs, real_TRX_ID, str_DR_ACCTCD)
{

    //대체마감체크#####################################################################
    var str_CloseErr = "";
    
    objOutDs.clear();
    objOutDs.addColumn("RCP_YN","STRING",256);	       
    objOutDs.addColumn("SUBST_YN","STRING",256);	       
    objOutDs.addColumn("BIL_YN","STRING",256);	      
    objOutDs.addColumn("AUTO_YN","STRING",256);	         
    objOutDs.addColumn("CLS_YN","STRING",256);	 
    
    objOutDs.addColumn("TICKET_YN","STRING",256);
    
	// action 정보 초기화 
    fsp_clear(this);  
	
    // 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "ma/mas:MAS10080E_S004");
	
	f_AfterCallServerCheck = true;
	
	// 서버 호출 
	http.Sync = true;
	fsp_callService(this, "", "", "", objOutDs.name + "=ds_list","TRX_ID=" + real_TRX_ID + 
															   " DR_ACCTCD=" + wrapQuote(str_DR_ACCTCD)
	                                                           ,"fn_AfterCallServiceCheck()");	
	http.Sync = false;
	
    if (!f_AfterCallServerCheck) return false;

	if (objOutDs.getColumn(objOutDs.rowposition, "RCP_YN") == "Y")   str_CloseErr = "매출액의 일부 혹은 전부가\n입금되었으므로\n수정/삭제할 수 없습니다.";

	if (objOutDs.getColumn(objOutDs.rowposition, "SUBST_YN") == "Y") str_CloseErr = "영업대체된 데이터는\n수정/삭제할 수 없습니다.";				

	if (objOutDs.getColumn(objOutDs.rowposition, "BIL_YN") == "Y")   str_CloseErr = "(세금)계산서가 발행된 데이터는\n수정/삭제할 수 없습니다.";			    

	if (objOutDs.getColumn(objOutDs.rowposition, "AUTO_YN") == "Y")  str_CloseErr = "자동등록된 데이터는\n수정/삭제할 수 없습니다.\n해당 화면에서 취소하신후 다시 작업\n하여주십시요.";			    
			                          	
	if (objOutDs.getColumn(objOutDs.rowposition, "CLS_YN") == "Y")   str_CloseErr = "마감된 데이터는\n수정/삭제할 수 없습니다.";				
	
	if (objOutDs.getColumn(objOutDs.rowposition, "TICKET_YN") == "Y") str_CloseErr = "해당매출 이후에 해당식권의 회수폐기가\n발생하였으므로\n수정/삭제할 수 없습니다.";
	
	if (gfn_length(str_CloseErr )!= 0){
	
		g_Message("EE", str_CloseErr + "\n" +
						"확인하여 주십시요.");			 
		return false;        
	}

	return true;
	//대체마감체크#####################################################################
 
}			 
//각 구분별 대체마감체크############################################################
			 
			 

/*
 ******************************************************************************************
 * 함  수  명   : fn_GetBalance
 * 입      력   : real_UPJANG : 업장코드
	              str_DATE : 일자
	             
 * 반      환   :  값 리턴
 * 기      능   : 영업잔액체크
 * 작  성  자   : 황승한
 * 작성  일자   : 2007-11-28
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
*/
function fn_GetBalance(objOutDs, real_UPJANG, real_ID, str_DATE, str_CMP_CLASS, str_CMP_GRP, str_CMP_TYPE, str_CMP_ACCTCD, str_ALL_YN, real_CUSTCD, str_SUBINV_CODE)
{

    
    //잔액체크#####################################################################
    objOutDs.clear();
    objOutDs.addColumn("JANAMT","INT",256);	       
    
	// action 정보 초기화 
    fsp_clear(this);  
	
    // 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "ma/mas:GetMAS_GETBALANCE");
	
	//alert(str_ACCTCD);
	//alert(str_DATE_STD);
	// 서버 호출 
	http.Sync = true;
	fsp_callService(this, "", "", "", objOutDs.name + "=ds_list","V_GUBUN=" + "입금잔액체크" + 
															   " V_UPJANG=" + wrapQuote(real_UPJANG) + 
	                                                           " V_ID=" + wrapQuote(gfn_nvl(real_ID,"")) + 
	                                                           " V_DATE=" + wrapQuote(str_DATE) +
	                                                           " V_CMP_CLASS=" + wrapQuote(str_CMP_CLASS) +
	                                                           " V_CMP_GRP=" + wrapQuote(str_CMP_GRP) +
	                                                           " V_CMP_TYPE=" + wrapQuote(gfn_nvl(str_CMP_TYPE,"")) +
	                                                           " V_CMP_ACCTCD=" + wrapQuote(gfn_nvl(str_CMP_ACCTCD,"")) +
	                                                           " V_ALL_YN=" + wrapQuote(str_ALL_YN) +
	                                                           " V_CUSTCD=" + wrapQuote(real_CUSTCD) +
	                                                           " V_SUBINV_CODE=" + wrapQuote(str_SUBINV_CODE)
	                                                           ,"");	
	http.Sync = false;
	
                          	
	
	//alert(objOutDs.GetColumn(objOutDs.row, "ACCTCD_DATE") );
	return objOutDs.getColumn(objOutDs.rowposition, "JANAMT");
	//잔액체크#####################################################################
	
}



//자동비교여부가 'N'일 경우 입금비교 팝업창을 띄운다.#########################
function fn_OpenLineWindow(real_TRX_ID, real_TrxAmt)
{

    if (numFormat(ds_listInput.getColumn(ds_listInput.rowposition, "UPJANG"))== "0"){    

		g_Message("EE", "업장을 선택하여 주십시요.\n" +
						"확인하여 주십시요.");
        edt_UPJANGQuery.setFocus();
        return false;
    }
    
    if (gfn_length(ds_listInput.getColumn(ds_listInput.rowposition, "TRX_DATE"))== 0){    

		g_Message("EE", "매출일자가 선택되어 있지 않습니다.\n" +
						"확인하여 주십시요.");
        me_TRX_DATE.setFocus();
        return false;
    }    

    
	gfn_dialog("", "U_MAS::MAS10080P.xfdl", {real_TrxAmt:real_TrxAmt});
	
	//if (ds_MAS_TRX_LINE.rowcount == 0) return false;
	if (ds_MAS_TRX_LINE.rowcount == 0)
	{
		g_Message("EE", "대체할 입금이 선택되어 있지 않습니다.\n" +
						"확인하여 주십시요.");
		return false;
	}

	return true;
    
}
//자동비교여부가 'N'일 경우 입금비교 팝업창을 띄운다.#########################

//자동비교일경우 입금내역에 대해 자동으로 라인저장.###########################
function fn_InsertAutoLine(real_TRX_ID, real_TrxAmt)
{

    if (numFormat(ds_listInput.getColumn(ds_listInput.rowposition, "UPJANG"))== "0"){    

		g_Message("EE", "업장을 선택하여 주십시요.\n" +
						"확인하여 주십시요.");        
        edt_UPJANGQuery.setFocus();
        return false;
    }
    
    if (gfn_length(ds_listInput.getColumn(ds_listInput.rowposition, "TRX_DATE"))== 0){    

		g_Message("EE", "매출일자가 선택되어 있지 않습니다.\n" +
						"확인하여 주십시요."); 						       
        me_TRX_DATE.setFocus();
        return false;
    }    

    //ds_listInput_AutoLine.ClearData();
    //alert("fn_InsertAutoLine");
    ds_listInput_AutoLine.addRow();
    
    ds_listInput_AutoLine.setColumn(ds_listInput_AutoLine.rowposition, "GUBUN", "입금자동대체");
    ds_listInput_AutoLine.setColumn(ds_listInput_AutoLine.rowposition, "UPJANG", ds_listInput.getColumn(ds_listInput.rowposition, "UPJANG"));
    ds_listInput_AutoLine.setColumn(ds_listInput_AutoLine.rowposition, "ID", ds_listInput.getColumn(ds_listInput.rowposition, "TRX_ID"));
    ds_listInput_AutoLine.setColumn(ds_listInput_AutoLine.rowposition, "AMT", real_TrxAmt);
    ds_listInput_AutoLine.setColumn(ds_listInput_AutoLine.rowposition, "DATE", ds_listInput.getColumn(ds_listInput.rowposition, "TRX_DATE"));
    ds_listInput_AutoLine.setColumn(ds_listInput_AutoLine.rowposition, "CUSTCD", ds_listInput.getColumn(ds_listInput.rowposition, "CUSTCD"));
    ds_listInput_AutoLine.setColumn(ds_listInput_AutoLine.rowposition, "SUBINV_CODE", ds_listInput.getColumn(ds_listInput.rowposition, "SUBINV_CODE"));
    
    ds_listInput_AutoLine.setColumn(ds_listInput_AutoLine.rowposition, "CMP_CLASS", ds_Type.getColumn(ds_Type.rowposition, "CMP_CLASS"));
    ds_listInput_AutoLine.setColumn(ds_listInput_AutoLine.rowposition, "CMP_GRP", ds_Type.getColumn(ds_Type.rowposition, "CMP_GRP"));
    ds_listInput_AutoLine.setColumn(ds_listInput_AutoLine.rowposition, "CMP_TYPE", ds_Type.getColumn(ds_Type.rowposition, "CMP_TYPE"));
    ds_listInput_AutoLine.setColumn(ds_listInput_AutoLine.rowposition, "CMP_ACCTCD", ds_Type.getColumn(ds_Type.rowposition, "CMP_ACCTCD"));
    ds_listInput_AutoLine.setColumn(ds_listInput_AutoLine.rowposition, "ALL_YN", ds_Type.getColumn(ds_Type.rowposition, "ALL_YN"));
    ds_listInput_AutoLine.setColumn(ds_listInput_AutoLine.rowposition, "RTN", "");
    ds_listInput_AutoLine.setColumn(ds_listInput_AutoLine.rowposition, "RTNMSG", "");    
    //alert(ds_listInput_AutoLine.SaveXML());
    return true;
}
//자동비교일경우 입금내역에 대해 자동으로 라인저장.###########################








//초과금액을 처리해야 하는경우.##################################################
function fn_SaveExcTrxData(real_ExcAmt)
{

    if (numFormat(ds_listInput.getColumn(ds_listInput.rowposition, "UPJANG"))== "0"){    

		g_Message("EE", "업장을 선택하여 주십시요.\n" +
						"확인하여 주십시요.");        
        edt_UPJANGQuery.setFocus();
        return false;
    }
    
    if (gfn_length(ds_listInput.getColumn(ds_listInput.rowposition, "TRX_DATE"))== 0){    

		g_Message("EE", "매출일자가 선택되어 있지 않습니다.\n" +
						"확인하여 주십시요."); 						       
        me_TRX_DATE.setFocus();
        return false;
    }    


    Copy(ds_listInput_Exc,ds_listInput);
    
   

    if (real_ExcAmt != ds_listInput.getColumn(ds_listInput.rowposition, "AMT")){
    
		ds_listInput_Exc.setColumn(ds_listInput_Exc.rowposition, "PRICE", 0);
		ds_listInput_Exc.setColumn(ds_listInput_Exc.rowposition, "QTY", 0);
    }       
    
    ds_listInput_Exc.setColumn(ds_listInput_Exc.rowposition, "DR_ACCTCD", ds_Type.getColumn(ds_Type.rowposition, "CMP_SPLS_ACCTCD"));
    
    ds_listInput_Exc.setColumn(ds_listInput_Exc.rowposition, "AMT", real_ExcAmt);
            
    return true;
}
//초과금액을 처리해야 하는경우.##################################################




//TRX_ID 세팅#######################################################################
function fn_SaveTrxData(real_TRX_ID)
{

    if (numFormat(ds_listInput.getColumn(ds_listInput.rowposition, "UPJANG"))== "0"){    

		g_Message("EE", "업장을 선택하여 주십시요.\n" +
						"확인하여 주십시요.");        
        edt_UPJANGQuery.setFocus();
        return false;
    }
    
    if (gfn_length(ds_listInput.getColumn(ds_listInput.rowposition, "TRX_DATE"))== 0){    

		g_Message("EE", "매출일자가 선택되어 있지 않습니다.\n" +
						"확인하여 주십시요."); 						       
        me_TRX_DATE.setFocus();
        return false;
    }    

    f_Saved_ID = ds_listInput.getColumn(ds_listInput.rowposition, "TRX_ID");
    
    if (numFormat(real_TRX_ID)== "0"){
    
		ds_cond.clear();
		ds_cond.addColumn("MAS_TRX_S","INT",256);
					
		// action 정보 초기화
		fsp_clear(this);

		// 서버에서 조회할 정보 추가
		fsp_addSearch(this, "ma/mas:MAS10080E_S003");

		// 서버 호출
		http.Sync = true;
		fsp_callService(this, "", "", "", ds_cond.name + "=ds_list","","");
		http.Sync = false;
		
		real_TRX_ID = ds_cond.getColumn(ds_cond.rowposition, "MAS_TRX_S");
		ds_listInput.setColumn(ds_listInput.rowposition, "TRX_ID", real_TRX_ID);
					
		f_Saved_ID  = 0;
		f_NewDataCheck = true;
		
    }
    
		
	//수기입금 대체###########################
	for (i=0;i<ds_MAS_TRX_LINE.rowcount;i++){
		
			ds_MAS_TRX_LINE.setColumn(i, "TRX_ID", real_TRX_ID);
			ds_MAS_TRX_LINE.setColumn(i, "SOURCE_FR", "TRX");
			ds_MAS_TRX_LINE.setColumn(i, "SOURCE_TO", "RCP");
			ds_MAS_TRX_LINE.setColumn(i, "LINE_DATE", ds_listInput.getColumn(ds_listInput.rowposition, "TRX_DATE"));						
	}
	//수기입금 대체###########################   
	 
	//자동비교 대체###########################
	for (i=0;i<ds_listInput_AutoLine.rowcount;i++){
		
			ds_listInput_AutoLine.setColumn(i, "TRX_ID", real_TRX_ID);
	}
	//자동비교 대체###########################
	
  
    return true;
}
//TRX_ID 세팅#######################################################################
function edt_UPJANGQuery_OnChanged(obj:Edit, e:TextChangedEventInfo)
{
	fn_DataSetAllClear();		
}


function edt_TRX_DESC_OnKeyDown(obj:Edit, e:KeyEventInfo)
{
	if (e.keycode == 13){
				
		if (
		    (!edt_ADITEM1.enable)
		   )
		{
		    div_cmnBtn.setFocus();
			fn_save();
		}
	}	
}



function edt_ADITEM1_OnKeyDown(obj:Edit, e:KeyEventInfo)
{
    //Http.Sync = True;
	fn_edt_OnKeyDown(obj,e.keycode);	
	//Http.Sync = False;

	if (e.keycode == 13){
				
		//if (!edt_TCK_WTD_SEQ.Enable){
		
			div_cmnBtn.setFocus();
			fn_save();
		//}
	}
	
}


function grid_List_OnExpandEdit(obj:Grid, e:GridMouseEventInfo)
{ 
    var nWidth, nHeight, strStyle, nLeft, nTop ;

	if (numFormat(ds_list.getColumn(ds_list.rowposition, "TRX_ID"))== "0") return;
	
	var str_MenuIDText = "",
		str_MenuIDTextDetail = "",
		str_XMLADDRESS1 = "",
		str_XMLADDRESS2 = "",
		str_ColumnTitle = "",		
		real_TRX_ID = ds_list.getColumn(ds_list.rowposition, "TRX_ID");
		
    str_ColumnTitle = gfn_replace(gfn_replace(fn_Get_ColHeaderTitle(obj, e.cell), "▼"), "▲");	
    if (str_ColumnTitle == "입금"){
		
		str_MenuIDText = "매출-입금내역";
		str_MenuIDTextDetail = "[해당매출을입금대체]/[해당매출이입금대체]한내역";
		str_XMLADDRESS1 = "ma/mas:MAS10081P_S001";
		str_XMLADDRESS2 = "ma/mas:MAS10081P_S005";
	}
	else if (str_ColumnTitle == "대체"){
	
		str_MenuIDText = "매출-영업대체내역";
		str_MenuIDTextDetail = "[해당매출을영업대체]한내역입니다.";
		str_XMLADDRESS1 = "ma/mas:MAS10081P_S002";
		str_XMLADDRESS2 = "ma/mas:MAS10081P_S005";
	}
	else if (str_ColumnTitle == "발행"){
	
		str_MenuIDText = "매출-세금계산서발행내역";
		str_MenuIDTextDetail = "[해당매출을세금계산서발행]한내역입니다.";
		str_XMLADDRESS1 = "ma/mas:MAS10081P_S003";	
		str_XMLADDRESS2 = "NONE";
	}	
	else if (str_ColumnTitle == "자동"){
	
		str_MenuIDText = "매출-자동내역";
		str_MenuIDTextDetail = "[자동으로등록]된내역입니다.";
		str_XMLADDRESS1 = "ma/mas:MAS10081P_S004";	
		str_XMLADDRESS2 = "NONE";
	}
	
	//absolute 0 0 910 331
	
   if (
        (str_MenuIDText == "매출-입금내역") ||
        (str_MenuIDText == "입금-매출내역") ||
        (str_MenuIDText == "매출-영업대체내역") ||
        (str_MenuIDText == "입금-영업대체내역")
       )
    {   
		/* Window 객체를 지원하지 않습니다. Height은 지원되지 않는 메서드입니다.*/ //Window.Height = 620;
		
	    nWidth  = 915;
	    nHeight  = 640;
	    strStyle = "";
	    nLeft    = 0;
	    nTop     = 0;					
	} else {
	    nWidth  = 915;
	    nHeight  = 365;
	    strStyle = "";
	    nLeft    = 0;
	    nTop     = 0;
	}
	//gfn_dialog("", "U_MAS::MAS10081P.xfdl", "str_MenuIDText=" + str_MenuIDText + " str_MenuIDTextDetail=" + str_MenuIDTextDetail + " str_XMLADDRESS1=" + str_XMLADDRESS1 + " str_XMLADDRESS2=" + str_XMLADDRESS2 + " TRID=" + real_TRX_ID);	
	gfn_dialog("", "U_MAS::MAS10081P.xfdl", {str_MenuIDText:str_MenuIDText, str_MenuIDTextDetail:str_MenuIDTextDetail, str_XMLADDRESS1:str_XMLADDRESS1, str_XMLADDRESS2:str_XMLADDRESS2, TRID:real_TRX_ID},nWidth, nHeight, strStyle, nLeft, nTop);	
}




//삭제처리###########################################################################
function before_DeleteCheck(str_GUBUN)
{
	

	//권한에 따른 저장/삭제 가능체크#########################################################################
	if (
			//(g_AuthLevel != "99") &&
			(g_AuthLevel < "99") &&
			(!fn_GetSaveAuthBy_AuthLevel(ds_listInput.getColumn(ds_listInput.rowposition, "UPJANG")))
		)  return false;		    
	//권한에 따른 저장/삭제 가능체크#########################################################################
	
		
			

	if ( 
		(ds_listInput.rowcount == 0) ||
		(numFormat(ds_listInput.getColumn(ds_listInput.rowposition, "TRX_ID"))== "0") ||
		(!g_Confirm("01"))
	   )
	{

		return false;
	}
	
	//각 구분별 대체 마감체크##############################
    if (!fn_GetALT_CLOSE(ds_cond, ds_listInput.getColumn(ds_listInput.rowposition, "TRX_ID"), ds_listInput.getColumn(ds_listInput.rowposition, "DR_ACCTCD"))) return false;	
	//각 구분별 대체 마감체크##############################	        

	//마감체크###############################################
	if (!fn_CheckMAClosing(ds_cond, edt_UPJANGQuery.userdata, me_TRX_DATE.value, "001"))
		return false;                
	//마감체크###############################################


	// action 정보 초기화
	fsp_clear(this);			
	
	//기존 라인 및 매출 데이터 삭제.
	fsp_addSingle(this, "ma/mas:MAS10080E_D003");
	fsp_addSingle(this, "ma/mas:MAS10080E_D002");
	fsp_addSingle(this, "ma/mas:MAS10080E_D001");
	   
	http.Sync = true;
	fsp_callService(this, "", "", "ds_cond=ds_listInput:A",  "", "", "fn_AfterDeleteSearch()");		
	http.Sync = false;		
	
	return true;
}


function fn_AfterDeleteSearch(errCode, errMsg)
{
	if (errCode != 0){

		g_Message("EE");
		return;
	}

    g_Message("01");
    
	fn_search();
	fn_insert();

}
//삭제처리###########################################################################



//마감항목 배경색처리###############################################################
function fn_GetBackColorClose(ColorGubun, YN)
{

   	if (YN == "Y")
   	{
		return "thistle";
	}
	else
	{
		if (ColorGubun == "1")
		return "white";
		else
		return "#F6FCFC";
	}

}
//마감항목 배경색처리###############################################################




function ds_listInput_CanColumnChange(obj:Dataset, e:DSColChangeEventInfo)
{
	if (
	    (e.columnid == "AMT")||
	    (e.columnid == "QTY")||
	    (e.columnid == "PRICE")
	   )
	{
	
		if (toNumber(e.newvalue) < 0){
		
			g_Message("EE", "-금액을 입력할 수 없습니다.\n" +
							"확인하여 주십시요.");			
                        			
			eval("me_" + e.columnid).value = "";
			eval("me_" + e.columnid).setFocus();			
			
			
			return false;  		

						
		}
	}	
}

//식권관리유형일 경우 식권비교 팝업창을 띄운다.#########################
function edtBtn_TCK_WTD_SEQ_OnClick(obj:Button, e:ClickEventInfo)
{
   
    if (
        (numFormat(ds_listInput.getColumn(ds_listInput.rowposition, "UPJANG"))== "0") 
       )     
    return;
       
    if (
        (numFormat(ds_listInput.getColumn(ds_listInput.rowposition, "TCK_WTD_SEQ"))== "0") 
       )     
    return;
         
    fn_OpenTicketLineWindow("SELECT", ds_listInput.getColumn(ds_listInput.rowposition, "QTY"));
}
//식권관리유형일 경우 식권비교 팝업창을 띄운다.#########################



//식권관리유형일 경우 식권비교 팝업창을 띄운다.#########################
function fn_OpenTicketLineWindow(str_Gubun, real_WW_QTY)
{

    if (numFormat(ds_listInput.getColumn(ds_listInput.rowposition, "UPJANG"))== "0"){    

		g_Message("EE", "업장을 선택하여 주십시요.\n" +
						"확인하여 주십시요.");        
        edt_UPJANGQuery.setFocus();
        return false;
    }
    
    if (gfn_length(ds_listInput.getColumn(ds_listInput.rowposition, "TRX_DATE"))== 0){    

		g_Message("EE", "매출일자가 선택되어 있지 않습니다.\n" +
						"확인하여 주십시요."); 						       
        me_TRX_DATE.setFocus();
        return false;
    }    

    var sUpjang = ds_listInput.getColumn(ds_listInput.rowposition, "UPJANG");
    var sTrxDate = ds_listInput.getColumn(ds_listInput.rowposition, "TRX_DATE");
    var sTrxId = ds_listInput.getColumn(ds_listInput.rowposition, "TRX_ID");
    var sItemType = ds_Type.getColumn(ds_Type.rowposition, "ITEM_TYPE");
	//gfn_dialog("", "U_MAS::MAS10271E.xfdl", "str_Gubun=" + str_Gubun + " real_WW_QTY=" + real_WW_QTY);
	var dsObj = gfn_dialog("", "U_MAS::MAS10271E.xfdl", {str_Gubun:str_Gubun,sUpjang:sUpjang,sTrxDate:sTrxDate,sTrxId:sTrxId,sItemType:sItemType,real_WW_QTY:real_WW_QTY});
	
	ds_MAS_TICKET_MST.clearData;
	ds_MAS_TICKET_MST.copyData(dsObj);
	if (ds_MAS_TICKET_MST.rowcount == 0) return false;
	
	return true;
    
}
//식권관리유형일 경우 식권비교 팝업창을 띄운다.#########################


function fn_AfterCallServiceCheck(errCode, errMsg)
{
	if (errCode != 0){

		g_Message("EE");
		
		f_AfterCallServerCheck = false;
		fn_insert();
		return false;
	}
}

//============================================================================================
//(2012-11-05 추가) 시작
// 박은규 2012-11-05 CSR#(CH201210_00143) 요청자:박현정(FS기획팀)
// 매출복사기능
//============================================================================================
function btn_Copy_OnClick(obj:Button, e:ClickEventInfo)
{
	dv_Copy.visible = (! dv_Copy.visible);
}

function dv_Copy_btn_DataCopy_OnClick(obj:Button, e:ClickEventInfo)
{
	if (!before_SelectCheck()) return;
	if (gfn_length(dv_Copy.me_TRX_DATEC.value)== 0)
	{
		gfn_alert("복사일자를 지정하여 주십시요.");
		return;
	}
	if (me_TRX_DATE.value <= dv_Copy.me_TRX_DATEC.value)
	{
		gfn_alert("복사일자는 매출일자보다 이전이어야합니다.");
		return;
	}
	var strChkLst;
	if (dv_Copy.chk1.value)	strChkLst += ",'" + dv_Copy.chk1.userdata + "'";
	if (dv_Copy.chk2.value)	strChkLst += ",'" + dv_Copy.chk2.userdata + "'";
	if (dv_Copy.chk3.value)	strChkLst += ",'" + dv_Copy.chk3.userdata + "'";
	if (dv_Copy.chk4.value)	strChkLst += ",'" + dv_Copy.chk4.userdata + "'";
	if (dv_Copy.chk5.value)	strChkLst += ",'" + dv_Copy.chk5.userdata + "'";
	strChkLst = gfn_mid(strChkLst,1);
	if(gfn_length(strChkLst)<=0)
	{
		gfn_alert("매출유형을 선택하여 주십시요.");
		return;
	}

	//권한에 따른 저장/삭제 가능체크#########################################################################
	if (
			//(g_AuthLevel != "99") &&
			(g_AuthLevel < "99") &&
			//(!fn_GetSaveAuthBy_AuthLevel(ds_listInput.GetColumn(ds_listInput.row, "UPJANG")))
			(!fn_GetSaveAuthBy_AuthLevel(edt_UPJANGQuery.userdata))
		) return;
	//권한에 따른 저장/삭제 가능체크#########################################################################

	//일마감체크#####################################################################
	if (!fn_CheckMAClosing(ds_cond, edt_UPJANGQuery.userdata, me_TRX_DATE.value, "001")) return;

	
	//
	if (!g_Confirm("02", dv_Copy.me_TRX_DATEC.value + "일자 매출을 복사하시겠습니까?")) return;
	//
	// 파라미터셋팅
	var strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc;
	// 경로 설정
	strSvcID = "MAS10080E_T001";
	strURL   = "U_svc::" + "ma/mas/MAS10080E_T001.jsp";
	// 파라메터 설정
	strArgument  = "strUpjang=" + wrapQuote(edt_UPJANGQuery.userdata);
	strArgument += " strTrxDate=" + wrapQuote(me_TRX_DATE.value);
	strArgument += " strTrxDateFrm=" + wrapQuote(dv_Copy.me_TRX_DATEC.value);
	strArgument += " strTrxTypes=" + wrapQuote(strChkLst);
	// 콜백함수 지정
	strCallbackFunc = "fn_CallBack_Copy";
	// 서버 호출 
	jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, false, false, true);
}

function fn_CallBack_Copy(errCode, errMsg)
{
//ta_Sql.Text = fa_Sql;
	if (errCode == 0)
		g_Message("03","복사가 완료되었습니다.");
	else
		g_Message("EE",errMsg);
	//
	fn_search();
}

function fn_SetChkBox()
{
	fn_sql_common("P", "SELECT A.CODE, A.CODE_NAME FROM SCC_COMMON_CODE A WHERE GROUP_CODE = 'MA0047' AND A.USE_YN = 'Y'", "", " ORDER BY A.SORT_SEQ");
	if (ds_common.rowcount <= 0) return;
	//
	var chkObj;
	for(var i=0; i<5; i++) //총 체크박스 5개
	{
		chkObj = eval("dv_Copy.chk"+(i+1));
		if (i < ds_common.rowcount)
		{
			chkObj.text     =  ds_common.getColumn(i, "CODE_NAME");
			chkObj.userdata =  ds_common.getColumn(i, "CODE");
		}
		else
		{
			chkObj.enable=false;
			chkObj.visible=false;
		}
	}
}
//============================================================================================
//(2012-11-05 추가) 끝
//============================================================================================

//============================================================================================
//(2013-06-10 추가) 시작
// 박은규 2013-06-10 CSR#(CH201306_00051) 요청자:이남석, 김진옥(컨세션사업팀팀)
// 매출/입금 엑셀자료 일괄 업로드 기능개발
//============================================================================================
function fn_Exl_Import(obj:Button, e:ClickEventInfo)
{
	if (!g_Confirm("02", "본 작업은 휴게소업장 전용으로 정해진 규약에 의한 엑셀자료만 업로드 가능합니다.\n\n매출자료 엑셀업로드 작업을 하시겠습니까?!")) return;
	//엑셀 임포트
	fd_Excel.Type = "OPEN";
	fd_Excel.Filter = "Excel File(*.xls;*.xlsx)|*.xls;*.xlsx|All(*.*)|*.*|";

	if( fd_Excel.Open() )
	{
f_BatchJob = true;

		var sFullFileName = fd_Excel.FilePath + '\\' + fd_Excel.FileName;
		ds_Excel.clearData();
		//ext_ExcelImportByIndex(파일풀패스, 시트순번, 깡통데이타셑);
		ext_ExcelImportByIndex(sFullFileName, 0, "ds_Excel");
		//
		http.Sync = true;
		fn_SetImpData();
		
f_BatchJob = false;
	}
}

function fn_SetImpData()
{
	if (!before_SelectCheck()) return;
	//
	var iRow;
	for (iRow = 0; iRow < ds_Excel.rowcount; iRow++)
	{
		//입력작업...
		if (! fn_SetImpDataInput(iRow)) break;
		//저장작업...
		if (! fn_SetImpDataSave(iRow)) break;
	}
	//
	g_Message("01", "총 " + (iRow) + "건의 매출이 등록되었습니다.");
}

function fn_SetImpDataInput(iRow)
{
	//입력작업...
	var strQuery;
	//
	if (me_TRX_DATE.value <> ds_Excel.getColumn(iRow, "Col01"))
	{
		g_Message("EE","(" + (iRow+1) + "행)매출일자가 올바르지 않습니다!");
		return false;
	}
	fn_insert();
	//매출유형
	if (ffn_ChkNull(ds_Excel.getColumn(iRow, "Col02")))
	{
		g_Message("EE","(" + (iRow+1) + "행)매출유형이 누락되었습니다!");
		return false;
	}
	strQuery = eval(eval("st_" + gfn_subStr(edtBtn_TRX_TYPE.name, 7)).userdata) + getAddWhere(edtBtn_TRX_TYPE);
	strQuery += " AND A.TYPE_CD = '" + ds_Excel.getColumn(iRow, "Col02") + "'";
	strQuery += " AND A.USE_YN = 'Y'";
	strQuery += " AND EXISTS (SELECT 1 FROM SCC_COMMON_CODE Z WHERE Z.GROUP_CODE = 'MA0050' AND Z.CODE = A.TYPE_CD AND Z.USE_YN = 'Y')";
	if (fn_sql_common("P", strQuery).rowcount < 1)
	{
		g_Message("EE","(" + (iRow+1) + "행)매출유형이 올바르지 않습니다!");
		return false;
	}
	else
	{
		ds_listInput.setColumn(ds_listInput.rowposition, "TRX_TYPE", ds_common.getColumn(0, "TYPE_CD"));
		ds_listInput.setColumn(ds_listInput.rowposition, "TYPE_NAME", ds_common.getColumn(0, "TYPE_NAME"));
	}
	if (ds_Type.getColumn(0, "ADITEM1_CHK_YN") == "R")
	{
		g_Message("EE","(" + (iRow+1) + "행)해당 매출유형은 식구분을 관리합니다!");
		return false;
	}
	//창고
	if (ffn_ChkNull(ds_Excel.getColumn(iRow, "Col04")))
	{
		g_Message("EE","(" + (iRow+1) + "행)매출창고가 누락되었습니다!");
		return false;
	}
	strQuery = eval(eval("st_" + gfn_subStr(edtBtn_SUBINV_CODE.name, 7)).userdata) + getAddWhere(edtBtn_SUBINV_CODE);
	//strQuery += " AND SUBINV_CODE = '" + ds_Excel.GetColumn(iRow, "Col04") + "'";
	strQuery += " AND SUBINV_CODE = (SELECT Z.SET1 FROM SCC_COMMON_CODE Z WHERE Z.GROUP_CODE = 'MA0052' AND Z.CODE = '" + ds_Excel.getColumn(iRow, "Col04") + "' AND Z.USE_YN = 'Y')";
	if (fn_sql_common("P", strQuery).rowcount < 1)
	{
		g_Message("EE","(" + (iRow+1) + "행)매출창고가 올바르지 않습니다!");
		return false;
	}
	else
	{
		ds_listInput.setColumn(ds_listInput.rowposition, "SUBINV_CODE", ds_common.getColumn(0, "SUBINV_CODE"));
		ds_listInput.setColumn(ds_listInput.rowposition, "SUBINV_CODENM", ds_common.getColumn(0, "SUBINV_NAME"));
	}
	//고객사, 공란인 경우 999998:기타(개인)
	strQuery = eval(eval("st_" + gfn_subStr(edtBtn_CUSTCD.name, 7)).userdata) + getAddWhere(edtBtn_CUSTCD);
	strQuery += " AND A.CUSTCD = (SELECT Z.SET1 FROM SCC_COMMON_CODE Z WHERE Z.GROUP_CODE = 'MA0049' AND Z.CODE = NVL('" + ds_Excel.getColumn(iRow, "Col06") + "','DEF') AND Z.USE_YN = 'Y')";
	if (fn_sql_common("P", strQuery).rowcount < 1)
	{
		g_Message("EE","(" + (iRow+1) + "행)고객사코드가 올바르지 않습니다!");
		return false;
	}
	else
	{
		ds_listInput.setColumn(ds_listInput.rowposition, "CUSTCD", ds_common.getColumn(0, "CUSTCD"));
		ds_listInput.setColumn(ds_listInput.rowposition, "CUSTCDNM", ds_common.getColumn(0, "CUSTNM"));
	}
	//과세구분(310:과세, 350:면세, 410:영세)
	strQuery = eval(eval("st_" + gfn_subStr(edtBtn_TAX_KIND.name, 7)).userdata) + getAddWhere(edtBtn_TAX_KIND);
	strQuery += " AND CODE = '" + ds_Excel.getColumn(iRow, "Col08") + "' AND USE_YN = 'Y'";
	if (fn_sql_common("P", strQuery).rowcount < 1)
	{
		g_Message("EE","(" + (iRow+1) + "행)과세구분이 올바르지 않습니다!\n\n과세:310, 면세:350, 영세:410");
		return false;
	}
	else
	{
		ds_listInput.setColumn(ds_listInput.rowposition, "TAX_KIND", ds_common.getColumn(0, "CODE"));
		ds_listInput.setColumn(ds_listInput.rowposition, "TAX_KINDNM", ds_common.getColumn(0, "CODE_NAME"));
	}
	//단가
	if ( ffn_ChkNull(ds_Excel.getColumn(iRow, "Col09")) || (toNumber(ds_Excel.getColumn(iRow, "Col09")) <= 0) )
	{
		g_Message("EE","(" + (iRow+1) + "행)단가가 올바르지 않습니다!");
		return false;
	}
	else
	{
		ds_listInput.setColumn(ds_listInput.rowposition, "PRICE", ds_Excel.getColumn(iRow, "Col09"));
	}
	//식수
	if ( ffn_ChkNull(ds_Excel.getColumn(iRow, "Col10")) || (toNumber(ds_Excel.getColumn(iRow, "Col10")) <= 0) )
	{
		g_Message("EE","(" + (iRow+1) + "행)식수가 올바르지 않습니다!");
		return false;
	}
	else
	{
		ds_listInput.setColumn(ds_listInput.rowposition, "QTY", ds_Excel.getColumn(iRow, "Col10"));
	}
	//금액:자동계산
	//적요
	if (! ffn_ChkNull(ds_Excel.getColumn(iRow, "Col12")))
		ds_listInput.setColumn(ds_listInput.rowposition, "TRX_DESC", ds_Excel.getColumn(iRow, "Col12"));
	else
		ds_listInput.setColumn(ds_listInput.rowposition, "TRX_DESC", me_TRX_DATE.value + ' ' + ds_listInput.getColumn(ds_listInput.rowposition, "TYPE_NAME"));
	//
	return true;
}

function fn_SetImpDataSave(iRow)
{
	//저장작업...
	if (!before_SaveCheck("Master"))
	{
		g_Message("EE","(" + (iRow+1) + "행)매출저장 오류사항을 확인하세요!");
		return false;
	}
	//
	return true;
}

function ffn_ChkNull(strData){
	return (gfn_length(gfn_trim(strData))== 0);
}
//============================================================================================
//(2013-06-10 추가) 끝
//============================================================================================
]]></Script>
  </Form>
</FDL>
