<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="../../../default_typedef.xml"/>
  <Form id="FSM00280E" onkeydown="frm_OnKeyDown" onload="form_onload" titletext="레시피조정(제출용)" position="absolute 0 0 1252 725" scrollbars="none">
    <Layouts>
      <Layout>
        <Static id="Static08" class="sta_WFSA_Labelbg" position="absolute 0 30 1237 71" anchor="left top right"/>
        <Combo codecolumn="HALL_CD" datacolumn="HALL_NAME" id="cbo_HALL_CD" index="0" innerdataset="ds_HALL_CD" taborder="1" position="absolute 390 40 520 61" class="cmb_WF_Essential"/>
        <Static id="st10" text="사업장" position="absolute 16 38 86 64" class="sta_WFSA_label"/>
        <Static id="Static1" text="식당명" position="absolute 336 38 406 64" class="sta_WFSA_label"/>
        <Static id="Static2" text="제공일" position="absolute 550 38 620 64" class="sta_WFSA_label"/>
        <Tab id="tab_Main" onchanged="tab_Main_OnChanged" preload="true" taborder="8" position="absolute 0 86 1237 710" showextrabutton="false" anchor="all">
          <Tabpages>
            <Tabpage id="tab1" taborder="1" text="레시피수정" position="absolute 2 24 975 559" scrollbars="none">
              <Layouts>
                <Layout width="1235" height="596">
                  <Static id="Static00" position="absolute 1070 12 1225 39" class="sta_WFDA_Labelbg" anchor="top right"/>
                  <Static id="Static03" text="식재료비율" position="absolute 1070 12 1151 39" class="sta_WFDA_Label01" anchor="top right"/>
                  <Button enable="false" id="btn_add" onclick="fn_insert" taborder="1" text="자재추가" position="absolute 913 16 988 38" anchor="top right" class="btn_WF_Custom"/>
                  <Grid autoenter="select" binddataset="ds_list" cellsizingtype="both" readonly="false" enable="true" id="grd_list" useinputpanel="false" oncelldblclick="grd_list_OnCellDblClick" onheadclick="grd_List_OnHeadClick" onmousemove="tab_Main_tab1_grd_list_OnMouseOver" taborder="2" tabstop="true" usecontextmenu="true" useselcolor="true" visible="true" wheelscrollrow="1" position="absolute 10 41 1225 584" selecttype="row" anchor="all" autofittype="col">
                    <Formats>
                      <Format id="Default">
                        <Columns>
                          <Column size="25"/>
                          <Column size="70"/>
                          <Column size="118"/>
                          <Column size="169"/>
                          <Column size="40"/>
                          <Column size="60"/>
                          <Column size="60"/>
                          <Column size="60"/>
                          <Column size="60"/>
                          <Column size="70"/>
                          <Column size="70"/>
                          <Column size="70"/>
                          <Column size="70"/>
                        </Columns>
                        <Rows>
                          <Row size="22" band="head"/>
                          <Row size="22" band="head"/>
                          <Row size="24"/>
                          <Row size="24" band="summ"/>
                        </Rows>
                        <Band id="head">
                          <Cell rowspan="2" displaytype="image" class="head_Excel"/>
                          <Cell col="1" rowspan="2" displaytype="text" text="식단"/>
                          <Cell col="2" rowspan="2" displaytype="text" text="레시피명"/>
                          <Cell col="3" rowspan="2" displaytype="text" text="자재명"/>
                          <Cell col="4" rowspan="2" displaytype="text" text="단위"/>
                          <Cell col="5" rowspan="2" displaytype="text" class="grd_WF_Essential" text="1인량&#10;(g)"/>
                          <Cell col="6" rowspan="2" displaytype="text" class="grd_WF_Essential" text="가식부량&#10;(g)"/>
                          <Cell col="7" rowspan="2" displaytype="text" text="총사용량&#10;(kg)"/>
                          <Cell col="8" rowspan="2" displaytype="text" text="구매량"/>
                          <Cell col="9" rowspan="2" displaytype="text" text="kg단가"/>
                          <Cell col="10" rowspan="2" displaytype="text" text="구매단가"/>
                          <Cell col="11" rowspan="2" displaytype="text" text="총소요금액"/>
                          <Cell col="12" rowspan="2" displaytype="text" text="구매금액"/>
                        </Band>
                        <Band id="body">
                          <Cell displaytype="text" style="align:center;background:white;background2:white;" expr="expr:currow+1"/>
                          <Cell col="1" displaytype="text" style="align:left;background:white;background2:white;" text="bind:MENU_NAME" suppress="1"/>
                          <Cell col="2" displaytype="text" style="align:left;background:white;background2:white;" text="bind:RECIPE_NAME" suppress="2"/>
                          <Cell col="3" displaytype="text" style="align:left;background:white;background2:white;" text="bind:ITEM_NAME"/>
                          <Cell col="4" displaytype="text" style="align:left;background:white;background2:white;" text="bind:PO_UOM"/>
                          <Cell col="5" displaytype="number" edittype="text" editfilter="number" style="align:right middle;background:white;background2:white;" text="bind:NEED_QTY" editautoselect="true"/>
                          <Cell col="6" displaytype="number" edittype="text" editfilter="number" style="align:right middle;background:white;background2:white;" text="bind:EDIBLE_QTY" editautoselect="true"/>
                          <Cell col="7" displaytype="number" style="background:white;background2:white;" text="bind:TOT_QTY"/>
                          <Cell col="8" displaytype="number" style="background:white;background2:white;" text="bind:PR_QTY"/>
                          <Cell col="9" displaytype="number" style="background:white;background2:white;" text="bind:KG_PRICE"/>
                          <Cell col="10" displaytype="number" style="background:white;background2:white;" text="bind:MARGIN_PRICE"/>
                          <Cell col="11" displaytype="number" style="background:white;background2:white;" text="bind:TOT_AMT"/>
                          <Cell col="12" displaytype="number" style="background:white;background2:white;" text="bind:PR_AMT"/>
                        </Band>
                        <Band id="summary">
                          <Cell colspan="5" displaytype="text" style="align:left;" text="합    계"/>
                          <Cell col="5" displaytype="number" style="align: ;" expr="expr:getSum('NEED_QTY')"/>
                          <Cell col="6" displaytype="number" style="align: ;" expr="expr:getSum('EDIBLE_QTY')"/>
                          <Cell col="7" displaytype="number" style="align: ;" expr="expr:getSum('TOT_QTY')"/>
                          <Cell col="8" displaytype="number" style="align: ;" expr="expr:getSum('PR_QTY')"/>
                          <Cell col="9" displaytype="number" style="align: ;" expr="expr:getSum('KG_PRICE')"/>
                          <Cell col="10" displaytype="number" style="align: ;" expr="expr:getSum('MARGIN_PRICE')"/>
                          <Cell col="11" displaytype="number" style="align: ;" expr="expr:getSum('TOT_AMT')"/>
                          <Cell col="12" displaytype="number" style="align: ;" expr="expr:getSum('PR_AMT')"/>
                        </Band>
                      </Format>
                    </Formats>
                  </Grid>
                  <Button enable="false" id="btn_del" onclick="fn_delete" taborder="4" text="자재삭제" position="absolute 990 16 1065 38" class="btn_WF_Custom" image="" anchor="top right"/>
                  <Edit enable="false" id="ed_PR_NUM" taborder="7" position="absolute 1153 15 1222 36" style="align:right; :disabled {background:transparent;border:1 none transparent ;}" anchor="top right"/>
                  <Static id="Static01" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 0 856 10"/>
                  <Static id="Static05" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 0 10 525"/>
                  <Static id="Static02" text="w15" onclick="Static02_onclick" class="Guide01_AreaRed" visible="false" position="absolute 1225 0 1235 525"/>
                  <Static id="Static07" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 586 856 596"/>
                  <Static id="Static16" text="h06" onclick="Static03_onclick" class="Guide01_AreaRed" visible="false" position="absolute 1081 10 1225 16" anchor="top right"/>
                  <Static id="Static19" text="h05" class="Guide01_AreaRed" visible="false" position="absolute 1081 36 1225 41" anchor="top right"/>
                  <Static id="Static15" text="h06" onclick="Static03_onclick" class="Guide01_AreaRed" visible="false" position="absolute 10 10 154 23" anchor="top right"/>
                  <Static id="Static22" text="레시피수정" onclick="Static22_onclick" class="sta_WF_Title01" position="absolute 10 23 338 54" anchor="left top"/>
                </Layout>
              </Layouts>
            </Tabpage>
            <Tabpage id="tab2" taborder="5" text="레시피출력" position="absolute 2 24 975 559" scrollbars="none">
              <Layouts>
                <Layout width="1235" height="596">
                  <WebBrowser id="wb_report" taborder="1" position="absolute 10 10 1225 585" anchor="all"/>
                  <Static id="Static01" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 0 856 10"/>
                  <Static id="Static05" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 0 10 525"/>
                  <Static id="Static02" text="w15" onclick="Static02_onclick" class="Guide01_AreaRed" visible="false" position="absolute 1225 0 1235 525"/>
                  <Static id="Static07" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 586 856 596"/>
                </Layout>
              </Layouts>
            </Tabpage>
            <Tabpage id="tab3" taborder="9" text="영양분석출력" position="absolute 2 24 975 559" scrollbars="none">
              <Layouts>
                <Layout width="1235" height="596">
                  <WebBrowser id="wb_report" taborder="1" position="absolute 10 10 1223 583" anchor="all"/>
                  <Static id="Static05" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 0 10 525"/>
                  <Static id="Static01" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 0 856 10"/>
                  <Static id="Static02" text="w15" onclick="Static02_onclick" class="Guide01_AreaRed" visible="false" position="absolute 1225 0 1235 525"/>
                  <Static id="Static07" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 586 856 596"/>
                </Layout>
              </Layouts>
            </Tabpage>
          </Tabpages>
        </Tab>
        <CheckBox falsevalue="N" id="chk_ADJUST" taborder="6" text="수정된 레시피" truevalue="Y" value="false" position="absolute 945 40 1077 61"/>
        <CheckBox falsevalue="N" id="chk_DISUSE_RATE" taborder="7" text="폐기율 적용" truevalue="Y" position="absolute 1069 40 1167 61" value="true"/>
        <MaskEdit id="me_MENU_DATE" mask="####-##-##" onkillfocus="g_Date_OnKillFocus" taborder="2" type="string" userdata="btn_MENU_DATE" position="absolute 604 40 683 61" class="msk_WF_Essential" style="align:center;" autoselect="true"/>
        <Button id="btn_MENU_DATE" onclick="g_CalButton_OnClick" taborder="3" userdata="me_MENU_DATE" position="absolute 682 40 704 61" class="btn_WF_calEssential" text="" image=""/>
        <Static id="Static0" text="식단" position="absolute 734 38 804 64" class="sta_WFSA_label"/>
        <Edit id="ed_MENU_CD" onkeydown="ed_pop_OnKeyDown" readonly="true" taborder="4" userdata="btn_2" position="absolute 777 40 894 61" class="edt_WF_Essential"/>
        <Button id="btn_2" onclick="btn_2_OnClick" taborder="5" text="" userdata="FMO00240E_S002" position="absolute 893 40 915 61" class="btn_WF_popSearchEssential" image=""/>
        <PopupDiv id="pdiv_menu" oncloseup="pdiv_menu_OnCloseUp" taborder="19" tabstop="false" position="absolute 360 779 595 952" scrollbars="none" class="pdiv_WF_Pop" style="border:2 solid #515d6fff ;">
          <Layouts>
            <Layout>
              <Grid autoenter="select" binddataset="ds_menu" cellsizingtype="both" readonly="false" enable="true" id="grd_menu" useinputpanel="false" onenterdown="pdiv_menu_grd_list_OnEnterDown" onheadclick="grd_List_OnHeadClick" taborder="1" tabstop="true" usecontextmenu="true" useselcolor="true" visible="true" wheelscrollrow="1" position="absolute -1 0 234 172" selecttype="row" anchor="default" autofittype="col">
                <Formats>
                  <Format id="Default">
                    <Columns>
                      <Column size="146"/>
                      <Column size="40"/>
                      <Column size="40"/>
                    </Columns>
                    <Rows>
                      <Row size="24" band="head"/>
                      <Row size="24"/>
                    </Rows>
                    <Band id="head">
                      <Cell displaytype="text" text="식단"/>
                      <Cell col="1" text="수정"/>
                      <Cell col="2" displaytype="checkbox" edittype="checkbox"/>
                    </Band>
                    <Band id="body">
                      <Cell displaytype="text" style="align:left;padding:0 0 0 5;" text="bind:MENU" suppress="1"/>
                      <Cell col="1" style="align:center;" text="bind:WORK_YN"/>
                      <Cell col="2" displaytype="checkbox" edittype="checkbox" style="align:center;" text="bind:CHK" suppress="2"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
            </Layout>
          </Layouts>
        </PopupDiv>
        <Div id="div_cmnBtn" anchor="left top right" taborder="27" url="cmn::CmnBtn.xfdl" text="Div00" scrollbars="none" position="absolute 0 0 1237 30"/>
        <Static id="Static15" text="h06" onclick="Static03_onclick" class="Guide01_AreaRed" visible="false" position="absolute 0 71 144 86" anchor="top right"/>
        <Static id="Static16" text="h06" onclick="Static03_onclick" class="Guide01_AreaRed" visible="false" position="absolute 1093 71 1237 77" anchor="top right"/>
        <Static id="Static19" text="h05" class="Guide01_AreaRed" visible="false" position="absolute 1093 97 1237 102" anchor="top right"/>
        <Static id="Static23" text="W15" visible="false" position="absolute 1 40 16 61" style="background:#ff000055;align:center middle;"/>
        <Static id="Static18" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 62 40 72 61"/>
        <Static id="Static20" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 306 40 336 61"/>
        <Static id="Static21" text="W10" visible="false" position="absolute 0 30 1237 40" style="background:#ff000055;align:center middle;"/>
        <Static id="Static05" text="W10" visible="false" position="absolute 0 61 1237 71" style="background:#ff000055;align:center middle;"/>
        <Static id="Static24" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 380 40 390 61"/>
        <Static id="Static25" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 520 40 550 61"/>
        <Static id="Static26" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 594 40 604 61"/>
        <Static id="Static27" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 704 40 734 61"/>
        <Static id="Static28" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 767 40 777 61"/>
        <Static id="Static17" text="w15" onclick="Static06_onclick" class="Guide01_AreaRed" visible="false" position="absolute 1237 0 1252 710" anchor="top right"/>
        <Static id="Static71" text="h15" onclick="Static71_onclick" class="Guide01_AreaRed" visible="false" position="absolute 0 710 1252 725" anchor="left bottom"/>
        <Static id="Static03" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 915 40 945 61"/>
        <Static id="Static04" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 1039 40 1069 61"/>
        <UpjangSearchComponent id="edt_upjang" titletext="업장 검색용 Component" taborder="0" text="UpjangSearchComponent00" position="absolute 72 40 306 61" bindDataset="ds_input" bindUpjangCodeColumn="UPJANG" bindUpjangNameColumn="UPJANG_NM" eventBeforeTrigger="" eventAfterTrigger="fn_HallSearch" roleSetId="ScoAuthLevel01"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_list" oncolumnchanged="ds_list_OnColumnChanged">
        <ColumnInfo>
          <Column id="CORNER" size="20" type="STRING"/>
          <Column id="DISUSE_RATE" size="22" type="BIGDECIMAL"/>
          <Column id="EDIBLE_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="EXPECT_MEAL_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="HALL_CD" size="20" type="STRING"/>
          <Column id="ITEM_CODE" size="12" type="STRING"/>
          <Column id="ITEM_NAME" size="200" type="STRING"/>
          <Column id="ITEM_SIZE" size="100" type="STRING"/>
          <Column id="KG_CONVERT_RATE" size="22" type="BIGDECIMAL"/>
          <Column id="KG_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="MARGIN_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="MARGIN_RATE" size="22" type="BIGDECIMAL"/>
          <Column id="MEAL" size="20" type="STRING"/>
          <Column id="MENU_CD" size="20" type="STRING"/>
          <Column id="MENU_DATE" size="8" type="STRING"/>
          <Column id="MIN_ORD_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="MULTIPLIER_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="NEED_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="PO_UOM" size="10" type="STRING"/>
          <Column id="POINT_FLAG" size="1" type="STRING"/>
          <Column id="PR_AMT" size="22" type="BIGDECIMAL"/>
          <Column id="PR_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="RECIPE_CD" size="20" type="STRING"/>
          <Column id="RECIPE_NAME" size="50" type="STRING"/>
          <Column id="SALE_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="SUBINV_CODE" size="8" type="STRING"/>
          <Column id="TOT_AMT" size="22" type="BIGDECIMAL"/>
          <Column id="TOT_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="UNIT_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="UPJANG" size="22" type="BIGDECIMAL"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_input" oncolumnchanged="ds_input_OnColumnChanged">
        <ColumnInfo>
          <Column id="UPJANG" size="256" type="STRING"/>
          <Column id="UPJANG_NM" size="256" type="STRING"/>
          <Column id="HALL_CD" size="256" type="STRING"/>
          <Column id="MENU_DATE" size="256" type="STRING"/>
          <Column id="ADJUST" size="256" type="STRING"/>
          <Column id="DISUSE_RATE" size="256" type="STRING"/>
          <Column id="MENU_CD" size="256" type="STRING"/>
          <Column id="SUBINV_CODE" size="256" type="STRING"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="ADJUST">N</Col>
            <Col id="DISUSE_RATE">Y</Col>
            <Col id="HALL_CD"/>
            <Col id="MENU_CD"/>
            <Col id="MENU_DATE"/>
            <Col id="SUBINV_CODE"/>
            <Col id="UPJANG"/>
            <Col id="UPJANG_NM"/>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_menu"/>
      <Dataset id="ds_HALL_CD"/>
      <Dataset id="ds_list2"/>
      <Dataset id="ds_copymenu">
        <ColumnInfo>
          <Column id="MENU_CD" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Bind>
      <BindItem id="cbo_HALL_CD_value" compid="cbo_HALL_CD" propid="value" datasetid="ds_input" columnid="HALL_CD"/>
      <BindItem id="chk_ADJUST_value" compid="chk_ADJUST" propid="value" datasetid="ds_input" columnid="ADJUST"/>
      <BindItem id="chk_DISUSE_RATE_value" compid="chk_DISUSE_RATE" propid="value" datasetid="ds_input" columnid="DISUSE_RATE"/>
      <BindItem id="me_MENU_DATE_value" compid="me_MENU_DATE" propid="value" datasetid="ds_input" columnid="MENU_DATE"/>
    </Bind>
    <Script type="xscript4.0"><![CDATA[include "U_lib::lib_conversionCom.xjs";
/*
 ******************************************************************************************
 * 시스템구분   : 메뉴관리/식단관리/학교직군레시피수정
 * 프로그램명   : FSM00280E.XML
 * 기      능   : 학교직군레시피수정
 * 작  성  자   : 박지영
 * 작성  일자   : 2008-02-18
 * 비      고   : 
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
//=========================================================================================
// [ PART 1 ]
// Form에서 Include 할 내용을 정의
//
//=========================================================================================
//@@컨버터에서 주석처리 #include "lib::sc_comon.js"
//@@컨버터에서 주석처리 #include "LIB::lib_comm_0001.js"
//@@컨버터에서 주석처리 #include "lib::tit_comm_0001.js"		// X-Framework Lib
//@@컨버터에서 주석처리 #include "lib::sc_sql_common.js"		// 사업장팝업용 Lib
//=========================================================================================
// [ PART 2 ]
// Form에서 사용될 전역변수를 선언
//
//=========================================================================================
var fstrMenuCD;
//=========================================================================================
// [ PART 3 ]
// Form Loading 시 작업 정의
//
//=========================================================================================
function form_onload(obj:Form, e:LoadEventInfo)
{
	gfn_formOnLoad(obj, false);

	// X-Framework : Action 정보 생성 
	fsp_init(this);
	
	// 업데이트 DS
	v_ds_check = "";
	
	// 권한에 따른 버튼 활성화 및 디폴트값 설정
	//fn_SetAuth2("", "", "ed_UPJANG_NM", "btn_upjang", "ds_input", "", "", "UPJANG", "UPJANG_NM");
	
	// 관리자의 경우 전체 업장내역 조회 가능
// 	if( toNumber(g_AuthLevel) < 99 ) {
// 		ed_UPJANG_NM.enable = false;
// 		btn_upjang.enable  = false;
// 	}
	
	fn_HallSearch();
	
	ds_input.setColumn(0,"MENU_DATE",fn_CurrDateWeek("YMD"));
	
	edt_upjang.setFocus();
}

function frm_OnKeyDown(obj:Form, e:KeyEventInfo)
{
	gfn_formKeyDown(obj, e); //(obj,e.fromreferenceobject,e.keycode,e.shiftKey,e.ctrlKey,e.altKey,-1,-1);
}
//=========================================================================================
// [ PART 4 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,도움말,form닫기)
//
//=========================================================================================
/*
 ******************************************************************************************
 * 함  수  명   : fn_Search()
 * 기      능   : [조회버튼] 검색조건에 해당하는 정보를 조회
 ******************************************************************************************
 */
function fn_search()
{
	// 조회조건체크
	if(!fn_SearchCheck())
	{
		return;
	}
	
	// 초기화
	ds_list.clearData();
	ds_copymenu.clearData();
	
	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;

	var nFRow = ds_HALL_CD.findRow("HALL_CD",ds_input.getColumn(0,"HALL_CD"));
		
	ds_input.setColumn(0,"SUBINV_CODE",ds_HALL_CD.getColumn(nFRow,"SUBINV_CODE"));
	ds_input.setColumn(0,"MENU_CD",fstrMenuCD);
	
	actionName		= "FSM00280E_T002";
	cmdName			= "U_svc::" + "fs/fsm/FSM00280E_T002.jsp";
	inData			= "ds_input=ds_input";
	outData			= "ds_list=ds_list1 ds_list2=ds_list2";
	callBackFnc		= "fn_afterSearch";
	
	jsp_transaction(this,actionName, cmdName ,inData ,outData,otherArg,callBackFnc,true,false,false);
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_Insert()
 * 기      능   : [입력버튼] 입력 시 처리되는 작업
 * 비      고	: 팝업사용
 ******************************************************************************************
 */
function fn_insert(obj:Button, e:ClickEventInfo)
{
	// 조회조건체크
	if(!fn_SearchCheck())
	{
		return;
	}
	
	var strReturn,nARow;
	strReturn = gfn_dialog("", "U_FSM::FSM00281P.xfdl","fstrRecipeCD="+wrapQuote(ds_list.getColumn(ds_list.rowposition,"RECIPE_CD")));
	
	if (strReturn)
	{
		tab_Main.tab1.grd_list.enableredraw = false;
		Sort(ds_list,"MENU_CD,RECIPE_CD,NEED_QTY:D");
		tab_Main.tab1.grd_list.enableredraw = true;
	}
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_Save()
 * 기      능   : [저장버튼] 저장 시 처리되는 작업
 ******************************************************************************************
 */
function fn_save()
{
	// 저장조건체크
	if(!fn_SaveCheck())
	{
		return;
	}
	
    // 서비스셋팅
    var actionName, cmdName, inData, outData, otherArg, callBackFnc;
    var insertSql, updateSql, deleteSql,saveFlagColumn, keySqlName, keyIncrement, callbackSql;
    
    inData		= "ds_input=ds_input ds_copymenu=ds_copymenu:A ds_list=ds_list:A";
    outData		= "";
    callBackFnc	= "fn_afterSave";
    keyIncrement= -1;
    
    fsp_clear(this);
    
	fsp_addMulti(this, "fs/fsm:FSM00280E_D001", keySqlName, keyIncrement, callbackSql); // 식단 생성
    fsp_addMulti(this, "fs/fsm:FSM00280E_I001", keySqlName, keyIncrement, callbackSql);
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc,true);		// 서비스 호출 
      
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_Delete()
 * 기      능   : [삭제버튼] 삭제 시 처리되는 작업
 ******************************************************************************************
 */
function fn_delete(obj:Button, e:ClickEventInfo)
{
	ds_list.deleteRow(ds_list.rowposition);
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_Print()
 * 기      능   : [출력버튼] 출력 시 처리되는 작업
 ******************************************************************************************
 */
function fn_print()
{
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_Excel()
 * 기      능   : [엑셀버튼] 엑셀 시 처리되는 작업
 ******************************************************************************************
 */
function fn_Excel()
{
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_Close()
 * 기      능   : [닫기버튼] 화면을 닫을때 처리되는 작업
 ******************************************************************************************
 */
function fn_Close()
{
	this.close();
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_Help()
 * 기      능   : [도움말버튼] 도움말
 ******************************************************************************************
 */
function fn_help()
{
}
//=========================================================================================
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
//
//=========================================================================================
/*
 ******************************************************************************************
 * 함  수  명   : fn_afterSearch()
 * 입      력   : errCode 	= 에러코드
				  errMsg	= 에러메세지
 * 반      환   : 없음
 * 기      능   : 
 * 작  성  자   : 박지영
 * 작성  일자   : 2007-12-10  
 ******************************************************************************************
 */
function fn_afterSearch(errCode, errMsg)
{
	if(errCode!=0)
	{
		return;
	}
	
	var btp,nARow;
		
	// 식재료비율셋팅
	tab_Main.tab1.ed_PR_NUM.value = numFormat(toNumber(ds_list.getSum("TOT_AMT")) / toNumber(ds_list2.getSum("TOT_SALE_AMT")) * 100,1)+ "%";
	
	// 레포트셋팅
	fn_SetReport();
	
	// 버튼셋팅
	if (ds_list.rowcount > 0)
	{
		btp = true;
	}
	else
	{
		btp = false;
	}
	tab_Main.tab1.btn_add.enable = btp;
	tab_Main.tab1.btn_del.enable = btp;
	
	// 수정식단
	ds_menu.filter("CHK=='1'");
	CopyF(ds_copymenu,ds_menu);
	ds_menu.filter("");
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_afterSave()
 * 입      력   : errCode 	= 에러코드
				  errMsg	= 에러메세지
 * 반      환   : 없음
 * 기      능   : 
 * 작  성  자   : 박지영
 * 작성  일자   : 2007-12-10  
 ******************************************************************************************
 */
function fn_afterSave(errCode, errMsg)
{
	if(errCode!=0)
	{
		return;
	}
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_HallSearch()
 * 입      력   : 
 * 반      환   : 없음
 * 기      능   : 식당 정보를 콤보에 연결
 * 작  성  자   : 구종화
 * 작성  일자   : 2007-12-20 
 ******************************************************************************************
 */
function fn_HallSearch()
{
	// 식당 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	
	inData			= "";
	outData			= "ds_HALL_CD=gds_Csqlout";
	callBackFnc		= "";
	otherArg		= "UPJANG="+wrapQuote(ds_input.getColumn(0,"UPJANG"));

	fsp_clear(this); 
    fsp_addSearch(this, "fs/fsc:FSA_HALL_MST_S001");								// 조회 
	http.Sync = true;
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);		// 서비스 호출 
	http.Sync = false;
	
	// 초기값 셋팅
	cbo_HALL_CD.index = 0;

}
/*
 ******************************************************************************************
 * 함  수  명   : fn_MenuSearch()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 식단리스트조회
 * 작  성  자   : 박지영
 * 작성  일자   : 2008-01-15
 ******************************************************************************************
 */
function fn_MenuSearch()
{
	// 초기화
	fstrMenuCD = "";
	ed_MENU_CD.value = "";
	
	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	
	actionName		= "FSM00280E_T001";
	cmdName			= "U_svc::" + "fs/fsm/FSM00280E_T001.jsp";
	inData			= "ds_input=ds_input";
	outData			= "ds_menu=ds_menu";
	callBackFnc		= "";
	
	jsp_transaction(this,actionName, cmdName ,inData ,outData,otherArg,callBackFnc,true,false,false);
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_SaveCheck()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 저상시 필수입력 체크
 * 작  성  자   : 박지영
 * 작성  일자   : 2007-12-10  
 ******************************************************************************************
 */
function fn_SaveCheck()
{
	nFRow = ds_list.findRowExpr("toNumber(NEED_QTY) <= 0");
	if (nFRow >= 0)
	{
		g_Message("EE", "1인량을 입력해 주십시오.");
		ds_list.rowposition = nFRow;
		tab_Main.tab1.grd_list.setFocus();
		tab_Main.tab1.grd_list.setCellPos(5);
		return false;
	}

	nFRow = ds_list.findRowExpr("toNumber(EDIBLE_QTY) <= 0");
	if (nFRow >= 0)
	{
		g_Message("EE", "가식부량을 입력해 주십시오.");
		ds_list.rowposition = nFRow;
		tab_Main.tab1.grd_list.setFocus();
		tab_Main.tab1.grd_list.setCellPos(6);
		return false;
	}
	return true;
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_OpenPopupDiv()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 식단 팝업 오픈
 * 작  성  자   : 박지영
 * 작성  일자   : 2008-02-18
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
 function fn_OpenPopupDiv()
 {
	var nX = system.clientToScreenX(ed_MENU_CD,0); // Popup Button의 화면상의 X좌표 얻어오기
	var nY = system.clientToScreenY(ed_MENU_CD,ed_MENU_CD.position.height);	// Popup Button의 화면상의 Y좌표 얻어오기	
	
	pdiv_menu.trackPopup(nX, nY+3);
 }
 
 /*
 ******************************************************************************************
 * 함  수  명   : fn_SetReport()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 사업장 조회 후 실행 함수
 * 작  성  자   : 박지영
 * 작성  일자   : 2007-12-10  
 ******************************************************************************************
 */ 
function fn_SearchCheck()
{	
	if (gfn_length(ds_input.getColumn(0,"UPJANG"))== 0) 
	{
		g_Message("EE",	"사업장 오류!!\n\n사업장을 선택하세요.");
		edt_upjang.setFocus();
		return false;
	}
	if (gfn_length(ds_input.getColumn(0,"HALL_CD"))== 0) 
	{
		g_Message("EE","식당명 오류!!\n\n식당을 선택하세요.");
		cbo_HALL_CD.setFocus();
		return false;
	}
	if (gfn_length(ds_input.getColumn(0,"MENU_DATE"))== 0) 
	{
		g_Message("EE",	"제공일 오류!!\n\n제공일을 입력하세요.");
		me_MENU_DATE.setFocus();
		return false;
	}
	if (gfn_length(fstrMenuCD)== 0) 
	{
		g_Message("EE",	"식단 오류!!\n\n식단을 선택하세요.");
		ed_MENU_CD.setFocus();
		return false;
	}
	
	return true;
}
 /*
 ******************************************************************************************
 * 함  수  명   : fn_SetReport()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 사업장 조회 후 실행 함수
 * 작  성  자   : 박지영
 * 작성  일자   : 2007-12-10  
 ******************************************************************************************
 */
function fn_SetReport()
{
	var strParam, nNewindex;
	
	nNewindex = tab_Main.tabindex;
	
	if (nNewindex == 1)
	{
		var strParam = gv_ozReport + "?" + gfn_getGlobalVariableUrl();
		strParam += "&url=IFIS/FSM00280E_R01.ozr";
		strParam += "&title=" + encodeURI("레시피출력");
		strParam += "&PARAM1="	+ ds_input.getColumn(0,"UPJANG");     // 업장코드
		strParam += "&PARAM2="	+ ds_input.getColumn(0,"MENU_DATE");  // 제공일
		strParam += "&zoom=150";
		strParam += "&paramcnvt=n";
		
		trace(strParam);
		tab_Main.tab2.wb_report.url = strParam;
	}
	else if (nNewindex == 2)
	{
		var strParam = gv_ozReport + "?" + gfn_getGlobalVariableUrl();
		strParam += "&url=IFIS/FSM00280E_R02.ozr";
		strParam += "&title=" + encodeURI("영양성분분석표");
		strParam += "&cnt=6";
		strParam += "&PARAM1="	+ ds_input.getColumn(0,"UPJANG");     // 업장코드
		strParam += "&PARAM2="	+ ds_input.getColumn(0,"MENU_DATE");  // 제공일
		strParam += "&PARAM3="	+ ds_input.getColumn(0,"HALL_CD");    // 식당코드
		strParam += "&PARAM4="	+ fstrMenuCD;                         // 메뉴코드
		strParam += "&PARAM5="	+ chk_DISUSE_RATE.value;              // 폐기율
		strParam += "&PARAM6="	+ chk_ADJUST.value;                   // 수정된레시피
		strParam += "&zoom=150";
		strParam += "&paramcnvt=n";

        trace(strParam);
		tab_Main.tab3.wb_report.url = strParam;
	}
}
//=========================================================================================
// [ PART 6 ]
// component Event 정의 ( User Define function )
// --> component Event의 기요,기능,동작 등 상세내용은 MiPlatform 메뉴얼을 참조하시기 바랍니다.
//=========================================================================================
 /******************************************************************************************
 * 함  수  명   : grd_List_OnHeadClick(obj,nCell,nX,nY,nPivotIndex)
 * 기      능   : 그리드헤드 더블클릭시 Sort
 * 작  성  자   : 박지영
 * 작성  일자   : 2007-12-10  
 ******************************************************************************************
 */
function grd_List_OnHeadClick(obj:Grid, e:GridClickEventInfo)
{
	if (obj.name == "grd_list" && e.cell == 6)	// 가식부량헤드 클릭시 재계산
	{
		var nValue;
		
		for(i=0; i<ds_list.rowcount; i++)
		{
			nValue = Math.round(toNumber(ds_list.getColumn(i,"NEED_QTY")) * (100-toNumber(ds_list.getColumn(i,"DISUSE_RATE"))) / 100 ,2);
			ds_list.setColumn(i,"EDIBLE_QTY",nValue);
		}
	}
	else
	{
		gfn_gridSort(obj, e); //(eval(obj.binddataset), obj, e.cell);
	}
}

/*
 ******************************************************************************************
 * 함  수  명   : btn_pop1_OnClick(obj)
 * 기      능   : 팝업버튼 클릭 -> 사업장 조회
 * 작  성  자   : 박지영
 * 작성  일자   : 2007-12-03  
 ******************************************************************************************
 */
function btn_pop1_OnClick(obj:Button, e:ClickEventInfo)
{
	fn_UpjangPopup();
}

/*
 ******************************************************************************************
 * 함  수  명   : tab_Main_OnChanged(obj,nOldIndex,nNewindex)
 * 기      능   : 텝변경시 Report셋팅
 * 작  성  자   : 박지영
 * 작성  일자   : 2008-02-18  
 ******************************************************************************************
 */
function tab_Main_OnChanged(obj:Tab, e:TabIndexChangeEventInfo)
{
	fn_SetReport();
}

/*
 ******************************************************************************************
 * 함  수  명   : ds_input_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
 * 기      능   : 검색조건셋팅시 식단재조회
 * 작  성  자   : 박지영
 * 작성  일자   : 2008-02-18  
 ******************************************************************************************
 */
function ds_input_OnColumnChanged(obj:Dataset, e:DSColChangeEventInfo)
{
	if (e.columnid == "UPJANG" || e.columnid == "HALL_CD" || e.columnid == "MENU_DATE")
	{
		if (gfn_length(ds_input.getColumn(e.row,"UPJANG"))> 0
			&& gfn_length(ds_input.getColumn(e.row,"HALL_CD"))> 0
			&& gfn_length(ds_input.getColumn(e.row,"MENU_DATE"))== 8)
		{
			fn_MenuSearch();
		}
		
		// 초기화
		ds_list.clearData();
		tab_Main.tab1.btn_add.enable = false;
		tab_Main.tab1.btn_del.enable = false;
		tab_Main.tab1.ed_PR_NUM.value = "";
	}
}

/*
 ******************************************************************************************
 * 함  수  명   : btn_2_OnClick(obj)
 * 기      능   : 식단팝업div
 * 작  성  자   : 박지영
 * 작성  일자   : 2008-02-18  
 ******************************************************************************************
 */
function btn_2_OnClick(obj:Button, e:ClickEventInfo)
{
	fn_OpenPopupDiv();
}

/*
 ******************************************************************************************
 * 함  수  명   : pdiv_menu_OnCloseUp(obj,varReturn,bSelOk)
 * 기      능   : 팝업이 close시 식단변수셋팅
 * 작  성  자   : 박지영
 * 작성  일자   : 2008-02-18  
 ******************************************************************************************
 */
/* 지원하지 않는 이벤트입니다.*/
function pdiv_menu_OnCloseUp(obj,varReturn,bSelOk)
{
	var strMenuCd="";
	var strMenuName="";
	for(i = 0; i< ds_menu.rowcount ; i++)
	{
		if (ds_menu.getColumn(i,"CHK")=="1")
		{
			strMenuCd += " '" + ds_menu.getColumn(i,"MENU_CD") + "' ";
			strMenuName += ds_menu.getColumn(i,"MENU") + " ";
		}
	}
	
	ed_MENU_CD.value = strMenuName;
	fstrMenuCD = gfn_replace(strMenuCd,"'  '","','");
}

function pdiv_menu_grd_list_OnEnterDown(obj:Grid, e:GridEditEventInfo)
{
	//ds_menu.SetColumn(nRow,"CHK","1");
	pdiv_menu.closePopup();
}

/*
 ******************************************************************************************
 * 함  수  명   : ds_list_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
 * 기      능   : 값 수정시 셋팅
 * 작  성  자   : 박지영
 * 작성  일자   : 2008-02-19  
 ******************************************************************************************
 */
function ds_list_OnColumnChanged(obj:Dataset, e:DSColChangeEventInfo)
{
	var nValue,nTOT_QTY,nKG_CONVERT_RATE,nMIN_ORD_QTY,bPOINT_FLAG,nMULTIPLIER_QTY,nPR_QTY;
	
	// 1인량(소수점 : 2) 변경
	if (e.columnid == "NEED_QTY")
	{
		// 1. 가식부량 셋팅(소수점 : 2) 	= 1인량 * (100-폐기율)/100
		nValue = Math.round(toNumber(e.newvalue) * (100-toNumber(ds_list.getColumn(e.row,"DISUSE_RATE"))) / 100 ,2);
		trace('DISUSE_RATE : ' + ds_list.getColumn(e.row,"DISUSE_RATE"));
		trace('EDIBLE_QTY : ' + nValue);
		ds_list.setColumn(e.row,"EDIBLE_QTY",nValue);
		
		// 2. 총사용량 셋팅(소수점 : 2) 	= 1인량 * 예상식수 / 1000
		nValue = Math.round(toNumber(e.newvalue) * toNumber(ds_list.getColumn(e.row,"EXPECT_MEAL_QTY")) / 1000 ,2);
		ds_list.setColumn(e.row,"TOT_QTY",nValue);
		
		trace('nValue : ' + nValue);
		
		// 3. 구매량 셋팅(소수점 : 1) 		= 최소발주,소수점,발주승수량 감안해야함.
		nTOT_QTY 		= toNumber(ds_list.getColumn(e.row,"TOT_QTY"));			// 총사용량
		nKG_CONVERT_RATE= toNumber(ds_list.getColumn(e.row,"KG_CONVERT_RATE"));	// kg환산비율
		nMIN_ORD_QTY 	= toNumber(ds_list.getColumn(e.row,"MIN_ORD_QTY"));		// 최소발주량
		bPOINT_FLAG		= ds_list.getColumn(e.row,"POINT_FLAG");					// 소수점사용가능여부
		nMULTIPLIER_QTY = toNumber(ds_list.getColumn(e.row,"MULTIPLIER_QTY"));	// 발주승수량
		
		trace('nKG_CONVERT_RATE : ' + nKG_CONVERT_RATE);
		
		nPR_QTY 		= nTOT_QTY / nKG_CONVERT_RATE;
		
		if (nPR_QTY < nMIN_ORD_QTY)			// 3.1 최소발주량보다 작은 경우
		{
			if (bPOINT_FLAG == "N")			// 3.1.1 소수점안됨
			{
				nValue = Math.ceil(nMIN_ORD_QTY);
			}
			else							// 3.1.2 소수점가능
			{
				nValue = Math.round(nMIN_ORD_QTY,1);
			}
		}
		else								// 3.2 최소발주량보다 큰 경우
		{
			if (bPOINT_FLAG == "N")			// 3.2.1 소수점안됨
			{
				if (nMULTIPLIER_QTY == 0)	// 3.2.2.1 발주승수량 없음
				{
					nValue = Math.ceil(nPR_QTY);
				}
				else						// 3.2.2.2 발주승수량 있음
				{
					nValue = Math.ceil(Math.ceil(nPR_QTY/nMULTIPLIER_QTY) * nMULTIPLIER_QTY);
				}
			}
			else							// 3.2.2 소수점가능
			{
				if (nMULTIPLIER_QTY == 0)	// 3.2.2.1 발주승수량 없음
				{
					nValue = Math.round(nPR_QTY,1);
				}
				else						// 3.2.2.2 발주승수량 있음
				{
					nValue = Math.round(Math.ceil(nPR_QTY/nMULTIPLIER_QTY) * nMULTIPLIER_QTY,1);
				}
			}
		}
		
		trace('PR_QTY :' + nValue);
		ds_list.setColumn(e.row,"PR_QTY",nValue);
		
		// 4. 총소요금액 셋팅(소수점 : 0)	= 총사용량 * KG단가
		nValue = Math.round(toNumber(ds_list.getColumn(e.row,"TOT_QTY")) * toNumber(ds_list.getColumn(e.row,"KG_PRICE")));
		ds_list.setColumn(e.row,"TOT_AMT",nValue);
		
		// 5. 구매금액 셋팅(소수점 : 0)  	= 구매량 * 구매단가
		nValue = Math.round(toNumber(ds_list.getColumn(e.row,"PR_QTY")) * toNumber(ds_list.getColumn(e.row,"MARGIN_PRICE")));
		ds_list.setColumn(e.row,"PR_AMT",nValue);
		
		// 6. 식재료비율 셋팅
		tab_Main.tab1.ed_PR_NUM.value = numFormat(toNumber(ds_list.getSum("TOT_AMT")) / toNumber(ds_list2.getSum("TOT_SALE_AMT")) * 100,1)+ "%";
	}
}

/*
 ******************************************************************************************
 * 함  수  명   : tab_Main_tab1_grd_list_OnMouseOver(obj,nPosX,nPosY,nRow,nCell,nPivotIndex)
 * 기      능   : 가식부량헤드에 마우스왔을때 툴팁생성
 * 작  성  자   : 박지영
 * 작성  일자   : 2008-02-19  
 ******************************************************************************************
 */
function tab_Main_tab1_grd_list_OnMouseOver(obj:Grid, e:GridMouseEventInfo)
{
	if (e.row == -1 && e.cell == 6)
	{
		tab_Main.tab1.grd_list.tooltiptext = "클릭 시 폐기율에 의해 가식부량이 재계산됩니다.";
	}
	else
	{
		tab_Main.tab1.grd_list.tooltiptext = "";
	}
}
 ]]></Script>
  </Form>
</FDL>
