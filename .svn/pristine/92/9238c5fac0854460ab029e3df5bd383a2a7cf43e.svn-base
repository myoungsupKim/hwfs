<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="../../../default_typedef.xml"/>
  <Form id="WorkForm" onkeydown="WorkForm_OnKeyDown" onload="form_onload" titletext="업장 일일마감" position="absolute 0 0 1252 725" scrollbars="none">
    <Layouts>
      <Layout>
        <Grid autofittype="col,allrow" scrollbars="none" selecttype="cell" enable="true" id="Grid_calendar" useinputpanel="false" autofitminwidth="100" onselectchanged="Grid_calendar_OnCellPosChanged" taborder="2" tabstop="true" usecontextmenu="true" useselcolor="true" visible="true" wheelscrollrow="1" position="absolute 0 126 913 711" readonly="true" anchor="all" userdata="" oncellclick="Grid_calendar_oncellclick">
          <Formats>
            <Format id="Default">
              <Columns>
                <Column size="14"/>
                <Column size="24"/>
                <Column size="60"/>
                <Column size="14"/>
                <Column size="24"/>
                <Column size="60"/>
                <Column size="14"/>
                <Column size="24"/>
                <Column size="60"/>
                <Column size="14"/>
                <Column size="24"/>
                <Column size="60"/>
                <Column size="14"/>
                <Column size="24"/>
                <Column size="60"/>
                <Column size="14"/>
                <Column size="24"/>
                <Column size="60"/>
                <Column size="14"/>
                <Column size="24"/>
                <Column size="60"/>
              </Columns>
              <Rows>
                <Row size="24" band="head"/>
                <Row size="24" band="head"/>
                <Row size="24"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell colspan="3" displaytype="text" style="align:left;"/>
                <Cell col="3" colspan="15" displaytype="text"/>
                <Cell col="18" colspan="3" displaytype="text"/>
                <Cell row="1" colspan="3" displaytype="text" style="color:red;color2:red;" text="Sun"/>
                <Cell row="1" col="3" colspan="3" displaytype="text" text="Mon"/>
                <Cell row="1" col="6" colspan="3" displaytype="text" text="Tue"/>
                <Cell row="1" col="9" colspan="3" displaytype="text" text="Wed"/>
                <Cell row="1" col="12" colspan="3" displaytype="text" text="Thur"/>
                <Cell row="1" col="15" colspan="3" displaytype="text" text="Fri"/>
                <Cell row="1" col="18" colspan="3" displaytype="text" style="color:blue;color2:blue;" text="Sat"/>
              </Band>
              <Band id="body">
                <Cell rowspan="2" colspan="3" displaytype="text" style="align:left;background:EXPR(grid_today_expr2(day0, note0));background2:EXPR(grid_today_expr2(day0, note0));" wordwrap="word">
                  <Cell displaytype="text" style="align:left;" expr="expr:iif( imp0 == '1', '', '')"/>
                  <Cell col="1" displaytype="text" style="align:left;color:EXPR(iif(hol0 == true, 'red', 'red'));color2:EXPR(iif(hol0 == true, 'red', 'red'));" text="bind:day0"/>
                  <Cell col="2" displaytype="text" style="align:left;" text="bind:base_note0" wordwrap="word" editscrollbar="vert"/>
                  <Cell row="1" colspan="3" displaytype="text" style="align:center;color:EXPR(iif(note0 =='미마감', 'red', iif(note0 =='미마감존재', 'red', 'default')));color2:EXPR(iif(note0 =='미마감', 'red', iif(note0 =='미마감존재', 'red', 'default')));color2:EXPR(iif(note0 =='미마감', 'red', iif(note0 =='미마감존재', 'red', 'default')));color2:EXPR(iif(note0 =='미마감', 'red', iif(note0 =='미마감존재', 'red', 'default')));" text="bind:note0" editscrollbar="vert"/>
                </Cell>
                <Cell col="3" rowspan="2" colspan="3" displaytype="text" style="align:left;background:EXPR(grid_today_expr2(day1, note1));background2:EXPR(grid_today_expr2(day1, note1));font: ;">
                  <Cell displaytype="text" style="align:left;" expr="expr:iif( imp1 == '1', '', '')"/>
                  <Cell col="1" displaytype="text" style="align:center;color:EXPR(iif(hol1 == true, 'red', 'default'));color2:EXPR(iif(hol1 == true, 'red', 'default'));" text="bind:day1"/>
                  <Cell col="2" displaytype="text" style="align:left;" text="bind:base_note1"/>
                  <Cell row="1" colspan="3" displaytype="text" style="align:center;color:EXPR(iif(note1 =='미마감', 'red', iif(note1 =='미마감존재', 'red', 'default')));color2:EXPR(iif(note1 =='미마감', 'red', iif(note1 =='미마감존재', 'red', 'default')));color2:EXPR(iif(note0 =='미마감', 'red', iif(note0 =='미마감존재', 'red', 'default')));color2:EXPR(iif(note0 =='미마감', 'red', iif(note0 =='미마감존재', 'red', 'default')));" text="bind:note1" editscrollbar="vert"/>
                </Cell>
                <Cell col="6" rowspan="2" colspan="3" displaytype="text" style="align:left;background:EXPR(grid_today_expr2(day2, note2));background2:EXPR(grid_today_expr2(day2, note2));">
                  <Cell displaytype="text" style="align:left;" expr="expr:iif( imp2 == '1', '', '')"/>
                  <Cell col="1" displaytype="text" style="align:center;color:EXPR(iif(hol2 == true, 'red', 'default'));color2:EXPR(iif(hol2 == true, 'red', 'default'));" text="bind:day2"/>
                  <Cell col="2" displaytype="text" style="align:left;" text="bind:base_note2"/>
                  <Cell row="1" colspan="3" displaytype="text" style="align:center;color:EXPR(iif(note2 =='미마감', 'red', iif(note2 =='미마감존재', 'red', 'default')));color2:EXPR(iif(note2 =='미마감', 'red', iif(note2 =='미마감존재', 'red', 'default')));color2:EXPR(iif(note0 =='미마감', 'red', iif(note0 =='미마감존재', 'red', 'default')));color2:EXPR(iif(note0 =='미마감', 'red', iif(note0 =='미마감존재', 'red', 'default')));" text="bind:note2" editscrollbar="vert"/>
                </Cell>
                <Cell col="9" rowspan="2" colspan="3" displaytype="text" style="align:left;background:EXPR(grid_today_expr2(day3, note3));background2:EXPR(grid_today_expr2(day3, note3));">
                  <Cell displaytype="text" style="align:left;" expr="expr:iif( imp3 == '1', '', '')"/>
                  <Cell col="1" displaytype="text" style="align:center;color:EXPR(iif(hol3 == true, 'red', 'default'));color2:EXPR(iif(hol3 == true, 'red', 'default'));" text="bind:day3"/>
                  <Cell col="2" displaytype="text" style="align:left;" text="bind:base_note3"/>
                  <Cell row="1" colspan="3" displaytype="text" style="align:center;color:EXPR(iif(note3 =='미마감', 'red', iif(note3 =='미마감존재', 'red', 'default')));color2:EXPR(iif(note3 =='미마감', 'red', iif(note3 =='미마감존재', 'red', 'default')));color2:EXPR(iif(note0 =='미마감', 'red', iif(note0 =='미마감존재', 'red', 'default')));color2:EXPR(iif(note0 =='미마감', 'red', iif(note0 =='미마감존재', 'red', 'default')));" text="bind:note3" editscrollbar="vert"/>
                </Cell>
                <Cell col="12" rowspan="2" colspan="3" displaytype="text" style="align:left;background:EXPR(grid_today_expr2(day4, note4));background2:EXPR(grid_today_expr2(day4, note4));">
                  <Cell displaytype="text" style="align:left;" expr="expr:iif( imp4 == '1', '', '')"/>
                  <Cell col="1" displaytype="text" style="align:center;color:EXPR(iif(hol4 == true, 'red', 'default'));color2:EXPR(iif(hol4 == true, 'red', 'default'));" text="bind:day4"/>
                  <Cell col="2" displaytype="text" style="align:left;" text="bind:base_note4"/>
                  <Cell row="1" colspan="3" displaytype="text" style="align:center;color:EXPR(iif(note4 =='미마감', 'red', iif(note4 =='미마감존재', 'red', 'default')));color2:EXPR(iif(note0 =='미마감', 'red', iif(note0 =='미마감존재', 'red', 'default')));color2:EXPR(iif(note0 =='미마감', 'red', iif(note0 =='미마감존재', 'red', 'default')));color2:EXPR(iif(note0 =='미마감', 'red', iif(note0 =='미마감존재', 'red', 'default')));" text="bind:note4" editscrollbar="vert"/>
                </Cell>
                <Cell col="15" rowspan="2" colspan="3" displaytype="text" style="align:left;background:EXPR(grid_today_expr2(day5, note5));background2:EXPR(grid_today_expr2(day5, note5));">
                  <Cell displaytype="text" style="align:left;" expr="expr:iif( imp5 == '1', '', '')"/>
                  <Cell col="1" displaytype="text" style="align:center;color:EXPR(iif(hol5 == true, 'red', 'default'));color2:EXPR(iif(hol5 == true, 'red', 'default'));" text="bind:day5"/>
                  <Cell col="2" displaytype="text" style="align:left;" text="bind:base_note5"/>
                  <Cell row="1" colspan="3" displaytype="text" style="align:center;color:EXPR(iif(note5 =='미마감', 'red', iif(note5 =='미마감존재', 'red', 'default')));color2:EXPR(iif(note5 =='미마감', 'red', iif(note5 =='미마감존재', 'red', 'default')));color2:EXPR(iif(note0 =='미마감', 'red', iif(note0 =='미마감존재', 'red', 'default')));color2:EXPR(iif(note0 =='미마감', 'red', iif(note0 =='미마감존재', 'red', 'default')));" text="bind:note5" editscrollbar="vert"/>
                </Cell>
                <Cell col="18" rowspan="2" colspan="3" displaytype="text" style="align:left;background:EXPR(grid_today_expr2(day6, note6));background2:EXPR(grid_today_expr2(day6, note6));color:blue;color2:blue;">
                  <Cell displaytype="text" style="align:left;" expr="expr:iif( imp6 == '1', '', '')"/>
                  <Cell col="1" displaytype="text" style="align:center;color:EXPR(iif(hol6 == true, 'red', 'blue'));color2:EXPR(iif(hol6 == true, 'red', 'blue'));" text="bind:day6"/>
                  <Cell col="2" displaytype="text" style="align:left;" text="bind:base_note6"/>
                  <Cell row="1" colspan="3" displaytype="text" style="align:center;color:EXPR(iif(note6 =='미마감', 'red', iif(note6 =='미마감존재', 'red', 'default')));color2:EXPR(iif(note6 =='미마감', 'red', iif(note6 =='미마감존재', 'red', 'default')));color2:EXPR(iif(note0 =='미마감', 'red', iif(note0 =='미마감존재', 'red', 'default')));color2:EXPR(iif(note0 =='미마감', 'red', iif(note0 =='미마감존재', 'red', 'default')));" text="bind:note6" editscrollbar="vert"/>
                </Cell>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Grid autoenter="select" autofittype="col" scrollbars="autovert" binddataset="ds_list" cellsizingtype="both" readonly="false" enable="true" cellsizebandtype="allband" id="grid_Slip" useinputpanel="false" autofitminwidth="100" onheadclick="grid_Slip_OnHeadClick" taborder="2" tabstop="true" usecontextmenu="true" useselcolor="true" visible="true" wheelscrollrow="1" position="absolute 921 126 1237 711" selecttype="row" anchor="top right bottom">
          <Formats>
            <Format id="Default">
              <Columns>
                <Column size="92"/>
                <Column size="84"/>
                <Column size="92"/>
              </Columns>
              <Rows>
                <Row size="26" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell displaytype="text" text="마감구분"/>
                <Cell col="1" displaytype="text" text="일자"/>
                <Cell col="2" displaytype="text" text="마감여부"/>
              </Band>
              <Band id="body">
                <Cell displaytype="text" style="align:left;" text="bind:CLOSE_GUBUNNM" suppress="1"/>
                <Cell col="1" displaytype="date" style="align:center;" text="bind:CLOSE_DATE" suppress="0" calendardisplaynulltype="none"/>
                <Cell col="2" displaytype="text" style="align:center;color:EXPR(iif(YN == 'N', 'red', 'default'));color2:EXPR(iif(YN == 'N', 'red', 'default'));font:EXPR(iif(YN == 'N', '굴림,9,bold', 'default'));" text="bind:YN" suppress="0"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Static id="Static01" position="absolute 0 30 1237 97" class="sta_WFSA_Labelbg" anchor="left top right"/>
        <Static id="st_UPJANGQuery" text="업장" userdata="strMAQuery_Upjang" position="absolute 15 38 87 64" class="sta_WFSA_label"/>
        <Static id="Static4" text="조회월" position="absolute 15 65 87 91" class="sta_WFSA_label"/>
        <Static id="Static5" text="마     감&#10;분류선택" position="absolute 301 38 373 89" class="sta_WFSA_label"/>
        <Static id="Static10" text="마감일자" position="absolute 831 71 903 97" class="sta_WFSA_label"/>
        <Button id="btn_DetailCancel" onclick="btn_DetailCancel_OnClick" taborder="8" text="마감취소" position="absolute 1156 41 1221 63" class="btn_WF_Custom" image="" anchor="top right"/>
        <Button id="btn_DetailClose" onclick="btn_DetailClose_OnClick" taborder="9" text="마감" position="absolute 966 41 1017 63" class="btn_WF_Custom" image="" anchor="top right"/>
        <Button id="Button0" onclick="btn_DetailView_OnClick" taborder="10" text="현황조회" position="absolute 1020 41 1085 63" class="btn_WF_Custom" image="" anchor="top right"/>
        <Button id="btn_DetailReqCancel" onclick="btn_DetailReqCancel_OnClick" taborder="11" text="취소신청" position="absolute 1088 41 1153 63" class="btn_WF_Custom" image="" anchor="top right"/>
        <Button id="edtBtn_UPJANGQuery" onclick="edtBtn_UPJANGQuery_OnClick" taborder="1" tabstop="false" position="absolute 491 88 511 109" class="btn_WF_popSearch" text="" image="" visible="false"/>
        <Edit id="edt_UPJANGQuery" imemode="native" onkeydown="edt_UPJANGQuery_OnKeyDown" readonly="true" taborder="15" position="absolute 310 88 492 109" oneditclick="edt_UPJANGQuery_oneditclick" class="edt_WF_Essential" visible="false"/>
        <Static id="Static0" text="~" position="absolute 1002 74 1010 94"/>
        <CheckBox id="chk_4" onclick="chk_0_OnClick" taborder="4" text="급식운영일지마감" userdata="005" value="false" position="absolute 483 65 600 83"/>
        <CheckBox enable="false" id="chk_2" onclick="chk_0_OnClick" taborder="3" text="전도금마감" userdata="003" value="false" position="absolute 1261 30 1347 48" visible="false"/>
        <CheckBox id="chk_0" onclick="chk_0_OnClick" taborder="7" text="매출마감(급식)" userdata="001" value="false" position="absolute 369 41 473 59" visible="true" enable="true"/>
        <CheckBox id="chk_1" onclick="chk_0_OnClick" taborder="4" text="매출마감(장례식)" userdata="006" value="false" position="absolute 483 41 600 59" visible="true" enable="true"/>
        <CheckBox id="chk_3" onclick="chk_0_OnClick" taborder="5" text="재고마감" userdata="004" value="false" position="absolute 369 66 435 84" visible="true" enable="true"/>
        <CheckBox id="chk_5" onclick="chk_0_OnClick" taborder="6" text="전체마감" userdata="007" value="false" position="absolute 746 74 815 92" style="color:blue;" visible="true" enable="true"/>
        <MaskEdit id="cal_CLOSE_DATEQuery" mask="####-##" oneditclick="g_Date_OnFocus" onsetfocus="g_Date_OnFocus" onkillfocus="g_Month_OnKillFocus" taborder="26" type="string" position="absolute 70 66 132 87" style="align:center;"/>
        <Button id="edtBtn_Date" onclick="edtBtn_Date_OnClick" taborder="27" tabstop="false" userdata="cal_CLOSE_DATEQuery" position="absolute 131 66 151 87" class="btn_WF_popSearch" text="" image=""/>
        <Div id="div_cmnBtn" anchor="left top right" taborder="1" url="cmn::CmnBtn.xfdl" text="Div00" scrollbars="none" position="absolute 0 0 1237 30"/>
        <Static id="Static04" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 30 93 40"/>
        <Static id="Static07" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 40 15 61"/>
        <Static id="Static11" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 49 40 59 61"/>
        <Static id="Static09" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 271 48 301 69"/>
        <Static id="Static02" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 810 70 840 91"/>
        <Static id="Static22" text="마감등록" onclick="Static22_onclick" class="sta_WF_Title01" position="absolute 0 108 249 139" anchor="left top"/>
        <Static id="Static03" text="h06" class="Guide01_AreaRed" visible="false" position="absolute 1093 97 1237 103" anchor="top right" onclick="Static03_onclick"/>
        <Static id="Static19" text="h05" class="Guide01_AreaRed" visible="false" position="absolute 0 121 1237 126" anchor="top right"/>
        <Static id="Static06" text="w15" onclick="Static06_onclick" class="Guide01_AreaRed" visible="false" position="absolute 1237 0 1252 710" anchor="top right"/>
        <Static id="Static71" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 710 1252 725" anchor="left bottom"/>
        <Static id="Static08" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 8 61 101 66"/>
        <Static id="Static12" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 60 66 70 87"/>
        <Static id="Static13" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 890 73 900 94"/>
        <Static id="Static14" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 359 50 369 71"/>
        <Static id="Static15" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 1143 31 1236 41"/>
        <Static id="Static16" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1221 41 1236 62"/>
        <MaskEdit id="cal_CLOSE_DATEFR" taborder="29" type="string" mask="####-##-##" onsetfocus="g_Date_OnFocus" onkillfocus="g_Date_OnKillFocus" oneditclick="g_Date_OnFocus" ontextchanged="me_TRANS_MONTHFR_OnChanged" position="absolute 898 72 976 93"/>
        <Button id="edtBtn_Date00" taborder="30" tabstop="false" class="btn_WF_popSearch" position="absolute 976 72 997 93" userdata="cal_CLOSE_DATEFR" onclick="edtBtn_Close_OnClick"/>
        <MaskEdit id="cal_CLOSE_DATETO" taborder="31" type="string" mask="####-##-##" onsetfocus="g_Date_OnFocus" onkillfocus="g_Date_OnKillFocus" oneditclick="g_Date_OnFocus" ontextchanged="me_TRANS_MONTHTO_OnChanged" position="absolute 1018 73 1096 94"/>
        <Button id="edtBtn_Date2" taborder="32" tabstop="false" onclick="edtBtn_Close_OnClick" class="btn_WF_popSearch" position="absolute 1096 73 1117 94" userdata="cal_CLOSE_DATETO"/>
        <Grid id="Grid00" taborder="33" useinputpanel="false" position="absolute 1268 83 1576 174" binddataset="ds_list" visible="false">
          <Formats>
            <Format id="default">
              <Columns>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
              </Columns>
              <Rows>
                <Row band="head" size="24"/>
                <Row band="body" size="24"/>
              </Rows>
              <Band id="head">
                <Cell col="0" disptype="normal" text="CLOSE_DATE"/>
                <Cell col="1" disptype="normal" text="CLOSE_GUBUN"/>
                <Cell col="2" disptype="normal" text="CLOSE_GUBUNNM"/>
                <Cell col="3" disptype="normal" text="UPJANG"/>
                <Cell col="4" disptype="normal" text="UPJANGNMM"/>
                <Cell col="5" disptype="normal" text="YN"/>
              </Band>
              <Band id="body">
                <Cell col="0" disptype="normal" text="bind:CLOSE_DATE"/>
                <Cell col="1" disptype="normal" text="bind:CLOSE_GUBUN"/>
                <Cell col="2" disptype="normal" text="bind:CLOSE_GUBUNNM"/>
                <Cell col="3" disptype="normal" text="bind:UPJANG"/>
                <Cell col="4" disptype="normal" text="bind:UPJANGNMM"/>
                <Cell col="5" disptype="normal" text="bind:YN"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <MaskEdit id="edt_differAmt" taborder="35" value="0" readonly="true" mask="#,###" position="absolute 1011 106 1163 127" anchor="top right" style="background:transparent;border:1 none #c2c2c2ff ;color:red;padding:1 5 0 0;font:gulim,9,bold;"/>
        <Combo id="cbo_muCd" taborder="36" displaynulltext="선택" innerdataset="@ds_muCd" codecolumn="muCd" datacolumn="muNm" onitemchanged="cbo_muCd_onitemchanged" class="cmb_WF_Essential" position="absolute 91 90 301 111" visible="false"/>
        <CheckBox id="chk_6" taborder="37" text="매출마감(폐식용유)" onclick="chk_0_OnClick" position="absolute 609 41 735 59" userdata="008" visible="true" enable="true"/>
        <CheckBox id="chk_7" taborder="38" text="매출마감(특판)" onclick="chk_0_OnClick" position="absolute 745 41 871 59" userdata="009" visible="true" enable="true"/>
        <Button id="btn_detailPop" taborder="39" text="상세보기" onclick="btn_detailPop_onclick" class="btn_WF_CRUD" position="absolute 1171 103 1236 123" anchor="top right" style="font:Gulim,9,bold;"/>
        <UpjangSearchComponent id="edt_upjangNm" titletext="업장 검색용 Component" taborder="40" class="edt_WF_Essential" position="absolute 70 40 252 61" bindDataset="" bindUpjangCodeColumn="" bindUpjangNameColumn="" eventBeforeTrigger="" eventAfterTrigger="fn_upjangNmChanged" roleSetId="ScoUpjang"/>
        <CheckBox id="chk_8" taborder="41" text="매출마감(외식)" onclick="chk_0_OnClick" position="absolute 609 65 735 83" userdata="012"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_cond"/>
      <Dataset id="ds_cbo_CLOSE_GUBUN"/>
      <Dataset id="ds_calendar">
        <ColumnInfo>
          <Column id="day0" size="256" type="STRING"/>
          <Column id="day1" size="256" type="STRING"/>
          <Column id="day2" size="256" type="STRING"/>
          <Column id="day3" size="256" type="STRING"/>
          <Column id="day4" size="256" type="STRING"/>
          <Column id="day5" size="256" type="STRING"/>
          <Column id="day6" size="256" type="STRING"/>
          <Column id="note0" size="256" type="STRING"/>
          <Column id="note1" size="256" type="STRING"/>
          <Column id="note2" size="256" type="STRING"/>
          <Column id="note3" size="256" type="STRING"/>
          <Column id="note4" size="256" type="STRING"/>
          <Column id="note5" size="256" type="STRING"/>
          <Column id="note6" size="256" type="STRING"/>
          <Column id="base_note0" size="256" type="STRING"/>
          <Column id="base_note1" size="256" type="STRING"/>
          <Column id="base_note2" size="256" type="STRING"/>
          <Column id="base_note3" size="256" type="STRING"/>
          <Column id="base_note4" size="256" type="STRING"/>
          <Column id="base_note5" size="256" type="STRING"/>
          <Column id="base_note6" size="256" type="STRING"/>
          <Column id="imp0" size="256" type="STRING"/>
          <Column id="imp1" size="256" type="STRING"/>
          <Column id="imp2" size="256" type="STRING"/>
          <Column id="imp3" size="256" type="STRING"/>
          <Column id="imp4" size="256" type="STRING"/>
          <Column id="imp5" size="256" type="STRING"/>
          <Column id="imp6" size="256" type="STRING"/>
          <Column id="hol0" size="256" type="STRING"/>
          <Column id="hol1" size="256" type="STRING"/>
          <Column id="hol2" size="256" type="STRING"/>
          <Column id="hol3" size="256" type="STRING"/>
          <Column id="hol4" size="256" type="STRING"/>
          <Column id="hol5" size="256" type="STRING"/>
          <Column id="hol6" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_note">
        <ColumnInfo>
          <Column id="date" size="256" type="STRING"/>
          <Column id="note" size="256" type="STRING"/>
          <Column id="sl_gbn" size="256" type="STRING"/>
          <Column id="holiday" size="256" type="STRING"/>
          <Column id="important" size="256" type="STRING"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="date">20050818</Col>
            <Col id="note">Regular Training
(10:00 ~ 17:00)</Col>
            <Col id="sl_gbn">S</Col>
            <Col id="holiday"/>
            <Col id="important"/>
          </Row>
          <Row>
            <Col id="date">20050819</Col>
            <Col id="note">Regular Training
(10:00 ~ 17:00)</Col>
            <Col id="sl_gbn">S</Col>
            <Col id="holiday"/>
            <Col id="important"/>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_base_note">
        <ColumnInfo>
          <Column id="date" size="256" type="STRING"/>
          <Column id="note" size="256" type="STRING"/>
          <Column id="sl_gbn" size="256" type="STRING"/>
          <Column id="holiday" size="256" type="STRING"/>
          <Column id="important" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_list" onrowposchanged="ds_list_OnRowPosChanged">
        <ColumnInfo>
          <Column id="CLOSE_DATE" size="8" type="STRING"/>
          <Column id="CLOSE_GUBUN" size="20" type="STRING"/>
          <Column id="CLOSE_GUBUNNM" size="20" type="STRING"/>
          <Column id="UPJANG" size="22" type="BIGDECIMAL"/>
          <Column id="UPJANGNMM" size="20" type="STRING"/>
          <Column id="YN" size="8" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_CloseMaster"/>
      <Dataset id="ds_common">
        <ColumnInfo>
          <Column id="code" size="256" type="STRING"/>
          <Column id="codename" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_close" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="upjangCd" type="STRING" size="256"/>
          <Column id="occurDate" type="STRING" size="256"/>
          <Column id="sysClass" type="STRING" size="256"/>
          <Column id="closeYn" type="STRING" size="256"/>
          <Column id="rowStatus" type="STRING" size="256"/>
          <Column id="occurSdate" type="STRING" size="256"/>
          <Column id="occurEdate" type="STRING" size="256"/>
          <Column id="closeGubun" type="STRING" size="256"/>
          <Column id="loginSabun" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_closeInfo" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_closeInfoOut" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="lvl" type="STRING" size="256"/>
          <Column id="occurDate" type="STRING" size="256"/>
          <Column id="sysClass" type="STRING" size="256"/>
          <Column id="muCd" type="STRING" size="256"/>
          <Column id="upjangCd" type="STRING" size="256"/>
          <Column id="upjangNm" type="STRING" size="256"/>
          <Column id="payCd" type="STRING" size="256"/>
          <Column id="payCdNm" type="STRING" size="256"/>
          <Column id="payTypeCd" type="STRING" size="256"/>
          <Column id="payTypeNm" type="STRING" size="256"/>
          <Column id="ddddCloseYn" type="STRING" size="256"/>
          <Column id="cnt" type="STRING" size="256"/>
          <Column id="amt" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_muCd" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="muCd" type="STRING" size="256"/>
          <Column id="muNm" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_closeInfoOutPut" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="lvl" type="STRING" size="256"/>
          <Column id="internalUseClass" type="STRING" size="256"/>
          <Column id="occurDate" type="STRING" size="256"/>
          <Column id="sysClass" type="STRING" size="256"/>
          <Column id="muCd" type="STRING" size="256"/>
          <Column id="salsClass" type="STRING" size="256"/>
          <Column id="vatClass" type="STRING" size="256"/>
          <Column id="salQuantity" type="STRING" size="256"/>
          <Column id="uprice" type="STRING" size="256"/>
          <Column id="netAmt" type="STRING" size="256"/>
          <Column id="vatAmt" type="STRING" size="256"/>
          <Column id="svcAmt" type="STRING" size="256"/>
          <Column id="salAmt" type="STRING" size="256"/>
          <Column id="ddddCloseYn" type="STRING" size="256"/>
          <Column id="salsClassNm" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_searchMagam" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="cnt" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_beforeMagam">
        <ColumnInfo>
          <Column id="upjang" type="STRING" size="256"/>
          <Column id="closeGubun" type="STRING" size="256"/>
          <Column id="closeDate" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <InitValue>
      <CheckBox id="chk_1" userdata="006"/>
      <CheckBox id="chk_5" userdata="007"/>
      <CheckBox id="chk_6" userdata="006"/>
      <CheckBox id="chk_7" userdata="006"/>
      <CheckBox id="chk_8" userdata="006"/>
    </InitValue>
    <Bind>
      <BindItem id="item0" compid="cbo_muCd" propid="value" datasetid="ds_search" columnid="muCd"/>
    </Bind>
    <Script type="xscript4.0"><![CDATA[include "U_lib::lib_conversionCom.xjs";
include "lib::lib_com.xjs";
include "lib::SMCommon.xjs";	//영업회계 공통 스크립트
/*
 ******************************************************************************************
 * 시스템구분   : FS시스템/시스템공통/템플릿 1
 * 프로그램명   : Sam_Form_Basic1.XML
 * 기      능   : 표준 UI Form
 * 작  성  자   : 구종화
 * 작성  일자   : 2007-11-16
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
               : 박은규 2012-06-04 CSR#(CH201205_00175) 요청자:박현주(FS지원팀)
                       월마감작업 추가(월-마감구분, 공통코드:MA0044)
 ******************************************************************************************
 */
//=========================================================================================
// [ PART 1 ]
// Form에서 Include 할 내용을 정의
//
//=========================================================================================
//@@컨버터에서 주석처리 #include "lib::sc_comon.js"
//@@컨버터에서 주석처리 #include "lib::sc_sql_common.js"
//@@컨버터에서 주석처리 #include "lib::tit_comm_0001.js"
//@@컨버터에서 주석처리 #include "lib::ma_common.js"

//@@컨버터에서 주석처리 #include "Lib::lib_Date.js"
//@@컨버터에서 주석처리 #include "Lib::lib_Dataset.js"

//=========================================================================================
// [ PART 2 ]
// Form에서 사용될 전역변수를 선언
//
//=========================================================================================
var
  f_CurrDate;
var gOccrDate	= "";
var gSysClass	= "";
var gUpjangCd	= "";
var fv_retVal	= "";
var arrArg;
var fv_init = "";
var fv_all = "";

var fv_isSearchEvent = false;
var tr_info = true;
//=========================================================================================S
// [ PART 3 ]
// Form Loading 시 작업 정의
//
//=========================================================================================
function form_onload(obj:Form, e:LoadEventInfo)
{
	gfn_formOnLoad(obj);

    var F_ArrCol          = new Array(-1);
    var F_ArrColType      = new Array(-1);
    
	//init_btn_setup();	// Button 초기화
	fsp_init(this);
	
	// 사업부 콤보 조회
	fn_setMuCd();

	
	
	/*
	#############################################################################################################
	공통코드 SETTING
	#############################################################################################################
	*/
	//edt_UPJANGQuery.userdata = g_Upjang;
	//edt_UPJANGQuery.value     = g_UpjangNm;
	
	//edt_UPDEPT_IDQuery.userdata = g_Tm_Cd;
	//edt_UPDEPT_IDQuery.value     = g_Tm_Nm;
		
	eval("edtBtn_" + gfn_subStr(edt_UPJANGQuery.name, 4)).userdata = edt_UPJANGQuery.value;

    f_CurrDate = fn_CurrDateWeek();
	cal_CLOSE_DATEQuery.value   = f_CurrDate;	
	
	cal_CLOSE_DATEFR.value   = f_CurrDate;	
	cal_CLOSE_DATETO.value   = f_CurrDate;	
	
    //마감관리자 정보취득##############################################################################
    //btn_DetailCancel.Enable = False;
    fn_GetCloseMasterGubun(ds_CloseMaster);
    
    if (ds_CloseMaster.rowcount > 0){
    
		//btn_DetailCancel.Enable = True;
		for (i=0;i<8;i++){
			
			eval("chk_" + i).enable =false;
			if (ds_CloseMaster.findRowExpr("CODE=='" + eval("chk_" + i).userdata + "'") != -1){
			
					eval("chk_" + i).enable = true;
			}
   	    }
    }
    
    // 외식일때 급식 마감 버튼 비활성화 처리
	if(g_Mu_Cd == "2003"){
		for(var i=0; i<8;i++){
			eval("chk_" + i).enable = false;
		}
		// 외식도 재고마감을 하기때문에 재고마감은 활성화처리 - 2015.10.22
		chk_3.enable = true;
		chk_6.enable = true;    //김진형차장 추가 요청 - 20151124
		chk_7.enable = true;    //김진형차장 추가 요청 - 20151124
	}else{
		// 급식일때는 매출마감(외식)만 비활성화 처리
		chk_8.enable = false;
	}
	
    //사업장 권한 셋팅#############################################################################
	//fn_SetAuth("","","edt_UPJANGQuery", "edtBtn_UPJANGQuery");
    //사업장 권한 셋팅#############################################################################    
	/*
	#############################################################################################################
	공통코드 SETTING
	#############################################################################################################
	*/
   
   //전도금정산 DISABLE 처리
   chk_2.enable = false;
}



//=========================================================================================
// [ PART 4 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,도움말,form닫기)
//
//=========================================================================================
function fn_search()
{
	//alert("fn_search()");
	/*
	if (gfn_isNull(flag)) {
		fv_init = "";
		if (chk_5.value) fv_all = "1";
		else fv_all = "";
		
		fn_search("1");
		return;	
	}
*/
	if (!before_SelectCheck())
		return;

	fn_DataSetAllClear();
	// 필터 해제
	ds_list.filter("");
	
	ds_beforeMagam.clearData();

	//마감리스트############################################################
    fsp_clear(this);
    
   
    if (Get_chk_Id() == "007"){// 전체마감
		fsp_addSearch(this, "ma/mag:MAG10120E_S002");
	}else if (Get_chk_Id() == "001"){ // 매출마감
		fsp_addSearch(this, "ma/mag:MAG10120E_S006");
	}else if (Get_chk_Id() == "006"){ // 장례식
		fsp_addSearch(this, "ma/mag:MAG10120E_S007");
	}else if (Get_chk_Id() == "008"){ // 폐식용유
		fsp_addSearch(this, "ma/mag:MAG10120E_S010");
	}else if (Get_chk_Id() == "009"){ //특판
		fsp_addSearch(this, "ma/mag:MAG10120E_S011");
	}else if (Get_chk_Id() == "012"){ // 매출(외식)
		fsp_addSearch(this, "ma/mag:MAG10120E_S014");
	}else{
		fsp_addSearch(this, "ma/mag:MAG10120E_S001");
	}
	

	ds_cond.clear();
	ds_cond.addColumn("UPJANG","BIGDECIMAL",256);
	ds_cond.addColumn("CLOSE_GUBUN","STRING",256);
	ds_cond.addColumn("CLOSE_DATE","STRING",256);		
	
	ds_cond.addRow();
	ds_cond.setColumn(ds_cond.rowposition, "UPJANG",  edt_upjangNm.getUpjangCode() );
	ds_cond.setColumn(ds_cond.rowposition, "CLOSE_GUBUN",  Get_chk_Id());
	ds_cond.setColumn(ds_cond.rowposition, "CLOSE_DATE",  gfn_subStr(cal_CLOSE_DATEQuery.value, 0, 6));
	
	
	

    http.Sync = true;
    
	fsp_callService(this, "", "", "ds_cond=ds_cond","ds_list=ds_list","","fn_SearchDetail()");
	
	http.Sync = false;	
	//마감리스트############################################################

	
	//fv_init = "1";
	
	// 마감처리/취소 입력 파라미터 조회
	fn_setSearchInfo();
	//trace(ds_list.saveXML());
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 마감처리/취소 조회시 프로시져 입력 파라미터 세팅
 *---------------------------------------------------------------------------------------------*/
function fn_setSearchInfo(){
	gOccrDate	= gfn_subStr(cal_CLOSE_DATEQuery.value, 0, 6);
	gSysClass	= "";
	gUpjangCd	= edt_upjangNm.getUpjangCode();
		
}

function fn_SearchDetail(int_TabIndex)
{
	/*
	if (Length(Tab_UPJANG.tab1.st_CC_CD.Value) == 0)
		return;


	//업장정보GET############################################################
    tit_clearActionInfo(this);
	tit_addSearchActionInfo(this, "ma/mas:MAS10020E_S002");

	ds_cond.Clear();
	ds_cond.AddColumn("CC_CD","VARCHAR",256);
	ds_cond.AddRow();

	ds_cond.SetColumn(ds_cond.Row, "CC_CD",  Tab_UPJANG.tab1.st_CC_CD.Value);


	tit_callService(this, "", "", "ds_cond=ds_cond","ds_deptHis=ds_list","","");
	//업장정보GET############################################################



	*/
	

	//alert("close_date : " + cal_CLOSE_DATEQuery.value);
	
     for (i=0;i<ds_list.rowcount;i++){
	    
	    var nRow = ds_note.addRow();
// 	     
// 	    ds_note.setColumn(nRow,"date",ds_list.getColumn(i,"CLOSE_DATE"));
// 	    ds_note.setColumn(nRow,"note",ds_list.getColumn(i,"NOTE"));
	     
// 	     
		CopyColumn(ds_note,i,"date", ds_list, i, "CLOSE_DATE");
		CopyColumn(ds_note,i,"note", ds_list, i, "NOTE");
		
	}
	
	/*if(Get_chk_Id() == "007" && fv_all == "1"){
		ds_list.filter("CLOSE_DATE=='"+cal_CLOSE_DATEQuery.value+"'");
	}*/

	// alert(ds_note.saveXML());
	
	var yyyymm;
	yyyymm = gfn_subStr(cal_CLOSE_DATEQuery.value, 0, 6);	

	if (gfn_getYearMonth() == yyyymm) {
		
		fv_isSearchEvent = true;
		
// 		if(Get_chk_Id() == "007"){
// 			ds_list.filter("CLOSE_DATE=='"+f_CurrDate +"'");
// 		}
// 		
// 		ds_list.selectRow(ds_list.findRowExpr("CLOSE_DATE=='" + f_CurrDate + "'"));
	}
	else {
		fv_isSearchEvent = false;
	}
			    
	 DrawCalendar(ds_calendar, Grid_calendar, ds_base_note, ds_note, yyyymm);

}




function before_SelectCheck()
{


	if (numFormat(edt_upjangNm.getUpjangCode() )== "0")
	{
	
		gfn_alert("업장을 지정하여 주십시요.");
		edt_upjangNm.setFocus();
		return false;
	}

	else if (cal_CLOSE_DATEQuery.value == "")
	{
	
		gfn_alert("조회월을 지정하여 주십시요.");
		cal_CLOSE_DATEQuery.setFocus();
		return false;
	}
	
	else if (gfn_length(Get_chk_Id())== 0)
	{
	
		gfn_alert("마감구분을 지정하여 주십시요.");		
		return false;
	}
		
	return true;
}

function before_SaveCheck(str_Gubun)
{

		//권한에 따른 저장/삭제 가능체크#########################################################################

		if (Get_chk_Id() != "007"){
			
			if (ds_CloseMaster.findRowExpr("CODE=='" + Get_chk_Id() + "'") == -1){
					
				//if (
				//		//(g_AuthLevel != "99") &&
				//		(g_AuthLevel < "99") &&
				//		(!fn_GetSaveAuthBy_AuthLevel(edt_upjangNm.getUpjangCode() ))
				//	)  {
				//	return false;	
				//	}				
			}
		}
		//권한에 따른 저장/삭제 가능체크#########################################################################
		//============================================================================================
		// (2013-07-18 추가) 시작
		// 김장욱 2013-07-18 CSR#() 
		// 마감 된 건은 마감이 다시 안되게 한다. (자체수정)
		//============================================================================================				
		//if (ds_list.GetColumn(ds_list.row, "YN") == "Y")
		//{
		//	alert("이미 마감되었습니다." + "\n" + "확인하여 주십시요.");
		//	return;
		//}
		//============================================================================================
		// (2013-07-18 추가) 끝
		//============================================================================================
		
		if ( 
			(ds_list.rowcount == 0) ||
			(numFormat(edt_upjangNm.getUpjangCode() )== "0") ||
			(!confirm("해당자료를 마감하시겠습니까?"))
		   )
		{

			return;
		}

	    if (str_Gubun == "Master"){

		
			if (numFormat(edt_upjangNm.getUpjangCode() )== "0"){			
			
				gfn_alert("업장이 누락되었습니다." + "\n" + 
					  "확인하여 주십시요.");
				edt_upjangNm.setFocus();				
				return false;
			}
			
			if (gfn_length(Get_chk_Id())== 0){			
			
				gfn_alert("마감구분이 누락되었습니다." + "\n" + 
					  "확인하여 주십시요.");				
				return false;
			}
			
			
			var fDate = cal_CLOSE_DATEFR.value;
			var tDate = cal_CLOSE_DATETO.value; 
			
			if ((gfn_length(fDate.toString())== 0) || (gfn_length(tDate.toString())== 0))
			{			
			
				gfn_alert("마감일자가 누락되었습니다." + "\n" + "확인하여 주십시요.");
					
				return false;
			}	
					
			if (cal_CLOSE_DATETO.value < cal_CLOSE_DATEFR.value){
			
				gfn_alert("종료일자가 시작일자보다 이전 일수 없습니다." + "\n" + 
					  "확인하여 주십시요.");
				cal_CLOSE_DATEFR.setFocus();		
				return false;
			}
			
			if (gfn_subStr(fDate, 0, 6)!= gfn_subStr(tDate, 0, 6)){
			
				gfn_alert("마감일자의 기간은 동일한 월로 지정해야 합니다." + "\n" + 
					  "확인하여 주십시요.");
				cal_CLOSE_DATEFR.setFocus();		
				return false;
			}			
			
			//권한에 따른 분류필요!!!!
			if (ds_CloseMaster.rowcount == 0){
			
				if (
					(fDate > f_CurrDate) ||
					(tDate > f_CurrDate)
				   )
				{	
				
					gfn_alert("마감일자는 오늘날짜보다 클 수 없습니다." + "\n" + 
						  "확인하여 주십시요.");
					cal_CLOSE_DATEFR.setFocus();		
					return false;
				}															
			}
			
		// 매출마감은 From - To 로 마감할 수 없고 하루씩 가능 (재고, 급식운영일지 마감 제외)
		if(Get_chk_Id() == "007"){
			if(cal_CLOSE_DATEFR.value != cal_CLOSE_DATETO.value){
				gfn_alert("전체마감은 하루씩 마감이 가능 합니다.\n\n마감일자를 동일하게 설정 해주세요.");
				return false;
			}
		}
		
		// 현재 날짜 이전에 미마감된건 체크	
		/*if(ds_searchMagam.getColumn(0, "cnt") !=0){
			gfn_alert(cal_CLOSE_DATEFR.value+" 날짜 이전에 미마감된 건이 존재 합니다.");
			return;
		}*/
				
														
			// action 정보 초기화
			fsp_clear(this);			
			
			// 전체마감이면
			if (Get_chk_Id() == "007"){
				//fsp_addSingle(this, "ma/mag:MAG10120E_D002");
				//fsp_addSingle(this, "ma/mag:MAG10120E_I002");
				
				if(parseFloat(edt_differAmt.value) != 0){											
					gfn_alert("매출금액과 지불금액의 차액[ "+gfn_numFormat(parseFloat(edt_differAmt.value),1000)+" ]이 발생합니다.\n\n마감처리 할 수 없습니다.");
					return;
				}
				// 매출(급식)
				/*ds_close.clearData();
				ds_close.addRow();
				ds_close.setColumn(0, "occurDate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE"));
				ds_close.setColumn(0, "sysClass", 	"11");
				ds_close.setColumn(0, "upjangCd",	gUpjangCd);
				ds_close.setColumn(0, "closeYn",	"N");		//마감유무
				gfn_saveCloseProc(this, "closeProc_11", "ds_close"); // 프로시져*/
				
				ds_close.clearData();
				ds_close.addRow();
				ds_close.setColumn(0, "occurSdate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE") );
				ds_close.setColumn(0, "occurEdate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE") );
				ds_close.setColumn(0, "sysClass", 	"11");
				ds_close.setColumn(0, "closeGubun",	"001");
				ds_close.setColumn(0, "loginSabun", g_EmpNo);
				ds_close.setColumn(0, "upjangCd",	gUpjangCd );
				ds_close.setColumn(0, "closeYn",	"N");		//마감유무
				
				var strSvcID    = "closeProc_11";
				var strURL      = "ma/mas/closeMgmt/closeProc.xdo";
				var strInDs     = "ds_close=ds_close:U";
				var strOutDs    = "";
				var strArg      = "";
				var strCallback = "fn_callBack";
				var bAsync      = true;
				
				gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
				
				/*// 매출(장례식)
				ds_close.clearData();
				ds_close.addRow();
				ds_close.setColumn(0, "occurDate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE"));
				ds_close.setColumn(0, "sysClass", 	"16");
				ds_close.setColumn(0, "upjangCd",	gUpjangCd);
				ds_close.setColumn(0, "closeYn",	"N");		//마감유무
				gfn_saveCloseProc(this, "closeProc", "ds_close"); // 프로시져
				
				// 매출(폐식용유)
				ds_close.clearData();
				ds_close.addRow();
				ds_close.setColumn(0, "occurDate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE"));
				ds_close.setColumn(0, "sysClass", 	"19");
				ds_close.setColumn(0, "upjangCd",	gUpjangCd);
				ds_close.setColumn(0, "closeYn",	"N");		//마감유무
				gfn_saveCloseProc(this, "closeProc", "ds_close"); // 프로시져
				
				// 매출(특판)
				ds_close.clearData();
				ds_close.addRow();
				ds_close.setColumn(0, "occurDate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE"));
				ds_close.setColumn(0, "sysClass", 	"17");
				ds_close.setColumn(0, "upjangCd",	gUpjangCd);
				ds_close.setColumn(0, "closeYn",	"N");		//마감유무
				gfn_saveCloseProc(this, "closeProc", "ds_close"); // 프로시져*/
				//============================================================================================
				// (2013-07-18 추가) 시작
				// 김장욱 2013-07-18 CSR#(SR201306_05315) 요청자:이혜은(FS기획팀)
				// 마감, 마감취소시 이력생성
				//============================================================================================				
	//fsp_addSingle(this, "ma/mag:MAG10120E_I003");
				//============================================================================================
				// (2013-07-18 추가) 끝
				//============================================================================================								
				
			}
			else {
					if(Get_chk_Id() == "001"){	//매출(급식)
					
					if(parseFloat(edt_differAmt.value) != 0){											
						gfn_alert("매출금액과 지불금액의 차액[ "+gfn_numFormat(parseFloat(edt_differAmt.value),1000)+" ]이 발생합니다.\n\n마감처리 할 수 없습니다.");
						return;
					}	
		
					/*ds_close.clearData();
					ds_close.addRow();
					ds_close.setColumn(0, "occurDate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE"));
					ds_close.setColumn(0, "sysClass", 	"11");
					ds_close.setColumn(0, "upjangCd",	gUpjangCd);
					ds_close.setColumn(0, "closeYn",	"N");		//마감유무
							
						if(gfn_confirm("마감처리 하시겠습니까?")){
							gfn_saveCloseProc(this, "closeProc", "ds_close");
					}else{
					
						return;
					}*/
						
						ds_close.clearData();
						ds_close.addRow();
						ds_close.setColumn(0, "occurSdate", cal_CLOSE_DATEFR.value );
						ds_close.setColumn(0, "occurEdate", cal_CLOSE_DATETO.value );
						ds_close.setColumn(0, "sysClass", 	"11");
						ds_close.setColumn(0, "closeGubun",	"001");
						ds_close.setColumn(0, "loginSabun", g_EmpNo);
						ds_close.setColumn(0, "upjangCd",	gUpjangCd );
						ds_close.setColumn(0, "closeYn",	"N");		//마감유무
						
						var strSvcID    = "closeProc";
						var strURL      = "ma/mas/closeMgmt/closeProc.xdo";
						var strInDs     = "ds_close=ds_close:U";
						var strOutDs    = "";
						var strArg      = "";
						var strCallback = "fn_callBack";
						var bAsync      = true;
						
						gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);	
					
					}else if(Get_chk_Id() == "006"){	//매출(장례식)
					
						if(parseFloat(edt_differAmt.value) != 0){											
							gfn_alert("매출금액과 지불금액의 차액[ "+gfn_numFormat(parseFloat(edt_differAmt.value),1000)+" ]이 발생합니다.\n\n마감처리 할 수 없습니다.");
							return;
						}
					
						/*ds_close.clearData();
						ds_close.addRow();
						ds_close.setColumn(0, "occurDate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE"));
						ds_close.setColumn(0, "sysClass", 	"16");
						ds_close.setColumn(0, "upjangCd",	gUpjangCd);
						ds_close.setColumn(0, "closeYn",	"N");		//마감유무
						
						if(gfn_confirm("마감처리 하시겠습니까?")){
							gfn_saveCloseProc(this, "closeProc", "ds_close");
						}else{
							return;
						}*/
							
						ds_close.clearData();
						ds_close.addRow();
						ds_close.setColumn(0, "occurSdate", cal_CLOSE_DATEFR.value );
						ds_close.setColumn(0, "occurEdate", cal_CLOSE_DATETO.value );
						ds_close.setColumn(0, "sysClass", 	"16");
						ds_close.setColumn(0, "closeGubun",	"006");
						ds_close.setColumn(0, "loginSabun", g_EmpNo);
						ds_close.setColumn(0, "upjangCd",	gUpjangCd );
						ds_close.setColumn(0, "closeYn",	"N");		//마감유무
					
						var strSvcID    = "closeProc";
						var strURL      = "ma/mas/closeMgmt/closeProc.xdo";
						var strInDs     = "ds_close=ds_close:U";
						var strOutDs    = "";
						var strArg      = "";
						var strCallback = "fn_callBack";
						var bAsync      = true;
						
						gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);	

					}else if(Get_chk_Id() == "008"){	//매출(폐식용유)
					
						if(parseFloat(edt_differAmt.value) != 0){											
							gfn_alert("매출금액과 지불금액의 차액[ "+gfn_numFormat(parseFloat(edt_differAmt.value),1000)+" ]이 발생합니다.\n\n마감처리 할 수 없습니다.");
							return;
						}
					
						/*ds_close.clearData();
						ds_close.addRow();
						ds_close.setColumn(0, "occurDate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE"));
						ds_close.setColumn(0, "sysClass", 	"19");
						ds_close.setColumn(0, "upjangCd",	gUpjangCd);
						ds_close.setColumn(0, "closeYn",	"N");		//마감유무
						
						if(gfn_confirm("마감처리 하시겠습니까?")){
							gfn_saveCloseProc(this, "closeProc", "ds_close");
						}else{
							return;
						}*/
						
						ds_close.clearData();
						ds_close.addRow();
						ds_close.setColumn(0, "occurSdate", cal_CLOSE_DATEFR.value );
						ds_close.setColumn(0, "occurEdate", cal_CLOSE_DATETO.value );
						ds_close.setColumn(0, "sysClass", 	"19");
						ds_close.setColumn(0, "closeGubun",	"008");
						ds_close.setColumn(0, "loginSabun", g_EmpNo);
						ds_close.setColumn(0, "upjangCd",	gUpjangCd );
						ds_close.setColumn(0, "closeYn",	"N");		//마감유무
							
						var strSvcID    = "closeProc";
						var strURL      = "ma/mas/closeMgmt/closeProc.xdo";
						var strInDs     = "ds_close=ds_close:U";
						var strOutDs    = "";
						var strArg      = "";
						var strCallback = "fn_callBack";
						var bAsync      = true;	
						
						gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
					
					}else if(Get_chk_Id() == "009"){	// 매출(특판)
					
						if(parseFloat(edt_differAmt.value) != 0){											
							gfn_alert("매출금액과 지불금액의 차액[ "+gfn_numFormat(parseFloat(edt_differAmt.value),1000)+" ]이 발생합니다.\n\n마감처리 할 수 없습니다.");
							return;
						}
					
						/*ds_close.clearData();
						ds_close.addRow();
						ds_close.setColumn(0, "occurDate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE"));
						ds_close.setColumn(0, "sysClass", 	"17");
						ds_close.setColumn(0, "upjangCd",	gUpjangCd);
						ds_close.setColumn(0, "closeYn",	"N");		//마감유무
						
						if(gfn_confirm("마감처리 하시겠습니까?")){
							gfn_saveCloseProc(this, "closeProc", "ds_close");
						}else{
							return;
						}*/
							
						ds_close.clearData();
						ds_close.addRow();
						ds_close.setColumn(0, "occurSdate", cal_CLOSE_DATEFR.value);
						ds_close.setColumn(0, "occurEdate", cal_CLOSE_DATETO.value );
						ds_close.setColumn(0, "sysClass", 	"17");
						ds_close.setColumn(0, "closeGubun",	"009");
						ds_close.setColumn(0, "loginSabun", g_EmpNo);
						ds_close.setColumn(0, "upjangCd",	gUpjangCd );
						ds_close.setColumn(0, "closeYn",	"N");		//마감유무
							
						var strSvcID    = "closeProc";
						var strURL      = "ma/mas/closeMgmt/closeProc.xdo";
						var strInDs     = "ds_close=ds_close:U";
						var strOutDs    = "";
						var strArg      = "";
						var strCallback = "fn_callBack";
						var bAsync      = true;
						
						gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);	
						
					}else if(Get_chk_Id() == "012"){	// 매출(외식) - 2015.10.22 추가
						ds_close.clearData();
						ds_close.addRow();
						ds_close.setColumn(0, "occurSdate", cal_CLOSE_DATEFR.value);
						ds_close.setColumn(0, "occurEdate", cal_CLOSE_DATETO.value );
						ds_close.setColumn(0, "sysClass", 	"12");
						ds_close.setColumn(0, "closeGubun",	"012");
						ds_close.setColumn(0, "loginSabun", g_EmpNo);
						ds_close.setColumn(0, "upjangCd",	gUpjangCd );
						ds_close.setColumn(0, "closeYn",	"N");		//마감유무
							
						var strSvcID    = "closeProc";
						var strURL      = "ma/mas/closeMgmt/closeProc.xdo";
						var strInDs     = "ds_close=ds_close:U";
						var strOutDs    = "";
						var strArg      = "";
						var strCallback = "fn_callBack";
						var bAsync      = true;
						
						gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
					}
					
				// 프로시져 완료후 히스토리 저장하기 위해 주석처리
				if(Get_chk_Id() != "001" && Get_chk_Id() != "006" && Get_chk_Id() != "008" && Get_chk_Id() != "009" && Get_chk_Id() != "007" && Get_chk_Id() != "012"){
					fsp_addSingle(this, "ma/mag:MAG10120E_D001");
					fsp_addSingle(this, "ma/mag:MAG10120E_I001");
					
				}
				//============================================================================================
				// (2013-07-18 추가) 시작
				// 김장욱 2013-07-18 CSR#(SR201306_05315) 요청자:이혜은(FS기획팀)
				// 마감, 마감취소시 이력생성
				//============================================================================================				
				// ----프로시져 완료후 히스토리 저장 하기위해 주석처리
				//fsp_addSingle(this, "ma/mag:MAG10120E_I003");
				//============================================================================================
				// (2013-07-18 추가) 끝
				//============================================================================================								
				
			}
				
			//alert(cal_CLOSE_DATEFR.Value);
			//============================================================================================
			// (2013-07-18 변경) 시작
			// 김장욱 2013-07-18 CSR#(SR201306_05315) 요청자:이혜은(FS기획팀)
			// 마감, 마감취소시 이력생성
			//============================================================================================				

			//tit_callService(this, "", "", "", "",  "UPJANG=" + quote(edt_UPJANGQuery.UserData) + " CLOSE_GUBUN=" + quote(Get_chk_Id()) + 
            //                           " CLOSE_DATEFR=" + quote(cal_CLOSE_DATEFR.Value) + " CLOSE_DATETO=" + quote(cal_CLOSE_DATETO.Value), "fn_AfterSaveSearch()");											
			//wrapQuote(
			
			if(Get_chk_Id() != "001" && Get_chk_Id() != "006" && Get_chk_Id() != "008" && Get_chk_Id() != "009" && Get_chk_Id() != "007" && Get_chk_Id() != "012"){
				fsp_callService(this, 
								"", 
								"", 
								"", 
								"",  
								" UPJANG=" + edt_upjangNm.getUpjangCode() + 
								" CLOSE_GUBUN=" +  Get_chk_Id()  + 
								" CLOSE_DATEFR=" +  cal_CLOSE_DATEFR.value  + 
								" CLOSE_DATETO=" +  cal_CLOSE_DATETO.value  + 
								" CLOSE_YN=" +   "Y" , 
								"fn_saveHistory()");
              }
			//============================================================================================
			// (2013-07-18 변경) 끝
			//============================================================================================								                            											            

		}
		return true;
			
}
			
function fn_AfterSaveSearch(errCode, errMsg)
{

	if (errCode != 0){
	
		return;
	}
	gfn_alert("저장되었습니다.");
	
	fn_search();
}

function fn_AfterSave(errCode, errMsg)
{

	if (errCode != 0){
	
		return;
	}
	
	fn_search();
}
			
function before_DeleteCheck()
{
       
		//권한에 따른 저장/삭제 가능체크#########################################################################
		if (Get_chk_Id() != "007"){
		
			if (ds_CloseMaster.findRowExpr("CODE=='" + Get_chk_Id() + "'") == -1){					
				
				//if (
				//		//(g_AuthLevel != "99") &&
				//		(g_AuthLevel < "99") &&
				//		(!fn_GetSaveAuthBy_AuthLevel(edt_upjangNm.getUpjangCode() ))
				//	)  return false;
		    				
			}
		}
		//권한에 따른 저장/삭제 가능체크#########################################################################
		//============================================================================================
		// (2013-07-18 추가) 시작
		// 김장욱 2013-07-18 CSR#() 
		// 마감취소 된 건은 마감취소가 다시 안되게 한다. (자체수정)
		//============================================================================================				
		//if (ds_list.GetColumn(ds_list.row, "YN") == "N")
		//{
		//	alert("이미 마감취소되었습니다." + "\n" + "확인하여 주십시요.");
		//	return;
		//}
		//============================================================================================
		// (2013-07-18 추가) 끝
		//============================================================================================				

		if ( 
			(ds_list.rowcount == 0) ||
			(numFormat(edt_upjangNm.getUpjangCode() )== "0") ||
			(!confirm("해당자료를 마감취소하시겠습니까?"))
		   )
		{
	
			return;
		}
		
	
 		if (ds_list.rowcount == 0){

			return;
		}
	
	    
		
		if (numFormat(edt_upjangNm.getUpjangCode() )== "0"){			
		
			gfn_alert("업장이 누락되었습니다." + "\n" + 
				  "확인하여 주십시요.");
			edt_upjangNm.setFocus();				
			return false;
		}
		
		if (gfn_length(Get_chk_Id())== 0){			
		
			gfn_alert("마감구분이 누락되었습니다." + "\n" + 
				  "확인하여 주십시요.");				
			return false;
		}
		
		if (
			(gfn_length(cal_CLOSE_DATEFR.value.toString())== 0) ||
			(gfn_length(cal_CLOSE_DATETO.value.toString())== 0)
		   )
		{			
		
			gfn_alert("마감일자가 누락되었습니다." + "\n" + 
				  "확인하여 주십시요.");
				
			return false;
		}	
				
		if (cal_CLOSE_DATETO.value < cal_CLOSE_DATEFR.value){
		
			gfn_alert("종료일자가 시작일자보다 이전 일수 없습니다." + "\n" + 
				  "확인하여 주십시요.");
			cal_CLOSE_DATEFR.setFocus();		
			return false;
		}
		
		if (gfn_subStr(cal_CLOSE_DATEFR.value, 0, 6)!= gfn_subStr(cal_CLOSE_DATETO.value, 0, 6)){
		
			gfn_alert("마감일자의 기간은 동일한 월로 지정해야 합니다." + "\n" + 
				  "확인하여 주십시요.");
			cal_CLOSE_DATEFR.setFocus();		
			return false;
		}			
		
		//권한에 따른 분류필요!!!!

		if (ds_CloseMaster.rowcount == 0){
		
			if (
				(cal_CLOSE_DATEFR.value > f_CurrDate) ||
				(cal_CLOSE_DATETO.value > f_CurrDate)
			   )
			{	
			
				gfn_alert("마감일자는 오늘날짜보다 클 수 없습니다." + "\n" + 
					  "확인하여 주십시요.");
				cal_CLOSE_DATEFR.setFocus();		
				return false;
			}		
		 	
		 	//입금마감은 익익일 10시30분까지###################################
		 	if (Get_chk_Id() == "002"){
		 	
				if (fn_GetCloseCHK002(ds_cond, cal_CLOSE_DATEFR.value) == "FALSE")
				{	
				
					gfn_alert("입금마감취소는 " + "\n" + 
					       "월요일날 마감취소할경우 : 익익익일10시30분" + "\n" + 
					       "                            (월요일일 경우 => 금요일까지 마감취소가능)" + "\n" + 
					       "월요일이외일에 마감취소할 경우: 익익일10시30분" + "\n" + 
					       "까지 가능합니다." + "\n" + 
						   "확인하여 주십시요.");
					cal_CLOSE_DATEFR.setFocus();		
					return false;
				}		 	
		 	}		 	
		 	//입금마감은 익익일 10시30분까지###################################
		 	
		 	//나머지마감은 익일 10시30분까지###################################
		 	else
		 	{
		 	
				if (fn_GetCloseCHK(ds_cond, cal_CLOSE_DATEFR.value) == "FALSE")
				{	
				
					gfn_alert("마감취소는 익일10시30분까지 가능합니다." + "\n" + 
						  "확인하여 주십시요.");
					cal_CLOSE_DATEFR.setFocus();		
					return false;
				}
			}
			//나머지마감은 익일 10시30분까지###################################
   
  																
		}
		
		//권한에 따른 분류필요!!!!
												
//============================================================================================
//(2012-06-04 추가) 시작
//박은규 2012-06-04 CSR#(CH201205_00175) 요청자:박현주(FS지원팀)
//월마감작업 추가(월-마감구분, 공통코드:MA0044)
//============================================================================================
/*
		mfn_GetClsStatus(gfn_subStr(cal_CLOSE_DATEFR.value, 0, 6));
		if (ds_common.rowcount > 0)
		{
			g_Message("EE", "해당월은 월마감이 완료되어 취소가 불가합니다.");
			return false;
		}
*/

		// 월마감 체크 함수 수정 2015.12.28
		mfn_GetCcMonthClsYn("U", edt_upjangNm.getUpjangCode(), gfn_subStr(cal_CLOSE_DATEFR.value, 0, 6), "01");

		if( ds_common.getColumn(0, 0) == "Y" )
		{
			g_Message("EE", "해당월은 월마감이 완료되어 취소가 불가합니다.");
			return false;
		}

//============================================================================================
//(2012-06-04 추가) 끝
//============================================================================================

													
		// action 정보 초기화
		fsp_clear(this);			
		// 전체취소
		if (Get_chk_Id() == "007"){
			
			//fsp_addSingle(this, "ma/mag:MAG10120E_D002");
			
			ds_close.clearData();
			ds_close.addRow();
			ds_close.setColumn(0, "occurSdate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE") );
			ds_close.setColumn(0, "occurEdate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE") );
			ds_close.setColumn(0, "sysClass", 	"11");
			ds_close.setColumn(0, "closeGubun",	"001");
			ds_close.setColumn(0, "loginSabun", g_EmpNo);
			ds_close.setColumn(0, "upjangCd",	gUpjangCd );
			ds_close.setColumn(0, "closeYn",	"Y");		//마감유무

			var strSvcID    = "closeCancel_11";
			var strURL      = "ma/mas/closeMgmt/closeProc.xdo";
			var strInDs     = "ds_close=ds_close:U";
			var strOutDs    = "";
			var strArg      = "";
			var strCallback = "fn_callBack";
			var bAsync      = true;
			
			gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
		    
			// 매출(급식) 취소
			/*ds_close.clearData();
			ds_close.addRow();
			ds_close.setColumn(0, "occurDate",	ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE"));
			ds_close.setColumn(0, "sysClass", 	"11");
			ds_close.setColumn(0, "upjangCd",	gUpjangCd);
			ds_close.setColumn(0, "closeYn",	"Y");		//마감유무		
			gfn_saveCloseProc(this, "closeCancel_11", "ds_close");*/
		
			/*// 매출(장례식) 취소
			ds_close.clearData();
			ds_close.addRow();
			ds_close.setColumn(0, "occurDate",	ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE"));
			ds_close.setColumn(0, "sysClass", 	"16");
			ds_close.setColumn(0, "upjangCd",	gUpjangCd);
			ds_close.setColumn(0, "closeYn",	"Y");		//마감유무		
			gfn_saveCloseProc(this, "closeCancel", "ds_close");
			
			// 매출(폐식용유) 취소
			ds_close.clearData();
			ds_close.addRow();
			ds_close.setColumn(0, "occurDate",	ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE"));
			ds_close.setColumn(0, "sysClass", 	"19");
			ds_close.setColumn(0, "upjangCd",	gUpjangCd);
			ds_close.setColumn(0, "closeYn",	"Y");		//마감유무		
			gfn_saveCloseProc(this, "closeCancel", "ds_close");
			
			// 매출(특판) 취소
			ds_close.clearData();
			ds_close.addRow();
			ds_close.setColumn(0, "occurDate",	ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE"));
			ds_close.setColumn(0, "sysClass", 	"17");
			ds_close.setColumn(0, "upjangCd",	gUpjangCd);
			ds_close.setColumn(0, "closeYn",	"Y");		//마감유무		
			gfn_saveCloseProc(this, "closeCancel", "ds_close");*/


			//============================================================================================
			// (2013-07-18 추가) 시작
			// 김장욱 2013-07-18 CSR#(SR201306_05315) 요청자:이혜은(FS기획팀)
			// 마감, 마감취소시 이력생성
			//============================================================================================				
		//fsp_addSingle(this, "ma/mag:MAG10120E_I003");
			//============================================================================================
			// (2013-07-18 추가) 끝
			//============================================================================================						
				
		}
		else {
					
					if(Get_chk_Id() == "001"){//매출(급식)	
						/*ds_close.clearData();
						ds_close.addRow();
						ds_close.setColumn(0, "occurDate",	ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE"));
						ds_close.setColumn(0, "sysClass", 	"11");
						ds_close.setColumn(0, "upjangCd",	gUpjangCd);
						ds_close.setColumn(0, "closeYn",	"Y");		//마감유무

						if(gfn_confirm("마감취소 하시겠습니까?")){
							gfn_saveCloseProc(this, "closeCancel", "ds_close");
						}else{
							return;
						}*/
							
						ds_close.clearData();
						ds_close.addRow();
						ds_close.setColumn(0, "occurSdate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE") );
						ds_close.setColumn(0, "occurEdate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE") );
						ds_close.setColumn(0, "sysClass", 	"11");
						ds_close.setColumn(0, "closeGubun",	"001");
						ds_close.setColumn(0, "loginSabun", g_EmpNo);
						ds_close.setColumn(0, "upjangCd",	gUpjangCd );
						ds_close.setColumn(0, "closeYn",	"Y");		//마감유무

						var strSvcID    = "closeCancel";
						var strURL      = "ma/mas/closeMgmt/closeProc.xdo";
						var strInDs     = "ds_close=ds_close:U";
						var strOutDs    = "";
						var strArg      = "";
						var strCallback = "fn_callBack";
						var bAsync      = true;
						
						gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
							
					}else if(Get_chk_Id() == "006"){//매출(장례식)
						/*ds_close.clearData();
						ds_close.addRow();
						ds_close.setColumn(0, "occurDate",	ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE"));
						ds_close.setColumn(0, "sysClass", 	"16");
						ds_close.setColumn(0, "upjangCd",	gUpjangCd);
						ds_close.setColumn(0, "closeYn",	"Y");		//마감유무
						
						if(gfn_confirm("마감취소 하시겠습니까?")){
							gfn_saveCloseProc(this, "closeCancel", "ds_close");
						}else{
							return;
						}*/
						
						ds_close.clearData();
						ds_close.addRow();
						ds_close.setColumn(0, "occurSdate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE") );
						ds_close.setColumn(0, "occurEdate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE") );
						ds_close.setColumn(0, "sysClass", 	"16");
						ds_close.setColumn(0, "closeGubun",	"006");
						ds_close.setColumn(0, "loginSabun", g_EmpNo);
						ds_close.setColumn(0, "upjangCd",	gUpjangCd );
						ds_close.setColumn(0, "closeYn",	"Y");		//마감유무

						var strSvcID    = "closeCancel";
						var strURL      = "ma/mas/closeMgmt/closeProc.xdo";
						var strInDs     = "ds_close=ds_close:U";
						var strOutDs    = "";
						var strArg      = "";
						var strCallback = "fn_callBack";
						var bAsync      = true;
						
						gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
						
					}else if(Get_chk_Id() == "008"){	// 매출 (폐식용유)
						/*ds_close.clearData();
						ds_close.addRow();
						ds_close.setColumn(0, "occurDate",	ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE"));
						ds_close.setColumn(0, "sysClass", 	"19");
						ds_close.setColumn(0, "upjangCd",	gUpjangCd);
						ds_close.setColumn(0, "closeYn",	"Y");		//마감유무
						
						if(gfn_confirm("마감취소 하시겠습니까?")){
							gfn_saveCloseProc(this, "closeCancel", "ds_close");
						}else{
							return;
						}*/
						
						ds_close.clearData();
						ds_close.addRow();
						ds_close.setColumn(0, "occurSdate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE") );
						ds_close.setColumn(0, "occurEdate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE") );
						ds_close.setColumn(0, "sysClass", 	"19");
						ds_close.setColumn(0, "closeGubun",	"008");
						ds_close.setColumn(0, "loginSabun", g_EmpNo);
						ds_close.setColumn(0, "upjangCd",	gUpjangCd );
						ds_close.setColumn(0, "closeYn",	"Y");		//마감유무

						var strSvcID    = "closeCancel";
						var strURL      = "ma/mas/closeMgmt/closeProc.xdo";
						var strInDs     = "ds_close=ds_close:U";
						var strOutDs    = "";
						var strArg      = "";
						var strCallback = "fn_callBack";
						var bAsync      = true;
						
						gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
						
					}else if(Get_chk_Id() == "009"){	// 매출 (특판)
						/*ds_close.clearData();
						ds_close.addRow();
						ds_close.setColumn(0, "occurDate",	ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE"));
						ds_close.setColumn(0, "sysClass", 	"17");
						ds_close.setColumn(0, "upjangCd",	gUpjangCd);
						ds_close.setColumn(0, "closeYn",	"Y");		//마감유무
						
						if(gfn_confirm("마감취소 하시겠습니까?")){
							gfn_saveCloseProc(this, "closeCancel", "ds_close");
						}else{
							return;
						}*/
							
						ds_close.clearData();
						ds_close.addRow();
						ds_close.setColumn(0, "occurSdate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE") );
						ds_close.setColumn(0, "occurEdate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE") );
						ds_close.setColumn(0, "sysClass", 	"17");
						ds_close.setColumn(0, "closeGubun",	"009");
						ds_close.setColumn(0, "loginSabun", g_EmpNo);
						ds_close.setColumn(0, "upjangCd",	gUpjangCd );
						ds_close.setColumn(0, "closeYn",	"Y");		//마감유무

						var strSvcID    = "closeCancel";
						var strURL      = "ma/mas/closeMgmt/closeProc.xdo";
						var strInDs     = "ds_close=ds_close:U";
						var strOutDs    = "";
						var strArg      = "";
						var strCallback = "fn_callBack";
						var bAsync      = true;
						
						gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
							
					}else if(Get_chk_Id() == "012"){
						ds_close.clearData();
						ds_close.addRow();
						ds_close.setColumn(0, "occurSdate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE") );
						ds_close.setColumn(0, "occurEdate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE") );
						ds_close.setColumn(0, "sysClass", 	"12");
						ds_close.setColumn(0, "closeGubun",	"012");
						ds_close.setColumn(0, "loginSabun", g_EmpNo);
						ds_close.setColumn(0, "upjangCd",	gUpjangCd );
						ds_close.setColumn(0, "closeYn",	"Y");		//마감유무

						var strSvcID    = "closeCancel";
						var strURL      = "ma/mas/closeMgmt/closeProc.xdo";
						var strInDs     = "ds_close=ds_close:U";
						var strOutDs    = "";
						var strArg      = "";
						var strCallback = "fn_callBack";
						var bAsync      = true;
						
						gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
					}
					
				if(Get_chk_Id() != "001" && Get_chk_Id() != "006" && Get_chk_Id() != "008" && Get_chk_Id() != "009" && Get_chk_Id() != "007" && Get_chk_Id() != "012"){
					fsp_addSingle(this, "ma/mag:MAG10120E_D001");
				}	
			//============================================================================================
			// (2013-07-18 추가) 시작
			// 김장욱 2013-07-18 CSR#(SR201306_05315) 요청자:이혜은(FS기획팀)
			// 마감, 마감취소시 이력생성
			//============================================================================================				
			// --------------- 프로시져 호출후 히스토리 저장하기 위해 주석 처리
			//fsp_addSingle(this, "ma/mag:MAG10120E_I003");
			//============================================================================================
			// (2013-07-18 추가) 끝
			//============================================================================================						
				
		}
					
		//============================================================================================
		// (2013-07-18 변경) 시작
		// 김장욱 2013-07-18 CSR#(SR201306_05315) 요청자:이혜은(FS기획팀)
		// 마감, 마감취소시 이력생성
		//============================================================================================				
		//tit_callService(this, "", "", "", "",  "UPJANG=" + quote(edt_UPJANGQuery.UserData) + " CLOSE_GUBUN=" + quote(Get_chk_Id()) + 

		//									   " CLOSE_DATEFR=" + quote(cal_CLOSE_DATEFR.Value) + " CLOSE_DATETO=" + quote(cal_CLOSE_DATETO.Value), "fn_AfterSaveSearch()");											
		
		if(Get_chk_Id() != "001" && Get_chk_Id() != "006" && Get_chk_Id() != "008" && Get_chk_Id() != "009" && Get_chk_Id() != "007" && Get_chk_Id() != "012"){
			fsp_callService(this, 
							"", 
							"", 
							"", 
							"",  
							"UPJANG=" + wrapQuote(edt_upjangNm.getUpjangCode() ) + 
							" CLOSE_GUBUN=" + wrapQuote(Get_chk_Id()) + 
							" CLOSE_DATEFR=" + wrapQuote(cal_CLOSE_DATEFR.value) + 
							" CLOSE_DATETO=" + wrapQuote(cal_CLOSE_DATETO.value) + 
							" CLOSE_YN=" + wrapQuote("N"), 
							"fn_cancleHistory()");
		}					
	 
		return true;

}

function fn_AfterDeleteSearch(errCode, errMsg)
{
	if (errCode != 0){
	    fn_search();	
		return;
	}
	
	gfn_alert("삭제되었습니다.");
	
	fn_search();	
}



function fn_insert()
{
	
}

function fn_delete()
{

}
function fn_save()
{

}

function fn_print()
{
}
function fn_Close()
{
	this.close();
}
function fn_help()
{
}


function fn_Close()
{

	if (!before_SaveCheck("Master")){
		
		return;
	}
}

//=========================================================================================
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
//
//=========================================================================================

/*
 ******************************************************************************************
 * 함  수  명   : Common_Btn_common_OnClick
 * 입      력   : obj  = Form Component
 * 반      환   : 없음
 * 기      능   :
 * 작  성  자   : 구종화
 * 작성  일자   : 2007-11-16
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */

//=========================================================================================
// [ PART 6 ]
// component Event 정의 ( User Define function )
// --> component Event의 기요,기능,동작 등 상세내용은 MiPlatform 메뉴얼을 참조하시기 바랍니다.
//=========================================================================================

function Common_Btn_common_OnClick(obj)
{

	switch(obj.name)
	{
		case "btn_Search":
		    //alert("d");
			//fn_search();
			break;
		case "btn_Insert":
			fn_insert();
			break;
		case "btn_Delete":
			fn_delete();
			break;
		case "btn_Save":
			fn_save();
			break;
		case "btn_Print":
			//fn_Print();
			break;
		case "btn_Close":
			fn_Close();
			break;
		case "btn_Help":
			//fn_Help();
			break;
		default:
			break;
	}

}

function WorkForm_OnKeyDown(obj:Form, e:KeyEventInfo)
{
    gfn_formKeyDown(obj, e); //(obj,e.fromreferenceobject,e.keycode,e.shiftKey,e.ctrlKey,e.altKey,-1,-1);    
}


function grid_Slip_OnHeadClick(obj:Grid, e:GridClickEventInfo)
{
	gfn_gridSort(obj, e); //(eval(obj.binddataset), obj, e.cell);	
}

function edt_UPJANGQuery_OnKeyDown(obj:Edit, e:KeyEventInfo)
{
	fn_edt_OnKeyDown(obj,e.keycode);			

	if (e.keycode == 46){
	
		fn_DataSetAllClear();
	}	
}

function edtBtn_UPJANGQuery_OnClick(obj:Button, e:ClickEventInfo)
{
    fn_DataSetAllClear();
    
	fn_edtBtn_OnClick(obj);
}

//[[김재섭 - 휴일에 해당하는 값 가져오기
function fn_isHoliday(sDate, aHolidays)
{
	var i;

	for( i = 0 ; i < aHolidays.length ; i++ )
	{
		if( aHolidays[i].substr(0,8) == sDate )
			return aHolidays[i].substr(8);
	}

	return "";	
}
//김재섭 - 휴일에 해당하는 값 가져오기]]

// 매월 마다 정보 갱신
// 달력에 쓰일 기본정보 처리 내용
function MakeBaseNote(ds_base_note_obj, yyyymm)
{
	var i;
	var last_day;
	var holiday, lunar, lunar_mm, lunar_dd;
	var row;
	var yyyymmdd;

	ds_base_note_obj.clearData();
	last_day = GetLastDay(yyyymm);
	
	//[[김재섭수정
	var holiday, aHolidays;
	aHolidays = gfn_getHolidays(parseInt(yyyymm.substr(0,4), 10));
	
	for(i=1; i<last_day; i++) {
		yyyymmdd = yyyymm+gfn_lPad(i, "0", 2);
		// 음력 설정
		lunar = null;
		if( i%5 == 1 )
		{
			lunar = gfn_solar2Lunar(yyyymmdd);
			if( lunar != null )
				lunar = "(" + parseInt(lunar.substr(5,2)) + "." + parseInt(lunar.substr(7,2)) + ")";
		}

		holiday = fn_isHoliday(yyyymmdd, aHolidays);
		//휴일명표시
		if( holiday != "" ) {
			row = ds_base_note_obj.addRow();
			ds_base_note_obj.setColumn(row, "date", yyyymmdd);
			ds_base_note_obj.setColumn(row, "note", holiday);
		}
		//음력표시
 		else {
 			row = ds_base_note_obj.addRow();
 			ds_base_note_obj.setColumn(row, "date", yyyymmdd);
 			ds_base_note_obj.setColumn(row, "note", lunar);
 		}
	}
	//김재섭수정]]
	
	// 공휴일 지정
// 	for( i = 1 ; i < last_day ; i++ )
// 	{
// 		yyyymmdd = yyyymm+gfn_lPad(i, "0", 2);
// 		holiday = IsHoliday(yyyymmdd);
// 		if( holiday != "" && holiday != "Sun" )
// 		{
// 			row = ds_base_note_obj.addRow();
// 			ds_base_note_obj.setColumn(row, "date", yyyymmdd);
// 			ds_base_note_obj.setColumn(row, "note", holiday);
// 		}
// 	}
	
	// 음력표기
// 	for( i = 1 ; i < last_day ; i++ )
// 	{
// 		if( i%5 == 1 )
// 		{
// 			yyyymmdd = yyyymm+gfn_lPad(i, "0", 2);
// 			lunar = solar2Lunar(yyyymmdd);
// 			lunar_mm = parseInt(gfn_subStr(lunar, 4, 2));
// 			lunar_dd = parseInt(gfn_subStr(lunar, 6, 2));
// 			row = ds_base_note_obj.addRow();
// 			ds_base_note_obj.setColumn(row, "date", yyyymmdd);
// 			ds_base_note_obj.setColumn(row, "note", "("+lunar_mm+"."+lunar_dd+")");
// 		}
// 	}
	// 절기표기
	
	// 60갑자표기
	 
	
}



// 이번달 달력 그리기
function DrawCalendar(ds_calendar_obj, grid_obj, ds_base_note_obj, ds_note_obj, yyyymm)
{
	var i, day, row, colid;
	var start_day, end_date, today;

	//MakeBaseNote(ds_base_note_obj, yyyymm);	

	// Grid Header생성
	grid_obj.userdata = yyyymm;
	var mmText ;
	switch(gfn_subStr(yyyymm, 4,2))
	{
		case "01":
			mmText = "1월";
			break;
		case "02":
			mmText = "2월";
			break;
		case "03":
			mmText = "3월";
			break;
		case "04":
			mmText = "4월";
			break;
		case "05":
			mmText = "5월";
			break;
		case "06":
			mmText = "6월";
			break;
		case "07":
			mmText = "7월";
			break;
		case "08":
			mmText = "8월";
			break;
		case "09":
			mmText = "9월";
			break;
		case "10":
			mmText = "10월";
			break;
		case "11":
			mmText = "11월";
			break;
		case "12":
			mmText = "12월";
			break;
	}
	
	//mmText += " [" + Get_chk_Text() + "] ";
	//grid_obj.SetCellProp("head",1,"text",substr(yyyymm, 0, 4) + "년 " + ToInteger(substr(yyyymm, 4,2)) + "월");
	grid_obj.setCellProperty("head",0,"text", edt_upjangNm.getUpjangName());
	grid_obj.setCellProperty("head",1,"text",Get_chk_Text());		
	grid_obj.setCellProperty("head",2,"text", gfn_subStr(yyyymm, 0, 4)+"년 " + mmText);
	
	// Dataset 만들기
	grid_obj.binddataset = "";
	ds_calendar_obj.clearData();
	start_day = gfn_getDay(yyyymm+"01");
	last_date = GetLastDay(yyyymm);
	row = ds_calendar_obj.addRow();
	
	

	for( i = 1, day = start_day ; i <= last_date ; i++ )
	{
	 // 달력 생성			
		ds_calendar_obj.setColumn(row, "day"+day, i);
		
	 // 휴일 처리


	    //if( IsHoliday(yyyymm+gfn_lPad(i, "0", 2)) != "" )
		 // ds_calendar_obj.setColumn(row, "hol"+day, "1"); 
		  		
	 // ds_base_note --> 달력 Data	
        var base_note_row;
		base_note_row = ds_base_note_obj.findRow("date", yyyymm+gfn_lPad(i, "0", 2));
		if( base_note_row >= 0 )
			ds_calendar_obj.setColumn(row, "base_note"+day, ds_base_note_obj.getColumn(base_note_row, "note"));

		// 달력생성
		day = (day+1)%7;
		if( day == 0 && i != last_date )
			row = ds_calendar_obj.addRow();
			
	}

	 // ds_note --> 달력 Data			
  var note_row, cal_row;	 	
  var note_date;
  var cal_day; 
 
	for( note_row = 0 ; note_row < ds_note_obj.getRowCount() ; note_row++ )
	{
	 
		note_date = ds_note_obj.getColumn(note_row, "date"); 
		
		// * --> 해당날짜로 바꾸기
		var j;
		for( j = 0 ; j < 6 ; j++ ) 
		{
			if( note_date[j] == '*' ) {
			 
				note_date[j] = yyyymm[j]; 
			}
		}

			
		// 음력 --> 양력날짜로 바꾸기		
		if( ds_note_obj.getColumn(note_row, "sl_gbn") == "L" )
			note_date = lunar2Solar(note_date);
		if( gfn_subStr(note_date, 0, 6)!= yyyymm )
			continue;
			
	
		note_day = gfn_getDay(note_date);
	
		cal_row = ds_calendar_obj.findRow("day"+note_day, parseInt(gfn_subStr(note_date, 6, 2))+"");
		
		if( cal_row >= 0 )
		{
			// note값 --> 달력 Data
			ds_calendar_obj.setColumn(cal_row, "note"+note_day, ds_note_obj.getColumn(note_row, "note"));
			
			// 중요함 --> 달력 Data
			ds_calendar_obj.setColumn(note_row, "imp"+note_day, ds_note_obj.getColumn(note_row, "important"));
			// 휴일 --> 달력 Data
			//ds_calendar_obj.SetColumn(cal_row, "hol"+note_day, ds_note_obj.GetColumn(note_row, "holiday"));
		}
	}
	
	grid_obj.binddataset = ds_calendar_obj.name; 
	
	// Grid높이 조정

	/* RowHeight은 지원되지 않는 속성입니다.*/ 
	//grid_obj.RowHeight = (
	/* HeadHeight은 지원되지 않는 속성입니다.*/ 
	//grid_obj.position.height - grid_obj.HeadHeight*2 - 5)/(ds_calendar_obj.getRowCount()*2);

}

function grid_today_expr(date)
{
    var sDate='';
 	
	if(gfn_length(date.toString()) == 1) {
	     sDate = gfn_lPad(date, "0", 2);
	} else {
	     sDate = date;
	}
	
	var yyyymmdd = Grid_calendar.userdata+sDate;
	
	//trace(yyyymmdd);
	
	if( gfn_today()== yyyymmdd )
		return "#ff8400";
	else
		return "default";
		//return "white";
}

function grid_today_expr2(date, str_note)
{
    var sDate='';
 	
	if(gfn_length(date) == 1) {
	     sDate = gfn_lPad(date, "0", 2);
	} else {
	     sDate = date;
	}
 
	var sToday = gfn_trim(gfn_today());
	var yyyymmdd = Grid_calendar.userdata+sDate;  
	
	//trace(date + ' gfn_lPad => ' + gfn_lPad(date, "0", 1));
	
	if( sToday == yyyymmdd ){ 
		return "#5485BE";
	}
	else {
	
		if((str_note == "미마감") ||(str_note == "미마감존재")) {
			 return "lavenderblush";
		} else if((str_note == "마감") || (str_note == "전체마감")) {
			 return "lavender";
		 } else {
			  return "lavenderblush";
		}
	}		
}


function ds_list_OnRowPosChanged(obj:Dataset, e:DSRowPosChangeEventInfo)
{
	trace("ds_list_OnRowPosChanged");
	trace("e.newrow = " + e.newrow + "            e.oldrow = " + e.oldrow);
	if (ds_list.rowcount == 0){
		return;
	}
	//tr_info
	
	
		
	if(e.newrow != -1) {
	
		
		cal_CLOSE_DATEFR.value = ds_list.getColumn(e.newrow, "CLOSE_DATE");
		cal_CLOSE_DATETO.value = ds_list.getColumn(e.newrow, "CLOSE_DATE");	
		
		
		var str_Day='';
		str_Day = toNumber(gfn_subStr(ds_list.getColumn(e.newrow, "CLOSE_DATE"), 6 ,2));
		//trace("e.newrow : " + e.newrow);
		//trace("CLOSE_DATE : " + ds_list.getColumn(e.newrow, "CLOSE_DATE"));
		//trace("str_Day  = " +str_Day);
		for (i=0;i<ds_calendar.rowcount;i++){
				
			for (j=0;j<7;j++){
			//trace(" i , day + j  " + gfn_length(ds_calendar.getColumn(i, "day" + j)));
			//trace(" == str_Day " + ds_calendar.getColumn(i, "day" + j));
				if ( 
					 (gfn_length(ds_calendar.getColumn(i,   j))!= 0) &&
					 (ds_calendar.getColumn(i, "day" + j) == str_Day)
				   )
				{
					trace("rowpostion = " + i);
					ds_calendar.rowposition = i;
					//trace("rowposition = " + i)
					Grid_calendar.setCellPos(j);
					
					// 마감하기전 이전날짜에 미마감건 있는지 조회
					if(tr_info)fn_searchBeforeMagam();
					
					//trace("setCellPos = " + j);
					
					//trace("i = "+ i + "\nj = " +j+   "\n" +ds_calendar.getColumn(i, "day" + j));
				
					return;
				}
			}
		}	
    }
}


function chk_0_OnClick(obj:CheckBox, e:ClickEventInfo)
{
	//fv_init = "";
	Set_chk_Clear(obj,obj.isChecked());
	
	// 매출정보 클리어
	ds_closeInfoOut.clearData();
	ds_closeInfoOutPut.clearData();
	
}


function Set_chk_Clear(obj,strValue)
{
	for(i=0;i<9;i++){
	
		if (obj != eval("chk_" + i))
			eval("chk_" + i).value = "0";
	}

	/*if (chk_5.value) fv_all = "1";
	else fv_all = "";
	*/
	
	fn_DataSetAllClear();
	fn_search();
}





function Get_chk_Id()
{
	for(i=0;i<9;i++){
	
		if (eval("chk_" + i).value == "1")
			return eval("chk_" + i).userdata;
	}
}

function Get_chk_Text()
{
	for(i=0;i<9;i++){
	
		if (eval("chk_" + i).value == "1")
			return eval("chk_" + i).text;
	}
}


function btn_DetailClose_OnClick(obj:Button, e:ClickEventInfo)
{	

		if(Get_chk_Id() == "007"){
			if(ds_list.getColumn(ds_list.rowposition, "NOTE") == "전체마감"){
			gfn_alert("이미 전체마감이 완료된 건 입니다.");
			return;
			}
		}else{
			if(ds_list.getColumn(ds_list.rowposition, "YN") == "Y"){
				gfn_alert("이미 마감이 완료된 건 입니다.");
				return;
			}
		}	
	
		if (!before_SaveCheck("Master") ){
			return;
		}
			
		//fv_init = "";
}

function Grid_calendar_OnCellPosChanged(obj:Grid, e:GridSelectEventInfo)
{		
	var str_Month, str_Day;
	str_Month = gfn_subStr(ds_list.getColumn(0, "CLOSE_DATE"), 0 ,6);
	ds_list.rowposition = -1;
	
	for (i=0;i<7;i++){
		//trace("AAA : " + ds_calendar.getColumn(e.row, "day" + i));
		if (gfn_length(ds_calendar.getColumn(e.row, "day" + i))!= 0) {
		
			str_Day = ds_calendar.getColumn(e.row, "day" + e.cell);
			if (gfn_length(ds_calendar.getColumn(e.row, "day" + e.cell))== 1) str_Day = '0' + str_Day;
		
			if(Get_chk_Id() == "007" && str_Day != undefined){
				if (fv_isSearchEvent) {
					ds_list.filter("CLOSE_DATE=='"+f_CurrDate +"'");
				}
				else {
					ds_list.filter("CLOSE_DATE=='"+str_Month + str_Day +"'");
					
				}
			}
			else {
				if (fv_isSearchEvent) {
					ds_list.rowposition = ds_list.findRowExpr("CLOSE_DATE=='" + f_CurrDate + "'");
				}
				else {
					ds_list.rowposition = ds_list.findRowExpr("CLOSE_DATE=='" + str_Month + str_Day + "'");
				}
			}
			
			fv_isSearchEvent = false;
			
			return;
		}
	}
}

function fn_DataSetAllClear()
{
	ds_calendar.clearData();
	ds_note.clearData();
	ds_list.clear();	
}	

	

function cal_CLOSE_DATEQuery_OnChanged(obj,strOldText,strNewText)
{
	fn_DataSetAllClear();
}

function fn_upjangNmChanged(obj, data){
	fn_DataSetAllClear();
}

//마감관리자 정보취득##############################################################################
function fn_GetCloseMasterGubun(objOutDs)
{
	
		objOutDs.clear();
		objOutDs.addColumn("CODE","STRING",256);
		objOutDs.addColumn("CODE_NAME","STRING",256);
		
					
		// action 정보 초기화
		fsp_clear(this);

		// 서버에서 조회할 정보 추가
		fsp_addSearch(this, "ma/mag:MAG10120E_S003");

		// 서버 호출
		http.Sync = true;
		fsp_callService(this, "", "", "", objOutDs.name + "=ds_list","","");
		http.Sync = false;	
	
}
//마감관리자 정보취득##############################################################################


//익일10시30분까지 마감 정보취득######################################################################
function fn_GetCloseCHK(objOutDs, str_CLOSE_DATE)
{
	
		objOutDs.clear();
		objOutDs.addColumn("CLOSE_DATE","STRING",256);		
		objOutDs.addColumn("CHK","STRING",256);
		
		objOutDs.addRow();
		
		objOutDs.setColumn(0, "CLOSE_DATE", str_CLOSE_DATE);
		
					
		// action 정보 초기화
		fsp_clear(this);

		// 서버에서 조회할 정보 추가
		fsp_addSearch(this, "ma/mag:MAG10120E_S004");

		// 서버 호출
		http.Sync = true;
		fsp_callService(this, "", "", "ds_cond=" + objOutDs.name, objOutDs.name + "=ds_list","","");
		http.Sync = false;	
		
		return objOutDs.getColumn(0, "CHK");
}


function fn_GetCloseCHK002(objOutDs, str_CLOSE_DATE) //입금마감 => 익익일10시30분까지
{
	
		objOutDs.clear();
		objOutDs.addColumn("CLOSE_DATE","STRING",256);		
		objOutDs.addColumn("CHK","STRING",256);
		
		objOutDs.addRow();
		
		objOutDs.setColumn(0, "CLOSE_DATE", str_CLOSE_DATE);
		
					
		// action 정보 초기화
		fsp_clear(this);

		// 서버에서 조회할 정보 추가
		fsp_addSearch(this, "ma/mag:MAG10120E_S005");

		// 서버 호출
		http.Sync = true;
		fsp_callService(this, "", "", "ds_cond=" + objOutDs.name, objOutDs.name + "=ds_list","","");
		http.Sync = false;	
		
		return objOutDs.getColumn(0, "CHK");	
}
//익일10시30분까지 마감 정보취득######################################################################

function btn_DetailCancel_OnClick(obj:Button, e:ClickEventInfo)
{
		if (!before_DeleteCheck() ){
			return;
		}
		//fv_init = "";
}

function btn_DetailView_OnClick(obj:Button, e:ClickEventInfo)
{
	// 조회조건 팝업으로 전달
	/*arrArg = new Array();
		
	arrArg[0] = edt_UPJANGQuery.userdata;
	arrArg[1] = edt_UPJANGQuery.value;
	arrArg[2] = edt_UPDEPT_IDQuery.userdata;
	arrArg[3] = edt_UPDEPT_IDQuery.value;
	
	var strId       = "mak";
	var strURL      = "U_MAG::MAG10125E.xfdl";
	var objArgument = {arrSchVal:arrArg}; 
	var nWidth      = -1;
	var nHeight     = -1;
	var strStyle    = "";	
	var nLeft       = -1;
	var nTop        = -1;
	var isModeless  = false;
	var bShowTitle  = true;
	var strAlign    = "-1";
	var bResizable  = true;
	
	var arr = gfn_dialog(strId, strURL, objArgument, nWidth, nHeight, strStyle, nLeft, nTop, isModeless, bShowTitle, strAlign);*/
	
	gfn_dialog("", "U_MAG::MAG10125E.xfdl","");
		
}



function btn_DetailReqCancel_OnClick(obj:Button, e:ClickEventInfo)
{
	
	// 조회조건 팝업으로 전달
	/*var arrArg = new Array();
	
	arrArg[0] = edt_UPJANGQuery.userdata;
	arrArg[1] = edt_UPJANGQuery.value;
	arrArg[2] = edt_UPDEPT_IDQuery.userdata;
	arrArg[3] = edt_UPDEPT_IDQuery.value;
	
	var strId       = "mak";
	var strURL      = "U_MAG::MAG10125E.xfdl";
	var objArgument = {arrSchVal:arrArg}; 
	var nWidth      = -1;
	var nHeight     = -1;
	var strStyle    = "";	
	var nLeft       = -1;
	var nTop        = -1;
	var isModeless  = false;
	var bShowTitle  = true;
	var strAlign    = "-1";
	var bResizable  = true;
	
	var arr = gfn_dialog(strId, strURL, objArgument, nWidth, nHeight, strStyle, nLeft, nTop, isModeless, bShowTitle, strAlign);*/
	
	gfn_dialog("", "U_MAG::MAG10122E.xfdl","");		
}

function edtBtn_Date_OnClick(obj:Button, e:ClickEventInfo)
{
	g_CalButton_OnClick(obj);
	fn_DataSetAllClear();		
}

function edtBtn_Close_OnClick(obj:Button, e:ClickEventInfo)
{
	g_CalButton_OnClick(obj);
	//fn_DataSetAllClear();		
}

/************************************************************************************************
 * TRANSACTION 및 CallBack 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 트랜잭션 콜백 함수 (필수)
 *---------------------------------------------------------------------------------------------*/
function fn_callBack(strSvcID, nErrorCode, strErrorMsg){
	// 에러시 gfn_callBack에서 메시지 제공, 화면별 특정 에러 발생시에만 사용하세요.
	if (nErrorCode < 0){
		return;
	}
	
    switch(strSvcID){

   		// 사업부Combo 조회
        case "searchMuCd" :
			//fn_setSmSearchDataset("MU", false);
            break;    
            
        //매출조회
        case "search" :
			if(ds_salsList.getRowCount() == 0){ //서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
				gfn_loadDatasetInfo (ds_salsList, fv_objColInfo1);
				ds_paymentList.clearData();
				edt_differAmt.value = 0;
			}else{
				fn_searchDtl();
			}
            break;
            
        //지불조회
        case "searchDtl" :
			//if(ds_paymentList.getRowCount() == 0){ //서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
			//	gfn_loadDatasetInfo (ds_paymentList, fv_objColInfo2);
			//}
			
			//마감여부 & 매출 - 지불 차이 계산
			fn_setDifferAmt();
			ds_closeInfo.clearData();
            break;
            
        //마감처리
        case "closeProc" :
			
			var arrRetVal  = fv_retVal.split("|");	

			//성공
			if(arrRetVal[0] == "TRUE"){
				gfn_alert("msg.action.close.success");	// 정상적으로 마감처리 되었습니다.
				fn_saveHistory();
				//fn_search();
				/*fsp_clear(this);
				if(Get_chk_Id() == "001"){ //매출(급식)
					fsp_addSingle(this, "ma/mag:MAG10120E_D001");
					fsp_addSingle(this, "ma/mag:MAG10120E_I001");
				}else if(Get_chk_Id() == "006"){ //매출(장례식)
					fsp_addSingle(this, "ma/mag:MAG10120E_D001");
					fsp_addSingle(this, "ma/mag:MAG10120E_I001");
				}else if(Get_chk_Id() == "008"){ //매출(폐식용유)
					fsp_addSingle(this, "ma/mag:MAG10120E_D001");
					fsp_addSingle(this, "ma/mag:MAG10120E_I001");
				}else if(Get_chk_Id() == "009"){ //매출(특판)
					fsp_addSingle(this, "ma/mag:MAG10120E_D001");
					fsp_addSingle(this, "ma/mag:MAG10120E_I001");
				}else if(Get_chk_Id() == "007"){ //전체
					//trace(ds_close.saveXML());
					fsp_addSingle(this, "ma/mag:MAG10120E_D002");
					fsp_addSingle(this, "ma/mag:MAG10120E_I002");
				}	
					fsp_callService(this, 
								"", 
								"", 
								"", 
								"",  
								" UPJANG=" + edt_upjangNm.getUpjangCode() + 
								" CLOSE_GUBUN=" +  Get_chk_Id()  + 
								" CLOSE_DATEFR=" +  cal_CLOSE_DATEFR.value  + 
								" CLOSE_DATETO=" +  cal_CLOSE_DATETO.value  + 
								" CLOSE_YN=" +   "Y" , 
								"fn_saveHistory()");*/
				/*
				if(ds_close.getColumn(ds_close.rowposition, "sysClass") == 11){
					gfn_alert("매출마감(급식)이 정상적으로 마감 처리 되었습니다.");	// 정상적으로 마감처리 되었습니다.
				}else if(ds_close.getColumn(ds_close.rowposition, "sysClass") == 16){
					gfn_alert("매출마감(장례식)이 정상적으로 마감 처리 되었습니다.");
				}else if(ds_close.getColumn(ds_close.rowposition, "sysClass") == 19){
					gfn_alert("매출마감(폐식용유)이 정상적으로 마감 처리 되었습니다.");
				}else if(ds_close.getColumn(ds_close.rowposition, "sysClass") == 17){
					gfn_alert("매출마감(특판)이 정상적으로 마감 처리 되었습니다.");
				}*/
				//fn_search();
				
			//실패
			}else{
				gfn_alert("["+arrRetVal[0]+"] "+arrRetVal[1]);
				//gfn_alert("매출마감은 마감처리가 실패 하였습니다.");
				/*
				if(ds_close.getColumn(ds_close.rowposition, "sysClass") == 11){
					gfn_alert("매출마감(급식)의 마감처리가 실패 하였습니다.");	// 정상적으로 마감처리 되었습니다.
				}else if(ds_close.getColumn(ds_close.rowposition, "sysClass") == 16){
					gfn_alert("매출마감(장례식)의 마감처리가 실패 하였습니다.");
				}else if(ds_close.getColumn(ds_close.rowposition, "sysClass") == 19){
					gfn_alert("매출마감(폐식용유)의 마감처리가 실패 하였습니다.");
				}else if(ds_close.getColumn(ds_close.rowposition, "sysClass") == 17){
					gfn_alert("매출마감(특판)의 마감처리가 실패 하였습니다.");
				}*/
			}
            break;
            
            case "closeProc_11" :
			var arrRetVal  = fv_retVal.split("|");	

			//성공
			if(arrRetVal[0] == "TRUE"){
				//fsp_clear(this);
				fn_afterClose_11();
				/*if(Get_chk_Id() == "007"){ //매출(급식)
					fsp_addSingle(this, "ma/mag:MAG10120E_D002");
					fsp_addSingle(this, "ma/mag:MAG10120E_I002");
				}
					fsp_callService(this, 
								"", 
								"", 
								"", 
								"",  
								" UPJANG=" + edt_UPJANGQuery.userdata  + 
								" CLOSE_GUBUN=" +  Get_chk_Id()  + 
								" CLOSE_DATEFR=" +  cal_CLOSE_DATEFR.value  + 
								" CLOSE_DATETO=" +  cal_CLOSE_DATETO.value  + 
								" CLOSE_YN=" +   "Y" , 
								"fn_afterClose_11()");*/
			}else{
				gfn_alert("["+arrRetVal[0]+"] "+arrRetVal[1]);
			}
            break;
            
            case "closeProc_16" :
			var arrRetVal  = fv_retVal.split("|");	

			//성공
			if(arrRetVal[0] == "TRUE"){
					fn_afterClose_16();
			}else{
				gfn_alert("["+arrRetVal[0]+"] "+arrRetVal[1]);
			}
			
            break;
            
            case "closeProc_19" :
			var arrRetVal  = fv_retVal.split("|");	

			//성공
			if(arrRetVal[0] == "TRUE"){
					fn_afterClose_19();
			}else{
				gfn_alert("["+arrRetVal[0]+"] "+arrRetVal[1]);
			}
			
            break;
            
            case "closeProc_17" :
			var arrRetVal  = fv_retVal.split("|");	

			//성공
			if(arrRetVal[0] == "TRUE"){
				fn_afterClose_17(); 
				
				/*fsp_clear(this);
				if(Get_chk_Id() == "007"){ //매출(급식)
					fsp_addSingle(this, "ma/mag:MAG10120E_D002");
					fsp_addSingle(this, "ma/mag:MAG10120E_I002");
				}
					fsp_callService(this, 
								"", 
								"", 
								"", 
								"",  
								" UPJANG=" + edt_upjangNm.getUpjangCode() + 
								" CLOSE_GUBUN=" +  Get_chk_Id()  + 
								" CLOSE_DATEFR=" +  cal_CLOSE_DATEFR.value  + 
								" CLOSE_DATETO=" +  cal_CLOSE_DATETO.value  + 
								" CLOSE_YN=" +   "Y" , 
								"fn_afterClose_17()");*/
					//fn_afterClose_17();
			}else{
				gfn_alert("["+arrRetVal[0]+"] "+arrRetVal[1]);
			}
			
            break;
            
            case "closeProc_004" :
			var arrRetVal  = fv_retVal.split("|");	

			//성공
			if(arrRetVal[0] == "TRUE"){
				fn_afterClose_004(); 
				
				/*fsp_clear(this);
				if(Get_chk_Id() == "007"){ //매출(급식)
					fsp_addSingle(this, "ma/mag:MAG10120E_D002");
					fsp_addSingle(this, "ma/mag:MAG10120E_I002");
				}
					fsp_callService(this, 
								"", 
								"", 
								"", 
								"",  
								" UPJANG=" + edt_upjangNm.getUpjangCode() + 
								" CLOSE_GUBUN=" +  Get_chk_Id()  + 
								" CLOSE_DATEFR=" +  cal_CLOSE_DATEFR.value  + 
								" CLOSE_DATETO=" +  cal_CLOSE_DATETO.value  + 
								" CLOSE_YN=" +   "Y" , 
								"fn_afterClose_17()");*/
					//fn_afterClose_17();
			}else{
				gfn_alert("["+arrRetVal[0]+"] "+arrRetVal[1]);
			}
			
            break;
            
            case "closeProc_005" :
			var arrRetVal  = fv_retVal.split("|");	

			//성공
			if(arrRetVal[0] == "TRUE"){
				fn_afterCloseHis(); // 전체 마감 완료후 히스토리 저장
				
				/*fsp_clear(this);
				if(Get_chk_Id() == "007"){ //매출(급식)
					fsp_addSingle(this, "ma/mag:MAG10120E_D002");
					fsp_addSingle(this, "ma/mag:MAG10120E_I002");
				}
					fsp_callService(this, 
								"", 
								"", 
								"", 
								"",  
								" UPJANG=" + edt_upjangNm.getUpjangCode() + 
								" CLOSE_GUBUN=" +  Get_chk_Id()  + 
								" CLOSE_DATEFR=" +  cal_CLOSE_DATEFR.value  + 
								" CLOSE_DATETO=" +  cal_CLOSE_DATETO.value  + 
								" CLOSE_YN=" +   "Y" , 
								"fn_afterClose_17()");*/
					//fn_afterClose_17();
			}else{
				gfn_alert("["+arrRetVal[0]+"] "+arrRetVal[1]);
			}
			
            break;
				
        //마감취소
        case "closeCancel" :

			var arrRetVal  = fv_retVal.split("|");
			
			//성공
			if(arrRetVal[0] == "TRUE"){
				gfn_alert("msg.action.close.success");	// 정상적으로 마감처리 되었습니다.
				fn_cancleHistory();
				/*fsp_clear(this);
				if(Get_chk_Id() == "001"){ //매출(급식)
					fsp_addSingle(this, "ma/mag:MAG10120E_D001");
				}else if(Get_chk_Id() == "006"){ //매출(장례식)
					fsp_addSingle(this, "ma/mag:MAG10120E_D001");
				}else if(Get_chk_Id() == "008"){ //매출(폐식용유)
					fsp_addSingle(this, "ma/mag:MAG10120E_D001");
				}else if(Get_chk_Id() == "009"){ //매출(특판)
					fsp_addSingle(this, "ma/mag:MAG10120E_D001");
				}else if (Get_chk_Id() == "007"){ //전체마감
					fsp_addSingle(this, "ma/mag:MAG10120E_D002");
				}	
					
					fsp_callService(this, 
								"", 
								"", 
								"", 
								"",  
								" UPJANG=" + edt_upjangNm.getUpjangCode() + 
								" CLOSE_GUBUN=" +  Get_chk_Id()  + 
								" CLOSE_DATEFR=" +  cal_CLOSE_DATEFR.value  + 
								" CLOSE_DATETO=" +  cal_CLOSE_DATETO.value  + 
								" CLOSE_YN=" +   "Y" , 
								"fn_saveHistory()");*/
				//gfn_alert("msg.action.close.cancel");	// 정상적으로 마감취소 되었습니다.
				/*if(ds_close.getColumn(ds_close.rowposition, "sysClass") == 11){
					gfn_alert("매출마감(급식)이 정상적으로 마감취소 처리 되었습니다.");	// 정상적으로 마감처리 되었습니다.
				}else if(ds_close.getColumn(ds_close.rowposition, "sysClass") == 16){
					gfn_alert("매출마감(장례식)이 정상적으로 마감취소 처리 되었습니다.");
				}else if(ds_close.getColumn(ds_close.rowposition, "sysClass") == 19){
					gfn_alert("매출마감(폐식용유)이 정상적으로 마감취소 처리 되었습니다.");
				}else if(ds_close.getColumn(ds_close.rowposition, "sysClass") == 17){
					gfn_alert("매출마감(특판)이 정상적으로 마감취소 처리 되었습니다.");
				}*/
				//fn_search();
				
			//실패
			}else{
				gfn_alert("["+arrRetVal[0]+"] "+arrRetVal[1]);
				//gfn_alert("매출마감은 마감취소가 실패 하였습니다.");
				/*
				if(ds_close.getColumn(ds_close.rowposition, "sysClass") == 11){
					gfn_alert("매출마감(급식)의 마감취소가 실패 하였습니다.");	// 정상적으로 마감처리 되었습니다.
				}else if(ds_close.getColumn(ds_close.rowposition, "sysClass") == 16){
					gfn_alert("매출마감(장례식)의 마감취소가 실패 하였습니다.");
				}else if(ds_close.getColumn(ds_close.rowposition, "sysClass") == 19){
					gfn_alert("매출마감(폐식용유)의 마감취소가 실패 하였습니다.");
				}else if(ds_close.getColumn(ds_close.rowposition, "sysClass") == 17){
					gfn_alert("매출마감(특판)의 마감취소가 실패 하였습니다.");
				}*/
			}
            break;
            
            case "closeCancel_11" :

			var arrRetVal  = fv_retVal.split("|");
			
			//성공
			if(arrRetVal[0] == "TRUE"){
				fn_afterCloseCancle_11();
				/*fsp_clear(this);
				if (Get_chk_Id() == "007"){ //전체마감
					fsp_addSingle(this, "ma/mag:MAG10120E_D002");
				}	
					
					fsp_callService(this, 
								"", 
								"", 
								"", 
								"",  
								" UPJANG=" + edt_UPJANGQuery.userdata  + 
								" CLOSE_GUBUN=" +  Get_chk_Id()  + 
								" CLOSE_DATEFR=" +  cal_CLOSE_DATEFR.value  + 
								" CLOSE_DATETO=" +  cal_CLOSE_DATETO.value  + 
								" CLOSE_YN=" +   "Y" , 
								"fn_afterCloseCancle_11()");*/
		
				
			//실패
			}else{
				gfn_alert("["+arrRetVal[0]+"] "+arrRetVal[1]);
			
			}
            break;
            
            case "closeCancle_16" :
			var arrRetVal  = fv_retVal.split("|");	

			//성공
			if(arrRetVal[0] == "TRUE"){
					fn_afterCloseCancle_16();
			}else{
				gfn_alert("["+arrRetVal[0]+"] "+arrRetVal[1]);
			}
			
            break;
            
            case "closeCancle_19" :
			var arrRetVal  = fv_retVal.split("|");	

			//성공
			if(arrRetVal[0] == "TRUE"){
					fn_afterCloseCancle_19();
			}else{
				gfn_alert("["+arrRetVal[0]+"] "+arrRetVal[1]);
			}
			
            break;
            
            case "closeCancle_17" :
			var arrRetVal  = fv_retVal.split("|");	

			//성공
			if(arrRetVal[0] == "TRUE"){
				if (Get_chk_Id() == "007"){ //전체마감
					fsp_addSingle(this, "ma/mag:MAG10120E_D002");
				}	
					
					fsp_callService(this, 
								"", 
								"", 
								"", 
								"",  
								" UPJANG=" + edt_upjangNm.getUpjangCode() + 
								" CLOSE_GUBUN=" +  Get_chk_Id()  + 
								" CLOSE_DATEFR=" +  cal_CLOSE_DATEFR.value  + 
								" CLOSE_DATETO=" +  cal_CLOSE_DATETO.value  + 
								" CLOSE_YN=" +   "N" , 
								"fn_afterCloseCancle_17()");
					//fn_afterCloseCancle_17();
			}else{
				gfn_alert("["+arrRetVal[0]+"] "+arrRetVal[1]);
			}
			
            break;
            
            case "beforeMagam" :
			fn_closeInfo(); // 미마감건 조회후 차이금액 조회
			break;
			
		case "closeInfo" :
			tr_info = true;
		//trace(ds_closeInfoOut.saveXML());
		//trace(ds_closeInfoOutPut.saveXML());
			fn_closeInfoOutPut(); // 금액차이 체크
			break;
    }
}


/*----------------------------------------------------------------------------------------------
 * 사업부콤보조회
 *---------------------------------------------------------------------------------------------*/
function fn_setMuCd(){
	
	//사업부 com.hwfs.sm.cmn.dao.CommonDAO.selectMuCd
    gfn_transaction(this
					,"searchMuCd"
					,"sm/cmn/common/selectMuCd.xdo"
					,""
					,"ds_muCd=ds_combo"
					,""
					,"fn_callBack"
					,true);
}

/*function Grid_calendar_oncellclick(obj:Grid, e:GridClickEventInfo)
{

	
	fsp_clear(this);
	ds_closeInfo.clear();
	//ds_closeInfoOut.clear();
	//ds_closeInfoOutPut.clear();
	
	ds_closeInfo.addColumn("UPJANG", "STRING", 256);
	ds_closeInfo.addColumn("CLOSE_DATE", "STRING", 256);
	ds_closeInfo.addColumn("SYS_CLASS", "STRING", 256);
	ds_closeInfo.addColumn("MU_CD", "STRING", 256);

	ds_closeInfo.addRow();
	ds_closeInfo.setColumn(0, "UPJANG", edt_UPJANGQuery.userdata);
	ds_closeInfo.setColumn(0, "CLOSE_DATE", cal_CLOSE_DATEFR.value);
	if(Get_chk_Id() == "001"){
		ds_closeInfo.setColumn(0, "SYS_CLASS", 11);
	}else if(Get_chk_Id() == "006"){ 
		ds_closeInfo.setColumn(0, "SYS_CLASS", 16);
	}else if(Get_chk_Id() == "008"){ 
		ds_closeInfo.setColumn(0, "SYS_CLASS", 19);
	}else if(Get_chk_Id() == "009"){ 
		ds_closeInfo.setColumn(0, "SYS_CLASS", 17);		
	}else if(Get_chk_Id() == "007"){
		ds_closeInfo.setColumn(0, "SYS_CLASS", 99);
	}else{
		return;
	}
	ds_closeInfo.setColumn(0, "MU_CD", cbo_muCd.value);
	
	
	fsp_addSearch(this, "ma/mag:MAG10120E_S008");
	fsp_callService(this, "", "", "ds_closeInfo=ds_closeInfo","ds_closeInfoOut=ds_closeInfoOut","","fn_closeInfoOut()", "", "", "", "");
	
	//fsp_addSearch(this, "ma/mag:MAG10120E_S009");
	//fsp_callService(this, "", "", "ds_closeInfo=ds_closeInfo","ds_closeInfoOutPut=ds_closeInfoOutPut","","fn_bbb()", "", "", "", "");

}*/

function fn_closeInfo()
{
	trace("fn_closeInfo");
	
	//fsp_clear(this);
	ds_closeInfo.clear();
	//ds_closeInfoOut.clear();
	//ds_closeInfoOutPut.clear();
	
	ds_closeInfo.addColumn("upjang", "STRING", 256);
	ds_closeInfo.addColumn("closeDate", "STRING", 256);
	ds_closeInfo.addColumn("sysClass", "STRING", 256);
	ds_closeInfo.addColumn("muCd", "STRING", 256);

	ds_closeInfo.addRow();
	ds_closeInfo.setColumn(0, "upjang", edt_upjangNm.getUpjangCode() );
	ds_closeInfo.setColumn(0, "closeDate", cal_CLOSE_DATEFR.value);
	
	if(Get_chk_Id() == "001"){
		ds_closeInfo.setColumn(0, "sysClass", "11");
	}else if(Get_chk_Id() == "006"){
		ds_closeInfo.setColumn(0, "sysClass", "16");
	}else if(Get_chk_Id() == "008"){
		ds_closeInfo.setColumn(0, "sysClass", "19");
	}else if(Get_chk_Id() == "009"){
		ds_closeInfo.setColumn(0, "sysClass", "17");
	}else if(Get_chk_Id() == "012"){
		ds_closeInfo.setColumn(0, "sysClass", "12");
	}else if(Get_chk_Id() == "007"){
		ds_closeInfo.setColumn(0, "sysClass", "99");
	}else{
		return;
	}
	ds_closeInfo.setColumn(0, "muCd", cbo_muCd.value);
	
	var strSvcID    = "closeInfo";
    var strURL      = "ma/mag/upjangDayClose/selectCloseInfo.xdo";
    var strInDs     = "ds_search=ds_closeInfo";
    var strOutDs    = "ds_closeInfoOut=ds_closeInfoOut ds_closeInfoOutPut=ds_closeInfoOutPut";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
	
	
	//fsp_addSearch(this, "ma/mag:MAG10120E_S008");
	
	//http.Sync = true;
	//fsp_callService(this, "", "", "ds_closeInfo=ds_closeInfo","ds_closeInfoOut=ds_closeInfoOut","","fn_closeInfoOut()", "", "", "", "");
	//http.Sync = false;
}

/*function fn_closeInfoOut()
{
	fsp_clear(this);
	//trace("ds_closeInfoOut : " +ds_closeInfoOut.saveXML());
	fsp_addSearch(this, "ma/mag:MAG10120E_S009");
	http.Sync = true;
	fsp_callService(this, "", "", "ds_closeInfo=ds_closeInfo","ds_closeInfoOutPut=ds_closeInfoOutPut","","fn_closeInfoOutPut()", "", "", "", "");
	http.Sync = false;
	//trace(ds_closeInfoOutPut.saveXML());
}*/

function fn_closeInfoOutPut()
{
	trace("fn_closeInfoOutPut");
	// 지불 차이 계산
	fn_setDifferAmt();
	//trace("ds_closeInfoOutPut : " +ds_closeInfoOutPut.saveXML());
}

/*----------------------------------------------------------------------------------------------------------------------
* 설명 	: 	마감하기전에 마감 이전날짜에 미마감된건이 있는지 조회
*---------------------------------------------------------------------------------------------------------------------*/
function fn_searchBeforeMagam(){
	trace("fn_searchBeforeMagam");
	tr_info = false;
	/*//fsp_clear(this);
	//trace(ds_beforeMagam.getColumn(0, "closeDate"));
	if(!gfn_isNull(ds_beforeMagam.getColumn(0, "closeDate"))){
	//trace(ds_beforeMagam.getColumn(0, "closeDate"));
		if(ds_beforeMagam.getColumn(0, "closeDate") == cal_CLOSE_DATEFR.value) return;
	}
	ds_beforeMagam.clearData();
	
	//ds_beforeMagam.addColumn("upjang", "STRING", 256);
	//ds_beforeMagam.addColumn("closeDate", "STRING", 256);
	//ds_beforeMagam.addColumn("closeGubun", "STRING", 256);
	
	ds_beforeMagam.addRow();
	
	ds_beforeMagam.setColumn(0, "upjang", edt_upjangNm.getUpjangCode() );
	ds_beforeMagam.setColumn(0, "closeDate", cal_CLOSE_DATEFR.value);
	ds_beforeMagam.setColumn(0, "closeGubun", Get_chk_Id() );

	
	var strSvcID    = "beforeMagam";
    var strURL      = "ma/mag/upjangDayClose/selectBeforeMagam.xdo";
    var strInDs     = "ds_search=ds_beforeMagam";
    var strOutDs    = "ds_searchMagam=ds_searchMagam";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
	
	//if(Get_chk_Id() == "007"){ //전체마감
	//	fsp_addSearch(this, "ma/mag:MAG10120E_S013");
	//}else{
	//	fsp_addSearch(this, "ma/mag:MAG10120E_S012");
	//}

	//http.Sycn = true;
	//fsp_callService(this, "", "", "ds_cond=ds_cond","ds_searchMagam=ds_searchMagam","","fn_closeInfo()", "", "", "", ""); // fn_closeInfo() - > 미마감 조회후 금액차이 조회
	//http.Sycn = false;
	*/
	
	fn_closeInfo(); // 미마감건 조회후 차이금액 조회
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 마감여부 & 매출 - 지불 차이 계산
 *---------------------------------------------------------------------------------------------*/
function fn_setDifferAmt(){
	trace("fn_setDifferAmt");
	var iSalsCloseCnt	= 0;	//매출마감건수
	var iPaymCloseCnt	= 0;	//지불마감건수
	var iSalsRowCnt		= 0;	//매출총건수
	var iPaymRowCnt		= 0;	//지불총건수
	var iSalsAmt		= 0;	//매출총금액
	var iPaymAmt		= 0;	//지불총금액

	iSalsRowCnt	= ds_closeInfoOutPut.rowcount;
	iPaymRowCnt	= ds_closeInfoOut.rowcount;
	//trace("ds_closeInfoOutPut : " +ds_closeInfoOutPut.rowcount);
	//trace("ds_closeInfoOut : " +ds_closeInfoOut.rowcount);
	//매출마감건수 / 매출총금액
	for(var i=0; i<iSalsRowCnt; i++){
		if(ds_closeInfoOutPut.getColumn(i, "ddddCloseYn") == "Y") iSalsCloseCnt++;
		if(ds_closeInfoOutPut.getColumn(i, "lvl") == 0) iSalsAmt += parseFloat(ds_closeInfoOutPut.getColumn(i, "salAmt"));
		//trace("SAL_AMT : " 	+ds_closeInfoOutPut.getColumn(i, "SAL_AMT"));
	}
	
	//지불마감건수 / 지불총금액
	for(var j=0; j<iPaymRowCnt; j++){
		if(ds_closeInfoOut.getColumn(j, "ddddCloseYn") == "Y") iPaymCloseCnt++;
		if(ds_closeInfoOut.getColumn(j, "lvl") == 0) iPaymAmt += parseFloat(ds_closeInfoOut.getColumn(j, "amt"));
		//trace("AMT : " +ds_closeInfoOut.getColumn(i, "AMT"));
	}

	//데이터가 없을 경우
	if(iSalsRowCnt == 0 || iPaymRowCnt == 0){
		//btn_receive.visible	= false;
		//btn_cancel.visible	= false;
		
	}	
	//데이터가 있을 경우
	/*}else{
	
		//마감된 데이터 -> '마감취소' 버튼 활성화
		if(iSalsCloseCnt == iSalsRowCnt && iPaymCloseCnt == iPaymRowCnt){
			ds_search.setColumn(0, "closeYn", "Y");
			btn_receive.visible	= false;
			btn_cancel.visible	= true;
			
		//마감이 안된 데이터 -> '마감처리' 버튼 활성화
		}else if(iSalsCloseCnt == 0 && iPaymCloseCnt == 0){
			ds_search.setColumn(0, "closeYn", "N");
			btn_receive.visible	= true;
			btn_cancel.visible	= false;
			
		//부분 마감 되었거나 데이터에 이상이 있는경우 '마감처리/취소'버튼 비활성
		}else{
			ds_search.setColumn(0, "closeYn", "");
			btn_receive.visible	= false;
			btn_cancel.visible	= false;
		}
	}*/

	edt_differAmt.value = iSalsAmt - iPaymAmt;
	

	//if(iSalsAmt != iPaymAmt){
	//	btn_receive.visible	= false;
	//	btn_cancel.visible	= false;
	//}
}

function fn_afterClose_11(){
	// 매출(장례식)
	ds_close.clearData();
	ds_close.addRow();
	ds_close.setColumn(0, "occurSdate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE"));
	ds_close.setColumn(0, "occurEdate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE") );
	ds_close.setColumn(0, "sysClass", 	"16");
	ds_close.setColumn(0, "closeGubun",	"006");
	ds_close.setColumn(0, "loginSabun", g_EmpNo);
	ds_close.setColumn(0, "upjangCd",	gUpjangCd );
	ds_close.setColumn(0, "closeYn",	"N");		//마감유무

	var strSvcID    = "closeProc_16";
	var strURL      = "ma/mas/closeMgmt/closeProc.xdo";
	var strInDs     = "ds_close=ds_close:U";
	var strOutDs    = "";
	var strArg      = "";
	var strCallback = "fn_callBack";
	var bAsync      = true;
	
	gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
				
	/*ds_close.clearData();
	ds_close.addRow();
	ds_close.setColumn(0, "occurDate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE"));
	ds_close.setColumn(0, "sysClass", 	"16");
	ds_close.setColumn(0, "upjangCd",	gUpjangCd);
	ds_close.setColumn(0, "closeYn",	"N");		//마감유무
	gfn_saveCloseProc(this, "closeProc_16", "ds_close"); // 프로시져*/
	
		
}
				
function fn_afterClose_16(){
	// 매출(폐식용유)
	ds_close.clearData();
	ds_close.addRow();
	ds_close.setColumn(0, "occurSdate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE") );
	ds_close.setColumn(0, "occurEdate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE") );
	ds_close.setColumn(0, "sysClass", 	"19");
	ds_close.setColumn(0, "closeGubun",	"008");
	ds_close.setColumn(0, "loginSabun", g_EmpNo);
	ds_close.setColumn(0, "upjangCd",	gUpjangCd );
	ds_close.setColumn(0, "closeYn",	"N");		//마감유무
		
	var strSvcID    = "closeProc_19";
	var strURL      = "ma/mas/closeMgmt/closeProc.xdo";
	var strInDs     = "ds_close=ds_close:U";
	var strOutDs    = "";
	var strArg      = "";
	var strCallback = "fn_callBack";
	var bAsync      = true;	

	gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
	
	/*ds_close.clearData();
	ds_close.addRow();
	ds_close.setColumn(0, "occurDate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE"));
	ds_close.setColumn(0, "sysClass", 	"19");
	ds_close.setColumn(0, "upjangCd",	gUpjangCd);
	ds_close.setColumn(0, "closeYn",	"N");		//마감유무
	gfn_saveCloseProc(this, "closeProc_19", "ds_close"); // 프로시져}*/
				
		
}

function fn_afterClose_19(){
	// 매출(특판)
	ds_close.clearData();
	ds_close.addRow();
	ds_close.setColumn(0, "occurSdate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE"));
	ds_close.setColumn(0, "occurEdate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE") );
	ds_close.setColumn(0, "sysClass", 	"17");
	ds_close.setColumn(0, "closeGubun",	"009");
	ds_close.setColumn(0, "loginSabun", g_EmpNo);
	ds_close.setColumn(0, "upjangCd",	gUpjangCd );
	ds_close.setColumn(0, "closeYn",	"N");		//마감유무
		
	var strSvcID    = "closeProc_17";
	var strURL      = "ma/mas/closeMgmt/closeProc.xdo";
	var strInDs     = "ds_close=ds_close:U";
	var strOutDs    = "";
	var strArg      = "";
	var strCallback = "fn_callBack";
	var bAsync      = true;
	
	gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
				/*ds_close.clearData();
				ds_close.addRow();
				ds_close.setColumn(0, "occurDate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE"));
				ds_close.setColumn(0, "sysClass", 	"17");
				ds_close.setColumn(0, "upjangCd",	gUpjangCd);
				ds_close.setColumn(0, "closeYn",	"N");		//마감유무
				gfn_saveCloseProc(this, "closeProc_17", "ds_close"); // 프로시져*/
		
}
function fn_afterClose_17(){
	
	// 전체마감후 MAS 테이블에 재고마감 INSERT
	fsp_clear(this);
	
	fsp_addSingle(this, "ma/mag:MAG10120E_D001");
	fsp_addSingle(this, "ma/mag:MAG10120E_I001");
		
	fsp_callService(this, 
							"", 
							"", 
							"", 
							"",  
							" UPJANG=" + edt_upjangNm.getUpjangCode() + 
							" CLOSE_GUBUN=" +  wrapQuote("004")  + 
							" CLOSE_DATEFR=" +  cal_CLOSE_DATEFR.value  + 
							" CLOSE_DATETO=" +  cal_CLOSE_DATETO.value  + 
							" CLOSE_YN=" +   "Y" , 
							"fn_afterClose_004()");
}

function fn_afterClose_004(){
	
	// 전체마감후 MAS 테이블에 급식운영일지 INSERT
	fsp_clear(this);
	
	fsp_addSingle(this, "ma/mag:MAG10120E_D001");
	fsp_addSingle(this, "ma/mag:MAG10120E_I001");
		
	fsp_callService(this, 
							"", 
							"", 
							"", 
							"",  
							" UPJANG=" + edt_upjangNm.getUpjangCode() + 
							" CLOSE_GUBUN=" +  wrapQuote("005")  + 
							" CLOSE_DATEFR=" +  cal_CLOSE_DATEFR.value  + 
							" CLOSE_DATETO=" +  cal_CLOSE_DATETO.value  + 
							" CLOSE_YN=" +   "Y" , 
							"fn_afterCloseHis()");
}

function fn_afterCloseHis(){
	// 전체마감 완료후 히스토리 저장
	fsp_clear(this);
	fsp_addSingle(this, "ma/mag:MAG10120E_I003");
		
	fsp_callService(this, 
							"", 
							"", 
							"", 
							"",  
							" UPJANG=" + edt_upjangNm.getUpjangCode() + 
							" CLOSE_GUBUN=" +  Get_chk_Id()  + 
							" CLOSE_DATEFR=" +  cal_CLOSE_DATEFR.value  + 
							" CLOSE_DATETO=" +  cal_CLOSE_DATETO.value  + 
							" CLOSE_YN=" +   "Y" , 
							"fn_AfterSaveSearch()");
}

function fn_afterCloseCancle_11(){
	// 매출(장례식)
	ds_close.clearData();
	ds_close.addRow();
	ds_close.setColumn(0, "occurSdate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE") );
	ds_close.setColumn(0, "occurEdate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE") );
	ds_close.setColumn(0, "sysClass", 	"16");
	ds_close.setColumn(0, "closeGubun",	"006");
	ds_close.setColumn(0, "loginSabun", g_EmpNo);
	ds_close.setColumn(0, "upjangCd",	gUpjangCd );
	ds_close.setColumn(0, "closeYn",	"Y");		//마감유무

	var strSvcID    = "closeCancle_16";
	var strURL      = "ma/mas/closeMgmt/closeProc.xdo";
	var strInDs     = "ds_close=ds_close:U";
	var strOutDs    = "";
	var strArg      = "";
	var strCallback = "fn_callBack";
	var bAsync      = true;
	
	gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
	
	/*ds_close.clearData();
	ds_close.addRow();
	ds_close.setColumn(0, "occurDate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE"));
	ds_close.setColumn(0, "sysClass", 	"16");
	ds_close.setColumn(0, "upjangCd",	gUpjangCd);
	ds_close.setColumn(0, "closeYn",	"Y");		//마감유무
	gfn_saveCloseProc(this, "closeCancle_16", "ds_close"); // 프로시져*/
}
				
function fn_afterCloseCancle_16(){
	// 매출(폐식용유)
	ds_close.clearData();
	ds_close.addRow();
	ds_close.setColumn(0, "occurSdate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE") );
	ds_close.setColumn(0, "occurEdate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE") );
	ds_close.setColumn(0, "sysClass", 	"19");
	ds_close.setColumn(0, "closeGubun",	"008");
	ds_close.setColumn(0, "loginSabun", g_EmpNo);
	ds_close.setColumn(0, "upjangCd",	gUpjangCd );
	ds_close.setColumn(0, "closeYn",	"Y");		//마감유무

	var strSvcID    = "closeCancle_19";
	var strURL      = "ma/mas/closeMgmt/closeProc.xdo";
	var strInDs     = "ds_close=ds_close:U";
	var strOutDs    = "";
	var strArg      = "";
	var strCallback = "fn_callBack";
	var bAsync      = true;

	gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
			
	/*ds_close.clearData();
	ds_close.addRow();
	ds_close.setColumn(0, "occurDate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE"));
	ds_close.setColumn(0, "sysClass", 	"19");
	ds_close.setColumn(0, "upjangCd",	gUpjangCd);
	ds_close.setColumn(0, "closeYn",	"Y");		//마감유무
	gfn_saveCloseProc(this, "closeCancle_19", "ds_close"); // 프로시져*/
}

function fn_afterCloseCancle_19(){
	// 매출(특판)
	ds_close.clearData();
	ds_close.addRow();
	ds_close.setColumn(0, "occurSdate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE") );
	ds_close.setColumn(0, "occurEdate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE") );
	ds_close.setColumn(0, "sysClass", 	"17");
	ds_close.setColumn(0, "closeGubun",	"009");
	ds_close.setColumn(0, "loginSabun", g_EmpNo);
	ds_close.setColumn(0, "upjangCd",	gUpjangCd );
	ds_close.setColumn(0, "closeYn",	"Y");		//마감유무

	var strSvcID    = "closeCancle_17";
	var strURL      = "ma/mas/closeMgmt/closeProc.xdo";
	var strInDs     = "ds_close=ds_close:U";
	var strOutDs    = "";
	var strArg      = "";
	var strCallback = "fn_callBack";
	var bAsync      = true;
	
	gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
	
	/*ds_close.clearData();
	ds_close.addRow();
	ds_close.setColumn(0, "occurDate", ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE"));
	ds_close.setColumn(0, "sysClass", 	"17");
	ds_close.setColumn(0, "upjangCd",	gUpjangCd);
	ds_close.setColumn(0, "closeYn",	"Y");		//마감유무
	gfn_saveCloseProc(this, "closeCancle_17", "ds_close"); // 프로시져*/
}
function fn_afterCloseCancle_17(){

		fsp_addSingle(this, "ma/mag:MAG10120E_I003");
		
		fsp_callService(this, 
								"", 
								"", 
								"", 
								"",  
								" UPJANG=" + edt_upjangNm.getUpjangCode() + 
								" CLOSE_GUBUN=" +  Get_chk_Id()  + 
								" CLOSE_DATEFR=" +  cal_CLOSE_DATEFR.value  + 
								" CLOSE_DATETO=" +  cal_CLOSE_DATETO.value  + 
								" CLOSE_YN=" +   "N" , 
								"fn_AfterSaveSearch()");
}
//===============================================================
// (2013-07-18 추가) 시작
// 김장욱 2013-07-18 CSR#(SR201306_05315) 요청자:이혜은(FS기획팀)
// 마감시 이력생성
//===============================================================
function fn_saveHistory(){
	
	// 히스토리 저장
	fsp_addSingle(this, "ma/mag:MAG10120E_I003");
	
	fsp_callService(this, 
								"", 
								"", 
								"", 
								"",  
								" UPJANG=" + edt_upjangNm.getUpjangCode() + 
								" CLOSE_GUBUN=" +  Get_chk_Id()  + 
								" CLOSE_DATEFR=" +  cal_CLOSE_DATEFR.value  + 
								" CLOSE_DATETO=" +  cal_CLOSE_DATETO.value  + 
								" CLOSE_YN=" +   "Y" , 
								"fn_AfterSaveSearch()");
}

//===============================================================
// (2013-07-18 추가) 시작
// 김장욱 2013-07-18 CSR#(SR201306_05315) 요청자:이혜은(FS기획팀)
// 마감취소시 이력생성
//===============================================================
function fn_cancleHistory(){
	
	// 히스토리 저장
	fsp_addSingle(this, "ma/mag:MAG10120E_I003");
	
	fsp_callService(this, 
								"", 
								"", 
								"", 
								"",  
								" UPJANG=" + edt_upjangNm.getUpjangCode() + 
								" CLOSE_GUBUN=" +  Get_chk_Id()  + 
								" CLOSE_DATEFR=" +  cal_CLOSE_DATEFR.value  + 
								" CLOSE_DATETO=" +  cal_CLOSE_DATETO.value  + 
								" CLOSE_YN=" +   "N" , 
								"fn_AfterSaveSearch()");
}

function btn_detailPop_onclick(obj:Button,  e:ClickEventInfo)
{
	if(ds_list.rowcount == 0) return;
		var sysClass;
		
		if(Get_chk_Id() == "001"){
			sysClass = 11;
		}else if(Get_chk_Id() == "006"){
			sysClass = 16;
		}else if(Get_chk_Id() == "008"){
			sysClass = 19;
		}else if(Get_chk_Id() == "009"){
			sysClass = 17;
		}else if(Get_chk_Id() == "012"){
			sysClass = 12;
		}else{
			gfn_alert("상세보기는 매출마감만 가능 합니다.");
			return;
		}
			
		
		var arrArg = new Array();
		arrArg[0] = ds_list.getColumn(ds_list.rowposition, "CLOSE_DATE")
		arrArg[1] = sysClass
		if(Get_chk_Id() == "012"){
			arrArg[2] = "2003"
		}else{
			arrArg[2] = "2002"
		}
		//arrArg[3] =
		arrArg[4] = edt_upjangNm.getUpjangCode()
		
		gfn_dialog(	"CloseMgntDtlPop"
					,"X_RCM::CloseMgntDtlPop3.xfdl"
					,{arrSchVal:arrArg}	//objArgumentList
					,-1		//Width
					,-1		//Height
					,""		//Style
					,-1		//Left
					,-1		//Top
					,false	//Modeless
					,true	//ShowTitle
					,"-1"	//Align
					,true);	//Resizable
}]]></Script>
  </Form>
</FDL>
