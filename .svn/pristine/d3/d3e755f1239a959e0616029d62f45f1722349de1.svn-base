<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="..\..\..\default_typedef.xml"/>
  <Form id="FSC00320E" classname="COMP_GUIDE_13" inheritanceid="" position="absolute 0 0 1252 725" titletext="CS진단 개선사항 등록" scrollbars="autoboth" onload="form_onload">
    <Layouts>
      <Layout>
        <Edit id="Edit02" taborder="50" readonly="true" position="absolute 938 568 1237 710" anchor="top right bottom"/>
        <Edit id="Edit01" taborder="49" readonly="true" position="absolute 938 542 1237 569" anchor="top right"/>
        <Static id="Static06" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1237 0 1252 710" anchor="top right"/>
        <Static id="Static71" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 710 1252 725" anchor="left bottom"/>
        <Div id="div_cmnBtn" anchor="left top right" taborder="3" url="cmn::CmnBtn.xfdl" text="Div00" scrollbars="none" position="absolute 0 0 1237 30"/>
        <Static id="Static18" text="진단 정보" class="sta_WF_Title01" position="absolute 0 84 450 102" anchor="left top"/>
        <Static id="Static19" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 0 71 500 84"/>
        <Static id="Static20" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 0 97 500 102" anchor="left top"/>
        <Grid id="grd_resultDtlList" taborder="36" binddataset="ds_chkDtlList" autoenter="select" useinputpanel="false" cellsizingtype="col" position="absolute 0 240 835 710" anchor="all" formats="&lt;Formats&gt;&#10;  &lt;Format id=&quot;default&quot;&gt;&#10;    &lt;Columns&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;    &lt;/Columns&gt;&#10;    &lt;Rows&gt;&#10;      &lt;Row band=&quot;head&quot; size=&quot;24&quot;/&gt;&#10;      &lt;Row band=&quot;body&quot; size=&quot;24&quot;/&gt;&#10;    &lt;/Rows&gt;&#10;    &lt;Band id=&quot;head&quot;&gt;&#10;      &lt;Cell col=&quot;0&quot; disptype=&quot;normal&quot; text=&quot;대분류&quot;/&gt;&#10;      &lt;Cell col=&quot;1&quot; disptype=&quot;normal&quot; text=&quot;중분류&quot;/&gt;&#10;      &lt;Cell col=&quot;2&quot; disptype=&quot;normal&quot; text=&quot;소분류&quot;/&gt;&#10;      &lt;Cell col=&quot;3&quot; disptype=&quot;normal&quot; text=&quot;평가점수&quot;/&gt;&#10;      &lt;Cell col=&quot;4&quot; disptype=&quot;normal&quot; text=&quot;우수점수&quot;/&gt;&#10;      &lt;Cell col=&quot;5&quot; disptype=&quot;normal&quot; text=&quot;해당없음&quot;/&gt;&#10;      &lt;Cell col=&quot;6&quot; disptype=&quot;normal&quot; text=&quot;체크항목&quot;/&gt;&#10;    &lt;/Band&gt;&#10;    &lt;Band id=&quot;body&quot;&gt;&#10;      &lt;Cell col=&quot;0&quot; disptype=&quot;normal&quot; text=&quot;bind:대분류&quot;/&gt;&#10;      &lt;Cell col=&quot;1&quot; disptype=&quot;normal&quot; text=&quot;bind:중분류&quot;/&gt;&#10;      &lt;Cell col=&quot;2&quot; disptype=&quot;normal&quot; text=&quot;bind:소분류&quot;/&gt;&#10;      &lt;Cell col=&quot;3&quot; disptype=&quot;normal&quot; text=&quot;bind:평가점수&quot;/&gt;&#10;      &lt;Cell col=&quot;4&quot; disptype=&quot;normal&quot; text=&quot;bind:우수점수&quot;/&gt;&#10;      &lt;Cell col=&quot;5&quot; disptype=&quot;normal&quot; text=&quot;bind:해당없음&quot;/&gt;&#10;      &lt;Cell col=&quot;6&quot; disptype=&quot;normal&quot; text=&quot;bind:체크항목&quot;/&gt;&#10;    &lt;/Band&gt;&#10;  &lt;/Format&gt;&#10;&lt;/Formats&gt;&#10;" autofittype="col" oncellclick="grd_resultDtlList_oncellclick" oncelldblclick="grd_resultDtlList_oncelldblclick">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="23"/>
                <Column size="90"/>
                <Column size="110"/>
                <Column size="180"/>
                <Column size="0"/>
                <Column size="66"/>
                <Column size="30"/>
              </Columns>
              <Rows>
                <Row size="24" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell class="head_Excel"/>
                <Cell col="1" text="대분류"/>
                <Cell col="2" text="중분류"/>
                <Cell col="3" text="소분류"/>
                <Cell col="4" text="평가내용"/>
                <Cell col="5" text="조치일"/>
                <Cell col="6" text="사진"/>
              </Band>
              <Band id="body">
                <Cell text="expr:rowidx+1"/>
                <Cell col="1" displaytype="text" text="bind:HL_CLASS_NM"/>
                <Cell col="2" displaytype="text" text="bind:HM_CLASS_NM"/>
                <Cell col="3" displaytype="text" text="bind:CLASS_NM"/>
                <Cell col="4" displaytype="text" text="bind:평가내용"/>
                <Cell col="5" displaytype="date" text="bind:IMPROV_MRMT_DD" calendardisplaynulltype="none"/>
                <Cell col="6" style="background:EXPR(iif(IMGE_CNT&gt;0,grd_list_BKimg('popup1'), ''));background2:EXPR(iif(IMGE_CNT&gt;0,grd_list_BKimg('popup2'), ''));selectbackground:EXPR(iif(IMGE_CNT&gt;0,grd_list_BKimg('selectpopup'), ''));"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Static id="Static08" class="sta_WFSA_Labelbg" position="absolute 0 30 1237 71" anchor="left top right"/>
        <Static id="Static28" text="사업장" class="sta_WFSA_label" position="absolute 15 40 77 61" anchor="left top"/>
        <Static id="Static04" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 30 93 40" anchor="left top"/>
        <Static id="Static05" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 61 93 71" anchor="left top"/>
        <Static id="Static07" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 40 15 61" anchor="left top"/>
        <Static id="Static11" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 60 40 70 61" anchor="left top"/>
        <Static id="Static09" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 294 40 324 61" anchor="left top"/>
        <Static id="Static00" text="기간" class="sta_WFSA_label" position="absolute 324 40 386 61" anchor="left top"/>
        <Static id="Static01" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 358 40 368 61" anchor="left top"/>
        <Grid id="grd_resultList" taborder="5" useinputpanel="false" position="absolute 0 102 1237 207" formats="&lt;Formats&gt;&#10;  &lt;Format id=&quot;default&quot;&gt;&#10;    &lt;Columns&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;    &lt;/Columns&gt;&#10;    &lt;Rows&gt;&#10;      &lt;Row band=&quot;head&quot; size=&quot;24&quot;/&gt;&#10;      &lt;Row band=&quot;body&quot; size=&quot;24&quot;/&gt;&#10;    &lt;/Rows&gt;&#10;    &lt;Band id=&quot;head&quot;&gt;&#10;      &lt;Cell col=&quot;0&quot; disptype=&quot;normal&quot; text=&quot;진단표구분&quot;/&gt;&#10;      &lt;Cell col=&quot;1&quot; disptype=&quot;normal&quot; text=&quot;양식&quot;/&gt;&#10;      &lt;Cell col=&quot;2&quot; disptype=&quot;normal&quot; text=&quot;진단구분&quot;/&gt;&#10;      &lt;Cell col=&quot;3&quot; disptype=&quot;normal&quot; text=&quot;진단자&quot;/&gt;&#10;      &lt;Cell col=&quot;4&quot; disptype=&quot;normal&quot; text=&quot;진단일자&quot;/&gt;&#10;      &lt;Cell col=&quot;5&quot; disptype=&quot;normal&quot; text=&quot;보고일자&quot;/&gt;&#10;      &lt;Cell col=&quot;6&quot; disptype=&quot;normal&quot; text=&quot;사업장명&quot;/&gt;&#10;      &lt;Cell col=&quot;7&quot; disptype=&quot;normal&quot; text=&quot;점장명&quot;/&gt;&#10;      &lt;Cell col=&quot;8&quot; disptype=&quot;normal&quot; text=&quot;소속팀&quot;/&gt;&#10;      &lt;Cell col=&quot;9&quot; disptype=&quot;normal&quot; text=&quot;본사담당자&quot;/&gt;&#10;      &lt;Cell col=&quot;10&quot; disptype=&quot;normal&quot; text=&quot;팀장&quot;/&gt;&#10;      &lt;Cell col=&quot;11&quot; disptype=&quot;normal&quot; text=&quot;근무인원&quot;/&gt;&#10;    &lt;/Band&gt;&#10;    &lt;Band id=&quot;body&quot;&gt;&#10;      &lt;Cell col=&quot;0&quot; disptype=&quot;normal&quot; text=&quot;bind:진단표구분&quot;/&gt;&#10;      &lt;Cell col=&quot;1&quot; disptype=&quot;normal&quot; text=&quot;bind:양식&quot;/&gt;&#10;      &lt;Cell col=&quot;2&quot; disptype=&quot;normal&quot; text=&quot;bind:진단구분&quot;/&gt;&#10;      &lt;Cell col=&quot;3&quot; disptype=&quot;normal&quot; text=&quot;bind:진단자&quot;/&gt;&#10;      &lt;Cell col=&quot;4&quot; disptype=&quot;normal&quot; text=&quot;bind:진단일자&quot;/&gt;&#10;      &lt;Cell col=&quot;5&quot; disptype=&quot;normal&quot; text=&quot;bind:보고일자&quot;/&gt;&#10;      &lt;Cell col=&quot;6&quot; disptype=&quot;normal&quot; text=&quot;bind:사업장명&quot;/&gt;&#10;      &lt;Cell col=&quot;7&quot; disptype=&quot;normal&quot; text=&quot;bind:점장명&quot;/&gt;&#10;      &lt;Cell col=&quot;8&quot; disptype=&quot;normal&quot; text=&quot;bind:소속팀&quot;/&gt;&#10;      &lt;Cell col=&quot;9&quot; disptype=&quot;normal&quot; text=&quot;bind:본사담당자&quot;/&gt;&#10;      &lt;Cell col=&quot;10&quot; disptype=&quot;normal&quot; text=&quot;bind:팀장&quot;/&gt;&#10;      &lt;Cell col=&quot;11&quot; disptype=&quot;normal&quot; text=&quot;bind:근무인원&quot;/&gt;&#10;    &lt;/Band&gt;&#10;  &lt;/Format&gt;&#10;&lt;/Formats&gt;&#10;" anchor="left top right" binddataset="ds_resultList" autofittype="col" oncelldblclick="grd_resultList_oncelldblclick">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="24"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="73"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="87"/>
                <Column size="77"/>
              </Columns>
              <Rows>
                <Row size="24" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell text="순번"/>
                <Cell col="1" text="진단구분"/>
                <Cell col="2" text="진단일자"/>
                <Cell col="3" text="진단자"/>
                <Cell col="4" text="점수"/>
                <Cell col="5" text="개선체크건수"/>
                <Cell col="6" text="개선건수"/>
                <Cell col="7" text="개선확정여부"/>
                <Cell col="8" text="결재상태"/>
              </Band>
              <Band id="body">
                <Cell text="expr:rowidx+1"/>
                <Cell col="1" displaytype="combo" text="bind:CHK_CLASS" combodataset="ds_cboChkClass" combocodecol="CODE" combodatacol="CODE_NAME"/>
                <Cell col="2" displaytype="date" text="bind:CHK_DD" calendardisplaynulltype="none"/>
                <Cell col="3" displaytype="normal" text="bind:INSPECTOR_NM" combodataset="Dataset04" combocodecol="코드" combodatacol="값"/>
                <Cell col="4" displaytype="number" style="align:center;" text="bind:SCORE"/>
                <Cell col="5" text="bind:IMPROV_CHECK_CNT"/>
                <Cell col="6" text="bind:IMPROV_MRMT_CNT"/>
                <Cell col="7" style="align: ;" text="bind:IMPROV_CONFIRM_YN"/>
                <Cell col="8" expr="expr:SIGN_PROGRESS_STATUS2==&quot;DRAFT&quot;?&quot;상신&quot;:(SIGN_PROGRESS_STATUS2==&quot;REJECT&quot;?&quot;반려&quot;:(SIGN_PROGRESS_STATUS2==&quot;COMPLETE&quot;?&quot;승인&quot;:(SIGN_PROGRESS_STATUS2==&quot;CANCEL&quot;?&quot;취소&quot;:&quot;&quot;)))"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Static id="Static02" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 592 40 622 61" anchor="left top"/>
        <Static id="Static47" text="8" class="Guide05_SizeBlack" visible="false" position="absolute 468 37 483 56"/>
        <Static id="Static85" text="~" class="sta_WF_Dash" position="absolute 476 40 492 61"/>
        <Static id="Static86" class="Guide01_AreaRed" visible="false" position="absolute 468 46 476 53"/>
        <Static id="Static87" class="Guide01_AreaRed" visible="false" position="absolute 484 46 492 53"/>
        <Static id="Static88" text="8" class="Guide05_SizeBlack" visible="false" position="absolute 485 37 500 56"/>
        <Static id="Static23" text="개선조치사항" class="sta_WF_Title01" position="absolute 0 222 450 249" anchor="left top"/>
        <Static id="Static49" text="h06" class="Guide01_AreaRed" visible="false" position="absolute 1179 71 1237 77" anchor="top right"/>
        <Static id="Static24" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 845 386 1237 391" anchor="left top"/>
        <Static id="Static60" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 207 1237 222" anchor="left top"/>
        <TextArea id="edt_chkContents" taborder="37" readonly="true" position="absolute 845 391 1237 510" anchor="top right" maxlength="200"/>
        <Static id="Static27" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 845 358 1237 373" anchor="left top"/>
        <Static id="Static25" text="평가 내용" class="sta_WF_Title01" position="absolute 845 373 1145 391" anchor="top right"/>
        <TextArea id="TextArea03" taborder="38" wordwrap="word" readonly="true" position="absolute 941 295 1233 356" anchor="top right"/>
        <Edit id="Edit11" taborder="39" readonly="true" position="absolute 941 269 1234 290" anchor="top right"/>
        <Edit id="Edit07" taborder="40" readonly="true" position="absolute 941 243 1234 264" anchor="top right"/>
        <Static id="Static17" text="대분류" class="sta_WFDA_Label01" position="absolute 845 240 939 267" anchor="top right"/>
        <Static id="Static16" text="중분류" class="sta_WFDA_Label01" position="absolute 845 266 939 293" anchor="top right"/>
        <Static id="Static22" text="소분류" class="sta_WFDA_Label01" position="absolute 845 292 939 358" anchor="top right"/>
        <Static id="Static29" class="sta_WFDA_Labelbg" position="absolute 938 240 1237 267" anchor="top right"/>
        <Static id="Static30" class="sta_WFDA_Labelbg" position="absolute 938 266 1237 293" anchor="top right"/>
        <Static id="Static31" class="sta_WFDA_Labelbg" position="absolute 938 292 1237 358" anchor="top right"/>
        <TextArea id="txt_improvMrmtContents" taborder="42" class="txt_WF_Essential" position="absolute 942 571 1234 706" anchor="top right bottom"/>
        <Static id="Static33" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 845 537 1145 542" anchor="left top"/>
        <Static id="Static34" text="개선 조치" class="sta_WF_Title01" position="absolute 845 524 1145 542" anchor="top right"/>
        <Static id="Static46" text="h05" class="Guide01_AreaRed" visible="false" position="absolute 1179 537 1237 542" anchor="top right"/>
        <Static id="Static35" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 845 510 1145 525" anchor="left top"/>
        <Static id="Static36" text="h06" class="Guide01_AreaRed" visible="false" position="absolute 1179 511 1237 517" anchor="top right"/>
        <TextArea id="edt_classNm" taborder="45" wordwrap="word" readonly="true" position="absolute 941 295 1234 355" anchor="top right"/>
        <Edit id="edt_hmClassNm" taborder="46" readonly="true" position="absolute 941 269 1234 290" anchor="top right"/>
        <Edit id="edt_hlClassNm" taborder="47" readonly="true" position="absolute 941 243 1234 264" anchor="top right"/>
        <Static id="Static38" text="w10" class="Guide01_AreaRed" visible="false" position="absolute 835 240 845 710"/>
        <Static id="Static03" text="조치일" class="sta_WFDA_Label01" position="absolute 845 542 939 569" anchor="top right"/>
        <Static id="Static10" text="조치내용" class="sta_WFDA_Label01" position="absolute 845 568 939 710" anchor="top right bottom"/>
        <Calendar id="cal_improvMrmtDd" taborder="51" position="absolute 942 545 1061 566" dateformat="yyyy-MM-dd" value="null" class="cal_WF_Essential" anchor="top right"/>
        <Button id="btn_uploadImprovImge" taborder="52" text="개선사진등록" onclick="btn_uploadImprovImge_onclick" class="btn_WF_Function" position="absolute 1148 517 1237 537" anchor="top right"/>
        <Button id="btn_confirm" taborder="53" text="개선확정" onclick="btn_confirm_onclick" class="btn_WF_Function" position="absolute 1172 77 1237 97" anchor="top right"/>
        <Static id="Static12" text="h05" class="Guide01_AreaRed" visible="false" position="absolute 1078 97 1237 102" anchor="top right"/>
        <Static id="Static13" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 0 235 1215 240" anchor="left top"/>
        <UpjangSearchComponent id="edt_upjangNm" titletext="업장 검색용 Component" taborder="55" text="UpjangSearchComponent00" position="absolute 70 40 294 61" bindDataset="ds_cond" bindUpjangCodeColumn="UPJANG" bindUpjangNameColumn="UPJANGNM" eventBeforeTrigger="" eventAfterTrigger="" roleSetId="ScoAuthLevel01"/>
        <ObjCalendar id="cal_startDd" anchor="left top" titletext="캘린더" taborder="56" scrollbars="none" position="absolute 368 40 471 61"/>
        <ObjCalendar id="cal_endDd" anchor="left top" titletext="캘린더" taborder="57" scrollbars="none" position="absolute 491 40 594 61"/>
        <Button id="btn_gwDraft" taborder="58" text="개선결과상신" onclick="btn_gwDraft_onclick" class="btn_WF_CRUD" position="absolute 661 0 755 25" anchor="top right"/>
        <Button id="btn_gwDetail" taborder="59" text="개선결과상세" onclick="btn_gwDetail_onclick" class="btn_WF_CRUD" position="absolute 757 0 851 25" anchor="top right"/>
      </Layout>
    </Layouts>
    <Bind>
      <BindItem id="item0" compid="edt_upjangNm" propid="value" datasetid="ds_cond" columnid="UPJANGNM"/>
      <BindItem id="item1" compid="Edit01" propid="value" datasetid="Dataset04" columnid="대분류"/>
      <BindItem id="item18" compid="edt_chkContents" propid="value" datasetid="ds_chkDtlList" columnid="CHK_CONTENTS"/>
      <BindItem id="item14" compid="TextArea03" propid="value" datasetid="Dataset04" columnid="소분류"/>
      <BindItem id="item13" compid="Edit11" propid="value" datasetid="Dataset04" columnid="중분류"/>
      <BindItem id="item12" compid="Edit07" propid="value" datasetid="Dataset04" columnid="대분류"/>
      <BindItem id="item15" compid="edt_classNm" propid="value" datasetid="ds_chkDtlList" columnid="CLASS_NM"/>
      <BindItem id="item16" compid="edt_hmClassNm" propid="value" datasetid="ds_chkDtlList" columnid="HM_CLASS_NM"/>
      <BindItem id="item17" compid="edt_hlClassNm" propid="value" datasetid="ds_chkDtlList" columnid="HL_CLASS_NM"/>
      <BindItem id="item2" compid="Edit02" propid="value" datasetid="Dataset04" columnid="대분류"/>
      <BindItem id="item3" compid="cal_improvMrmtDd" propid="value" datasetid="ds_chkDtlList" columnid="IMPROV_MRMT_DD"/>
      <BindItem id="item4" compid="txt_improvMrmtContents" propid="value" datasetid="ds_chkDtlList" columnid="IMPROV_MRMT_CONTENTS"/>
    </Bind>
    <Objects>
      <Dataset id="ds_cond" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="UPJANG" type="STRING" size="256"/>
          <Column id="UPJANGNM" type="STRING" size="256"/>
          <Column id="START_DD" type="STRING" size="256"/>
          <Column id="END_DD" type="STRING" size="256"/>
          <Column id="TABLE_TYPE" type="STRING" size="256"/>
          <Column id="FORM_CD" type="STRING" size="256"/>
          <Column id="CHK_DD" type="STRING" size="256"/>
          <Column id="CHK_RESULT" type="STRING" size="256"/>
          <Column id="CONFIRM_YN" type="STRING" size="256"/>
          <Column id="SIGN_INSTANCE_ID1" type="STRING" size="256"/>
          <Column id="SIGN_INSTANCE_ID2" type="STRING" size="256"/>
          <Column id="DRAFT_GUBUN" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row/>
        </Rows>
      </Dataset>
      <Dataset id="ds_cboChkClass" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="256"/>
          <Column id="CODE_NAME" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cboChkResult" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="256"/>
          <Column id="CODE_NAME" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_resultMst" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" oncolumnchanged="ds_resultMst_oncolumnchanged">
        <ColumnInfo>
          <Column id="TABLE_TYPE" type="STRING" size="256"/>
          <Column id="FORM_CD" type="STRING" size="256"/>
          <Column id="FORM_NM" type="STRING" size="256"/>
          <Column id="UPJANG" type="STRING" size="256"/>
          <Column id="UPJANGNM" type="STRING" size="256"/>
          <Column id="CHK_DD" type="STRING" size="256"/>
          <Column id="DEAL_CLASS" type="STRING" size="256"/>
          <Column id="CHK_CLASS" type="STRING" size="256"/>
          <Column id="TM_CD" type="STRING" size="256"/>
          <Column id="TM_NM" type="STRING" size="256"/>
          <Column id="DUTY_PSN" type="STRING" size="256"/>
          <Column id="CHARGE_SABUN" type="STRING" size="256"/>
          <Column id="CHARGE_NM" type="STRING" size="256"/>
          <Column id="TEAM_MST_SABUN" type="STRING" size="256"/>
          <Column id="TEAM_MST_NM" type="STRING" size="256"/>
          <Column id="SUBTEAM_MST_SABUN" type="STRING" size="256"/>
          <Column id="SUBTEAM_MST_NM" type="STRING" size="256"/>
          <Column id="LEADER_SABUN" type="STRING" size="256"/>
          <Column id="LEADER_NM" type="STRING" size="256"/>
          <Column id="INSPECTOR" type="STRING" size="256"/>
          <Column id="INSPECTOR_NM" type="STRING" size="256"/>
          <Column id="CHK_START_TIME" type="STRING" size="256"/>
          <Column id="CHK_END_TIME" type="STRING" size="256"/>
          <Column id="SCORE" type="STRING" size="256"/>
          <Column id="CHK_RESULT" type="STRING" size="256"/>
          <Column id="CHK_RESULT_TXT" type="STRING" size="256"/>
          <Column id="CONFIRM_YN" type="STRING" size="256"/>
          <Column id="IMPROV_CONFIRM_YN" type="STRING" size="256"/>
          <Column id="IMPROV_CONFIRM_DD" type="STRING" size="256"/>
          <Column id="IMPROV_MRMT_YN" type="STRING" size="256"/>
          <Column id="IMPROV_MRMT_DD" type="STRING" size="256"/>
          <Column id="INSPT_REQ_YN" type="STRING" size="256"/>
          <Column id="INSPT_REQ_DD" type="STRING" size="256"/>
          <Column id="INSPT_REQ_NUM" type="STRING" size="256"/>
          <Column id="INSPT_REQ_RESULT" type="STRING" size="256"/>
          <Column id="REMARK" type="STRING" size="256"/>
          <Column id="USE_YN" type="STRING" size="256"/>
          <Column id="CUSER" type="STRING" size="256"/>
          <Column id="CDATE" type="STRING" size="256"/>
          <Column id="UUSER" type="STRING" size="256"/>
          <Column id="UDATE" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_focsDtlList" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" onvaluechanged="ds_resultDtlList_onvaluechanged">
        <ColumnInfo>
          <Column id="TABLE_TYPE" type="STRING" size="256"/>
          <Column id="FORM_CD" type="STRING" size="256"/>
          <Column id="CLASS_CD" type="STRING" size="256"/>
          <Column id="HL_CLASS_CD" type="STRING" size="256"/>
          <Column id="HL_CLASS_NM" type="STRING" size="256"/>
          <Column id="HM_CLASS_CD" type="STRING" size="256"/>
          <Column id="HM_CLASS_NM" type="STRING" size="256"/>
          <Column id="CLASS_NM" type="STRING" size="256"/>
          <Column id="CHK_IDCTR" type="INT" size="256"/>
          <Column id="USE_YN" type="STRING" size="256"/>
          <Column id="CUSER" type="STRING" size="256"/>
          <Column id="CDATE" type="STRING" size="256"/>
          <Column id="UUSER" type="STRING" size="256"/>
          <Column id="UDATE" type="STRING" size="256"/>
          <Column id="NA_YN" type="STRING" size="256"/>
          <Column id="IMPROV_CHECK" type="STRING" size="256"/>
          <Column id="CHK_SCORE" type="STRING" size="256"/>
          <Column id="CHK_RESULT" type="STRING" size="256"/>
          <Column id="CHK_CONTENTS" type="STRING" size="256"/>
          <Column id="CHK_CONTENTS_YN" type="STRING" size="256"/>
          <Column id="IMPROV_MRMT_DD" type="STRING" size="256"/>
          <Column id="IMPROV_MRMT_CONTENTS" type="STRING" size="256"/>
          <Column id="IMPROV_CONTENTS_YN" type="STRING" size="256"/>
          <Column id="IMGE_CNT" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_chkDtlList" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" onrowposchanged="ds_chkDtlList_onrowposchanged">
        <ColumnInfo>
          <Column id="TABLE_TYPE" type="STRING" size="256"/>
          <Column id="FORM_CD" type="STRING" size="256"/>
          <Column id="CLASS_CD" type="STRING" size="256"/>
          <Column id="HL_CLASS_CD" type="STRING" size="256"/>
          <Column id="HL_CLASS_NM" type="STRING" size="256"/>
          <Column id="HM_CLASS_CD" type="STRING" size="256"/>
          <Column id="HM_CLASS_NM" type="STRING" size="256"/>
          <Column id="CLASS_NM" type="STRING" size="256"/>
          <Column id="CHK_IDCTR" type="INT" size="256"/>
          <Column id="USE_YN" type="STRING" size="256"/>
          <Column id="CUSER" type="STRING" size="256"/>
          <Column id="CDATE" type="STRING" size="256"/>
          <Column id="UUSER" type="STRING" size="256"/>
          <Column id="UDATE" type="STRING" size="256"/>
          <Column id="NA_YN" type="STRING" size="256"/>
          <Column id="IMPROV_CHECK" type="STRING" size="256"/>
          <Column id="CHK_SCORE" type="STRING" size="256"/>
          <Column id="CHK_RESULT" type="STRING" size="256"/>
          <Column id="CHK_CONTENTS" type="STRING" size="256"/>
          <Column id="CHK_CONTENTS_YN" type="STRING" size="256"/>
          <Column id="IMPROV_MRMT_DD" type="STRING" size="256"/>
          <Column id="IMPROV_MRMT_CONTENTS" type="STRING" size="256"/>
          <Column id="IMPROV_CONTENTS_YN" type="STRING" size="256"/>
          <Column id="IMGE_CNT" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_resultList" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" onrowposchanged="ds_resultList_onrowposchanged">
        <ColumnInfo>
          <Column id="TABLE_TYPE" type="STRING" size="256"/>
          <Column id="FORM_CD" type="STRING" size="256"/>
          <Column id="FORM_NM" type="STRING" size="256"/>
          <Column id="UPJANG" type="STRING" size="256"/>
          <Column id="CHK_DD" type="STRING" size="256"/>
          <Column id="CHK_CLASS" type="STRING" size="256"/>
          <Column id="CHK_CLASS_NM" type="STRING" size="256"/>
          <Column id="TM_CD" type="STRING" size="256"/>
          <Column id="DELIVERY_PLCE" type="STRING" size="256"/>
          <Column id="INSPECTOR" type="STRING" size="256"/>
          <Column id="INSPECTOR_NM" type="STRING" size="256"/>
          <Column id="CHK_START_TIME" type="STRING" size="256"/>
          <Column id="CHK_END_TIME" type="STRING" size="256"/>
          <Column id="SCORE" type="STRING" size="256"/>
          <Column id="CONFIRM_YN" type="STRING" size="256"/>
          <Column id="IMPROV_CONFIRM_YN" type="STRING" size="256"/>
          <Column id="IMPROV_CONFIRM_DD" type="STRING" size="256"/>
          <Column id="INSPT_REQ_YN" type="STRING" size="256"/>
          <Column id="INSPT_REQ_DD" type="STRING" size="256"/>
          <Column id="INSPT_REQ_NUM" type="STRING" size="256"/>
          <Column id="INSPT_REQ_RESULT" type="STRING" size="256"/>
          <Column id="REMARK" type="STRING" size="256"/>
          <Column id="USE_YN" type="STRING" size="256"/>
          <Column id="CUSER" type="STRING" size="256"/>
          <Column id="CDATE" type="STRING" size="256"/>
          <Column id="UUSER" type="STRING" size="256"/>
          <Column id="UDATE" type="STRING" size="256"/>
          <Column id="IMPROV_CHECK_CNT" type="STRING" size="256"/>
          <Column id="SIGN_INSTANCE_ID1" type="STRING" size="256"/>
          <Column id="SIGN_PROGRESS_STATUS1" type="STRING" size="256"/>
          <Column id="SIGN_INSTANCE_ID2" type="STRING" size="256"/>
          <Column id="SIGN_PROGRESS_STATUS2" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_resultDtlList" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" onrowposchanged="ds_resultDtlList_onrowposchanged">
        <ColumnInfo>
          <Column id="TABLE_TYPE" type="STRING" size="256"/>
          <Column id="FORM_CD" type="STRING" size="256"/>
          <Column id="CLASS_CD" type="STRING" size="256"/>
          <Column id="HL_CLASS_CD" type="STRING" size="256"/>
          <Column id="HL_CLASS_NM" type="STRING" size="256"/>
          <Column id="HM_CLASS_CD" type="STRING" size="256"/>
          <Column id="HM_CLASS_NM" type="STRING" size="256"/>
          <Column id="CLASS_NM" type="STRING" size="256"/>
          <Column id="CHK_IDCTR" type="INT" size="256"/>
          <Column id="USE_YN" type="STRING" size="256"/>
          <Column id="CUSER" type="STRING" size="256"/>
          <Column id="CDATE" type="STRING" size="256"/>
          <Column id="UUSER" type="STRING" size="256"/>
          <Column id="UDATE" type="STRING" size="256"/>
          <Column id="NA_YN" type="STRING" size="256"/>
          <Column id="IMPROV_CHECK" type="STRING" size="256"/>
          <Column id="CHK_SCORE" type="STRING" size="256"/>
          <Column id="CHK_RESULT" type="STRING" size="256"/>
          <Column id="CHK_CONTENTS" type="STRING" size="256"/>
          <Column id="CHK_CONTENTS_YN" type="STRING" size="256"/>
          <Column id="IMPROV_MRMT_DD" type="STRING" size="256"/>
          <Column id="IMPROV_MRMT_CONTENTS" type="STRING" size="256"/>
          <Column id="IMPROV_CONTENTS_YN" type="STRING" size="256"/>
          <Column id="IMGE_CNT" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Script type="xscript4.0"><![CDATA[include "U_lib::lib_conversionCom.xjs";

/******************************************************************************************
 * 시스템구분 : 위생관리/CS진단관리
 * 프로그램명 : FSC00420E.XML
 * 기ㅡㅡㅡ능 : 개선사항등록
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-03-25
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************/
 
//=========================================================================================
// [ PART 1 ]
// Form에서 Include 할 내용을 정의
//
//=========================================================================================

//=========================================================================================
// [ PART 2 ]
// Form에서 사용될 전역변수를 선언
//
//=========================================================================================
var fv_attachList;	//상신 첨부 파일 목록 (json)
var fv_RefSeq;
var fv_option = {buttons:[{id:"btn_gwDraft", action:"draft"}, {id:"btn_gwDetail", action:"detail"}]}; //개선결과 결재 관련 버튼 정의
//var fv_optionCheck = {buttons:[{id:"btn_gwDraftCheck", action:"draft"}, {id:"btn_gwDetailCheck", action:"detail"}]}; //점검결과 결재 관련 버튼 정의
var fv_retVal;
var strDraftGubun = '6'	// 1:점검결과, 2:개선결과
//var iOffsetX = 192;

//=========================================================================================
// [ PART 3 ]
// Form Loading 시 작업 정의
//
//=========================================================================================
function form_onload(obj:Form, e:LoadEventInfo)
{
	gfn_formOnLoad(this);

	// X-Framework : Action 정보 생성
	fsp_init(this);
	
	// 초기화
	fn_init();
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_init()
 * 기ㅡㅡㅡ능 : 초기화
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-03-25
 ******************************************************************************************/
function fn_init() 
{
	// 조회조건 DataSet 초기화
	//ds_cond.clearData();
	//ds_cond.addRow();

	//그룹웨어 연동 초기화
    SCGw.init (this);
    
    btn_gwDraft.enable = false;
	btn_gwDetail.enable = false;
	
	//공통코드조회
	var objCode = fn_common_code("'FS0107','FS0117'","","","non","Y");

	// CS 진단구분
	sCond = "GROUP_CODE == 'FS0107'";
	objCode.filter(sCond);
	CopyF(ds_cboChkClass, objCode.name);

	// 진단결과
	sCond = "GROUP_CODE == 'FS0117'";
	objCode.filter(sCond);
	CopyF(ds_cboChkResult, objCode.name);

	btn_uploadImprovImge.visible = false;

	fn_gwUserButtonInit();

	// 조회기간 초기화
	cal_startDd.fn_initMonthCal(this, gfn_today().substr(0, 6) + '01', "", ds_cond, "START_DD", "Y");
	cal_endDd.fn_initMonthCal(this, gfn_today(), "", ds_cond, "END_DD", "Y");
}

//=========================================================================================
// [ PART 4 ]
// Main Process Event 정의(조회,입력,삭제,저장,출력)
//
//=========================================================================================
/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_search()
 * 기ㅡㅡㅡ능 : 진단정보 목록조회
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-03-25
 ******************************************************************************************/
function fn_search() 
{
	if (gfn_isNull(ds_cond.getColumn(0, "UPJANG")))
	{
		g_Message("EE", "사업장를 선택해주세요.");
		return;
	}
	
	btn_gwDraft.enable = false;
	btn_gwDetail.enable = false;
	
	var strMsg = "변경된 내역이 있습니다. 저장하시겠습니까?";

	// 변경 데이터 체크
	if(gfn_dsIsUpdated(ds_focsDtlList) || gfn_dsIsUpdated(ds_chkDtlList) || gfn_dsIsUpdated(ds_resultMst))
	{
		if (g_Confirm("02",strMsg))
		{
			fn_save();
			return;
		}
	}	
	
	// 조회조건 초기화
	ds_cond.setColumn(0, "CONFIRM_YN", "Y");	// 결과확정된 정보만 조회
	ds_cond.setColumn(0, "CHK_DD", "");
	
	// 진단결과목록 초기화
	ds_resultList.clearData();
	ds_focsDtlList.clearData();
	ds_chkDtlList.clearData();

	btn_uploadImprovImge.visible = false;

	fsp_clear(this);
	fsp_addSearch(this,"fs/fsc:FSC00410E_S001");
	fsp_callService(this,"","","ds_cond=ds_cond","ds_resultList=ds_list","","fn_callBackSearch");
}

function fn_callBackSearch(errCode, errMsg) 
{
	if( errCode != 0 ) {
		g_Message("EE", errMsg);
		return;
	}
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_save()
 * 기ㅡㅡㅡ능 : 진단결과 저장
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-03-25
 ******************************************************************************************/
function fn_save() 
{
	if(!gfn_dsIsUpdated(ds_chkDtlList))
	{
		g_Message("EE", "변경된 데이터가 없습니다.");
		return false;
	}

	if (ds_resultMst.getColumn(0, "SIGN_PROGRESS_STATUS2") == "DRAFT" && ds_resultMst.getColumn(0, "SIGN_PROGRESS_STATUS2") == "COMPLETE")
	{
		g_Message("EE", "개선결과 상신 또는 승인된 점검정보는 수정이 불가합니다.");
		return;
	}
	
	// 유효성 검사
//	if (gfn_validCheck(ds_resultMst, ds_resultMstValid, true) == false) return;

	if (!confirm("개선사항을 저장하시겠습니까?", "확인", "default")) return;
		
	jsp_transaction(
		  this                                 // 해당 스크립트를 호출하는 Form 객체
		, "FSC00300E_T001"                     // 서비스 ID
		, "U_svc::fs/fsc/FSC00410E_T001.jsp"   // 서비스 URL
		, "ds_cond=ds_cond ds_resultMst=ds_resultMst:U ds_focsDtlList=ds_focsDtlList:U ds_chkDtlList=ds_chkDtlList:U"        // 서버로 전송할 DataSet 객체 Str
		, ""                                   // 서버로부터 전송 받을 DataSet 객체 String
		, ""                                   // 서버로 전송할 기타 Argument 정보 String
		, "fn_callBackSave"                    // 서버에서 처리가 완료된 후 Callback 받을 Function 명
		, true                                 // 에러 발생 시 Callback 함수 호출 여부
		, false                                // 처리중입니다. 메시지 창 보여줄지 여부 설정하기
		, false                                // 동기식으로 설정할지 여부
	);
}

function fn_callBackSave(errCode, errMsg) 
{
	if( errCode != 0 ) {
		g_Message("EE", errMsg);
		return;
	} else {
		g_Message("02", "개선사항을 저장하였습니다.");
		if (ds_resultList.rowposition > 0)
		{
			fn_resultLoad(ds_resultList.rowposition);
		}
		else
		{
			fn_search();
		}
	}
}

//=========================================================================================
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
//
//=========================================================================================

//=========================================================================================
// [ PART 6 ]
// component Event 정의 ( User Define function )
// --> component Event의 기요,기능,동작 등 상세내용은 MiPlatform 메뉴얼을 참조하시기 바랍니다.
//=========================================================================================
/******************************************************************************************
 * 함ㅡ수ㅡ명 : grd_resultList_oncelldblclick(obj:Grid, e:GridClickEventInfo)
 * 기ㅡㅡㅡ능 : 진단정보 선택시 개선조치사항 조회
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-03-25
 ******************************************************************************************/
function grd_resultList_oncelldblclick(obj:Grid, e:GridClickEventInfo)
{
	var strMsg = "변경된 내역이 있습니다. 저장하시겠습니까?";

	// 변경 데이터 체크
	if(gfn_dsIsUpdated(ds_focsDtlList) || gfn_dsIsUpdated(ds_chkDtlList) || gfn_dsIsUpdated(ds_resultMst))
	{
		if (g_Confirm("02",strMsg))
		{
			fn_save();
			return;
		}
	}
	
	// 의뢰정보 클릭 시 전자결재 상신 또는 상신상세 버튼 연동
    fn_gwUserButtonInit();

	fn_resultLoad(e.row);
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_resultLoad(nRow) 
 * 기ㅡㅡㅡ능 : 개선조치사항 조회
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-03-25
 ******************************************************************************************/
function fn_resultLoad(nRow) 
{
	// 조회 키값 세팅
	ds_cond.setColumn(0, "TABLE_TYPE", ds_resultList.getColumn(nRow, "TABLE_TYPE"));
	ds_cond.setColumn(0, "FORM_CD", ds_resultList.getColumn(nRow, "FORM_CD"));
	ds_cond.setColumn(0, "CHK_DD", ds_resultList.getColumn(nRow, "CHK_DD"));

	ds_resultDtlList.clearData();
	fsp_clear(this);
	fsp_addSearch(this,"fs/fsc:FSC00410E_S001");	// 진단 마스터
	fsp_addSearch(this,"fs/fsc:FSC00410E_S005");	// 진단 디테일
	fsp_callService(this,"","","ds_cond=ds_cond","ds_resultMst=ds_list ds_resultDtlList=ds_dtlList","","fn_callBackDblClick");
}

function fn_callBackDblClick(errCode, errMsg) 
{
	if( errCode != 0 ) {
		g_Message("EE", errMsg);
		return;
	}

	// 조회 양식을 중점항목, 진단항목으로 복사
	ds_focsDtlList.clearData();
	ds_resultDtlList.filter("FOCS_ARTICLE_YN=='Y'");
	CopyF(ds_focsDtlList, ds_resultDtlList);

	ds_chkDtlList.clearData();
	ds_resultDtlList.filter("");	//처음에는 중점항목이 아닌것만 조회하다가 변경된(김민수 책임 확인받음) - 박용대 2015.12.29
	CopyF(ds_chkDtlList, ds_resultDtlList);
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : grd_resultDtlList_oncellclick(obj:Grid, e:GridClickEventInfo)
 * 기ㅡㅡㅡ능 : 사진 아이콘 클릭시 사진등록 팝업
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-03-25
 ******************************************************************************************/
function grd_resultDtlList_oncellclick(obj:Grid, e:GridClickEventInfo)
{
	// 개선조치사항 사진 아이콘
	if (e.cell == 6 && ds_resultDtlList.getColumn(e.row, "IMGE_CNT") > 0)
	{
		var HL_CLASS_NM = ds_resultDtlList.getColumn(e.row, "HL_CLASS_NM");
		var HM_CLASS_NM = ds_resultDtlList.getColumn(e.row, "HM_CLASS_NM");
		var CLASS_NM = ds_resultDtlList.getColumn(e.row, "CLASS_NM");
		var CLASS_CD = ds_resultDtlList.getColumn(e.row, "CLASS_CD");
		var CHK_CONTENTS = ds_resultDtlList.getColumn(e.row, "CHK_CONTENTS");
		var sParam = {
			  HL_CLASS_NM:HL_CLASS_NM
			, HM_CLASS_NM:HM_CLASS_NM
			, CLASS_NM:CLASS_NM
			, CLASS_CD:CLASS_CD
			, CHK_CONTENTS:CHK_CONTENTS
			, CALL_TYPE:"IMPROV"
		};
		gfn_dialog("", "U_FSC::FSC00412P.xfdl", sParam);
	}	
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : grd_list_BKimg(val)
 * 기ㅡㅡㅡ능 : 사진 아이콘
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-03-25
 ******************************************************************************************/
function grd_list_BKimg(val)
{
	var camera = "'theme://images/new/grd_WF_Camerabtn.png'";
	var expand = "'theme://images/new/grd_WF_Expand.png'";
	
	switch(val)
	{
		case "camera1":
			return "transparent URL(" + camera + ") center middle";
			break;
		
		case "camera2":
			return "#e4e4e4ff URL(" + camera + ") center middle";
			break;
		
		case "selectcamera":
			return "#24a3a8ff URL(" + camera + ") center middle";
			break;
		
		case "popup1":
			return "transparent URL(" + expand + ") center middle";
			break;
		
		case "popup2":
			return "#e4e4e4ff URL(" + expand + ") center middle";
			break;
		
		case "selectpopup":
			return "#24a3a8ff URL(" + expand + ") center middle";
			break;

		default:
			return val;
			break;
	}
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : btn_uploadImprovImge_onclick(obj:Button,  e:ClickEventInfo)
 * 기ㅡㅡㅡ능 : 개선사진등록 버튼 클릭시 사진등록 팝업
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-03-25
 ******************************************************************************************/
function btn_uploadImprovImge_onclick(obj:Button,  e:ClickEventInfo)
{
	var HL_CLASS_NM = ds_resultDtlList.getColumn(ds_chkDtlList.rowposition, "HL_CLASS_NM");
	var HM_CLASS_NM = ds_resultDtlList.getColumn(ds_chkDtlList.rowposition, "HM_CLASS_NM");
	var CLASS_NM = ds_resultDtlList.getColumn(ds_chkDtlList.rowposition, "CLASS_NM");
	var CLASS_CD = ds_resultDtlList.getColumn(ds_chkDtlList.rowposition, "CLASS_CD");
	var CHK_CONTENTS = ds_resultDtlList.getColumn(ds_chkDtlList.rowposition, "CHK_CONTENTS");
	var sParam = {
		  HL_CLASS_NM:HL_CLASS_NM
		, HM_CLASS_NM:HM_CLASS_NM
		, CLASS_NM:CLASS_NM
		, CLASS_CD:CLASS_CD
		, CHK_CONTENTS:CHK_CONTENTS
		, CALL_TYPE:"IMPROV"
	};
	gfn_dialog("", "U_FSC::FSC00412P.xfdl", sParam);	
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : btn_upjangSearch_onclick(obj:Button,  e:ClickEventInfo)
 * 기ㅡㅡㅡ능 : 사업장 조회팝업
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-03-25
 ******************************************************************************************/
function btn_upjangSearch_onclick(obj:Button,  e:ClickEventInfo)
{
	fn_sql_common_setup(fn_MakeUpjangGroupSQL(), 
						strQuery_UpjangKeyField, 
						strQuery_UpjangValueField, 
						strQuery_UpjangKeyFieldNM, 
						strQuery_UpjangValueFieldNM, 
						"", 
						"",
						"",
						strQuery_UpjangCaption,
						"UPJANG;UPJANGNM");
		
	if( gds_sql_common.getColumn(0, "ret_code") != "" ) {
		ds_cond.setColumn(0, "UPJANG", gds_sql_common.getColumn(0, "ret_code"));
		ds_cond.setColumn(0, "UPJANGNM", gds_sql_common.getColumn(0, "ret_name"));
		edt_upjangNm.setFocus();
	}
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : edt_upjangNm_onkeydown(obj:Edit, e:KeyEventInfo)
 * 기ㅡㅡㅡ능 : 조회조건 업장코드/명 삭제
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-03-25
 ******************************************************************************************/
function edt_upjangNm_onkeydown(obj:Edit, e:KeyEventInfo)
{
	if (e.keycode == 13) btn_upjangSearch.click();
	if (e.keycode == 46) {
		ds_cond.setColumn(0, "UPJANGNM", "");
		ds_cond.setColumn(0, "UPJANG", "");
	}
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : ds_chkDtlList_onrowposchanged(obj:Dataset, e:DSRowPosChangeEventInfo)
 * 기ㅡㅡㅡ능 : 평가사진이 존재할 경우 개선사진 등록버튼 활성화
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-03-25
 ******************************************************************************************/
function ds_chkDtlList_onrowposchanged(obj:Dataset, e:DSRowPosChangeEventInfo)
{
	if(Number(ds_resultDtlList.getColumn(e.newrow, "IMGE_CNT")) > 0)
	{
		btn_uploadImprovImge.visible = true;
	}
	else
	{
		btn_uploadImprovImge.visible = false;
	}
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : btn_confirm_onclick(obj:Button,  e:ClickEventInfo)
 * 기ㅡㅡㅡ능 : 개선확정
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-03-23
 ******************************************************************************************/
function btn_confirm_onclick(obj:Button,  e:ClickEventInfo)
{
	if (gfn_isNull(ds_resultMst.getColumn(0, "TABLE_TYPE")))
	{
		g_Message("EE", "점검 정보를 선택해 주세요.");
		return;
	}

	if (ds_resultMst.getColumn(0, "IMPROV_CONFIRM_YN") == "Y")
	{
		g_Message("EE", "이미 개선확정된 점검정보 입니다.");
		return;
	}

	if (!g_Confirm("01", "확정 하시겠습니까?")) return;
		
	jsp_transaction(
		  this                                 // 해당 스크립트를 호출하는 Form 객체
		, "FSC00410E_T005"                     // 서비스 ID
		, "U_svc::fs/fsc/FSC00410E_T005.jsp"   // 서비스 URL
		, "ds_resultMst=ds_resultMst"          // 서버로 전송할 DataSet 객체 Str
		, ""                                   // 서버로부터 전송 받을 DataSet 객체 String
		, ""                                   // 서버로 전송할 기타 Argument 정보 String
		, "fn_callBackConfirm"                    // 서버에서 처리가 완료된 후 Callback 받을 Function 명
		, true                                 // 에러 발생 시 Callback 함수 호출 여부
		, false                                // 처리중입니다. 메시지 창 보여줄지 여부 설정하기
		, false                                // 동기식으로 설정할지 여부
	);		
}

function fn_callBackConfirm(errCode, errMsg)
{
	if( errCode != 0 ) {
		g_Message("EE", errMsg);
		return;
	} else {
		fn_search();
	}
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : grd_resultDtlList_oncelldblclick(obj:Grid, e:GridClickEventInfo)
 * 기ㅡㅡㅡ능 : 개선조치사항 더블클릭시 커서 이동처리 
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-03-23
 ******************************************************************************************/
function grd_resultDtlList_oncelldblclick(obj:Grid, e:GridClickEventInfo)
{
	cal_improvMrmtDd.setFocus();
}

/**
 * 전자결재 버튼정보를 초기화 한다.
 * @param
 * @return
 */
function fn_gwUserButtonInit()
{
    //그룹웨어 연동 버튼을 설정
    SCGw.setUserButton (this, fv_option, gfn_nvl(ds_resultList.getColumn(ds_resultList.rowposition, "SIGN_PROGRESS_STATUS2"), ""));
}

/**
 * 그룹웨어 개선결과 상신 버튼 클릭 시 상신 팝업을 호출한다.
 * @param obj Button
 * @param e ClickEventInfo
 * @return none
 */
function btn_gwDraft_onclick(obj:Button,  e:ClickEventInfo)
{
	if (gfn_isNull(ds_resultMst.getColumn(0, "IMPROV_CONFIRM_DD")))
	{
        gfn_alert("개선 확정 후 상신이 가능합니다.");	//
        return;
	}

    if ( ds_resultList.getColumn(ds_resultList.rowposition, "SIGN_PROGRESS_STATUS2") == "DRAFT" ) {
        gfn_alert("결재 상신중입니다.");	//
        return;
    }
    if ( ds_resultList.getColumn(ds_resultList.rowposition, "SIGN_PROGRESS_STATUS2") == "COMPLETE" ) {
        gfn_alert("결재 승인완료 상태 입니다.");	//
        return;
    }

	fn_gwDraftAction('6');	// 개선결과
}

/**
 * 그룹웨어 상신 버튼 클릭 시 상신 팝업을 호출한다.
 * @param obj Button
 * @param e ClickEventInfo
 * @return none
 */
function fn_gwDraftAction(draftGubun)
{
     //그룹웨어에 전달할 파라메터 생성
    var arrParams	= SCGw.newParams ();

    //(필수) 결재문서 서비스명 - 문서양식별로 설정된 서비스명 설정
    var gwServiceId = "HWRC_FC_FSC_PATL_IMPROV_REQ";
    
    var gwTitle = "[" + ds_cboChkClass.getColumn(ds_cboChkClass.findRowExpr("CODE=="+ds_resultMst.getColumn(0, "CHK_CLASS")), "CODE_NAME") + "] " + ds_resultMst.getColumn(0, "UPJANGNM") + " - CS진단 개선결과 상신";
    SCGw.setParams (arrParams, SCGw.GW_SERVICE_NAME, gwServiceId);

	//trace(gwTitle);

    //(필수) 본문 URL : (주의) .do로 호출해야 하며 GET 방식으로 파라미터를 전달 (id라는 key는 사용 불가)
    // draftGubun에 따라 양식을 변경 한다.
    var sBodyUrl = "/fs/cmn/gwDraftController/makeGwDraftContent.do?searchId=" + draftGubun
                                            + "&FORM_CD=" + ds_resultList.getColumn(ds_resultList.rowposition, "FORM_CD")
                                            + "&UPJANG=" + ds_resultList.getColumn(ds_resultList.rowposition, "UPJANG")
                                            + "&CHK_DD=" + ds_resultList.getColumn(ds_resultList.rowposition, "CHK_DD")
                                            + "&TABLE_TYPE=" + ds_resultList.getColumn(ds_resultList.rowposition, "TABLE_TYPE")
                                            //+ "&IMG_ROOT=" + fsp_getServerDir("FSC_RESULT_PHOTO", "") + "/"
                                            //모바일에서 그룹웨어 결제 어플에서 읽기 위해서 결제할때 외부 URL 사용
                                            + "&IMG_ROOT=" + "https://nfics.hanwhafoodist.co.kr//app/gpfs/app_repository/ifis/upload/fs/fsc/photo" + "/"
                                            ;
    SCGw.setParams (arrParams, SCGw.GW_BODY_URL, sBodyUrl);

    //(필수) 본문 제목 – 문서양식 별로 설정된 업무명
    SCGw.setParams (arrParams, SCGw.GW_BODY_TITLE, gwTitle);

    //(필수)문서 방향 : 가로 또는 세로 방향 (GW_VERTICAL, GW_HORIZONTAL)
    SCGw.setParams (arrParams, SCGw.GW_PORTRAIT, SCGw.GW_HORIZONTAL);
    
    //(선택)첨부문서 목록 : json 형태 문자열
	SCGw.setParams (arrParams, SCGw.GW_ATTACH_LIST, fv_attachList);

    //(선택)Client Id : 결재 instance id와 연관을 맺기위한 업무별 ID로 unique key를 이용, 생략하면 상신시각이 됨(최대 40 byte)
    //SCGw.setParams (arrParams, SCGw.GW_CLIENT_ID, edt_id.value);

    strDraftGubun = draftGubun;

    //그룹웨어 상신 팝업을 호출한다.
    SCGw.sendDraft (this, arrParams);
}

/**
 * 그룹웨어 점검결과 재상세 버튼 클릭 시 결재상세 팝업을 호출한다.
 * @param obj Button
 * @param e ClickEventInfo
 * @return none
 */
function btn_gwDetail_onclick(obj:Button,  e:ClickEventInfo)
{
    //그룹웨어 결재상세 팝업을 호출한다.
    SCGw.sendDetailView (this, ds_resultList.getColumn(ds_resultList.rowposition, "SIGN_INSTANCE_ID2"));
}

/**
 * 그룹웨어 상신 처리 후 반환되는 Instance Id를 처리한다. (업무 테이블에 update)
 * (중요) 이 함수는 SCGw에서 호출되므로 필히 선언되어야 한다.
 * @param instanceId
 * @return none
 */
function scgw_ondraftnotify(instanceId)
{
    //alert("instance id=[" + instanceId + "]"+" SCGw.GW_DRAFT_STATUS :"+SCGw.GW_DRAFT_STATUS);
    // 점검결과
    if (strDraftGubun == '5')
    {
        ds_resultList.setColumn(ds_resultList.rowposition, "SIGN_INSTANCE_ID1", instanceId);	 //결재InstanceId 설정
        ds_resultList.setColumn(ds_resultList.rowposition, "SIGN_PROGRESS_STATUS1", SCGw.GW_DRAFT_STATUS);	 //결재진행상태를 상신으로 설정
    }
    else	// 개선결과
    {
        ds_resultList.setColumn(ds_resultList.rowposition, "SIGN_INSTANCE_ID2", instanceId);	 //결재InstanceId 설정
        ds_resultList.setColumn(ds_resultList.rowposition, "SIGN_PROGRESS_STATUS2", SCGw.GW_DRAFT_STATUS);	 //결재진행상태를 상신으로 설정
    }

    ds_resultList.updatecontrol = false;
    ds_resultList.setRowType(ds_resultList.rowposition, Dataset.ROWTYPE_NORMAL);
    ds_resultList.updatecontrol = true;

    fn_gwResultDraft();	//결재정보 저장
}

/**
 * 전자결재 결과 정보를 업무테이블에 저장 한다.
 * @param
 * @return
 */
function fn_gwResultDraft()
{
	ds_cond.setColumn(0, "DRAFT_GUBUN", strDraftGubun);
	
	ds_cond.setColumn(0, "TABLE_TYPE", ds_resultList.getColumn(ds_resultList.rowposition, "TABLE_TYPE"));
	ds_cond.setColumn(0, "FORM_CD", ds_resultList.getColumn(ds_resultList.rowposition, "FORM_CD"));
	ds_cond.setColumn(0, "UPJANG", ds_resultList.getColumn(ds_resultList.rowposition, "UPJANG"));
	ds_cond.setColumn(0, "CHK_DD", ds_resultList.getColumn(ds_resultList.rowposition, "CHK_DD"));
	
    if (strDraftGubun == '5')	// 점검결과
    {
        ds_cond.setColumn(0, "SIGN_INSTANCE_ID1", ds_resultList.getColumn(ds_resultList.rowposition, "SIGN_INSTANCE_ID1"));
    }
    else	// 개선결과
    {
        ds_cond.setColumn(0, "SIGN_INSTANCE_ID2", ds_resultList.getColumn(ds_resultList.rowposition, "SIGN_INSTANCE_ID2"));
    }
    
    //trace(ds_cond.saveXML());

	// 뭔가 업무 처리할 경우 Transaction 발생
    jsp_transaction(
		  this                                 // 해당 스크립트를 호출하는 Form 객체
		, "FSC00420E_T001"                     // 서비스 ID
		, "U_svc::fs/fsc/FSC00420E_T001.jsp"   // 서비스 URL
		, "ds_cond=ds_cond:A"      			   // 서버로 전송할 DataSet 객체 Str
		, ""                                   // 서버로부터 전송 받을 DataSet 객체 String
		, ""                                   // 서버로 전송할 기타 Argument 정보 String
		, "fn_callBackDraft"                   // 서버에서 처리가 완료된 후 Callback 받을 Function 명
		, true                                 // 에러 발생 시 Callback 함수 호출 여부
		, false                                // 처리중입니다. 메시지 창 보여줄지 여부 설정하기
		, true                                 // 동기식으로 설정할지 여부
	);
}

/**
 * 전자결재 결과 정보를 업무테이블에 저장한 callback
 * @param
 * @return
 */
function fn_callBackDraft(errCode, errMsg) 
{
	if( errCode != 0 ) {
		g_Message("EE", errMsg);
		return;
	}
	else
	{
        // 의뢰정보 클릭 시 전자결재 상신 또는 상신상세 버튼 연동
        fn_gwUserButtonInit();
        
        g_Message("02", (strDraftGubun=='5'?"점검결과":"개선결과")+" 결재 상신 되었습니다!");
        
        strDraftGubun = '6';
        
        if (gfn_isNull(edt_upjangNm.getUpjangName())) {
			ds_cond.setColumn(0, "UPJANG", "");
        }
        
        ds_cond.setColumn(0, "DRAFT_GUBUN", "");
        ds_cond.setColumn(0, "SIGN_INSTANCE_ID1", "");
        ds_cond.setColumn(0, "SIGN_INSTANCE_ID2", "");
        
        // 재조회
        fn_search() ;
	}
}

function fn_print()
{
	if (ds_resultMst.rowcount <= 0)
	{
		g_Message("EE", "출력오류 : 출력 할 내역이 없습니다.");
		return;
	}
	
	if (gfn_dsIsUpdated(ds_resultMst)==true || gfn_dsIsUpdated(ds_resultMst)==true)
	{
		g_Message("EE", "변경된 내역이 있습니다.\n저장 후 출력 해 주십시오.");
		return;
	}
	
	var p1,p2,p3,p4,p5,p6;
	
	//레포트에 전달할 파라메터 생성
	var arrParams	= SCReport.newParams ();
	
	//--------------------------------------------------
	//방법1)서버에서 Query에 의해 처리하는 경우 예
	//(필수) 레포트명
	SCReport.setParams (arrParams, SCReport.RPT_NAME, "/IFIS/FSC00040E_R02.ozr");

	//출력 옵션 설정
	//-창 타이틀 (디폴트는 "ReportViewer")
	SCReport.setParams (arrParams, SCReport.RPT_TITLE, "점검결과보고서");
	
	//레포트에 맞게 전달되는 개발자 정의 파라미터
	SCReport.setParams (arrParams, "TABLE_TYPE", ds_resultMst.getColumn(0, "TABLE_TYPE"));
	SCReport.setParams (arrParams, "FORM_CD", ds_resultMst.getColumn(0, "FORM_CD"));
	SCReport.setParams (arrParams, "UPJANG", ds_resultMst.getColumn(0, "UPJANG"));
	SCReport.setParams (arrParams, "CHK_DD", ds_resultMst.getColumn(0, "CHK_DD"));
	SCReport.setParams (arrParams, "SERVER_URL", fsp_getServerDir("FSC_RESULT_PHOTO", "") + "/");
	//SCReport.setParams (arrParams, "PARAM7", g_OzAlias[g_OzFsus]);
	
	SCReport.setParams (arrParams, "zoom", 150);		
	//--------------------------------------------------
	SCReport.viewReport (this, arrParams, false);
}


/***************************************************************************
 * 설명   : 그리드에서 커서로 버튼 이동시 결재버튼 제어
 ***************************************************************************/
function ds_resultList_onrowposchanged(obj:Dataset, e:DSRowPosChangeEventInfo)
{
	// 의뢰정보 클릭 시 전자결재 상신 또는 상신상세 버튼 연동
    fn_gwUserButtonInit();
}]]></Script>
  </Form>
</FDL>
