<?xml version="1.0" encoding="euc-kr"?>
<query dynamic="true">
	<type>select</type>
	<description><![CDATA[]]></description>
	<reload>true</reload>
	<monitoring>true</monitoring>
	<result-count>1</result-count>
	<statement>

SELECT (SELECT WH_CNTR_NM FROM EPROCUSR.ESPSWHC WHERE WH_CNTR_CD = PODT.WH_CNTR_CD) AS CNTR_NM
	 , PODT.MU_CD
	 , MAX(SGP.SHOP_GRP_NM) AS GRP_NM
     , MGDT.ITEM_CD AS ITEM_CD
     , MTGL.ITEM_NM AS ITEM_NM
     , MTGL.SPEC AS SPEC
     --, TRUNC((PODT.BUY_PRICE * MGDT.GR_QTY) / (TRUNC(MGDT.GR_QTY * NVL(MTGL.PURC_UNIT_RATE,1), 5)), 5) AS GR_BUY_PRICE --구매단위로 변경
     , PODT.BUY_PRICE AS GR_BUY_PRICE
     , PODT.PURC_CATE_RATE AS CATE_INC_RATE
     --, TRUNC(TRUNC((PODT.BUY_PRICE * MGDT.GR_QTY) / (TRUNC(MGDT.GR_QTY * NVL(MTGL.PURC_UNIT_RATE,1), 5)), 5) * ( 1 + (NVL(PODT.PURC_CATE_RATE, 0) / 100 )), 5) AS CATE_PIRCE--구매단위로 변경
     , TRUNC(PODT.BUY_PRICE * ( (NVL(PODT.PURC_CATE_RATE, 0) / 100 )), 5) AS CATE_PIRCE
     , PODT.PURC_ADD_RATE AS ADD_INC_RATE
     --, TRUNC(TRUNC((PODT.BUY_PRICE * MGDT.GR_QTY) / (TRUNC(MGDT.GR_QTY * NVL(MTGL.PURC_UNIT_RATE,1), 5)), 5) * ( 1 + (NVL(PODT.PURC_ADD_RATE, 0) / 100 )), 5) AS ADD_PRICE --구매단위로 변경
     , TRUNC(PODT.BUY_PRICE * (  (NVL(PODT.PURC_ADD_RATE, 0) / 100 )), 5) AS ADD_PRICE
     --, TRUNC((PODT.MGT_PRICE * MGDT.GR_QTY) / (TRUNC(MGDT.GR_QTY * NVL(MTGL.PURC_UNIT_RATE,1), 5)), 5) AS MGT_PRICE--구매단위로 변경
     , PODT.MGT_PRICE AS MGT_PRICE
     , SUM(DECODE(MOD(MGDT.MOVEMENT_TYP, 2), 1, MGDT.GR_PURC_QTY, MGDT.GR_PURC_QTY * -1)) AS GR_QTY
     --, SUM(MGDT.GR_PURC_QTY) AS GR_QTY
     , ROUND(SUM(PODT.BUY_PRICE * DECODE(MOD(MGDT.MOVEMENT_TYP, 2), 1, MGDT.GR_PURC_QTY, MGDT.GR_PURC_QTY * -1)), 1) AS GR_BUY_AMT
     , ROUND(SUM(PODT.BUY_PRICE * ( (NVL(PODT.PURC_ADD_RATE, 0) / 100 )) * DECODE(MOD(MGDT.MOVEMENT_TYP, 2), 1, MGDT.GR_PURC_QTY, MGDT.GR_PURC_QTY * -1)), 1) AS ADD_INC_AMT
     , ROUND(SUM(PODT.BUY_PRICE * ( (NVL(PODT.PURC_CATE_RATE, 0) / 100 )) * DECODE(MOD(MGDT.MOVEMENT_TYP, 2), 1, MGDT.GR_PURC_QTY, MGDT.GR_PURC_QTY * -1)), 1) AS CATE_AMT
     -- 율에 대한 금액만 보여주라고 하니까 관리 단가로 보여주던걸 계산해 보여주게 변경
     --, SUM(ROUND(PODT.MGT_PRICE * MGDT.GR_PURC_QTY)) AS MGT_AMT
     , ROUND(SUM(PODT.BUY_PRICE * ( (NVL(PODT.PURC_CATE_RATE, 0) / 100 ) + (NVL(PODT.PURC_ADD_RATE, 0) / 100 ) ) * DECODE(MOD(MGDT.MOVEMENT_TYP, 2), 1, MGDT.GR_PURC_QTY, MGDT.GR_PURC_QTY * -1)), 1) AS MGT_AMT
     --윤지혜대리 요청 중분류,소분류,세분류 추가 2018.07.24
     , (SELECT CLASS_NAME FROM HLDC_PO_ITEM_CLASS_HLDC_V WHERE CLASS_CODE = HPIM.ITEM_CLASS2) AS CLASS2_NAME
     , (SELECT CLASS_NAME FROM HLDC_PO_ITEM_CLASS_HLDC_V WHERE CLASS_CODE = HPIM.ITEM_CLASS3) AS CLASS3_NAME
     , (SELECT CLASS_NAME FROM HLDC_PO_ITEM_CLASS_HLDC_V WHERE CLASS_CODE = HPIM.ITEM_CLASS4) AS CLASS4_NAME 
  FROM EPROCUSR.ESIMGDT MGDT
    INNER JOIN EPROCUSR.ESPPODT PODT
        ON PODT.SYS_ID = MGDT.SYS_ID
        AND PODT.COMP_CD = MGDT.COMP_CD
        AND PODT.PO_NO = MGDT.PO_NO
        AND PODT.PO_LNO = MGDT.PO_LNO
        AND PODT.WH_CD = MGDT.WH_CD
        AND PODT.SYS_ID = '100'
        AND PODT.COMP_CD = 'HFC'
    INNER JOIN EPROCUSR.ESPPOHD POHD    
        ON POHD.SYS_ID = PODT.SYS_ID
        AND POHD.COMP_CD= PODT.COMP_CD
        AND POHD.PO_NO = PODT.PO_NO
        AND POHD.SYS_ID = '100'
        AND POHD.COMP_CD = 'HFC'
    INNER JOIN EPROCUSR.ESPSSHPORG ORG
        ON ORG.SYS_ID = MGDT.SYS_ID
        AND ORG.COMP_CD = MGDT.COMP_CD
        AND ORG.SHOP_CD = PODT.SHOP_CD
        AND ORG.SYS_ID = '100'
        AND ORG.COMP_CD = 'HFC'
    INNER JOIN EPROCUSR.ESMMTGL MTGL
        ON MTGL.ITEM_CD = MGDT.ITEM_CD
        AND MTGL.SYS_ID = '100'
    INNER JOIN EPROCUSR.ESPSSGP SGP
        ON SGP.SYS_ID = MGDT.SYS_ID
        AND SGP.COMP_CD = MGDT.COMP_CD
        AND SGP.SHOP_GRP_CD = ORG.SHOP_GRP_CD
        AND SGP.SYS_ID = '100'
        AND SGP.COMP_CD = 'HFC'
    INNER JOIN HLDC_PO_ITEM_MST HPIM  --윤지혜대리 요청 중분류,소분류,세분류 추가 2018.07.24
    		ON MGDT.ITEM_CD = HPIM.ITEM_CODE
 WHERE MGDT.SYS_ID = '100'
   AND MGDT.COMP_CD = 'HFC'
   AND PODT.SHOP_TYP_CD = '01'
   AND PODT.BU_CD = '2000'
   AND SUBSTR(MGDT.ITEM_CD, 0, 1) = 'F'
   AND POHD.REQ_SYS_CD = 'FR'
   AND MGDT.MG_DATE BETWEEN #FR_DATE#  AND #TO_DATE#
   --AND MGDT.MOVEMENT_TYP NOT IN ('561','562','998','999','901','902','801','802','111','112','211','212', '701', '702') /* 기초 , 기말 재고,배송입출고,  직송 가상입출고  제외 */
   AND MGDT.STS &lt;&gt; 'D'
   AND MGDT.WH_CD NOT LIKE 'E%'
<isNotNull col = "MU_CD">   
   AND PODT.MU_CD = #MU_CD#
</isNotNull>
<isNotNull col = "ITEM_CD">
   AND MGDT.ITEM_CD = #ITEM_CD#    
</isNotNull>
<isNotNull col = "ITEM_NM">
   AND MTGL.ITEM_NM LIKE '%' || #ITEM_NM# || '%'    
</isNotNull>
<isNotNull col = "CNTR_CD">
   AND PODT.WH_CNTR_CD = #CNTR_CD#
</isNotNull>
 GROUP BY PODT.WH_CNTR_CD
        , PODT.MU_CD
        , MGDT.ITEM_CD
        , MTGL.ITEM_NM
        , MTGL.SPEC        
        --, TRUNC((PODT.BUY_PRICE * MGDT.GR_QTY) / (TRUNC(MGDT.GR_QTY * NVL(MTGL.PURC_UNIT_RATE,1), 5)), 5) --구매단위로 변경
        , PODT.BUY_PRICE 
        , PODT.PURC_CATE_RATE
        --, TRUNC(TRUNC((PODT.BUY_PRICE * MGDT.GR_QTY) / (TRUNC(MGDT.GR_QTY * NVL(MTGL.PURC_UNIT_RATE,1), 5)), 5) * ( 1 + (NVL(PODT.PURC_CATE_RATE, 0) / 100 )), 5) --구매단위로 변경
        , TRUNC(PODT.BUY_PRICE * ( (NVL(PODT.PURC_CATE_RATE, 0) / 100 )), 5)
        , PODT.PURC_ADD_RATE
        --, TRUNC(TRUNC((PODT.BUY_PRICE * MGDT.GR_QTY) / (TRUNC(MGDT.GR_QTY * NVL(MTGL.PURC_UNIT_RATE,1), 5)), 5) * ( 1 + (NVL(PODT.PURC_ADD_RATE, 0) / 100 )), 5) --구매단위로 변경
        , TRUNC(PODT.BUY_PRICE * ( (NVL(PODT.PURC_ADD_RATE, 0) / 100 )), 5)
        --, TRUNC((PODT.MGT_PRICE * MGDT.GR_QTY) / (TRUNC(MGDT.GR_QTY * NVL(MTGL.PURC_UNIT_RATE,1), 5)), 5)
        , PODT.MGT_PRICE
        , HPIM.ITEM_CLASS2
        , HPIM.ITEM_CLASS3
        , HPIM.ITEM_CLASS4
 

	</statement>
	<input default-name="ds_cond">
	</input>
	<output default-name="ds_list">   
	</output>
</query>