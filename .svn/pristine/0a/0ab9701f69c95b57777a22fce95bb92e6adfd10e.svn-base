<?xml version="1.0" encoding="euc-kr"?>
<query dynamic="true">
	<type>select</type>
	<description><![CDATA[업장별 사용현황조회 - 식단 상세내역]]></description>
	<reload>true</reload>
	<monitoring>true</monitoring>
	<result-count>1</result-count>
	<statement>
SELECT (SELECT SUBINV_NAME 
          FROM HLDC_PO_SUBINVENTORY 
         WHERE SUBINV_CODE = A.SUBINV_CODE) AS SUBINV_NAME
     , A.MENU_DATE
     , E.HALL_NAME
     , B.RECIPE_CD
     , B.RECIPE_NAME
     , DECODE(A.MEAL, NULL, A.MENU_FEATURE, 
       (SELECT CODE_NAME FROM SCC_COMMON_CODE X WHERE X.GROUP_CODE = 'FS0023' AND X.CODE = A.MEAL) || 
       (SELECT CODE_NAME FROM SCC_COMMON_CODE X WHERE X.GROUP_CODE = 'FS0022' AND X.CODE = A.CORNER) || 
       (SELECT DECODE(X.CORNER_DESC,NULL,'','('||X.CORNER_DESC||')') FROM FSA_HALL_DTL X WHERE X.UPJANG = A.UPJANG AND X.HALL_CD = A.HALL_CD AND X.MEAL = A.MEAL AND X.CORNER = A.CORNER)) MENU_DESC
     , SUM(C.NEED_QTY) NEED_QTY
     , DECODE(E.CAFE_YN,'Y',B.EXPECT_SALE_QTY,DECODE(E.CATER_YN,'Y',B.EXPECT_SALE_QTY,A.EXPECT_MEAL_QTY)) EXPECT_MEAL_QTY
     , ROUND(SUM(C.NEED_QTY * DECODE(E.CAFE_YN,'Y',B.EXPECT_SALE_QTY,DECODE(E.CATER_YN,'Y',B.EXPECT_SALE_QTY,A.EXPECT_MEAL_QTY)) / F.KG_CONVERT_RATE / 1000),2) TOT_NEED_QTY
     , F.PO_UOM 
  FROM FSM_REAL_MENU_MST A 
     , FSM_REAL_RECIPE_MST B 
     , FSM_REAL_RECIPE_ITEM C 
     , FSA_HALL_MST E 
     , HLDC_PO_ITEM_MST F 
 WHERE A.UPJANG = B.UPJANG 
   AND A.MENU_CD = B.MENU_CD 
   AND B.UPJANG = C.UPJANG 
   AND B.MENU_CD = C.MENU_CD 
   AND B.RECIPE_CD = C.RECIPE_CD 
   AND A.UPJANG = E.UPJANG 
   AND A.HALL_CD = E.HALL_CD 
   AND C.ITEM_CODE = F.ITEM_CODE 
   AND A.UPJANG = #UPJANG# 
   AND C.NEED_DATE BETWEEN #START_DATE# AND #END_DATE# 
   AND C.ITEM_CODE = #ITEM_CODE#
 GROUP BY A.UPJANG,A.HALL_CD,A.SUBINV_CODE, A.MENU_DATE, E.HALL_NAME, B.RECIPE_CD, B.RECIPE_NAME, A.MEAL, A.CORNER 
         ,A.EXPECT_MEAL_QTY, B.EXPECT_SALE_QTY, F.KG_CONVERT_RATE, F.PO_UOM, E.CATER_YN, E.CAFE_YN,A.MENU_FEATURE 
 ORDER BY A.SUBINV_CODE, A.MENU_DATE, E.HALL_NAME, A.MEAL, A.CORNER, B.RECIPE_CD 
    </statement>
	<input default-name="ds_cond">
	</input>
	<output default-name="ds_list22">
	</output>
</query>