<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="..\..\..\default_typedef.xml"/>
  <Form id="ThemeItemReg" classname="COMP_GUIDE_13" inheritanceid="" position="absolute 0 0 1252 725" titletext="테마자재등록" scrollbars="autoboth" onload="form_onload">
    <Layouts>
      <Layout>
        <Static id="Static06" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1237 0 1252 710" anchor="top right"/>
        <Div id="div_cmnBtn" anchor="left top right" taborder="1" url="cmn::CmnBtn.xfdl" text="Div00" scrollbars="none" position="absolute 0 0 1237 30" tabstop="false"/>
        <Static id="Static30" text="w10" class="Guide01_AreaRed" visible="false" position="absolute 406 26 416 710"/>
        <Div id="div_001" taborder="2" text="Div00" position="absolute 0 30 416 725" anchor="left top bottom">
          <Layouts>
            <Layout>
              <Grid id="grd_listStd" taborder="3" binddataset="ds_listStd" scrollbars="autoboth" autoenter="select" useinputpanel="false" cellsizingtype="col" autofittype="col" oncelldblclick="grd_listStd_oncelldblclick" position="absolute 0 78 406 679" anchor="all">
                <Formats>
                  <Format id="default">
                    <Columns>
                      <Column size="36"/>
                      <Column size="100"/>
                      <Column size="183"/>
                      <Column size="86"/>
                    </Columns>
                    <Rows>
                      <Row size="41" band="head"/>
                      <Row size="24"/>
                    </Rows>
                    <Band id="head">
                      <Cell class="head_Excel"/>
                      <Cell col="1" text="센터"/>
                      <Cell col="2" text="CC"/>
                      <Cell col="3" text="테마자재별" wordwrap="word"/>
                    </Band>
                    <Band id="body">
                      <Cell text="bind:NO" expr="currow+1"/>
                      <Cell col="1" displaytype="text" text="bind:centerName"/>
                      <Cell col="2" displaytype="text" text="bind:ccNm"/>
                      <Cell col="3" displaytype="number" text="bind:itemCnt"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
              <Button id="btn_select" taborder="2" text="조회" onclick="fn_searchStd" class="btn_WF_Function" position="absolute 357 52 402 72" anchor="top right"/>
              <Static id="Static12" text="w02" class="Guide01_AreaRed" visible="false" position="absolute 356 82 358 102" anchor="top right"/>
              <Static id="Static36" text="센터별CC목록" class="sta_WF_Title01" position="absolute 0 60 275 78" anchor="left top"/>
              <Static id="Static08" class="sta_WFSA_Labelbg" position="absolute 0 0 406 38" anchor="left top right"/>
              <Static id="Static18" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 0 34 456 47" anchor="left top"/>
              <Static id="Static00" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 88 12 98 33" anchor="left top"/>
              <Static id="Static01" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 1 93 11" anchor="left top"/>
              <Static id="Static02" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 11 15 32" anchor="left top"/>
              <Static id="Static06" text="센터" class="sta_WFSA_label" position="absolute 15 11 95 32" anchor="left top"/>
              <Static id="Static11" text="일자" class="sta_WFSA_label" position="absolute 14 598 94 619" anchor="left top" visible="false"/>
              <Static id="Static16" text="w15" class="Guide01_AreaRed" visible="false" position="absolute -1 598 14 619" anchor="left top"/>
              <Static id="Static19" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 87 599 97 620" anchor="left top"/>
              <Static id="Static51" text="W05." visible="false" position="absolute 0 32 538 37" style="background:#ff000055;align:center middle;" anchor="default"/>
              <ObjCalMonth id="cal_month" titletext="월력" taborder="0" scrollbars="none" position="absolute 96 598 176 619" anchor="default" visible="false"/>
              <Static id="Static04" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 176 596 186 626" anchor="left top"/>
              <Combo id="cbo_gubun" taborder="1" codecolumn="codecolumn" datacolumn="datacolumn" class="cmb_WF_Essential" position="absolute 186 598 285 619" anchor="left top" onitemchanged="div_001_cbo_gubun_onitemchanged" visible="false">
                <Dataset id="innerdataset">
                  <ColumnInfo>
                    <Column id="codecolumn" size="256"/>
                    <Column id="datacolumn" size="256"/>
                  </ColumnInfo>
                  <Rows>
                    <Row>
                      <Col id="codecolumn">01</Col>
                      <Col id="datacolumn">상반기</Col>
                    </Row>
                    <Row>
                      <Col id="codecolumn">16</Col>
                      <Col id="datacolumn">하반기</Col>
                    </Row>
                  </Rows>
                </Dataset>
              </Combo>
              <Static id="Static09" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 285 592 295 622" anchor="left top"/>
              <ObjCalendar id="cal_date" titletext="캘린더" taborder="4" text="20150101" scrollbars="none" enable="false" position="absolute 295 598 391 619" anchor="default" visible="false"/>
              <Static id="Static03" text="W05." visible="false" position="absolute 0 619 400 629" style="background:#ff000055;align:center middle;" anchor="default"/>
              <Grid id="Grid00" taborder="5" useinputpanel="false" position="absolute 42 331 374 398" binddataset="ds_search" visible="false">
                <Formats>
                  <Format id="default">
                    <Columns>
                      <Col size="80"/>
                      <Col size="80"/>
                      <Col size="80"/>
                      <Col size="80"/>
                    </Columns>
                    <Rows>
                      <Row band="head" size="24"/>
                      <Row band="body" size="24"/>
                    </Rows>
                    <Band id="head">
                      <Cell col="0" disptype="normal" text="schCenter"/>
                      <Cell col="1" disptype="normal" text="schMonth"/>
                      <Cell col="2" disptype="normal" text="schGubun"/>
                      <Cell col="3" disptype="normal" text="schDate"/>
                    </Band>
                    <Band id="body">
                      <Cell col="0" disptype="normal" text="bind:schCenter"/>
                      <Cell col="1" disptype="normal" text="bind:schMonth"/>
                      <Cell col="2" disptype="normal" text="bind:schGubun"/>
                      <Cell col="3" disptype="normal" text="bind:schDate"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
              <Grid id="Grid01" taborder="6" useinputpanel="false" position="absolute 42 436 383 508" binddataset="ds_searchRow" visible="false">
                <Formats>
                  <Format id="default">
                    <Columns>
                      <Col size="80"/>
                      <Col size="80"/>
                      <Col size="80"/>
                      <Col size="80"/>
                    </Columns>
                    <Rows>
                      <Row band="head" size="24"/>
                      <Row band="body" size="24"/>
                    </Rows>
                    <Band id="head">
                      <Cell col="0" disptype="normal" text="selCenter"/>
                      <Cell col="1" disptype="normal" text="selCcCd"/>
                      <Cell col="2" disptype="normal" text="selDate"/>
                      <Cell col="3" disptype="normal" text="schClassType"/>
                    </Band>
                    <Band id="body">
                      <Cell col="0" disptype="normal" text="bind:selCenter"/>
                      <Cell col="1" disptype="normal" text="bind:selCcCd"/>
                      <Cell col="2" disptype="normal" text="bind:selDate"/>
                      <Cell col="3" disptype="normal" text="bind:schClassType"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
            </Layout>
          </Layouts>
        </Div>
        <Static id="Static16" text="h06" class="Guide01_AreaRed" visible="false" position="absolute 0 102 400 108" anchor="top right"/>
        <Static id="Static71" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 710 1252 725" anchor="left bottom"/>
        <Splitter id="Splitter" position="absolute 408 31 415 709" anchor="left top bottom">
          <Formats>
            <Format id="default">
              <SplitterItems id="items">
                <SplitterItem id="item00" position="leftortop" bindtype="resize" offset="0" componentid="div_001"/>
                <SplitterItem id="item01" position="rightorbottom" bindtype="resize" offset="5" componentid="div_002"/>
              </SplitterItems>
            </Format>
          </Formats>
        </Splitter>
        <Div id="div_002" taborder="3" text="Div00" position="absolute 425 31 1244 712" anchor="top right bottom">
          <Layouts>
            <Layout>
              <Static id="Static17" class="sta_WFSA_Labelbg" position="absolute 0 0 819 41" anchor="left top right"/>
              <Static id="Static20" text="h06" class="Guide01_AreaRed" visible="false" position="absolute 1 70 297 76" anchor="top right"/>
              <Static id="Static21" text="h06" class="Guide01_AreaRed" visible="false" position="absolute 523 41 819 47" anchor="top right"/>
              <Static id="Static29" text="h06" class="Guide01_AreaRed" visible="false" position="absolute 560 379 856 385" anchor="top right"/>
              <Static id="Static38" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 11 15 32" anchor="left top"/>
              <Static id="Static39" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 1 93 11" anchor="left top"/>
              <Static id="Static40" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 31 93 41" anchor="left top"/>
              <Static id="Static41" text="선택CC" class="sta_WFSA_label" position="absolute 278 10 340 31" anchor="left top"/>
              <Static id="Static42" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 342 11 352 32" anchor="left top"/>
              <Edit id="edt_selCcNm" taborder="0" tabstop="false" readonly="true" position="absolute 352 10 612 31" anchor="left top"/>
              <Edit id="edt_selCcCd" taborder="1" tabstop="false" readonly="true" position="absolute 615 10 684 31" anchor="left top" style="align:center middle;"/>
              <Static id="Static00" text="선택센터" class="sta_WFSA_label" position="absolute 17 10 79 31" anchor="left top"/>
              <Edit id="edt_selCenterName" taborder="3" tabstop="false" readonly="true" position="absolute 92 10 190 31" anchor="left top" style="align:left middle;"/>
              <Static id="Static01" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 82 10 92 31" anchor="left top"/>
              <Edit id="edt_selCenterCode" taborder="4" tabstop="false" readonly="true" position="absolute 193 10 262 31" anchor="left top" style="align:center middle;"/>
              <Tab id="tabMain" anchor="all" taborder="5" canchange="tabMain_canchange" tabindex="0" scrollbars="autoboth" position="absolute 0 52 817 680">
                <Tabpages>
                  <Tabpage id="tabP2" text="추천정보" scrollbars="none">
                    <Layouts>
                      <Layout>
                        <Grid id="grd_listItem" taborder="21" binddataset="ds_listItem" autoenter="select" useinputpanel="false" selecttype="multirow" cellsizingtype="col" autofittype="col" position="absolute 0 35 814 599" anchor="all" onexpanddown="grd_listItem_onexpanddown">
                          <Formats>
                            <Format id="default">
                              <Columns>
                                <Column size="32"/>
                                <Column size="83"/>
                                <Column size="189"/>
                                <Column size="169"/>
                                <Column size="62"/>
                                <Column size="78"/>
                                <Column size="92"/>
                                <Column size="107"/>
                              </Columns>
                              <Rows>
                                <Row size="26" band="head"/>
                                <Row size="24"/>
                              </Rows>
                              <Band id="head">
                                <Cell class="head_Excel"/>
                                <Cell col="1" text="자재코드"/>
                                <Cell col="2" text="자재명"/>
                                <Cell col="3" text="규격"/>
                                <Cell col="4" text="구매단위"/>
                                <Cell col="5" text="매입단가"/>
                                <Cell col="6" text="추천판매율"/>
                                <Cell col="7" text="추천단가"/>
                              </Band>
                              <Band id="body">
                                <Cell text="bind:NO" expr="currow+1"/>
                                <Cell col="1" displaytype="text" style="align:center middle;" text="bind:itemCode"/>
                                <Cell col="2" displaytype="text" edittype="expand" style="align:left middle;" text="bind:itemName" expandshow="hide"/>
                                <Cell col="3" displaytype="text" edittype="none" style="align:left middle;" text="bind:itemSize"/>
                                <Cell col="4" displaytype="text" style="align:center middle;" text="bind:itemUnit"/>
                                <Cell col="5" displaytype="number" edittype="masknumber" style="color:blue;color2:blue;" text="bind:contractPrice" mask="#,##0.#"/>
                                <Cell col="6" displaytype="number" edittype="masknumber" style="color:blue;color2:blue;" text="bind:strategyRate" mask="#,##0.#" editautoselect="true"/>
                                <Cell col="7" displaytype="number" edittype="masknumber" style="color:blue;color2:blue;" text="bind:strategyPrice" mask="#,##0.0" editautoselect="true"/>
                              </Band>
                            </Format>
                          </Formats>
                        </Grid>
                        <Button id="btn_template" taborder="22" text="엑셀템플릿" onclick="btn_template_onclick" class="btn_WF_Function" position="absolute 544 7 621 27" anchor="top right"/>
                        <Button id="btn_itemSave" taborder="23" text="자재별 저장" onclick="btn_itemSave_onclick" class="btn_WF_Function" position="absolute 690 7 765 27" anchor="top right"/>
                        <Button id="btn_clsUpload2" taborder="24" text="불러오기" onclick="btn_clsUpload2_onclick" class="btn_WF_Function" position="absolute 623 7 688 27" anchor="top right"/>
                        <Static id="Static36" text="테마자재별 판매율/단가 설정" class="sta_WF_Title01" position="absolute 0 14 275 32" anchor="left top"/>
                        <Static id="Static16" text="h06" class="Guide01_AreaRed" visible="false" position="absolute 0 29 400 35" anchor="top right"/>
                        <Button id="btn_itemSelect" taborder="25" text="조회" onclick="fn_searchItem" class="btn_WF_Function" position="absolute 452 7 497 27" anchor="top right"/>
                        <ProgressBar id="pbr_status" taborder="26" text="이익율 생성작업" max="100" min="0" position="absolute 587 556 794 580" anchor="top right" visible="false"/>
                        <Button id="btn_errorView" taborder="27" text="오류메시지확인" onclick="btn_errorView_onclick" class="btn_WF_Function" visible="false" position="absolute 179 7 280 27" anchor="left top"/>
                        <Grid id="Grid00" taborder="28" binddataset="ds_save" useinputpanel="false" visible="false" position="absolute 302 97 699 255" anchor="default">
                          <Formats>
                            <Format id="default">
                              <Columns>
                                <Col size="80"/>
                                <Col size="80"/>
                                <Col size="80"/>
                                <Col size="80"/>
                                <Col size="80"/>
                                <Col size="80"/>
                                <Col size="80"/>
                                <Col size="80"/>
                                <Col size="80"/>
                                <Col size="80"/>
                                <Col size="80"/>
                                <Col size="80"/>
                                <Col size="80"/>
                                <Col size="80"/>
                              </Columns>
                              <Rows>
                                <Row band="head" size="24"/>
                                <Row band="body" size="24"/>
                              </Rows>
                              <Band id="head">
                                <Cell col="0" disptype="normal" text="rowNum"/>
                                <Cell col="1" disptype="normal" text="itemCode"/>
                                <Cell col="2" disptype="normal" text="itemName"/>
                                <Cell col="3" disptype="normal" text="itemSize"/>
                                <Cell col="4" disptype="normal" text="itemUnit"/>
                                <Cell col="5" disptype="normal" text="contractPrice"/>
                                <Cell col="6" disptype="normal" text="strategyRate"/>
                                <Cell col="7" disptype="normal" text="strategyPrice"/>
                                <Cell col="8" disptype="normal" text="planningRate"/>
                                <Cell col="9" disptype="normal" text="planningPrice"/>
                                <Cell col="10" disptype="normal" text="centerCode"/>
                                <Cell col="11" disptype="normal" text="ccCd"/>
                                <Cell col="12" disptype="normal" text="profitDate"/>
                                <Cell col="13" disptype="normal" text="classType"/>
                              </Band>
                              <Band id="body">
                                <Cell col="0" disptype="normal" text="bind:rowNum"/>
                                <Cell col="1" disptype="normal" text="bind:itemCode"/>
                                <Cell col="2" disptype="normal" text="bind:itemName"/>
                                <Cell col="3" disptype="normal" text="bind:itemSize"/>
                                <Cell col="4" disptype="normal" text="bind:itemUnit"/>
                                <Cell col="5" disptype="normal" text="bind:contractPrice"/>
                                <Cell col="6" disptype="normal" text="bind:strategyRate"/>
                                <Cell col="7" disptype="normal" text="bind:strategyPrice"/>
                                <Cell col="8" disptype="normal" text="bind:planningRate"/>
                                <Cell col="9" disptype="normal" text="bind:planningPrice"/>
                                <Cell col="10" disptype="normal" text="bind:centerCode"/>
                                <Cell col="11" disptype="normal" text="bind:ccCd"/>
                                <Cell col="12" disptype="normal" text="bind:profitDate"/>
                                <Cell col="13" disptype="normal" text="bind:classType"/>
                              </Band>
                            </Format>
                          </Formats>
                        </Grid>
                        <Grid id="Grid01" taborder="29" binddataset="ds_saveRow" useinputpanel="false" visible="false" position="absolute 298 289 704 403" anchor="default">
                          <Formats>
                            <Format id="default">
                              <Columns>
                                <Col size="80"/>
                                <Col size="80"/>
                                <Col size="80"/>
                                <Col size="80"/>
                                <Col size="80"/>
                                <Col size="80"/>
                                <Col size="80"/>
                                <Col size="80"/>
                                <Col size="80"/>
                                <Col size="80"/>
                                <Col size="80"/>
                                <Col size="80"/>
                                <Col size="80"/>
                                <Col size="80"/>
                                <Col size="80"/>
                              </Columns>
                              <Rows>
                                <Row band="head" size="24"/>
                                <Row band="body" size="24"/>
                              </Rows>
                              <Band id="head">
                                <Cell col="0" disptype="normal" text="rowNum"/>
                                <Cell col="1" disptype="normal" text="itemCode"/>
                                <Cell col="2" disptype="normal" text="itemName"/>
                                <Cell col="3" disptype="normal" text="itemSize"/>
                                <Cell col="4" disptype="normal" text="itemUnit"/>
                                <Cell col="5" disptype="normal" text="contractPrice"/>
                                <Cell col="6" disptype="normal" text="strategyRate"/>
                                <Cell col="7" disptype="normal" text="strategyPrice"/>
                                <Cell col="8" disptype="normal" text="planningRate"/>
                                <Cell col="9" disptype="normal" text="planningPrice"/>
                                <Cell col="10" disptype="normal" text="centerCode"/>
                                <Cell col="11" disptype="normal" text="ccCd"/>
                                <Cell col="12" disptype="normal" text="profitDate"/>
                                <Cell col="13" disptype="normal" text="classType"/>
                                <Cell col="14" disptype="normal" text="saveFlag"/>
                              </Band>
                              <Band id="body">
                                <Cell col="0" disptype="normal" text="bind:rowNum"/>
                                <Cell col="1" disptype="normal" text="bind:itemCode"/>
                                <Cell col="2" disptype="normal" text="bind:itemName"/>
                                <Cell col="3" disptype="normal" text="bind:itemSize"/>
                                <Cell col="4" disptype="normal" text="bind:itemUnit"/>
                                <Cell col="5" disptype="normal" text="bind:contractPrice"/>
                                <Cell col="6" disptype="normal" text="bind:strategyRate"/>
                                <Cell col="7" disptype="normal" text="bind:strategyPrice"/>
                                <Cell col="8" disptype="normal" text="bind:planningRate"/>
                                <Cell col="9" disptype="normal" text="bind:planningPrice"/>
                                <Cell col="10" disptype="normal" text="bind:centerCode"/>
                                <Cell col="11" disptype="normal" text="bind:ccCd"/>
                                <Cell col="12" disptype="normal" text="bind:profitDate"/>
                                <Cell col="13" disptype="normal" text="bind:classType"/>
                                <Cell col="14" disptype="normal" text="bind:saveFlag"/>
                              </Band>
                            </Format>
                          </Formats>
                        </Grid>
                        <Button id="btn_itemDel" taborder="30" text="삭제" onclick="div_002_tabMain_tabP2_btn_itemDel_onclick" class="btn_WF_Function" position="absolute 767 7 812 27" anchor="top right"/>
                        <Button id="btn_insert" taborder="31" text="추가" onclick="fn_insert" class="btn_WF_Function" position="absolute 498 7 543 27" anchor="top right"/>
                      </Layout>
                    </Layouts>
                  </Tabpage>
                </Tabpages>
              </Tab>
            </Layout>
          </Layouts>
        </Div>
        <Div id="div_margin" taborder="4" style="background:#f0f5ffff;border:1 solid #808080ff ;" visible="false" position="absolute 1376 133 1601 370" scrollbars="none">
          <Layouts>
            <Layout>
              <Static id="Static11" text="w10" visible="false" position="absolute 0 118 10 139" style="background:#f97878ff;" anchor="default"/>
              <Static id="Static09" text="w10" visible="false" position="absolute 214 27 224 167" style="background:#f97878ff;" anchor="default"/>
              <Static id="Static24" text=" ◎ 분류별 전략율적용" class="sta_WF_CalWeek" position="absolute 0 0 224 28" anchor="top right" style="background:khaki;border:1 solid silver ;color:black;align:left middle;"/>
              <Grid id="grd_class" taborder="1" binddataset="ds_class" scrollbars="autovert" autoenter="select" useinputpanel="false" cellsizingtype="col" position="absolute 10 33 214 230" anchor="left top bottom" autofittype="col">
                <Formats>
                  <Format id="default">
                    <Columns>
                      <Column size="124"/>
                      <Column size="53"/>
                      <Column size="50"/>
                    </Columns>
                    <Rows>
                      <Row size="26" band="head"/>
                      <Row size="24"/>
                    </Rows>
                    <Band id="head">
                      <Cell text="분류"/>
                      <Cell col="1" class="grd_WF_Essential" text="전략율"/>
                      <Cell col="2" text="기획율"/>
                    </Band>
                    <Band id="body">
                      <Cell displaytype="text" text="bind:className"/>
                      <Cell col="1" displaytype="number" edittype="masknumber" text="bind:strategyRate" mask="#,##0.0" editautoselect="true"/>
                      <Cell col="2" displaytype="number" edittype="masknumber" style="align:right middle;" text="bind:planningRate" mask="#,##0.0" editautoselect="true"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
              <Button id="btn_clsRate2" taborder="2" text="적용" class="btn_WF_Function" position="absolute 167 4 212 24" anchor="top right" onclick="div_margin_btn_clsRate2_onclick"/>
            </Layout>
          </Layouts>
        </Div>
        <Combo id="cbo_centerCode" taborder="0" innerdataset="ds_center" codecolumn="centerCode" datacolumn="centerName" onitemchanged="fn_listClear" class="cmb_WF_Essential" position="absolute 97 41 229 62" anchor="left top"/>
        <Grid id="grd_excel" taborder="5" binddataset="ds_excel" autoenter="select" useinputpanel="false" cellsizingtype="col" autofittype="col" visible="false" position="absolute 1381 402 2349 515" anchor="all">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="32"/>
                <Column size="83"/>
                <Column size="147"/>
                <Column size="228"/>
                <Column size="77"/>
                <Column size="81"/>
                <Column size="72"/>
                <Column size="99"/>
              </Columns>
              <Rows>
                <Row size="26" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell class="head_Excel"/>
                <Cell col="1" text="자재코드"/>
                <Cell col="2" text="자재명"/>
                <Cell col="3" text="규격"/>
                <Cell col="4" text="구매단위"/>
                <Cell col="5" text="매입단가"/>
                <Cell col="6" text="추천판매율"/>
                <Cell col="7" text="추천단가"/>
              </Band>
              <Band id="body">
                <Cell text="bind:NO" expr="currow+1"/>
                <Cell col="1" displaytype="text" style="align:center middle;" text="bind:itemCode"/>
                <Cell col="2" displaytype="text" style="align:left middle;" text="bind:itemName"/>
                <Cell col="3" displaytype="text" edittype="none" style="align:left middle;" text="bind:itemSize"/>
                <Cell col="4" displaytype="text" style="align:center middle;" text="bind:itemUnit"/>
                <Cell col="5" edittype="masknumber" text="bind:contractPrice" mask="#,##0.#"/>
                <Cell col="6" displaytype="number" edittype="masknumber" style="color:blue;color2:blue;" text="bind:strategyRate" mask="#,##0.#" editautoselect="true"/>
                <Cell col="7" displaytype="number" edittype="masknumber" style="color:blue;color2:blue;" text="bind:strategyPrice" mask="#,##0.0" editautoselect="true"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
      </Layout>
    </Layouts>
    <Bind>
      <BindItem id="item1" compid="cbo_centerCode" propid="value" datasetid="ds_search" columnid="schCenter"/>
      <BindItem id="item2" compid="div_001.cbo_gubun" propid="value" datasetid="ds_search" columnid="schGubun"/>
      <BindItem id="item5" compid="div_001.cal_date" propid="text" datasetid="ds_search" columnid="schDate"/>
    </Bind>
    <Objects>
      <Dataset id="ds_listClass" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" oncolumnchanged="ds_listClass_oncolumnchanged">
        <ColumnInfo>
          <Column id="rowNum" type="STRING" size="256"/>
          <Column id="clsCd4" type="STRING" size="256"/>
          <Column id="clsNm1" type="STRING" size="256"/>
          <Column id="clsNm2" type="STRING" size="256"/>
          <Column id="clsNm3" type="STRING" size="256"/>
          <Column id="clsNm4" type="STRING" size="256"/>
          <Column id="strategyRate" type="STRING" size="256"/>
          <Column id="planningRate" type="STRING" size="256"/>
          <Column id="centerCode" type="STRING" size="256"/>
          <Column id="ccCd" type="STRING" size="256"/>
          <Column id="profitDate" type="STRING" size="256"/>
          <Column id="classType" type="STRING" size="256"/>
          <Column id="clsCd1" type="STRING" size="256"/>
          <Column id="clsCd2" type="STRING" size="256"/>
          <Column id="clsCd3" type="STRING" size="256"/>
          <Column id="useYn" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_listItem" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" oncolumnchanged="ds_listItem_oncolumnchanged">
        <ColumnInfo>
          <Column id="rowNum" type="STRING" size="256"/>
          <Column id="itemCode" type="STRING" size="256"/>
          <Column id="itemName" type="STRING" size="256"/>
          <Column id="itemSize" type="STRING" size="256"/>
          <Column id="itemUnit" type="STRING" size="256"/>
          <Column id="contractPrice" type="STRING" size="256"/>
          <Column id="strategyRate" type="STRING" size="256"/>
          <Column id="strategyPrice" type="STRING" size="256"/>
          <Column id="planningRate" type="STRING" size="256"/>
          <Column id="planningPrice" type="STRING" size="256"/>
          <Column id="centerCode" type="STRING" size="256"/>
          <Column id="ccCd" type="STRING" size="256"/>
          <Column id="profitDate" type="STRING" size="256"/>
          <Column id="classType" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_search" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" oncolumnchanged="ds_search_oncolumnchanged">
        <ColumnInfo>
          <Column id="schCenter" type="STRING" size="256"/>
          <Column id="schMonth" type="STRING" size="256"/>
          <Column id="schGubun" type="STRING" size="256"/>
          <Column id="schDate" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_searchRow" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="selCenter" type="STRING" size="256"/>
          <Column id="selCcCd" type="STRING" size="256"/>
          <Column id="selDate" type="STRING" size="256"/>
          <Column id="schClassType" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_listStd" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="centerCode" type="STRING" size="256"/>
          <Column id="centerName" type="STRING" size="256"/>
          <Column id="ccCd" type="STRING" size="256"/>
          <Column id="ccNm" type="STRING" size="256"/>
          <Column id="schDate" type="STRING" size="256"/>
          <Column id="classCnt" type="STRING" size="256"/>
          <Column id="itemCnt" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_deleteItem" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="false" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="centerCode" type="STRING" size="256"/>
          <Column id="ccCd" type="STRING" size="256"/>
          <Column id="profitDate" type="STRING" size="256"/>
          <Column id="itemCode" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_listClassValid" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="clsCd4" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="clsCd4">title:소분류,required:true</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_listItemValid" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="itemCode" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="itemCode">title:자재코드,required:true</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_listCopy" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="stdUpjang" type="STRING" size="256"/>
          <Column id="stdUpjangNm" type="STRING" size="256"/>
          <Column id="stdCnt" type="STRING" size="256"/>
          <Column id="stdChk" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_class" preload="true" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep">
        <ColumnInfo>
          <Column id="classCode" type="STRING" size="256"/>
          <Column id="className" type="STRING" size="256"/>
          <Column id="strategyRate" type="STRING" size="256"/>
          <Column id="planningRate" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_center" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="centerCode" type="STRING" size="256"/>
          <Column id="centerName" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_searchValid" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="schCenter" type="STRING" size="256"/>
          <Column id="schMonth" type="STRING" size="256"/>
          <Column id="schGubun" type="STRING" size="256"/>
          <Column id="schDate" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="schCenter">title:센터,required:true,focus:cbo_centerCode</Col>
            <Col id="schMonth">title:일자,required:true,focus:cal_month</Col>
            <Col id="schGubun">title:조회구분,required:true,focus:cbo_gubun</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_searchRowValid" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="selCenter" type="STRING" size="256"/>
          <Column id="selCcCd" type="STRING" size="256"/>
          <Column id="selDate" type="STRING" size="256"/>
          <Column id="schClassType" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="selCenter">title:센터,required:true</Col>
            <Col id="selCcCd">title:CC,required:true</Col>
            <Col id="selDate">title:일자,required:true</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_excel" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="rowNum" type="STRING" size="256"/>
          <Column id="itemCode" type="STRING" size="256"/>
          <Column id="itemName" type="STRING" size="256"/>
          <Column id="itemSize" type="STRING" size="256"/>
          <Column id="itemUnit" type="STRING" size="256"/>
          <Column id="contractPrice" type="STRING" size="256"/>
          <Column id="strategyRate" type="STRING" size="256"/>
          <Column id="strategyPrice" type="STRING" size="256"/>
          <Column id="planningRate" type="STRING" size="256"/>
          <Column id="planningPrice" type="STRING" size="256"/>
          <Column id="schCenter" type="STRING" size="256"/>
          <Column id="schDate" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="rowNum">1</Col>
            <Col id="itemCode">F100001</Col>
            <Col id="itemName">경기미 </Col>
            <Col id="itemSize">면)[20kg/포] </Col>
            <Col id="itemUnit">포</Col>
            <Col id="contractPrice">756.8</Col>
            <Col id="strategyPrice"/>
            <Col id="planningPrice"/>
            <Col id="strategyRate">8</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_save" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="rowNum" type="STRING" size="256"/>
          <Column id="itemCode" type="STRING" size="256"/>
          <Column id="itemName" type="STRING" size="256"/>
          <Column id="itemSize" type="STRING" size="256"/>
          <Column id="itemUnit" type="STRING" size="256"/>
          <Column id="contractPrice" type="STRING" size="256"/>
          <Column id="strategyRate" type="STRING" size="256"/>
          <Column id="strategyPrice" type="STRING" size="256"/>
          <Column id="planningRate" type="STRING" size="256"/>
          <Column id="planningPrice" type="STRING" size="256"/>
          <Column id="centerCode" type="STRING" size="256"/>
          <Column id="ccCd" type="STRING" size="256"/>
          <Column id="profitDate" type="STRING" size="256"/>
          <Column id="classType" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_saveRow" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="rowNum" type="STRING" size="256"/>
          <Column id="itemCode" type="STRING" size="256"/>
          <Column id="itemName" type="STRING" size="256"/>
          <Column id="itemSize" type="STRING" size="256"/>
          <Column id="itemUnit" type="STRING" size="256"/>
          <Column id="contractPrice" type="STRING" size="256"/>
          <Column id="strategyRate" type="STRING" size="256"/>
          <Column id="strategyPrice" type="STRING" size="256"/>
          <Column id="planningRate" type="STRING" size="256"/>
          <Column id="planningPrice" type="STRING" size="256"/>
          <Column id="centerCode" type="STRING" size="256"/>
          <Column id="ccCd" type="STRING" size="256"/>
          <Column id="profitDate" type="STRING" size="256"/>
          <Column id="classType" type="STRING" size="256"/>
          <Column id="saveFlag" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Script type="xscript4.0"><![CDATA[/*
  화 면 명 : ThemeItemReg
  파 일 명 : ThemeItemReg.xfdl
  기    능 : 식재영업 / 기준관리 / 단가관리 / 테마자재등록

    수정일    수정자                  수정내용 
  ----------   -------  --------------------------------------------------
  2019.08.06   김중한   현업요청으로 인해 테마자재등록 신규개발
  
  1) 추가 반영해야될 사항
  
  2) 화면 상단 공통 버튼 
*/

/************************************************************************************************
 * 공통 라이브러리 INCLUDE 영역 (필수)
************************************************************************************************/
include "lib::lib_com.xjs";


/************************************************************************************************
 * FORM 변수 선언 영역 (필수)
************************************************************************************************/
var fv_processCnt = 0;			//처리건수
var fv_objColInfo;				//데이터셋 컬럼정보
var fv_objColInfo1;				//데이터셋 컬럼정보
var fv_sToday = gfn_today();
var fv_grdFormat = "";			//그리드포맷

var fv_excelFlag = false;		//엑셀업로드 저장 여부 CHECK
var fv_excelFlag2 = false;		//엑셀업로드 저장 여부 CHECK
var fv_excelFlag3 = false;		//엑셀업로드 저장 여부 CHECK

var fv_centerCode = "";			//선택 센터코드
var fv_ccCd = "";				//선택 CC코드

// 저장관련 변수
var fv_saveFlag = "";			//신규저장 시 CallBack 처리 구분
var fv_saveRowCnt;				//저장대상 Row Count
var fv_saveRow;					//저장대상 Row Index
var fv_errorFlag;				//에러발생 여부(Y/N)
var fv_errorMsg;				//에러발생 메시지
var fv_row;

// 추가
var fv_startRow;
var fv_endRow;

/************************************************************************************************
 * FORM EVENT 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : Form Load (필수)
 *---------------------------------------------------------------------------------------------*/
function form_onload(obj:Form, e:LoadEventInfo)
{	
	// Form Load 시 공통 기능 처리(obj:Form, bCreateEvent:이벤트 생성 여부)
	gfn_formOnLoad(this);
	
	// 초기값 셋팅
	fn_init();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 초기값 셋팅
 *---------------------------------------------------------------------------------------------*/
function fn_init()
{
	var sDate;
	
	// 업데이트여부를 체크할 DataSet, 여러개 있을 경우 ;로 구분
	v_ds_check = "ds_listClass;ds_listItem";
	
	//조회조건을 초기화한다.
	var nRow= ds_search.addRow();
	ds_search.setColumn(nRow, "schCenter", "");							// 센터코드
	
	//sDate = gfn_today();
	sDate = "20190701"; //20190701 이후 조회일자 고정
	
	if (sDate.substr(6, 2) > "15") ds_search.setColumn(nRow, "schGubun", "16");	// 구분(하반기 기본 SET)
	else ds_search.setColumn(nRow, "schGubun", "01");						// 구분(상반기 기본 SET)
	

	// 월력 초기화(해당Form, 값지정, 값변경시 실행할 callBack함수, dataset과 bind)
	//div_001.cal_month.fn_initMonthCal(this, gfn_getYear()+gfn_getMonth(), "", ds_search, "schMonth", "Y");
	div_001.cal_month.fn_initMonthCal(this, sDate.substr(0, 6), "", ds_search, "schMonth", "Y"); //20190701 이후 조회일자 고정

	// 조회일자 SET
	div_001.cal_date.fn_initMonthCal(this, "", "", ds_search, "schDate", "");
	

	// 조회기준일자 SET
	fn_calcDate();

	// 센터정보 COMBO 초기화 : 조건
	fn_searchCenter();

	var nRow= ds_searchRow.addRow();
	ds_searchRow.setColumn(nRow, "selCenter", "");						// 선택센터
	ds_searchRow.setColumn(nRow, "selCcCd", "");						// 선택CC
	
	// 자재 분류정보 GET
	fn_searchClassType();
}
/*----------------------------------------------------------------------------------------------
 * 설명      : 화면 닫기 전 변경 유무 체크 (필수-Frame에서 창 닫힐때 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_close()
{	
//	// v_ds_check 미사용시 변경사항 체크(입력 프로그램일때 변경되는 Dataset 전체 기술)
// 	if (gfn_dsIsUpdated(ds_list) == true) 
// 	{
// 		// 변경된 데이터가 있습니다. 현재 화면을 닫겠습니까?
//         if (!gfn_confirm("confirm.before.movepage")) return false;
//     }
//     
//	// 조회프로그램에도 Return true; 기술해 주세요!
// 	return true;

	// v_ds_check 사용시 변경사항 체크
	if(gfn_length(v_ds_check) == 0) 
	{	
		// v_ds_check 설정기준 변경사항 체크
		if (gfn_isDataChange() == true) 
		{		
			// 변경된 데이터가 있습니다. 현재 화면을 닫겠습니까?
			if (!gfn_confirm("confirm.before.movepage")) return false;
		}
	}
    
	// 조회프로그램에도 Return true; 기술해 주세요!
	return true;
}


/************************************************************************************************
 * 공통기능 FUNCTION 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 조회 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_search()
{
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 신규 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_insert()
{	
	var nRowCnt1 = ds_searchRow.getRowCount();	// 조건 DataSet Count
	// 선택한 센터별CC 자료여부 CHECK
	if(nRowCnt1 == 0) 
	{
		gfn_alert("msg.noselect", "CC목록");	// CC목록을 선택해 주십시요.
		return;
	}
	
	var nRowIdx = ds_listItem.addRow();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 삭제 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_delete()
{
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 저장 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_save()
{
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 출력 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_print()
{
	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 도움말 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_help()
{
	
}

/************************************************************************************************
 * TRANSACTION 및 CallBack 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 트랜잭션 콜백 함수 (필수)
 *---------------------------------------------------------------------------------------------*/
function fn_callBack(strSvcID, nErrorCode, strErrorMsg)
{
	// 에러시 gfn_callBack에서 메시지 제공, 화면별 특정 에러 발생시에만 사용하세요.
	if (nErrorCode < 0) 
	{
		if(strSvcID=="saveItem")
		{
			fv_errorFlag="Y";
			fv_errorMsg = strErrorMsg;
			fn_processStep();
			return;
		}
		else 
		{
			return;
		}
	}
	
    switch(strSvcID)
    {
            
		// 센터 조회
        case "searchCenter" :
            //trace(ds_center.saveXML());
            fn_center_init();
            break;
            
            
		// 센터별 CC 조회
        case "searchStd" :
			// 관련 정보 초기화
			fn_stdInit();	
            if (ds_listStd.getRowCount() == 0) {
				//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
				gfn_loadDatasetInfo (ds_listStd, fv_objColInfo);
				// 관련정보 초기화
				fv_centerCode = "";			//선택 센터코드
				fv_ccCd = "";				//선택 CC코드
            }
            fn_searchStdSet();
            break;
        
		// 분류별목록  조회
        case "searchClass" :
            //trace(ds_listClass.saveXML());
            if (ds_listClass.getRowCount() == 0) {
				//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
				gfn_loadDatasetInfo (ds_listClass, fv_objColInfo);
            }
			fv_excelFlag2 = false;			
            break;

            // 분류별목록  조회
        case "searchClassType" :
            //trace(ds_listClass.saveXML());
            //var nRow = ds_class.insertRow(0);
            //ds_class.setColumn(nRow,"className" , "전체");
            //ds_class.setColumn(nRow,"classCode" , "");
            //div_002.cbo_class.index = 0;
            break;

        // 저장 : 세분류
        case "saveClass" :
			//trace("처리건수 : " + fv_processCnt);
			gfn_alert("msg.save.success");	// 저장 되었습니다.
			fn_searchStd();
			fn_searchClass();				// 저장 후 재조회
            break;    

        // 삭제 : 세분류
        case "deleteClass" :
			//trace("처리건수 : " + fv_processCnt);
			gfn_alert("msg.delete.success");// 삭제 되었습니다.
			fn_searchStd();
			fn_searchClass();				// 삭제 후 재조회
            break;    


		// 자재별목록  조회
        case "searchItem" :
            //trace(ds_listItem.saveXML());
            if (ds_listItem.getRowCount() == 0) {
				//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
				gfn_loadDatasetInfo (ds_listItem, fv_objColInfo1);
            }
			fv_excelFlag3 = false;			
            break;

        // 저장 : N Transaction
        case "saveItem" :
			if (fv_processCnt > 0) {
				fv_errorFlag="";
				fv_errorMsg="";
			}
			//gfn_alert("msg.save.success");	// 저장 되었습니다.
			fn_processStep();
            break;    

        // 저장 : 1 Transaction
        case "saveItem2" :
			if (fv_processCnt > 0) {
				gfn_alert("msg.save.success");	// 저장 되었습니다.
				// 재조회
				fn_searchStd();
				// 자재별 조회
				fn_searchItem();
			}
            break;    
            
            
        // 삭제 : 자재별
        case "deleteItem" :
			//trace("처리건수 : " + fv_processCnt);
			if (fv_processCnt > 0) {
				gfn_alert("msg.delete.success");// 삭제 되었습니다.
				// 재조회
				fn_searchStd();
				// 자재별 조회
				fn_searchItem();
			}
            break;    
    }
}


/************************************************************************************************
 * 사용자 FUNCTION 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 센터정보 조회
 *---------------------------------------------------------------------------------------------*/
function fn_searchCenter()
{
    var strSvcID    = "searchCenter";
    var strURL      = "fm/fms/upriceContractUpjangSet/selectCenter.xdo";
    var strInDs     = "";
    var strOutDs    = "ds_center=ds_center";
    var strArg      = "";		
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 센터 COMBO 초기화 
 *---------------------------------------------------------------------------------------------*/
function fn_center_init()
{
	var defVal = "";
	//ds_center.filter("centerCode != '*'");
	// COMBO 에 첫번째 Row에 기본값을 SET
	if (ds_center.getRowCount() > 1) {
		defVal = ds_center.getColumn(0, "centerCode");
	}
	//trace("centerCode : " + defVal);
	cbo_centerCode.value = defVal;
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 센터별 CC목록 초기화 
 *---------------------------------------------------------------------------------------------*/
function fn_stdInit()
{
	ds_searchRow.clearData();

	// 선택한 정보 표시
	div_002.edt_selCcNm.value = "";
	div_002.edt_selCcCd.value = "";
	div_002.edt_selCenterName.value = "";
	div_002.edt_selCenterCode.value = "";
	
	// 분류율 초기화 : 전체
	//--//div_002.tabMain.tabP1.msk_clsRate.value = 0;
	//div_002.tabMain.tabP1.msk_clsRate1.value = 0;
	
	// 세분류 정보 초기화
	ds_listClass.clearData();
	
	// 자재별 정보 초기화
	ds_listItem.clearData();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 저장 후 센터별CC 대한 Focus 이동
 *---------------------------------------------------------------------------------------------*/
function fn_searchStdSet()
{
	var nRow;
	if (fv_centerCode !="" && fv_ccCd != "")
	{
		nRow = ds_listStd.findRowExpr("centerCode=='"+fv_centerCode+"' && ccCd=='"+fv_ccCd+"'");
		ds_listStd.rowposition = nRow;
		
		fn_listClassRowClick(nRow);
	} else {
		// KEY Clear
		fv_centerCode = "";
		fv_ccCd = "";
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 분류정보 조회
 *---------------------------------------------------------------------------------------------*/
function fn_searchClassType()
{
    var strSvcID    = "searchClassType";
    var strURL      = "fm/fms/strategyProfit/selectClassType.xdo";
    var strInDs     = "";
    var strOutDs    = "ds_class=ds_class";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 센터별 CC목록 조회
 *---------------------------------------------------------------------------------------------*/
function fn_searchStd()
{
	var nRow= ds_search.rowposition;
	ds_search.setColumn(nRow, "schDate", ds_search.getColumn(nRow, "schMonth")+ds_search.getColumn(nRow, "schGubun"));	// 기준일자	

	// 조회시 Validation Check
	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;

    // Grid sort 표시 초기화(필수)
    gfn_clearSortMark(div_001.grd_listStd);

   	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
	fv_objColInfo = gfn_getDatasetInfo (ds_listStd);
    
    var strSvcID    = "searchStd";
    var strURL      = "fm/fms/ThemeItemProfit/selectStd.xdo";
    var strInDs     = "ds_search=ds_search:A";
    var strOutDs    = "ds_listStd=ds_listStd";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 분류별목록
 * 조회 시 분류별 목록 Ds Clear
 *---------------------------------------------------------------------------------------------*/
function fn_searchClass()
{
    // Grid sort 표시 초기화(필수)
    gfn_clearSortMark(div_002.tabMain.tabP1.grd_listClass);

   	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
	fv_objColInfo = gfn_getDatasetInfo (ds_listClass);

    var strSvcID    = "searchClass";
    var strURL      = "fm/fms/strategyProfit/selectClass.xdo";
    var strInDs     = "ds_searchRow=ds_searchRow:A";
    var strOutDs    = "ds_listClass=ds_listClass";
    var strArg      = "";
    var strCallback = "fn_callBack";
    //var bAsync      = true;
    var bAsync      = false;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 자재별목록 조회
 * 조회 시 자재별 목록 Ds SET
 *---------------------------------------------------------------------------------------------*/
function fn_searchItem()
{
	var nRow= ds_search.rowposition;
	var nRowCnt1 = ds_searchRow.getRowCount();	// 조건 DataSet Count
	
	ds_search.setColumn(nRow, "schDate", ds_search.getColumn(nRow, "schMonth")+ds_search.getColumn(nRow, "schGubun"));	// 기준일자	

	// 조회시 Validation Check : 원 조회조건
	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;
	
	// 선택한 센터별CC 자료여부 CHECK
	if(nRowCnt1 == 0) 
	{
		gfn_alert("msg.noselect", "CC목록");	// CC목록을 선택해 주십시요.
		return;
	}
	// 조회시 Validation Check : ROW 조회조건
	if (gfn_validCheck(ds_searchRow, ds_searchRowValid, true) == false) return;
	
    // Grid sort 표시 초기화(필수)
    gfn_clearSortMark(div_002.tabMain.tabP2.grd_listItem);

   	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
	fv_objColInfo1 = gfn_getDatasetInfo (ds_listItem);

    var strSvcID    = "searchItem";
    var strURL      = "fm/fms/ThemeItemProfit/selectItem.xdo";
    var strInDs     = "ds_searchRow=ds_searchRow:A";
    var strOutDs    = "ds_listItem=ds_listItem";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 분류별 목록의 분류율 정보 저장 
 * 저장 시 변경된 Dataset 이 아닌 전체를 기준으로 저장함
 *---------------------------------------------------------------------------------------------*/
function fn_saveClass()
{
	var nRowCnt = ds_listClass.getRowCount();	// DataSet Count
	var nRowCnt1 = ds_searchRow.getRowCount();	// 조건 DataSet Count
	
	// 저장할 자료 여부 CHECK 
	if(nRowCnt == 0) 
	{
		gfn_alert("msg.save.nodata", "저장할 데이터");	// 저장할 데이터가 없습니다.
		return;
	}

	// 선택한 센터별CC 자료여부 CHECK
	if(nRowCnt1 == 0) 
	{
		gfn_alert("msg.noselect", "CC목록");	// CC목록을 선택해 주십시요.
		return;
	}


	if (fv_excelFlag2 == false) {
		// 변경내역 여부 CHECK : 엑셀 업로드 시에는 변경내역 CHECK X
		if (gfn_dsIsUpdated(ds_listClass) == false) 
		{
			gfn_alert("msg.save.nochange");	// 변경된 내역이 없습니다.
			return;
		}
	}


	// 저장시 Validation Check : 소분류코드
	if (gfn_validCheck(ds_listClass, ds_listClassValid, true) == false) return;


	// 저장시 중복 CHECK
	if (!fn_saveClassChk())
	{
		return;
	}	

	var iCnt = 0;
	
	// 판매율 0인 자료 CEHCK
	for (var i = 0 ; i < nRowCnt ; i++)
	{
		if ((ds_listClass.getColumn(i, "strategyRate") <> "0"))
		{
			iCnt++;
		}
	}

	// 저장할 자료 여부 CHECK : 0인 자료만 존재 시 오류메시지 표시
	if(iCnt == 0) 
	{
		gfn_alert("msg.save.nodata", "저장할 데이터");	// 저장할 데이터가 없습니다.
		return;
	}

	var sMsg = "이익율 설정에 대한 추천판매율/추천단가를 저장합니다.\n계속 진행 하시겠습니까?";
	if (!gfn_confirm(sMsg, "", "C")) return;

	// 저장 시 조건(KEY)을 ds_listClass의 KEY 값으로 복사
	var nRow= ds_searchRow.rowposition;
	//trace(ds_searchRow.getColumn(nRow, "selStdUpjang"));

	for (var i = 0 ; i < nRowCnt ; i++)
	{
		ds_listClass.setColumn(i, "centerCode", ds_searchRow.getColumn(nRow, "selCenter"));
		ds_listClass.setColumn(i, "ccCd", ds_searchRow.getColumn(nRow, "selCcCd"));
		ds_listClass.setColumn(i, "profitDate", ds_searchRow.getColumn(nRow, "selDate"));
		ds_listClass.setColumn(i, "classType", "D");
	}
	
    var strSvcID    = "saveClass";
    var strURL      = "fm/fms/strategyProfit/saveClass.xdo";
	var strInDs     = "ds_listClass=ds_listClass:A";
    var strOutDs    = "";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);

}

/*----------------------------------------------------------------------------------------------
 * 설명      : 분류별 목록 저장 시 중복 CHECK
 * 엑셀 업로드 후 저장 시 중복코드 발생 할 수 있음 
 *---------------------------------------------------------------------------------------------*/
function fn_saveClassChk()
{
	var nRowCnt = ds_listClass.getRowCount();	// DataSet Count
	var v_itemCode = "";

	for (var i = 0 ; i < nRowCnt ; i++)
	{
		v_itemCode = ds_listClass.getColumn(i, "clsCd4");
		for (var j = 0 ; j < nRowCnt ; j++) {
			if (v_itemCode==ds_listClass.getColumn(j, "clsCd4")) {
				if (i!=j) {
					sMsg = "중복된 소분류코드가 존재합니다.\r\r";
					sMsg = sMsg + "- 소분류코드 : " + ds_listClass.getColumn(j, "clsCd4");
					gfn_alert(sMsg, "", "A");
					ds_listClass.selectRow(i);	// MultiRow 일 경우 rowposition 사용 X
					return false;
				}
			}
		}
		
	}
	return true;
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 자재별 목록의 자재율 정보 저장
 * 저장 시 변경된 Dataset 만 저장
 * 1 Transaction 처리 (2015-12-14)
 *---------------------------------------------------------------------------------------------*/
function fn_saveItem()
{
	var nRowCnt = ds_listItem.getRowCount();	// DataSet Count
	var nRowCnt1 = ds_searchRow.getRowCount();	// 조건 DataSet Count
	var iCnt = 0;
	
	// 저장할 자료 여부 CHECK 
	if(nRowCnt == 0) 
	{
		gfn_alert("msg.save.nodata", "저장할 데이터");	// 저장할 데이터가 없습니다.
		return;
	}

	// 선택한 센터별CC 자료여부 CHECK
	if(nRowCnt1 == 0) 
	{
		gfn_alert("msg.noselect", "CC목록");	// CC목록을 선택해 주십시요.
		return;
	}
	
	// 변경내역 여부 CHECK : 엑셀업로드 후 저장 시에는 CHECK X
	if (fv_excelFlag3 == false) {
		if (gfn_dsIsUpdated(ds_listItem) == false) 
		{
			gfn_alert("msg.save.nochange");	// 변경된 내역이 없습니다.
			return;
		}
	}
	
	// 저장시 Validation Check : 자재코드
	if (gfn_validCheck(ds_listItem, ds_listItemValid, true) == false) return;


	// 에러메시지 버튼 숨기기
	//fn_errorView(false);


	var sMsg = "이익율 설정에 대한 추천판매율/추천단가를 저장합니다.\n계속 진행 하시겠습니까?";
	if (!gfn_confirm(sMsg, "", "C")) return;


	var nRowCnt = ds_listItem.getRowCount();	// DataSet Count
	var iCnt = 0;
	var iRow = 0;

  	// 저장 시 Progress Bar 표시 창 
 	//fn_processInit("1");

	// 저장할 Dataset Clear
	
	ds_save.enableevent = false;
	ds_save.clearData();

	//////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	// 저장 대상 개수 
	for (var i = 0 ; i < nRowCnt ; i++)
	{
		// 신규일경우 - 전체, 그외 변경분만 처리
		if (!fv_excelFlag3) {
			// 신규 및 수정건에 대해서만 처리
			if (ds_listItem.getRowType(i) == Dataset.ROWTYPE_INSERT || ds_listItem.getRowType(i) == Dataset.ROWTYPE_UPDATE) {
				iCnt++;
				// 대상을 ds_save로 복사
				ds_save.addRow();
				iRow = ds_save.rowposition;
				ds_save.copyRow(iRow, ds_listItem, i);
			}
		} else {
			iCnt++;
			// 전체를 ds_save로 복사
			ds_save.addRow();
			iRow = ds_save.rowposition;
			ds_save.copyRow(iRow, ds_listItem, i);
		}
	}
	
	var nRow = ds_searchRow.rowposition;
 	// 저장 시 조건(KEY)을 ds_list의 KEY 값으로 복사
 	for (var i = 0 ; i < iCnt ; i++)
 	{
		if (gfn_transNullToEmpty(ds_save.getColumn(i, "itemCode"))=="") ds_save.setColumn(i, "itemCode", "");				// 자재코드
		ds_save.setColumn(i, "centerCode", ds_searchRow.getColumn(nRow, "selCenter"));										// 센터코드
		ds_save.setColumn(i, "ccCd", ds_searchRow.getColumn(nRow, "selCcCd"));												// CC코드
		ds_save.setColumn(i, "profitDate", ds_searchRow.getColumn(nRow, "selDate"));										// 기준일자
		ds_save.setColumn(i, "classType", "M");
 	}
	
	ds_save.enableevent = true;
	
	// 저장 Transaction
 	var strSvcID    = "saveItem2";
    var strURL      = "fm/fms/ThemeItemProfit/saveItem2.xdo";
	var strInDs     = "ds_save=ds_save:A";
    var strOutDs    = "";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = false;
 	
 	gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}



/*----------------------------------------------------------------------------------------------
 * 설명      : 자재별 목록의 자재율 정보 저장
 * 저장 시 변경된 Dataset 이 아닌 전체를 기준으로 저장함
 * N Transaction
 *---------------------------------------------------------------------------------------------*/
function fn_saveItem_old()
{
	var nRowCnt = ds_listItem.getRowCount();	// DataSet Count
	var nRowCnt1 = ds_searchRow.getRowCount();	// 조건 DataSet Count
	
	// 저장할 자료 여부 CHECK 
	if(nRowCnt == 0) 
	{
		gfn_alert("msg.save.nodata", "저장할 데이터");	// 저장할 데이터가 없습니다.
		return;
	}

	// 선택한 센터별CC 자료여부 CHECK
	if(nRowCnt1 == 0) 
	{
		gfn_alert("msg.noselect", "CC목록");	// CC목록을 선택해 주십시요.
		return;
	}
	
	// 변경내역 여부 CHECK : 엑셀업로드 후 저장 시에는 CHECK X
	if (fv_excelFlag3 == false) {
		if (gfn_dsIsUpdated(ds_listItem) == false) 
		{
			gfn_alert("msg.save.nochange");	// 변경된 내역이 없습니다.
			return;
		}
	}
	
	// 저장시 Validation Check : 자재코드
	if (gfn_validCheck(ds_listItem, ds_listItemValid, true) == false) return;


	// 에러메시지 버튼 숨기기
	fn_errorView(false);


	var sMsg = "이익율 설정에 대한 추천판매율/추천단가를 저장합니다.\n계속 진행 하시겠습니까?";
	if (!gfn_confirm(sMsg, "", "C")) return;

	// 저장 프로세스 시작
	fn_processSet();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : Progress Bar - 저장 용
 *---------------------------------------------------------------------------------------------*/
function fn_processSet()
{
	var nRowCnt = ds_listItem.getRowCount();	// DataSet Count
	var iCnt = 0;
	var iRow = 0;

  	// 저장 시 Progress Bar 표시 창 
 	fn_processInit("1");

	// 저장할 Dataset Clear
	ds_save.clearData();

	// 저장 대상 개수 
	for (var i = 0 ; i < nRowCnt ; i++)
	{
		// 신규일경우 - 전체, 그외 변경분만 처리
		if (!fv_excelFlag3) {
			// 신규 및 수정건에 대해서만 처리
			if (ds_listItem.getRowType(i) == Dataset.ROWTYPE_INSERT || ds_listItem.getRowType(i) == Dataset.ROWTYPE_UPDATE) {
				iCnt++;
				// 대상을 ds_save로 복사
				ds_save.addRow();
				iRow = ds_save.rowposition;
				ds_save.copyRow(iRow, ds_listItem, i);
			}
		} else {
			iCnt++;
			// 전체를 ds_save로 복사
			ds_save.addRow();
			iRow = ds_save.rowposition;
			ds_save.copyRow(iRow, ds_listItem, i);
		}
	}
	
	var nRow = ds_searchRow.rowposition;
 	// 저장 시 조건(KEY)을 ds_list의 KEY 값으로 복사
 	for (var i = 0 ; i < iCnt ; i++)
 	{
		if (gfn_transNullToEmpty(ds_save.getColumn(i, "itemCode"))=="") ds_save.setColumn(i, "itemCode", "");				// 자재코드
		ds_save.setColumn(i, "centerCode", ds_searchRow.getColumn(nRow, "selCenter"));										// 센터코드
		ds_save.setColumn(i, "ccCd", ds_searchRow.getColumn(nRow, "selCcCd"));												// CC코드
		ds_save.setColumn(i, "profitDate", ds_searchRow.getColumn(nRow, "selDate"));										// 기준일자
		ds_save.setColumn(i, "classType", "M");
 	}
	

	// 저장 대상 ROW
	fv_saveRowCnt = iCnt;

	trace("iCnt : " + iCnt);

	//trace("fv_saveRowCnt : " + fv_saveRowCnt);

	if(fv_saveRowCnt>0)
	{
		// progress bar 초기 set
		div_002.tabMain.tabP2.pbr_status.max = fv_saveRowCnt;
		div_002.tabMain.tabP2.pbr_status.step = 1;
	
		// 최초 process 실행 호출
		fv_saveRow = 0;
		fn_process(fv_saveRow);
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 저장 로직 처리, 1 Row 씩 처리
 * arg : 처리 Index(row id)
 *---------------------------------------------------------------------------------------------*/
function fn_process(arg)
{

	// 최초 실행 시 첫번째 Row
	if (arg=="") arg = 0;
	
	// 추가
	fv_startRow = (arg * 200);
	fv_endRow = ((arg + 1) * 200) - 1;
	
	if (fv_endRow >= fv_saveRowCnt) fv_endRow = fv_saveRowCnt - 1;
	
	
	trace("fv_startRow : " + fv_startRow);
	trace("fv_endRow : " + fv_endRow);

	// 선택 Row 가 최대 Row보다 클 경우 종료
	//if ((arg+1) > fv_saveRowCnt) {
	if ((fv_startRow+1) > fv_saveRowCnt) {
		fn_processInit("2");
		
		var sMsg = "저장 되었습니다.\r\r";
		sMsg = sMsg + "-. 처리건수 : " + fv_saveRowCnt + " 건";
		gfn_alert(sMsg, "", "A");
		
		// 재조회
		fn_searchStd();
		
		// 자재별 조회
		fn_searchItem();
		return;
	}

	//trace("arg : " + arg);
	
	// saveRow Dataset Clear
	ds_saveRow.clearData();

	// COPY
	// 저장 대상 개수 
	for (var i = fv_startRow ; i <= fv_endRow ; i++)
	{
		// saveRow Dataset 에 복사 
		var iIdx = ds_saveRow.addRow();
		ds_saveRow.copyRow(iIdx, ds_save, i);
		// 저장(신규, 수정)관련 Flag Set
		if (fv_excelFlag2) 
			ds_saveRow.setColumn(iIdx, "saveFlag", "I");
		else
			ds_saveRow.setColumn(iIdx, "saveFlag", "U");
	
	}			
	
	
	// Find Row Value 지정
	//fv_row = ds_save.getColumn(arg, "itemCode");
	fv_row = ds_save.getColumn(fv_endRow, "itemCode");
	
	// 저장 Transaction
 	var strSvcID    = "saveItem";
    var strURL      = "fm/fms/strategyProfit/saveItem.xdo";
	var strInDs     = "ds_saveRow=ds_saveRow:A";
    var strOutDs    = "";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
 	
 	gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : Callback 후 작업진행 여부 CHECK 및 프로세스 호출
 *---------------------------------------------------------------------------------------------*/
function fn_processStep()
{
	if(fv_errorFlag=="Y")
	{
		// ERROR 발생 시 결과 표시
		fn_error();
		return;
	}

	
	var msg = "";
	
	//trace("fv_errorFlag : " + fv_errorFlag);

	// 해당 ROW POSITION 위치 : 최종 ROW
	var nRow = ds_listItem.findRowExpr("itemCode=='"+fv_row+"'");
	ds_listItem.rowposition = nRow;
	
	//trace("fv_row : " + fv_row);
	//trace("nRow : " + nRow);
	
	// Progress Bar SET
	//div_002.tabMain.tabP2.pbr_status.text = "전략이익율 생성작업 ("+(fv_saveRow+1)+"/"+ fv_saveRowCnt+")";
	div_002.tabMain.tabP2.pbr_status.text = "전략이익율 생성작업 ("+(fv_endRow+1)+"/"+ fv_saveRowCnt+")";
	
	//div_002.tabMain.tabP2.pbr_status.pos = fv_saveRow+1;
	div_002.tabMain.tabP2.pbr_status.pos = fv_endRow+1;
	div_002.tabMain.tabP2.pbr_status.stepIt();
	this.updateWindow(); // 이 부분 추가
	//trace("iRow : " + iRow);

	//다음 Transaction 처리 실행
	fv_saveRow++;
		
	//trace("fv_saveRow : " + fv_saveRow); 
	fn_process(fv_saveRow);
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 시스템오류 발생 시 오류메시지 저장
 *---------------------------------------------------------------------------------------------*/
function fn_error()
{
	trace("작업종료");
	fn_processInit("2");
	
	// 에러표시 후 작업중단 창 표시
	var sMsg = "전략이익율 생성 시 오류가 발생했습니다.\n\n";
	sMsg = sMsg + "※ 기 진행중인 자료는 모두 취소됩니다.\n";
	sMsg = sMsg + "  오류메시지확인 버튼을 클릭하여 오류 메시지를 확인한 후 재 작업하세요";
	gfn_alert(sMsg, "", "A");
	
	fn_errorView(true);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 시스템오류 발생 시 오류메시지 콘트롤
 *---------------------------------------------------------------------------------------------*/
function fn_errorView(flag)
{
	if (flag) {
		div_002.tabMain.tabP2.btn_errorView.visible = true;
	} else {
		div_002.tabMain.tabP2.btn_errorView.visible = false;
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : Progress Bar - 저장 용
 *---------------------------------------------------------------------------------------------*/
function fn_processInit(flag)
{
	div_002.tabMain.tabP2.pbr_status.text = "전략이익율 생성작업";
	div_002.tabMain.tabP2.pbr_status.pos = 0;
	if (flag=="1") div_002.tabMain.tabP2.pbr_status.visible = true;
	else div_002.tabMain.tabP2.pbr_status.visible = false;
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 자재별 목록 저장 시 중복 CHECK
 * 엑셀 업로드 후 저장 시 중복코드 발생 할 수 있음 
 *---------------------------------------------------------------------------------------------*/
function fn_saveItemChk()
{
	var nRowCnt = ds_listItem.getRowCount();	// DataSet Count
	var v_itemCode = "";

	for (var i = 0 ; i < nRowCnt ; i++)
	{
		v_itemCode = ds_listItem.getColumn(i, "itemCode");
		for (var j = 0 ; j < nRowCnt ; j++) {
			if (v_itemCode==ds_listItem.getColumn(j, "itemCode")) {
				if (i!=j) {
					sMsg = "중복된 자재코드가 존재합니다.\r\r";
					sMsg = sMsg + "- 자재코드 : " + ds_listItem.getColumn(j, "itemCode");
					gfn_alert(sMsg, "", "A");
					ds_listItem.selectRow(i);	// MultiRow 일 경우 rowposition 사용 X
					return false;
				}
			}
		}
		
	}
	return true;
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 센터별 CC목록 더블클릭 시 이벤트 처리
 *---------------------------------------------------------------------------------------------*/
function fn_listClassRowClick(row)
{
	// 조건 관련 DataSet 초기화
	ds_searchRow.clearData();
	// 선택한 팀, 판매그릅코드를 조건 Dataset에 대입
	var iIdx = ds_searchRow.addRow();
	ds_searchRow.setColumn(iIdx, "selCenter", ds_listStd.getColumn(row, "centerCode"));		// 센터코드 선택
	ds_searchRow.setColumn(iIdx, "selCcCd", ds_listStd.getColumn(row, "ccCd"));				// CC코드 선택
	ds_searchRow.setColumn(iIdx, "selDate", ds_search.getColumn(0, "schMonth")+ds_search.getColumn(0, "schGubun"));		// 기준일자	
	
	// 선택한 정보 표시
	div_002.edt_selCcNm.value =  "(" + ds_listStd.getColumn(row, "ccCd") + ")" + ds_listStd.getColumn(row, "ccNm");
	div_002.edt_selCcCd.value =  ds_listStd.getColumn(row, "ccCd");
	div_002.edt_selCenterName.value =  ds_listStd.getColumn(row, "centerName");
	div_002.edt_selCenterCode.value =  ds_listStd.getColumn(row, "centerCode");
	
	//-//// 분류율 초기화 : 전체
	//-//div_002.tabMain.tabP1.msk_clsRate.value = 0;

	// 분류율 초기화 : 선택
	for (var i = 0 ; i < ds_class.getRowCount() ; i++)
	{
		ds_class.setColumn(i, "strategyRate", "0");	 
	}

	// Key SET
	fv_centerCode = ds_listStd.getColumn(row, "centerCode");
	fv_ccCd = ds_listStd.getColumn(row, "ccCd");
	
	
	//if (div_002.tabMain.tabindex == 0)
	//	// 분류별 조회  
	//	fn_searchClass();
	//else 
	//	// 자재별 조회
	//	fn_searchItem();
	fn_searchItem(); // 2019.08.09 테마자재관리
}


/************************************************************************************************
 * 각 COMPONENT 별 EVENT 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : form에서 Key Down시 단축키들 지정(공통에서 자동생성, 화면에 스크립트 작성시 화면 스크립트만 실행됨)
 *---------------------------------------------------------------------------------------------*/
// function form_onkeydown(obj:Form, e:KeyEventInfo)
// {
// 	gfn_formKeyDown(obj, e);
// }

/*----------------------------------------------------------------------------------------------
 * 설명      : Grid Double Click시 이벤트
 * 센터별 CC 목록 조회 호출             
 *---------------------------------------------------------------------------------------------*/
function grd_listStd_oncelldblclick(obj:Grid, e:GridClickEventInfo)
{
	if(e.row < -1) return;
	
	// List Clear
	ds_listClass.clearData();
	ds_listItem.clearData();

	fn_listClassRowClick(e.row);
}





/*----------------------------------------------------------------------------------------------
 * 설명      : 분류별 목록에서 지정한 소분류에 대하여 판매율을 일괄 적용한다.
 *---------------------------------------------------------------------------------------------*/
function btn_clsRate_onclick(obj:Button,  e:ClickEventInfo)
{
	var nRowCnt = ds_listClass.getRowCount();	// DataSet Count
	var v_clsRate = div_002.msk_clsRate.value;			// 적용할 판매율
	var iCnt = 0;

	// 분류목록 여부 CHECK
	if(nRowCnt < 1) 
	{
		gfn_alert("msg.err.grid.noselect", "선택한 row");	// 선택된 항목이 없습니다.
		return;
	}


	if (v_clsRate.valueOf() == "undefined" || v_clsRate == "") v_clsRate = 0;
	
	var sMsg = "선택한 분류에 대해 판매율을 일괄 적용합니다.\n계속 진행 하시겠습니까?\n\n";
		sMsg = sMsg + " - 적용할 분류 : " + div_002.cbo_class.text;
	
	
	if (!gfn_confirm(sMsg, "", "C")) return;
	
	var v_class = div_002.cbo_class.value;		// 대분류 COMBO
	
	var v_arr_class;
	if(v_class != null)v_arr_class = v_class.split(",");
	for (var i = 0 ; i < nRowCnt ; i++)
	{
		var rate = false;
// 		// Dataset이 선택된 것만 적용
// 		if (ds_listClass.getSelect(i))	
// 		{
// 			iCnt++;
// 			ds_listClass.setColumn(i, "saleRate", v_clsRate);	// 판매율에 적용
// 		}
		if (v_class != "") {
			// 선택한 대분류 기준만 적용
			for(var j=0; j < v_arr_class.length ; j++){
				if(ds_listClass.getColumn(i, "clsCd2") == v_arr_class[j])rate = true;
			}
			if (rate) {
				iCnt++;
				ds_listClass.setColumn(i, "saleRate", v_clsRate);	// 판매율에 적용
			}
		} else {
			iCnt++;
			ds_listClass.setColumn(i, "saleRate", v_clsRate);	// 판매율에 적용
		}
	}

	if(iCnt == 0)
	{
		sMsg = "선택한 분류 정보가 없습니다.";
		gfn_alert(sMsg, "", "A");
	} else {
		gfn_alert("msg.action.success");	// 처리 되었습니다.
	}

}

/*----------------------------------------------------------------------------------------------
 * 설명      : 분류별 목록에 대한 엑셀 업로드 
 * 주) 연동 시 SQL 항목 순서와 Dataset 순서를 동일하게 해야 함
 *---------------------------------------------------------------------------------------------*/
function btn_clsUpload_onclick(obj:Button,  e:ClickEventInfo)
{
	var nRowCnt = ds_listClass.getRowCount();	// DataSet Count
	var v_center = ds_searchRow.getColumn(ds_searchRow.rowposition, "selCenter");
	var v_cc = ds_searchRow.getColumn(ds_searchRow.rowposition, "selCcCd");
	
	if (v_center=="" || v_cc=="") {
		gfn_alert("msg.noselect", "CC목록");	// CC목록을 선택해 주십시요.
		return;
	}


	this.setWaitCursor(true);

	// 파일 선택
	var strFileName = gfn_excelFileDialog("LOAD", "EXCEL");

	if (strFileName.length == 0)
	{
		this.setWaitCursor(false);
		return;
	}

	/*********************************************************************************************
	** argument             : strFileName		파일명 (경로 포함)
	**                        strDsName			Import 대상 Dataset Name
	**                        nStartRow			Import 시작 행(사용된 Range 기준, 1 base)
	**						  bKeepColInfo		Dataset의 컬럼 정보를 유지할지 여부
	*********************************************************************************************/
	
	var rtn = gfn_importExcel(strFileName, "ds_listClass", 2, true);
	
	var v_rate;

	if (ds_listClass.getRowCount()>0) {
		fv_excelFlag2 = true;
	
		// 엑셀 업로드 후에 Rowtype 속성 변경
		ds_listClass.updatecontrol = false;
		for(var i=0; i<ds_listClass.rowcount; i++)
		{	
			// Value CHECK
			if (gfn_isNum(ds_listClass.getColumn(i, "strategyRate"))==false) {
				ds_listClass.setColumn(i, "strategyRate", "0"); 
			} 
		
			ds_listClass.setRowType(i, Dataset.ROWTYPE_INSERT);
		}
		ds_listClass.updatecontrol = true;
		gfn_alert("msg.action.success");	// 처리 되었습니다.
	}

	this.setWaitCursor(false);
	
	//trace(ds_listClass.saveXML());
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 분류별 목록의 분류율 정보 저장
 * 저장 시 변경된 Dataset 이 아닌 전체를 기준으로 저장함
 *---------------------------------------------------------------------------------------------*/
function btn_clsSave_onclick(obj:Button,  e:ClickEventInfo)
{
	fn_saveClass();
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 자재별 목록에서 지정한 자재에 대하여 판매율을 일괄 적용한다.
 *---------------------------------------------------------------------------------------------*/
function btn_itemRate_onclick(obj:Button,  e:ClickEventInfo)
{
	var nRowCnt = ds_listItem.getRowCount();	// DataSet Count
	var v_itemRate = div_002.tabMain.tabP1.msk_itemRate.value;		// 적용할 판매율
	var iCnt = 0;

	// 자재목록 여부 CHECK
	if(nRowCnt < 1) 
	{
		gfn_alert("msg.err.grid.noselect", "선택한 row");	// 선택된 항목이 없습니다.
		return;
	}

	if (v_itemRate.valueOf() == "undefined" || v_itemRate == "") v_itemRate = 0;
	
	if (v_itemRate == 0) {
		gfn_alert("판매율 값을 입력하세요.", "A");
		div_002.tabMain.tabP1.msk_itemRate.setFocus();
		return;
	}
	
	var sMsg = "선택한 자재에 대해 판매율을 일괄 적용합니다.\n계속 진행 하시겠습니까?";
	
	
	if (!gfn_confirm(sMsg, "", "C")) return;
	
	for (var i = 0 ; i < nRowCnt ; i++)
	{
		// Dataset이 선택된 것만 적용
		if (ds_listItem.getSelect(i))	
		{
			iCnt++;
			ds_listItem.setColumn(i, "saleRate", v_itemRate);	// 판매율에 적용
		}
	}

	if(iCnt == 0)
	{
		sMsg = "선택한 자재 정보가 없습니다.";
		gfn_alert(sMsg, "", "A");
	} else {
		gfn_alert("msg.action.success");	// 처리 되었습니다.
	}

}

/*----------------------------------------------------------------------------------------------
 * 설명      : 자재별 목록에 대한 엑셀 업로드 
 * 주) 연동 시 SQL 항목 순서와 Dataset 순서를 동일하게 해야 함
 *---------------------------------------------------------------------------------------------*/
function btn_itemUpload_onclick(obj:Button,  e:ClickEventInfo)
{
	var nRowCnt = ds_listItem.getRowCount();	// DataSet Count
	var v_upjang = ds_searchRow.getColumn(ds_searchRow.rowposition, "selStdUpjang");
	
	// 자재목록 여부 CHECK
// 	if(nRowCnt < 1) 
// 	{
// 		gfn_alert("msg.err.grid.noselect", "선택한 row");	// 선택된 항목이 없습니다.
// 		return;
// 	}

	if (v_upjang=="") {
		gfn_alert("msg.noselect", "단가업장");	// 단가업장을 선택해 주십시요.
		return;
	}


	this.setWaitCursor(true);

	// 파일 선택
	var strFileName = gfn_excelFileDialog("LOAD", "EXCEL");

	if (strFileName.length == 0)
	{
		this.setWaitCursor(false);
		return;
	}

	/*********************************************************************************************
	** argument             : strFileName		파일명 (경로 포함)
	**                        strDsName			Import 대상 Dataset Name
	**                        nStartRow			Import 시작 행(사용된 Range 기준, 1 base)
	**						  bKeepColInfo		Dataset의 컬럼 정보를 유지할지 여부
	*********************************************************************************************/
	
	var rtn = gfn_importExcel(strFileName, "ds_listItem", 2, true);


	// 엑셀 업로드 후에 Rowtype 속성 변경
	if (ds_listItem.getRowCount() > 0) {
		fv_excelFlag3 = true;
		ds_listItem.updatecontrol = false;
		for(var i=0; i<ds_listItem.rowcount; i++)
		{	
			ds_listItem.setRowType(i, Dataset.ROWTYPE_INSERT);
		}
		ds_listItem.updatecontrol = true;
		gfn_alert("msg.action.success");	// 처리 되었습니다.
	}


	this.setWaitCursor(false);
	
	//trace(ds_listClass.saveXML());
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 자재별 목록의 자재율 정보 저장
 * 저장 시 변경된 Dataset 이 아닌 전체를 기준으로 저장함
 *---------------------------------------------------------------------------------------------*/
function btn_itemSave_onclick(obj:Button,  e:ClickEventInfo)
{
	fn_saveItem();
	//fn_saveItem_old();
}


function tabMain_canchange(obj:Tab, e:TabIndexChangeEventInfo)
{
	if(gfn_dsIsUpdated(ds_listClass) && e.postindex == 1){
		if(!gfn_confirm("저장하지 않은 이익율은 반영되지 않습니다.\n계속 하시겠습니까?"))return false;
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 전략율 전체 적용 처리
 * 
 *---------------------------------------------------------------------------------------------*/
function div_002_btn_clsRateAll_onclick(obj:Button,  e:ClickEventInfo)
{
	var nRowCnt = ds_listClass.getRowCount();	// DataSet Count
	var v_clsRate = div_002.tabMain.tabP1.msk_clsRate.value;			// 적용할 전략율
	//var v_clsRate1 = div_002.tabMain.tabP1.msk_clsRate1.value;			// 적용할 기획율
	var iCnt = 0;

	// 분류목록 여부 CHECK
	if(nRowCnt < 1) 
	{
		gfn_alert("msg.err.grid.noselect", "선택한 row");	// 선택된 항목이 없습니다.
		return;
	}

	if (v_clsRate.valueOf() == "undefined" || v_clsRate == "") v_clsRate = 0;
	if (v_clsRate1.valueOf() == "undefined" || v_clsRate1 == "") v_clsRate1 = 0;

	if (v_clsRate == 0 && v_clsRate1 == 0) {
		gfn_alert("전략율 및 기획율 값을 입력하세요.", "A");
		div_002.tabMain.tabP1.msk_clsRate.setFocus();
		return;
	}
	
	var sMsg = "전체 분류에 대해 전략(기획)율을 일괄 적용합니다.\n계속 진행 하시겠습니까?\n\n";
		sMsg = sMsg + " - 적용할 분류 : 전체";
	
	
	if (!gfn_confirm(sMsg, "", "C")) return;
	
	for (var i = 0 ; i < nRowCnt ; i++)
	{
		iCnt++;
		ds_listClass.setColumn(i, "strategyRate", v_clsRate);	// 전략율에 적용 
	}

	if(iCnt == 0)
	{
		sMsg = "선택한 분류 정보가 없습니다.";
		gfn_alert(sMsg, "", "A");
	} else {
		gfn_alert("msg.action.success");	// 처리 되었습니다.
	}
	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 분류별 전략율 적용 처리 Div Show
 * 
 *---------------------------------------------------------------------------------------------*/
function div_002_btn_clsDiv_onclick(obj:Button,  e:ClickEventInfo)
{
	var nRowCnt = ds_listClass.getRowCount();	// DataSet Count

	div_margin.position.right = div_002.tabMain.tabP1.btn_clsSave.position.right - 230;
	div_margin.position.width = 225;

	if (div_margin.visible) {
		div_margin.visible = false;
		div_002.tabMain.tabP1.btn_clsDiv.text = "분류별 적용 ▼";
	}
	else {
		// 자료 여부 CHECK
		if(nRowCnt == 0) 
		{
			gfn_alert("msg.err.grid.nodata", "");	// 데이타가 없습니다.
			return;
		}
		div_margin.visible = true;
		div_002.tabMain.tabP1.btn_clsDiv.text = "분류별 적용 ▲";
	}
	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 분류별 전략율 적용 처리 
 * 
 *---------------------------------------------------------------------------------------------*/
function div_margin_btn_clsRate2_onclick(obj:Button,  e:ClickEventInfo)
{
	var nRowCnt = ds_listClass.getRowCount();	// DataSet Count
	var nRowCnt1 = ds_class.getRowCount();		// DataSet Count : 분류정보
	var v_clsRate = "";							// 적용할 전략율
	var v_clsRate2 = "";						// 적용할 기획율
	var iCnt = 0;

	// 분류목록 여부 CHECK
	if(nRowCnt < 1) 
	{
		gfn_alert("msg.err.grid.noselect", "선택한 row");	// 선택된 항목이 없습니다.
		return;
	}

	// 판매율목록 여부 CHECK
	if(nRowCnt1 < 1) 
	{
		gfn_alert("분류별 전략율 정보가 없습니다.", "A");
		return;
	}

	// 전략율 Value Check
	for (var i = 0 ; i < nRowCnt1 ; i++)
	{
		if (gfn_nvl(ds_class.getColumn(i, "strategyRate"), "0") != "0")  iCnt++;
	}

	if (iCnt < 1) {
		gfn_alert("전략율 값을 최소한 1개 이상 입력하세요.", "A");
		return;
	}

	iCnt = 0;
	

	var sMsg = "선택한 분류에 대해 이익율 설정에 대한 추천판매율/추천단가를 일괄 적용합니다.\n계속 진행 하시겠습니까?\n\n";
		sMsg = sMsg + " - 추천판매율이 0 인 분류는 적용하지 않습니다."
	
	
	if (!gfn_confirm(sMsg, "", "C")) return;

	var v_class = "";
	var v_arr_class = "";
	var rate = false;
	
	// 분류별 전략율 일괄 적용
	for (var i = 0 ; i < nRowCnt1 ; i++)
	{
		v_class = ds_class.getColumn(i, "classCode");						// 분류코드
		v_clsRate = gfn_nvl(ds_class.getColumn(i, "strategyRate"), "0");	// 전략율 
		
		if(v_class != null) v_arr_class = v_class.split(",");
		
		// 분류 및 전략율 또는 기획율이 0이 아니면 처리
		if (v_class != "" && (v_clsRate != "0" || v_clsRate2 != "0")) {
			// 분류별 적용
			for (var j = 0 ; j < nRowCnt ; j++)
			{
				rate = false;
				for(var k=0; k < v_arr_class.length ; k++){
					if(ds_listClass.getColumn(j, "clsCd2") == v_arr_class[k])rate = true;
				}
				if (rate) {
					iCnt++;
					ds_listClass.setColumn(j, "strategyRate", v_clsRate);	// 전략율에 적용 
				}
			}			
		}		
	
	}	

	if(iCnt == 0)
	{
		sMsg = "선택한 분류 정보 전략율이 적용되지 않았습니다.";
		gfn_alert(sMsg, "", "A");
	} else {
		gfn_alert("msg.action.success");	// 처리 되었습니다.
	}
	
}

function comp_tm_onkeydown(obj:TmSearchComponent, e:KeyEventInfo)
{
	if(e.keycode == 46){
		div_001.comp_tm.setTmCode("");
		div_001.comp_tm.setTmName("");
		// CC정보 초기화
		ds_search.setColumn(0, "schCc", "");
		ds_search.setColumn(0, "schCcNm", "");
		
	}
}

function edt_ccCd_onkeydown(obj:Edit, e:KeyEventInfo)
{
	if(e.keycode == 46){
		ds_search.setColumn(0, "schCc", "");
		ds_search.setColumn(0, "schCcNm", "");
	}
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 조건에 월 및 구분이 변경되는 경우 SET
 *---------------------------------------------------------------------------------------------*/
function fn_calcDate()
{
	var nRow = ds_search.rowposition;

	if (gfn_nvl(ds_search.getColumn(nRow, "schMonth"), "")=="" || gfn_nvl(ds_search.getColumn(nRow, "schGubun"), "")=="") {
		ds_search.setColumn(nRow, "schDate", "");		  
	}
	else {
		ds_search.setColumn(nRow, "schDate", ds_search.getColumn(nRow, "schMonth")+ds_search.getColumn(nRow, "schGubun"));
	}
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 조건 Dataset 변경 
 * 
 *---------------------------------------------------------------------------------------------*/
function ds_search_oncolumnchanged(obj:Dataset, e:DSColChangeEventInfo)
{
    switch(e.columnid)
    {
		// 센터코드
		case "schCenter" :
			ds_listStd.clearData();
			break;

		// 월
        case "schMonth" :
			ds_listStd.clearData();
			fn_calcDate();
            break;

		// 조회구분
        case "schGubun" :
			ds_listStd.clearData();
			fn_calcDate();
            break;
	}	

	fn_stdInit();	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 엑셀템플릿 버튼 클릭 이벤트 - 엑셀 업로드용 export
 *---------------------------------------------------------------------------------------------*/
function btn_template_onclick(obj:Button,  e:ClickEventInfo)
{
	gfn_exportExcel(grd_excel); 
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 자재별 엑셀 업로드 처리
 *---------------------------------------------------------------------------------------------*/
function btn_clsUpload2_onclick(obj:Button,  e:ClickEventInfo)
{
	var nRow= ds_search.rowposition;
	var nRowCnt1 = ds_searchRow.getRowCount();	// 조건 DataSet Count
	
	ds_search.setColumn(nRow, "schDate", ds_search.getColumn(nRow, "schMonth")+ds_search.getColumn(nRow, "schGubun"));	// 기준일자	

	// 조회시 Validation Check : 원 조회조건
	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;
	
	// 선택한 센터별CC 자료여부 CHECK
	if(nRowCnt1 == 0) 
	{
		gfn_alert("msg.noselect", "CC목록");	// CC목록을 선택해 주십시요.
		return;
	}
	// 조회시 Validation Check : ROW 조회조건
	if (gfn_validCheck(ds_searchRow, ds_searchRowValid, true) == false) return;

	this.setWaitCursor(true);

	// 파일 선택
	var strFileName = gfn_excelFileDialog("LOAD", "EXCEL");

	if (strFileName.length == 0)
	{
		this.setWaitCursor(false);
		return;
	}

	/*********************************************************************************************
	** argument             : strFileName		파일명 (경로 포함)
	**                        strDsName			Import 대상 Dataset Name
	**                        nStartRow			Import 시작 행(사용된 Range 기준, 1 base)
	**						  bKeepColInfo		Dataset의 컬럼 정보를 유지할지 여부  
	*********************************************************************************************/
	
	var rtn = gfn_importExcel(strFileName, "ds_listItem", 2, true);

	var v_rate;
	var v_amt;

	if (ds_listItem.getRowCount()>0) {
		fv_excelFlag = true;
		fv_excelFlag3 = true;
	
		// 엑셀 업로드 후에 Rowtype 속성 변경  
		ds_listItem.updatecontrol = false;
		for(var i=0; i<ds_listItem.rowcount; i++)
		{	
			// Value CHECK
			if (gfn_isNum(ds_listItem.getColumn(i, "strategyRate"))==false) {
				ds_listItem.setColumn(i, "strategyRate", "0"); 
			}
			if (gfn_isNum(ds_listItem.getColumn(i, "strategyPrice"))==false) {
				ds_listItem.setColumn(i, "strategyPrice", "0"); 
			} 
		
			ds_listItem.setRowType(i, Dataset.ROWTYPE_INSERT);
			
			// 전략단가
			// 전략율이 0 이면 전략단가 0
			if (ds_listItem.getColumn(i, "strategyRate")=="0") 
				v_amt  = "0";
			else			
				v_amt = fn_calcAmt(i, ds_listItem.getColumn(i, "strategyRate"));
			ds_listItem.setColumn(i, "strategyPrice", v_amt); 
			
		}
		ds_listItem.updatecontrol = true;
		fv_excelFlag = false;
		gfn_alert("msg.action.success");	// 처리 되었습니다.
	}

	this.setWaitCursor(false);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 자재별 목록의 비율 등록 시 금액 자동계산 함수 [전략단가 계산]
 * 인자      : 선택한 ROW, 입력한 비율, 계산된 금액(Return)
 *---------------------------------------------------------------------------------------------*/
function fn_calcAmt(row, rate)
{
	var v_contractPrice = 0; 	// 매입단가
	var v_calcAmt = 0;
	
	v_contractPrice = ds_listItem.getColumn(row, "contractPrice");

	if (v_contractPrice == 0) return 0;
	
	if (rate=="" || rate=="0") return 0;
	
	v_calcAmt = v_contractPrice * (1 + (rate / 100));
	
	//trace("v_calcAmt : " + v_calcAmt);
	
	v_calcAmt = gfn_round(v_calcAmt, 1);

	//trace("gfn_round(v_calcAmt) : " + v_calcAmt);
	return v_calcAmt;
} 

/*----------------------------------------------------------------------------------------------
 * 설명      : 자재별 목록의 비율 등록 시 금액 자동계산 함수 [기획단가 계산]
 * 인자      : 선택한 ROW, 입력한 비율, 계산된 금액(Return)
 *---------------------------------------------------------------------------------------------*/
function fn_calcAmt2(row, rate)
{
	var v_strategyPrice = 0; 	// 전략단가
	var v_calcAmt = 0;
	
	v_strategyPrice = ds_listItem.getColumn(row, "strategyPrice");

	if (v_strategyPrice == 0) return 0;
	
	if (rate=="" || rate=="0") return 0;
	
	v_calcAmt = v_strategyPrice * (1 + (rate / 100));
	
	v_calcAmt = gfn_round(v_calcAmt, 1);

	return v_calcAmt;
} 

/*----------------------------------------------------------------------------------------------
 * 설명      : 자재별 목록의 DS 변경 이벤트 처리
 * 해당 Column의 값이 변경될 때에만 적용
 *---------------------------------------------------------------------------------------------*/
function ds_listItem_oncolumnchanged(obj:Dataset, e:DSColChangeEventInfo)
{
	var v_amt;
	var v_rate;
	  
    switch(e.columnid)
    {

		// 전략율
        case "strategyRate" :
			if (fv_excelFlag==true) return;		// 엑셀업로드 시에는 계산하지 못하게 함
			v_amt = fn_calcAmt(e.row, ds_listItem.getColumn(e.row, "strategyRate"));
			ds_listItem.setColumn(e.row, "strategyPrice", v_amt); 
			
			//trace("strategyRate");
            break;
 	}	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 오류메시지 클릭 이벤트 - 엑셀 업로드용 export
 *---------------------------------------------------------------------------------------------*/
function btn_errorView_onclick(obj:Button,  e:ClickEventInfo)
{
	var arrParam = new Array();

	// 전송할 파라미터 1 : 오류메시지
	arrParam[0] = fv_errorMsg;
	arrParam[1] = "strategy";

	var rtnVal = gfn_dialog("SalePriceAutoPop"					// Dialog ID
							, "X_FMS::SalePriceAutoPop.xfdl"	// Form URL
							, {fv_Contents:arrParam}			// 배열
							, null, null, null, null, null, false, true, -1);
	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 자재별 삭제
 *---------------------------------------------------------------------------------------------*/
function div_002_tabMain_tabP2_btn_itemDel_onclick(obj:Button,  e:ClickEventInfo)
{
	var nRowCnt = ds_listItem.getRowCount();	// DataSet Count
	var iCnt = 0;
	var jCnt = 0;

	// 삭제할 자료 CHECK
	for (var i = 0 ; i < nRowCnt ; i++)
	{
 		// Dataset이 선택된 것만 적용
 		if (ds_listItem.getSelect(i))	
 		{
 			iCnt++;
 			if (ds_listItem.getRowType(i) <> Dataset.ROWTYPE_INSERT) {
				jCnt++;
 			}
 			
 		}
	}
	// 삭재 COUNT CHECK
	if(iCnt == 0)
	{
		sMsg = "삭제할 자재정보가 없습니다.";
		gfn_alert(sMsg, "", "A");
		return;
	}	
	
	var sMsg = "선택한 자재를 삭제합니다.\n계속 진행 하시겠습니까?\n\n";
	if (jCnt > 0) {
		sMsg = sMsg + " - 기존 자재에 대한 삭제 후 자료를 재조회 합니다.\n";
	}
		sMsg = sMsg + " - 대상건수   : " + iCnt + "\n";

	var rtVal = gfn_confirm(sMsg, "", "C");	// 선택된 자료를 삭제 하시겠습니까?

	if (rtVal == false) return;
	
	// 삭제용 dataset Clear
	ds_deleteItem.clearData();
	
	iCnt = 0;
	var nRow = ds_searchRow.rowposition;
	
	// 삭제할 대상 dataset 생성 : TR 대상
	for (var i = 0 ; i < nRowCnt ; i++)
	{
		// Dataset이 선택된 것만 적용
			if (ds_listItem.getSelect(i))	
			{
				//trace("delete : " + i);
				if (ds_listItem.getRowType(i) == Dataset.ROWTYPE_INSERT) {
					// 실제 TR 을 수행하게 되면 삭제하고자 하는 (추가)행은 조회 시 반영 안됨, 별도의 삭제를 할 필요가 없음
				} else {
					// 기존 자료인 경우
					iCnt++;
					ds_deleteItem.addRow();
					
					// 삭제용 dataset SET
					ds_deleteItem.setColumn(ds_deleteItem.rowposition, "centerCode", ds_searchRow.getColumn(nRow, "selCenter"));	// 센터코드
					ds_deleteItem.setColumn(ds_deleteItem.rowposition, "ccCd", ds_searchRow.getColumn(nRow, "selCcCd"));			// CC코드
					ds_deleteItem.setColumn(ds_deleteItem.rowposition, "profitDate", ds_searchRow.getColumn(nRow, "selDate"));		// 기준일자
					ds_deleteItem.setColumn(ds_deleteItem.rowposition, "itemCode", ds_listItem.getColumn(i, "itemCode"));			// 자재코드
				}
			}
	}
	
	
	if (iCnt > 0) {
		// Transaction 바로 호출해서 삭제 처리 함 
		var strSvcID    = "deleteItem";
		var strURL      = "fm/fms/ThemeItemProfit/deleteItem.xdo";
		var strInDs     = "ds_deleteItem=ds_deleteItem:A";
		var strOutDs    = "";
		var strArg      = "";
		var strCallback = "fn_callBack";
		var bAsync      = true;
		
		gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
	} else {
		// 신규 추가행만 존재하는 경우
		var nSucc = ds_listItem.deleteSelectedRows();
		
		//trace("nSucc : " + nSucc);

		gfn_alert("msg.delete.success");	// 삭제 되었습니다.
		return;
	}
	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 세분류별 초기화, 삭제(일괄)
 *---------------------------------------------------------------------------------------------*/
function div_002_tabMain_tabP1_btn_clsDel_onclick(obj:Button,  e:ClickEventInfo)
{
	var nRowCnt = ds_listClass.getRowCount();	// DataSet Count
	var nRowCnt1 = ds_searchRow.getRowCount();	// 조건 DataSet Count
	
	// 저장할 자료 여부 CHECK 
	if(nRowCnt == 0) 
	{
		gfn_alert("msg.save.nodata", "저장할 데이터");	// 저장할 데이터가 없습니다.
		return;
	}

	// 선택한 센터별CC 자료여부 CHECK
	if(nRowCnt1 == 0) 
	{
		gfn_alert("msg.noselect", "CC목록");	// CC목록을 선택해 주십시요.
		return;
	}

	var sMsg = "이익율 설정에 대한 추천판매율/추천단가를 일괄 삭제합니다.\n계속 진행 하시겠습니까?";
	if (!gfn_confirm(sMsg, "", "C")) return;

	// 저장 시 조건(KEY)을 ds_listClass의 KEY 값으로 복사 
	var nRow= ds_searchRow.rowposition;

    var strSvcID    = "deleteClass";
    var strURL      = "fm/fms/strategyProfit/deleteClass.xdo";
	var strInDs     = "ds_searchRow=ds_searchRow:A";
    var strOutDs    = "";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}

function grd_listItem_onexpanddown(obj:Grid, e:GridMouseEventInfo)
{
	var v_rtn = gfn_dialog("", "U_FSI::FSI00037P.xfdl","");
	
	if(!gfn_isNull(v_rtn))
	{
		var v_result = v_rtn.split(";");
		ds_listItem.setColumn(e.row, "itemCode", v_result[0]);
		ds_listItem.setColumn(e.row, "itemName", v_result[1]);
		ds_listItem.setColumn(e.row, "itemSize", "");
		ds_listItem.setColumn(e.row, "itemUnit", "");
	}
	
}
]]></Script>
  </Form>
</FDL>
