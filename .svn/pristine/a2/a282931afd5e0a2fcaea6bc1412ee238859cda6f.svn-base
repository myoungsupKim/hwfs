<?xml version="1.0" encoding="euc-kr"?>
<query dynamic="true">
    <type>select</type>
    <description><![CDATA[CS진단 점검결과 조회]]></description>
    <reload>true</reload>
    <monitoring>true</monitoring>
    <result-count>1</result-count>
    <statement>
SELECT A.TABLE_TYPE
     , A.FORM_CD
     , B.FORM_NM
     , A.UPJANG
     , E.UPJANGNM
     , A.CHK_DD
     , A.CHK_CLASS
     , C.CODE_NAME AS CHK_CLASS_NM
     , A.TM_CD
     , (SELECT TM_NM FROM HLDC_SC_DEPT_V WHERE TM_CD = A.TM_CD AND ROWNUM = 1) AS TM_NM
     , A.CHARGE_SABUN
     , (SELECT NM_KOR FROM HLDC_HR_PERSONAL WHERE SABUN =  A.CHARGE_SABUN) AS CHARGE_NM
     , A.TEAM_MST_SABUN
     , (SELECT NM_KOR FROM HLDC_HR_PERSONAL WHERE SABUN =  A.TEAM_MST_SABUN) AS TEAM_MST_NM
     , A.SUBTEAM_MST_SABUN
     , (SELECT NM_KOR FROM HLDC_HR_PERSONAL WHERE SABUN =  A.SUBTEAM_MST_SABUN) AS SUBTEAM_MST_NM
     , (SELECT COUNT(1) AS CNT                            
          FROM SCO_FS_HR_PERSONAL_V L
              ,HLDC_ST_UPJANG M
         WHERE L.DEPT_ID = M.DEPT_ID
           AND M.UPJANG = A.UPJANG
           AND L.GB_JAEJIK IN ('AA', 'CA')
           AND L.PER_DTD IS NULL) AS DUTY_PSN
     , A.RESP_USER1
     , (SELECT NM_KOR FROM HLDC_HR_PERSONAL WHERE SABUN =  A.RESP_USER1) AS RESP_USER1_NM
     , A.RESP_USER2
     , (SELECT NM_KOR FROM HLDC_HR_PERSONAL WHERE SABUN =  A.RESP_USER2) AS RESP_USER2_NM
     , A.RESP_USER3
     , (SELECT NM_KOR FROM HLDC_HR_PERSONAL WHERE SABUN =  A.RESP_USER3) AS RESP_USER3_NM
     , A.INSPECTOR
     , D.NM_KOR AS INSPECTOR_NM
     , A.CHK_START_TIME
     , A.CHK_END_TIME
     , A.SCORE
     , A.GSCORE
     , A.TSCORE
     , A.GRADE_CD
     , A.CHK_RESULT
     , F.CODE_NAME AS CHK_RESULT_TXT
     , A.CONFIRM_YN
     , A.CONFIRM_DD
     , A.IMPROV_CONFIRM_YN
     , A.IMPROV_CONFIRM_DD
     , A.INSPT_REQ_YN
     , A.INSPT_REQ_DD
     , A.INSPT_REQ_NUM
     , A.INSPT_REQ_RESULT
     , A.REMARK
     , A.USE_YN
     , A.CUSER
     , A.CDATE
     , A.UUSER
     , A.UDATE
     , E.OPEN_DATE
     , (SELECT COUNT(1)
          FROM FSC_PATL_RESULT_DTL
         WHERE TABLE_TYPE = A.TABLE_TYPE
           AND FORM_CD = A.FORM_CD
           AND UPJANG = A.UPJANG
           AND CHK_DD = A.CHK_DD
           AND IMPROV_CHECK = 'Y') AS IMPROV_CHECK_CNT
     , (SELECT COUNT(1)
          FROM FSC_PATL_RESULT_DTL
         WHERE TABLE_TYPE = A.TABLE_TYPE
           AND FORM_CD = A.FORM_CD
           AND UPJANG = A.UPJANG
           AND CHK_DD = A.CHK_DD
           AND IMPROV_MRMT_DD IS NOT NULL) AS IMPROV_MRMT_CNT
     , A.SIGN_INSTANCE_ID1  /* 점검결재ID */
     , CASE WHEN A.SIGN_INSTANCE_ID1 IS NOT NULL THEN NVL(SCC_SIGN_STATUS_FUN(A.SIGN_INSTANCE_ID1), 'DRAFT') END AS SIGN_PROGRESS_STATUS1
     , A.SIGN_INSTANCE_ID2  /* 개선결재ID */
     , CASE WHEN A.SIGN_INSTANCE_ID2 IS NOT NULL THEN NVL(SCC_SIGN_STATUS_FUN(A.SIGN_INSTANCE_ID2), 'DRAFT') END AS SIGN_PROGRESS_STATUS2
  FROM FSC_PATL_RESULT A
     , FSC_PATL_FORM B
     , SCC_COMMON_CODE C
     , SCC_COMMON_CODE F
     , HLDC_HR_PERSONAL D
     , MAC_UPJANG_V E
 WHERE A.TABLE_TYPE = B.TABLE_TYPE
   AND A.FORM_CD = B.FORM_CD
   AND C.GROUP_CODE = 'FS0107'
   AND A.CHK_CLASS = C.CODE
   AND A.INSPECTOR = D.SABUN(+)
   AND A.UPJANG = E.UPJANG
<isNotNull col="UPJANG">
   AND A.UPJANG = #UPJANG#
</isNotNull>
   AND F.GROUP_CODE(+) = 'FS0117'
   AND A.CHK_RESULT = F.CODE(+)
<isNotNull col="FORM_CD">
   AND A.FORM_CD = #FORM_CD#
</isNotNull>
<isNotNull col="CHK_DD">
   AND A.CHK_DD = #CHK_DD#
</isNotNull>
<isNotNull col="START_DD">
   AND A.CHK_DD BETWEEN #START_DD# AND #END_DD#
</isNotNull>
<isNotNull col="CONFIRM_YN">
   AND A.CONFIRM_YN = #CONFIRM_YN#
</isNotNull>
 ORDER BY A.CHK_DD DESC
    </statement>
    <input default-name="ds_cond">
    </input>
    <output default-name="ds_list">
    </output>
</query>