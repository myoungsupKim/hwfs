<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="../../../default_typedef.xml"/>
  <Form id="FSA00010E" onload="form_onload" titletext="업장그룹설정" position="absolute 0 0 1252 725" scrollbars="none">
    <Layouts>
      <Layout>
        <Static id="sta_detail05" class="sta_WFDA_Labelbg" position="absolute 949 141 1237 168" anchor="top right"/>
        <Static id="Static08" class="sta_WFSA_Labelbg" position="absolute 337 61 1237 128" anchor="left top right" onclick="Static08_onclick"/>
        <Static id="Static3" position="absolute 417 689 1095 717"/>
        <Grid autoenter="select" binddataset="ds_out" cellsizingtype="col" readonly="false" enable="true" id="grd_GrpMng" useinputpanel="false" taborder="15" tabstop="true" usecontextmenu="true" useselcolor="true" visible="true" wheelscrollrow="1" position="absolute 0 61 328 710" selecttype="row" autofittype="col" anchor="left top bottom">
          <Formats>
            <Format id="Default">
              <Columns>
                <Column size="32" band="left"/>
                <Column size="155"/>
                <Column size="58"/>
              </Columns>
              <Rows>
                <Row size="26" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell displaytype="text" text="번호"/>
                <Cell col="1" displaytype="text" text="그룹명"/>
                <Cell col="2" displaytype="text" text="사용여부"/>
              </Band>
              <Band id="body">
                <Cell displaytype="text" style="align:center;background:white;background2:white;" expr="expr:currow + 1"/>
                <Cell col="1" displaytype="text" edittype="normal" style="align:left;background:white;background2:white;" text="bind:GRP_NAME" editlimit="150" editimemode="native"/>
                <Cell col="2" displaytype="checkbox" edittype="checkbox" style="align:center;background:white;background2:white;" text="bind:USE_YN"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Grid autoenter="select" binddataset="ds_list_out" cellsizingtype="col" readonly="false" enable="true" id="grd_GrpList" useinputpanel="false" taborder="10" tabstop="true" usecontextmenu="true" useselcolor="true" visible="true" wheelscrollrow="1" position="absolute 337 180 1237 710" selecttype="row" autofittype="col" anchor="all">
          <Formats>
            <Format id="Default">
              <Columns>
                <Column size="36" band="left"/>
                <Column size="81"/>
                <Column size="121"/>
                <Column size="71"/>
                <Column size="78"/>
                <Column size="130"/>
                <Column size="50"/>
                <Column size="103"/>
                <Column size="41"/>
              </Columns>
              <Rows>
                <Row size="26" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell displaytype="text" class="head_Excel"/>
                <Cell col="1" text="사업부"/>
                <Cell col="2" displaytype="text" text="팀"/>
                <Cell col="3" displaytype="text" text="직군"/>
                <Cell col="4" displaytype="text" text="상세직군"/>
                <Cell col="5" displaytype="text" text="사업장"/>
                <Cell col="6" text="리더"/>
                <Cell col="7" displaytype="text" text="그룹"/>
                <Cell col="8" celltype="head" displaytype="checkbox" edittype="checkbox" editscrollbar="vert"/>
              </Band>
              <Band id="body">
                <Cell displaytype="text" style="align:center;background:white;background2:white;" expr="expr:currow + 1"/>
                <Cell col="1" displaytype="text" style="background:white;background2:white;" text="bind:MU_NAME" suppress="1"/>
                <Cell col="2" displaytype="text" style="align:left;background:white;background2:white;" text="bind:TM_NAME" suppress="2"/>
                <Cell col="3" displaytype="text" style="align:left;background:white;background2:white;" text="bind:JOB_NAME" suppress="3"/>
                <Cell col="4" displaytype="text" style="align:left;background:white;background2:white;" text="bind:SUB_JOB_NAME" suppress="4"/>
                <Cell col="5" displaytype="text" style="align:left;background:white;background2:white;" text="bind:UPJANGNM"/>
                <Cell col="6" displaytype="text" style="align:center;background:white;background2:white;" text="bind:LEADER_NM"/>
                <Cell col="7" displaytype="text" style="align:left;background:white;background2:white;" text="bind:GRP_NAME"/>
                <Cell col="8" celltype="body" displaytype="checkbox" edittype="checkbox" style="align:center;background:white;background2:white;" text="bind:CHK"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Static id="Static04" text="팀" position="absolute 564 72 634 93" class="sta_WFSA_label"/>
        <Static id="Static1" text="사업장" position="absolute 788 72 842 93" class="sta_WFSA_label"/>
        <Static id="Static14" text="직군" position="absolute 354 98 424 119" class="sta_WFSA_label" anchor="default"/>
        <Static id="Static15" text="그룹" position="absolute 1000 98 1038 119" class="sta_WFSA_label" anchor="default"/>
        <Static id="Static16" text="상세직군" position="absolute 564 98 634 119" class="sta_WFSA_label" anchor="default"/>
        <Combo codecolumn="JOB_CD" datacolumn="JOB_NAME" id="Cbo_Job" imemode="native" index="0" innerdataset="ds_cbo_JOB" onitemchanged="Cbo_Job_OnChanged" type="dropdown" taborder="4" position="absolute 408 97 534 118" anchor="default"/>
        <Combo codecolumn="SUB_JOB_CD" datacolumn="SUB_JOB_NAME" id="Cbo_JobSub" imemode="native" index="0" innerdataset="ds_cbo_SUB_JOB" type="dropdown" taborder="5" position="absolute 632 97 759 118" anchor="default"/>
        <Combo codecolumn="GRP_SEQ" datacolumn="GRP_NAME" id="cbo_Grp" imemode="native" index="0" innerdataset="ds_grp_out" type="dropdown" taborder="7" position="absolute 1042 97 1222 118" anchor="left top right" onkeydown="cbo_Grp_onkeydown"/>
        <Static id="Static4" text="적용그룹" position="absolute 949 141 1019 168" class="sta_WFDA_Label01" anchor="top right"/>
        <Combo codecolumn="GRP_SEQ" datacolumn="GRP_NAME" id="cbo_AddGrp" imemode="native" index="0" innerdataset="ds_grp_out" type="filter" taborder="8" position="absolute 1021 144 1171 165" onitemchanged="cbo_AddGrp_onitemchanged" anchor="top right"/>
        <Static id="Static6" position="absolute 10 601 281 629"/>
        <Static id="Static8" text="리더" position="absolute 788 98 858 119" class="sta_WFSA_label" anchor="default"/>
        <Edit id="ed_Leader" imemode="native" onkeydown="ed_Leader_OnKeyDown" readonly="true" taborder="6" position="absolute 844 97 950 118" anchor="default"/>
        <Button id="btn_Leader" onclick="btn_Leader_OnClick" taborder="33" tabstop="false" text="" position="absolute 949 97 970 118" class="btn_WF_popSearch" image="" anchor="default"/>
        <CheckBox falsevalue="N" id="chk_Disable" taborder="3" text="폐점업장제외" truevalue="Y" position="absolute 1063 72 1153 92" value="true" anchor="default"/>
        <Div id="div_cmnBtn" anchor="left top right" taborder="14" url="cmn::CmnBtn.xfdl" text="Div00" scrollbars="none" position="absolute 0 0 1237 30"/>
        <Static id="Static12" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 0 30 93 43"/>
        <Static id="Static05" text="h06" onclick="Static03_onclick" class="Guide01_AreaRed" visible="false" position="absolute 1093 30 1237 36" anchor="top right"/>
        <Static id="Static19" text="h05" class="Guide01_AreaRed" visible="false" position="absolute 0 56 1237 61" anchor="top right"/>
        <Static id="Static43" text="W10" visible="false" position="absolute 337 61 1237 71" style="background:#ff000055;align:center middle;"/>
        <Static id="Static45" text="W15" visible="false" position="absolute 338 61 353 128" style="background:#ff000055;align:center middle;"/>
        <Static id="Static34" text="W10" visible="false" position="absolute 622 71 632 118" style="background:#ff000055;align:center middle;"/>
        <Static id="Static51" text="W05." visible="false" position="absolute 337 92 1237 97" style="background:#ff000055;align:center middle;"/>
        <Static id="Static44" text="W10" visible="false" position="absolute 337 118 1237 128" style="background:#ff000055;align:center middle;"/>
        <Static id="Static35" text="W30" visible="false" position="absolute 534 71 564 118" style="background:#ff000055;align:center middle;"/>
        <Static id="Static36" text="W10" visible="false" position="absolute 834 71 844 118" style="background:#ff000055;align:center middle;"/>
        <Static id="Static37" text="W30" visible="false" position="absolute 970 71 1000 118" style="background:#ff000055;align:center middle;"/>
        <Static id="Static53" text="W30" visible="false" position="absolute 758 71 788 118" style="background:#ff000055;align:center middle;"/>
        <Static id="Static13" text="W15" visible="false" position="absolute 1222 61 1237 128" style="background:#ff000055;align:center middle;" onclick="Static13_onclick"/>
        <Static id="Static22" text="그룹설정 및 조회" onclick="Static22_onclick" class="sta_WF_Title01" position="absolute 337 44 665 75" anchor="left top"/>
        <Static id="Static00" text="그룹관리" onclick="Static22_onclick" class="sta_WF_Title01" position="absolute 0 44 328 75" anchor="left top"/>
        <Static id="Static06" text="w15" onclick="Static06_onclick" class="Guide01_AreaRed" visible="false" position="absolute 1237 0 1252 710" anchor="top right"/>
        <Static id="Static71" text="h15" onclick="Static71_onclick" class="Guide01_AreaRed" visible="false" position="absolute 0 710 1252 725" anchor="left bottom"/>
        <Static id="Static17" text="h06" onclick="Static03_onclick" class="Guide01_AreaRed" visible="false" position="absolute 1101 679 1245 685" anchor="top right"/>
        <Static id="Static20" text="W15" onclick="Static13_onclick" visible="false" position="absolute 1222 638 1237 705" style="background:#ff000055;align:center middle;"/>
        <Static id="Static23" text="W10" visible="false" position="absolute 917 684 927 705" style="background:#ff000055;align:center middle;"/>
        <Static id="Static07" text="W15" onclick="Static13_onclick" visible="false" position="absolute 0 638 15 705" style="background:#ff000055;align:center middle;"/>
        <Static id="Static24" text="W15" onclick="Static13_onclick" visible="false" position="absolute 312 638 327 705" style="background:#ff000055;align:center middle;"/>
        <Static id="Static18" text="h06" onclick="Static03_onclick" class="Guide01_AreaRed" visible="false" position="absolute 189 29 333 35" anchor="top right"/>
        <Static id="Static26" text="h05" class="Guide01_AreaRed" visible="false" position="absolute 0 55 328 60" anchor="top right"/>
        <Button id="btn_AddGrp" taborder="11" text="그룹추가" class="btn_WF_Function" position="absolute 210 35 287 55" onclick="Form_Btn_OnClick"/>
        <Button id="btn_DeleteGrp" taborder="12" class="btn_WF_GrdMinus" position="absolute 289 35 307 55" onclick="Form_Btn_OnClick"/>
        <Button id="btn_SaveGrp" taborder="13" class="btn_WF_GrdSave" position="absolute 309 35 327 55" onclick="Form_Btn_OnClick"/>
        <Button id="btn_SetUpjangGrp" taborder="9" text="적용" class="btn_WF_Function" position="absolute 1177 144 1231 165" onclick="Form_Btn_OnClick" anchor="top right"/>
        <Static id="Static02" text="h06" onclick="Static03_onclick" class="Guide01_AreaRed" visible="false" position="absolute 337 128 1237 141" anchor="top right"/>
        <Static id="Static21" text="h06" onclick="Static03_onclick" class="Guide01_AreaRed" visible="false" position="absolute 337 167 1237 180" anchor="top right"/>
        <Static id="Static25" text="사업부" class="sta_WFSA_label" position="absolute 353 72 423 93"/>
        <Static id="Static27" text="W10" visible="false" position="absolute 398 71 408 118" style="background:#ff000055;align:center middle;"/>
        <MuSearchComponent id="cbo_mu" titletext="사업부 선택 Component" taborder="0" text="MuSearchComponent00" position="absolute 408 71 534 92" bindDataset="" bindMuCdColumn="" appendText="" onItemChangedEvent="fn_muChange"/>
        <UpjangSearchComponent id="edt_upjang" titletext="업장 검색용 Component" taborder="2" text="UpjangSearchComponent00" position="absolute 844 71 1032 92" bindDataset="" bindUpjangCodeColumn="" bindUpjangNameColumn="" eventBeforeTrigger="" eventAfterTrigger="" roleSetId=""/>
        <TmSearchComponent id="edt_tm" titletext="팀 검색용 Component" taborder="1" text="TmSearchComponent00" position="absolute 632 71 758 92" bindDataset="" bindTmCdColumn="" bindTmNmColumn="" qoBuCd="" qoMuCd="" qoUseYn="" eventAfterTrigger="fn_tmChange" eventBeforeTrigger=""/>
        <Static id="Static10" text="W10" visible="false" position="absolute 1032 71 1042 118" style="background:#ff000055;align:center middle;"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_out" oncolumnchanged="ds_out_OnColumnChanged">
        <ColumnInfo>
          <Column id="CUSER" size="9" type="STRING"/>
          <Column id="GRP_NAME" size="200" type="STRING"/>
          <Column id="GRP_SEQ" size="22" type="BIGDECIMAL"/>
          <Column id="USE_YN" size="22" type="BIGDECIMAL"/>
          <Column id="UUSER" size="9" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_list_out">
        <ColumnInfo>
          <Column id="CHK" size="1" type="STRING"/>
          <Column id="GRP_NAME" size="200" type="STRING"/>
          <Column id="GRP_SEQ" size="22" type="BIGDECIMAL"/>
          <Column id="JOB_NAME" size="20" type="STRING"/>
          <Column id="SUB_JOB_NAME" size="20" type="STRING"/>
          <Column id="MU_NAME" type="STRING" size="256"/>
          <Column id="TM_NAME" size="50" type="STRING"/>
          <Column id="UPJANG" size="22" type="BIGDECIMAL"/>
          <Column id="UPJANGNM" size="50" type="STRING"/>
          <Column id="LEADER_NM" size="50" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_upjang_in">
        <ColumnInfo>
          <Column id="CUSER" size="9" type="STRING"/>
          <Column id="GRP_SEQ" size="22" type="BIGDECIMAL"/>
          <Column id="UPJANG" size="22" type="BIGDECIMAL"/>
          <Column id="UUSER" size="9" type="STRING"/>
          <Column id="OLD_GRP_SEQ" size="22" type="BIGDECIMAL"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_grp_out">
        <ColumnInfo>
          <Column id="GRP_NAME" size="200" type="STRING"/>
          <Column id="GRP_SEQ" size="22" type="BIGDECIMAL"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cbo_JOB">
        <ColumnInfo>
          <Column id="JOB_CD" size="256" type="STRING"/>
          <Column id="JOB_NAME" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cbo_SUB_JOB">
        <ColumnInfo>
          <Column id="SUB_JOB_CD" size="256" type="STRING"/>
          <Column id="SUB_JOB_NAME" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cbo_TM">
        <ColumnInfo>
          <Column id="TM_CD" size="3" type="STRING"/>
          <Column id="TM_NM" size="50" type="STRING"/>
          <Column id="MU_CD" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cbo_MU">
        <ColumnInfo>
          <Column id="MU_CD" size="255" type="STRING"/>
          <Column id="MU_NM" size="255" type="STRING"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Bind>
      <BindItem id="item5" compid="sta_detail05" propid="text" datasetid="ds_view" columnid="D_1"/>
    </Bind>
    <Script type="xscript4.0"><![CDATA[include "U_lib::lib_conversionCom.xjs";
/*
 ******************************************************************************************
 * 시스템구분   : IFIS/메뉴관리/기준정보/업장그룹관리
 * 프로그램명   : FSA00010E.XML
 * 기      능   : 업장그룹관리
 * 작  성  자   : 김동표
 * 작성  일자   : 2007-11-16
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
//@@컨버터에서 주석처리 #include "lib::sc_comon.js"
//@@컨버터에서 주석처리 #include "lib::tit_comm_0001.js"
//@@컨버터에서 주석처리 #include "lib::lib_comm_0001.js"
//@@컨버터에서 주석처리 #include "lib::sc_sql_common.js"
//@@컨버터에서 주석처리 #include "lib::fs_common.js"
 
/*
 ******************************************************************************************
 * 함  수  명   : OnLoadCompleted
 * 입      력   : obj  = Form Component
 * 반      환   : 없음
 * 기      능   : Form 최초 구동
 * 작  성  자   : 김동표
 * 작성  일자   : 2007-11-16
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function form_onload(obj:Form, e:LoadEventInfo)
{
	gfn_formOnLoad(this);

	fsp_init(this);
	fn_ComboDataLoad();
	fn_SearchGrp();
	fn_SearchGrp_Combo();
	
	cbo_mu.setFocus();
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_search
 * 반      환   : 없음
 * 기      능   : 조회
 * 작  성  자   : 김동표
 * 작성  일자   : 2007-11-16
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function fn_search()
{
	fn_SearchGrpList();
}

/*
 ******************************************************************************************
 * 함  수  명   : Common_Btn_common_OnClick
 * 입      력   : obj  = Form Component
 * 반      환   : 없음
 * 기      능   : 공통버튼 관리
 * 작  성  자   : 김동표
 * 작성  일자   : 2007-11-16
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function Common_Btn_common_OnClick(obj)
{
	switch(obj.name)
	{
		case "btn_Search":
			//fn_Search();
			break;
		case "btn_Insert":
			//fn_Insert();
			break;
		case "btn_Delete":
			//fn_Delete();
			break;
		case "btn_Save":
			//fn_Save();
			break;
		case "btn_Print":
			//fn_Print();
			break;
		case "btn_Close":
			fn_Close();
			break;
		case "btn_Help":
			fn_help();
			break;
		default:
			break;
	}
}

/*
 ******************************************************************************************
 * 함  수  명   : Common_Btn_common_OnClick
 * 입      력   : obj  = Form Component
 * 반      환   : 없음
 * 기      능   : 공통버튼 관리
 * 작  성  자   : 김동표
 * 작성  일자   : 2007-11-16
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function Press_EnterKey(obj,nChar,bShift,bCtrl,bAlt,LLParam,HLParam)
{
	if(nChar != 13) return;
	
	//alert(Components["Cbo_Dept"]);
	
	switch(obj.name)
	{
		case "Cbo_Dept":
			eval("Cbo_Job").setFocus();
			break;
		case "Cbo_Job":
			//fn_Insert();
			break;
		case "btn_Delete":
			//fn_Delete();
			break;
		case "btn_Save":
			//fn_Save();
			break;
		case "btn_Print":
			//fn_Print();
			break;
		case "btn_Close":
			fn_Close();
			break;
		case "btn_Help":
			fn_help();
			break;
		default:
			break;
	}
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_Close()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 단기 버튼 이벤트
 * 작  성  자   : 김동표
 * 작성  일자   : 2007-11-16
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function fn_Close()
{
	if(!fn_GetUpdate()) return;
	this.close();
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_Help()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 도움말 
 * 작  성  자   : 김동표
 * 작성  일자   : 2007-11-16
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function fn_help()
{
}

/*
 ******************************************************************************************
 * 함  수  명   : Form_Btn_OnClick
 * 입      력   : obj  = Form Component
 * 반      환   : 없음
 * 기      능   : Form버튼 관리
 * 작  성  자   : 김동표
 * 작성  일자   : 2007-11-16
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function Form_Btn_OnClick(obj:Button, e:ClickEventInfo)
{
	switch(obj.name)
	{
		case "btn_AddGrp":
			fn_AddGrp();
			break;
		case "btn_SaveGrp":
			fn_SaveGrp();
			break;
		case "btn_DeleteGrp":
			fn_DeleteGrp();
			break;
		case "btn_SetUpjangGrp":
			fn_SetUpjangGrp();
			break;
		default:
			break;
	}
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_AddGrp()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 그룹추가 
 * 작  성  자   : 김동표
 * 작성  일자   : 2007-11-16
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function fn_AddGrp()
{
	
	if( ds_out.rowcount > 0 && 
	    gfn_length(gfn_trim(ds_out.getColumn(GetLastRow(ds_out)     , "GRP_NAME")))== 0 )
	{
		g_Message("EE", "마지막 줄의 그룹명 입력이 완료되지 않았습니다.");
		this.grd_GrpMng.setCellPos(1);
		this.grd_GrpMng.setFocus();			
		return;
	}
	
	ds_out.addRow();
	ds_out.setColumn(GetLastRow(ds_out)     , "USE_YN", 1);
	ds_out.setColumn(GetLastRow(ds_out)     , "CUSER", g_EmpNo);
	ds_out.setColumn(GetLastRow(ds_out)     , "UUSER", g_EmpNo);
	
	this.grd_GrpMng.setCellPos(1);
	this.grd_GrpMng.setFocus();	
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_SaveGrp()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 데이터 저장
 * 작  성  자   : 김동표
 * 작성  일자   : 2007-11-16
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function fn_SaveGrp()
{
	if(ds_out.findRowExpr("gfn_length(gfn_trim(GRP_NAME))== 0") != -1)
	{
		g_Message("EE", "그룹명은 반드시 입력해야 합니다.");
		return;
	}
	fn_SaveGrpData();
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_SaveGrpData()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 그룹데이터저장
 * 작  성  자   : 김동표
 * 작성  일자   : 2007-11-16
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function fn_SaveGrpData()
{
	fsp_clear(this);	
	
	fsp_addSave(this
        , "fs/fsa:FSA00010E_I001"
        , "fs/fsa:FSA00010E_U001"
        , "fs/fsa:FSA00010E_D001"
        , ""
        , ""
        , ""
        , ""
        );

	// 서버 호출 
	fsp_callService(this, "", "", "ds_in=ds_out:U", "ds_out=ds_out", "", "fn_CallBack");
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_DeleteGrp()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 그룹삭제
 * 작  성  자   : 김동표
 * 작성  일자   : 2007-11-16
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function fn_DeleteGrp()
{
	if(g_Confirm("02", "선택된 그룹과 연결된 업장의 맵핑정보도 함께 삭제합니다. 계속하시겠습니까?") == false) return;
	
	ds_out.deleteRow(ds_out.rowposition);
	
	fsp_clear(this);
		
	fsp_addSave(this
        , ""
        , ""
        , "fs/fsa:FSA00010E_D001"
        , ""
        , ""
        , ""
        , ""
        );
        
	fsp_addSave(this
        , ""
        , ""
        , "fs/fsa:FSA00010E_D003"
        , ""
        , ""
        , ""
        , ""
        );        

	// 서버 호출 
	fsp_callService(this, "", "", "ds_in=ds_out:U ds_upjang_in=ds_out:U", "ds_out=ds_out", "", "fn_CallBack_Grp");
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_SearchGrpList()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 업장별 그룹 조회 
 * 작  성  자   : 김동표
 * 작성  일자   : 2007-11-16
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function fn_SearchGrpList()
{
	if(!fn_GetUpdate()) return;
	
	/*
	ds_list_in.ClearData();
	if(cbo_Grp.Value != "0" && cbo_Grp.Value != "")
	{
		ds_list_in.AddRow();
		ds_list_in.SetColumn(ds_list_in.lastrow, "GRP_SEQ", cbo_Grp.Value);
	}
	*/
	
	var dsObj;
	
	create("Dataset", "ds_list_in");
	
	dsObj = eval("ds_list_in");
	
	dsObj.addColumn("GRP_SEQ", "BIGDECIMAL", 22);
	dsObj.addColumn("MU_CD", "String", 20);
	dsObj.addColumn("TM_CD", "String", 20);
	dsObj.addColumn("JOB_CD", "String", 20);
	dsObj.addColumn("SUB_JOB_CD", "String", 20);
	dsObj.addColumn("UPJANG", "BIGDECIMAL", 6);
	dsObj.addColumn("LEADER", "String", 20);
	dsObj.addColumn("DISABLE", "String", 20);
	
	dsObj.addRow();
	
	
	if(cbo_Grp.value != "0" && cbo_Grp.value != "")
		dsObj.setColumn(0,"GRP_SEQ", cbo_Grp.value); 

	dsObj.setColumn(0,"MU_CD", cbo_mu.getMuCode() );
    dsObj.setColumn(0,"TM_CD", edt_tm.getTmCode() );
    dsObj.setColumn(0,"JOB_CD", Cbo_Job.value);
    dsObj.setColumn(0,"SUB_JOB_CD", Cbo_JobSub.value);
    
	if(edt_upjang.getUpjangCode() != "")
		dsObj.setColumn(0,"UPJANG", edt_upjang.getUpjangCode()); 
		
	if(ed_Leader.value != "")
		dsObj.setColumn(0,"LEADER", ed_Leader.userdata); 
		
	if(chk_Disable.value == "Y")	
		dsObj.setColumn(0,"DISABLE", "Y");
		
	fsp_clear(this);	
	fsp_addSearch(this, "fs/fsa:FSA00010E_S002");
	
	fsp_callService(this
					,""
					, ""
					, "ds_list_in=ds_list_in"
					, "ds_list_out=ds_list_out"
					, ""
					, "fn_grplist_search()"
					, ""
					, ""
					, true);	
					
	Destroy("ds_list_in");						
						
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_SetUpjangGrp()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 선택 업장 그룹 적용
 * 작  성  자   : 김동표
 * 작성  일자   : 2007-11-16
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function fn_SetUpjangGrp()
{
	if(!fn_GetUpdate()) return;
	
	if(gfn_isNull(cbo_AddGrp.value) || cbo_AddGrp.value == 0)
	{
		ds_list_out.filter("CHK == 1 && gfn_length(gfn_trim(GRP_NAME))!= 0");
		fn_DelUpjangGrp();
	}
	else
	{
		//ds_list_out.Filter("CHK == 1 && length(trim(GRP_NAME)) == 0");
		ds_list_out.filter("CHK == 1");
		
		if(ds_list_out.findRowExpr("GRP_SEQ!=") != -1)
		{
			if(g_Confirm("02", "선택한 업장 중 이미 그룹에 포함된 업장도 [적용그룹]으로 변경됩니다. \r\n계속하시겠습니까?") == false) return;
		}
		
		fn_AddUpjangGrp();
	}
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_AddUpjangGrp()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 선택 업장 그룹 적용
 * 작  성  자   : 김동표
 * 작성  일자   : 2007-11-16
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function fn_AddUpjangGrp()
{
	ds_upjang_in.updatecontrol = false;
	
	for(var i = 0; i < ds_list_out.rowcount; i++)
	{
		ds_upjang_in.addRow();
		
		if( gfn_length(gfn_trim(ds_list_out.getColumn(i,"GRP_SEQ")))> 0)
			SetRowType(ds_upjang_in,i,"update");
		else
			SetRowType(ds_upjang_in,i,"insert");
		ds_upjang_in.setColumn(GetLastRow(ds_upjang_in)     , "GRP_SEQ", cbo_AddGrp.value);
		ds_upjang_in.setColumn(GetLastRow(ds_upjang_in)     , "UPJANG", ds_list_out.getColumn(i,"UPJANG"));
		ds_upjang_in.setColumn(GetLastRow(ds_upjang_in)     , "CUSER", g_EmpNo);
		ds_upjang_in.setColumn(GetLastRow(ds_upjang_in)     , "UUSER", g_EmpNo);
		ds_upjang_in.setColumn(GetLastRow(ds_upjang_in)     , "OLD_GRP_SEQ", ds_list_out.getColumn(i,"GRP_SEQ"));
	}

	//alert(ds_upjang_in.SaveXML());	
		
	fsp_clear(this);	
	
	fsp_addSave(this
        , "fs/fsa:FSA00010E_I002"
        , "fs/fsa:FSA00010E_U002"
        , ""
        , ""
        , ""
        , ""
        , ""
        );
        	
	http.Sync = true;
	// 서버 호출 
	fsp_callService(this, "", "", "ds_upjang_in=ds_upjang_in:U", "ds_upjang_out=ds_upjang_in", "", "fn_CallBack_Upjang");
	http.Sync = false;
	
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_DelUpjangGrp()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 선택 업장 그룹 삭제
 * 작  성  자   : 김동표
 * 작성  일자   : 2007-11-16
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function fn_DelUpjangGrp()
{
	ds_upjang_in.updatecontrol = false;
	
	for(var i = 0; i < ds_list_out.rowcount; i++)
	{
		ds_upjang_in.addRow();
		SetRowType(ds_upjang_in,i,"delete");
		ds_upjang_in.setColumn(GetLastRow(ds_upjang_in)     , "GRP_SEQ", ds_list_out.getColumn(i,"GRP_SEQ"));
		ds_upjang_in.setColumn(GetLastRow(ds_upjang_in)     , "UPJANG", ds_list_out.getColumn(i,"UPJANG"));
		ds_upjang_in.setColumn(GetLastRow(ds_upjang_in)     , "CUSER", g_EmpNo);
		ds_upjang_in.setColumn(GetLastRow(ds_upjang_in)     , "UUSER", g_EmpNo);
	}

	//alert(ds_upjang_in.SaveXML());	
		
	fsp_clear(this);	
	
	/*
	tit_addSingleActionInfo(this
		, "fs/fsa:FSA00010E_D002"
		, ""
		, ""
		, "");
	*/	
	fsp_addSave(this
        , ""
        , ""
        , "fs/fsa:FSA00010E_D002"
        , ""
        , ""
        , ""
        , ""
        );		
        	
	// 서버 호출 
	fsp_callService(this, "", "", "ds_upjang_in=ds_upjang_in:A", "ds_upjang_out=ds_upjang_in", "", "fn_CallBack_Upjang");

}

/*
 ******************************************************************************************
 * 함  수  명   : fn_SearchGrp()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 그룹 조회
 * 작  성  자   : 김동표
 * 작성  일자   : 2007-11-19
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function fn_SearchGrp()
{
	fsp_clear(this);	
	
	fsp_addSearch(this, "fs/fsa:FSA00010E_S001");
	
	fsp_callService(this
					,""
					, ""
					, "ds_in=ds_out"
					, "ds_out=ds_out"
					, ""
					, "");		
	//alert(ds_out.SaveXML());
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_SearchGrp_Combo()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 그룹 조회
 * 작  성  자   : 김동표
 * 작성  일자   : 2007-11-19
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function fn_SearchGrp_Combo()
{
	fsp_clear(this);	
	
	fsp_addSearch(this, "fs/fsa:FSA00010E_S003");
	
	fsp_callService(this
					,""
					, ""
					, "ds_grp_in=ds_grp_out"
					, "ds_grp_out=ds_grp_out"
					, ""
					, "");		
}


/*
 ******************************************************************************************
 * 함  수  명   : fn_CallBack()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : CallBack 함수
 * 작  성  자   : 김동표
 * 작성  일자   : 2007-11-19
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function fn_CallBack(errCode, errMsg)
{
	ds_out.applyChange();
	fn_SearchGrp();
	fn_SearchGrp_Combo();
	if(ds_list_out.rowcount > 0)
		fn_SearchGrpList();
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_CallBack_Grp()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : CallBack 함수
 * 작  성  자   : 김동표
 * 작성  일자   : 2007-11-19
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function fn_CallBack_Grp(errCode, errMsg)
{
	ds_out.applyChange();
	//fn_SearchGrp();
	fn_SearchGrp_Combo();
	fn_SearchGrpList();
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_CallBack_Upjang()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : CallBack 함수
 * 작  성  자   : 김동표
 * 작성  일자   : 2007-11-19
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function fn_CallBack_Upjang(errCode, errMsg)
{
	ds_upjang_in.applyChange();
	ds_upjang_in.clearData();
	ds_list_out.filter("");	
	http.Sync = true;
	fn_SearchGrpList();
	http.Sync = false;
	
	
	var intRow = ds_list_out.findRowExpr("GRP_SEQ=" + cbo_AddGrp.value);
	if(intRow > 0) ds_list_out.rowposition = intRow;
		
}

function fn_grplist_search(errCode, errMsg) {
	grd_GrpList.setFocus();
}

function fn_GetUpdate()
{
	if(gfn_dsIsUpdated(ds_out)== true) 
	{
		if(!g_Confirm("02", "그룹추가 후 저장되지 않은 데이터가 있습니다.\n무시하고 현재 작업을 하시려면 [확인]을 누르세요.")) 
		{
			return false;
		}
		else
		{
			return true;
		}
	}
	else 
		return true;
}

/*
 ******************************************************************************************
 * 함  수  명   : ds_out_OnColumnChanged()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 컬럼의 데이터 변경시 업데이트 사용자 변경
 * 작  성  자   : 김동표
 * 작성  일자   : 2007-11-19
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function ds_out_OnColumnChanged(obj:Dataset, e:DSColChangeEventInfo)
{
	fn_CheckGrp(e.row);
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_CheckGrp()
 * 입      력   : 없음
 * 반      환   : true/false
 * 기      능   : 그룹명 중복 체크
 * 작  성  자   : 김동표
 * 작성  일자   : 2007-11-19
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
 function fn_CheckGrp(nRow)
 {
	var js_srcGrpName = ds_out.getColumn(nRow,"GRP_NAME");
	var js_cmpGrpName = "";

	ds_out.setColumn(nRow, "UUSER", g_EmpNo);	
		
	for(var i = 0; i < ds_out.getRowCount(); i++)
	{
		if(i != nRow)
		{
			js_cmpGrpName = ds_out.getColumn(i,"GRP_NAME");
			if(js_srcGrpName == js_cmpGrpName){ 
				g_Message("EE", "입력하신 그룹명은 이미 사용중입니다.");
				ds_out.setColumn(nRow, "GRP_NAME", "");
				return;
			}
		}
	}
 }


/*
 ******************************************************************************************
 * 함  수  명   : fn_cbo_AddGrp()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : cbo_AddGrp 데이터 조회
 * 작  성  자   : 김동표
 * 작성  일자   : 2007-11-19
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function fn_cbo_AddGrp()
{
	fsp_clear(this);	
	
	fsp_addSearch(this, "fs/fsa:FSA00010E_S002");
	
	fsp_callService(this
					,""
					, ""
					, "ds_grp_in=ds_grp_out"
					, "ds_grp_out=ds_grp_out"
					, ""
					, "");		
}

/*
 ******************************************************************************************
 * 함  수  명   : grd_OnHeadClick()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 업장선택
 * 작  성  자   : 김동표
 * 작성  일자   : 2007-11-21
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */


/*
 ******************************************************************************************
 * 함  수  명   : fn_ComboDataLoad()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 콤보 데이터 로드
 * 작  성  자   : 김동표
 * 작성  일자   : 2007-11-22
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function fn_ComboDataLoad()
{
	edt_tm.applyAuthLevel(cbo_mu);
	edt_upjang.applyAuthLevel(edt_tm);

	/*****************************************************************************************
      * 기      능   :  콤보초기화
    /*****************************************************************************************/
	// action 정보 초기화 
	fsp_clear(this);
   	
    // 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "fs/fsc:FSC_JOB_S001");		// 직군	
	
	// 서버 호출 
	fsp_callService(this
					, ""
					, ""
					, ""
					, "ds_cbo_JOB=ds_list" 
					, "BLANK=Y"
					, ""
					, ""
					, true
					, ""
					);	
}



function Cbo_Job_OnChanged(obj:Combo, e:ItemChangeEventInfo)
{
			// 임시 데이터셋 생성
	var dsObj;
		
	create("Dataset", "ds_where");
	
	dsObj = eval("ds_where");
	dsObj.addColumn("JOB_CD", "STRING", 100);
	dsObj.addRow();
    dsObj.setColumn(0,"JOB_CD", e.postvalue);
    
    // action 정보 초기화 
	fsp_clear(this);
	
    // 자재 대분류 조회  
	fsp_addSearch(this, "fs/fsc:FSC_JOB_SUB_S001");
	
	// 서버 호출 
	fsp_callService(this
					, ""
					, ""
					, "ds_cond=ds_where"
					, "ds_cbo_SUB_JOB=ds_list" 
					, "BLANK=Y"
					, ""
					, ""
					, true
					, ""
					);		
	
	Cbo_JobSub.index = 0;
	
	// 임시 데이터셋 삭제 
	Destroy("ds_where");	
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_UpjangPopup
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 업장조회 팝업
 * 작  성  자   : 김동표
 * 작성  일자   : 2007-11-28
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function fn_LeaderPopup()
{
	var strQuery_Leader	            	= " SELECT DISTINCT LEADER_SABUN, B.NM_KOR FROM SCO_UPJANG_MST_V A, HLDC_HR_PERSONAL B WHERE A.SAUP_TYPE < '004' AND A.LEADER_SABUN = B.SABUN ";
	var strQuery_LeaderKeyField      	= "LEADER_SABUN";
	var strQuery_LeaderValueField    	= "NM_KOR";
	var strQuery_LeaderKeyFieldNM    	= "리더사번";
	var strQuery_LeaderValueFieldNM  	= "리더명"; 
	var strQuery_LeaderCaption       	= "리더정보조회";
	var strQuery_LeaderAllField      	= "LEADER_SABUN;NM_KOR";

	fn_sql_common_setup( strQuery_Leader
						,strQuery_LeaderKeyField
						,strQuery_LeaderValueField
						,strQuery_LeaderKeyFieldNM
						,strQuery_LeaderValueFieldNM
						,""
						,ed_Leader.value
						,""
						,strQuery_LeaderCaption
						,strQuery_LeaderAllField
						);
						
	ed_Leader.value = gds_sql_common.getColumn(0, "ret_name");
	ed_Leader.userdata = gds_sql_common.getColumn(0, "ret_code");
}

function ed_Leader_OnKeyDown(obj:Edit, e:KeyEventInfo)
{
	if(e.keycode == 13) fn_LeaderPopup();	
	if(e.keycode == 46) { ed_Leader.value = ""; ed_Leader.userdata = ""; }	
}

function btn_Leader_OnClick(obj:Button, e:ClickEventInfo)
{
	fn_LeaderPopup();
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_muChange(obj, event)
 * 기ㅡㅡㅡ능 : 사업부 변경시 운영부서, 사업장 초기화
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-03-27
 ******************************************************************************************/
function fn_muChange(obj, event)
{
	edt_tm.setTmCode("");
	edt_upjang.setUpjangCode("");
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_tmChange(obj, data)
 * 기ㅡㅡㅡ능 : 운영부서 변경시 사업장 초기화
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-03-27
 ******************************************************************************************/
function fn_tmChange(obj, data)
{
	edt_upjang.setUpjangCode("");
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : cbo_Grp_onkeydown(obj:Combo, e:KeyEventInfo)
 * 기ㅡㅡㅡ능 : 엔터키 조회처리
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-03-27
 ******************************************************************************************/
function cbo_Grp_onkeydown(obj:Combo, e:KeyEventInfo)
{
	if(e.keycode == 13) {
		fn_search();
		grd_GrpList.setFocus();
	}
}
]]></Script>
  </Form>
</FDL>
