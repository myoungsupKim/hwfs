<?xml version="1.0" encoding="euc-kr"?>
<query dynamic="true">
	<type>select</type>
	<description><![CDATA[]]></description>
	<reload>true</reload>
	<monitoring>true</monitoring>
	<result-count>1</result-count>
	<statement>

<!-- FC본사 -->
<isEqual col = "MU_CD" value = "2001">
SELECT MU_CD,
       MU_NM,
       (SELECT ORG_LEVEL_NM3 FROM SCC_CC WHERE ORG_LEVEL_CD3 = SUBSTR(TM_CD,1,3) AND ROWNUM = 1) BU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM,
       (SELECT DECODE( COUNT(UPJANG_CD), 0 ,'Y', 'N') FROM SLA_UPJANG_SALS_DAY WHERE UPJANG_CD = A.UPJANG  AND FROM_DT <![CDATA[<=]]> #END_DATE# AND TO_DT <![CDATA[>=]]> #END_DATE#) AS SALE_YN,
       NEW_GUBUN,
       DAY_AMT4           AS DAY_AMT4,
       DAY_TOT_AMT4       AS DAY_TOT_AMT4,
       PLAN_MON_AMT     AS PLAN_MON_AMT
  FROM (
SELECT MU_CD,
       MU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM,
       (SELECT CASE WHEN OPEN_DATE IS NULL THEN '미지정'
                    WHEN SUBSTR(OPEN_DATE,1,4) = SUBSTR(#END_DATE#,1,4) THEN '신규'
               ELSE '기존' END
          FROM SCO_UPJANG_MST_V
         WHERE UPJANG = T1.UPJANG) NEW_GUBUN,
       ROUND(SUM(DAY_AMT4)/1000)         AS DAY_AMT4,
       ROUND(SUM(DAY_TOT_AMT4)/1000)     AS DAY_TOT_AMT4,
       ROUND(SUM(PLAN_MON_AMT)/1000)     AS PLAN_MON_AMT
  FROM (
/* 당일계획/당일누계계획/당월계획 */
SELECT MU_CD,
       MU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM,
       0 DAY_AMT4,      --당일_당일실적
       0 DAY_TOT_AMT4,  --당일누계_당일실적
       PLAN_MON_AMT PLAN_MON_AMT  --당월_계획
  FROM (
SELECT MU_CD,
       MAX(MU_NM) AS MU_NM,
       TM_CD,
       MAX(TM_NM) AS TM_NM,
       UPJANG,
       MAX(UPJANGNM) AS UPJANGNM,
       SUM(PLAN_MON_AMT) PLAN_MON_AMT        --당월
  FROM (
SELECT T2.MU_CD,
       T2.MU_NM,
       T2.TM_CD,
       T2.TM_NM,
       TO_CHAR(T2.UPJANG) UPJANG,
       T2.UPJANGNM,
       SUM( CASE WHEN SUBSTR(#END_DATE#,5,2) = '01' THEN MM_AMT_01
                  WHEN SUBSTR(#END_DATE#,5,2) = '02' THEN MM_AMT_02
                  WHEN SUBSTR(#END_DATE#,5,2) = '03' THEN MM_AMT_03
                  WHEN SUBSTR(#END_DATE#,5,2) = '04' THEN MM_AMT_04
                  WHEN SUBSTR(#END_DATE#,5,2) = '05' THEN MM_AMT_05
                  WHEN SUBSTR(#END_DATE#,5,2) = '06' THEN MM_AMT_06
                  WHEN SUBSTR(#END_DATE#,5,2) = '07' THEN MM_AMT_07
                  WHEN SUBSTR(#END_DATE#,5,2) = '08' THEN MM_AMT_08
                  WHEN SUBSTR(#END_DATE#,5,2) = '09' THEN MM_AMT_09
                  WHEN SUBSTR(#END_DATE#,5,2) = '10' THEN MM_AMT_10
                  WHEN SUBSTR(#END_DATE#,5,2) = '11' THEN MM_AMT_11
                  WHEN SUBSTR(#END_DATE#,5,2) = '12' THEN MM_AMT_12
             ELSE 0
             END ) AS PLAN_MON_AMT
  FROM MAP_BPC_CONFIRM_PL_INFO T1
      ,SCO_UPJANG_MST_V T2
  WHERE T1.PLAN_CLASS = 'AP'
    AND T1.PLAN_YEAR = SUBSTR(#END_DATE#,1,4)
    AND T1.VER_CD =
        (SELECT MAX(VER_CD)
           FROM MAP_BPC_CONFIRM_PL_INFO
          WHERE PLAN_CLASS = 'AP'
            AND PLAN_YEAR = SUBSTR(#END_DATE#,1,4))
    AND T1.CC_CD = T2.CC_CD(+)
    AND T2.MU_CD(+) = #MU_CD#
    AND T2.TM_CD(+) LIKE #TM_CD#||'%'
    AND T2.UPJANG LIKE #UPJANG#||'%'
    AND T2.CC_CD NOT IN ('317770','317780','317840','315920','318760')
    AND EXISTS (SELECT 'x'
                  FROM MAS_ST_ACCOUNT
                 WHERE ACCTCD = T1.ACCT_CD
                   AND ACCTNM2 = '매출액')
GROUP BY T2.MU_CD, T2.MU_NM, T2.TM_CD, T2.TM_NM, T2.UPJANG, T2.UPJANGNM
) GROUP BY MU_CD, TM_CD, UPJANG
)
UNION ALL
/* 당일실적/당일누계실적 */
SELECT T3.MU_CD,
       T3.MU_NM,
       T3.TM_CD,
       T3.TM_NM,
       TO_CHAR(T3.UPJANG),
       T3.UPJANGNM,
       NVL(SUM(CASE WHEN B.OCCUR_DATE = #END_DATE# THEN B.NET_AMT ELSE 0 END), 0) NET_AMT,
       NVL(SUM(CASE WHEN B.OCCUR_DATE BETWEEN #START_DATE# AND #END_DATE# THEN B.NET_AMT ELSE 0 END), 0) TOT_AMT,
       0
    FROM SLA_IF_UPJANG_SALS_MST A
       , SLA_IF_UPJANG_SALS_DETAIL B
       , SLA_IF_UPJANG_PAYMENT C
       , SLA_IF_CARD_APPRV_INFO D
       , SCO_UPJANG_MST_V T3
  WHERE A.RECD_STATUS = 'L'
    AND B.RECD_STATUS = 'L'
    AND C.RECD_STATUS = 'L'
    AND A.OCCUR_DATE = B.OCCUR_DATE
    AND A.SYS_CLASS = B.SYS_CLASS
    AND A.UPJANG_CD = B.UPJANG_CD
    AND A.RECEIPT_NUM = B.RECEIPT_NUM
    AND A.OCCUR_DATE = C.OCCUR_DATE
    AND A.SYS_CLASS = C.SYS_CLASS
    AND A.UPJANG_CD = C.UPJANG_CD
    AND A.RECEIPT_NUM = C.RECEIPT_NUM
    AND B.SEQ = C.SEQ  --선수금 수
    AND C.OCCUR_DATE = D.OCCUR_DATE(+)
    AND C.SYS_CLASS = D.SYS_CLASS(+)
    AND C.UPJANG_CD = D.UPJANG_CD(+)
  	AND C.RECEIPT_NUM = D.RECEIPT_NUM(+)
    AND C.SEQ = D.SEQ(+)
    AND A.UPJANG_CD = T3.UPJANG
   AND A.OCCUR_DATE BETWEEN #START_DATE# AND #END_DATE#
   AND T3.UPJANG NOT IN (SELECT Z.CODE FROM SCC_COMMON_CODE Z WHERE Z.GROUP_CODE = 'MA0048' AND Z.USE_YN = 'Y')
   AND T3.MU_CD = #MU_CD#
   AND T3.TM_CD LIKE #TM_CD#||'%'
   AND T3.UPJANG LIKE #UPJANG#||'%'
   AND T3.CC_CD NOT IN ('317770','317780','317840','315920','318760')
GROUP BY T3.MU_CD,T3.MU_NM,T3.TM_CD,T3.TM_NM,T3.UPJANG,T3.UPJANGNM
) T1
GROUP BY MU_CD,
       MU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM) A
</isEqual>
<!-- FS사업부 -->
<isEqual col = "MU_CD" value = "2002">
SELECT MU_CD,
       MU_NM,
       (SELECT ORG_LEVEL_NM3 FROM SCC_CC WHERE ORG_LEVEL_CD3 = SUBSTR(TM_CD,1,3) AND ROWNUM = 1) BU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM,
       (SELECT DECODE( COUNT(UPJANG_CD), 0 ,'Y', 'N') FROM SLA_UPJANG_SALS_DAY WHERE UPJANG_CD = A.UPJANG  AND FROM_DT <![CDATA[<=]]> #END_DATE# AND TO_DT <![CDATA[>=]]> #END_DATE#) AS SALE_YN,
       NEW_GUBUN,
       DAY_AMT4           AS DAY_AMT4,
       DAY_TOT_AMT4       AS DAY_TOT_AMT4,
       PLAN_MON_AMT     AS PLAN_MON_AMT
  FROM (
SELECT MU_CD,
       MU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM,
       (SELECT CASE WHEN OPEN_DATE IS NULL THEN '미지정'
                    WHEN SUBSTR(OPEN_DATE,1,4) = SUBSTR(#END_DATE#,1,4) THEN '신규'
               ELSE '기존' END
          FROM SCO_UPJANG_MST_V
         WHERE UPJANG = T1.UPJANG) NEW_GUBUN,
       ROUND(SUM(DAY_AMT4)/1000)         AS DAY_AMT4,
       ROUND(SUM(DAY_TOT_AMT4)/1000)     AS DAY_TOT_AMT4,
       ROUND(SUM(PLAN_MON_AMT)/1000)     AS PLAN_MON_AMT
  FROM (
/* 당일계획/당일누계계획/당월계획 */
SELECT MU_CD,
       MU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM,
       0 DAY_AMT4,      --당일_당일실적
       0 DAY_TOT_AMT4,  --당일누계_당일실적
       PLAN_MON_AMT PLAN_MON_AMT  --당월_계획
  FROM (
SELECT MU_CD,
       MAX(MU_NM) AS MU_NM,
       TM_CD,
       MAX(TM_NM) AS TM_NM,
       UPJANG,
       MAX(UPJANGNM) AS UPJANGNM,
       SUM(PLAN_MON_AMT) PLAN_MON_AMT        --당월
  FROM (
SELECT T2.MU_CD,
       T2.MU_NM,
       T2.TM_CD,
       T2.TM_NM,
       TO_CHAR(T2.UPJANG) UPJANG,
       T2.UPJANGNM,
       SUM( CASE WHEN SUBSTR(#END_DATE#,5,2) = '01' THEN MM_AMT_01
                  WHEN SUBSTR(#END_DATE#,5,2) = '02' THEN MM_AMT_02
                  WHEN SUBSTR(#END_DATE#,5,2) = '03' THEN MM_AMT_03
                  WHEN SUBSTR(#END_DATE#,5,2) = '04' THEN MM_AMT_04
                  WHEN SUBSTR(#END_DATE#,5,2) = '05' THEN MM_AMT_05
                  WHEN SUBSTR(#END_DATE#,5,2) = '06' THEN MM_AMT_06
                  WHEN SUBSTR(#END_DATE#,5,2) = '07' THEN MM_AMT_07
                  WHEN SUBSTR(#END_DATE#,5,2) = '08' THEN MM_AMT_08
                  WHEN SUBSTR(#END_DATE#,5,2) = '09' THEN MM_AMT_09
                  WHEN SUBSTR(#END_DATE#,5,2) = '10' THEN MM_AMT_10
                  WHEN SUBSTR(#END_DATE#,5,2) = '11' THEN MM_AMT_11
                  WHEN SUBSTR(#END_DATE#,5,2) = '12' THEN MM_AMT_12
             ELSE 0
             END ) AS PLAN_MON_AMT
  FROM MAP_BPC_CONFIRM_PL_INFO T1
      ,SCO_UPJANG_MST_V T2
  WHERE T1.PLAN_CLASS = 'AP'
    AND T1.PLAN_YEAR = SUBSTR(#END_DATE#,1,4)
    AND T1.VER_CD =
        (SELECT MAX(VER_CD)
           FROM MAP_BPC_CONFIRM_PL_INFO
          WHERE PLAN_CLASS = 'AP'
            AND PLAN_YEAR = SUBSTR(#END_DATE#,1,4))
    AND T1.CC_CD = T2.CC_CD(+)
    AND T2.MU_CD(+) = #MU_CD#
    AND T2.TM_CD(+) LIKE #TM_CD#||'%'
    AND T2.UPJANG LIKE #UPJANG#||'%'
    AND T2.CC_CD NOT IN ('317770','317780','317840','315920','318760')
    AND EXISTS (SELECT 'x'
                  FROM MAS_ST_ACCOUNT
                 WHERE ACCTCD = T1.ACCT_CD
                   AND ACCTNM2 = '매출액')
GROUP BY T2.MU_CD, T2.MU_NM, T2.TM_CD, T2.TM_NM, T2.UPJANG, T2.UPJANGNM
) GROUP BY MU_CD, TM_CD, UPJANG
)
UNION ALL
/* 당일실적/당일누계실적 */
SELECT T3.MU_CD,
       T3.MU_NM,
       T3.TM_CD,
       T3.TM_NM,
       TO_CHAR(T3.UPJANG),
       T3.UPJANGNM,
       NVL(SUM(CASE WHEN T2.OCCUR_DATE = #END_DATE# THEN CASE WHEN SALS_CLASS IN ('1103','1104','1603','2001','2002','1108','1109') THEN T2.NET_AMT ELSE 0 END ELSE 0 END), 0) +
       NVL(SUM(CASE WHEN T2.OCCUR_DATE = #END_DATE# THEN CASE WHEN SALS_CLASS IN ('1101','1102','1602','1701','2004','1110','1111') THEN T2.NET_AMT ELSE 0 END ELSE 0 END), 0) +
       NVL(SUM(CASE WHEN T2.OCCUR_DATE = #END_DATE# THEN CASE WHEN SALS_CLASS IN ('1105','1106','1901','2003','1112','1113','1114','1901') THEN T2.NET_AMT ELSE 0 END ELSE 0 END), 0) NET_AMT,
       NVL(SUM(CASE WHEN T2.OCCUR_DATE BETWEEN #START_DATE# AND #END_DATE# THEN CASE WHEN SALS_CLASS IN ('1103','1104','1603','2001','2002','1108','1109') THEN T2.NET_AMT ELSE 0 END ELSE 0 END), 0) +
       NVL(SUM(CASE WHEN T2.OCCUR_DATE BETWEEN #START_DATE# AND #END_DATE# THEN CASE WHEN SALS_CLASS IN ('1101','1102','1602','1701','2004','1110','1111') THEN T2.NET_AMT ELSE 0 END ELSE 0 END), 0) +
       NVL(SUM(CASE WHEN T2.OCCUR_DATE BETWEEN #START_DATE# AND #END_DATE# THEN CASE WHEN SALS_CLASS IN ('1105','1106','1901','2003','1112','1113','1114','1901') THEN T2.NET_AMT ELSE 0 END ELSE 0 END), 0) TOT_AMT,
       0
  FROM SLA_IF_UPJANG_SALS_MST T1,
       SLA_IF_UPJANG_SALS_DETAIL T2,
       SCO_UPJANG_MST_V T3
 WHERE T1.OCCUR_DATE = T2.OCCUR_DATE
   AND T1.SYS_CLASS = T2.SYS_CLASS
   AND T1.UPJANG_CD = T2.UPJANG_CD
   AND T1.UPJANG_CD = T3.UPJANG
   AND T1.RECEIPT_NUM =T2.RECEIPT_NUM
   AND T2.SYS_CLASS IN (11,16,17,19,20)
   AND T2.DDDD_CLOSE_YN = 'Y'
   AND T2.OCCUR_DATE BETWEEN #START_DATE# AND #END_DATE#
   AND T3.UPJANG NOT IN (SELECT Z.CODE FROM SCC_COMMON_CODE Z WHERE Z.GROUP_CODE = 'MA0048' AND Z.USE_YN = 'Y')
   AND T3.MU_CD = #MU_CD#
   AND T3.TM_CD LIKE #TM_CD#||'%'
   AND T3.UPJANG LIKE #UPJANG#||'%'
   AND T3.CC_CD NOT IN ('317770','317780','317840','315920','318760')
GROUP BY T3.MU_CD,T3.MU_NM,T3.TM_CD,T3.TM_NM,T3.UPJANG,T3.UPJANGNM
) T1
GROUP BY MU_CD,
       MU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM) A
</isEqual>
<!-- 외식사업부 -->
<isEqual col = "MU_CD" value = "2003">
SELECT MU_CD,
       MU_NM,
       (SELECT ORG_LEVEL_NM3 FROM SCC_CC WHERE ORG_LEVEL_CD3 = SUBSTR(TM_CD,1,3) AND ROWNUM = 1) BU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM,
       (SELECT DECODE( COUNT(UPJANG_CD), 0 ,'Y', 'N') FROM SLA_UPJANG_SALS_DAY WHERE UPJANG_CD = A.UPJANG  AND FROM_DT <![CDATA[<=]]> #END_DATE# AND TO_DT <![CDATA[>=]]> #END_DATE#) AS SALE_YN,
       NEW_GUBUN,
       DAY_AMT4           AS DAY_AMT4,
       DAY_TOT_AMT4       AS DAY_TOT_AMT4,
       PLAN_MON_AMT     AS PLAN_MON_AMT
  FROM (
SELECT MU_CD,
       MU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM,
       (SELECT CASE WHEN OPEN_DATE IS NULL THEN '미지정'
                    WHEN SUBSTR(OPEN_DATE,1,4) = SUBSTR(#END_DATE#,1,4) THEN '신규'
               ELSE '기존' END
          FROM SCO_UPJANG_MST_V
         WHERE UPJANG = T1.UPJANG) NEW_GUBUN,
       ROUND(SUM(DAY_AMT4)/1000)         AS DAY_AMT4,
       ROUND(SUM(DAY_TOT_AMT4)/1000)     AS DAY_TOT_AMT4,
       ROUND(SUM(PLAN_MON_AMT)/1000)     AS PLAN_MON_AMT
  FROM (
/* 당일계획/당일누계계획/당월계획 */
SELECT MU_CD,
       MU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM,
       0 DAY_AMT4,      --당일_당일실적
       0 DAY_TOT_AMT4,  --당일누계_당일실적
       PLAN_MON_AMT PLAN_MON_AMT  --당월_계획
  FROM (
SELECT MU_CD,
       MAX(MU_NM) AS MU_NM,
       TM_CD,
       MAX(TM_NM) AS TM_NM,
       UPJANG,
       MAX(UPJANGNM) AS UPJANGNM,
       SUM(PLAN_MON_AMT) PLAN_MON_AMT        --당월
  FROM (
SELECT MU_CD,
       MU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM,
       MM_AMT PLAN_MON_AMT
  FROM DAY_PLAN_V_3PRIORITY
 WHERE YY = SUBSTR(#END_DATE#,1,4)
   AND START_DD = SUBSTR(#END_DATE#,1,6)||'01'
   AND MU_CD = #MU_CD#
   AND TM_CD LIKE #TM_CD#||'%'
   AND UPJANG LIKE #UPJANG#||'%'
) GROUP BY MU_CD, TM_CD, UPJANG
)
UNION ALL
/* 당일실적/당일누계실적 */
SELECT T3.MU_CD,
       T3.MU_NM,
       T3.TM_CD,
       T3.TM_NM,
       TO_CHAR(T3.UPJANG) UPJANG,
       T3.UPJANGNM,
       NVL(SUM(CASE WHEN T2.OCCUR_DATE = #END_DATE# THEN CASE WHEN SALS_CLASS IN ('1204','1205','2101','2102') THEN T2.NET_AMT ELSE 0 END ELSE 0 END), 0) +
       NVL(SUM(CASE WHEN T2.OCCUR_DATE = #END_DATE# THEN CASE WHEN SALS_CLASS IN ('1201','1202','1203','2104','1209') THEN T2.NET_AMT ELSE 0 END ELSE 0 END), 0) +
       NVL(SUM(CASE WHEN T2.OCCUR_DATE = #END_DATE# THEN CASE WHEN SALS_CLASS IN ('1206','1207','1208','2103','1901') THEN T2.NET_AMT ELSE 0 END ELSE 0 END), 0) NET_AMT,
       NVL(SUM(CASE WHEN T2.OCCUR_DATE BETWEEN #START_DATE# AND #END_DATE# THEN CASE WHEN SALS_CLASS IN ('1204','1205','2101','2102') THEN T2.NET_AMT ELSE 0 END ELSE 0 END), 0) +
       NVL(SUM(CASE WHEN T2.OCCUR_DATE BETWEEN #START_DATE# AND #END_DATE# THEN CASE WHEN SALS_CLASS IN ('1201','1202','1203','2104','1209') THEN T2.NET_AMT ELSE 0 END ELSE 0 END), 0) +
       NVL(SUM(CASE WHEN T2.OCCUR_DATE BETWEEN #START_DATE# AND #END_DATE# THEN CASE WHEN SALS_CLASS IN ('1206','1207','1208','2103','1901') THEN T2.NET_AMT ELSE 0 END ELSE 0 END), 0) TOT_AMT,
       0
  FROM SLA_IF_UPJANG_SALS_MST T1,
       SLA_IF_UPJANG_SALS_DETAIL T2,
       SCO_UPJANG_MST_V T3
 WHERE T1.OCCUR_DATE = T2.OCCUR_DATE
   AND T1.SYS_CLASS = T2.SYS_CLASS
   AND T1.UPJANG_CD = T2.UPJANG_CD
   AND T1.UPJANG_CD = T3.UPJANG
   AND T1.RECEIPT_NUM =T2.RECEIPT_NUM
   AND T2.SYS_CLASS IN (12,19,20,21)
   AND T2.DDDD_CLOSE_YN = 'Y'
   AND T2.OCCUR_DATE BETWEEN #START_DATE# AND #END_DATE#
   AND T3.UPJANG NOT IN (SELECT Z.CODE FROM SCC_COMMON_CODE Z WHERE Z.GROUP_CODE = 'MA0048' AND Z.USE_YN = 'Y')
   AND T3.MU_CD = #MU_CD#
   AND T3.TM_CD LIKE #TM_CD#||'%'
   AND T3.UPJANG LIKE #UPJANG#||'%'
   AND T3.CC_CD NOT IN ('317770','317780','317840','315920','318760')
GROUP BY T3.MU_CD,T3.MU_NM,T3.TM_CD,T3.TM_NM,T3.UPJANG,T3.UPJANGNM
) T1
GROUP BY MU_CD,
       MU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM) A
</isEqual>
<!-- 식재사업부 -->
<isEqual col = "MU_CD" value = "2004">
SELECT MU_CD,
       MU_NM,
       (SELECT ORG_LEVEL_NM3 FROM SCC_CC WHERE ORG_LEVEL_CD3 = SUBSTR(TM_CD,1,3) AND ROWNUM = 1) BU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM,
       (SELECT DECODE( COUNT(UPJANG_CD), 0 ,'Y', 'N') FROM SLA_UPJANG_SALS_DAY WHERE UPJANG_CD = A.UPJANG  AND FROM_DT <![CDATA[<=]]> #END_DATE# AND TO_DT <![CDATA[>=]]> #END_DATE#) AS SALE_YN,
       NEW_GUBUN,
       DAY_AMT4           AS DAY_AMT4,
       DAY_TOT_AMT4       AS DAY_TOT_AMT4,
       PLAN_MON_AMT     AS PLAN_MON_AMT
  FROM (
SELECT MU_CD,
       MU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM,
       (SELECT CASE WHEN OPEN_DATE IS NULL THEN '미지정'
                    WHEN SUBSTR(OPEN_DATE,1,4) = SUBSTR(#END_DATE#,1,4) THEN '신규'
               ELSE '기존' END
          FROM SCO_UPJANG_MST_V
         WHERE UPJANG = T1.UPJANG) NEW_GUBUN,
       ROUND(SUM(DAY_AMT4)/1000)         AS DAY_AMT4,
       ROUND(SUM(DAY_TOT_AMT4)/1000)     AS DAY_TOT_AMT4,
       ROUND(SUM(PLAN_MON_AMT)/1000)     AS PLAN_MON_AMT
  FROM (
SELECT MU_CD,
       MU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM,
       0 DAY_AMT4,      --당일_당일실적
       0 DAY_TOT_AMT4,  --당일누계_당일실적
       CASE WHEN PRIORITY1_YN = 'Y' THEN PLAN_MON_AMT1
       ELSE PLAN_MON_AMT11 END AS  PLAN_MON_AMT  --당월_계획
  FROM (
SELECT MU_CD,
       MAX(MU_NM) AS MU_NM,
       TM_CD,
       MAX(TM_NM) AS TM_NM,
       '' AS UPJANG,
       UPJANGNM AS UPJANGNM,
       MAX(PRIORITY1_YN) PRIORITY1_YN,
       MAX(PRIORITY2_YN) PRIORITY2_YN,
       SUM(PLAN_MON_AMT1) PLAN_MON_AMT1,     --당월(1순위)
       SUM(PLAN_MON_AMT11) PLAN_MON_AMT11    --당월(2순위)
  FROM (
/* 매출계획 등록 관리(식재사업부) */
SELECT T1.MU_CD,
       MAX(T1.MU_NM) AS MU_NM,
       T1.TM_CD,
       MAX(T1.TM_NM) AS TM_NM,
       '' AS UPJANG,
       H.NM_KOR||'('||H.SABUN||')' AS UPJANGNM,
       'Y' PRIORITY1_YN,
       ''  PRIORITY2_YN,
       SUM(A.SALE_AMOUNT)      PLAN_MON_AMT1,
       SUM(0)      PLAN_MON_AMT11
  FROM FMB_SALE_PLAN A
INNER JOIN ST_UPJANG B2 ON A.MAIN_UPJANG = B2.UPJANG
INNER JOIN SCO_UPJANG_MST_V T1 ON A.MAIN_UPJANG = T1.UPJANG
AND T1.MU_CD = #MU_CD#
AND T1.TM_CD LIKE #TM_CD#||'%'
AND T1.UPJANG LIKE #UPJANG#||'%'
AND T1.CC_CD NOT IN ('317770','317780','317840','315920','318760')
INNER JOIN FMS_UPJANG Z ON 1 = 1 AND A.MAIN_UPJANG = Z.UPJANG
LEFT JOIN HR_PERSONAL H ON 1 = 1 AND A.SABUN = H.SABUN
INNER JOIN HLDC_SC_DEPT_V D ON 1 = 1 AND B2.DEPT_ID = D.DEPT_ID
 LEFT JOIN SCC_COMMON_CODE C ON C.GROUP_CODE = 'FM0022' AND A.PART_CODE = C.CODE
 WHERE A.YYYYMMDD BETWEEN #START_DATE# AND SUBSTR(#END_DATE#,1,6)||'31'
   AND NOT EXISTS (SELECT 'x' FROM SCC_COMMON_CODE WHERE GROUP_CODE = 'ATTACH_DEPT' AND SET1 = D.CC_CD) /* 유통영업팀제외 */
 GROUP BY T1.MU_CD, T1.TM_CD, H.NM_KOR||'('||H.SABUN||')'
UNION ALL
/* 유통영업팀 */
SELECT T1.MU_CD,
       MAX(T1.MU_NM) AS MU_NM,
       T1.TM_CD,
       MAX(T1.TM_NM) AS TM_NM,
       '' AS UPJANG,
       C.CODE_NAME AS UPJANGNM,
       'Y' PRIORITY1_YN,
       ''  PRIORITY2_YN,
       SUM(A.SALE_AMOUNT)      PLAN_MON_AMT1,
       SUM(0)      PLAN_MON_AMT11
  FROM FMB_SALE_PLAN A
INNER JOIN ST_UPJANG B2 ON A.MAIN_UPJANG = B2.UPJANG
INNER JOIN SCO_UPJANG_MST_V T1 ON A.MAIN_UPJANG = T1.UPJANG
AND T1.MU_CD = #MU_CD#
AND T1.TM_CD LIKE #TM_CD#||'%'
AND T1.UPJANG LIKE #UPJANG#||'%'
AND T1.CC_CD NOT IN ('317770','317780','317840','315920','318760')
INNER JOIN FMS_UPJANG Z ON 1 = 1 AND A.MAIN_UPJANG = Z.UPJANG
LEFT JOIN HR_PERSONAL H ON 1 = 1 AND A.SABUN = H.SABUN
INNER JOIN HLDC_SC_DEPT_V D ON 1 = 1 AND B2.DEPT_ID = D.DEPT_ID
 LEFT JOIN SCC_COMMON_CODE C ON C.GROUP_CODE = 'ATTACH_DEPT' AND D.CC_CD = C.SET1
 WHERE A.YYYYMMDD BETWEEN #START_DATE# AND SUBSTR(#END_DATE#,1,6)||'31'
   AND EXISTS (SELECT 'x' FROM SCC_COMMON_CODE WHERE GROUP_CODE = 'ATTACH_DEPT' AND SET1 = D.CC_CD) /* 유통영업팀 */
 GROUP BY T1.MU_CD, T1.TM_CD, C.CODE_NAME
/* 유통영업팀 */
UNION ALL
/* 마케터별 일계획 관리(식재사업부) */
SELECT T1.MU_CD,
       MAX(T1.MU_NM) AS MU_NM,
       T1.TM_CD,
       MAX(T1.TM_NM) AS TM_NM,
       '' AS UPJANG,
       H.NM_KOR||'('||H.SABUN||')' AS UPJANGNM,
       ''  PRIORITY1_YN,
       'Y' PRIORITY2_YN,
       SUM(0),
       SUM(A.DD_AMT)
  FROM MAP_DAY_PLAN2 A
INNER JOIN ST_UPJANG B2 ON A.UPJANG = B2.UPJANG
INNER JOIN SCO_UPJANG_MST_V T1 ON A.UPJANG = T1.UPJANG
AND T1.MU_CD = #MU_CD#
AND T1.TM_CD LIKE #TM_CD#||'%'
AND T1.UPJANG LIKE #UPJANG#||'%'
AND T1.CC_CD NOT IN ('317770','317780','317840','315920','318760')
INNER JOIN FMS_UPJANG Z ON 1 = 1 AND A.UPJANG = Z.UPJANG
LEFT JOIN HR_PERSONAL H ON 1 = 1 AND A.SABUN = H.SABUN
INNER JOIN HLDC_SC_DEPT_V D ON 1 = 1 AND B2.DEPT_ID = D.DEPT_ID
 LEFT JOIN SCC_COMMON_CODE C ON C.GROUP_CODE = 'FM0022' AND Z.PART_CODE = C.CODE
 WHERE A.YMD BETWEEN #START_DATE# AND SUBSTR(#END_DATE#,1,6)||'31'
 GROUP BY T1.MU_CD, T1.TM_CD, H.NM_KOR||'('||H.SABUN||')'
) GROUP BY MU_CD, TM_CD, UPJANGNM
)
UNION ALL
SELECT T1.MU_CD,
       T1.MU_NM,
       T1.TM_CD,
       T1.TM_NM,
       --TO_CHAR(T1.UPJANG),
       --T1.UPJANGNM,
       '' AS UPJANG,
       H.NM_KOR||'('||H.SABUN||')' AS UPJANGNM,
       SUM(CASE WHEN A.TRANS_DATE = #END_DATE# THEN DECODE(SUBSTR(A.TRANS_TYPE,1,1),'I',1,-1) * ROUND(NVL(A.SALE_PRICE, 0) * A.TRANS_QTY) ELSE 0 END), --당일_실적
       SUM(CASE WHEN A.TRANS_DATE BETWEEN #START_DATE# AND #END_DATE# THEN DECODE(SUBSTR(A.TRANS_TYPE,1,1),'I',1,-1) * ROUND(NVL(A.SALE_PRICE, 0) * A.TRANS_QTY) ELSE 0 END), --당일누계_실적
       0 AS PLAN_MON_AMT  --당월_계획
  FROM FMS_TRANSACTION_V A
INNER JOIN ST_UPJANG B2 ON A.TRANS_UPJANG = B2.UPJANG
INNER JOIN SCO_UPJANG_MST_V T1 ON A.TRANS_UPJANG = T1.UPJANG
AND T1.MU_CD = #MU_CD#
AND T1.TM_CD LIKE #TM_CD#||'%'
AND T1.UPJANG LIKE #UPJANG#||'%'
AND T1.CC_CD NOT IN ('317770','317780','317840','315920','318760')
INNER JOIN FMS_UPJANG Z ON 1 = 1 AND A.TRANS_UPJANG = Z.UPJANG
LEFT JOIN HR_PERSONAL H ON 1 = 1 AND Z.PART_SALES_SABUN = H.SABUN
INNER JOIN HLDC_SC_DEPT_V D ON 1 = 1 AND B2.DEPT_ID = D.DEPT_ID
 LEFT JOIN SCC_COMMON_CODE C ON C.GROUP_CODE = 'FM0022' AND Z.PART_CODE = C.CODE --추가
 WHERE SUBSTR(A.SUBINV_CODE, 1, 2) = 'S1'
   AND (A.TRANS_TYPE IN '_002' OR A.TRANS_TYPE = 'I001' )
   AND A.TRANS_DATE2 BETWEEN #START_DATE# AND #END_DATE#
--GROUP BY T1.MU_CD,T1.MU_NM,T1.TM_CD,T1.TM_NM,T1.UPJANG,T1.UPJANGNM
GROUP BY T1.MU_CD,T1.MU_NM,T1.TM_CD,T1.TM_NM,H.NM_KOR||'('||H.SABUN||')'
UNION ALL
SELECT T3.MU_CD,
       T3.MU_NM,
       T3.TM_CD,
       T3.TM_NM,
       '' AS UPJANG,
       T2.CODE_NAME AS UPJANGNM,
       SUM(CASE WHEN T1.RELEASE_DATE = #END_DATE# THEN CASE WHEN T2.CODE_NAME LIKE '%순액%' THEN T1.REAL_SALE_AMT - T1.BUY_CST ELSE T1.REAL_SALE_AMT END ELSE 0 END) AS DAY_AMT4, --당일_전년실적
       SUM(CASE WHEN T1.RELEASE_DATE BETWEEN #START_DATE# AND #END_DATE# THEN CASE WHEN T2.CODE_NAME LIKE '%순액%' THEN T1.REAL_SALE_AMT - T1.BUY_CST ELSE T1.REAL_SALE_AMT END ELSE 0 END) AS DAY_TOT_AMT4, --당일누계_전년실적
       0 AS PLAN_MON_AMT  --당월_계획
  FROM (
SELECT A.ATTACH_DEPT
      ,A.BUY_CST
      ,A.REAL_SALE_AMT
      ,A.RELEASE_DATE
  FROM RELEASE_ITEM_MGMT A
 WHERE A.RELEASE_DATE BETWEEN #START_DATE# AND #END_DATE#
UNION ALL
SELECT A.ATTACH_DEPT
      ,-1 * B.PURCHASE_RETURN_CST AS BUY_CST
      ,-1 * B.PURCHASE_RETURN_AMT AS REAL_SALE_AMT
      ,TO_CHAR(B.PURCHASE_RETURN_DATE)
  FROM RELEASE_ITEM_MGMT A, PURCHASE_RETURN_MGMT B
 WHERE A.RELEASE_NUM = B.RELEASE_NUM
   AND B.PURCHASE_RETURN_DATE BETWEEN #START_DATE# AND #END_DATE#
) T1, SCC_COMMON_CODE T2, HLDC_SC_DEPT_V T3
 WHERE T1.ATTACH_DEPT = T2.CODE
   AND T2.GROUP_CODE = 'ATTACH_DEPT'
   AND T2.SET1 = T3.CC_CD
   AND T3.MU_CD = #MU_CD#
   AND T3.TM_CD LIKE #TM_CD#||'%'
   AND T3.CC_CD NOT IN ('317770','317780','317840','315920','318760')
GROUP BY T3.MU_CD, T3.MU_NM, T3.TM_CD, T3.TM_NM, T2.CODE_NAME
/* 출고관리 */
) T1
GROUP BY MU_CD,
       MU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM) A
</isEqual>
<!-- 구매사업부 -->
<isEqual col = "MU_CD" value = "2005">
SELECT MU_CD,
       MU_NM,
       (SELECT ORG_LEVEL_NM3 FROM SCC_CC WHERE ORG_LEVEL_CD3 = SUBSTR(TM_CD,1,3) AND ROWNUM = 1) BU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM,
       (SELECT DECODE( COUNT(UPJANG_CD), 0 ,'Y', 'N') FROM SLA_UPJANG_SALS_DAY WHERE UPJANG_CD = A.UPJANG  AND FROM_DT <![CDATA[<=]]> #END_DATE# AND TO_DT <![CDATA[>=]]> #END_DATE#) AS SALE_YN,
       NEW_GUBUN,
       DAY_AMT4           AS DAY_AMT4,
       DAY_TOT_AMT4       AS DAY_TOT_AMT4,
       PLAN_MON_AMT     AS PLAN_MON_AMT
  FROM (
SELECT MU_CD,
       MU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM,
       (SELECT CASE WHEN OPEN_DATE IS NULL THEN '미지정'
                    WHEN SUBSTR(OPEN_DATE,1,4) = SUBSTR(#END_DATE#,1,4) THEN '신규'
               ELSE '기존' END
          FROM SCO_UPJANG_MST_V
         WHERE UPJANG = T1.UPJANG) NEW_GUBUN,
       ROUND(SUM(DAY_AMT4)/1000)         AS DAY_AMT4,
       ROUND(SUM(DAY_TOT_AMT4)/1000)     AS DAY_TOT_AMT4,
       ROUND(SUM(PLAN_MON_AMT)/1000)     AS PLAN_MON_AMT
  FROM (
/* 당일계획/당일누계계획/당월계획 */
SELECT MU_CD,
       MU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM,
       0 DAY_AMT4,      --당일_당일실적
       0 DAY_TOT_AMT4,  --당일누계_당일실적
       PLAN_MON_AMT PLAN_MON_AMT  --당월_계획
  FROM (
SELECT MU_CD,
       MAX(MU_NM) AS MU_NM,
       TM_CD,
       MAX(TM_NM) AS TM_NM,
       UPJANG,
       MAX(UPJANGNM) AS UPJANGNM,
       SUM(PLAN_MON_AMT) PLAN_MON_AMT        --당월
  FROM (
SELECT T2.MU_CD,
       T2.MU_NM,
       T2.TM_CD,
       T2.TM_NM,
       TO_CHAR(T2.UPJANG) UPJANG,
       T2.UPJANGNM,
       SUM( CASE WHEN SUBSTR(#END_DATE#,5,2) = '01' THEN MM_AMT_01
                  WHEN SUBSTR(#END_DATE#,5,2) = '02' THEN MM_AMT_02
                  WHEN SUBSTR(#END_DATE#,5,2) = '03' THEN MM_AMT_03
                  WHEN SUBSTR(#END_DATE#,5,2) = '04' THEN MM_AMT_04
                  WHEN SUBSTR(#END_DATE#,5,2) = '05' THEN MM_AMT_05
                  WHEN SUBSTR(#END_DATE#,5,2) = '06' THEN MM_AMT_06
                  WHEN SUBSTR(#END_DATE#,5,2) = '07' THEN MM_AMT_07
                  WHEN SUBSTR(#END_DATE#,5,2) = '08' THEN MM_AMT_08
                  WHEN SUBSTR(#END_DATE#,5,2) = '09' THEN MM_AMT_09
                  WHEN SUBSTR(#END_DATE#,5,2) = '10' THEN MM_AMT_10
                  WHEN SUBSTR(#END_DATE#,5,2) = '11' THEN MM_AMT_11
                  WHEN SUBSTR(#END_DATE#,5,2) = '12' THEN MM_AMT_12
             ELSE 0
             END ) AS PLAN_MON_AMT
  FROM MAP_BPC_CONFIRM_PL_INFO T1
      ,SCO_UPJANG_MST_V T2
  WHERE T1.PLAN_CLASS = 'AP'
    AND T1.PLAN_YEAR = SUBSTR(#END_DATE#,1,4)
    AND T1.VER_CD =
        (SELECT MAX(VER_CD)
           FROM MAP_BPC_CONFIRM_PL_INFO
          WHERE PLAN_CLASS = 'AP'
            AND PLAN_YEAR = SUBSTR(#END_DATE#,1,4))
    AND T1.CC_CD = T2.CC_CD(+)
    AND T2.MU_CD(+) = #MU_CD#
    AND T2.TM_CD(+) LIKE #TM_CD#||'%'
    AND T2.UPJANG LIKE #UPJANG#||'%'
    AND T2.CC_CD NOT IN ('317770','317780','317840','315920','318760')
    AND EXISTS (SELECT 'x'
                  FROM MAS_ST_ACCOUNT
                 WHERE ACCTCD = T1.ACCT_CD
                   AND ACCTNM2 = '매출액')
GROUP BY T2.MU_CD, T2.MU_NM, T2.TM_CD, T2.TM_NM, T2.UPJANG, T2.UPJANGNM
) GROUP BY MU_CD, TM_CD, UPJANG
)
UNION ALL
SELECT T1.MU_CD,
       T1.MU_NM,
       T1.TM_CD,
       T1.TM_NM,
       TO_CHAR(T1.UPJANG) AS UPJANG,
       T1.UPJANGNM,
       NVL(SUM(CASE WHEN B.OCCUR_DATE = #END_DATE# THEN B.NET_AMT ELSE 0 END),0),
       NVL(SUM(CASE WHEN B.OCCUR_DATE BETWEEN #START_DATE# AND #END_DATE# THEN B.NET_AMT ELSE 0 END),0),
       0
  FROM SLA_IF_UPJANG_SALS_MST A
     , SLA_IF_UPJANG_SALS_DETAIL B
  	 , SLA_IF_UPJANG_PAYMENT C
     , SLA_IF_CARD_APPRV_INFO D
     , SCO_UPJANG_MST_V T1
  WHERE A.RECD_STATUS = 'L'
    AND B.RECD_STATUS = 'L'
    AND C.RECD_STATUS = 'L'
    AND A.OCCUR_DATE = B.OCCUR_DATE
    AND A.SYS_CLASS = B.SYS_CLASS
    AND A.UPJANG_CD = B.UPJANG_CD
    AND A.RECEIPT_NUM = B.RECEIPT_NUM
    AND A.OCCUR_DATE = C.OCCUR_DATE
    AND A.SYS_CLASS = C.SYS_CLASS
    AND A.UPJANG_CD = C.UPJANG_CD
    AND A.RECEIPT_NUM = C.RECEIPT_NUM
    AND B.SEQ = C.SEQ  --선수금 수
    AND C.OCCUR_DATE = D.OCCUR_DATE(+)
    AND C.SYS_CLASS = D.SYS_CLASS(+)
    AND C.UPJANG_CD = D.UPJANG_CD(+)
	AND C.RECEIPT_NUM = D.RECEIPT_NUM(+)
    AND C.SEQ = D.SEQ(+)
    AND A.OCCUR_DATE BETWEEN #START_DATE# AND #END_DATE#
	AND A.SYS_CLASS IN ('17','19')
    AND A.UPJANG_CD = T1.UPJANG
    AND T1.MU_CD = #MU_CD#
    AND T1.TM_CD LIKE #TM_CD#||'%'
    AND T1.UPJANG LIKE #UPJANG#||'%'
    AND T1.CC_CD NOT IN ('317770','317780','317840','315920','318760')
GROUP BY T1.MU_CD, T1.MU_NM, T1.TM_CD, T1.TM_NM, T1.UPJANG, T1.UPJANGNM
UNION ALL
SELECT T1.MU_CD,
       T1.MU_NM,
       T1.TM_CD,
       T1.TM_NM,
       TO_CHAR(T1.UPJANG) AS UPJANG,
       T1.UPJANGNM,
       NVL(SUM(CASE WHEN A.MG_DATE = #END_DATE# THEN A.DELY_TOT_AMT ELSE 0 END),0),
       NVL(SUM(CASE WHEN A.MG_DATE BETWEEN #START_DATE# AND #END_DATE# THEN A.DELY_TOT_AMT ELSE 0 END),0),
       0
  FROM EPROCUSR.ESIDLRT A,
       EPROCUSR.ESPSWHC B,
       SCO_UPJANG_MST_V T1
 WHERE A.SYS_ID = '100'
   AND A.COMP_CD = 'HFC'
   AND A.MG_DATE BETWEEN #START_DATE# AND #END_DATE#
   AND A.STS &lt;&gt; 'D'
   AND A.SYS_ID = B.SYS_ID
   AND A.COMP_CD = B.COMP_CD
   AND A.WH_CNTR_CD = B.WH_CNTR_CD
   AND B.SHOP_CD = T1.UPJANG
   AND T1.MU_CD = #MU_CD#
   AND T1.TM_CD LIKE #TM_CD#||'%'
   AND T1.UPJANG LIKE #UPJANG#||'%'
GROUP BY T1.MU_CD, T1.MU_NM, T1.TM_CD, T1.TM_NM, T1.UPJANG, T1.UPJANGNM
UNION ALL
SELECT T1.MU_CD,
       T1.MU_NM,
       T1.TM_CD,
       T1.TM_NM,
       TO_CHAR(T1.UPJANG) AS UPJANG,
       T1.UPJANGNM,
       NVL(SUM(CASE WHEN A.OCCUR_DATE = #END_DATE# THEN A.NET_AMT ELSE 0 END),0),
       NVL(SUM(CASE WHEN A.OCCUR_DATE BETWEEN #START_DATE# AND #END_DATE# THEN A.NET_AMT ELSE 0 END),0),
       0
  FROM SLA_IF_UPJANG_SALS_DETAIL A
     , SCO_UPJANG_MST_V T1
 WHERE A.RECD_STATUS = 'L'
   AND A.OCCUR_DATE BETWEEN #START_DATE# AND #END_DATE#
   AND A.SYS_CLASS IN ('20','21')
    AND A.UPJANG_CD = T1.UPJANG
    AND T1.MU_CD = #MU_CD#
    AND T1.TM_CD LIKE #TM_CD#||'%'
    AND T1.UPJANG LIKE #UPJANG#||'%'
    AND T1.CC_CD NOT IN ('317770','317780','317840','315920','318760')
GROUP BY T1.MU_CD, T1.MU_NM, T1.TM_CD, T1.TM_NM, T1.UPJANG, T1.UPJANGNM
) T1
GROUP BY MU_CD,
       MU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM) A
</isEqual>
/* 전사업부 조회 속도 체크 필요 */
<isEqual col = "MU_CD" value = "9999">
SELECT MU_CD,
       MU_NM,
       BU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM,
       (SELECT DECODE( COUNT(UPJANG_CD), 0 ,'Y', 'N') FROM SLA_UPJANG_SALS_DAY WHERE UPJANG_CD = A.UPJANG  AND FROM_DT <![CDATA[<=]]> #END_DATE# AND TO_DT <![CDATA[>=]]> #END_DATE#) AS SALE_YN,
       NEW_GUBUN,
       DAY_AMT4           AS DAY_AMT4,
       DAY_TOT_AMT4       AS DAY_TOT_AMT4,
       PLAN_MON_AMT     AS PLAN_MON_AMT
  FROM (
SELECT MU_CD,
       MU_NM,
       BU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM,
       MAX(NEW_GUBUN) AS NEW_GUBUN,
       SUM(DAY_AMT4) AS DAY_AMT4,
       SUM(DAY_TOT_AMT4) AS DAY_TOT_AMT4,
       SUM(PLAN_MON_AMT) AS PLAN_MON_AMT
  FROM (
<!-- FC본사 -->
SELECT MU_CD,
       MU_NM,
       (SELECT ORG_LEVEL_NM3 FROM SCC_CC WHERE ORG_LEVEL_CD3 = SUBSTR(TM_CD,1,3) AND ROWNUM = 1) BU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM,
       NEW_GUBUN,
       DAY_AMT4           AS DAY_AMT4,
       DAY_TOT_AMT4       AS DAY_TOT_AMT4,
       PLAN_MON_AMT     AS PLAN_MON_AMT
  FROM (
SELECT MU_CD,
       MU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM,
       (SELECT CASE WHEN OPEN_DATE IS NULL THEN '미지정'
                    WHEN SUBSTR(OPEN_DATE,1,4) = SUBSTR(#END_DATE#,1,4) THEN '신규'
               ELSE '기존' END
          FROM SCO_UPJANG_MST_V
         WHERE UPJANG = T1.UPJANG) NEW_GUBUN,
       ROUND(SUM(DAY_AMT4)/1000)         AS DAY_AMT4,
       ROUND(SUM(DAY_TOT_AMT4)/1000)     AS DAY_TOT_AMT4,
       ROUND(SUM(PLAN_MON_AMT)/1000)     AS PLAN_MON_AMT
  FROM (
/* 당일계획/당일누계계획/당월계획 */
SELECT MU_CD,
       MU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM,
       0 DAY_AMT4,      --당일_당일실적
       0 DAY_TOT_AMT4,  --당일누계_당일실적
       PLAN_MON_AMT PLAN_MON_AMT  --당월_계획
  FROM (
SELECT MU_CD,
       MAX(MU_NM) AS MU_NM,
       TM_CD,
       MAX(TM_NM) AS TM_NM,
       UPJANG,
       MAX(UPJANGNM) AS UPJANGNM,
       SUM(PLAN_MON_AMT) PLAN_MON_AMT        --당월
  FROM (
SELECT T2.MU_CD,
       T2.MU_NM,
       T2.TM_CD,
       T2.TM_NM,
       TO_CHAR(T2.UPJANG) UPJANG,
       T2.UPJANGNM,
       SUM( CASE WHEN SUBSTR(#END_DATE#,5,2) = '01' THEN MM_AMT_01
                  WHEN SUBSTR(#END_DATE#,5,2) = '02' THEN MM_AMT_02
                  WHEN SUBSTR(#END_DATE#,5,2) = '03' THEN MM_AMT_03
                  WHEN SUBSTR(#END_DATE#,5,2) = '04' THEN MM_AMT_04
                  WHEN SUBSTR(#END_DATE#,5,2) = '05' THEN MM_AMT_05
                  WHEN SUBSTR(#END_DATE#,5,2) = '06' THEN MM_AMT_06
                  WHEN SUBSTR(#END_DATE#,5,2) = '07' THEN MM_AMT_07
                  WHEN SUBSTR(#END_DATE#,5,2) = '08' THEN MM_AMT_08
                  WHEN SUBSTR(#END_DATE#,5,2) = '09' THEN MM_AMT_09
                  WHEN SUBSTR(#END_DATE#,5,2) = '10' THEN MM_AMT_10
                  WHEN SUBSTR(#END_DATE#,5,2) = '11' THEN MM_AMT_11
                  WHEN SUBSTR(#END_DATE#,5,2) = '12' THEN MM_AMT_12
             ELSE 0
             END ) AS PLAN_MON_AMT
  FROM MAP_BPC_CONFIRM_PL_INFO T1
      ,SCO_UPJANG_MST_V T2
  WHERE T1.PLAN_CLASS = 'AP'
    AND T1.PLAN_YEAR = SUBSTR(#END_DATE#,1,4)
    AND T1.VER_CD =
        (SELECT MAX(VER_CD)
           FROM MAP_BPC_CONFIRM_PL_INFO
          WHERE PLAN_CLASS = 'AP'
            AND PLAN_YEAR = SUBSTR(#END_DATE#,1,4))
    AND T1.CC_CD = T2.CC_CD(+)
    AND T2.MU_CD(+) IN ('2001','2002','2005')
    AND T2.CC_CD NOT IN ('317770','317780','317840','315920','318760')
    AND EXISTS (SELECT 'x'
                  FROM MAS_ST_ACCOUNT
                 WHERE ACCTCD = T1.ACCT_CD
                   AND ACCTNM2 = '매출액')
GROUP BY T2.MU_CD, T2.MU_NM, T2.TM_CD, T2.TM_NM, T2.UPJANG, T2.UPJANGNM
) GROUP BY MU_CD, TM_CD, UPJANG
)
UNION ALL
/* 당일실적/당일누계실적 */
SELECT T3.MU_CD,
       T3.MU_NM,
       T3.TM_CD,
       T3.TM_NM,
       TO_CHAR(T3.UPJANG) UPJANG,
       T3.UPJANGNM,
       NVL(SUM(CASE WHEN B.OCCUR_DATE = #END_DATE# THEN B.NET_AMT ELSE 0 END), 0) DAY_AMT4,
       NVL(SUM(CASE WHEN B.OCCUR_DATE BETWEEN #START_DATE# AND #END_DATE# THEN B.NET_AMT ELSE 0 END), 0) DAY_TOT_AMT4,
       0 PLAN_MON_AMT
    FROM SLA_IF_UPJANG_SALS_MST A
       , SLA_IF_UPJANG_SALS_DETAIL B
       , SLA_IF_UPJANG_PAYMENT C
       , SLA_IF_CARD_APPRV_INFO D
       , SCO_UPJANG_MST_V T3
  WHERE A.RECD_STATUS = 'L'
    AND B.RECD_STATUS = 'L'
    AND C.RECD_STATUS = 'L'
    AND A.OCCUR_DATE = B.OCCUR_DATE
    AND A.SYS_CLASS = B.SYS_CLASS
    AND A.UPJANG_CD = B.UPJANG_CD
    AND A.RECEIPT_NUM = B.RECEIPT_NUM
    AND A.OCCUR_DATE = C.OCCUR_DATE
    AND A.SYS_CLASS = C.SYS_CLASS
    AND A.UPJANG_CD = C.UPJANG_CD
    AND A.RECEIPT_NUM = C.RECEIPT_NUM
    AND B.SEQ = C.SEQ  --선수금 수
    AND C.OCCUR_DATE = D.OCCUR_DATE(+)
    AND C.SYS_CLASS = D.SYS_CLASS(+)
    AND C.UPJANG_CD = D.UPJANG_CD(+)
  	AND C.RECEIPT_NUM = D.RECEIPT_NUM(+)
    AND C.SEQ = D.SEQ(+)
    AND A.UPJANG_CD = T3.UPJANG
   AND A.OCCUR_DATE BETWEEN #START_DATE# AND #END_DATE#
   AND T3.UPJANG NOT IN (SELECT Z.CODE FROM SCC_COMMON_CODE Z WHERE Z.GROUP_CODE = 'MA0048' AND Z.USE_YN = 'Y')
   AND T3.MU_CD = '2001'
   AND T3.TM_CD LIKE #TM_CD#||'%'
   AND T3.UPJANG LIKE #UPJANG#||'%'
   AND T3.CC_CD NOT IN ('317770','317780','317840','315920','318760')
GROUP BY T3.MU_CD,T3.MU_NM,T3.TM_CD,T3.TM_NM,T3.UPJANG,T3.UPJANGNM
) T1
GROUP BY MU_CD,
       MU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM)
UNION ALL
<!-- FS사업부 -->
SELECT MU_CD,
       MU_NM,
       (SELECT ORG_LEVEL_NM3 FROM SCC_CC WHERE ORG_LEVEL_CD3 = SUBSTR(TM_CD,1,3) AND ROWNUM = 1) BU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM,
       NEW_GUBUN,
       DAY_AMT4           AS DAY_AMT4,
       DAY_TOT_AMT4       AS DAY_TOT_AMT4,
       PLAN_MON_AMT     AS PLAN_MON_AMT
  FROM (
SELECT MU_CD,
       MU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM,
       (SELECT CASE WHEN OPEN_DATE IS NULL THEN '미지정'
                    WHEN SUBSTR(OPEN_DATE,1,4) = SUBSTR(#END_DATE#,1,4) THEN '신규'
               ELSE '기존' END
          FROM SCO_UPJANG_MST_V
         WHERE UPJANG = T1.UPJANG) NEW_GUBUN,
       ROUND(SUM(DAY_AMT4)/1000)         AS DAY_AMT4,
       ROUND(SUM(DAY_TOT_AMT4)/1000)     AS DAY_TOT_AMT4,
       ROUND(SUM(PLAN_MON_AMT)/1000)     AS PLAN_MON_AMT
  FROM (
/* 당일실적/당일누계실적 */
SELECT T3.MU_CD,
       T3.MU_NM,
       T3.TM_CD,
       T3.TM_NM,
       TO_CHAR(T3.UPJANG) UPJANG,
       T3.UPJANGNM,
       NVL(SUM(CASE WHEN T2.OCCUR_DATE = #END_DATE# THEN CASE WHEN SALS_CLASS IN ('1103','1104','1603','2001','2002','1108','1109') THEN T2.NET_AMT ELSE 0 END ELSE 0 END), 0) +
       NVL(SUM(CASE WHEN T2.OCCUR_DATE = #END_DATE# THEN CASE WHEN SALS_CLASS IN ('1101','1102','1602','1701','2004','1110','1111') THEN T2.NET_AMT ELSE 0 END ELSE 0 END), 0) +
       NVL(SUM(CASE WHEN T2.OCCUR_DATE = #END_DATE# THEN CASE WHEN SALS_CLASS IN ('1105','1106','1901','2003','1112','1113','1114','1901') THEN T2.NET_AMT ELSE 0 END ELSE 0 END), 0) DAY_AMT4,
       NVL(SUM(CASE WHEN T2.OCCUR_DATE BETWEEN #START_DATE# AND #END_DATE# THEN CASE WHEN SALS_CLASS IN ('1103','1104','1603','2001','2002','1108','1109') THEN T2.NET_AMT ELSE 0 END ELSE 0 END), 0) +
       NVL(SUM(CASE WHEN T2.OCCUR_DATE BETWEEN #START_DATE# AND #END_DATE# THEN CASE WHEN SALS_CLASS IN ('1101','1102','1602','1701','2004','1110','1111') THEN T2.NET_AMT ELSE 0 END ELSE 0 END), 0) +
       NVL(SUM(CASE WHEN T2.OCCUR_DATE BETWEEN #START_DATE# AND #END_DATE# THEN CASE WHEN SALS_CLASS IN ('1105','1106','1901','2003','1112','1113','1114','1901') THEN T2.NET_AMT ELSE 0 END ELSE 0 END), 0) DAY_TOT_AMT4,
       0 PLAN_MON_AMT
  FROM SLA_IF_UPJANG_SALS_MST T1,
       SLA_IF_UPJANG_SALS_DETAIL T2,
       SCO_UPJANG_MST_V T3
 WHERE T1.OCCUR_DATE = T2.OCCUR_DATE
   AND T1.SYS_CLASS = T2.SYS_CLASS
   AND T1.UPJANG_CD = T2.UPJANG_CD
   AND T1.UPJANG_CD = T3.UPJANG
   AND T1.RECEIPT_NUM =T2.RECEIPT_NUM
   AND T2.SYS_CLASS IN (11,16,17,19,20)
   AND T2.DDDD_CLOSE_YN = 'Y'
   AND T2.OCCUR_DATE BETWEEN #START_DATE# AND #END_DATE#
   AND T3.UPJANG NOT IN (SELECT Z.CODE FROM SCC_COMMON_CODE Z WHERE Z.GROUP_CODE = 'MA0048' AND Z.USE_YN = 'Y')
   AND T3.MU_CD = '2002'
   AND T3.TM_CD LIKE #TM_CD#||'%'
   AND T3.UPJANG LIKE #UPJANG#||'%'
   AND T3.CC_CD NOT IN ('317770','317780','317840','315920','318760')
GROUP BY T3.MU_CD,T3.MU_NM,T3.TM_CD,T3.TM_NM,T3.UPJANG,T3.UPJANGNM
) T1
GROUP BY MU_CD,
       MU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM)
UNION ALL
<!-- 외식사업부 -->
SELECT MU_CD,
       MU_NM,
       (SELECT ORG_LEVEL_NM3 FROM SCC_CC WHERE ORG_LEVEL_CD3 = SUBSTR(TM_CD,1,3) AND ROWNUM = 1) BU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM,
       NEW_GUBUN,
       DAY_AMT4           AS DAY_AMT4,
       DAY_TOT_AMT4       AS DAY_TOT_AMT4,
       PLAN_MON_AMT     AS PLAN_MON_AMT
  FROM (
SELECT MU_CD,
       MU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM,
       (SELECT CASE WHEN OPEN_DATE IS NULL THEN '미지정'
                    WHEN SUBSTR(OPEN_DATE,1,4) = SUBSTR(#END_DATE#,1,4) THEN '신규'
               ELSE '기존' END
          FROM SCO_UPJANG_MST_V
         WHERE UPJANG = T1.UPJANG) NEW_GUBUN,
       ROUND(SUM(DAY_AMT4)/1000)         AS DAY_AMT4,
       ROUND(SUM(DAY_TOT_AMT4)/1000)     AS DAY_TOT_AMT4,
       ROUND(SUM(PLAN_MON_AMT)/1000)     AS PLAN_MON_AMT
  FROM (
/* 당일계획/당일누계계획/당월계획 */
SELECT MU_CD,
       MU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM,
       0 DAY_AMT4,      --당일_당일실적
       0 DAY_TOT_AMT4,  --당일누계_당일실적
       PLAN_MON_AMT PLAN_MON_AMT  --당월_계획
  FROM (
SELECT MU_CD,
       MAX(MU_NM) AS MU_NM,
       TM_CD,
       MAX(TM_NM) AS TM_NM,
       UPJANG,
       MAX(UPJANGNM) AS UPJANGNM,
       SUM(PLAN_MON_AMT) PLAN_MON_AMT        --당월
  FROM (
SELECT MU_CD,
       MU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM,
       '',
       '',
       '',
       0,
       0,
       0,
       0,
       0,
       0,
       MM_AMT PLAN_MON_AMT
  FROM DAY_PLAN_V_3PRIORITY
 WHERE YY = SUBSTR(#END_DATE#,1,4)
   AND START_DD = SUBSTR(#END_DATE#,1,6)||'01'
   AND MU_CD = '2003'
   AND TM_CD LIKE #TM_CD#||'%'
   AND UPJANG LIKE #UPJANG#||'%'
) GROUP BY MU_CD, TM_CD, UPJANG
)
UNION ALL
/* 당일실적/당일누계실적 */
SELECT T3.MU_CD,
       T3.MU_NM,
       T3.TM_CD,
       T3.TM_NM,
       TO_CHAR(T3.UPJANG) UPJANG,
       T3.UPJANGNM,
       NVL(SUM(CASE WHEN T2.OCCUR_DATE = #END_DATE# THEN CASE WHEN SALS_CLASS IN ('1204','1205','2101','2102') THEN T2.NET_AMT ELSE 0 END ELSE 0 END), 0) +
       NVL(SUM(CASE WHEN T2.OCCUR_DATE = #END_DATE# THEN CASE WHEN SALS_CLASS IN ('1201','1202','1203','2104','1209') THEN T2.NET_AMT ELSE 0 END ELSE 0 END), 0) +
       NVL(SUM(CASE WHEN T2.OCCUR_DATE = #END_DATE# THEN CASE WHEN SALS_CLASS IN ('1206','1207','1208','2103','1901') THEN T2.NET_AMT ELSE 0 END ELSE 0 END), 0) NET_AMT,
       NVL(SUM(CASE WHEN T2.OCCUR_DATE BETWEEN #START_DATE# AND #END_DATE# THEN CASE WHEN SALS_CLASS IN ('1204','1205','2101','2102') THEN T2.NET_AMT ELSE 0 END ELSE 0 END), 0) +
       NVL(SUM(CASE WHEN T2.OCCUR_DATE BETWEEN #START_DATE# AND #END_DATE# THEN CASE WHEN SALS_CLASS IN ('1201','1202','1203','2104','1209') THEN T2.NET_AMT ELSE 0 END ELSE 0 END), 0) +
       NVL(SUM(CASE WHEN T2.OCCUR_DATE BETWEEN #START_DATE# AND #END_DATE# THEN CASE WHEN SALS_CLASS IN ('1206','1207','1208','2103','1901') THEN T2.NET_AMT ELSE 0 END ELSE 0 END), 0) TOT_AMT,
       0
  FROM SLA_IF_UPJANG_SALS_MST T1,
       SLA_IF_UPJANG_SALS_DETAIL T2,
       SCO_UPJANG_MST_V T3
 WHERE T1.OCCUR_DATE = T2.OCCUR_DATE
   AND T1.SYS_CLASS = T2.SYS_CLASS
   AND T1.UPJANG_CD = T2.UPJANG_CD
   AND T1.UPJANG_CD = T3.UPJANG
   AND T1.RECEIPT_NUM =T2.RECEIPT_NUM
   AND T2.SYS_CLASS IN (12,19,20,21)
   AND T2.DDDD_CLOSE_YN = 'Y'
   AND T2.OCCUR_DATE BETWEEN #START_DATE# AND #END_DATE#
   AND T3.UPJANG NOT IN (SELECT Z.CODE FROM SCC_COMMON_CODE Z WHERE Z.GROUP_CODE = 'MA0048' AND Z.USE_YN = 'Y')
   AND T3.MU_CD = '2003'
   AND T3.TM_CD LIKE #TM_CD#||'%'
   AND T3.UPJANG LIKE #UPJANG#||'%'
   AND T3.CC_CD NOT IN ('317770','317780','317840','315920','318760')
GROUP BY T3.MU_CD,T3.MU_NM,T3.TM_CD,T3.TM_NM,T3.UPJANG,T3.UPJANGNM
) T1
GROUP BY MU_CD,
       MU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM)
UNION ALL
<!-- 식재사업부 -->
SELECT MU_CD,
       MU_NM,
       (SELECT ORG_LEVEL_NM3 FROM SCC_CC WHERE ORG_LEVEL_CD3 = SUBSTR(TM_CD,1,3) AND ROWNUM = 1) BU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM,
       NEW_GUBUN,
       DAY_AMT4           AS DAY_AMT4,
       DAY_TOT_AMT4       AS DAY_TOT_AMT4,
       PLAN_MON_AMT     AS PLAN_MON_AMT
  FROM (
SELECT MU_CD,
       MU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM,
       (SELECT CASE WHEN OPEN_DATE IS NULL THEN '미지정'
                    WHEN SUBSTR(OPEN_DATE,1,4) = SUBSTR(#END_DATE#,1,4) THEN '신규'
               ELSE '기존' END
          FROM SCO_UPJANG_MST_V
         WHERE UPJANG = T1.UPJANG) NEW_GUBUN,
       ROUND(SUM(DAY_AMT4)/1000)         AS DAY_AMT4,
       ROUND(SUM(DAY_TOT_AMT4)/1000)     AS DAY_TOT_AMT4,
       ROUND(SUM(PLAN_MON_AMT)/1000)     AS PLAN_MON_AMT
  FROM (
SELECT MU_CD,
       MU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM,
       0 DAY_AMT4,      --당일_당일실적
       0 DAY_TOT_AMT4,  --당일누계_당일실적
       CASE WHEN PRIORITY1_YN = 'Y' THEN PLAN_MON_AMT1
       ELSE PLAN_MON_AMT11 END AS  PLAN_MON_AMT  --당월_계획
  FROM (
SELECT MU_CD,
       MAX(MU_NM) AS MU_NM,
       TM_CD,
       MAX(TM_NM) AS TM_NM,
       '' AS UPJANG,
       UPJANGNM AS UPJANGNM,
       MAX(PRIORITY1_YN) PRIORITY1_YN,
       MAX(PRIORITY2_YN) PRIORITY2_YN,
       SUM(PLAN_MON_AMT1) PLAN_MON_AMT1,     --당월(1순위)
       SUM(PLAN_MON_AMT11) PLAN_MON_AMT11    --당월(2순위)
  FROM (
/* 매출계획 등록 관리(식재사업부) */
SELECT T1.MU_CD,
       MAX(T1.MU_NM) AS MU_NM,
       T1.TM_CD,
       MAX(T1.TM_NM) AS TM_NM,
       '' AS UPJANG,
       H.NM_KOR||'('||H.SABUN||')' AS UPJANGNM,
       'Y' PRIORITY1_YN,
       ''  PRIORITY2_YN,
       SUM(A.SALE_AMOUNT)      PLAN_MON_AMT1,
       SUM(0)      PLAN_MON_AMT11
  FROM FMB_SALE_PLAN A
INNER JOIN ST_UPJANG B2 ON A.MAIN_UPJANG = B2.UPJANG
INNER JOIN SCO_UPJANG_MST_V T1 ON A.MAIN_UPJANG = T1.UPJANG
AND T1.MU_CD = '2004'
AND T1.TM_CD LIKE #TM_CD#||'%'
AND T1.UPJANG LIKE #UPJANG#||'%'
AND T1.CC_CD NOT IN ('317770','317780','317840','315920','318760')
INNER JOIN FMS_UPJANG Z ON 1 = 1 AND A.MAIN_UPJANG = Z.UPJANG
LEFT JOIN HR_PERSONAL H ON 1 = 1 AND A.SABUN = H.SABUN
INNER JOIN HLDC_SC_DEPT_V D ON 1 = 1 AND B2.DEPT_ID = D.DEPT_ID
 LEFT JOIN SCC_COMMON_CODE C ON C.GROUP_CODE = 'FM0022' AND A.PART_CODE = C.CODE
 WHERE A.YYYYMMDD BETWEEN #START_DATE# AND SUBSTR(#END_DATE#,1,6)||'31'
   AND NOT EXISTS (SELECT 'x' FROM SCC_COMMON_CODE WHERE GROUP_CODE = 'ATTACH_DEPT' AND SET1 = D.CC_CD) /* 유통영업팀제외 */
 GROUP BY T1.MU_CD, T1.TM_CD, H.NM_KOR||'('||H.SABUN||')'
UNION ALL
/* 유통영업팀 */
SELECT T1.MU_CD,
       MAX(T1.MU_NM) AS MU_NM,
       T1.TM_CD,
       MAX(T1.TM_NM) AS TM_NM,
       '' AS UPJANG,
       C.CODE_NAME AS UPJANGNM,
       'Y' PRIORITY1_YN,
       ''  PRIORITY2_YN,
       SUM(A.SALE_AMOUNT)      PLAN_MON_AMT1,
       SUM(0)      PLAN_MON_AMT11
  FROM FMB_SALE_PLAN A
INNER JOIN ST_UPJANG B2 ON A.MAIN_UPJANG = B2.UPJANG
INNER JOIN SCO_UPJANG_MST_V T1 ON A.MAIN_UPJANG = T1.UPJANG
AND T1.MU_CD = '2004'
AND T1.TM_CD LIKE #TM_CD#||'%'
AND T1.UPJANG LIKE #UPJANG#||'%'
AND T1.CC_CD NOT IN ('317770','317780','317840','315920','318760')
INNER JOIN FMS_UPJANG Z ON 1 = 1 AND A.MAIN_UPJANG = Z.UPJANG
LEFT JOIN HR_PERSONAL H ON 1 = 1 AND A.SABUN = H.SABUN
INNER JOIN HLDC_SC_DEPT_V D ON 1 = 1 AND B2.DEPT_ID = D.DEPT_ID
 LEFT JOIN SCC_COMMON_CODE C ON C.GROUP_CODE = 'ATTACH_DEPT' AND D.CC_CD = C.SET1
 WHERE A.YYYYMMDD BETWEEN #START_DATE# AND SUBSTR(#END_DATE#,1,6)||'31'
   AND EXISTS (SELECT 'x' FROM SCC_COMMON_CODE WHERE GROUP_CODE = 'ATTACH_DEPT' AND SET1 = D.CC_CD) /* 유통영업팀 */
 GROUP BY T1.MU_CD, T1.TM_CD, C.CODE_NAME
/* 유통영업팀 */
UNION ALL
/* 마케터별 일계획 관리(식재사업부) */
SELECT T1.MU_CD,
       MAX(T1.MU_NM) AS MU_NM,
       T1.TM_CD,
       MAX(T1.TM_NM) AS TM_NM,
       '' AS UPJANG,
       H.NM_KOR||'('||H.SABUN||')' AS UPJANGNM,
       ''  PRIORITY1_YN,
       'Y' PRIORITY2_YN,
       SUM(0),
       SUM(A.DD_AMT)
  FROM MAP_DAY_PLAN2 A
INNER JOIN ST_UPJANG B2 ON A.UPJANG = B2.UPJANG
INNER JOIN SCO_UPJANG_MST_V T1 ON A.UPJANG = T1.UPJANG
AND T1.MU_CD = '2004'
AND T1.TM_CD LIKE #TM_CD#||'%'
AND T1.UPJANG LIKE #UPJANG#||'%'
AND T1.CC_CD NOT IN ('317770','317780','317840','315920','318760')
INNER JOIN FMS_UPJANG Z ON 1 = 1 AND A.UPJANG = Z.UPJANG
LEFT JOIN HR_PERSONAL H ON 1 = 1 AND A.SABUN = H.SABUN
INNER JOIN HLDC_SC_DEPT_V D ON 1 = 1 AND B2.DEPT_ID = D.DEPT_ID
 LEFT JOIN SCC_COMMON_CODE C ON C.GROUP_CODE = 'FM0022' AND Z.PART_CODE = C.CODE
 WHERE A.YMD BETWEEN #START_DATE# AND SUBSTR(#END_DATE#,1,6)||'31'
 GROUP BY T1.MU_CD, T1.TM_CD, H.NM_KOR||'('||H.SABUN||')'
) GROUP BY MU_CD, TM_CD, UPJANGNM
)
UNION ALL
SELECT T1.MU_CD,
       T1.MU_NM,
       T1.TM_CD,
       T1.TM_NM,
       --TO_CHAR(T1.UPJANG),
       --T1.UPJANGNM,
       '' AS UPJANG,
       H.NM_KOR||'('||H.SABUN||')' AS UPJANGNM,
       SUM(CASE WHEN A.TRANS_DATE = #END_DATE# THEN DECODE(SUBSTR(A.TRANS_TYPE,1,1),'I',1,-1) * ROUND(NVL(A.SALE_PRICE, 0) * A.TRANS_QTY) ELSE 0 END), --당일_실적
       SUM(CASE WHEN A.TRANS_DATE BETWEEN #START_DATE# AND #END_DATE# THEN DECODE(SUBSTR(A.TRANS_TYPE,1,1),'I',1,-1) * ROUND(NVL(A.SALE_PRICE, 0) * A.TRANS_QTY) ELSE 0 END), --당일누계_실적
       0 AS PLAN_MON_AMT  --당월_계획
  FROM FMS_TRANSACTION_V A
INNER JOIN ST_UPJANG B2 ON A.TRANS_UPJANG = B2.UPJANG
INNER JOIN SCO_UPJANG_MST_V T1 ON A.TRANS_UPJANG = T1.UPJANG
AND T1.MU_CD = '2004'
AND T1.TM_CD LIKE #TM_CD#||'%'
AND T1.UPJANG LIKE #UPJANG#||'%'
AND T1.CC_CD NOT IN ('317770','317780','317840','315920','318760')
INNER JOIN FMS_UPJANG Z ON 1 = 1 AND A.TRANS_UPJANG = Z.UPJANG
LEFT JOIN HR_PERSONAL H ON 1 = 1 AND Z.PART_SALES_SABUN = H.SABUN
INNER JOIN HLDC_SC_DEPT_V D ON 1 = 1 AND B2.DEPT_ID = D.DEPT_ID
 LEFT JOIN SCC_COMMON_CODE C ON C.GROUP_CODE = 'FM0022' AND Z.PART_CODE = C.CODE --추가
 WHERE SUBSTR(A.SUBINV_CODE, 1, 2) = 'S1'
   AND (A.TRANS_TYPE IN '_002' OR A.TRANS_TYPE = 'I001' )
   AND A.TRANS_DATE2 BETWEEN #START_DATE# AND #END_DATE#
--GROUP BY T1.MU_CD,T1.MU_NM,T1.TM_CD,T1.TM_NM,T1.UPJANG,T1.UPJANGNM
GROUP BY T1.MU_CD,T1.MU_NM,T1.TM_CD,T1.TM_NM,H.NM_KOR||'('||H.SABUN||')'
UNION ALL
SELECT T3.MU_CD,
       T3.MU_NM,
       T3.TM_CD,
       T3.TM_NM,
       '' AS UPJANG,
       T2.CODE_NAME AS UPJANGNM,
       SUM(CASE WHEN T1.RELEASE_DATE = #END_DATE# THEN CASE WHEN T2.CODE_NAME LIKE '%순액%' THEN T1.REAL_SALE_AMT - T1.BUY_CST ELSE T1.REAL_SALE_AMT END ELSE 0 END) AS DAY_AMT4, --당일_전년실적
       SUM(CASE WHEN T1.RELEASE_DATE BETWEEN #START_DATE# AND #END_DATE# THEN CASE WHEN T2.CODE_NAME LIKE '%순액%' THEN T1.REAL_SALE_AMT - T1.BUY_CST ELSE T1.REAL_SALE_AMT END ELSE 0 END) AS DAY_TOT_AMT4, --당일누계_전년실적
       0 AS PLAN_MON_AMT  --당월_계획
  FROM (
SELECT A.ATTACH_DEPT
      ,A.BUY_CST
      ,A.REAL_SALE_AMT
      ,A.RELEASE_DATE
  FROM RELEASE_ITEM_MGMT A
 WHERE A.RELEASE_DATE BETWEEN #START_DATE# AND #END_DATE#
UNION ALL
SELECT A.ATTACH_DEPT
      ,-1 * B.PURCHASE_RETURN_CST AS BUY_CST
      ,-1 * B.PURCHASE_RETURN_AMT AS REAL_SALE_AMT
      ,TO_CHAR(B.PURCHASE_RETURN_DATE)
  FROM RELEASE_ITEM_MGMT A, PURCHASE_RETURN_MGMT B
 WHERE A.RELEASE_NUM = B.RELEASE_NUM
   AND B.PURCHASE_RETURN_DATE BETWEEN #START_DATE# AND #END_DATE#
) T1, SCC_COMMON_CODE T2, HLDC_SC_DEPT_V T3
 WHERE T1.ATTACH_DEPT = T2.CODE
   AND T2.GROUP_CODE = 'ATTACH_DEPT'
   AND T2.SET1 = T3.CC_CD
   AND T3.MU_CD = '2004'
   AND T3.TM_CD LIKE #TM_CD#||'%'
   AND T3.CC_CD NOT IN ('317770','317780','317840','315920','318760')
GROUP BY T3.MU_CD, T3.MU_NM, T3.TM_CD, T3.TM_NM, T2.CODE_NAME
/* 출고관리 */
) T1
GROUP BY MU_CD,
       MU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM)
UNION ALL
<!-- 구매사업부 -->
SELECT MU_CD,
       MU_NM,
       (SELECT ORG_LEVEL_NM3 FROM SCC_CC WHERE ORG_LEVEL_CD3 = SUBSTR(TM_CD,1,3) AND ROWNUM = 1) BU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM,
       NEW_GUBUN,
       DAY_AMT4           AS DAY_AMT4,
       DAY_TOT_AMT4       AS DAY_TOT_AMT4,
       PLAN_MON_AMT     AS PLAN_MON_AMT
  FROM (
SELECT MU_CD,
       MU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM,
       (SELECT CASE WHEN OPEN_DATE IS NULL THEN '미지정'
                    WHEN SUBSTR(OPEN_DATE,1,4) = SUBSTR(#END_DATE#,1,4) THEN '신규'
               ELSE '기존' END
          FROM SCO_UPJANG_MST_V
         WHERE UPJANG = T1.UPJANG) NEW_GUBUN,
       ROUND(SUM(DAY_AMT4)/1000)         AS DAY_AMT4,
       ROUND(SUM(DAY_TOT_AMT4)/1000)     AS DAY_TOT_AMT4,
       ROUND(SUM(PLAN_MON_AMT)/1000)     AS PLAN_MON_AMT
  FROM (
SELECT T1.MU_CD,
       T1.MU_NM,
       T1.TM_CD,
       T1.TM_NM,
       TO_CHAR(T1.UPJANG) AS UPJANG,
       T1.UPJANGNM,
       NVL(SUM(CASE WHEN B.OCCUR_DATE = #END_DATE# THEN B.NET_AMT ELSE 0 END),0) DAY_AMT4,
       NVL(SUM(CASE WHEN B.OCCUR_DATE BETWEEN #START_DATE# AND #END_DATE# THEN B.NET_AMT ELSE 0 END),0) DAY_TOT_AMT4,
       0 PLAN_MON_AMT
  FROM SLA_IF_UPJANG_SALS_MST A
     , SLA_IF_UPJANG_SALS_DETAIL B
  	 , SLA_IF_UPJANG_PAYMENT C
     , SLA_IF_CARD_APPRV_INFO D
     , SCO_UPJANG_MST_V T1
  WHERE A.RECD_STATUS = 'L'
    AND B.RECD_STATUS = 'L'
    AND C.RECD_STATUS = 'L'
    AND A.OCCUR_DATE = B.OCCUR_DATE
    AND A.SYS_CLASS = B.SYS_CLASS
    AND A.UPJANG_CD = B.UPJANG_CD
    AND A.RECEIPT_NUM = B.RECEIPT_NUM
    AND A.OCCUR_DATE = C.OCCUR_DATE
    AND A.SYS_CLASS = C.SYS_CLASS
    AND A.UPJANG_CD = C.UPJANG_CD
    AND A.RECEIPT_NUM = C.RECEIPT_NUM
    AND B.SEQ = C.SEQ  --선수금 수
    AND C.OCCUR_DATE = D.OCCUR_DATE(+)
    AND C.SYS_CLASS = D.SYS_CLASS(+)
    AND C.UPJANG_CD = D.UPJANG_CD(+)
	AND C.RECEIPT_NUM = D.RECEIPT_NUM(+)
    AND C.SEQ = D.SEQ(+)
    AND A.OCCUR_DATE BETWEEN #START_DATE# AND #END_DATE#
	AND A.SYS_CLASS IN ('17','19')
    AND A.UPJANG_CD = T1.UPJANG
    AND T1.MU_CD = '2005'
    AND T1.CC_CD NOT IN ('317770','317780','317840','315920','318760')
GROUP BY T1.MU_CD, T1.MU_NM, T1.TM_CD, T1.TM_NM, T1.UPJANG, T1.UPJANGNM
UNION ALL
SELECT T1.MU_CD,
       T1.MU_NM,
       T1.TM_CD,
       T1.TM_NM,
       TO_CHAR(T1.UPJANG) AS UPJANG,
       T1.UPJANGNM,
       NVL(SUM(CASE WHEN A.MG_DATE = #END_DATE# THEN A.DELY_TOT_AMT ELSE 0 END),0),
       NVL(SUM(CASE WHEN A.MG_DATE BETWEEN #START_DATE# AND #END_DATE# THEN A.DELY_TOT_AMT ELSE 0 END),0),
       0
  FROM EPROCUSR.ESIDLRT A,
       EPROCUSR.ESPSWHC B,
       SCO_UPJANG_MST_V T1
 WHERE A.SYS_ID = '100'
   AND A.COMP_CD = 'HFC'
   AND A.MG_DATE BETWEEN #START_DATE# AND #END_DATE#
   AND A.STS &lt;&gt; 'D'
   AND A.SYS_ID = B.SYS_ID
   AND A.COMP_CD = B.COMP_CD
   AND A.WH_CNTR_CD = B.WH_CNTR_CD
   AND B.SHOP_CD = T1.UPJANG
   AND T1.MU_CD = '2005'
GROUP BY T1.MU_CD, T1.MU_NM, T1.TM_CD, T1.TM_NM, T1.UPJANG, T1.UPJANGNM
UNION ALL
SELECT T1.MU_CD,
       T1.MU_NM,
       T1.TM_CD,
       T1.TM_NM,
       TO_CHAR(T1.UPJANG) AS UPJANG,
       T1.UPJANGNM,
       NVL(SUM(CASE WHEN A.OCCUR_DATE = #END_DATE# THEN A.NET_AMT ELSE 0 END),0),
       NVL(SUM(CASE WHEN A.OCCUR_DATE BETWEEN #START_DATE# AND #END_DATE# THEN A.NET_AMT ELSE 0 END),0),
       0
  FROM SLA_IF_UPJANG_SALS_DETAIL A
     , SCO_UPJANG_MST_V T1
 WHERE A.RECD_STATUS = 'L'
   AND A.OCCUR_DATE BETWEEN #START_DATE# AND #END_DATE#
   AND A.SYS_CLASS IN ('20','21')
    AND A.UPJANG_CD = T1.UPJANG
    AND T1.MU_CD = '2005'
    AND T1.CC_CD NOT IN ('317770','317780','317840','315920','318760')
GROUP BY T1.MU_CD, T1.MU_NM, T1.TM_CD, T1.TM_NM, T1.UPJANG, T1.UPJANGNM
) T1
GROUP BY MU_CD,
       MU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM)
)
GROUP BY MU_CD,
       MU_NM,
       BU_NM,
       TM_CD,
       TM_NM,
       UPJANG,
       UPJANGNM
) A
</isEqual>

	</statement>
	<input default-name="ds_cond">
	</input>
	<output default-name="ds_dailyList">   
	</output>
</query>