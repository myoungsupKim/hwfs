<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="..\..\..\default_typedef.xml"/>
  <Form id="FSP00230E" onload="form_onload" titletext="재고등록" position="absolute 0 0 1252 725" scrollbars="none" onkeydown="frm_OnKeyDown" onclose="frm_onclose" onbeforeclose="frm_onbeforeclose">
    <Layouts>
      <Layout>
        <Grid selecttype="row" autoenter="select" binddataset="ds_stock" cellsizingtype="both" readonly="false" enable="true" id="grdStock" useinputpanel="false" taborder="10" tabstop="true" usecontextmenu="true" useselcolor="true" visible="true" wheelscrollrow="1" position="absolute 0 130 1237 710" autofittype="col" anchor="all" onkeyup="grdStock_onkeyup" onenterdown="grdStock_onenterdown" oncelldblclick="grdStock_oncelldblclick" onexpandup="grdStock_onexpandup">
          <Formats>
            <Format id="format_1">
              <Columns>
                <Column size="30"/>
                <Column size="54"/>
                <Column size="57"/>
                <Column size="65"/>
                <Column size="148"/>
                <Column size="98"/>
                <Column size="60"/>
                <Column size="60"/>
                <Column size="70"/>
                <Column size="55"/>
                <Column size="70"/>
                <Column size="45"/>
                <Column size="55"/>
                <Column size="70"/>
                <Column size="55"/>
                <Column size="70"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="108"/>
              </Columns>
              <Rows>
                <Row size="26" band="head"/>
                <Row size="24"/>
                <Row size="24" band="summ"/>
              </Rows>
              <Band id="head">
                <Cell displaytype="text" class="head_Excel"/>
                <Cell col="1" displaytype="text" style="align:center;" text="중분류"/>
                <Cell col="2" displaytype="text" style="align:center;" text="소분류"/>
                <Cell col="3" displaytype="text" style="align:center;" text="자재코드"/>
                <Cell col="4" displaytype="text" style="align:center;" text="자재명"/>
                <Cell col="5" displaytype="text" style="align:center;" text="규격"/>
                <Cell col="6" displaytype="text" style="align:center;" text="구매단위" wordwrap="exchar"/>
                <Cell col="7" displaytype="text" style="align:center;" text="수불단위" wordwrap="exchar"/>
                <Cell col="8" displaytype="text" style="align:center;" text="재고단가"/>
                <Cell col="9" displaytype="text" style="align:center;" text="재고량"/>
                <Cell col="10" displaytype="text" style="align:center;" text="재고금액"/>
                <Cell col="11" displaytype="text" style="align:center;" text="예상&#13;&#10;사용량" wordwrap="exchar"/>
                <Cell col="12" displaytype="text" style="align:center;" class="grd_WF_Essential" text="실사량"/>
                <Cell col="13" displaytype="text" style="align:center;" text="실사금액"/>
                <Cell col="14" displaytype="text" style="align:center;" text="사용량"/>
                <Cell col="15" displaytype="text" style="align:center;" text="사용금액"/>
                <Cell col="16" displaytype="text" style="align:center;" class="grd_WF_Essential" text="유통기한" taborder="undefined"/>
                <Cell col="17" displaytype="text" style="align:center;" class="grd_WF_Essential" text="제조일" taborder="undefined"/>
                <Cell col="18" displaytype="text" class="grd_WF_Essential" text="비고"/>
              </Band>
              <Band id="body">
                <Cell displaytype="text" style="align:center;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" expr="expr:currow+1"/>
                <Cell col="1" displaytype="text" style="align:left;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:L_CLASS_NAME" suppress="1"/>
                <Cell col="2" displaytype="text" style="align:left;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:M_CLASS_NAME" suppress="1"/>
                <Cell col="3" displaytype="text" style="align:center;background:EXPR(BG_YN=='Y'?(ITEM_CODE=='F178120'?&quot;yellow&quot;:(ITEM_CODE=='F178121'?&quot;yellow&quot;:(ITEM_CODE=='F132747'?&quot;yellow&quot;:&quot;#f26067ff&quot;))):(ITEM_CODE=='F178120'?&quot;yellow&quot;:(ITEM_CODE=='F178121'?&quot;yellow&quot;:(ITEM_CODE=='F132747'?&quot;yellow&quot;:&quot;white&quot;))));background2:EXPR(BG_YN=='Y'?(ITEM_CODE=='F178120'?&quot;yellow&quot;:(ITEM_CODE=='F178121'?&quot;yellow&quot;:(ITEM_CODE=='F132747'?&quot;yellow&quot;:&quot;#f26067ff&quot;))):(ITEM_CODE=='F178120'?&quot;yellow&quot;:(ITEM_CODE=='F178121'?&quot;yellow&quot;:(ITEM_CODE=='F132747'?&quot;yellow&quot;:&quot;white&quot;))));color:EXPR(ITEM_CODE=='F178120'?&quot;red&quot;:(ITEM_CODE=='F178121'?&quot;red&quot;:(ITEM_CODE=='F132747'?&quot;red&quot;:&quot;black&quot;)));color2:EXPR(ITEM_CODE=='F178120'?&quot;red&quot;:(ITEM_CODE=='F178121'?&quot;red&quot;:(ITEM_CODE=='F132747'?&quot;red&quot;:&quot;black&quot;)));" text="bind:ITEM_CODE"/>
                <Cell col="4" displaytype="text" style="align:left;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:ITEM_NAME"/>
                <Cell col="5" displaytype="text" style="align:left;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:ITEM_SIZE"/>
                <Cell col="6" displaytype="text" style="align:center;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:PO_UOM"/>
                <Cell col="7" displaytype="text" style="align:center;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:UOM_CODE"/>
                <Cell col="8" displaytype="number" style="align:right;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:M_STK_PRICE" expr="expr:Math.round(M_STK_PRICE)"/>
                <Cell col="9" displaytype="number" style="align:right;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:M_STK_QTY" mask="#,##0.#####"/>
                <Cell col="10" displaytype="number" style="align:right;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:M_STK_AMT" expr="expr:Math.round(M_STK_AMT)" mask="###,##0"/>
                <Cell col="11" displaytype="number" style="align:right;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:MENU_QTY" mask="#,##0.#####"/>
                <Cell col="12" displaytype="number" edittype="text" editfilter="number" style="align:right;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:M_REAL_QTY" mask="#,##0.#####" editautoselect="true"/>
                <Cell col="13" displaytype="number" style="align:right;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:M_REAL_AMT" expr="expr:Math.round(M_REAL_AMT)" mask="###,##0"/>
                <Cell col="14" displaytype="number" editfilter="digit" style="align:right;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);color:EXPR(M_USE_QTY&lt;0?&quot;red&quot;:&quot;&quot;);color2:EXPR(M_USE_QTY&lt;0?&quot;red&quot;:&quot;&quot;);" text="bind:M_USE_QTY" mask="#,##0.#####"/>
                <Cell col="15" displaytype="number" style="align:right;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:M_USE_AMT" expr="expr:Math.round(M_USE_AMT)" mask="###,##0"/>
                <Cell col="16" displaytype="date" edittype="date" editfilter="digit" style="align:center;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:VALUE_DATE" editautoselect="true" calendardisplaynulltype="none"/>
                <Cell col="17" displaytype="date" edittype="date" editfilter="digit" style="align:center;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:MAKER_DATE" editautoselect="true" calendardisplaynulltype="none"/>
                <Cell col="18" displaytype="text" edittype="text" style="align:left;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:VALUE_DATE_INFO" editautoselect="true"/>
              </Band>
              <Band id="summary">
                <Cell colspan="9" displaytype="text" style="align:center;" text="합계"/>
                <Cell col="9" displaytype="number" style="align:right;" expr="expr:ds_stock.getSum('M_STK_QTY')" mask="#,##0.#0"/>
                <Cell col="10" displaytype="number" style="align:right;" expr="expr:Math.round(ds_stock.getSum('M_STK_AMT'))" mask="###,##0"/>
                <Cell col="11" displaytype="number" style="align:right;" expr="expr:ds_stock.getSum('MENU_QTY')" mask="#,##0.#0"/>
                <Cell col="12" displaytype="number" style="align:right;" expr="expr:ds_stock.getSum('M_REAL_QTY_SUM')" mask="#,##0.#0"/>
                <Cell col="13" displaytype="number" style="align:right;" expr="expr:Math.round(ds_stock.getSum('M_REAL_AMT'))" mask="###,##0"/>
                <Cell col="14" displaytype="number" style="align:right;" expr="expr:ds_stock.getSum('M_USE_QTY')" mask="#,##0.#0"/>
                <Cell col="15" displaytype="number" style="align:right;" expr="expr:Math.round(ds_stock.getSum('M_USE_AMT'))" mask="###,##0"/>
                <Cell col="16" displaytype="none" style="align:left;"/>
                <Cell col="17" displaytype="none" style="align:left;"/>
                <Cell col="18" displaytype="none" style="align:left;"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Static id="Static0" text="재고등록시 유통기한 확인 후 수정하여 관리하세요." position="absolute 91 111 462 132" class="sta_WF_DiscPoint" style="color:red;font:Dotum,9,bold;"/>
        <Static id="Static3" text="빨간색 표시는 유통기한 임박제품(D-7)" position="absolute 979 111 1233 132" class="sta_WF_DiscPoint" style="color:red;font:Dotum,9,bold;" anchor="top right"/>
        <Div id="div_cmnBtn" anchor="left top right" taborder="14" url="cmn::CmnBtn.xfdl" text="Div00" scrollbars="none" position="absolute 0 0 1237 30"/>
        <Static id="Static08" class="sta_WFSA_Labelbg" position="absolute 0 30 1237 97" anchor="left top right"/>
        <Static id="Static04" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 30 1237 40"/>
        <Static id="Static05" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 87 1237 97"/>
        <Static id="Static15" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 0 97 1237 110"/>
        <Static id="st_ContractStart" text="사업장" class="sta_WFSA_label" position="absolute 448 40 495 61" anchor="left top"/>
        <Static id="Static07" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 40 15 61" anchor="left top"/>
        <Static id="Static03" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 493 40 503 61" anchor="left top"/>
        <Static id="Static09" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 648 40 678 61" anchor="left top"/>
        <Static id="st_SubinvCode" text="창고" class="sta_WFSA_label" position="absolute 678 40 719 61" anchor="left top"/>
        <Static id="Static02" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 710 40 720 61" anchor="left top"/>
        <Static id="Static10" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 980 40 1010 61" anchor="left top"/>
        <Static id="Static17" text="조사일" class="sta_WFSA_label" position="absolute 15 66 93 87" anchor="left top"/>
        <Static id="Static18" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 59 66 69 87" anchor="left top"/>
        <Static id="Static22" text="재고내역" class="sta_WF_Title01" position="absolute 0 111 74 129"/>
        <Static id="Static16" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 0 125 1237 130"/>
        <Static id="Static71" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 710 1252 725" anchor="left bottom"/>
        <Static id="Static27" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1237 0 1252 710" anchor="top right"/>
        <Combo codecolumn="SUBINV_CODE" datacolumn="SUBINV_NAME" id="cbo_SubInv" imemode="native" index="0" innerdataset="ds_subinv" type="filter" taborder="3" position="absolute 720 40 980 61"/>
        <Button id="btn_Date" onclick="g_CalButton_OnClick" taborder="5" tabstop="false" userdata="me_Date" position="absolute 147 66 168 87" class="btn_WF_cal" text="" image=""/>
        <CheckBox falsevalue="N" id="chk_PoUom" taborder="8" tabstop="false" text="구매단위조회" truevalue="Y" position="absolute 464 66 554 87" value="Y"/>
        <CheckBox falsevalue="N" id="chk_PhysicQty" taborder="7" tabstop="false" text="실사량=재고량설정" truevalue="Y" value="false" position="absolute 337 66 458 87"/>
        <CheckBox falsevalue="N" id="chk_Amt" taborder="6" tabstop="false" text="금액보기" truevalue="Y" value="false" position="absolute 264 66 331 87"/>
        <Button id="btn_StkInit" onclick="btn_StkInit_OnClick" taborder="9" tabstop="false" text="조회취소" position="absolute 1159 40 1234 62" class="btn_WF_Custom" image="" anchor="top right"/>
        <UpjangSearchComponent id="edt_upjang" titletext="업장 검색용 Component" taborder="2" text="UpjangSearchComponent00" position="absolute 503 40 648 61" bindDataset="ds_input" bindUpjangCodeColumn="UPJANG" bindUpjangNameColumn="UPJANGNM" eventBeforeTrigger="" eventAfterTrigger="fn_subInvPopup" roleSetId=""/>
        <Static id="Static25" text="사업부" class="sta_WFSA_label" position="absolute 15 40 85 61"/>
        <MuSearchComponent id="cbo_mu" titletext="사업부 선택 Component" taborder="0" text="MuSearchComponent00" position="absolute 70 40 234 61" bindDataset="ds_input" bindMuCdColumn="MU" appendText="" onItemChangedEvent="fn_muChange"/>
        <Static id="Static00" text="팀" class="sta_WFSA_label" position="absolute 264 40 291 61"/>
        <TmSearchComponent id="edt_tm" titletext="팀 검색용 Component" taborder="1" text="TmSearchComponent00" position="absolute 292 40 418 61" bindDataset="ds_input" bindTmCdColumn="TM" bindTmNmColumn="TMNM" qoBuCd="" qoMuCd="" qoUseYn="" eventAfterTrigger="fn_tmChange" eventBeforeTrigger=""/>
        <Static id="Static01" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 66 15 87" anchor="left top"/>
        <Static id="Static06" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 60 40 70 61" anchor="left top"/>
        <Static id="Static11" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 234 40 264 61" anchor="left top"/>
        <Static id="Static12" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 282 40 292 61" anchor="left top"/>
        <Static id="Static13" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 418 40 448 61" anchor="left top"/>
        <MaskEdit id="me_Date" mask="####-##-##" oneditclick="g_Date_OnFocus" onsetfocus="g_Date_OnFocus" onkillfocus="g_Date_OnKillFocus" taborder="4" type="string" userdata="btn_Date" position="absolute 69 66 148 87" class="msk_WF_Cal"/>
        <Static id="Static51" text="W05." visible="false" position="absolute 1 61 1237 66" style="background:#ff000055;align:center middle;"/>
        <Static id="Static19" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 234 66 264 87" anchor="left top"/>
        <Button id="btn_tempSave" taborder="15" tabstop="false" text="실사등록" class="btn_WF_Custom" position="absolute 1082 40 1157 62" anchor="top right" onclick="btn_tempSave_onclick"/>
        <Button id="btn_excel" taborder="16" tabstop="false" text="엑셀업로드" class="btn_WF_Custom" position="absolute 1003 40 1080 62" anchor="top right" onclick="btn_excel_onclick"/>
        <MPFileDialog id="fd_Excel" taborder="17" visible="false" position="absolute 944 66 968 90" FileName="" FileNameList="" FilePath="" UserData="" MultiSelect="false" Filter="ALL File(*.*)|*.*" FilterIndex="0" AppendExtDefault="false" Type="Open" FileSize=""/>
        <Button id="btn_physic_value" taborder="18" tabstop="false" text="전일자 추가정보 복사" class="btn_WF_Custom" position="absolute 1103 66 1234 88" anchor="top right" onclick="btn_physic_value_onclick"/>
        <MaskEdit id="me_Date2" taborder="19" type="string" mask="####-##-##" onsetfocus="g_Date_OnFocus" onkillfocus="g_Date_OnKillFocus" oneditclick="g_Date_OnFocus" class="msk_WF_Cal" position="absolute 1002 66 1081 87" userdata="btn_Date2" anchor="top right"/>
        <Button id="btn_Date2" taborder="20" tabstop="false" onclick="g_CalButton_OnClick" class="btn_WF_cal" position="absolute 1080 66 1101 87" userdata="me_Date2" anchor="top right"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_type">
        <ColumnInfo>
          <Column id="PHYSICAL_FLAG" size="1" type="STRING"/>
          <Column id="LOSS_IN_TYPE" size="50" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_po">
        <ColumnInfo>
          <Column id="DELIVERED_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="ITEM_NAME" size="213" type="STRING"/>
          <Column id="NEED_DATE" size="10" type="STRING"/>
          <Column id="NONE_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="ORDER_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="UNDELIVERED_QTY" size="22" type="BIGDECIMAL"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_stock" oncolumnchanged="ds_stock_OnColumnChanged" cancolumnchange="ds_stock_cancolumnchange">
        <ColumnInfo>
          <Column id="ADV_PHYSIC_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="BARCODE" size="13" type="STRING"/>
          <Column id="ITEM_CODE" size="12" type="STRING"/>
          <Column id="ITEM_NAME" size="200" type="STRING"/>
          <Column id="ITEM_SIZE" size="100" type="STRING"/>
          <Column id="L_CLASS_NAME" size="50" type="STRING"/>
          <Column id="M_CLASS_NAME" size="50" type="STRING"/>
          <Column id="M_REAL_AMT" size="22" type="BIGDECIMAL"/>
          <Column id="M_REAL_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="M_STK_AMT" size="22" type="BIGDECIMAL"/>
          <Column id="M_STK_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="M_STK_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="M_USE_AMT" size="22" type="BIGDECIMAL"/>
          <Column id="M_USE_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="MENU_KG_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="MENU_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="PO_UOM" size="10" type="STRING"/>
          <Column id="TAX_CODE" size="3" type="STRING"/>
          <Column id="U_REAL_AMT" size="22" type="BIGDECIMAL"/>
          <Column id="U_STK_AMT" size="22" type="BIGDECIMAL"/>
          <Column id="U_STK_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="U_USE_AMT" size="22" type="BIGDECIMAL"/>
          <Column id="UOM_CODE" size="10" type="STRING"/>
          <Column id="UOM_CONVERT_RATE" size="22" type="BIGDECIMAL"/>
          <Column id="VALUE_DATE_INFO" size="100" type="STRING"/>
          <Column id="VALUE_DATE" size="256" type="STRING"/>
          <Column id="TRANS_DATE" type="STRING" size="256"/>
          <Column id="TRANS_TYPE_NM" type="STRING" size="256"/>
          <Column id="MARGIN_AMT" type="STRING" size="256"/>
          <Column id="UNIT_QTY" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_subinv">
        <ColumnInfo>
          <Column id="SUBINV_CODE" size="256" type="STRING"/>
          <Column id="SUBINV_NAME_DISP" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_input" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" oncolumnchanged="ds_input_oncolumnchanged">
        <ColumnInfo>
          <Column id="MU" type="STRING" size="256"/>
          <Column id="TM" type="STRING" size="256"/>
          <Column id="TMNM" type="STRING" size="256"/>
          <Column id="UPJANG" type="STRING" size="256"/>
          <Column id="UPJANGNM" type="STRING" size="256"/>
          <Column id="SUBINV_CODE" type="STRING" size="256"/>
          <Column id="FR_DATE" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row/>
        </Rows>
      </Dataset>
      <Dataset id="ds_excel" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_physic_value" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_Cond" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="UPJANG" type="STRING" size="256"/>
          <Column id="CLASS" type="STRING" size="256"/>
          <Column id="SUBINV_CODE" type="STRING" size="256"/>
          <Column id="SYS_CLASS" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_common">
        <ColumnInfo>
          <Column id="code" size="256" type="STRING"/>
          <Column id="codename" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Bind>
      <BindItem id="item0" compid="cbo_SubInv" propid="value" datasetid="ds_input" columnid="SUBINV_CODE"/>
      <BindItem id="item1" compid="me_Date" propid="value" datasetid="ds_input" columnid="FR_DATE"/>
    </Bind>
    <Script type="xscript4.0"><![CDATA[/*
 ******************************************************************************************
 * 시스템구분	: 구매관리>재고관리>재고등록
 * 프로그램명	: FSP00233V.xfdl
 * 기      능	: 재고등록
 * 작  성  자	: 백승현
 * 작성  일자	: 2015-07-15
 * 비      고	:
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */

/************************************************************************************************
 * 공통 라이브러리 INCLUDE 영역 (필수)
 ************************************************************************************************/
include "U_lib::lib_conversionCom.xjs";

/************************************************************************************************
 * FORM 변수 선언 영역 (필수)
 ************************************************************************************************/
var v_StockClose, v_NoStockConfirm, v_PreStock, v_SubulClose, v_StockConfirm, v_NoSubulClose, v_ChkDate, v_Claim;
var v_PO_PHYSICUPD_PRO;
var sPhysic_date, sOnhandMonth, sUpjangName;
var v_ExcelFlag = false;
var v_CloseYn = "N";
var v_DupScYn = "N";
/************************************************************************************************
 * FORM EVENT 영역 (필수)
 ************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : Form Load (필수)
 *---------------------------------------------------------------------------------------------*/
function form_onload(obj:Form, e:LoadEventInfo)
{
	// Form Load 시 공통 기능 처리(obj:Form, bCreateEvent:이벤트 생성 여부)
	gfn_formOnLoad(this);

	// FSP Action 정보 생성
	fsp_init(this);

	// 화면 초기화
	fn_init();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 화면 초기화
 *---------------------------------------------------------------------------------------------*/
function fn_init()
{
	// 업데이트 DS
	v_ds_check = "ds_stock";

	// 그리드 텍스트 변경 : 외식사업부 - 적정재고량, 그외 - 예상사용량
	if( g_Mu_Cd == "2003" )
		fn_setText("RSS")
	else
		fn_setText("FSP")

	// 공통코드 설정
	fn_PoCommon();

	// 사업장 정보 설정
	edt_tm.applyAuthLevel(cbo_mu);
	edt_upjang.applyAuthLevel(edt_tm);

    var f_currDate = fn_CurrDateWeek();
	me_Date.value  = f_currDate;

	if( me_Date.value < "20080701" )
	{
		g_Message("EE", "2008년7월1일 이전 데이터는 IFIS에서 재고등록할 수 없습니다.");
		me_Date.value = "20080701";
	}

	grdStock.setFormatColProperty(7, "size", 0);	// 수불단위
	grdStock.setFormatColProperty(10, "size", 0);	// 재고금액
	grdStock.setFormatColProperty(13, "size", 0);	// 실사금액
	grdStock.setFormatColProperty(15, "size", 0);	// 사용금액

	if(gfn_length(gfn_trim(application.g_Upjang))> 0)
	{
		ds_input.setColumn(0, "UPJANG", application.g_Upjang);
		ds_input.setColumn(0, "UPJANGNM", application.g_UpjangNm);
		fn_subInvPopup();
		cbo_SubInv.index = 0;
	}

	// 중복 사용 방지 때문에 창 빼기 버튼은 비활성화
//	div_cmnBtn.btn_popup.enable = false;

	// 해당 권한 사용자는 중복 접속 가능함 (관리자(99), 관리자(999), BU권한자(80) )
//	if( SCAuth.isAuthLevel("99") || SCAuth.isAuthLevel("999") || SCAuth.isAuthLevel("80") )
//	{
//		v_DupScYn = "N";
//	}
//	else
//	{
//		v_DupScYn = "Y";
//	}
	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 화면 공통 단축키 이벤트
 *---------------------------------------------------------------------------------------------*/
function frm_OnKeyDown(obj:Form, e:KeyEventInfo)
{
	gfn_formKeyDown(obj, e);

	// 엔터시 조회
	if ( e.keycode == 13 && e.fromreferenceobject == me_Date )
		fn_search();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 화면 활성화 이벤트
 *---------------------------------------------------------------------------------------------*/
function FSP00230E_OnActivate(obj:Form, e:ActivateEventInfo)
{
	chk_PhysicQty.value = 0;
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 화면 종료 전 이벤트
 *---------------------------------------------------------------------------------------------*/
function frm_onbeforeclose(obj:Form, e:CloseEventInfo)
{
	if( v_DupScYn == "Y" )
	{
		if( v_CloseYn == "N" && gfn_isNull(gfn_trim(cbo_SubInv.value)) == false )
		{
			fn_dupScreen("D", cbo_SubInv.value);
		}

		return true;
	}
	else
	{
		return true;
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 화면 종료 이벤트
 *---------------------------------------------------------------------------------------------*/
function frm_onclose(obj:Form, e:CloseEventInfo)
{
	if( v_DupScYn == "Y" )
	{
		if( v_CloseYn == "N" && gfn_isNull(gfn_trim(cbo_SubInv.value)) == false )
		{
			fn_dupScreen("D", cbo_SubInv.value);
		}

		return true;
	}
	else
	{
		return true;
	}
}

/************************************************************************************************
 * 공통기능 FUNCTION 영역 (필수)
 ************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 조회 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_search()
{
	if(me_Date.value > '20200131' && g_Mu_Cd == '2003'){
		g_Message("EE", "외식사업부는 조사일자 2/1이후로 FIMS에서 실사등록이 불가합니다.(구매시스템에서 실사등록 필요)");
		cbo_mu.enable		= false;
		edt_tm.enable		= false;
		edt_upjang.enable	= false;
		cbo_SubInv.enable	= false;
		me_Date.enable		= false;
		btn_Date.enable		= false;
		chk_PoUom.enable	= false;
		//btn_StkInit.enable  = false;
	}
		
	if( gfn_length(gfn_trim(cbo_SubInv.value)) == 0 )
	{
		g_Message("EE", "창고를 선택하세요.");
		return;
	}

	if( gfn_length(gfn_trim(me_Date.value)) == 0 )
	{
		g_Message("EE", "조사일을 선택하세요.");
		return;
	}

	if( me_Date.value < "20080701" )
	{
		g_Message("EE", "2008년7월1일 이전 데이터는 IFIS에서 재고작업할 수 없습니다.");
		me_Date.setFocus();
		return;
	}

	var v_MenuQty = "";
	if( cbo_mu.getMuCode() == "2003" )
		v_MenuQty = "RSS";
	else
		v_MenuQty = "FSP";

	v_StockClose = "";
	v_NoStockConfirm = "";
	v_SubulClose = "";
	v_StockConfirm = "";
	v_NoSubulClose = "";
	v_ChkDate = "";
	v_PreStock = "";
	v_Claim = "";

	ds_po.clearData();
	ds_stock.clearData();

	var strSvcID = "search";
	var strURL   = "U_svc::" + "fs/fsp/FSP00230E_S002.jsp";
	var strInDatasets = "dsPoLineStatus=dsPoLineStatus";
	var strOutDatasets = "ds_stock=ds_stock ds_po=ds_po";
	var strArgument  = "v_SubinvCode=" + wrapQuote(cbo_SubInv.value);
		strArgument += " v_chkPoUom=" + wrapQuote(chk_PoUom.value);
		strArgument += " v_chkPhysicQty=" + wrapQuote(chk_PhysicQty.value);
		strArgument += " v_chkAmt=" + wrapQuote(chk_Amt.value);
		strArgument += " v_Upjang=" + wrapQuote(ds_input.getColumn(0, "UPJANG"));
		strArgument += " v_Date=" + wrapQuote(me_Date.value);
		strArgument += " v_MenuQty=" + wrapQuote(v_MenuQty);
	var strCallbackFunc = "fn_callback";

	jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, true, true, false);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 입력 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_insert()
{

}

/*----------------------------------------------------------------------------------------------
 * 설명      : 저장 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_save()
{
	if( gfn_isNull(cbo_SubInv.value) )
	{
		g_Message("EE","창고를 선택하세요.");
		return;
	}

	if( gfn_isNull(me_Date.value) )
	{
		g_Message("EE", "조사일을 선택하세요.");
		return;
	}

	if( ds_stock.rowcount == 0 )
	{
		g_Message("EE", "저장할 자료가 없습니다!");
		return;
	}

	if( gfn_subStr(cbo_SubInv.value, 0, 1) == "A" )
	{
		var nIdx3 = ds_stock.findRowExpr("M_STK_QTY<0&&M_REAL_QTY>0");
		if( nIdx3 >= 0 )
		{
			g_Message("EE", "재고량이 '-'일 경우 실사량은 '0'만 가능합니다.");
			ds_stock.rowposition = nIdx3;
			return;
		}
	}
	else
	{
		var nIdx1 = ds_stock.findRowExpr("M_USE_QTY<0");
		//var nIdx2 = ds_stock.findRowExpr("M_REAL_QTY>M_STK_QTY");
		var nIdx2 = -1;
		var nIdx3 = "";
		//실사량-재고량이 0보다 큰 값이 있으면 nIdx2 값을 0으로 변경(findRowExpr 사용 시 소수점인 경우 문제 발생) 2017.05.02 김호석 선처리(오류건)
		for( var i = 0; i < ds_stock.getCountNF(); i++ )
		{
			nIdx3 = ds_stock.getColumn(i,"M_REAL_QTY")-ds_stock.getColumn(i,"M_STK_QTY");
			if (nIdx3 > 0)
			{
				nIdx2 = 0;
			}
		}
		
		if( nIdx1 >= 0 || nIdx2 >= 0 )
		{
			g_Message("EE","실사량은 재고량보다 클 수 없습니다.");
			ds_stock.rowposition = nIdx2;
			return;
		}
	}

	// 유통기한 체크
	if( !fn_valueDateChk() )	return;

	if( !g_Confirm("02", "임시저장 하시겠습니까?!") )	return;

	v_PO_PHYSICUPD_PRO = "";
	v_ChkDate = "";

	var strSvcID = "save";
	var strURL = "U_svc::" + "fs/fsp/FSP00230E_T003.jsp";
	var strInDatasets = "ds_stock=ds_stock";
	var strOutDatasets = "";
	var strArgument  = "v_SubinvCode=" + wrapQuote(cbo_SubInv.value);
		strArgument += " v_chkPoUom=" + wrapQuote(chk_PoUom.value);
		strArgument += " v_Date=" + wrapQuote(me_Date.value);
		strArgument += " v_status=''";
		strArgument += " v_trType='T'";	// 임시저장 : T, 재고실사 : I

	var strCallbackFunc = "fn_callback";

	jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, true, true, false);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 삭제 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_delete()
{

}

/*----------------------------------------------------------------------------------------------
 * 설명      : 출력 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_print()
{
	if( ds_stock.rowcount == 0 )
	{
		g_Message("EE", "출력할 데이터가 없습니다!\n조회를 먼저 하시기 바랍니다.");
		return;
	}

	sPhysic_date = "";
	sOnhandMonth = "";
	sUpjangName = "";

	var sMeDate = gfn_subStr(me_Date.value, 0, 4) + "년 " + gfn_subStr(me_Date.value, 4, 2) + "월 " + gfn_subStr(me_Date.value, 6, 2) + "일";

	var strSvcID = "FSP00230E_S003";
	var strURL   = "U_svc::" + "fs/fsp/FSP00230E_S003.jsp";
	var strInDatasets = "";
	var strOutDatasets = "";
	var strArgument  = "v_SubinvCode=" + wrapQuote(cbo_SubInv.value);
		strArgument += " v_Date=" + wrapQuote(me_Date.value);
	var strCallbackFunc = "";
	
	jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, false, false, true);

	// 레포트에 전달할 파라메터 생성
	var arrParams = SCReport.newParams();

	// 레포트 url
	SCReport.setParams (arrParams, SCReport.RPT_NAME, "/IFIS/FSP00230E_재고조사표.ozr");
	
	// 출력 옵션 설정
	SCReport.setParams(arrParams, SCReport.RPT_TITLE, "재고조사표");

	// 레포트에 맞게 전달되는 개발자 정의 파라미터
	SCReport.setParams (arrParams, "PARAM1", cbo_SubInv.value);	// 창고코드
	SCReport.setParams (arrParams, "PARAM2", sPhysic_date);		// 조사일
	SCReport.setParams (arrParams, "PARAM3", sOnhandMonth);		// 수불마감월
	SCReport.setParams (arrParams, "PARAM4", sUpjangName);		// 업장(창고명)
	SCReport.setParams (arrParams, "PARAM5", sMeDate);			// 재고조사일
	SCReport.setParams (arrParams, "PARAM6", "Y"); 				// 반영전:Y,반영후:N
	SCReport.setParams (arrParams, "PARAM7", chk_PoUom.value); 	// 구매단위:Y,수불단위:N
	
	if( cbo_mu.getMuCode() == "2003" )
		SCReport.setParams (arrParams, "PARAM8", "Y"); 	// 외식사업부:Y, 그외:N
	else
		SCReport.setParams (arrParams, "PARAM8", "N"); 	// 외식사업부:Y, 그외:N

	SCReport.setParams (arrParams, "zoom", 150);

	SCReport.viewReport (this, arrParams);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 엑셀 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_Excel(){}

/*----------------------------------------------------------------------------------------------
 * 설명      : 닫기 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_close()
{
	if( v_DupScYn == "Y" )
	{
		if( v_CloseYn == "N" && gfn_isNull(gfn_trim(cbo_SubInv.value)) == false )
		{
			fn_dupScreen("D", cbo_SubInv.value);
		}

		return true;
	}
	else
	{
		return true;
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 도움말 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_help(){}

/************************************************************************************************
 * TRANSACTION 및 CallBack 영역 (필수)
 ************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 트랜잭션 콜백 함수
 *---------------------------------------------------------------------------------------------*/
function fn_callback(nErrorCode, strErrorMsg, strSvcID)
{
	// 에러시 gfn_callBack에서 메시지 제공, 화면별 특정 에러 발생시에만 사용하세요.
	if (nErrorCode < 0)
	{
		g_Message("EE","시스템오류 ! 전산 담당자에게 문의 하세요.\n" + strErrorMsg);
		ds_stock.clearData();
		return;
	}

	switch( strSvcID )
	{
		// 조회
		case "search" :
			if( nErrorCode != 0 )
			{
				g_Message("EE","시스템오류 ! 전산 담당자에게 문의 하세요.\n" + errMsg);
				ds_stock.clearData();
				return;
			}

			// 재고마감되어 등록할 수 없습니다.\n재고마감관리자에게 연락하세요.
			if( gfn_length(gfn_trim(v_StockClose)) != 0 )
			{
				g_Message("EE", v_StockClose);
				ds_stock.clearData();
				return;
			}

			// 현창고는 수불마감(" + rs.getString("CLS_YYYYMM") + ")이 \n완료되어 본작업이 불가합니다!
			if( gfn_length(gfn_trim(v_SubulClose)) != 0 )
			{
				g_Message("EE", v_SubulClose);
				ds_stock.clearData();
				return;
			}

			// 현창고는 재고조사(" + rs.getString("PHYSIC_DATE") + ")가\n 반영되어 본작업이 불가합니다!
			if( gfn_length(gfn_trim(v_StockConfirm)) != 0 )
			{
				g_Message("EE",v_StockConfirm);
				ds_stock.clearData();
				return;
			}

			// 재고 조사일은 현재일보다 작거나 같아야 합니다.
			if( gfn_length(gfn_trim(v_ChkDate)) != 0 )
			{
				g_Message("EE", v_ChkDate);
				ds_stock.clearData();
				return;
			}

			// 클레임 처리 중인 건이 존재합니다.\n처리 후 재고조사를 하시기 바랍니다
			if( gfn_length(gfn_trim(v_Claim)) != 0 )
			{
				g_Message("EE", v_Claim);
				ds_stock.clearData();
				return;
			}

			//미입고내역이 있을 경우 팝업창을 띄워준다.
			if( ds_po.rowcount > 0 )
			{
				var v_msg, v_ret, v_param;

				v_msg  = "전일 발주자료에 대한 입고완료가 이루어지지\n않아 재고조사 등록이 불가합니다! ";
				v_msg += "\n입고처리를 물류시스템으로 했는지 확인 요청해야함\n(센터 담담자에게 연락)\n미입고내역을 확인하시겠습니까?";

				if( g_Confirm("02", v_msg) )
					v_ret = gfn_dialog("", "U_FSP::FSP00231E.xfdl", v_param);

				ds_stock.clearData();
				return;
			}

			if( ds_stock.rowcount == 0 )
			{
				g_Message("EE","재고내역이 존재하지 않습니다!");
				return;
			}

			// 월마감 체크
			var dateFr = me_Date.value;
/*
			mfn_GetClsStatus(dateFr.substr(0, 6));
			if( ds_common.rowcount > 0 )
			{
				g_Message("EE", dateFr.substr(0, 4) + "년 " + dateFr.substr(4, 2) + "월 마감이 완료되어 본작업이 불가합니다!");
				ds_stock.clearData();
				return;
			}
*/
			// 월마감 체크 함수 수정 2015.12.28
			mfn_GetCcMonthClsYn("U", edt_upjang.getUpjangCode(), dateFr.substr(0, 6), "01");

			if( ds_common.getColumn(0, 0) == "Y" )
			{
				g_Message("EE", dateFr.substr(0, 4) + "년 " + dateFr.substr(4, 2) + "월 마감이 완료되어 본작업이 불가합니다!(재경팀 월마감 담당자 확인 필요)");
				ds_stock.clearData();
				return;
			}

			if( gfn_length(gfn_trim(v_PreStock)) != 0 )
			{
				g_Message("EE", v_PreStock);
			}

			cbo_mu.enable		= false;
			edt_tm.enable		= false;
			edt_upjang.enable	= false;
			cbo_SubInv.enable	= false;
			me_Date.enable		= false;
			btn_Date.enable		= false;
			chk_PoUom.enable	= false;

			if(chk_PoUom.value == "Y")
			{
				grdStock.setFormatColProperty(6, "size", 60);	// 구매단위
				grdStock.setFormatColProperty(7, "size", 0);	// 수불단위
			}
			else
			{
				grdStock.setFormatColProperty(6, "size", 0);
				grdStock.setFormatColProperty(7, "size", 60);
			}

			if(chk_Amt.value == "Y")
			{
				grdStock.setFormatColProperty(10, "size", 70);	// 재고금액
				grdStock.setFormatColProperty(13, "size", 70);	// 실사금액
				grdStock.setFormatColProperty(15, "size", 70);	// 사용금액
			}
			else
			{
				grdStock.setFormatColProperty(10, "size", 0);
				grdStock.setFormatColProperty(13, "size", 0);
				grdStock.setFormatColProperty(15, "size", 0);
			}

			// 실사량 != 재고량일 경우 기존 재고조사 내역이 있을 경우 기존 재고조사 내역을 계산한다.
			ds_stock.updatecontrol = false;

			if( chk_PhysicQty.value == "N" )
			{
				grdStock.enableredraw = false;

				for( var i = 0; i < ds_stock.getCountNF(); i++ )
				{
					if( fn_clearNaN(toNumber(ds_stock.getColumn(i, "ADV_PHYSIC_QTY"))) != 0 )
					{
						ds_stock.setColumn(i,"M_REAL_QTY", ds_stock.getColumn(i,"ADV_PHYSIC_QTY"));
						ds_stock.setColumn(i,"M_REAL_QTY_SUM", ds_stock.getColumn(i,"ADV_PHYSIC_QTY"));
					}
					else
					{
						ds_stock.setColumn(i,"M_REAL_QTY", 0);
						ds_stock.setColumn(i,"M_REAL_QTY_SUM", ds_stock.getColumn(i,"ADV_PHYSIC_QTY"));
					}
				}

				grdStock.enableredraw = true;
			}

			if( (gfn_nvl(ds_stock.getSum("M_STK_QTY"), 0) != gfn_nvl(ds_stock.getSum("M_REAL_QTY"), 0)) && gfn_nvl(ds_stock.getSum("M_REAL_QTY"), 0) > 0)
			{
				chk_PhysicQty.enable = false;
			}
			else
			{
				chk_PhysicQty.enable = true;
			}
			break;

		// 저장
		case "save":
			if( nErrorCode != 0 )
			{
				g_Message("EE", "시스템오류 ! 전산 담당자에게 문의 하세요.\n" + strErrorMsg);
				return;
			}
			else
			{
				// 현창고는 재고 조사가 반영되어 본작업이 불가합니다!
				if( gfn_length(gfn_trim(v_StockConfirm)) != 0 )
				{
					g_Message("EE",v_StockConfirm);
					return;
				}

				// 현창고는 수불마감(" + nullToBlank(rs.getString("CLS_YYYYMM")) + ")이 \n완료되어 본작업이 불가합니다!
				if( gfn_length(gfn_trim(v_SubulClose)) != 0 )
				{
					g_Message("EE", v_SubulClose);
					return;
				}

				// 구매 SP 호출 후 리턴 메세지 처리
				if( gfn_length(gfn_trim(v_PO_PHYSICUPD_PRO)) != 0 )
				{
					g_Message("EE", v_PO_PHYSICUPD_PRO);
					return;
				}
				else
				{
					g_Message("02", "정상적으로 저장되었습니다.");

					ds_stock.clearData();
					ds_po.clearData();
					edt_upjang.enable = true;
					cbo_SubInv.enable = true;
					me_Date.enable = true;
					btn_Date.enable = true;
					chk_PoUom.enable = true;
					chk_PhysicQty.value = "N";
				}
			}
			break;

		// 전일자 추가정보 복사
		case "physic_value":
			if( ds_physic_value.rowcount == 0 )
			{
				g_Message("EE", "전일 반영된 제조일, 유통기한, 비고 정보가 없습니다.");
				return;
			}

			for( var i = 0; i < ds_stock.rowcount; i++ )
			{
				var nRow = ds_physic_value.findRow("ITEM_CODE", ds_stock.getColumn(i, "ITEM_CODE"));

				if( nRow > -1 )
				{
					if( ffn_ChkNull(ds_stock.getColumn(i, "MAKER_DATE")) )
					{
						ds_stock.setColumn(i, "MAKER_DATE", ds_physic_value.getColumn(nRow, "MAKER_DATE"))
					}

					if( ffn_ChkNull(ds_stock.getColumn(i, "VALUE_DATE")) )
					{
						ds_stock.setColumn(i, "VALUE_DATE", ds_physic_value.getColumn(nRow, "VALUE_DATE"))
					}

					if( ffn_ChkNull(ds_stock.getColumn(i, "VALUE_DATE_INFO")) )
					{
						ds_stock.setColumn(i, "VALUE_DATE_INFO", ds_physic_value.getColumn(nRow, "VALUE_DATE_INFO"))
					}
				}
			}

			g_Message("EE", "전일 반영된 제조일, 유통기한, 비고 정보가 복사됐습니다.");
			break;

		default:
			break;
	}
}

/************************************************************************************************
 * 사용자 FUNCTION 영역 (필수)
 ************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 창고 조회
 *---------------------------------------------------------------------------------------------*/
function fn_subInvPopup()
{
	ds_stock.clearData();

	var strPOQuery_SUBINV              = "";
	var strPOQuery_SUBINVKeyField      = "SUBINV_CODE";
	var strPOQuery_SUBINVValueField    = "SUBINV_NAME || UPJANGNM";
	var strPOQuery_SUBINVKeyFieldNM    = "창고코드";
	var strPOQuery_SUBINVValueFieldNM  = "창고명";
	var strPOQuery_SUBINVCaption       = "창고정보조회";

	strPOQuery_SUBINV += "SELECT A.SUBINV_CODE \n";
    strPOQuery_SUBINV += "     , DECODE(A.USE_YN, 'N' , '폐장' )||A.SUBINV_NAME||' ( '||REPLACE(B.UPJANGNM,'단체급식 ')||' ) ' SUBINV_NAME \n";
    strPOQuery_SUBINV += " FROM HLDC_PO_SUBINVENTORY A \n";
    strPOQuery_SUBINV += "    , HLDC_ST_UPJANG B \n";
    strPOQuery_SUBINV += " WHERE A.UPJANG = B.UPJANG \n";
    strPOQuery_SUBINV += "   AND A.USE_YN = 'Y' \n";
    strPOQuery_SUBINV += "   AND A.STOCK_FLAG = 'Y' \n";
	strPOQuery_SUBINV += "   AND B.UPJANG = " + gfn_toString(ds_input.getColumn(0, "UPJANG")) + " \n";
	strPOQuery_SUBINV += "ORDER BY CASE WHEN SUBSTR(A.SUBINV_CODE, 0, 1) = 'C' THEN 0 \n";
	strPOQuery_SUBINV += "              WHEN SUBSTR(A.SUBINV_CODE, 0, 1) = 'E' THEN 1 \n";
	strPOQuery_SUBINV += "              WHEN SUBSTR(A.SUBINV_CODE, 0, 1) = 'A' THEN 2 \n";
	strPOQuery_SUBINV += "              ELSE 4 END, A.SUBINV_CODE \n";

    fn_sql_common(
	              "C"
	             ,strPOQuery_SUBINV
	             ,""
	             ,""
	             ,""
	             ,cbo_SubInv
	             ,-1
	             ,ds_subinv
	             ,false
	             ,"SUBINV_CODE;SUBINV_NAME"
	             );

	cbo_SubInv.index =0;
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 유통기한기준 +7일 까지 Red로 라인표시
 *---------------------------------------------------------------------------------------------*/
function fn_setBgColor(sDate)
{
	var strToday	= me_Date.value;				// 현재일자
	var strToDate	= gfn_addDate(strToday, "7");	// 현재일자 + 7

	if( sDate <> "" )
	{
		if( strFromDate <= sDate && sDate <= strToDate )
			return 'orangered';
		else
			return 'white';
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 유통기한기준 +7일 까지 Red로 라인표시(실사량, 유통기한, 비고는 따로 설정한다.)
 *---------------------------------------------------------------------------------------------*/
function fn_setBgColor2(sDate)
{
	var strToday	= me_Date.value;				// 현재일자
	var strToDate	= gfn_addDate(strToday, "7");	// 현재일자 + 7

	if( sDate <> "" )
	{
		if( strFromDate <= sDate && sDate <= strToDate )
			return 'orangered';
		else
			return 'cornsilk';
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 그리드 텍스트 변경
 *---------------------------------------------------------------------------------------------*/
function fn_setText(sType)
{
	if( sType == "RSS" )
		grdStock.setCellProperty("head", 11, "text", "적정&#13;&#10;재고량");
	else
		grdStock.setCellProperty("head", 11, "text", "예상&#13;&#10;사용량");
}

/************************************************************************************************
 * 각 COMPONENT 별 EVENT 영역 (필수)
 ************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 사업부 콤보 변경 이벤트
 *---------------------------------------------------------------------------------------------*/
function fn_muChange(obj, event)
{
	edt_tm.setTmCode("");
	edt_upjang.setUpjangCode("");
	fn_subInvPopup();

	if( cbo_mu.getMuCode() == "2003" )
		fn_setText("RSS");
	else
		fn_setText("FSP");
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 팀 변경 이벤트
 *---------------------------------------------------------------------------------------------*/
function fn_tmChange(obj, data)
{
	edt_upjang.setUpjangCode("");
	fn_subInvPopup();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 조회 취소
 *---------------------------------------------------------------------------------------------*/
function btn_StkInit_OnClick(obj:Button,  e:ClickEventInfo)
{
	if( gfn_dsIsUpdated(ds_stock) )
	{
		if( !g_Confirm("02", "미저장 데이터가 있습니다.\n계속하시겠습니까?") )	return;
	}

	// 데이터셋 초기화
	ds_po.clearData();
	ds_stock.clearData();

	cbo_mu.enable		 = true;
	edt_tm.enable		 = true;
	edt_upjang.enable	 = true;
	cbo_SubInv.enable	 = true;
	me_Date.enable		 = true;
	btn_Date.enable		 = true;
	chk_PoUom.enable	 = true;
	chk_PhysicQty.enable = true;
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 조회조건 변경 이벤트
 *---------------------------------------------------------------------------------------------*/
function ds_input_oncolumnchanged(obj:Dataset, e:DSColChangeEventInfo)
{
	if( e.columnid == "FR_DATE" )
	{
		if( gfn_length(me_Date.value) == 8 && me_Date.value < "20080701" )
		{
			g_Message("EE", "2008년7월1일 이전 데이터는 IFIS에서 재고작업할 수 없습니다.");
			me_Date.value = "20080701";
		}
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 실사량 입력시 .n 입력시 소수점 앞에 0 자동 입력
 *---------------------------------------------------------------------------------------------*/
function ds_stock_cancolumnchange(obj:Dataset, e:DSColChangeEventInfo)
{
	if( e.columnid == "M_REAL_QTY" )
	{
		var sQty = e.newvalue;

		if( sQty.indexOf(".") == 0 )
		{
			var newValue = "0" + sQty;
			
			if(!gfn_isNum(newValue))
			{
				g_Message("EE", "[" + ds_stock.getColumn(e.row, "ITEM_NAME") + "]\n실사량 수치가 부적합 합니다. 확인 부탁드립니다. (" + e.newvalue + ")");
				return;
			}
		
			e.newvalue = "0" + sQty;
		}
		else
		{
			if(!gfn_isNum(e.newvalue))
			{
				g_Message("EE", "[" + ds_stock.getColumn(e.row, "ITEM_NAME") + "]\n실사량 수치가 부적합 합니다. 확인 부탁드립니다. (" + e.newvalue + ")");
				e.newvalue = e.oldvalue;
				return;
			}
		}
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 재고실사 데이터 변경시 이벤트
 *---------------------------------------------------------------------------------------------*/
function ds_stock_OnColumnChanged(obj:Dataset, e:DSColChangeEventInfo)
{
	var strMsg;

	// 실사량
	if( e.columnid == "M_REAL_QTY" )
	{
		// (-)등록 여부 점검
		if( toNumber(ds_stock.getColumn(e.row, "M_REAL_QTY")) < 0 )
		{
			g_Message("EE", "※ (-) 재고등록 불가!!");
			ds_stock.setColumn(e.row, "M_REAL_QTY", e.oldvalue);
			ds_stock.setColumn(e.row, "M_REAL_QTY_SUM", e.oldvalue);
			return;
		}

		// 재고량 보다 실사량이 클 경우
		if( !v_ExcelFlag )
		{
			if( toNumber(ds_stock.getColumn(e.row, "M_REAL_QTY")) > toNumber(ds_stock.getColumn(e.row, "M_STK_QTY")) )
			{
				g_Message("EE", "※ 실사량은 재고량 보다 클 수 없습니다.!!");
				ds_stock.setColumn(e.row, "M_REAL_QTY", e.oldvalue);
				ds_stock.setColumn(e.row, "M_REAL_QTY_SUM", e.oldvalue);
				return;
			}
		}

		var stkQty  = toNumber(ds_stock.getColumn(e.row, "M_STK_QTY"));		// 재고량
		var realQty = toNumber(ds_stock.getColumn(e.row, "M_REAL_QTY"));	// 실사량
		var useQty  = stkQty - realQty;										// 사용량

		ds_stock.setColumn(e.row, "M_REAL_QTY_SUM", e.newvalue);
		ds_stock.setColumn(e.row, "M_USE_QTY", useQty);

		// 실사량이 0 인경우 현 재고량은 곧 사용량이 된다.
		if( realQty == 0 )
		{
			ds_stock.setColumn(e.row, "M_REAL_AMT", 0);										// 실사금액(출하)
			ds_stock.setColumn(e.row, "U_REAL_AMT", 0);										// 실사금액(매입)
			ds_stock.setColumn(e.row, "M_USE_AMT", ds_stock.getColumn(e.row, "M_STK_AMT"));	// 사용금액(출하)
			ds_stock.setColumn(e.row, "U_USE_AMT", ds_stock.getColumn(e.row, "U_STK_AMT"));	// 사용금액(매입)
		}
		else
		{
			var mUseAmt = Math.round(useQty * toNumber(ds_stock.getColumn(e.row, "M_STK_PRICE")));
			var uUseAmt = Math.round(useQty * toNumber(ds_stock.getColumn(e.row, "U_STK_PRICE")));
			var mRealAmt = toNumber(ds_stock.getColumn(e.row, "M_STK_AMT")) - mUseAmt;
			var uRealAmt = toNumber(ds_stock.getColumn(e.row, "U_STK_AMT")) - uUseAmt;

			ds_stock.setColumn(e.row, "M_USE_AMT", mUseAmt);
			ds_stock.setColumn(e.row, "M_REAL_AMT", mRealAmt);
			ds_stock.setColumn(e.row, "U_USE_AMT", uUseAmt);
			ds_stock.setColumn(e.row, "U_REAL_AMT", uRealAmt);
		}
	}

	if( e.columnid == "VALUE_DATE" )
	{
		if( !gfn_isNull(e.newvalue) )
		{
			var strDate = me_Date.value;
			var strToDate = gfn_addDate(strDate, "7");	// 현재일자 + 7

			if( e.newvalue <= strToDate )
				obj.setColumn(e.row, "BG_YN", "Y");
			else
				obj.setColumn(e.row, "BG_YN", "N");
		}
		else
		{
			obj.setColumn(e.row, "BG_YN", "N");
		}
	}
	if( e.columnid == "MAKER_DATE" )
	{
		if( !gfn_isNull(e.newvalue) )
		{
			if( !gfn_isDate(e.newvalue) )
			{
				g_Message("EE", "[" + ds_stock.getColumn(e.row, "ITEM_NAME") + "] 자재의 제조일 입력 날짜가 정확하지 않습니다.");
				ds_stock.setColumn(e.row, "MAKER_DATE", "");
			}

			if( gfn_subStr(e.newvalue, 0, 1) == "0" ) {
				g_Message("EE", "[" + ds_stock.getColumn(e.row, "ITEM_NAME") + "] 자재의 제조일 년도가 정확하지 않습니다.");
				ds_stock.setColumn(e.row, "MAKER_DATE", "");
			}			
		}		
	}

	if( !v_ExcelFlag )
	{
		if( e.columnid == "VALUE_DATE" )
		{
			if( !gfn_isNull(e.newvalue) )
			{
				if( !gfn_isDate(e.newvalue) )
				{
					g_Message("EE", "[" + ds_stock.getColumn(e.row, "ITEM_NAME") + "] 자재의 제조일 입력 날짜가 정확하지 않습니다.");
					ds_stock.setColumn(e.row, "VALUE_DATE", "");

				}
			}
		}

		if( e.columnid == "MAKER_DATE" )
		{
			if( !gfn_isNull(e.newvalue) )
			{
				if( !gfn_isDate(e.newvalue) )
				{
					g_Message("EE", "[" + ds_stock.getColumn(e.row, "ITEM_NAME") + "] 자재의 제조일 입력 날짜가 정확하지 않습니다.");
					ds_stock.setColumn(e.row, "MAKER_DATE", "");

				}
			}
		}
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 재고실사 등록
 *---------------------------------------------------------------------------------------------*/
function btn_tempSave_onclick(obj:Button,  e:ClickEventInfo)
{
	if( gfn_isNull(cbo_SubInv.value) )
	{
		g_Message("EE","창고를 선택하세요.");
		return;
	}

	if( gfn_isNull(me_Date.value) )
	{
		g_Message("EE", "조사일을 선택하세요.");
		return;
	}

	if( ds_stock.rowcount == 0 )
	{
		g_Message("EE", "저장할 자료가 없습니다!");
		return;
	}

	if( gfn_subStr(cbo_SubInv.value, 0, 1) == "A" )
	{
		var nIdx3 = ds_stock.findRowExpr("M_STK_QTY<0&&M_REAL_QTY>0");
		if( nIdx3 >= 0 )
		{
			g_Message("EE", "재고량이 '-'일 경우 실사량은 '0'만 가능합니다.");
			ds_stock.rowposition = nIdx3;
			return;
		}
	}
	else
	{
		var nIdx1 = ds_stock.findRowExpr("M_USE_QTY<0");
		var nIdx2 = ds_stock.findRowExpr("M_REAL_QTY>M_STK_QTY");

		if( nIdx1 >= 0 || nIdx2 >= 0 )
		{
			g_Message("EE","실사량은 재고량보다 클 수 없습니다.");
			ds_stock.rowposition = nIdx2;
			return;
		}
	}

	// 유통기한 체크
	if( !fn_valueDateChk() )	return;

	if( !g_Confirm("02", "재고실사를 등록하시겠습니까?!") )	return;

	v_PO_PHYSICUPD_PRO = "";
	v_StockConfirm = "";
	v_SubulClose = "";
	v_ChkDate = "";

	var strSvcID = "save";
	var strURL = "U_svc::" + "fs/fsp/FSP00230E_T003.jsp";
	var strInDatasets = "ds_stock=ds_stock";
	var strOutDatasets = "";
	var strArgument  = "v_SubinvCode=" + wrapQuote(cbo_SubInv.value);
		strArgument += " v_chkPoUom=" + wrapQuote(chk_PoUom.value);
		strArgument += " v_Date=" + wrapQuote(me_Date.value);
		strArgument += " v_status='N'";
		strArgument += " v_trType='I'";	// 임시저장 : T, 재고실사 : I

	var strCallbackFunc = "fn_callback";

	jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, true, true, false);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 엑셀 업로드
 *---------------------------------------------------------------------------------------------*/
function btn_excel_onclick(obj:Button,  e:ClickEventInfo)
{
	if( gfn_isNull(cbo_SubInv.value) )
	{
		g_Message("EE","창고를 선택하세요.");
		return;
	}

	if( gfn_isNull(me_Date.value) )
	{
		g_Message("EE", "조사일을 선택하세요.");
		return;
	}

	if( ds_stock.rowcount == 0 )
	{
		g_Message("EE", "조회된 자료가 없습니다.");
		return;
	}

	//엑셀 임포트
	fd_Excel.Type = "OPEN";
	fd_Excel.Filter = "Excel File(*.xls;*.xlsx)|*.xls;*.xlsx|All(*.*)|*.*|";

	if( fd_Excel.Open() )
	{
		var sFullFileName = fd_Excel.FilePath + '\\' + fd_Excel.FileName;
		grdStock.enableredraw = false;
		ds_excel.clearData();
		//ext_ExcelImportByIndex(파일풀패스, 시트순번, 깡통데이타셑);
		ext_ExcelImportByIndex(sFullFileName, 0, "ds_excel");
		v_ExcelFlag = true;
		fn_SetImpData();
		grdStock.enableredraw = true;
		v_ExcelFlag = false;
		g_Message("EE", "엑셀 업로드가 완료됐습니다.");

	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 엑셀 업로드
 *---------------------------------------------------------------------------------------------*/
function fn_SetImpData()
{
	if( ds_excel.rowcount == 0 || ds_excel.rowcount == 1 )	return;

	// 업장, 창고 추가
	for( var i = 0; i < ds_excel.rowcount; i++ )
	{
		var nRow = ds_stock.findRow("ITEM_CODE", ds_excel.getColumn(i, "Col04"));

		if( nRow == -1 )	continue;

		ds_stock.setColumn(nRow, "M_REAL_QTY", gfn_nvl(ds_excel.getColumn(i, "Col13"), 0).replace("..", "."));
		ds_stock.setColumn(nRow, "M_REAL_QTY_SUM", gfn_nvl(ds_excel.getColumn(i, "Col13"), 0));

		if( toNumber(ds_stock.getColumn(nRow, "M_REAL_QTY")) > toNumber(ds_stock.getColumn(nRow, "M_STK_QTY")) )
		{
			g_Message("EE", "[" + ds_stock.getColumn(nRow, "ITEM_CODE") + "]" + ds_stock.getColumn(nRow, "ITEM_NAME") + "\n실사량은 재고량 보다 클 수 없습니다.");
			ds_stock.setColumn(nRow, "M_REAL_QTY", 0);
			ds_stock.setColumn(nRow, "M_REAL_QTY_SUM", 0);
			return;
		}

		if( !gfn_isNull(ds_excel.getColumn(i, "Col17")) )
		{
			var sDate = ds_excel.getColumn(i, "Col17").replace("-", "");

			if( !gfn_isDate(sDate.substr(0, 8)) )
			{
				g_Message("EE", "[" + ds_stock.getColumn(nRow, "ITEM_NAME") + "] 자재의 유효기간 입력 날짜가 정확하지 않습니다.");
			}
			else
			{
				ds_stock.setColumn(nRow, "VALUE_DATE",  ds_excel.getColumn(i, "Col17").substr(0, 8));
			}
		}
		if( !gfn_isNull(ds_excel.getColumn(i, "Col18")) )
		{
			var sDate = ds_excel.getColumn(i, "Col18").replace("-", "");

			if( !gfn_isDate(sDate.substr(0, 8)) )
			{
				g_Message("EE", "[" + ds_stock.getColumn(nRow, "ITEM_NAME") + "] 자재의 제조일 입력 날짜가 정확하지 않습니다.");
			}
			else
			{
				ds_stock.setColumn(nRow, "MAKER_DATE", ds_excel.getColumn(i, "Col18").substr(0, 8));
			}
		}
		if( !gfn_isNull(ds_excel.getColumn(i, "Col19")) )
		{
			ds_stock.setColumn(nRow, "VALUE_DATE_INFO", ds_excel.getColumn(i, "Col19"));
		}
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 전일 추가정보 복사
 *---------------------------------------------------------------------------------------------*/
function btn_physic_value_onclick(obj:Button,  e:ClickEventInfo)
{
	if( gfn_length(gfn_trim(cbo_SubInv.value)) == 0 )
	{
		g_Message("EE", "창고를 선택하세요.");
		cbo_SubInv.setFocus();
		return;
	}

	if( gfn_length(gfn_trim(me_Date.value)) == 0 )
	{
		g_Message("EE", "조사일을 선택하세요.");
		me_Date.setFocus();
		return;
	}

	if( ds_stock.rowcount == 0 )
	{
		g_Message("EE", "조회된 자료가 없습니다.");
		return;
	}

	if( gfn_length(gfn_trim(me_Date2.value)) == 0 )
	{
		g_Message("EE", "복사일을 선택하세요.");
		me_Date2.setFocus();
		return;
	}

	if( !g_Confirm("02", "전일자 제조일, 유통기한, 비고를 복사하시겠습니까?") )	return;

	var strSvcID = "physic_value";
	var strURL   = "U_svc::" + "fs/fsp/FSP00230E_S004.jsp";
	var strInDatasets = "";
	var strOutDatasets = "ds_physic_value=ds_physic_value";
	var strArgument  = "v_SubinvCode=" + wrapQuote(cbo_SubInv.value);
		strArgument += " v_CopyDate=" + wrapQuote(me_Date2.value);
	var strCallbackFunc = "fn_callback";

	jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, true, true, false);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 유통기한, 제조일 셀에서 방향키 ↑↓ 이동시 셀의 커서를 가장 앞으로 보낸다.
 *---------------------------------------------------------------------------------------------*/
function grdStock_onkeyup(obj:Grid, e:KeyEventInfo)
{
	var sCellProperty = obj.getCellProperty("Body", obj.getCellPos(), "text");
	
	if( gfn_isNull(sCellProperty) )	return;
	
	var sBindNm = sCellProperty.replace("bind:", "");

	if( sBindNm == "VALUE_DATE" || sBindNm == "VALUE_DATE_INFO" || sBindNm == "MAKER_DATE" )
	{
		if( e.keycode == 38 || e.keycode == 40  )
		{
			obj.setEditSelect(0, -1);
		}
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 그리드에서 엔터키 입력시 포커스가 유통기한, 제조일에 있을경우 셀 전체선택
 *---------------------------------------------------------------------------------------------*/
function grdStock_onenterdown(obj:Grid, e:GridEditEventInfo)
{
	var sCellProperty = obj.getCellProperty("Body", obj.getCellPos(), "text");
	
	if( gfn_isNull(sCellProperty) )	return;
	
	var sBindNm = sCellProperty.replace("bind:", "");

	if( sBindNm == "VALUE_DATE" || sBindNm == "VALUE_DATE_INFO" || sBindNm == "MAKER_DATE" )
	{
		obj.setEditSelect(0, -1);
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 유통기한 체크
 *---------------------------------------------------------------------------------------------*/
function fn_valueDateChk()
{
	var physicDate = me_Date.value;

	for( var i = 0; i < ds_stock.rowcount; i++ )
	{
		var valueDate = ds_stock.getColumn(i, "VALUE_DATE");

		if( gfn_isNull(gfn_trim(valueDate)) )	continue;

		if( gfn_getDiffDay(physicDate, valueDate) < 0 )
		{
			ds_stock.rowposition = i;
			g_Message("EE", "유통기한이 경과한 식자재가 존재합니다.\n\n유통기한을 다시 확인하시기 바랍니다.");
			grdStock.setCellPos(16);
			grdStock.showEditor(true);
			return false;
		}
	}

	return true;
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 창고 변경시 화면 중복사용을 체크한다.(사용 안함)
 *---------------------------------------------------------------------------------------------*/
function cbo_SubInv_onitemchanged(obj:Combo, e:ItemChangeEventInfo)
{
	if( v_DupScYn == "N" )	return;

	if( !gfn_isNull(gfn_trim(e.postvalue)) )
	{
		if( fn_dupScreen("I", e.postvalue) )
		{
			if( !gfn_isNull( e.prevalue ) )
				fn_dupScreen("D", e.prevalue);
		}
		else
		{
			if( !gfn_isNull( e.prevalue ) )
				fn_dupScreen("D", e.prevalue);

				obj.index = 0;
				div_cmnBtn.btn_save.enable = true;
				btn_tempSave.enable = true;
		}
	}
	else
	{
		if( !gfn_isNull( e.prevalue ) )
			fn_dupScreen("D", e.prevalue);
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 창고별 화면 중복 사용을 체크한다.(사용 안함)
 *---------------------------------------------------------------------------------------------*/
function fn_dupScreen(gubun, subInv_code)
{
	v_StockClose = "";

	ds_Cond.clearData();
	ds_Cond.addRow();

	ds_Cond.setColumn(0, "UPJANG", edt_upjang.getUpjangCode());		// 사업장
	ds_Cond.setColumn(0, "CLASS", gubun);							// 잠금구분 (I : 잠금, D : 해제)
	ds_Cond.setColumn(0, "SUBINV_CODE", subInv_code);				// 창고
	ds_Cond.setColumn(0, "SYS_CLASS", "10");						// 화면 구분(10 : 재고실사, 20 : 재고취소)

	var strSvcID = "dupScreen";
	var strURL   = "U_svc::" + "fs/fsp/FSP00230E_S005.jsp";
	var strInDatasets  = "ds_Cond=ds_Cond";
	var strOutDatasets = "";
	var strArgument  = "";
	var strCallbackFunc = "fn_callback";

	jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, false, false, true);

	var rtn = false;
	if( v_CloseYn == "Y" )
	{
		rtn = false;

		div_cmnBtn.btn_save.enable = false;
		btn_tempSave.enable = false;

		g_Message("EE", v_StockClose);
	}
	else
	{
		rtn = true;

		div_cmnBtn.btn_save.enable = true;
		btn_tempSave.enable = true;
	}

	return rtn;
}
function Button00_onclick(obj:Button,  e:ClickEventInfo)
{
	alert(g_Mu_Cd);
}

//상세팝업 (품목별 전월재고, 입고 내역 조회) 20190405 김호석
function grdStock_oncelldblclick(obj:Grid, e:GridClickEventInfo)
{
	if (ds_stock.rowcount < 1) return;
	if (e.row < 0) return;
	//현지구매품목만, 현지구매쌀 추가 20191112 김호석 
	if ((ds_stock.getColumn(e.row,"ITEM_CODE") == "F178120")
	|| (ds_stock.getColumn(e.row,"ITEM_CODE") == "F178121")
	|| (ds_stock.getColumn(e.row,"ITEM_CODE") == "F132747")) {
			
		var sParam;
		sParam = {fa_chkPoUom:chk_PoUom.value, fa_chkPhysicQty:chk_PhysicQty.value, fa_chkAmt:chk_Amt.value, fa_muCd:cbo_mu.getMuCode(), fa_Upjang:ds_input.getColumn(0,"UPJANG"), fa_subinvCode:ds_input.getColumn(0,"SUBINV_CODE"), fa_itemCode:ds_stock.getColumn(e.row,"ITEM_CODE"), fa_Date:ds_input.getColumn(0,"FR_DATE")};
		
		gfn_dialog("", "U_FSP::FSP00230P.xfdl",sParam);
	}
}

]]></Script>
  </Form>
</FDL>
