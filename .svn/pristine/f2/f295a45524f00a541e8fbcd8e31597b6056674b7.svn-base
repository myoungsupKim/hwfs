<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="..\..\..\default_typedef.xml"/>
  <Form id="FSM90100E" classname="SAMPLE01" inheritanceid="" position="absolute 0 0 1190 720" titletext="레시피수정(행사식)" onload="form_onload" onclose="FSM90100E_onclose" onbeforeclose="FSM90100E_onbeforeclose">
    <Layouts>
      <Layout>
        <Static id="Static15" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 15 0 1175 10"/>
        <Static id="Static01" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 0 15 720"/>
        <Static id="Static02" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1175 0 1190 720"/>
        <Static id="Static03" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 15 705 1175 720"/>
        <Static id="Static26" text="h05" class="Guide01_AreaRed" visible="false" position="absolute 15 35 1174 40"/>
        <Button id="btn_search" taborder="6" text="조회" onclick="fn_search" class="btn_WF_searchCm" position="absolute 1022 10 1081 35" anchor="top right"/>
        <Button id="btn_save" taborder="22" text="저장" onclick="fn_save" class="btn_WF_CRUD" position="absolute 1083 10 1128 35" anchor="top right"/>
        <Button id="btn_close" taborder="23" text="닫기" onclick="fn_close" class="btn_WF_CRUD" position="absolute 1130 10 1175 35" anchor="top right"/>
        <Static id="Static29" text="W102" visible="false" position="absolute 1081 10 1083 35" anchor="top right" style="background:#ff000055;align:center middle;"/>
        <Static id="Static30" text="W102" visible="false" position="absolute 1128 10 1130 35" anchor="top right" style="background:#ff000055;align:center middle;"/>
        <Tab id="Tab00" taborder="35" tabindex="0" scrollbars="autoboth" position="absolute 15 40 1175 705" anchor="all" onchanged="Tab00_onchanged">
          <Tabpages>
            <Tabpage id="tabpage1" text="레시피수정">
              <Layouts>
                <Layout>
                  <Static id="Static07" visible="false" position="absolute 0 0 10 282" style="background:#ff000033;font:Dotum,8;"/>
                  <Static id="Static04" visible="false" position="absolute 0 627 1158 637" style="background:#ff000033;font:Dotum,8;"/>
                  <Static id="Static01" visible="false" position="absolute 1148 0 1158 282" style="background:#ff000033;font:Dotum,8;"/>
                  <Static id="Static32" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 10 0 575 13"/>
                  <Static id="Static31" text="자재목록" class="sta_WF_Title01" position="absolute 10 13 98 31" anchor="left top"/>
                  <Static id="Static33" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 10 26 1148 31" anchor="left top"/>
                  <Button id="btn_addItem" taborder="1" text="자재추가" class="btn_WF_Function" position="absolute 738 6 803 26" anchor="top right" onclick="Tab00_tabpage1_btn_addItem_onclick"/>
                  <Button id="btn_changeItem" taborder="2" text="자재일괄대체" class="btn_WF_Function" position="absolute 805 6 894 26" anchor="top right" onclick="Tab00_tabpage1_btn_changeItem_onclick"/>
                  <Button id="btn_applyRatio" taborder="3" text="레시피비율일괄조정" class="btn_WF_Function" position="absolute 896 6 1021 26" anchor="top right" onclick="Tab00_tabpage1_btn_applyRatio_onclick"/>
                  <Button id="btn_ibDateUpdate" taborder="4" text="입고예정일일괄수정" class="btn_WF_Function" position="absolute 1023 6 1148 26" anchor="top right" onclick="Tab00_tabpage1_btn_ibDateUpdate_onclick"/>
                  <Static id="Static51" text="h06" class="Guide01_AreaRed" visible="false" position="absolute 1090 0 1148 6" anchor="top right"/>
                  <Static id="Static0" position="absolute 109 11 124 26" style="background:#ffaa9cff;"/>
                  <Static id="Static1" position="absolute 196 11 211 26" style="background:#ffe49cff;"/>
                  <Static id="Static2" text="불용자재" position="absolute 127 9 200 30"/>
                  <Static id="Static3" text="금지자재" position="absolute 215 9 288 30"/>
                  <Static id="Static4" position="absolute 282 11 297 26" style="background:#cbcbcaff;"/>
                  <Static id="Static5" text="구매신청완료된자재" position="absolute 300 9 425 30"/>
                  <Grid id="grd_menuItemList" taborder="5" useinputpanel="false" position="absolute 10 31 1148 627" autofittype="none" binddataset="ds_menuItemList" autoenter="select" oncellclick="Tab00_tabpage1_grd_menuItemList_oncellclick" anchor="all" onexpanddown="Tab00_tabpage1_grd_menuItemList_onexpanddown" selecttype="multirow" cellsizingtype="col" class="grd_WF_LineNone" onmousemove="Tab00_tabpage1_grd_menuItemList_onmousemove">
                    <Formats>
                      <Format id="default">
                        <Columns>
                          <Column size="30"/>
                          <Column size="130"/>
                          <Column size="25"/>
                          <Column size="24"/>
                          <Column size="90"/>
                          <Column size="171"/>
                          <Column size="90"/>
                          <Column size="40"/>
                          <Column size="70"/>
                          <Column size="70"/>
                          <Column size="70"/>
                          <Column size="70"/>
                          <Column size="70"/>
                          <Column size="70"/>
                          <Column size="80"/>
                          <Column size="25"/>
                          <Column size="50"/>
                          <Column size="140"/>
                        </Columns>
                        <Rows>
                          <Row size="24" band="head"/>
                          <Row size="24"/>
                        </Rows>
                        <Band id="head">
                          <Cell class="head_Excel"/>
                          <Cell col="1" text="레시피명"/>
                          <Cell col="2" colspan="3" text="자재코드" taborder="undefined"/>
                          <Cell col="5" text="자재명" taborder="undefined"/>
                          <Cell col="6" text="규격"/>
                          <Cell col="7" text="단위"/>
                          <Cell col="8" text="특성"/>
                          <Cell col="9" text="단가"/>
                          <Cell col="10" class="grd_WF_Essential" text="1인량"/>
                          <Cell col="11" class="grd_WF_Essential" text="가식부"/>
                          <Cell col="12" text="1인원가"/>
                          <Cell col="13" text="총소요량"/>
                          <Cell col="14" colspan="2" text="입고예정일" taborder="undefined"/>
                          <Cell col="16" text="마감"/>
                          <Cell col="17" class="grd_WF_Essential" text="커팅규격"/>
                        </Band>
                        <Band id="body">
                          <Cell style="background:EXPR(iif(ORDER_YN=='Y','#CBCBCA','default'));background2:EXPR(iif(ORDER_YN=='Y','#CBCBCA','default'));selectbackground:EXPR(iif(ORDER_YN=='Y','#CBCBCA','default'));" expr="expr:currow + 1"/>
                          <Cell col="1" displaytype="text" edittype="none" style="background2: ;" text="bind:RECIPE_NAME" suppress="1"/>
                          <Cell col="2" displaytype="image" style="background:EXPR(fn_color(currow));background2:EXPR(fn_color(currow));selectbackground:EXPR(fn_color(currow));" text="theme://images/new/grd_WF_ExpandImageX.png"/>
                          <Cell col="3" style="linetype:onlyhorz;background:EXPR(fn_color(currow));background2:EXPR(fn_color(currow));selectbackground:EXPR(fn_color(currow));backgroundimage:EXPR(expr:CHEAP_YN == 'Y' ? 'theme://Images/new/grd_WF_Money2.png' : '');"/>
                          <Cell col="4" edittype="expand" style="align:left;padding:0 0 0 10;background:EXPR(fn_color(currow));background2:EXPR(fn_color(currow));selectbackground:EXPR(fn_color(currow));backgroundimage:EXPR(WEEK_CHK&gt;0?'theme://Images/new/grd_WF_mark.png':'');" text="bind:ITEM_CODE" expandshow="show" expandsize="21"/>
                          <Cell col="5" displaytype="text" edittype="expr:IMG_YN == 'Y' ? 'expand' : 'none'" style="linetype: ;background:EXPR(fn_color(currow));background2:EXPR(fn_color(currow));selectbackground:EXPR(fn_color(currow));" text="bind:ITEM_NAME" expandshow="expr:IMG_YN == 'Y' ? 'show' : 'hide'" expandsize="24" expandimage="URL('theme://Images/new/grd_WF_Camerabtn.png')"/>
                          <Cell col="6" displaytype="text" style="background2: ;" text="bind:ITEM_SIZE"/>
                          <Cell col="7" style="background2: ;" text="bind:PO_UOM"/>
                          <Cell col="8" displaytype="image" style="background2: ;" text="bind:FEATURE_ICON"/>
                          <Cell col="9" displaytype="number" style="background2: ;" text="bind:MARGIN_PRICE"/>
                          <Cell col="10" displaytype="number" edittype="expr:setEditExpr(iif(ORDER_YN=='Y','none','number'))" style="background2: ;" text="bind:NEED_QTY" editautoselect="true"/>
                          <Cell col="11" displaytype="number" edittype="expr:setEditExpr(iif(ORDER_YN=='Y','none','number'))" style="background2: ;" text="bind:EDIBLE_QTY" editautoselect="true"/>
                          <Cell col="12" displaytype="number" style="background2: ;" text="bind:CUR_PRICE"/>
                          <Cell col="13" displaytype="number" style="background2: ;" text="bind:TOT_QTY"/>
                          <Cell col="14" displaytype="date" edittype="none" style="background2: ;" text="bind:NEED_DATE" editautoselect="true" calendardisplaynulltype="none"/>
                          <Cell col="15" displaytype="image" edittype="expr:setEditExpr(iif(ORDER_YN=='Y','none','image')" style="background2: ;" text="theme://Images\new\cal_WF_IconN.png"/>
                          <Cell col="16" style="background2: ;" text="bind:D_DAYS"/>
                          <Cell col="17" displaytype="combo" edittype="combo" style="align:left;background2: ;" text="bind:CUT_SPEC" combodataset="ds_cboCut" combocodecol="CODE" combodatacol="CODE_NAME"/>
                        </Band>
                      </Format>
                    </Formats>
                  </Grid>
                  <CheckBox id="chk_cheapYn" taborder="6" text="저렴자재찾기" value="0" truevalue="1" falsevalue="0" onclick="Tab00_tabpage1_chk_cheapYn_onclick" position="absolute 636 6 738 26" anchor="top right"/>
                </Layout>
              </Layouts>
            </Tabpage>
            <Tabpage id="tabpage2" text="조리법" onstepchanged="Tab00_tabpage2_onstepchanged">
              <Layouts>
                <Layout>
                  <Static id="Static07" visible="false" position="absolute 0 0 10 627" style="background:#ff000033;font:Dotum,8;"/>
                  <Static id="Static32" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 10 0 575 13"/>
                  <Static id="Static04" visible="false" position="absolute 0 627 1158 637" style="background:#ff000033;font:Dotum,8;"/>
                  <Static id="Static01" visible="false" position="absolute 1148 0 1158 627" style="background:#ff000033;font:Dotum,8;"/>
                  <Static id="Static33" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 10 26 1148 31" anchor="left top"/>
                  <Grid id="grd_cuisineList" taborder="1" useinputpanel="false" position="absolute 10 31 1148 627" binddataset="ds_cuisineList" autofittype="col" anchor="all" class="grd_WF_LineNone">
                    <Formats>
                      <Format id="default">
                        <Columns>
                          <Column size="40"/>
                          <Column size="1160"/>
                        </Columns>
                        <Rows>
                          <Row size="24" band="head"/>
                          <Row size="24"/>
                        </Rows>
                        <Band id="head">
                          <Cell class="head_Excel"/>
                          <Cell col="1" text="조리법"/>
                        </Band>
                        <Band id="body">
                          <Cell expr="expr:currow + 1"/>
                          <Cell col="1" displaytype="text" text="bind:CUISINE_DESC"/>
                        </Band>
                      </Format>
                    </Formats>
                  </Grid>
                  <Static id="Static31" text="조리법" class="sta_WF_Title01" position="absolute 10 13 98 31" anchor="left top"/>
                </Layout>
              </Layouts>
            </Tabpage>
            <Tabpage id="tabpage3" text="조리공정">
              <Layouts>
                <Layout>
                  <Static id="Static32" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 10 0 575 13"/>
                  <Static id="Static07" visible="false" position="absolute 0 0 10 282" style="background:#ff000033;font:Dotum,8;"/>
                  <Static id="Static04" visible="false" position="absolute 0 272 1238 282" style="background:#ff000033;font:Dotum,8;"/>
                  <Static id="Static01" visible="false" position="absolute 1148 0 1158 282" style="background:#ff000033;font:Dotum,8;"/>
                  <ImageViewer id="img_cuisineMethod" taborder="1" position="absolute 10 13 1140 1156" anchor="all"/>
                </Layout>
              </Layouts>
            </Tabpage>
            <Tabpage id="tabpage4" text="기획자재">
              <Layouts>
                <Layout>
                  <Static id="Static32" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 10 0 575 13"/>
                  <Static id="Static07" visible="false" position="absolute 0 0 10 637" style="background:#ff000033;font:Dotum,8;"/>
                  <Static id="Static04" visible="false" position="absolute 10 627 1158 637" style="background:#ff000033;font:Dotum,8;"/>
                  <Static id="Static01" visible="false" position="absolute 1148 0 1158 637" style="background:#ff000033;font:Dotum,8;"/>
                  <Static id="Static33" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 10 26 1148 31" anchor="left top"/>
                  <Grid id="grd_list" taborder="1" binddataset="ds_dutyItemList" autoenter="select" useinputpanel="false" cellsizingtype="col" oncelldblclick="grd_list_oncelldblclick" onexpanddown="grd_list_onexpanddown" position="absolute 10 31 1148 627" anchor="all" autofittype="col">
                    <Formats>
                      <Format id="default">
                        <Columns>
                          <Column size="27"/>
                          <Column size="90"/>
                          <Column size="147"/>
                          <Column size="0"/>
                          <Column size="0"/>
                          <Column size="95"/>
                          <Column size="196"/>
                          <Column size="96"/>
                          <Column size="58"/>
                          <Column size="80"/>
                          <Column size="80"/>
                          <Column size="80"/>
                        </Columns>
                        <Rows>
                          <Row size="24" band="head"/>
                          <Row size="24" band="head"/>
                          <Row size="24"/>
                        </Rows>
                        <Band id="head">
                          <Cell rowspan="2" class="head_Excel" taborder="undefined"/>
                          <Cell col="1" rowspan="2" text="센터" taborder="undefined"/>
                          <Cell col="2" rowspan="2" text="업체" taborder="undefined"/>
                          <Cell col="3" text="대표자재코드"/>
                          <Cell col="4" text="대표자재명"/>
                          <Cell col="5" colspan="2" text="기획자재" taborder="undefined"/>
                          <Cell col="7" rowspan="2" text="규격" taborder="undefined"/>
                          <Cell col="8" rowspan="2" text="단위" taborder="undefined"/>
                          <Cell col="9" rowspan="2" text="시작일" taborder="undefined"/>
                          <Cell col="10" rowspan="2" text="종료일" taborder="undefined"/>
                          <Cell col="11" rowspan="2" style="background: ;" text="배분량&#13;&#10;(Kg)" taborder="undefined"/>
                          <Cell row="1" col="3"/>
                          <Cell row="1" col="4"/>
                          <Cell row="1" col="5" text="코드"/>
                          <Cell row="1" col="6" text="자재명"/>
                        </Band>
                        <Band id="body">
                          <Cell style="background:white;background2:white;" text="expr:rowidx+1"/>
                          <Cell col="1" style="background:white;background2:white;" text="bind:CENTER_NAME"/>
                          <Cell col="2" displaytype="text" style="background:white;background2:white;" text="bind:CUSTNM"/>
                          <Cell col="3" style="background:white;background2:white;" text="bind:대표자재코드"/>
                          <Cell col="4" style="background:white;background2:white;" text="bind:대표자재명"/>
                          <Cell col="5" style="background:white;background2:white;" text="bind:ITEM_CODE"/>
                          <Cell col="6" displaytype="text" style="background:white;background2:white;" text="bind:ITEM_NAME"/>
                          <Cell col="7" style="align:left;background:white;background2:white;" text="bind:ITEM_SIZE"/>
                          <Cell col="8" style="background:white;background2:white;" text="bind:PO_UOM"/>
                          <Cell col="9" displaytype="date" style="background:white;background2:white;" text="bind:START_DATE" calendardisplaynulltype="none"/>
                          <Cell col="10" displaytype="date" style="background:white;background2:white;" text="bind:END_DATE" calendardisplaynulltype="none"/>
                          <Cell col="11" displaytype="number" edittype="none" style="background:white;background2:white;" text="bind:DUTY_QTY" mask="###,###,###.##" editautoselect="true" editlimitbymask="both"/>
                        </Band>
                      </Format>
                    </Formats>
                  </Grid>
                  <Static id="Static31" text="기획자재목록" class="sta_WF_Title01" position="absolute 10 13 130 31" anchor="left top"/>
                  <Static id="Static68" text="배분량은 팀에 할당된 배분량 입니다." class="sta_WF_DiscInfo" position="absolute 138 12 533 27"/>
                </Layout>
              </Layouts>
            </Tabpage>
          </Tabpages>
        </Tab>
        <ObjCalendar id="cal_menuDate" anchor="left top" titletext="캘린더" taborder="36" onclick="cal_menuDate_onclick" scrollbars="none" position="absolute 15 12 118 33" visible="false"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_cond" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" onvaluechanged="ds_cond_onvaluechanged">
        <ColumnInfo>
          <Column id="UPJANG" type="STRING" size="256"/>
          <Column id="HALL_CD" type="STRING" size="256"/>
          <Column id="HALL_CLASS" type="STRING" size="256"/>
          <Column id="MENU_DATE" type="STRING" size="256"/>
          <Column id="MEAL" type="STRING" size="256"/>
          <Column id="CORNER" type="STRING" size="256"/>
          <Column id="CUR_DATE" type="STRING" size="256"/>
          <Column id="MENU_CD" type="STRING" size="256"/>
          <Column id="SUBINV_CODE" type="STRING" size="256"/>
          <Column id="RECIPE_CD" type="STRING" size="256"/>
          <Column id="CHEAP_YN" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cboRecipeNm"/>
      <Dataset id="ds_cboRecipeClass">
        <ColumnInfo>
          <Column id="CD" type="STRING" size="256"/>
          <Column id="NM" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cboRecipeType">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="256"/>
          <Column id="CODE_NAME" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cboCookClass">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="256"/>
          <Column id="CODE_NAME" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cboMaterial">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="256"/>
          <Column id="CODE_NAME" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cboElement">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="256"/>
          <Column id="CODE_NAME" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cboCuisineType">
        <ColumnInfo>
          <Column id="CODE" size="255" type="STRING"/>
          <Column id="CODE_NAME" size="255" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cboMeal" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="MEAL" type="STRING" size="256"/>
          <Column id="MEAL_NAME" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cboCorner" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CORNER" type="STRING" size="256"/>
          <Column id="CORNER_NAME" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_weather" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_recipeList" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="GUBUN" type="STRING" size="256"/>
          <Column id="RECIPE_CD" type="STRING" size="256"/>
          <Column id="RECIPE_NAME" type="STRING" size="256"/>
          <Column id="RECIPE_COST" type="STRING" size="256"/>
          <Column id="RECIPE_CLASS" type="STRING" size="256"/>
          <Column id="RECIPE_TYPE" type="STRING" size="256"/>
          <Column id="CUISINE_TYPE" type="STRING" size="256"/>
          <Column id="PREFER" type="STRING" size="256"/>
          <Column id="DI_MON" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_recipeCond" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="STD_CHK" type="STRING" size="256"/>
          <Column id="UPJANG_CHK" type="STRING" size="256"/>
          <Column id="ENF_CHK" type="STRING" size="256"/>
          <Column id="UPJANG" type="STRING" size="256"/>
          <Column id="SUBINV_CODE" type="STRING" size="256"/>
          <Column id="MENU_DATE" type="STRING" size="256"/>
          <Column id="HALL_CD" type="STRING" size="256"/>
          <Column id="RECIPE_NAME" type="STRING" size="256"/>
          <Column id="RECIPE_NAME1" type="STRING" size="256"/>
          <Column id="RECIPE_NAME2" type="STRING" size="256"/>
          <Column id="RECIPE_NAME3" type="STRING" size="256"/>
          <Column id="RECIPE_NAME4" type="STRING" size="256"/>
          <Column id="RECIPE_NAME5" type="STRING" size="256"/>
          <Column id="RECIPE_CLASS" type="STRING" size="256"/>
          <Column id="RECIPE_TYPE" type="STRING" size="256"/>
          <Column id="CUISINE_TYPE" type="STRING" size="256"/>
          <Column id="MAIN_ITEM_CODE1" type="STRING" size="256"/>
          <Column id="RESP_NUT1" type="STRING" size="256"/>
          <Column id="START_COST" type="STRING" size="256"/>
          <Column id="END_COST" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_menuItemList" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" onrowposchanged="ds_menuItemList_onrowposchanged" oncolumnchanged="ds_menuItemList_oncolumnchanged">
        <ColumnInfo>
          <Column id="UPJANG" type="STRING" size="256"/>
          <Column id="MENU_CD" type="STRING" size="256"/>
          <Column id="RECIPE_SEQ" type="STRING" size="256"/>
          <Column id="RECIPE_TYPE" type="STRING" size="256"/>
          <Column id="CUISINE_TYPE" type="STRING" size="256"/>
          <Column id="RECIPE_CD" type="STRING" size="256"/>
          <Column id="RECIPE_NAME" type="STRING" size="256"/>
          <Column id="DISUSE_RATE" type="STRING" size="256"/>
          <Column id="ITEM_CODE" type="STRING" size="256"/>
          <Column id="ITEM_NAME" type="STRING" size="256"/>
          <Column id="ITEM_SEQ" type="STRING" size="256"/>
          <Column id="ITEM_CLASS1" type="STRING" size="256"/>
          <Column id="ITEM_CLASS2" type="STRING" size="256"/>
          <Column id="ITEM_CLASS3" type="STRING" size="256"/>
          <Column id="ITEM_CLASS4" type="STRING" size="256"/>
          <Column id="FEATURE_NAME" type="STRING" size="256"/>
          <Column id="ITEM_SIZE" type="STRING" size="256"/>
          <Column id="PO_UOM" type="STRING" size="256"/>
          <Column id="EDIBLE_QTY" type="STRING" size="256"/>
          <Column id="CUT_SPEC" type="STRING" size="256"/>
          <Column id="NEED_QTY" type="STRING" size="256"/>
          <Column id="EXPECT_MEAL_QTY" type="STRING" size="256"/>
          <Column id="EXPECT_SALE_QTY" type="STRING" size="256"/>
          <Column id="TOT_QTY2" type="STRING" size="256"/>
          <Column id="TOT_QTY" type="STRING" size="256"/>
          <Column id="CUR_PRICE" type="STRING" size="256"/>
          <Column id="ORDER_YN" type="STRING" size="256"/>
          <Column id="MARGIN_PRICE" type="STRING" size="256"/>
          <Column id="G_ITEM_PRICE" type="STRING" size="256"/>
          <Column id="MARGIN_RATE" type="STRING" size="256"/>
          <Column id="UNIT_PRICE" type="STRING" size="256"/>
          <Column id="NEED_DATE" type="STRING" size="256"/>
          <Column id="WEEK_CHK" type="STRING" size="256"/>
          <Column id="RESTRICT_START" type="STRING" size="256"/>
          <Column id="RESTRICT_END" type="STRING" size="256"/>
          <Column id="RESTRICT_REASON" type="STRING" size="256"/>
          <Column id="RESTRICT_PERIOD" type="STRING" size="256"/>
          <Column id="CNL_START" type="STRING" size="256"/>
          <Column id="CNL_END" type="STRING" size="256"/>
          <Column id="CNL_REASON" type="STRING" size="256"/>
          <Column id="CNL_PERIOD" type="STRING" size="256"/>
          <Column id="D_DAYS" type="STRING" size="256"/>
          <Column id="D_DAY" type="STRING" size="256"/>
          <Column id="CHEAP_YN" type="STRING" size="256"/>
          <Column id="DAY_COLOR" type="STRING" size="256"/>
          <Column id="ATTR01" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cboCut">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="256"/>
          <Column id="CODE_NAME" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cuisineList" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="UPJANG" type="STRING" size="256"/>
          <Column id="MENU_CD" type="STRING" size="256"/>
          <Column id="RECIPE_CD" type="STRING" size="256"/>
          <Column id="CUISINE_SEQ" type="STRING" size="256"/>
          <Column id="CUISINE_DESC" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_validData" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_rCnt"/>
      <Dataset id="ds_iCnt"/>
      <Dataset id="ds_enfUpjangList" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="UPJANG" type="STRING" size="256"/>
          <Column id="START_DD" type="STRING" size="256"/>
          <Column id="END_DD" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_sysDate" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_Const"/>
      <Dataset id="ds_grdRecipeClass">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="256"/>
          <Column id="CODE_NAME" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_dutyItemList" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CENTER_NAME" type="STRING" size="256"/>
          <Column id="CUSTNM" type="STRING" size="256"/>
          <Column id="ITEM_CODE" type="STRING" size="256"/>
          <Column id="ITEM_NAME" type="STRING" size="256"/>
          <Column id="ITEM_SIZE" type="STRING" size="256"/>
          <Column id="PO_UOM" type="STRING" size="256"/>
          <Column id="START_DATE" type="STRING" size="256"/>
          <Column id="END_DATE" type="STRING" size="256"/>
          <Column id="DUTY_QTY" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_menuList">
        <ColumnInfo>
          <Column id="CLASS_NAME" size="100" type="STRING"/>
          <Column id="CUISINE_NAME" size="100" type="STRING"/>
          <Column id="CUISINE_TYPE" size="20" type="STRING"/>
          <Column id="EXPECT_SALE_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="MENU_CD" size="20" type="STRING"/>
          <Column id="RECIPE_CD" size="20" type="STRING"/>
          <Column id="RECIPE_CLASS" size="20" type="STRING"/>
          <Column id="RECIPE_COST" size="22" type="BIGDECIMAL"/>
          <Column id="RECIPE_NAME" size="50" type="STRING"/>
          <Column id="RECIPE_TYPE" size="20" type="STRING"/>
          <Column id="TYPE_NAME" size="100" type="STRING"/>
          <Column id="UPJANG" size="22" type="BIGDECIMAL"/>
          <Column id="SALE_PRICE" size="256" type="BIGDECIMAL"/>
          <Column id="RECIPE_SEQ" size="256" type="BIGDECIMAL"/>
          <Column id="CHK" size="256" type="STRING"/>
          <Column id="ORDER_YN" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Bind>
      <BindItem id="item12" compid="Tab00.tabpage1.chk_cheapYn" propid="value" datasetid="ds_cond" columnid="CHEAP_YN"/>
    </Bind>
    <Script type="xscript4.0"><![CDATA[include "U_lib::lib_conversionCom.xjs";

/******************************************************************************************
 * 시스템구분 : 메뉴관리/식단관리
 * 프로그램명 : FSM90205P.XML
 * 기ㅡㅡㅡ능 : 레시피수정(행사식)
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-05-29
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************/

//=========================================================================================
// [ PART 1 ]
// Form에서 Include 할 내용을 정의
//
//=========================================================================================

//=========================================================================================
// [ PART 2 ]
// Form에서 사용될 전역변수를 선언
//
//=========================================================================================
var fa_ENF_YN = 'N';	// 강제레시피 대상사업장 여부
var isChecked = 1;      // 식단구성 구축 체크박스 전체 체크여부
//=========================================================================================
// [ PART 3 ]
// Form Loading 시 작업 정의
//
//=========================================================================================
function form_onload(obj:Form, e:LoadEventInfo)
{
	gfn_formOnLoad(this);

	// X-Framework : Action 정보 생성
	fsp_init(this);
	
	// 초기화
	fn_init();
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_init()
 * 기ㅡㅡㅡ능 : 초기화
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_init()
{
	// 조회조건 초기화
	ds_cond.clearData();
	ds_cond.addRow();

	// 레시피 조회조건 초기화
	ds_recipeCond.clearData();
	ds_recipeCond.addRow();
	
	// 조회조건값 세팅
	ds_cond.setColumn(0, "UPJANG"      , fa_UPJANG);       // 사업장코드
	ds_cond.setColumn(0, "MENU_CD"     , fa_MENU_CD);      // 메뉴코드
	ds_cond.setColumn(0, "HALL_CD"     , fa_HALL_CD);      // 식당코드
	ds_cond.setColumn(0, "SUBINV_CODE" , fa_SUBINV_CODE);  // 창고코드
	ds_cond.setColumn(0, "MENU_DATE"   , fa_MENU_DATE);    // 제공일(끼니, 코너 조회용)
	cal_menuDate.fn_initMonthCal(this, fa_MENU_DATE, "fn_callbackMenuDate", ds_cond, "MENU_DATE", "Y");  // 제공일

	// 자재추가 팝업에서 사용될 메뉴 DataSet
	ds_menuList.copyData(opener.ds_recipeList);

	fn_search();
}

//=========================================================================================
// [ PART 4 ]
// Main Process Event 정의(조회,입력,삭제,저장,출력)
//
//=========================================================================================
/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_search()
 * 기ㅡㅡㅡ능 : 조회
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_search()
{
	ds_menuItemList.clearData();
	
	if(Tab00.tabpage1.chk_cheapYn.value == 1)
	{
		jsp_transaction(this, "FSM00060E_T009","U_svc::" + "fs/fsm/FSM00060E_T009.jsp", "ds_cond=ds_cond","ds_menuItemList=ds_List", "", "fn_callbackSearch", false, false, false);
	}
	else
	{
		jsp_transaction(this, "FSM00060E_T008","U_svc::" + "fs/fsm/FSM00060E_T008.jsp", "ds_cond=ds_cond","ds_menuItemList=ds_List", "", "fn_callbackSearch", false, false, false);
	}
}

function fn_callbackSearch(errCode, errMsg) 
{
	if(errCode!=0)
	{
		g_Message("EE", "서비스 오류:시스템 관리자에게 문의하십시오!");
		return;
	}
	
	Tab00.tabpage1.grd_menuItemList.setCellPos(1);
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_close()
 * 기ㅡㅡㅡ능 : 닫기
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_close()
{
	this.close();
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_save()
 * 기ㅡㅡㅡ능 : 저장
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_save()
{
	if(gfn_dsIsUpdated(ds_menuItemList) != true && gfn_dsIsUpdated(ds_cuisineList) != true)
	{
		g_Message("EE", "변경된 자료가 없습니다.");
		return false;
	}

	var inData = "ds_Item=ds_menuItemList:U";
	fsp_clear(this);
	fsp_addSave(this, "", "fs/fsm:FSM00060E_U005", "", "", "", "", "");  // 자재정보 수정
	
	// 조리법 저장여부
	if(gfn_dsIsUpdated(ds_cuisineList) == true)
	{
		if(ds_cuisineList.findRowExpr("gfn_length(gfn_trim(CUISINE_DESC))==0 || gfn_trim(CUISINE_DESC)==null")!=-1)
		{
			g_Message("EE", "조리법이 비어있는 라인이 있습니다.비어있는 라인을 입력하세요.");
			return false;
		}
		// 조리법 저장 추가
		inData = inData + " ds_CookMethod=ds_cuisineList:U";
		fsp_addSave(this, "fs/fsm:FSM00060E_I001", "fs/fsm:FSM00060E_U001", "fs/fsm:FSM00060E_D004", "", "", "", "");
	}
	
	fsp_callService(this, "", "", inData, "", "", "fn_callbackSave");
}

function fn_callbackSave(errCode, errMsg) 
{
	if(errCode!=0)
	{
		g_Message("EE", "서비스 오류:시스템 관리자에게 문의하십시오!");
		return;
	}
	
	g_Message("02", "저장 되었습니다.");
	fn_search();
}

//=========================================================================================
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
//
//=========================================================================================
/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_searchCuisine()
 * 기ㅡㅡㅡ능 : 조리법 조회
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_searchCuisine()
{
	// 현재 선택되어 있는 레시피코드 세팅
	ds_cond.setColumn(0, "RECIPE_CD", ds_menuItemList.getColumn(ds_menuItemList.rowposition, "RECIPE_CD"));

	fsp_clear(this);
	fsp_addSearch(this, "fs/fsm:FSM00062E_S001");	// 조리법	
	fsp_callService(this, "", "", "ds_cond=ds_cond", "ds_cuisineList=ds_CookMethod", "", "", "", true);
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_searchCuisineMethod()
 * 기ㅡㅡㅡ능 : 조리공정 조회
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_searchCuisineMethod()
{
	var sCuisineType = ds_menuItemList.getColumn(ds_menuItemList.rowposition, "CUISINE_TYPE");
	Tab00.tabpage3.img_cuisineMethod.image = GF_FILE_SERVER_URL + "upload/img/cook_ctrl/" + sCuisineType + ".jpg";
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_deleteItem()
 * 기ㅡㅡㅡ능 : 자재삭제
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_deleteItem()
{
	fsp_clear(this);
	fsp_addSave(this, "", "", "fs/fsm:FSM00060E_D002","", "", "", "");
	fsp_callService(this, "", "", "ds_Item=ds_menuItemList:U", "", "", "fn_callbackDeleteItem");
}

function fn_callbackDeleteItem(errCode, errMsg) 
{
	if(errCode!=0)
	{
		g_Message("EE", "서비스 오류:시스템 관리자에게 문의하십시오!");
		return;
	}
	
	fn_search();
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_color(nRow)
 * 기ㅡㅡㅡ능 : 자재명에 칼라 적용 (구매신청완료된 자재는 순번필드에 표현함)
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_color(nRow)
{
	// 불용자재
	if(ds_menuItemList.getColumn(nRow, "MTG_UNS") == 'UK' || ds_menuItemList.getColumn(nRow, "MTG_STP") == 'TK' || gfn_isNull(ds_menuItemList.getColumn(nRow, "MARGIN_PRICE")) || Number(ds_menuItemList.getColumn(nRow, "MARGIN_PRICE")) == 0)
	{
		return "#FFAA9C";
	}

	// 금지 자재
	var sMenuDate = gfn_trim(ds_cond.getColumn(0, "MENU_DATE"));
	
	if( sMenuDate >= ds_menuItemList.getColumn(nRow,"RESTRICT_START") &&
		sMenuDate <= ds_menuItemList.getColumn(nRow,"RESTRICT_END") )
	{
		if(sMenuDate >= ds_menuItemList.getColumn(nRow,"CNL_START") &&
		   sMenuDate <= ds_menuItemList.getColumn(nRow,"CNL_END") )
		{
			return "default";
		}
		else
		{
			return "#FFE49C";
		}
	}
	return "default";
}

//=========================================================================================
// [ PART 6 ]
// component Event 정의 ( User Define function )
// 
//=========================================================================================
/******************************************************************************************
 * 함ㅡ수ㅡ명 : Tab00_onstepchanged(obj:Tab, e:StepChangeEventInfo)
 * 기ㅡㅡㅡ능 : 탭변경시 호출 (조리법, 조리공정)
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-01
 ******************************************************************************************/
function Tab00_onchanged(obj:Tab, e:TabIndexChangeEventInfo)
{
	// 조리법 탭 클릭시
	if(e.postindex == 1) 
	{
		fn_searchCuisine();
	}
	// 조리공정 탭 클릭시
	else if(e.postindex == 2)
	{
		fn_searchCuisineMethod();
	}
	// 기획자재 탭 클릭시
	else if(e.postindex == 3)
	{
		fn_searchDutyItem();
	}
}

function fn_searchDutyItem() 
{
	fsp_clear(this);
	fsp_addSearch(this, "fs/fsm:FSM90030P_S001");	// 기획자재	
	fsp_callService(this, "", "", "ds_cond=ds_cond", "ds_dutyItemList=ds_dutyItemList", "", "", "", true);
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : Tab00_tabpage1_grd_menuItemList_oncellclick(obj:Grid, e:GridClickEventInfo)
 * 기ㅡㅡㅡ능 : 자재목록 그리드 클릭시 처리
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-01
 ******************************************************************************************/
function Tab00_tabpage1_grd_menuItemList_oncellclick(obj:Grid, e:GridClickEventInfo)
{
	// 자재삭제
	if(e.col == 2)
	{
		// 발주된 자재는 수정 및 삭제 불가 이 자재를 보유한 레시피도 삭제불가
		if(ds_menuItemList.getColumn(e.row,"ORDER_YN") == "Y")	
		{
			return;
		}
		
		if(gfn_dsIsUpdated(ds_cuisineList) == true || gfn_dsIsUpdated(ds_menuItemList) == true)
		{
			g_Message("EE", "변경된 자료가 있습니다.\n\n먼저 저장하신후 작업하세요.");
			return;
		}
		
		if(!g_Confirm("01", "[ " + gfn_trim(ds_menuItemList.getColumn(e.row, "ITEM_NAME")) + " ] 자재를 삭제하시겠습니까?")) return;
		
		// 그리드 삭제처리
		ds_menuItemList.deleteRow(e.row);
		
		// 자재 DB 삭제처리
		fn_deleteItem();
	}
	// 입고예정일 
	else if(e.col == 15)
	{
		if(ds_menuItemList.getColumn(e.row, "ORDER_YN") == "Y") {
			return;
		}

		var retDate, orgDate, strValue;
		var nCellRect = obj.getCellRect(e.row, 13);  //left,right,top,bottom
		var nX = system.clientToScreenX(obj, nCellRect.left);
		var nY = system.clientToScreenY(obj, nCellRect.top); 

		orgDate = ds_menuItemList.getColumn(e.row,"NEED_DATE");
		retDate = gfn_callCalendarPopDiv(ds_menuItemList.getColumn(e.row, "NEED_DATE"), nX, nY - 76);

		if(retDate < "20080701")  {
			g_Message("EE","2008년 7월 1일 이전일자로 작업할수 없습니다.");
			retDate="20080701";
		}

		// 입고 예정일은 오늘 이후, 제공일을 포함한 이전이어야 한다.
		if(retDate <= ds_sysDate.getColumn(0, "TODAY") || retDate > ds_cond.getColumn(0, "MENU_DATE")) {
			g_Message("EE", "입고 예정일은 오늘 이후, 제공일을 포함한 이전이어야 합니다.\n\n다시 선택하세요.");
			return;
		}
		  
		if(gfn_length(gfn_trim(retDate)) == 8) {
			ds_menuItemList.setColumn(e.row, "NEED_DATE", retDate);
		}
	}
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : Tab00_tabpage1_btn_changeItem_onclick(obj:Button,  e:ClickEventInfo)
 * 기ㅡㅡㅡ능 : 자재일괄대체
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-01
 ******************************************************************************************/
function Tab00_tabpage1_btn_changeItem_onclick(obj:Button,  e:ClickEventInfo)
{
	if(ds_menuItemList.getRowCount()==0)
	{
		return;
	}

	// 변경된 데이터가 존재할 경우 저장 후 팝업	
	if(gfn_dsIsUpdated(ds_menuList) == true || gfn_dsIsUpdated(ds_menuItemList) == true)
	{
		//fn_save();
	}
	
	// 일괄대체시 레시피당 하나의 자재만 선택되도록 처리
	var sRecipeCd = "";
	for(var i=0; i<ds_menuItemList.getRowCount(); i++)
	{
		if(ds_menuItemList.getSelect(i) == true)
		{
			if(sRecipeCd == ds_menuItemList.getColumn(i, "RECIPE_CD"))
			{
				ds_menuItemList.selectRow(i, false);
			}
			sRecipeCd = ds_menuItemList.getColumn(i, "RECIPE_CD");
		}
	}
	
	var arg ={
	          RECIPE_CD:ds_menuItemList.getColumn(e.row, "RECIPE_CD")
			, UPJANG:ds_menuItemList.getColumn(e.row, "UPJANG")
			, MENU_CD:ds_menuItemList.getColumn(e.row, "MENU_CD")
			, HALL_CD:gfn_trim(fa_HALL_CD)
			, SUBINV_CODE:gfn_trim(fa_SUBINV_CODE)
			, MEAL:""
			, CORNER:""
			, S_ROWNUM: e.row //자재 대체 시 선택한 자재코드만 변경하도록 변수값 설정 2016.05.16
			, MENU_DATE:gfn_trim(cal_menuDate.fn_getValue())
			, ITEM_CODE:ds_menuItemList.getColumn(e.row, "ITEM_CODE")
			, ITEM_NAME:ds_menuItemList.getColumn(e.row, "ITEM_NAME")
			, ITEM_CLASS2:""
			, ITEM_CLASS3:""
			, ITEM_CLASS4:""
			, NEED_DATE:ds_menuItemList.getColumn(e.row, "NEED_DATE")
			, ENF_YN:fa_ENF_YN
	};	
	
	var rtn = gfn_dialog("", "U_FSM::FSM90032P.xfdl",arg);
	
	if(gfn_length(gfn_trim(rtn)) == 0 || gfn_trim(rtn) == null)
	{
		return;
	}
	
	// 정상 변경시 자재 재조회
	if(rtn == "OK")
	{
		fn_search();
	}
	else
	{
		return;
	}		
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : Tab00_tabpage1_btn_applyRatio_onclick(obj:Button,  e:ClickEventInfo)
 * 기ㅡㅡㅡ능 : 레시피비율 일괄조정
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-01
 ******************************************************************************************/
function Tab00_tabpage1_btn_applyRatio_onclick(obj:Button,  e:ClickEventInfo)
{
	if(ds_menuItemList.getRowCount()==0)
	{
		return;
	}

	var rtn = gfn_dialog("", "U_FSM::FSM90033P.xfdl", ""); 
	
	var nRow;
	if(rtn == 1)
	{
		// 자재에 대해 비율 일괄 수정
		for(var i=0; i<ds_menuItemList.rowcount; i++)
		{
			// 신규로 추가되는 자재는 무조건 N 입니다.
			if(ds_menuItemList.getColumn(i, "ORDER_YN") != "Y")	
			{
				nRow = ds_menuList.findRow("RECIPE_CD", ds_menuItemList.getColumn(i,"RECIPE_CD"));
				if(ds_menuList.getColumn(nRow, "V_STA") == 1 && gfn_length(gfn_trim(ds_menuList.getColumn(nRow, "V_RATE"))) != 0 && 
					gfn_trim(ds_menuList.getColumn(nRow, "V_RATE")) != null)
				{
					v_NQ = Math.round(toNumber(ds_menuItemList.getColumn(i,"NEED_QTY")) * toNumber(gfn_trim(ds_menuList.getColumn(nRow, "V_RATE"))) / 100, 2);
					ds_menuItemList.setColumn(i, "NEED_QTY", v_NQ);
				}
			}
		}		
	}
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : Tab00_tabpage1_btn_cheapItem_onclick(obj:Button,  e:ClickEventInfo)
 * 기ㅡㅡㅡ능 : 저렴자재 찾기
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-01
 ******************************************************************************************/
function Tab00_tabpage1_btn_cheapItem_onclick(obj:Button,  e:ClickEventInfo)
{
	g_Message("02", "저렴한 자재찾기 실행 시 자재별로 동일 소분류내에서 가장 저렴하지 않은 경우 자재코드 앞에 아이콘이 표시됩니다.");
	jsp_transaction(this, "FSM00060E_S004", "U_svc::fs/fsm/FSM00060E_S004.jsp", "ds_Item=ds_menuItemList", "ds_menuItemList=ds_Item", "", "", false, false, false);
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : Tab00_tabpage1_grd_menuItemList_onexpanddown(obj:Grid, e:GridMouseEventInfo)
 * 기ㅡㅡㅡ능 : 자재대체
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-01
 ******************************************************************************************/
function Tab00_tabpage1_grd_menuItemList_onexpanddown(obj:Grid, e:GridMouseEventInfo)
{
	// 자재코드
	if(e.col == 4)
	{
		// 발주된 자재에 대해서는 대체 불가
		if(ds_menuItemList.getColumn(e.row, "ORDER_YN") == "Y")
		{
			return;
		}
	
		var arg = {
			       RECIPE_CD:ds_menuItemList.getColumn(e.row, "RECIPE_CD")
			     , UPJANG:ds_menuItemList.getColumn(e.row, "UPJANG")
			     , MENU_CD:ds_menuItemList.getColumn(e.row, "MENU_CD")
			     , HALL_CD:gfn_trim(fa_HALL_CD)
			     , SUBINV_CODE:gfn_trim(fa_SUBINV_CODE)
			     , MEAL:""
			     , CORNER:""
			     , S_ROWNUM:e.row //자재 대체 시 선택한 자재코드만 변경하도록 추가 2016.05.16
			     , MENU_DATE:gfn_trim(cal_menuDate.fn_getValue())
			     , ITEM_CODE:ds_menuItemList.getColumn(e.row, "ITEM_CODE")
			     , ITEM_NAME:ds_menuItemList.getColumn(e.row, "ITEM_NAME")
			     , ITEM_CLASS2:ds_menuItemList.getColumn(e.row, "ITEM_CLASS2")
			     , ITEM_CLASS3:ds_menuItemList.getColumn(e.row, "ITEM_CLASS3")
			     , ITEM_CLASS4:ds_menuItemList.getColumn(e.row, "ITEM_CLASS4")
			     , NEED_DATE:ds_menuItemList.getColumn(e.row, "NEED_DATE")
			     , ENF_YN:fa_ENF_YN
		};
		var rtn = gfn_dialog("", "U_FSM::FSM90032P.xfdl",arg);
		
		if(gfn_length(gfn_trim(rtn)) == 0 || gfn_trim(rtn) == null)
		{
			return;
		}
		
		// 정상 변경시 자재 재조회
		if(rtn == "OK")
		{
			fn_search();
		}
		else
		{
			return;
		}		
	}
	else if(e.cell == 5)
	{
		gfn_dialog("", "U_FSP::FSP00000P.xfdl",{fv_itemCode: ds_menuItemList.getColumn(e.row, "ITEM_CODE")}, "", "", "", "", "", "", "", "", true);
	}
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : Tab00_tabpage1_btn_addItem_onclick(obj:Button,  e:ClickEventInfo)
 * 기ㅡㅡㅡ능 : 자재추가
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-01
 ******************************************************************************************/
function Tab00_tabpage1_btn_addItem_onclick(obj:Button,  e:ClickEventInfo)
{
	if(ds_menuItemList.getRowCount()==0)
	{
		return;
	}
	
	if(gfn_dsIsUpdated(ds_cuisineList) == true || gfn_dsIsUpdated(ds_menuItemList) == true)
	{
		g_Message("EE", "변경된 자료가 있습니다.\n\n먼저 저장하신후 작업하세요.");
		return;
	}

	// 일괄대체시 레시피당 하나의 자재만 선택되도록 처리
	var nRow = "";
	for(var i=0; i<ds_menuItemList.getRowCount(); i++)
	{
		if(ds_menuItemList.getSelect(i) == true)
		{
			nRow = ds_menuItemList.findRow("RECIPE_CD", ds_menuItemList.getColumn(i,"RECIPE_CD"));
			ds_menuItemList.clearSelect();
			ds_menuItemList.selectRow(nRow, true);		
		}
	}
	
	var arg = {
			   RECIPE_CD:ds_menuItemList.getColumn(e.row, "RECIPE_CD")
			 , UPJANG:ds_menuItemList.getColumn(e.row, "UPJANG")
			 , MENU_CD:ds_menuItemList.getColumn(e.row, "MENU_CD")
			 , HALL_CD:gfn_trim(fa_HALL_CD)
			 , SUBINV_CODE:gfn_trim(fa_SUBINV_CODE)
			 , MEAL:''
			 , CORNER:''
			 , MENU_DATE:gfn_trim(cal_menuDate.fn_getValue())
			 , ITEM_CODE:ds_menuItemList.getColumn(e.row, "ITEM_CODE")
			 , ITEM_NAME:ds_menuItemList.getColumn(e.row, "ITEM_NAME")
			 , NEED_DATE:ds_menuItemList.getColumn(e.row, "NEED_DATE")
	};
	
	gfn_dialog("", "U_FSM::FSM90031P.xfdl", arg); 	
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : ds_menuItemList_oncolumnchanged(obj:Dataset, e:DSColChangeEventInfo)
 * 기ㅡㅡㅡ능 : 자재정보 변경시 처리
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-01
 ******************************************************************************************/
function ds_menuItemList_oncolumnchanged(obj:Dataset, e:DSColChangeEventInfo)
{
	var v_EQ=0;	// EDIBLE_QTY		가식부량 1인소요량 * 폐기율==>NEED_QTY*(100-disuse_rate)
	var v_PP=0; // PERSON_PRICE 	1인원가	자재g당단가*1인소요량==>GRAM_PRICE*NEED_QTY
	var v_TQ=0; // 1인소요량 * 예상식수/1000 = 총소요량  
	var v_Price=0;
	var v_Row=-1;
	
	switch(e.columnid)
	{
		case "NEED_QTY":	// 1인소요량
			v_PP = Math.round(ds_menuItemList.getColumn(e.row, "G_ITEM_PRICE") * ds_menuItemList.getColumn(e.row, "NEED_QTY"), 0);
			ds_menuItemList.setColumn(e.row, "CUR_PRICE", v_PP);	// 1인원가 
			
			v_EQ = Math.round(ds_menuItemList.getColumn(e.row, "NEED_QTY") * ((100 - ds_menuItemList.getColumn(e.row, "DISUSE_RATE")) / 100), 2);
			ds_menuItemList.setColumn(e.row, "EDIBLE_QTY", v_EQ);	// 가식부량	
			
			v_TQ = Math.round((ds_menuItemList.getColumn(e.row, "NEED_QTY") * ds_menuItemList.getColumn(e.row, "EXPECT_MEAL_QTY")) / 1000, 2);
			ds_menuItemList.setColumn(e.row, "TOT_QTY", v_TQ);		// 총소요량
			
			// 1인원가 식단레시피 마스터그리드 반영
			v_Price = ds_menuItemList.getCaseSum("RECIPE_CD=="+wrapQuote(ds_menuItemList.getColumn(e.row,"RECIPE_CD")), "CUR_PRICE");
			v_Row = ds_menuList.findRow("RECIPE_CD", ds_menuItemList.getColumn(e.row,"RECIPE_CD"));
			ds_menuList.setColumn(v_Row, "RECIPE_COST", v_Price);
			break;
	}
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : Tab00_tabpage1_btn_ibDateUpdate_onclick(obj:Button,  e:ClickEventInfo)
 * 기ㅡㅡㅡ능 : 입고예정일일괄수정
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-01
 ******************************************************************************************/
function Tab00_tabpage1_btn_ibDateUpdate_onclick(obj:Button,  e:ClickEventInfo)
{
	if(Tab00.tabindex != 0)
	{
		return;
	}
	
	if(ds_menuItemList.getRowCount() == 0)
	{
		return;
	}
	
	gfn_dialog("", "U_FSM::FSM90034P.xfdl", "");		
}

function Tab00_tabpage1_grd_menuItemList_onmousemove(obj:Grid, e:GridMouseEventInfo)
{
	var strMsg = "";
	var v_Value;
	
	// 금지자재
	if (e.cell == 3 || e.cell == 4 || e.cell == 5)
	{
		v_Value = ds_menuItemList.getColumn(e.row,"RESTRICT_SEQ");
		
		if (v_Value > 0)
		{
			strMsg = "- 금지기간 : " + ds_menuItemList.getColumn(e.row,"RESTRICT_PERIOD") + "\n";
			strMsg += "- 금지사유 : " + ds_menuItemList.getColumn(e.row,"RESTRICT_REASON");
		}
	}
	
	Tab00.tabpage1.grd_menuItemList.tooltiptext = strMsg;	
}

function Tab00_tabpage1_chk_cheapYn_onclick(obj:CheckBox,  e:ClickEventInfo)
{
	ds_menuItemList.clearData();
	if(obj.value == 1)
	{
		jsp_transaction(this, "FSM00060E_T009","U_svc::" + "fs/fsm/FSM00060E_T009.jsp", "ds_cond=ds_cond","ds_menuItemList=ds_List", "", "fn_callbackSearch", false, false, false);
	}
	else
	{
		jsp_transaction(this, "FSM00060E_T008","U_svc::" + "fs/fsm/FSM00060E_T008.jsp", "ds_cond=ds_cond","ds_menuItemList=ds_List", "", "fn_callbackSearch", false, false, false);
	}
}]]></Script>
  </Form>
</FDL>
