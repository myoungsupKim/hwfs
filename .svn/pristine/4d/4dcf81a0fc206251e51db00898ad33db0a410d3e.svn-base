<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="../../../default_typedef.xml"/>
  <Form id="FSP00038V" onload="form_onload" titletext="최근DATA" position="absolute 0 0 1140 320" scrollbars="none">
    <Layouts>
      <Layout>
        <Static id="Static06" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 0 15 309"/>
        <Static id="Static03" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1125 0 1140 309"/>
        <Static id="Static29" class="sta_WFSA_Labelbg" position="absolute 0 0 1140 125" anchor="left top right"/>
        <ImageViewer id="ImgItem" taborder="11" stretch="fit" onclick="ImgItem_onclick" position="absolute 721 10 879 115" tabstop="false"/>
        <CheckBox id="chk_Cheap" taborder="29" tabstop="false" text="저단가순" value="N" truevalue="Y" falsevalue="N" onclick="chk_Cheap_OnClick" visible="false" position="absolute 934 8 1004 29"/>
        <CheckBox id="chk_3Month" taborder="30" tabstop="false" text="3개월이내 신청" value="N" truevalue="Y" falsevalue="N" onclick="chk_3Month_OnClick" visible="false" position="absolute 1010 8 1116 29"/>
        <Static id="Static07" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 125 1140 135"/>
        <Static id="Static00" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 0 10 125"/>
        <Static id="Static02" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1130 4 1140 125"/>
        <Static id="Static09" text="아이콘기준 h08" class="Guide01_AreaRed" visible="false" position="absolute 10 0 1140 10"/>
        <Static id="Static05" class="Guide01_AreaRed" visible="false" position="absolute 104 12 107 34"/>
        <Static id="sta_detail05" class="sta_WFDA_Labelbg" position="absolute 95 10 719 37"/>
        <Static id="sta_detail01" class="sta_WFDA_Labelbg" position="absolute 95 36 719 63"/>
        <Combo id="cbo_item_class2" taborder="1" autoselect="true" imemode="hangul" innerdataset="ds_item_class2" codecolumn="CLASS_CODE" datacolumn="CLASS_NAME" type="search" displayrowcount="26" onitemchanged="cbo_class_onChanged" position="absolute 132 39 362 60" onkeydown="Combo_onkeydown"/>
        <Combo id="cbo_item_class1" taborder="0" imemode="hangul" innerdataset="ds_item_class1" codecolumn="CLASS_CODE" datacolumn="CLASS_NAME" type="search" onitemchanged="cbo_class_onChanged" class="cmb_WF_Essential" position="absolute 132 13 362 34" onkeydown="Combo_onkeydown" enable="true" readonly="false"/>
        <Static id="sta_detail03" class="sta_WFDA_Labelbg" position="absolute 95 62 719 89"/>
        <Combo id="cbo_item_class3" taborder="2" imemode="hangul" innerdataset="ds_item_class3" codecolumn="CLASS_CODE" datacolumn="CLASS_NAME" type="search" displayrowcount="25" onitemchanged="cbo_class_onChanged" position="absolute 132 65 362 86" onkeydown="Combo_onkeydown"/>
        <Static id="sta_detail07" class="sta_WFDA_Labelbg" position="absolute 95 88 719 115"/>
        <Combo id="cbo_item_class4" taborder="3" imemode="hangul" innerdataset="ds_item_class4" codecolumn="CLASS_CODE" datacolumn="CLASS_NAME" type="search" displayrowcount="24" onitemchanged="cbo_class_onChanged" position="absolute 132 91 362 112" onkeydown="Combo_onkeydown"/>
        <Static id="st_Cust" text="업체명" class="sta_WFDA_Label01" position="absolute 364 10 484 37" userdata="strPOQuery_CUST"/>
        <Button id="btn_item_search" taborder="10" text="자재조회" onclick="fn_item_search" class="btn_WF_Function" position="absolute 640 91 715 112"/>
        <Static id="Static04" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 10 115 1130 125"/>
        <Static id="sta_detail04" text="대분류" class="sta_WFDA_Label01" position="absolute 10 10 130 37"/>
        <Static id="sta_detail02" text="중분류" class="sta_WFDA_Label01" position="absolute 10 36 130 63"/>
        <Static id="sta_detail06" text="소분류" class="sta_WFDA_Label01" position="absolute 10 62 130 89"/>
        <Static id="sta_detail10" text="세분류" class="sta_WFDA_Label01" position="absolute 10 88 130 115"/>
        <Static id="sta_detail09" text="기간" class="sta_WFDA_Label01" position="absolute 364 36 484 63"/>
        <MaskEdit id="msk_dt_fr" mask="####-##-##" oneditclick="g_Date_OnFocus" onsetfocus="g_Date_OnFocus" onkillfocus="g_Date_OnKillFocus" taborder="5" type="string" position="absolute 486 39 573 60" style="align:center middle;" onkeydown="MaskEdit_onkeydown" tooltiptext="시작일자" class="msk_WF_Essential"/>
        <Button id="btn_StartDate" onclick="g_CalButton_OnClick" taborder="26" tabstop="false" userdata="msk_dt_fr" position="absolute 572 39 595 60" class="btn_WF_calEssential" text="" image=""/>
        <Static id="Static1" text="~" position="absolute 598 45 606 58"/>
        <MaskEdit id="msk_dt_to" mask="####-##-##" oneditclick="g_Date_OnFocus" onsetfocus="g_Date_OnFocus" onkillfocus="g_Date_OnKillFocus" taborder="6" type="string" position="absolute 609 39 696 60" style="align:center middle;" onkeydown="MaskEdit_onkeydown" tooltiptext="종료일자" class="msk_WF_Essential"/>
        <Button id="btn_EndDate" onclick="g_CalButton_OnClick" taborder="27" tabstop="false" userdata="msk_dt_to" position="absolute 695 39 716 60" class="btn_WF_calEssential" text="" image=""/>
        <Grid id="grd_ItemList" taborder="41" binddataset="ds_recent_list" wheelscrollrow="1" useinputpanel="false" selecttype="currow" cellsizingtype="col" autofittype="col" hideendline="col" onmousemove="grd_ItemList_OnMouseOver" oncelldblclick="grd_ItemList_OnCellDblClick" position="absolute 0 130 1140 320" anchor="all" tabstop="false" class="grd_WF_LineNone" autoenter="select" onheadclick="grd_ItemList_onheadclick" onexpandup="grd_ItemList_onexpandup" onkeydown="grd_ItemList_OnKeyDown" tooltiptype="hover">
          <Formats>
            <Format id="Default">
              <Columns>
                <Column size="30" band="left"/>
                <Column size="22"/>
                <Column size="78"/>
                <Column size="200"/>
                <Column size="120"/>
                <Column size="50"/>
                <Column size="60"/>
                <Column size="89"/>
                <Column size="70"/>
                <Column size="60"/>
                <Column size="60"/>
                <Column size="60"/>
                <Column size="60"/>
                <Column size="109"/>
                <Column size="60"/>
                <Column size="75"/>
              </Columns>
              <Rows>
                <Row size="26" band="head"/>
                <Row size="23"/>
              </Rows>
              <Band id="head">
                <Cell displaytype="text" class="head_Excel"/>
                <Cell col="1" colspan="2" displaytype="text" text="자재코드" taborder="undefined"/>
                <Cell col="3" displaytype="text" text="자재명"/>
                <Cell col="4" displaytype="text" text="규격"/>
                <Cell col="5" displaytype="text" text="단위"/>
                <Cell col="6" displaytype="text" text="원산지"/>
                <Cell col="7" displaytype="text" text="단가"/>
                <Cell col="8" displaytype="text" text="KG환산율"/>
                <Cell col="9" displaytype="text" text="g단가"/>
                <Cell col="10" displaytype="text" text="과/면세"/>
                <Cell col="11" text="D-Day"/>
                <Cell col="12" displaytype="text" text="센터경유"/>
                <Cell col="13" displaytype="text" text="바코드"/>
                <Cell col="14" displaytype="text" text="보관"/>
                <Cell col="15" text="최근입고일"/>
              </Band>
              <Band id="body">
                <Cell displaytype="text" style="align:center;background:EXPR(PR_YN == 'Y' ? 'default' : '#a9a9a932' );background2:EXPR(PR_YN == 'Y' ? 'default' : '#a9a9a932' );color:EXPR(PR_YN == 'Y' ? 'default' : 'gray' );color2:EXPR(PR_YN == 'Y' ? 'default' : 'gray' );" expr="expr:currow+1"/>
                <Cell col="1" displaytype="button" style="padding:5 5 5 5;linetype:onlyhorz;background:EXPR(PR_YN == 'A' ? '#a9a9a932' :PR_YN == 'B' ? '#ffaa9cff' : PR_YN == 'C' ? 'khaki' : 'default');background2:EXPR(PR_YN == 'A' ? '#a9a9a932' :PR_YN == 'B' ? '#ffaa9cff' : PR_YN == 'C' ? 'khaki' : 'default');color:EXPR(PR_YN == 'Y' ? 'default' : 'gray' );color2:EXPR(PR_YN == 'Y' ? 'default' : 'gray' );controlbackground:EXPR( PR_YN!='Y' ? 'gray' : '#7bd7a3ff');controlborder:1 none #808080ff ;controlbordertype:round 10 10 ;"/>
                <Cell col="2" displaytype="text" edittype="expand" style="align:center;linetype: ;background:EXPR(PR_YN == 'A' ? '#a9a9a932' :PR_YN == 'B' ? '#ffaa9cff' : PR_YN == 'C' ? 'khaki' : 'default');background2:EXPR(PR_YN == 'A' ? '#a9a9a932' :PR_YN == 'B' ? '#ffaa9cff' : PR_YN == 'C' ? 'khaki' : 'default');color:EXPR(PR_YN == 'Y' ? 'default' : 'gray' );color2:EXPR(PR_YN == 'Y' ? 'default' : 'gray' );" text="bind:ITEM_CODE" expandshow="show" expandsize="24" expandimage="URL('theme://Images\new\grd_WF_ExpandImage.png')"/>
                <Cell col="3" displaytype="text" edittype="expr:gfn_isNull(IMG_PATH) ? 'none' : 'expand'" style="align:left;padding:EXPR(gfn_isNull(FEATURE_NAME) ? '0 0 0 5' : '0 0 0 46');background:EXPR(PR_YN == 'A' ? '#a9a9a932' :PR_YN == 'B' ? '#ffaa9cff' : PR_YN == 'C' ? 'khaki' : 'default');background2:EXPR(PR_YN == 'A' ? '#a9a9a932' :PR_YN == 'B' ? '#ffaa9cff' : PR_YN == 'C' ? 'khaki' : 'default');color:EXPR(PR_YN == 'Y' ? 'default' : 'gray' );color2:EXPR(PR_YN == 'Y' ? 'default' : 'gray' );backgroundimage:EXPR(FEATURE_NAME);" text="bind:ITEM_NAME" expandshow="expr:gfn_isNull(IMG_PATH) ? 'hide' : 'show'" expandsize="24" expandimage="URL('theme://Images/new/grd_WF_Camerabtn.png')"/>
                <Cell col="4" displaytype="text" style="align:left;background:EXPR(PR_YN == 'Y' ? 'default' : '#a9a9a932' );background2:EXPR(PR_YN == 'Y' ? 'default' : '#a9a9a932' );color:EXPR(PR_YN == 'Y' ? 'default' : 'gray' );color2:EXPR(PR_YN == 'Y' ? 'default' : 'gray' );" text="bind:ITEM_SIZE"/>
                <Cell col="5" displaytype="text" style="align:center;background:EXPR(PR_YN == 'Y' ? 'default' : '#a9a9a932' );background2:EXPR(PR_YN == 'Y' ? 'default' : '#a9a9a932' );color:EXPR(PR_YN == 'Y' ? 'default' : 'gray' );color2:EXPR(PR_YN == 'Y' ? 'default' : 'gray' );" text="bind:PO_UOM"/>
                <Cell col="6" displaytype="text" style="align:center;background:EXPR(PR_YN == 'Y' ? 'default' : '#a9a9a932' );background2:EXPR(PR_YN == 'Y' ? 'default' : '#a9a9a932' );color:EXPR(PR_YN == 'Y' ? 'default' : 'gray' );color2:EXPR(PR_YN == 'Y' ? 'default' : 'gray' );" text="bind:ORIGIN_TYPE"/>
                <Cell col="7" displaytype="number" style="align:right;background:EXPR(PR_YN == 'Y' ? 'default' : '#a9a9a932' );background2:EXPR(PR_YN == 'Y' ? 'default' : '#a9a9a932' );color:EXPR(PR_YN == 'Y' ? 'default' : 'gray' );color2:EXPR(PR_YN == 'Y' ? 'default' : 'gray' );" text="bind:MARGIN_PRICE"/>
                <Cell col="8" displaytype="number" style="align:right;background:EXPR(PR_YN == 'Y' ? 'default' : '#a9a9a932' );background2:EXPR(PR_YN == 'Y' ? 'default' : '#a9a9a932' );color:EXPR(PR_YN == 'Y' ? 'default' : 'gray' );color2:EXPR(PR_YN == 'Y' ? 'default' : 'gray' );" text="bind:KG_CONVERT_RATE"/>
                <Cell col="9" displaytype="number" style="align:right;background:EXPR(PR_YN == 'Y' ? 'default' : '#a9a9a932' );background2:EXPR(PR_YN == 'Y' ? 'default' : '#a9a9a932' );color:EXPR(PR_YN == 'Y' ? 'default' : 'gray' );color2:EXPR(PR_YN == 'Y' ? 'default' : 'gray' );" text="bind:G_PRICE"/>
                <Cell col="10" displaytype="combo" style="align:center;background:EXPR(PR_YN == 'Y' ? 'default' : '#a9a9a932' );background2:EXPR(PR_YN == 'Y' ? 'default' : '#a9a9a932' );color:EXPR(PR_YN == 'Y' ? 'default' : 'gray' );color2:EXPR(PR_YN == 'Y' ? 'default' : 'gray' );" text="bind:TAX_CODE" combodataset="ds_tax" combocodecol="code" combodatacol="code_name"/>
                <Cell col="11" style="background:EXPR(PR_YN == 'Y' ? 'default' : '#a9a9a932' );background2:EXPR(PR_YN == 'Y' ? 'default' : '#a9a9a932' );color:EXPR(PR_YN == 'Y' ? 'default' : 'gray' );color2:EXPR(PR_YN == 'Y' ? 'default' : 'gray' );" text="bind:D_DAY"/>
                <Cell col="12" displaytype="text" style="align:center;background:EXPR(PR_YN == 'Y' ? 'default' : '#a9a9a932' );background2:EXPR(PR_YN == 'Y' ? 'default' : '#a9a9a932' );color:EXPR(PR_YN == 'Y' ? 'default' : 'gray' );color2:EXPR(PR_YN == 'Y' ? 'default' : 'gray' );" text="bind:CENTER_FLAG"/>
                <Cell col="13" displaytype="normal" edittype="none" style="align:center middle;padding:0 1 0 1;background:EXPR(PR_YN == 'Y' ? 'default' : '#a9a9a932' );background2:EXPR(PR_YN == 'Y' ? 'default' : '#a9a9a932' );color:EXPR(PR_YN == 'Y' ? 'default' : 'gray' );color2:EXPR(PR_YN == 'Y' ? 'default' : 'gray' );" text="bind:BARCODE" editautoselect="true"/>
                <Cell col="14" displaytype="text" style="align:center;background:EXPR(PR_YN == 'Y' ? 'default' : '#a9a9a932' );background2:EXPR(PR_YN == 'Y' ? 'default' : '#a9a9a932' );color:EXPR(PR_YN == 'Y' ? 'default' : 'gray' );color2:EXPR(PR_YN == 'Y' ? 'default' : 'gray' );" text="bind:KEEPING_TYPE"/>
                <Cell col="15" text="bind:RECENT_NEED_DATE"/>
              </Band>
            </Format>
            <Format id="Default0">
              <Columns>
                <Column size="30"/>
                <Column size="116"/>
                <Column size="213"/>
                <Column size="183"/>
                <Column size="63"/>
                <Column size="93"/>
                <Column size="65"/>
                <Column size="59"/>
                <Column size="111"/>
              </Columns>
              <Rows>
                <Row size="22" band="head"/>
                <Row size="20"/>
              </Rows>
              <Band id="head">
                <Cell col="0" displaytype="text" class="head_Excel"/>
                <Cell col="1" displaytype="text" text="자재코드"/>
                <Cell col="2" displaytype="text" text="자재명"/>
                <Cell col="3" displaytype="text" text="규격"/>
                <Cell col="4" displaytype="text" text="단위"/>
                <Cell col="5" displaytype="text" text="단가"/>
                <Cell col="6" displaytype="text" text="과/면세"/>
                <Cell col="7" displaytype="text" text="센터경유"/>
                <Cell col="8" displaytype="text" text="바코드"/>
              </Band>
              <Band id="body">
                <Cell col="0" displaytype="text" expr="expr:currow+1" style="align:center;"/>
                <Cell col="1" text="bind:ITEM_CODE" displaytype="text" style="align:center;"/>
                <Cell col="2" text="bind:ITEM_NAME" displaytype="text" style="align:left;"/>
                <Cell col="3" text="bind:ITEM_SIZE" displaytype="text" style="align:left;"/>
                <Cell col="4" text="bind:PO_UOM" displaytype="text" style="align:center;"/>
                <Cell col="5" text="bind:MARGIN_PRICE" displaytype="number" style="align:left;"/>
                <Cell col="6" text="bind:TAX_CODE" combocodecol="TAX_CODE" combodataset="ds_tax" combodatacol="TAX_NAME" displaytype="combo" style="align:center;"/>
                <Cell col="7" text="bind:CENTER_FLAG" displaytype="text" style="align:center;"/>
                <Cell col="8" text="bind:BARCODE" displaytype="text" style="align:center;"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Div id="div_popup" taborder="42" style="background:#ffffffff;border:2 solid #515d6fff ;" onkillfocus="div_popup_onkillfocus" text="Div00" visible="false" position="absolute 457 199 769 272">
          <Layouts>
            <Layout>
              <Static id="Static00" class="sta_WFDA_Labelbg" position="absolute 98 37 303 64"/>
              <Static id="Static04" text="신청량" class="sta_WFDA_Label01" position="absolute 5 37 99 64"/>
              <MaskEdit id="msk_pr_qty" taborder="3" displaynulltext="0" mask="###,###,###.##" autoselect="true" onkeydown="div_popup_msk_pr_qty_onkeydown" position="absolute 101 40 300 61" style="font:Gulim,10;" limitbymask="both" value="null"/>
              <Static id="Static01" class="sta_TF_Bg" position="absolute 0 0 308 32" style="border:0 none #808080ff,0 none #808080ff,2 solid #01a7adff,0 none #808080ff;"/>
              <Button id="btn_add" taborder="4" text="입력" onclick="div_popup_btn_add_onclick" class="btn_WF_Custom" position="absolute 218 5 259 26"/>
              <Button id="btn_close" taborder="5" text="닫기" onclick="div_popup_btn_close_onclick" class="btn_WF_Custom" position="absolute 261 5 302 26"/>
              <Static id="Static02" text="신청량 입력" position="absolute 5 6 125 26" style="color:white;padding:0 0 0 9;font:Gulim,9,bold;"/>
            </Layout>
          </Layouts>
        </Div>
        <Static id="sta_detail08" text="자재코드/명" class="sta_WFDA_Label01" position="absolute 364 62 484 89"/>
        <Edit id="edt_item_code" taborder="7" autoselect="true" position="absolute 486 65 716 86" onkeydown="Edit_onkeydown"/>
        <Edit id="edt_custNm" taborder="4" readonly="true" autoselect="true" onkeydown="edt_custNm_onkeydown" position="absolute 486 13 696 34" anchor="left top"/>
        <Button id="btn_custSearch" taborder="44" onclick="btn_custSearch_onclick" class="btn_WF_popSearch" position="absolute 695 13 716 34" anchor="left top"/>
        <Static id="Static08" position="absolute 893 73 908 88" style="background:khaki;"/>
        <Static id="Static10" text="금지자재" position="absolute 913 71 986 92"/>
        <CheckBox id="chk_only" taborder="45" text="구매불가자재 제외" value="N" truevalue="Y" falsevalue="N" onchanged="chk_only_onchanged" position="absolute 894 91 1020 112"/>
        <Static id="sta_detail00" text="자재특성" class="sta_WFDA_Label01" position="absolute 364 88 484 115"/>
        <Combo id="cbo_feature" taborder="46" value="0" text="전체" codecolumn="codecolumn" datacolumn="datacolumn" index="0" onitemchanged="cbo_feature_onitemchanged" position="absolute 486 91 637 112">
          <Dataset id="innerdataset">
            <ColumnInfo>
              <Column id="codecolumn" size="256"/>
              <Column id="datacolumn" size="256"/>
            </ColumnInfo>
            <Rows>
              <Row>
                <Col id="codecolumn">0</Col>
                <Col id="datacolumn">전체</Col>
              </Row>
              <Row>
                <Col id="codecolumn">theme://Images/new/grd_WF_Icon11.png</Col>
                <Col id="datacolumn">기획자재</Col>
              </Row>
              <Row>
                <Col id="codecolumn">theme://Images/new/grd_WF_Icon10.png</Col>
                <Col id="datacolumn">전처리</Col>
              </Row>
              <Row>
                <Col id="codecolumn">theme://Images/new/grd_WF_Icon09.png</Col>
                <Col id="datacolumn">PB상품</Col>
              </Row>
              <Row>
                <Col id="codecolumn">theme://Images/new/grd_WF_Icon08.png</Col>
                <Col id="datacolumn">친환경</Col>
              </Row>
            </Rows>
          </Dataset>
        </Combo>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_item_class1">
        <ColumnInfo>
          <Column id="CLASS_CODE" size="8" type="STRING"/>
          <Column id="CLASS_NAME" size="50" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_item_class2">
        <ColumnInfo>
          <Column id="CLASS_CODE" size="16" type="STRING"/>
          <Column id="CLASS_NAME" size="50" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_item_class3">
        <ColumnInfo>
          <Column id="CLASS_CODE" size="16" type="STRING"/>
          <Column id="CLASS_NAME" size="50" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_item_class4">
        <ColumnInfo>
          <Column id="CLASS_CODE" size="16" type="STRING"/>
          <Column id="CLASS_NAME" size="50" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_item_condi" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="PO_TYPE" type="STRING" size="256"/>
          <Column id="EXPT_UPJANG_YN" type="STRING" size="256"/>
          <Column id="APPROV_YN" type="STRING" size="256"/>
          <Column id="PR_DATE" type="STRING" size="256"/>
          <Column id="NEED_DATE" type="STRING" size="256"/>
          <Column id="SUBINV_CODE" type="STRING" size="256"/>
          <Column id="ITEM_CODE" type="STRING" size="256"/>
          <Column id="ITEM_NAME" type="STRING" size="256"/>
          <Column id="ITEM_CLASS1" type="STRING" size="256"/>
          <Column id="ITEM_CLASS2" type="STRING" size="256"/>
          <Column id="ITEM_CLASS3" type="STRING" size="256"/>
          <Column id="ITEM_CLASS4" type="STRING" size="256"/>
          <Column id="CUSTCD" type="STRING" size="256"/>
          <Column id="CUSTNM" type="STRING" size="256"/>
          <Column id="DT_FR" type="STRING" size="256"/>
          <Column id="DT_TO" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row/>
        </Rows>
      </Dataset>
      <Dataset id="ds_recent_list" onrowposchanged="ds_recent_list_OnRowPosChanged">
        <ColumnInfo>
          <Column id="ITEM_CODE" type="STRING" size="18"/>
          <Column id="ITEM_NAME" type="STRING" size="601"/>
          <Column id="ITEM_CLASS4" type="STRING" size="18"/>
          <Column id="FEATURE_NAME" type="STRING" size="1"/>
          <Column id="ITEM_SIZE" type="STRING" size="1000"/>
          <Column id="PO_UOM" type="STRING" size="18"/>
          <Column id="KG_QTY" type="BIGDECIMAL" size="39"/>
          <Column id="CANCEL_PR_QTY" type="BIGDECIMAL" size="39"/>
          <Column id="G_PRICE" type="BIGDECIMAL" size="39"/>
          <Column id="PR_QTY" type="BIGDECIMAL" size="39"/>
          <Column id="PR_AMT" type="BIGDECIMAL" size="39"/>
          <Column id="TOT_AMT" type="BIGDECIMAL" size="39"/>
          <Column id="TAX_CODE" type="STRING" size="3"/>
          <Column id="CENTER_FLAG" type="STRING" size="1"/>
          <Column id="PR_REMARK" type="STRING" size="256"/>
          <Column id="REMARK" type="STRING" size="255"/>
          <Column id="POINT_FLAG" type="STRING" size="1"/>
          <Column id="SUBINV_CODE" type="STRING" size="8"/>
          <Column id="NEED_DATE" type="STRING" size="8"/>
          <Column id="UPJANG" type="BIGDECIMAL" size="39"/>
          <Column id="DEPT_ID" type="STRING" size="6"/>
          <Column id="ACCTCD" type="STRING" size="255"/>
          <Column id="BUD_CLS" type="STRING" size="30"/>
          <Column id="MU_CD" type="STRING" size="4"/>
          <Column id="INVAT_FLAG" type="STRING" size="1"/>
          <Column id="OUTVAT_FLAG" type="STRING" size="1"/>
          <Column id="MIN_ORD_QTY" type="BIGDECIMAL" size="14"/>
          <Column id="MAX_ORD_QTY" type="BIGDECIMAL" size="14"/>
          <Column id="CENTER_CODE" type="STRING" size="18"/>
          <Column id="STOCK_FLAG" type="STRING" size="1"/>
          <Column id="BARCODE" type="STRING" size="60"/>
          <Column id="KEEPING_TYPE" type="STRING" size="60"/>
          <Column id="MULTIPLIER_QTY" type="BIGDECIMAL" size="14"/>
          <Column id="BUDDEPT_ID" type="STRING" size="30"/>
          <Column id="USE_YN" type="STRING" size="1"/>
          <Column id="CONTRACT_YN" type="STRING" size="1"/>
          <Column id="MARGIN_PRICE" type="STRING" size="40"/>
          <Column id="UNIT_PRICE" type="BIGDECIMAL" size="22"/>
          <Column id="CUSTCD" type="BIGDECIMAL" size="39"/>
          <Column id="CHEAP_YN" type="STRING" size="1"/>
          <Column id="KG_CONVERT_RATE" type="BIGDECIMAL" size="39"/>
          <Column id="MARGIN_RATE" type="BIGDECIMAL" size="8"/>
          <Column id="AP_UNITPRICE_UPJANG" type="BIGDECIMAL" size="39"/>
          <Column id="RESTRICT_PERIOD" type="STRING" size="21"/>
          <Column id="RESTRICT_REASON" type="STRING" size="200"/>
          <Column id="DUTY_END_DATE" type="STRING" size="255"/>
          <Column id="MIN_DUTY_QTY" type="BIGDECIMAL" size="39"/>
          <Column id="DUTY_QTY" type="BIGDECIMAL" size="39"/>
          <Column id="REAL_USE_QTY" type="BIGDECIMAL" size="39"/>
          <Column id="PR_YN" type="STRING" size="1"/>
          <Column id="D_DAY" type="BIGDECIMAL" size="39"/>
          <Column id="D_DAYS" type="BIGDECIMAL" size="39"/>
          <Column id="D_TIMES" type="BIGDECIMAL" size="39"/>
          <Column id="D_DAY_YN" type="STRING" size="1"/>
          <Column id="SPICE_YN" type="STRING" size="1"/>
          <Column id="CORN_YN" type="STRING" size="1"/>
          <Column id="IMG_PATH" type="STRING" size="756"/>
          <Column id="ORIGIN_NAT" type="STRING" size="60"/>
          <Column id="ORIGIN_TYPE" type="STRING" size="60"/>
          <Column id="VD_SN" type="STRING" size="18"/>
          <Column id="APPLY_SD" type="STRING" size="8"/>
          <Column id="MOBILE_GUBUN" type="STRING" size="1"/>
          <Column id="RECENT_NEED_DATE" type="STRING" size="8"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Bind>
      <BindItem id="item9" compid="sta_detail09" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item5" compid="sta_detail05" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item1" compid="sta_detail01" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item12" compid="cbo_item_class2" propid="value" datasetid="ds_item_condi" columnid="ITEM_CLASS2"/>
      <BindItem id="item11" compid="cbo_item_class1" propid="value" datasetid="ds_item_condi" columnid="ITEM_CLASS1"/>
      <BindItem id="item8" compid="sta_detail08" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item16" compid="edt_item_code" propid="value" datasetid="ds_item_condi" columnid="ITEM_CODE"/>
      <BindItem id="item3" compid="sta_detail03" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item13" compid="cbo_item_class3" propid="value" datasetid="ds_item_condi" columnid="ITEM_CLASS3"/>
      <BindItem id="item7" compid="sta_detail07" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item14" compid="cbo_item_class4" propid="value" datasetid="ds_item_condi" columnid="ITEM_CLASS4"/>
      <BindItem id="item10" compid="st_Cust" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item4" compid="sta_detail04" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item2" compid="sta_detail02" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item6" compid="sta_detail06" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item17" compid="sta_detail10" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item0" compid="msk_dt_fr" propid="value" datasetid="ds_item_condi" columnid="DT_FR"/>
      <BindItem id="item15" compid="msk_dt_to" propid="value" datasetid="ds_item_condi" columnid="DT_TO"/>
      <BindItem id="item22" compid="edt_custNm" propid="value" datasetid="ds_item_condi" columnid="CUSTNM"/>
      <BindItem id="item18" compid="sta_detail00" propid="text" datasetid="ds_view" columnid="D_1"/>
    </Bind>
    <Script type="xscript4.0"><![CDATA[/*
 ******************************************************************************************
 * 시스템구분   : 구매관리 / 신청관리 / 구매신청(자동 식단)
 * 프로그램명   : FSP00032E
 * 기      능   : 구매신청(자동 식단)
 * 작  성  자   : 정영철
 * 작성  일자   : 2015-06-04
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
 
/************************************************************************************************
 * 공통 라이브러리 INCLUDE 영역 (필수)
************************************************************************************************/ 
include "U_lib::lib_conversionCom.xjs";

/************************************************************************************************
 * FORM 변수 선언 영역 (필수)
************************************************************************************************/ 

/************************************************************************************************
 * FORM EVENT 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 화면 로드시 이벤트
 *---------------------------------------------------------------------------------------------*/
function form_onload(obj:Form, e:LoadEventInfo)
{
    gfn_formOnLoad(this);

    fsp_init(this);
    
    fn_init();
}

function fn_init()
{
    //분류 세팅
    if(parent.parent.ds_condi.getColumn(0, "PO_TYPE") == "11" || parent.parent.ds_condi.getColumn(0, "PO_TYPE") == "88")
    {
        fn_sql_common("C", strQuery_FMItemClass, " AND A.USE_YN = 'Y' AND A.CLASS_TYPE = 'L' AND CLASS_CODE ='G'", " ORDER BY A.CLASS_CODE","none"                 , cbo_item_class1, -1, ds_item_class1); cbo_item_class1.index = 0;
        fn_sql_common("C", strQuery_FMItemClass, " AND A.USE_YN = 'Y' AND A.CLASS_TYPE = 'M' AND SUBSTR(CLASS_CODE, 1,  1) = 'G'", " ORDER BY   A.CLASS_CODE","all", cbo_item_class2, -1, ds_item_class2); cbo_item_class2.index = 0;
        fn_sql_common("C", strQuery_FMItemClass, " AND A.USE_YN = 'Y' AND A.CLASS_TYPE = 'S' AND SUBSTR(CLASS_CODE, 1,  1) = 'G'", " ORDER BY   A.CLASS_CODE","all", cbo_item_class3, -1, ds_item_class3); cbo_item_class3.index = 0;
        fn_sql_common("C", strQuery_FMItemClass, " AND A.USE_YN = 'Y' AND A.CLASS_TYPE = 'D' AND SUBSTR(CLASS_CODE, 1,  1) = 'G'", " ORDER BY   A.CLASS_CODE","all", cbo_item_class4, -1, ds_item_class4); cbo_item_class4.index = 0;
    }
    else
    {
        fn_sql_common("C", strQuery_FMItemClass, " AND A.USE_YN = 'Y' AND A.CLASS_TYPE = 'L' AND CLASS_CODE = 'F'" ," ORDER BY A.CLASS_CODE","none"            , cbo_item_class1, -1, ds_item_class1); cbo_item_class1.index = 0;
        fn_sql_common("C", strQuery_FMItemClass, " AND A.USE_YN = 'Y' AND A.CLASS_TYPE = 'M' AND SUBSTR(CLASS_CODE, 1,  1) = 'F'", " ORDER BY   A.CLASS_CODE","all", cbo_item_class2, -1, ds_item_class2); cbo_item_class2.index = 0;
        fn_sql_common("C", strQuery_FMItemClass, " AND A.USE_YN = 'Y' AND A.CLASS_TYPE = 'S' AND SUBSTR(CLASS_CODE, 1,  1) = 'F'", " ORDER BY   A.CLASS_CODE","all", cbo_item_class3, -1, ds_item_class3); cbo_item_class3.index = 0;
        fn_sql_common("C", strQuery_FMItemClass, " AND A.USE_YN = 'Y' AND A.CLASS_TYPE = 'D' AND SUBSTR(CLASS_CODE, 1,  1) = 'F'", " ORDER BY   A.CLASS_CODE","all", cbo_item_class4, -1, ds_item_class4); cbo_item_class4.index = 0;
    }
    
    // 조회조건 셋팅
    ds_item_condi.setColumn(0, "EXPT_UPJANG_YN", parent.parent.ds_condi.getColumn(0, "EXPT_UPJANG_YN"));
    ds_item_condi.setColumn(0, "APPROV_YN"     , parent.parent.ds_condi.getColumn(0, "APPROV_YN"));
    ds_item_condi.setColumn(0, "NEED_DATE"     , parent.parent.ds_condi.getColumn(0, "NEED_DATE"));
    ds_item_condi.setColumn(0, "PR_DATE"       , parent.parent.ds_condi.getColumn(0, "PR_DATE"));
    ds_item_condi.setColumn(0, "SUBINV_CODE"   , parent.parent.ds_condi.getColumn(0, "SUBINV_CODE"));
    
    var f_CurrDate  = fn_CurrDateWeek();
    
    msk_dt_fr.value = gfn_addDate(f_CurrDate, -7);
    msk_dt_to.value = f_CurrDate
    
    cbo_item_class1.setFocus();
}

function btn_item_search_OnClick(obj:Button, e:ClickEventInfo)
{
    fn_item_search();
}

/************************************************************************************************
 * TRANSACTION 및 CallBack 영역 (필수)
************************************************************************************************/

/*----------------------------------------------------------------------------------------------
 * 설명      : 자재조회
 *---------------------------------------------------------------------------------------------*/
function fn_item_search()
{   
    var sSvcID;         // 서비스 ID
    var sUrl;           // jsp 경로
    var sInDs;          // 입력 데이터셋
    var sOutDs;         // 출력 데이터셋
    var sArg;           // 추가 파라미터
    var sCallFunc;      // 콜백함수명
    
    sSvcID    = "ITEM_SEARCH";
    sUrl      = "U_svc::" + "fs/fsp/FSP00035E_T004.jsp";
    sInDs     = "ds_item_condi=ds_item_condi";
    sOutDs    = "ds_recent_list=ds_out";
    sCallFunc = "fn_recent_callback";
    
    ds_item_condi.setColumn(0, "ITEM_CODE", edt_item_code.value);
    ds_item_condi.setColumn(0, "SUBINV_CODE",   parent.parent.cbo_subInv.value);
    
    if(!fn_recent_validation(sSvcID)) return;
    
    // 트랜잭션
    jsp_transaction(this, sSvcID, sUrl, sInDs, sOutDs, sArg, sCallFunc, false, false, false);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 콜백함수
 *---------------------------------------------------------------------------------------------*/
function fn_recent_callback(nErrorCode, sErrorMag, sSvcID)
{
    if(toNumber(nErrorCode) !=  0)
    {
        g_Message("EE","조회 중 오류가 발생했습니다.\n에러메세지:" + errMsg);
        return;
    }

    if(ds_recent_list.getCountNF() <=   0)
    {
        g_Message("EE","조회된 자료가 없습니다."); return;
    }
    parent.parent.cbo_subInv.enable = false;
    
    for(var i = 0; i < ds_recent_list.rowcount; i++)
    {
        var strRemark = "";
        if  (ds_recent_list.getColumn(i,"SHP_MAP") ==   "N")
        {
            strRemark = "단가계약 안됨";
            ds_recent_list.setColumn(i,"PR_REMARK",strRemark);
            ds_recent_list.setColumn(i,"PR_YN" , "A");
            ds_recent_list.setColumn(i,"PR_QTY", 0);
        }
        else if (ds_recent_list.getColumn(i,"MTG_UNS") ==   "N")
        {
            strRemark = "불용자재";
            ds_recent_list.setColumn(i,"PR_REMARK",strRemark);
            ds_recent_list.setColumn(i,"PR_YN" , "B");
            ds_recent_list.setColumn(i,"PR_QTY", 0);
        }
        
        else if (ds_recent_list.getColumn(i,"MTG_STP") ==   "N")
        {
            strRemark = "중지자재";
            ds_recent_list.setColumn(i,"PR_REMARK",strRemark);
            ds_recent_list.setColumn(i,"PR_YN" , "B");
            ds_recent_list.setColumn(i,"PR_QTY", 0);
        }
        
        else if (ds_recent_list.getColumn(i,"REQ_WKD") ==   "N")
        {
            strRemark = "거래처 요일 제한";
            ds_recent_list.setColumn(i,"PR_REMARK",strRemark);
            ds_recent_list.setColumn(i,"PR_YN" , "A");
            ds_recent_list.setColumn(i,"PR_QTY", 0);
        }
        
        else if(gfn_length(ds_recent_list.getColumn(i,"RESTRICT_PERIOD")) > 0)
        {
            strRemark = "금지자재(" + ds_recent_list.getColumn(i,"RESTRICT_PERIOD") +   ", " + ds_recent_list.getColumn(i,"RESTRICT_REASON") + ")";
            ds_recent_list.setColumn(i,"PR_REMARK",strRemark);
            ds_recent_list.setColumn(i,"PR_YN" ,"C");
            ds_recent_list.setColumn(i,"PR_QTY",0);
        }
        else if(ds_recent_list.getColumn(i,"SCH") ==    "N")
        {
            strRemark = "수발주제한";
            ds_recent_list.setColumn(i,"PR_REMARK",strRemark);
            ds_recent_list.setColumn(i,"PR_YN" , "A");
            ds_recent_list.setColumn(i,"PR_QTY", 0);
        }
        else if(ds_recent_list.getColumn(i,"D_DAY_YN") ==  "N")
        {
			strRemark = "D-" + ds_recent_list.getColumn(i,"D_DAYS") + "일" + ds_recent_list.getColumn(i,"D_TIMES") + "시 제한";
            ds_item_list.setColumn(i,"PR_REMARK",strRemark);
            ds_item_list.setColumn(i,"PR_YN" , "A");
            ds_item_list.setColumn(i,"PR_QTY", 0);
        }
        else
        {
            ds_recent_list.setColumn(i,"PR_YN" , "Y");
        }       
    }
    
    if(chk_Cheap.value == "Y") Sort(ds_recent_list,"MARGIN_PRICE",true);
    
    grd_ItemList.setFocus();
    fn_setInfoText();
}

/*----------------------------------------------------------------------------------------------
 * 함  수  명   : fn_transation_validation()
 * 기      능   : 조회 전 유효성체크
*----------------------------------------------------------------------------------------------*/
function fn_recent_validation(sSvcID)
{
    switch(sSvcID)
    {
        case "ITEM_SEARCH" :
            var sItemCls2 = ds_item_condi.getColumn(0, "ITEM_CLASS2");
            var sItemCd   = ds_item_condi.getColumn(0, "ITEM_CODE"  );
            var sCustCd   = ds_item_condi.getColumn(0, "CUSTCD"     );
            
            cbo_item_class2.class = "";
            edt_item_code.class   = "";
            edt_custNm.class      = "";
            
            if(!mfn_Chk_Obj_MustInput(msk_dt_fr)){
                msk_dt_fr.class = "msk_WF_Error";   
                msk_dt_fr.setFocus();
                return false;   // 시작일
            }
            if(!mfn_Chk_Obj_MustInput(msk_dt_to)){
                msk_dt_to.class = "msk_WF_Error";   
                msk_dt_to.setFocus();
                return false;   // 종료일
            }
            if(!fn_dateBetweenCheck(msk_dt_fr, msk_dt_to)) {    // 시작일 종료일 체크
                msk_dt_fr.class = "msk_WF_Error";
                msk_dt_to.class = "msk_WF_Error";
                msk_dt_fr.setFocus();
                return false;
            }
            
            msk_dt_fr.class = "msk_WF_Essential";
            msk_dt_to.class = "msk_WF_Essential";
            
            return true;
            break;
    }
    
    return true;
}

function fn_transation_callback(errCode, errMsg)
{
    if(toNumber(errCode) != 0)
    {
        g_Message("EE","조회 중 오류가 발생했습니다.\n에러메세지:" + errMsg);
        return;
    }
    
    if(ds_recent_list.getCountNF() <= 0)
    {
        g_Message("EE","조회된 자료가 없습니다."); return;
    }
    // 창고 콤보 비활성화
    parent.parent.cbo_subInv.enable = false;
    
//  for(var i = ds_recent_list.getCountNF()-1; i >= 0; i--)
//  {
// 
//      if(ds_recent_list.getColumn(i,"PR_YN") == "N")
//      {
//          //ds_recent_list.setColumn(i,"REMARK","요일 제한(입고가능요일:" + ds_recent_list.getColumn(i,"SCH_INFO") + ")");
//          ds_recent_list.setColumn(i,"REMARK","요일 제한");
//      }       
//          
//      else if(gfn_length(ds_recent_list.getColumn(i,"RESTRICT_PERIOD"))> 0)
//      {
//          var strRemark = "금지자재(" + ds_recent_list.getColumn(i,"RESTRICT_PERIOD") + "," + ds_recent_list.getColumn(i,"RESTRICT_REASON") + ")";
//          ds_recent_list.setColumn(i,"REMARK",strRemark);
//      }                       
// //       else if( (toNumber(ds_recent_list.getColumn(i,"DUTY_QTY")) > 0) && (toNumber(ds_recent_list.getColumn(i,"DUTY_QTY")) <= toNumber(ds_recent_list.getColumn(i,"REAL_USE_QTY"))) )
// //       {
// //           ds_recent_list.setColumn(i,"REMARK","의무사용량 초과");
// //       }   
//      else if(ds_recent_list.getColumn(i,"D_DAY_YN") == "N")
//      {
//          var strRemark = "D-" + ds_recent_list.getColumn(i,"D_DAYS") + "일" + ds_recent_list.getColumn(i,"D_TIMES") + "시 제한";
//          ds_recent_list.setColumn(i,"REMARK",strRemark);
//      }   
//      //사용가능자제만 조회인 경우 불필요한 자료 삭제
// //       if (chk_only.value == "Y")
// //       {
// //           if (gfn_length(ds_recent_list.getColumn(i,"REMARK"))> 0)    ds_recent_list.deleteRow(i);
// //       }   
//  }

}

function fn_AddValidation()
{
    if(ds_recent_list.getColumn(ds_recent_list.rowposition,"CONTRACT_YN") == "N")
    {
        return false;
    }
    else if(ds_recent_list.getColumn(ds_recent_list.rowposition,"PR_YN") == "N")
    {
        return false;
    }       
    else if(ds_recent_list.getColumn(ds_recent_list.rowposition,"USE_YN") == "N")
    {
        return false;
    }               
    else if(gfn_length(ds_recent_list.getColumn(ds_recent_list.rowposition,"RESTRICT_PERIOD"))> 0)
    {
        return false;
    }                       
    else if( (toNumber(ds_recent_list.getColumn(ds_recent_list.rowposition,"DUTY_QTY")) > 0) && (toNumber(ds_recent_list.getColumn(ds_recent_list.rowposition,"DUTY_QTY")) <= toNumber(ds_recent_list.getColumn(ds_recent_list.rowposition,"REAL_USE_QTY"))) )
    {
        return false;
    }   
    else if(ds_recent_list.getColumn(ds_recent_list.rowposition,"D_DAY_YN") == "N")
    {
        return false;
    }   
    
    return true;
}

function grd_ItemList_OnMouseOver(obj:Grid, e:GridMouseEventInfo)
{
    if(gfn_length(ds_recent_list.getColumn(e.row,"PR_REMARK"))> 0)
    {
        grd_ItemList.tooltiptext = ds_recent_list.getColumn(e.row,"PR_REMARK");
    }
    else
    {
        grd_ItemList.tooltiptext = "";
    }
}

function grd_ItemList_OnKeyDown(obj:Grid, e:KeyEventInfo)
{
    if(ds_recent_list.rowcount <= 0) return false;

    if(e.keycode == 13) 
    {
		if(gfn_length(ds_recent_list.getColumn(ds_recent_list.rowposition,"PR_REMARK"))> 0)
		{
			 g_Message("EE","선택하신 자재는 사유로 인해 신청하실 수 없습니다..\n사유 : " + ds_recent_list.getColumn(ds_recent_list.rowposition,"PR_REMARK"));
			return false;
		}
		fn_show_divPopup();
    }
}

function edt_item_code_OnKeyDown(obj:Edit, e:KeyEventInfo)
{
    if(e.keycode == "13") {
        btn_item_search_OnClick(btn_item_search);
    }
}

// 구매불가자재 제외 체크박스 값 변경시 데이터셋 필터
function chk_only_onchanged(obj:CheckBox, e:CheckBoxChangeEventInfo)
{
    var sFilter = e.postvalue == 'Y' ? "gfn_length(PR_REMARK) == 0" : "";
    ds_recent_list.filter(sFilter);
}

function ImgItem_onclick(obj:ImageViewer,  e:ClickEventInfo)
{
	if(gfn_isNull(ds_recent_list.getColumn(ds_recent_list.rowposition, "IMG_PATH")) || ds_recent_list.rowcount <= 0)
	{
		return;
	}
	else
	{
		gfn_dialog("", "U_FSP::FSP00000P.xfdl",{fv_itemCode: ds_recent_list.getColumn(ds_recent_list.rowposition, "ITEM_CODE")}, "", "", "", "", "", "", "", "", true);
	}
}

// 분류코드 값 변경시 이벤트
function cbo_class_onChanged(obj:Combo, e:ItemChangeEventInfo)
{
    switch(obj.name)
    {
        case "cbo_item_class1" :
        
            if(e.postvalue == '')
            {
                ds_item_class2.filter("");
                cbo_item_class2.index=0;
                ds_item_class3.filter("");
                cbo_item_class3.index=0;
                ds_item_class4.filter("");
                cbo_item_class4.index=0;
            }
            else
            {
                // 중분류 필터
                ds_item_class2.filter("gfn_left(CLASS_CODE,1)=="+wrapQuote(gfn_left(e.postvalue,1))+" || CLASS_CODE==''");
                cbo_item_class2.index=0;
                // 중분류 필터
                ds_item_class3.filter("gfn_left(CLASS_CODE,1)=="+wrapQuote(gfn_left(e.postvalue,1))+" || CLASS_CODE==''");
                cbo_item_class3.index=0;
                // 소분류 필터
                ds_item_class4.filter("gfn_left(CLASS_CODE,1)=="+wrapQuote(gfn_left(e.postvalue,1))+" || CLASS_CODE==''");
                cbo_item_class4.index=0;
            }
            
            
            break;
        
        case "cbo_item_class2" :
            if(e.postvalue == ''){
                ds_item_class3.filter("");
                cbo_item_class3.index=0;
                ds_item_class4.filter("");
                cbo_item_class4.index=0;
            }
            else
            {
                // 중분류 필터
                ds_item_class3.filter("gfn_left(CLASS_CODE,3)=="+wrapQuote(gfn_left(e.postvalue,3))+" || CLASS_CODE==''");
                cbo_item_class3.index=0;
                // 소분류 필터
                ds_item_class4.filter("gfn_left(CLASS_CODE,3)=="+wrapQuote(gfn_left(e.postvalue,3))+" || CLASS_CODE==''");
                cbo_item_class4.index=0;
            }
            break;
        
        case "cbo_item_class3" :
            if(e.postvalue == ''){
                ds_item_class4.filter("");
            }
            else
            {
                // 소분류 필터
                ds_item_class4.filter("gfn_left(CLASS_CODE,5)=="+wrapQuote(gfn_left(e.postvalue,5))+" || CLASS_CODE==''");
            }
            cbo_item_class4.index=0;
            break;
    }
}

// 자재그리드 더블클릭시 신청량 div 팝업
function grd_ItemList_OnCellDblClick(obj:Grid, e:GridClickEventInfo)
{
    if(gfn_length(ds_recent_list.getColumn(ds_recent_list.rowposition,"PR_REMARK"))> 0)
    {
         g_Message("EE","선택하신 자재는 사유로 인해 신청하실 수 없습니다..\n사유 : " + ds_recent_list.getColumn(ds_recent_list.rowposition,"PR_REMARK"));
        return false;
    }
    
    fn_show_divPopup();
}

// 신청량 팝업 활성화
function fn_show_divPopup()
{
    div_popup.visible = true;
    //div_popup.setFocus();
    div_popup.msk_pr_qty.value = null;
    div_popup.msk_pr_qty.setFocus();
}

// 신청량팝업에서 포커스가 떠날때 이벤트
function div_popup_onkillfocus(obj:Div, e:KillFocusEventInfo)
{
    obj.visible = false;
    this.grd_ItemList.setFocus();
}

// 신청량팝업에서 닫기 버튼 클릭시 이벤트
function div_popup_btn_close_onclick(obj:Button,  e:ClickEventInfo)
{
    div_popup.visible = false;
    this.grd_ItemList.setFocus();
}

// 신청량 팝업에서 엔터키 이벤트
function div_popup_msk_pr_qty_onkeydown(obj:MaskEdit, e:KeyEventInfo)
{
    if(e.keycode == 13) {
        div_popup_btn_add_onclick();
    }
}

// 신청량 팝업에서 입력버튼 이벤트
function div_popup_btn_add_onclick(obj:Button,  e:ClickEventInfo)
{
    var strMsg;
    var nRow   = ds_recent_list.rowposition;
    var nPrQty = div_popup.msk_pr_qty.value;
    
    if(gfn_length(nPrQty)== 0)
    {
        g_Message("EE","신청수량을 입력하세요.");
        div_popup.msk_pr_qty.value = null;
        div_popup.msk_pr_qty.setFocus();
        return;         
    }
    
    if(nPrQty <= 0)
    {
        g_Message("EE","신청수량은 '0'보다 커야 합니다.");
        div_popup.msk_pr_qty.value = null;
        div_popup.msk_pr_qty.setFocus();
        return;         
    }
    
    var nIdx = FindRowNF(ds_pr_item, "ITEM_CODE", ds_recent_list.getColumn(nRow, "ITEM_CODE"));

    if(nIdx >= 0)
    {
        g_Message("EE","  선택된 자재는 신청내역에 이미 포함되어 있습니다.");
        div_popup.msk_pr_qty.value = null;
        div_popup.visible = false;
        return;
    }   

    //소숫점 발주 제한 점검
    if(ds_recent_list.getColumn(nRow,"POINT_FLAG") == "N" && Math.ceil(toNumber(nPrQty)) != toNumber(nPrQty))
    {
        strMsg = " ※ 소숫점 신청 불가!!\n";
        strMsg+= "     자재명 : " + ds_recent_list.getColumn(nRow,"ITEM_NAME");
        g_Message("EE", strMsg);
        div_popup.msk_pr_qty.value = null;
        div_popup.msk_pr_qty.setFocus();
        return;
    }
    //최소발주량 제한 점검
    else if(toNumber(ds_recent_list.getColumn(nRow,"MIN_ORD_QTY")) > 0 && toNumber(nPrQty) < toNumber(ds_recent_list.getColumn(nRow,"MIN_ORD_QTY")) )
    {
        strMsg = " ※ 최소발주량 이하 신청 불가!!\n";
        strMsg+= "     자재명       : " + ds_recent_list.getColumn(nRow, "ITEM_NAME")   + "\n";
        strMsg+= "     최소발주량 : " + ds_recent_list.getColumn(nRow, "MIN_ORD_QTY") + "\n";
        g_Message("EE", strMsg);
        div_popup.msk_pr_qty.value = null;
        div_popup.msk_pr_qty.setFocus();
        return;
    }
    //최대발주량 제한 점검
    else if(toNumber(ds_recent_list.getColumn(nRow,"MAX_ORD_QTY")) > 0 && toNumber(nPrQty) > toNumber(ds_recent_list.getColumn(nRow,"MAX_ORD_QTY")) )
    {
        strMsg = " ※ 최대발주량 이상 신청 불가!!\n";
        strMsg+= "     자재명       : " + ds_recent_list.getColumn(nRow, "ITEM_NAME")   + "\n";
        strMsg+= "     최대발주량 : " + ds_recent_list.getColumn(nRow, "MAX_ORD_QTY") + "\n";
        div_popup.msk_pr_qty.value = null;
        div_popup.msk_pr_qty.setFocus();
        g_Message("EE", strMsg);
        
        return;
    }
    //발주승수량 제한 점검
    else if(toNumber(String(ds_recent_list.getColumn(nRow,"MULTIPLIER_QTY"))) != 0 )
    {
		var nMqty = ds_recent_list.getColumn(nRow,"MULTIPLIER_QTY");
		var nRt = nPrQty - (Math.floor(nPrQty / nMqty) * nMqty)

    	if(nRt != 0)
    	{
			strMsg  = " ※ 발주승수량 이외 신청 불가!!\n";
			strMsg += "     자재명       : " + ds_recent_list.getColumn(nRow,"ITEM_NAME") + "\n";
			strMsg += "     발주승수량 : " + ds_recent_list.getColumn(nRow,"MULTIPLIER_QTY") + "\n";
			
			g_Message("EE", strMsg);
			div_popup.msk_pr_qty.value = null;
			div_popup.msk_pr_qty.setFocus();
			return;
		}
    }

    //마이너스 신청 여부 점검
    if(toNumber(nPrQty) < 0)
    {
        strMsg  = " ※ (-)수량 신청 신청 불가!!\n";
        strMsg += "     자재명 : " + ds_recent_list.getColumn(nRow,"ITEM_NAME");
    
        g_Message("EE", strMsg);
        div_popup.msk_pr_qty.value = null;
        div_popup.msk_pr_qty.setFocus();
        return;
    }
    //선발주 제한 여부 점검(조회시 미리 D-Day제한은 점검하고, "C"일 경우 D-Times만 점검한다.
    else if(ds_recent_list.getColumn(nRow,"D_DAY_YN") == "C")
    {
        var f_CurrDateTime = fn_CurrDateWeek("ymdtm");
        
        if( toNumber(gfn_subStr(f_CurrDateTime, 8, 2)) >= toNumber(ds_recent_list.getColumn(nRow, "D_TIMES")))
        {
            strMsg  = " ※ 선발주 시간 제한 \n\n";
            strMsg += "     자재명        : "       + ds_recent_list.getColumn(nRow, "ITEM_NAME") + "\n";
            strMsg += "     선발주 제한 : D_DAY=" + ds_recent_list.getColumn(nRow, "D_DAYS"   ) + "일 " + ds_recent_list.getColumn(nRow, "D_TIMES") + "시";
            
            g_Message("EE", strMsg);
            div_popup.msk_pr_qty.value = null;
            div_popup.msk_pr_qty.setFocus();
            return;
        }       
    }
    
    var nMagPrc = ds_recent_list.getColumn(nRow,"MARGIN_PRICE");
    
    ds_recent_list.setColumn(nRow, "PR_QTY", nPrQty);
    ds_recent_list.setColumn(nRow, "PR_AMT", toNumber(nMagPrc) * toNumber(nPrQty));
    
    var addRow = ds_pr_item.addRow();
    ds_pr_item.copyRow(addRow, ds_recent_list, nRow);

    this.div_popup.visible = false;
    this.grd_ItemList.setFocus();
}

//컴퍼넌트별 키이벤트(공통 이벤트 예외사황이라 각각 만들어줌)
function Combo_onkeydown(obj:Combo, e:KeyEventInfo)
{
    var sNextComp;
    if (e.keycode == 13)
    {
        sNextComp = getNextComponent(obj);
        sNextComp.setFocus();
    }
}

function Edit_onkeydown(obj:Edit, e:KeyEventInfo)
{
    var sNextComp;
    
    if (e.keycode == 13)
    {
        if(e.fromreferenceobject == edt_item_code)
        {
            fn_item_search();
        }
        else
        {
            sNextComp = getNextComponent(obj);
            sNextComp.setFocus();
        }
        
    }
}

function MaskEdit_onkeydown(obj:MaskEdit, e:KeyEventInfo)
{
    var sNextComp;
    if (e.keycode == 13)
    {
        sNextComp = getNextComponent(obj);
        sNextComp.setFocus();
    }
}


function ds_recent_list_OnRowPosChanged(obj:Dataset, e:DSRowPosChangeEventInfo)
{    
    if(obj.getCountNF() <= 0) return;

    if(gfn_length(obj.getColumn(e.newrow, "IMG_PATH"))==0)
    {
        ImgItem.image = "theme://Images/new/img_WF_ImageViewer.png";
    }else{
		ImgItem.image =  SCSysIf.makeEprocImageUrl(obj.getColumn(e.newrow, "IMG_PATH")); 
    }
    ImgItem.redraw();
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : btn_custSearch_onclick(obj:Button,  e:ClickEventInfo)
 * 기ㅡㅡㅡ능 : 협력업체 조회팝업
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-03-23
 ******************************************************************************************/
function btn_custSearch_onclick(obj:Button,  e:ClickEventInfo)
{
    var aPram = {"p_need_date":ds_item_condi.getColumn(0, "NEED_DATE")}
    var vRtn = gfn_dialog("", "U_FSP::FSP00035P.xfdl",aPram);
    
    if (vRtn != null)
    {
        var vResult = gfn_split(vRtn, ";");
        
        ds_item_condi.setColumn(0, "CUSTCD", vResult[0]);
        ds_item_condi.setColumn(0, "CUSTNM", vResult[1]);
    }
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : edt_custNm_onkeydown(obj:Edit, e:KeyEventInfo)
 * 기ㅡㅡㅡ능 : 조회조건 협력업체코드/명 삭제
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-03-23
 ******************************************************************************************/
function edt_custNm_onkeydown(obj:Edit, e:KeyEventInfo)
{
    if (e.keycode == 13) btn_custSearch.click();
    if (e.keycode == 46 || e.keycode == 8) {
        ds_item_condi.setColumn(0, "CUSTCD", "");
        ds_item_condi.setColumn(0, "CUSTNM", "");
    }   
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : grd_ItemList_onexpandup(obj:Grid, e:GridMouseEventInfo)
 * 기ㅡㅡㅡ능 : 자재조회그리드 expend 이벤트
 * 작ㅡ성ㅡ자 : 정영철
 * 작성ㅡ일자 : 2015-03-23
 ******************************************************************************************/
function grd_ItemList_onexpandup(obj:Grid, e:GridMouseEventInfo)
{
    switch(e.col)
    {
		// 구매링크 버튼 클릭시 구매 자재상세 링크
        case 2 : 
            SCSysIf.eprocPopup (SCSysIf.EPROC_ITEM_POPUP, ds_recent_list.getColumn(e.row, "ITEM_CODE"));
            break;
            
        case 3 : 
            var sItemCode = ds_recent_list.getColumn(e.row, "ITEM_CODE");
			gfn_dialog("", "U_FSP::FSP00000P.xfdl",{fv_itemCode: sItemCode}, "", "", "", "", "", "", "", "", true);
            break;
    }
}

function grd_ItemList_onheadclick(obj:Grid, e:GridClickEventInfo)
{
    gfn_gridSort(obj, e); //(eval(obj.binddataset), obj, e.cell);
}

/*----------------------------------------------------------------------------------------------
    1. Function    : fn_dateBetweenCheck
    2. Description : 기간 달력 시작일 종료일 체크
    3. Arguments   : objFr-시작일 컴퍼넌트, objTo-종료일 컴퍼넌트
    4. History     : 2008. 02. 04 - 최초작성
                     2015. 06. 03 - 고도화
 *---------------------------------------------------------------------------------------------*/
function fn_dateBetweenCheck(objFr, objTo)
{
    var sDtFr = objFr.value;    // 시작일
    var sDtTo = objTo.value;    // 종료일
    
    if(sDtFr > sDtTo){
        gfn_alert("msg.err.validator.date.great", "");
        objTo.value = objFr.value;
        objFr.setFocus();
        return false;
    }
    return true;
}

// 자재특성 콤보 값 변경시 그리드 필터 적용
function cbo_feature_onitemchanged(obj:Combo, e:ItemChangeEventInfo)
{
	switch(e.postindex)
	{
		case 0 :
			ds_recent_list.filter("");
			break;
		default :
			ds_recent_list.filter("FEATURE_NAME == '" + e.postvalue + "'");
			break;	
	}
}
]]></Script>
  </Form>
</FDL>
