<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="..\..\..\default_typedef.xml"/>
  <Form id="TaxInvoiceOccurObjPop1" classname="COMP_GUIDE_13" inheritanceid="" position="absolute 0 0 1000 587" titletext="세금계산서 발생대상 팝업(외식)" scrollbars="autoboth" onload="form_onload">
    <Layouts>
      <Layout>
        <Static id="Static06" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 985 0 1000 587" anchor="top right"/>
        <Static id="Static08" class="sta_WFSA_Labelbg" position="absolute 15 30 985 72" anchor="default"/>
        <Static id="Static04" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 16 30 969 40" anchor="left top"/>
        <Static id="Static07" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 16 40 31 63" anchor="left top"/>
        <Static id="Static41" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 969 30 984 65" anchor="left top"/>
        <Static id="Static01" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 16 61 985 71" anchor="left top"/>
        <Static id="Static02" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 0 15 587"/>
        <Grid id="grd_list" taborder="17" binddataset="ds_list" autoenter="select" useinputpanel="false" cellsizingtype="none" autofittype="none" position="absolute 15 140 985 572" oncellclick="grd_list_oncellclick" anchor="default" onheadclick="grd_list_onheadclick">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="25"/>
                <Column size="130"/>
                <Column size="70"/>
                <Column size="90"/>
                <Column size="90"/>
                <Column size="90"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="90"/>
                <Column size="80"/>
                <Column size="140"/>
                <Column size="150"/>
              </Columns>
              <Rows>
                <Row size="26" band="head"/>
                <Row size="24"/>
                <Row size="24" band="summ"/>
              </Rows>
              <Band id="head">
                <Cell displaytype="checkbox" edittype="checkbox" style="align:center middle;" text="0"/>
                <Cell col="1" text="고객사"/>
                <Cell col="2" text="발생일자"/>
                <Cell col="3" text="발생금액"/>
                <Cell col="4" text="대상금액"/>
                <Cell col="5" text="발행금액"/>
                <Cell col="6" text="공급가액"/>
                <Cell col="7" text="부가세"/>
                <Cell col="8" text="잔액"/>
                <Cell col="9" text="사업부"/>
                <Cell col="10" text="사업장(CC)"/>
                <Cell col="11" text="적요"/>
              </Band>
              <Band id="body">
                <Cell displaytype="checkbox" edittype="checkbox" style="align:center middle;" text="bind:chk"/>
                <Cell col="1" style="align:left;" text="bind:custNm"/>
                <Cell col="2" displaytype="date" text="bind:occurDate"/>
                <Cell col="3" displaytype="number" text="bind:occurAmt"/>
                <Cell col="4" displaytype="number" style="align:right middle;" text="bind:objAmt"/>
                <Cell col="5" displaytype="number" edittype="normal" editfilter="number" style="align:right;" class="Cellgrd_WF_Point" text="bind:applyAmt" displayexpdec="0" editlimit="13" editautoselect="true" editdisplay="display" editlimitbymask="integer"/>
                <Cell col="6" displaytype="number" edittype="normal" editfilter="number" style="line:1px solid #d0d3dcff ;background:#fffbccff;background2:#fffbccff;controlbackground:#fffbccff;" text="bind:supplyAmt" displayexpdec="0" editlimit="13" editautoselect="true" editdisplay="display" editlimitbymask="integer"/>
                <Cell col="7" displaytype="number" text="bind:vatAmt"/>
                <Cell col="8" displaytype="number" style="align:right middle;" text="bind:balAmt"/>
                <Cell col="9" style="align:left middle;" text="bind:muNm"/>
                <Cell col="10" style="align:left middle;" text="bind:ccNm"/>
                <Cell col="11" style="align:left;" text="bind:remark"/>
              </Band>
              <Band id="summary">
                <Cell/>
                <Cell col="1"/>
                <Cell col="2"/>
                <Cell col="3" displaytype="number" style="align:right;" text="expr:getSum('occurAmt')"/>
                <Cell col="4" displaytype="number" style="align:right;" text="expr:getSum('objAmt')"/>
                <Cell col="5" displaytype="number" style="align:right;" text="expr:getSum('applyAmt')"/>
                <Cell col="6" displaytype="number" style="align:right middle;" text="expr:getSum('supplyAmt')"/>
                <Cell col="7" displaytype="number" style="align:right;" text="expr:getSum('vatAmt')"/>
                <Cell col="8" displaytype="number" style="align:right;"/>
                <Cell col="9"/>
                <Cell col="10"/>
                <Cell col="11"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Button id="btn_search00" taborder="13" text="조회" onclick="fn_search" class="btn_WF_searchCm" position2="absolute l:832 w:59 t:0 h:25" positiontype="position2"/>
        <Button id="btn_confirm" taborder="14" text="확인" onclick="btn_confirm_onclick" class="btn_WF_CRUD" position2="absolute l:893 w:45 t:0 h:25" positiontype="position2"/>
        <Button id="btn_cancel" taborder="16" text="취소" class="btn_WF_CRUD" position2="absolute l:940 w:45 t:0 h:25" positiontype="position2" onclick="btn_cancel_onclick"/>
        <Static id="sta_title" text="세금계산서 발생대상" onclick="sta_title_onclick" class="sta_WF_Title" visible="true" position="absolute 14 6 464 25"/>
        <Static id="Static71" text="h05" class="Guide01_AreaRed" visible="false" position="absolute 15 25 985 30" style="background:slateblue;"/>
        <Static id="Static16" text="발생구분" class="sta_WFSA_label" position="absolute 257 40 319 61" anchor="left top" style="align:center middle;"/>
        <Static id="Static28" text="발생일자" class="sta_WFSA_label" position="absolute 676 40 738 61" anchor="left top"/>
        <Static id="Static24" text="~" position="absolute 850 42 859 61"/>
        <Static id="Static25" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 840 40 850 61" anchor="left top"/>
        <Static id="Static29" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 859 40 869 61" anchor="left top"/>
        <ObjCalendar id="cal_occurDateFromSch" titletext="캘린더" taborder="154" scrollbars="none" class="cal_WF_Essential" position="absolute 745 40 840 61"/>
        <ObjCalendar id="cal_occurDateToSch" titletext="캘린더" taborder="155" scrollbars="none" class="cal_WF_Essential" position="absolute 869 40 964 61"/>
        <Static id="Static00" text="h05" class="Guide01_AreaRed" visible="false" position="absolute 15 72 985 77" style="background:slateblue;"/>
        <Static id="Static14" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 15 572 985 587"/>
        <Combo id="cmb_occurClass" taborder="156" displaynulltext="선택" innerdataset="ds_occurClass" codecolumn="typeCd" datacolumn="typeNm" onitemchanged="cmb_occurClass_onitemchanged" class="cmb_WF_Essential" position="absolute 325 40 436 61" anchor="left top"/>
        <Grid id="Grid00" taborder="157" useinputpanel="false" position="absolute 9 589 961 745" binddataset="ds_copy" visible="false">
          <Formats>
            <Format id="default">
              <Columns>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
              </Columns>
              <Rows>
                <Row band="head" size="24"/>
                <Row band="body" size="24"/>
              </Rows>
              <Band id="head">
                <Cell col="0" disptype="normal" text="chk"/>
                <Cell col="1" disptype="normal" text="gubun"/>
                <Cell col="2" disptype="normal" text="upjangSalsNum"/>
                <Cell col="3" disptype="normal" text="arNum"/>
                <Cell col="4" disptype="normal" text="advanceNum"/>
                <Cell col="5" disptype="normal" text="occurDate"/>
                <Cell col="6" disptype="normal" text="muCd"/>
                <Cell col="7" disptype="normal" text="muNm"/>
                <Cell col="8" disptype="normal" text="tmCd"/>
                <Cell col="9" disptype="normal" text="tmNm"/>
                <Cell col="10" disptype="normal" text="ccCd"/>
                <Cell col="11" disptype="normal" text="ccNm"/>
                <Cell col="12" disptype="normal" text="upjangCd"/>
                <Cell col="13" disptype="normal" text="upjangNm"/>
                <Cell col="14" disptype="normal" text="objAmt"/>
                <Cell col="15" disptype="normal" text="applyAmt"/>
                <Cell col="16" disptype="normal" text="balAmt"/>
                <Cell col="17" disptype="normal" text="occurYn"/>
                <Cell col="18" disptype="normal" text="occurClass"/>
              </Band>
              <Band id="body">
                <Cell col="0" disptype="normal" text="bind:chk"/>
                <Cell col="1" disptype="normal" text="bind:gubun"/>
                <Cell col="2" disptype="normal" text="bind:upjangSalsNum"/>
                <Cell col="3" disptype="normal" text="bind:arNum"/>
                <Cell col="4" disptype="normal" text="bind:advanceNum"/>
                <Cell col="5" disptype="normal" text="bind:occurDate"/>
                <Cell col="6" disptype="normal" text="bind:muCd"/>
                <Cell col="7" disptype="normal" text="bind:muNm"/>
                <Cell col="8" disptype="normal" text="bind:tmCd"/>
                <Cell col="9" disptype="normal" text="bind:tmNm"/>
                <Cell col="10" disptype="normal" text="bind:ccCd"/>
                <Cell col="11" disptype="normal" text="bind:ccNm"/>
                <Cell col="12" disptype="normal" text="bind:upjangCd"/>
                <Cell col="13" disptype="normal" text="bind:upjangNm"/>
                <Cell col="14" disptype="normal" text="bind:objAmt"/>
                <Cell col="15" disptype="normal" text="bind:applyAmt"/>
                <Cell col="16" disptype="normal" text="bind:balAmt"/>
                <Cell col="17" disptype="normal" text="bind:occurYn"/>
                <Cell col="18" disptype="normal" text="bind:occurClass"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Static id="Static03" text="CC" class="sta_WFSA_label" position="absolute 31 40 93 61" anchor="left top"/>
        <UpjangSearchComponent id="UpjangSearchComponent01" titletext="업장 검색용 Component" taborder="158" text="UpjangSearchComponent00" enable="false" position="absolute 69 40 248 61" bindDataset="ds_search" bindUpjangCodeColumn="inqueryCcCd" bindUpjangNameColumn="inqueryCcNm" eventBeforeTrigger="" eventAfterTrigger="" roleSetId=""/>
        <MuSearchComponent id="MuSearchComponent01" titletext="사업부 선택 Component" taborder="159" text="MuSearchComponent00" visible="false" position="absolute 169 632 304 653" bindDataset="ds_search" bindMuCdColumn="inqueryMuCd" appendText="" onItemChangedEvent=""/>
        <TmSearchComponent id="TmSearchComponent01" titletext="팀 검색용 Component" taborder="160" text="TmSearchComponent00" visible="false" position="absolute 374 632 559 653" bindDataset="ds_search" bindTmCdColumn="inqueryTmCd" bindTmNmColumn="inqueryTmNm" qoBuCd="" qoMuCd="" qoUseYn="" eventAfterTrigger="" eventBeforeTrigger=""/>
        <Static id="Static05" text="기타개인명" class="sta_WFSA_label" position="absolute 445 40 524 61" anchor="left top" style="align:center middle;"/>
        <Edit id="edt_userName" taborder="161" position="absolute 527 40 659 61" anchor="left top"/>
        <Static id="Static10" class="sta_WFSA_Labelbg" position="absolute 15 101 985 132"/>
        <Static id="sta_title00" text="품목 합계금액" onclick="sta_title_onclick" class="sta_WF_Title" position="absolute 14 79 464 98" style="font:arial,9;"/>
        <MaskEdit id="msk_totAmt" taborder="162" readonly="true" mask="#,###,###,###" limitbymask="integer" class="msk_WF_Essential" position="absolute 101 106 231 127" anchor="left top"/>
        <MaskEdit id="msk_supplyAmt" taborder="163" mask="#,###,###,###" limitbymask="integer" ontextchanged="msk_supplyAmt_ontextchanged" class="msk_WF_Essential" position="absolute 448 106 578 127" anchor="left top"/>
        <MaskEdit id="msk_vatAmt" taborder="164" readonly="true" mask="#,###,###,###" limitbymask="integer" class="msk_WF_Essential" position="absolute 745 106 875 127" anchor="left top"/>
        <Static id="Static11" text="품목합계" class="sta_WFSA_label" position="absolute 31 106 93 127" anchor="left top"/>
        <Static id="Static12" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 16 102 31 132" anchor="left top"/>
        <Static id="Static13" text="품목공급가액" class="sta_WFSA_label" position="absolute 352 106 439 127" anchor="left top"/>
        <Static id="Static15" text="부가세" class="sta_WFSA_label" position="absolute 675 106 762 127" anchor="left top"/>
      </Layout>
    </Layouts>
    <Bind>
      <BindItem id="item18" compid="cal_occurDateFromSch" propid="text" datasetid="ds_search" columnid="inqueryStartDate"/>
      <BindItem id="item19" compid="cal_occurDateToSch" propid="text" datasetid="ds_search" columnid="inqueryEndDate"/>
      <BindItem id="item9" compid="cmb_occurClass" propid="value" datasetid="ds_search" columnid="inqueryOccurClass"/>
      <BindItem id="item20" compid="edt_userName" propid="value" datasetid="ds_search" columnid="inqueryUserNm"/>
    </Bind>
    <Objects>
      <Dataset id="ds_search" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="inqueryMuCd" type="STRING" size="256"/>
          <Column id="inqueryMuNm" type="STRING" size="256"/>
          <Column id="inqueryTmCd" type="STRING" size="256"/>
          <Column id="inqueryTmNm" type="STRING" size="256"/>
          <Column id="inqueryCcCd" type="STRING" size="256"/>
          <Column id="inqueryCcNm" type="STRING" size="256"/>
          <Column id="inqueryUpjangCd" type="STRING" size="256"/>
          <Column id="inqueryUpjangNm" type="STRING" size="256"/>
          <Column id="inqueryOccurClass" type="STRING" size="256"/>
          <Column id="inqueryStartDate" type="STRING" size="256"/>
          <Column id="inqueryEndDate" type="STRING" size="256"/>
          <Column id="inqueryCustCd" type="STRING" size="256"/>
          <Column id="inquerySalsClass" type="STRING" size="256"/>
          <Column id="inquerySubinvCd" type="STRING" size="256"/>
          <Column id="inquerySubinvNm" type="STRING" size="256"/>
          <Column id="sysClass" type="STRING" size="256"/>
          <Column id="inqueryVatCd" type="STRING" size="256"/>
          <Column id="inqueryUserNm" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_searchValid" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="inqueryMuCd" type="STRING" size="256"/>
          <Column id="inqueryCcCd" type="STRING" size="256"/>
          <Column id="inqueryOccurClass" type="STRING" size="256"/>
          <Column id="inqueryStartDate" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="inqueryMuCd">title:사업부,required:true</Col>
            <Col id="inqueryCcCd">title:CC,required:true</Col>
            <Col id="inqueryOccurClass">title:발생구분,required:true</Col>
            <Col id="inqueryStartDate">title:발생시작일자,required:true</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_list" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" oncolumnchanged="ds_list_oncolumnchanged" canrowposchange="ds_list_canrowposchanged" cancolumnchange="ds_list_cancolumnchanged">
        <ColumnInfo>
          <Column id="chk" type="STRING" size="256"/>
          <Column id="gubun" type="STRING" size="256"/>
          <Column id="upjangSalsNum" type="STRING" size="256"/>
          <Column id="arNum" type="STRING" size="256"/>
          <Column id="advanceNum" type="STRING" size="256"/>
          <Column id="occurDate" type="STRING" size="256"/>
          <Column id="muCd" type="STRING" size="256"/>
          <Column id="muNm" type="STRING" size="256"/>
          <Column id="tmCd" type="STRING" size="256"/>
          <Column id="tmNm" type="STRING" size="256"/>
          <Column id="ccCd" type="STRING" size="256"/>
          <Column id="ccNm" type="STRING" size="256"/>
          <Column id="upjangCd" type="STRING" size="256"/>
          <Column id="upjangNm" type="STRING" size="256"/>
          <Column id="custCd" type="STRING" size="256"/>
          <Column id="custNm" type="STRING" size="256"/>
          <Column id="posNum" type="STRING" size="256"/>
          <Column id="posNm" type="STRING" size="256"/>
          <Column id="salsClass" type="STRING" size="256"/>
          <Column id="occurAmt" type="BIGDECIMAL" size="256"/>
          <Column id="objAmt" type="BIGDECIMAL" size="256"/>
          <Column id="applyAmt" type="BIGDECIMAL" size="256"/>
          <Column id="supplyAmt" type="BIGDECIMAL" size="256"/>
          <Column id="vatAmt" type="BIGDECIMAL" size="256"/>
          <Column id="totAmt" type="BIGDECIMAL" size="256"/>
          <Column id="balAmt" type="BIGDECIMAL" size="256"/>
          <Column id="occurYn" type="STRING" size="256"/>
          <Column id="remark" type="STRING" size="256"/>
          <Column id="occurClass" type="STRING" size="256"/>
          <Column id="lineNum" type="STRING" size="256"/>
          <Column id="vatClass" type="STRING" size="256"/>
          <Column id="vatClassNm" type="STRING" size="256"/>
          <Column id="sysClass" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows/>
      </Dataset>
      <Dataset id="occurClass" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="code" type="STRING" size="256"/>
          <Column id="codeNm" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_copy" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" oncolumnchanged="ds_list_oncolumnchanged" onrowposchanged="ds_list_onrowposchanged" canrowposchange="ds_list_canrowposchanged" cancolumnchange="ds_list_cancolumnchanged">
        <ColumnInfo>
          <Column id="chk" type="STRING" size="256"/>
          <Column id="gubun" type="STRING" size="256"/>
          <Column id="upjangSalsNum" type="STRING" size="256"/>
          <Column id="arNum" type="STRING" size="256"/>
          <Column id="advanceNum" type="STRING" size="256"/>
          <Column id="occurDate" type="STRING" size="256"/>
          <Column id="muCd" type="STRING" size="256"/>
          <Column id="muNm" type="STRING" size="256"/>
          <Column id="tmCd" type="STRING" size="256"/>
          <Column id="tmNm" type="STRING" size="256"/>
          <Column id="ccCd" type="STRING" size="256"/>
          <Column id="ccNm" type="STRING" size="256"/>
          <Column id="upjangCd" type="STRING" size="256"/>
          <Column id="upjangNm" type="STRING" size="256"/>
          <Column id="custCd" type="STRING" size="256"/>
          <Column id="custNm" type="STRING" size="256"/>
          <Column id="posNum" type="STRING" size="256"/>
          <Column id="posNm" type="STRING" size="256"/>
          <Column id="salsClass" type="STRING" size="256"/>
          <Column id="occurAmt" type="BIGDECIMAL" size="256"/>
          <Column id="objAmt" type="BIGDECIMAL" size="256"/>
          <Column id="applyAmt" type="BIGDECIMAL" size="256"/>
          <Column id="supplyAmt" type="BIGDECIMAL" size="256"/>
          <Column id="vatAmt" type="BIGDECIMAL" size="256"/>
          <Column id="totAmt" type="BIGDECIMAL" size="256"/>
          <Column id="balAmt" type="BIGDECIMAL" size="256"/>
          <Column id="occurYn" type="STRING" size="256"/>
          <Column id="remark" type="STRING" size="256"/>
          <Column id="occurClass" type="STRING" size="256"/>
          <Column id="lineNum" type="STRING" size="256"/>
          <Column id="vatClass" type="STRING" size="256"/>
          <Column id="vatClassNm" type="STRING" size="256"/>
          <Column id="sysClass" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows/>
      </Dataset>
      <Dataset id="ds_salsClass" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="salsType" type="STRING" size="256"/>
          <Column id="salsTypeNm" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Script type="xscript4.0"><![CDATA[/*
  화 면 명 : TaxInvoiceOccurObjPop
  파 일 명 : TaxInvoiceOccurObjPop.xfdl
  기    능 : 세금계산서 발생대상 팝업

    수정일    수정자                  수정내용
  ----------   -------  --------------------------------------------------
  2015.06.08   JUN   최초 생성
*/

/************************************************************************************************
 * 공통 라이브러리 INCLUDE 영역 (필수)
************************************************************************************************/
include "lib::lib_com.xjs";
include "lib::SMCommon.xjs";	//영업회계 공통 스크립트

/************************************************************************************************
 * FORM 변수 선언 영역 (필수)
************************************************************************************************/
var fv_sToday = gfn_today();
var fv_objColInfo; 		//데이터셋 컬럼정보
var v_ds_check = "";
var bCanRowChanged = true;	// Row변경 여부
var fv_vatClass = "";		//SAP부가세코드(부모화면에서 전달받음)
var fv_vatRate = "";		//부가세율(부모화면에서 전달받음)
var fv_vatRateYn = "";		//부가세율여부(부모화면에서 전달받음)

/************************************************************************************************
 * FORM EVENT 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : Form Load (필수)
 *---------------------------------------------------------------------------------------------*/
function form_onload(obj:Form, e:LoadEventInfo){

	// Form Load 시 공통 기능 처리(obj:Form, bCreateEvent:이벤트 생성 여부)
	gfn_formOnLoad(this);
	
	// 초기값 셋팅
	fn_init();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 초기값 셋팅
 *---------------------------------------------------------------------------------------------*/
function fn_init(){

	// 업데이트여부를 체크할 DataSet, 여러개 있을 경우 ;로 구분
	v_ds_check = "ds_list";

	//콤보조회
	fn_setCombo();
	
	//조회조건 초기화
	var nRow = ds_search.addRow();
	
	if(selDataSet != null){
		ds_list.copyData(selDataSet);
	}
	
	fv_vatClass = pVatClass;
	fv_vatRate = pVatRate;
	fv_vatRateYn = pVatRateYn;
	
	//사업부, 부서(팀), CC 설정
	TmSearchComponent01.applyAuthLevel(MuSearchComponent01);
	UpjangSearchComponent01.setForcedRoleSet("CostCenter");
	UpjangSearchComponent01.applyAuthLevel(TmSearchComponent01);
	
	if(fv_vatRate == "0"){
		msk_supplyAmt.readonly=true;
	}
	//조회조건 초기화
	fn_clearSearch();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 조회조건 초기화
 *---------------------------------------------------------------------------------------------*/
function fn_clearSearch(){

	MuSearchComponent01.setMuCode(pMuCd);
	ds_search.setColumn(0, "inqueryMuCd",   pMuCd);
 	ds_search.setColumn(0, "inqueryTmCd",   pTmCd);
 	ds_search.setColumn(0, "inqueryTmNm",   pTmNm);
 	ds_search.setColumn(0, "inqueryCcCd",   pCcCd);
 	ds_search.setColumn(0, "inqueryCcNm",	pCcNm);
	ds_search.setColumn(0, "inqueryCustCd",	pCustCd);
	ds_search.setColumn(0, "inqueryVatCd",	pVatCd);
	
	cal_occurDateFromSch.fn_initMonthCal(this, gfn_getFirstDate(), null, ds_search, "inqueryStartDate", "Y");
	cal_occurDateToSch.fn_initMonthCal(this, gfn_getLastDate(), null, ds_search, "inqueryEndDate");	
 	
	//부모창의 데이터셋 카피
	ds_copy.clearData();
	ds_copy.copyData(dataSet);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 화면 닫기 전 변경 유무 체크 (필수-Frame에서 창 닫힐때 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_close(){	
	// v_ds_check 사용시 변경사항 체크
	if(gfn_length(v_ds_check) != 0){	
	
		// v_ds_check 설정기준 변경사항 체크
		if(gfn_isDataChange() == true){
			if(!gfn_confirm("confirm.before.movepage")) return false;	// 변경된 데이터가 있습니다. 현재 화면을 닫겠습니까?
		}
	}
	return true;
}

/************************************************************************************************
 * 공통기능 FUNCTION 영역 (필수-공통버튼)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 조회 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 * gfn_transaction(
 * 		@param objForm         - Form Object(this)
 * 		@param strSvcID        - 트랜잭션을 구분하기 위한 ID
 * 		@param strURL          - 트랜잭션을 요청할 주소
 * 		@param strInDatasets   - 트랜잭션을 요청할 때 입력값으로 보낼 데이터셋의 ID
 * 		@param strOutDatasets  - 트랜잭션을 처리 결과를 받을 데이터셋의 ID
 * 		@param strArgument     - 트랜잭션을 위한 인자값
 * 		@param strCallbackFunc - 트랜잭션의 결과를 돌려줄 함수의 이름
 * 		@param bAsync          - 비동기 여부(true: Async, false : Sync)
 * 		@param bProgress       - Wait Cursor 표시여부 (true : 사용, false : 사용안함)
 * )
 *---------------------------------------------------------------------------------------------*/
function fn_search(){

	//2월이상 매출 조회 불가조치
	/*
	if (ds_search.getColumn(0, "inqueryEndDate") > '20200200') {
		alert("2월 내역은 조회가 불가합니다.(신규법인 발행 필요)");
		return;
	}
	*/
	//1월이전 매출 조회 불가조치	
	if ((ds_search.getColumn(0, "inqueryEndDate") <= '20200131') || (ds_search.getColumn(0, "inqueryStartDate") <= '20200131')) {
		alert("1월 이전 내역은 조회가 불가합니다.(존속법인 발행 필요)");
		return;
	}

	// 조회시 Validation Check
	if(gfn_validCheck(ds_search, ds_searchValid, true) == false) return;


    // Grid sort 표시 초기화(필수)
    //gfn_clearSortMark(grd_list);

	//서비스 쿼리결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장
	//fv_objColInfo = gfn_getDatasetInfo (ds_list);

	if(gfn_isNull(cal_occurDateToSch.text)){
		cal_occurDateToSch.fn_setValue(fv_sToday);
	}
	
    gfn_transaction(this
					,"search"
					,"sm/stm/taxInvoiceOccurObjPop/selectList.xdo"
					,"ds_search=ds_search:A"
					,"ds_list=ds_list"
					,""
					,"fn_callBack"
					,true);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 신규 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_insert(){

}

/*----------------------------------------------------------------------------------------------
 * 설명      : 삭제 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_delete(){

}

/*----------------------------------------------------------------------------------------------
 * 설명      : 저장 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_save(){

}

/*----------------------------------------------------------------------------------------------
 * 설명      : 출력 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_print(){

}

/*----------------------------------------------------------------------------------------------
 * 설명      : 도움말 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_help(){

}

/************************************************************************************************
 * TRANSACTION 및 CallBack 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 트랜잭션 콜백 함수 (필수)
 *---------------------------------------------------------------------------------------------*/
function fn_callBack(strSvcID, nErrorCode, strErrorMsg){
	// 에러시 gfn_callBack에서 메시지 제공, 화면별 특정 에러 발생시에만 사용하세요.
	if (nErrorCode < 0){
		return;
	}
	
	if(strSvcID == "search"){	//조회
	
		//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
		if(ds_list.getRowCount() == 0){
			//gfn_loadDatasetInfo (ds_list, fv_objColInfo);
			
		}else{

			var newOccurDate	= "";	//발생일자
			var newOccurClass	= "";	//발생구분
			var newArNum		= "";	//채권번호
			var newAdvanceNum	= "";	//선수금번호
			var newUpjangSalsNum= "";	//매출번호

			var oldOccurDate	= "";	//발생일자
			var oldOccurClass	= "";	//발생구분
			var oldArNum		= "";	//채권번호
			var oldAdvanceNum	= "";	//선수금번호
			var oldUpjangSalsNum= "";	//매출번호

			var iObjAmt			= 0;	//대상금액
			var iApplyAmt		= 0;	//발행금액
			var iSupplyAmt		= 0;	//공급가액
			var iVatAmt			= 0;	//부가세
			var iNewObjAmt		= 0;	//계산 대상금액(대상금액 - 발행금액)
			var iBalAmt			= 0;	//계산 대상금액(잔액)
			var iLineNum		= 0;	//부모창에서 선택한 라인번호
			
			for(var i=0; i<ds_list.rowcount; i++){
				ds_list.setColumn(i, "balAmt", ds_list.getColumn(i, "objAmt"));
			
				newOccurDate	= ds_list.getColumn(i, "occurDate");
				newOccurClass	= ds_list.getColumn(i, "occurClass");
				newArNum		= ds_list.getColumn(i, "arNum");
				newAdvanceNum	= ds_list.getColumn(i, "advanceNum");
				newUpjangSalsNum= ds_list.getColumn(i, "upjangSalsNum");

				for(var j=0; j<ds_copy.rowcount; j++){
					oldOccurDate	= ds_copy.getColumn(j, "occurDate");
					oldOccurClass	= ds_copy.getColumn(j, "occurClass");
					oldArNum		= ds_copy.getColumn(j, "arNum");
					oldAdvanceNum	= ds_copy.getColumn(j, "advanceNum");
					oldUpjangSalsNum= ds_copy.getColumn(j, "upjangSalsNum");
					iChk			= ds_copy.getColumn(j, "chk");
					iObjAmt			= ds_copy.getColumn(j, "objAmt");
					iApplyAmt		= ds_copy.getColumn(j, "applyAmt");
					iSupplyAmt		= ds_copy.getColumn(j, "supplyAmt");
					iVatAmt			= ds_copy.getColumn(j, "vatAmt");
					iBalAmt			= ds_copy.getColumn(j, "balAmt");
					iLineNum		= ds_copy.getColumn(j, "lineNum");

					iNewObjAmt = iObjAmt - iApplyAmt;

					//if(newOccurDate == oldOccurDate && newOccurClass == oldOccurClass){
					if(newOccurDate == oldOccurDate){

						//채권
						if(newOccurClass == "1" || newOccurClass == "2"){
							if(newArNum == oldArNum){
								//선택한 팝업의 라인넘버와 선택되어 있는 대상(파라미터로 넘어온)의 라인넘버를 비교
								if(iLineNum == pLineNum){
									ds_list.setColumn(i, "chk",			iChk);
									ds_list.setColumn(i, "objAmt",		iObjAmt);
									ds_list.setColumn(i, "applyAmt",	iApplyAmt);
									ds_list.setColumn(i, "supplyAmt",	iSupplyAmt);
									ds_list.setColumn(i, "vatAmt",		iVatAmt);
									ds_list.setColumn(i, "balAmt" ,		iBalAmt);
								}else{
									ds_list.setColumn(i, "chk",			0);
									ds_list.setColumn(i, "objAmt",		iNewObjAmt);
									ds_list.setColumn(i, "applyAmt",	0);
									ds_list.setColumn(i, "supplyAmt",	0);
									ds_list.setColumn(i, "vatAmt",		0);
									ds_list.setColumn(i, "balAmt" ,		iNewObjAmt);
								}
							}
							
						//선수금
						}else if(newOccurClass == "3" || newOccurClass == "4"){
							if(newAdvanceNum == oldAdvanceNum){
								//선택한 팝업의 라인넘버와 선택되어 있는 대상(파라미터로 넘어온)의 라인넘버를 비교
								if(iLineNum == pLineNum){
									ds_list.setColumn(i, "chk",			iChk);
									ds_list.setColumn(i, "objAmt",		iObjAmt);
									ds_list.setColumn(i, "applyAmt",	iApplyAmt);
									ds_list.setColumn(i, "supplyAmt",	iSupplyAmt);
									ds_list.setColumn(i, "vatAmt",		iVatAmt);
									ds_list.setColumn(i, "balAmt" ,		iBalAmt);
								}else{
									ds_list.setColumn(i, "chk",			0);
									ds_list.setColumn(i, "objAmt",		iNewObjAmt);
									ds_list.setColumn(i, "applyAmt",	0);
									ds_list.setColumn(i, "supplyAmt",	0);
									ds_list.setColumn(i, "vatAmt",		0);
									ds_list.setColumn(i, "balAmt" ,		iNewObjAmt);
								}
							}
							
						//매출
						}else if(newOccurClass == "5" || newOccurClass == "6"){
							if(newUpjangSalsNum == oldUpjangSalsNum){
								//선택한 팝업의 라인넘버와 선택되어 있는 대상(파라미터로 넘어온)의 라인넘버를 비교
								if(iLineNum == pLineNum){
									ds_list.setColumn(i, "chk",			iChk);
									ds_list.setColumn(i, "objAmt",		iObjAmt);
									ds_list.setColumn(i, "applyAmt",	iApplyAmt);
									ds_list.setColumn(i, "supplyAmt",	iSupplyAmt);
									ds_list.setColumn(i, "vatAmt",		iVatAmt);
									ds_list.setColumn(i, "balAmt" ,		iBalAmt);
								}else{
									ds_list.setColumn(i, "chk",			0);
									ds_list.setColumn(i, "objAmt",		iNewObjAmt);
									ds_list.setColumn(i, "applyAmt",	0);
									ds_list.setColumn(i, "supplyAmt",	0);
									ds_list.setColumn(i, "vatAmt",		0);
									ds_list.setColumn(i, "balAmt" ,		iNewObjAmt);
								}
							}
						}
					}
				}
				ds_list.setColumn(i, "lineNum", pLineNum);	//세금계산서에서 팝업호출한 라인넘버
			}
			//ds_copy.clearData();
		}
    }
    
    if(strSvcID == "searchSalsClass"){
		ds_salsClass.insertRow(0);
		ds_salsClass.setColumn(0, "salsType", "");
		ds_salsClass.setColumn(0, "salsTypeNm", "전체");
		ds_search.setColumn(0, "inquerySalsClass", "");
    }
}

/************************************************************************************************
 * 사용자 FUNCTION 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 콤보/팝업조회
 *---------------------------------------------------------------------------------------------*/
function fn_setCombo(){

	// 입력:발생구분	SCCombo.CHOOSE					
	SCCombo.bind(	this
					,"ComCode"
					,"cmb_occurClass"
					,occurClass
					,{groupCode:"OCCUR_CLASS", useYn:"Y"}
					//,SCCombo.CHOOSE
					,"fn_commCodeAfter");	
}

function fn_commCodeAfter(){
	occurClass.filter("code!='5' && code!='3' && code!='2'");
	cmb_occurClass.index=0;
}

/*----------------------------------------------------------------------------------------------
 * 발행금액 합계 계산
 *---------------------------------------------------------------------------------------------*/
function fn_setApplyAmtSum(){
/*
	var iApplyAmtSum = 0;
	for(var i=0; i<ds_list.rowcount; i++){
		iApplyAmtSum += ds_list.getColumn(i, "applyAmt");
	}
*/	
	var iApplyAmtSum = ds_list.getSum("applyAmt");
	if(fv_vatRate == "0"){
		msk_supplyAmt.value = iApplyAmtSum;
		msk_vatAmt.value = 0;
		msk_totAmt.value = iApplyAmtSum;		
	}else{
		msk_supplyAmt.value = Math.round(Number(iApplyAmtSum) / 1.1);
		msk_vatAmt.value = Number(iApplyAmtSum) - Math.round(Number(iApplyAmtSum) / 1.1);
		msk_totAmt.value = iApplyAmtSum;		
	}
}

/************************************************************************************************
 * 각 COMPONENT 별 EVENT 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 데이터셋 리턴
 *---------------------------------------------------------------------------------------------*/
function btn_confirm_onclick(obj:Button,  e:ClickEventInfo){
	var dsObj = new Dataset();
	var iCnt = 0;
	
	dsObj.clearData();

	for(var i=0; i<ds_list.rowcount; i++){
	//	if(ds_list.getColumn(i, "chk") == "1" && ds_list.getColumn(i, "applyAmt") > 0){
		if(ds_list.getColumn(i, "chk") == "1"){
			iCnt++;
		}
	}

// 	if(iCnt == 0){
// 		gfn_alert("msg.search.nodata");	// 조건에 해당하는 자료가 없습니다.
// 		return false;
// 	}
	
	// Filter된 Data만 리턴	
	ds_list.filter("chk==1");

	dsObj.assign(ds_list);
	dsObj.copyData(ds_list,true);
	
	var ChkAmt = 0;	
	if(opener.rdo_publishClass.value == "1"){		//정발행
		if(pLineNum == "1"){
			opener.fn_settingLineDataPop(opener.ds_taxShetDtl1, pLineNum, msk_totAmt.value, msk_supplyAmt.value, msk_vatAmt.value);
		}else if(pLineNum == "2"){
			opener.fn_settingLineDataPop(opener.ds_taxShetDtl2, pLineNum, msk_totAmt.value, msk_supplyAmt.value, msk_vatAmt.value);
		}else if(pLineNum == "3"){
			opener.fn_settingLineDataPop(opener.ds_taxShetDtl3, pLineNum, msk_totAmt.value, msk_supplyAmt.value, msk_vatAmt.value);
		}else if(pLineNum == "4"){
			opener.fn_settingLineDataPop(opener.ds_taxShetDtl4, pLineNum, msk_totAmt.value, msk_supplyAmt.value, msk_vatAmt.value);
		}
	}else{	//역발행
		if(pLineNum == "1"){
			ChkAmt = opener.ds_taxShetDtl1.getColumn(0, "itemSupplyAmt");
		}else if(pLineNum == "2"){
			ChkAmt = opener.ds_taxShetDtl2.getColumn(0, "itemSupplyAmt");
		}else if(pLineNum == "3"){
			ChkAmt = opener.ds_taxShetDtl3.getColumn(0, "itemSupplyAmt");
		}else if(pLineNum == "4"){
			ChkAmt = opener.ds_taxShetDtl4.getColumn(0, "itemSupplyAmt");
		}
		if(Number(ChkAmt) <> Number(msk_supplyAmt.value)){
			alert("역발행된 금액과 선택된 공급가액이 맞지 않습니다.");
			return;
		}
	}	

	this.close(dsObj);
	return;
}

function btn_cancel_onclick(obj:Button,  e:ClickEventInfo)
{
	this.close();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 발생구분에 따른 그리드 컬럼명 변경
 *---------------------------------------------------------------------------------------------*/
function cmb_occurClass_onitemchanged(obj:Combo, e:ItemChangeEventInfo){

// 	//채권
// 	if(obj.value == "1" || obj.value == "2"){
// 		grd_list.setFormatColProperty( 2, "size", "120px");
// 		grd_list.setFormatColProperty( 3, "size", "0px");
// 		grd_list.setFormatColProperty( 4, "size", "0px");
// 		
// 	//선수금
// 	}else if(obj.value == "3" || obj.value == "4"){
// 		grd_list.setFormatColProperty( 2, "size", "0px");
// 		grd_list.setFormatColProperty( 3, "size", "120px");
// 		grd_list.setFormatColProperty( 4, "size", "0px");
// 		
// 	//매출
// 	}else if(obj.value == "5" || obj.value == "6"){
// 		grd_list.setFormatColProperty( 2, "size", "0px");
// 		grd_list.setFormatColProperty( 3, "size", "0px");
// 		grd_list.setFormatColProperty( 4, "size", "120px");
// 	}
}

/*----------------------------------------------------------------------------------------------
 * 대상금액 클릭시 발행금액 변경 EVENT balAmt
 *---------------------------------------------------------------------------------------------*/
function grd_list_oncellclick(obj:Grid, e:GridClickEventInfo){
	var iObjAmt		= 0;	//대상금액
	var iApplyAmt	= 0;	//발행가액
	var iSupplyAmt	= 0;	//공급가액
	var iVatAmt 	= 0;	//부가세
	
	if(e.cell == 4){	//대상금액 Setting
		iObjAmt		= ds_list.getColumn(ds_list.rowposition, "objAmt");
		iApplyAmt	= ds_list.getColumn(ds_list.rowposition, "applyAmt");
		
		if(iApplyAmt == iObjAmt){
			ds_list.setColumn(ds_list.rowposition, "applyAmt", 0);
			ds_list.setColumn(ds_list.rowposition, "supplyAmt", 0);
			ds_list.setColumn(ds_list.rowposition, "vatAmt", 0);
		}else{
			//부가세율이 있을경우(대상금액이 공급가액과 부가세가 포함된 금액)
			if(fv_vatRateYn == "Y"){
				iApplyAmt = iObjAmt;
				iSupplyAmt = Math.round(Number(iApplyAmt) / 1.1);
				iVatAmt = Number(iApplyAmt) - Math.round(Number(iApplyAmt) / 1.1);
			//면세일경우(부가세율이 0)
			}else{
				iApplyAmt = iObjAmt;
				iSupplyAmt = iObjAmt;
				iVatAmt = 0;
			}
			ds_list.setColumn(ds_list.rowposition, "applyAmt", iApplyAmt);
			ds_list.setColumn(ds_list.rowposition, "supplyAmt", iSupplyAmt);
			ds_list.setColumn(ds_list.rowposition, "vatAmt", iVatAmt);
		}
	}
}

/*----------------------------------------------------------------------------------------------
 * 포커스를 가진 레코드만 입력형태로 변환 EVENT
 *---------------------------------------------------------------------------------------------*/
function ds_list_onrowposchanged(obj:Dataset, e:DSRowPosChangeEventInfo){
	//iCurrow=e.newrow;
	if(ds_list.rowcount > 0) fn_setApplyAmtSum();	//발행금액 합계
}

/*----------------------------------------------------------------------------------------------
 * 발행금액 입력 후 EVENT (발행금액 체크/적용후잔액 계산)
 *---------------------------------------------------------------------------------------------*/
function ds_list_oncolumnchanged(obj:Dataset, e:DSColChangeEventInfo){
	var iObjAmt			= 0;	//대상금액
	var iApplyAmt		= 0;	//발행금액
	var iSupplyAmt		= 0;	//공급가액
	var iVatAmt			= 0;	//부가세(발행금액에 대한)
	//var iTotAmt			= 0;	//발행금액+부가세
	var iBalAmt			= 0;	//적용후잔액
	var iObjAmtOrg		= 0;	//대상금액합계		
	var iApplyAmtOrg	= 0;	//발행금액합계
	//var iApplyAmtSum	= 0;	//입력 발행금액합계
	//var sAdvanceNum		= "";	//선수금번호
	if(e.columnid == "applyAmt"){
	
		var nRow = ds_list.rowposition;
		
		iObjAmt			= ds_list.getColumn(nRow, "objAmt");
		iApplyAmt		= ds_list.getColumn(nRow, "applyAmt");
		iObjAmtOrg		= ds_list.getOrgColumn(nRow, "objAmt");
		iApplyAmtOrg	= ds_list.getOrgColumn(nRow, "applyAmt");
		//iObjAmtOrg	= ds_list.getColumn(nRow, "objAmtOrg");
		//iApplyAmtOrg	= ds_list.getColumn(nRow, "applyAmtOrg");
		sAdvanceNum		= ds_list.getColumn(nRow, "advanceNum");
		
		//입력 발행금액합계
		//for(var i=0; i<ds_list.rowcount; i++){
		//	if(ds_list.getColumn(i, "advanceNum") == sAdvanceNum){
		//		iApplyAmtSum += ds_list.getColumn(i, "applyAmt");
		//	}
		//}
		
		//대상금액 < 발행금액
		if(iApplyAmt != 0 && iObjAmt < iApplyAmt){
			//if(iObjAmt < iApplyAmt){
				gfn_alert("발행금액이 대상금액을 초과할 수 없습니다.");
				ds_list.setColumn(nRow, "applyAmt", ds_list.getOrgColumn(nRow, "applyAmt"));
				bCanRowChanged = false;
			
			//대상금액합계 < 발행금액합계 + 입력 발행금액합계	
			//}else if(iObjAmtOrg < (iApplyAmtOrg + iApplyAmtSum)){
			//	gfn_alert("발행금액이 대상금액을 초과할 수 없습니다.\n선수금번호 ["+sAdvanceNum+"]의 총대상금액은 "+ gfn_numFormat(iObjAmtOrg - iApplyAmtOrg) +" 원 입니다.");
			//	ds_list.setColumn(nRow, "applyAmt", 0);
			//	bCanRowChanged = false;
				
// 			}else{
// 				ds_list.setColumn(nRow, "balAmt" , iObjAmt-iApplyAmt);	//잔액표시
// 			}
		}else{
			if(fv_vatRateYn == "Y"){
				iSupplyAmt = Math.round(Number(iApplyAmt) / 1.1);	//공급가액
				iVatAmt = Number(iApplyAmt) - Number(iSupplyAmt);	//발행금액 - 공급가액
			}else{
				iSupplyAmt = iApplyAmt;
				iVatAmt = 0;
			}
			ds_list.setColumn(ds_list.rowposition, "supplyAmt", iSupplyAmt);
			ds_list.setColumn(ds_list.rowposition, "vatAmt", iVatAmt);
			ds_list.setColumn(nRow, "balAmt" , iObjAmt-iApplyAmt);				//잔액표시
		}
		
		//발행금액 입력시 체크박스 체크드
		if(ds_list.getColumn(nRow, "applyAmt") == 0){
			ds_list.setColumn(nRow, "chk","0");
		}else{
			ds_list.setColumn(nRow, "chk","1");
		}		
		
	}else if(e.columnid == "supplyAmt"){
		var nRow = ds_list.rowposition;
		
		iObjAmt			= ds_list.getColumn(nRow, "objAmt");
		iApplyAmt		= ds_list.getColumn(nRow, "applyAmt");
		iObjAmtOrg		= ds_list.getOrgColumn(nRow, "objAmt");
		iApplyAmtOrg	= ds_list.getOrgColumn(nRow, "applyAmt");
		sAdvanceNum		= ds_list.getColumn(nRow, "advanceNum");
		iSupplyAmt		= ds_list.getColumn(nRow, "supplyAmt");

		//대상금액 < 발행금액
	//	if(iApplyAmt != 0 && iSupplyAmt > iApplyAmt){
	//		//if(iObjAmt < iApplyAmt){
	//			gfn_alert("발행금액이 대상금액을 초과할 수 없습니다.");
	//			ds_list.setColumn(nRow, "supplyAmt", Math.round(Number(iApplyAmt) / 1.1));
	//			bCanRowChanged = false;
	//	}else{
			if(fv_vatRateYn == "Y"){
				iVatAmt = Number(iApplyAmt) - Number(iSupplyAmt);	//발행금액 - 공급가액
			}else{
				iSupplyAmt = iApplyAmt;
				iVatAmt = 0;
			}
			ds_list.setColumn(ds_list.rowposition, "supplyAmt", iSupplyAmt);
			ds_list.setColumn(ds_list.rowposition, "vatAmt", iVatAmt);
			ds_list.setColumn(nRow, "balAmt" , iObjAmt-iApplyAmt);				//잔액표시
	//	}
	}
	
	if(e.columnid == "chk"){
		iObjAmt = ds_list.getColumn(e.row, "objAmt");	//대상금액
		if(iObjAmt <> 0){
			if(obj.getColumn(e.row, e.columnid) == 1){
				fn_setDsListAmtValue(obj, e.row, 1)
			}else{
				fn_setDsListAmtValue(obj, e.row, 0)
			}
		}else{
			ds_list.setColumn(e.row, "chk", 0);
		}
	}
	fn_setApplyAmtSum();
}

/*----------------------------------------------------------------------------------------------
 * Row 변경불가 EVENT - (대상금액 < 발행금액 OR 대상금액합계 < 발행금액합계 + 입력 발행금액합계)인경우 Row 변경불가
 *---------------------------------------------------------------------------------------------*/
function ds_list_canrowposchanged(obj:Dataset, e:DSRowPosChangeEventInfo){
	if(bCanRowChanged == false){
		bCanRowChanged = true;
		return false;
	}
	return true;
}

/*----------------------------------------------------------------------------------------------
 * 매출유형 검색
 *---------------------------------------------------------------------------------------------*/
function fn_selectSalsClass(){
	ds_search.setColumn(0, "sysClass", "11");
	
	gfn_transaction(this
					,"searchSalsClass"
					,"sm/ssi/saleRevenueTypeMgnt/selectList.xdo"
					,"ds_search=ds_search:A"
					,"ds_salsClass=ds_list"
					,""
					,"fn_callBack"
					,true);
}

/*----------------------------------------------------------------------------------------------
 * 창고검색 버튼 클릭 이벤트 - 창고 검색 팝업 호출
 *---------------------------------------------------------------------------------------------*/
function btn_subinvPop_onclick(obj:Button,  e:ClickEventInfo)
{
	var ccCd = ds_search.getColumn(0, "inqueryCcCd");
	if(ccCd == null || ccCd == "" || ccCd == undefined){
		alert("업장(CC)를 선택 후 검색할 수 있습니다.");
		return;
	}

	var arr = new Array();
	arr[0] = "";
	arr[1] = ccCd;

	var strId       = "SubinventoryPopup";
	var strURL      = "X_FSL::SubinventoryPopup.xfdl";
	var objArgument = {arrSchVal:arr};
	var nWidth      = -1;
	var nHeight     = -1;
	var strStyle    = "";	
	var nLeft       = -1;
	var nTop        = -1;
	var isModeless  = false;
	var bShowTitle  = true;
	var strAlign    = "-1";
	var bResizable  = true;
	
	// 리턴값을 배열로 받을 경우	
	var arrRtn = gfn_dialog(strId, strURL, objArgument, nWidth, nHeight, strStyle, nLeft, nTop, isModeless, bShowTitle, strAlign, bResizable);
	
	if ( arrRtn instanceof Object )
	{
		ds_search.setColumn(0, "inquerySubinvCd", arrRtn.subinvCode);
		ds_search.setColumn(0, "inquerySubinvNm", arrRtn.subinvName);
	}
}

/*----------------------------------------------------------------------------------------------
 * 그리드 헤더클릭 이벤트
 *---------------------------------------------------------------------------------------------*/
function grd_list_onheadclick(obj:Grid, e:GridClickEventInfo)
{
	//체크박스 클릭
	if(e.cell == 0){
		if(obj.getCellProperty("Head", e.cell, "text") == 0){
			obj.setCellProperty("Head", e.cell, "text", 1);
			if(ds_list.rowcount > 0){
				for(var i=0; i<ds_list.rowcount; i++){
					if(ds_list.getColumn(i, "objAmt") <> 0){
						fn_setDsListAmtValue(ds_list, i, 1);
					}
				}
			}
		}else{
			obj.setCellProperty("Head", e.cell, "text", 0);
			if(ds_list.rowcount > 0){
				for(var i=0; i<ds_list.rowcount; i++){
					if(ds_list.getColumn(i, "objAmt") <> 0){
						fn_setDsListAmtValue(ds_list, i, 0)
					}
				}
			}
		}
	}
}

/*----------------------------------------------------------------------------------------------
 * 금액 계산 함수 (체크에 따른 금액계산)
 *---------------------------------------------------------------------------------------------*/
function fn_setDsListAmtValue(dsObj:Dataset, pRow, chk){
	if(chk == 0){
		dsObj.setColumn(pRow, "chk", chk);
		dsObj.setColumn(pRow, "applyAmt", 0);
		dsObj.setColumn(pRow, "supplyAmt", 0);
		dsObj.setColumn(pRow, "vatAmt", 0);
		dsObj.setColumn(pRow, "balAmt", dsObj.getColumn(pRow, "objAmt"));
	}else{
		var applyAmt = 0;
		var supplyAmt = 0;
		var vatAmt = 0;
		if(fv_vatRateYn == "Y"){
			applyAmt = dsObj.getColumn(pRow, "objAmt");
			supplyAmt = Math.round(Number(applyAmt) / 1.1);		//공급가액
			vatAmt = Number(applyAmt) - Number(supplyAmt);		//부가세
		}else{
			applyAmt = dsObj.getColumn(pRow, "objAmt");
			supplyAmt = applyAmt;
			vatAmt = 0;
		}
		dsObj.setColumn(pRow, "chk", chk);
		dsObj.setColumn(pRow, "applyAmt", applyAmt);
		dsObj.setColumn(pRow, "supplyAmt", supplyAmt);
		dsObj.setColumn(pRow, "vatAmt", vatAmt);
		dsObj.setColumn(pRow, "balAmt", 0);
	}
}


function msk_supplyAmt_ontextchanged(obj:MaskEdit,  e:TextChangedEventInfo)
{
	if(Number(msk_totAmt.value) < Number(msk_supplyAmt.value) && msk_totAmt.value > 0){
		alert("품목 공급가액이 품목 합계보다 큽니다.");
		msk_supplyAmt.value = ds_list.getSum("supplyAmt");
		msk_vatAmt.value = ds_list.getSum("vatAmt");
		
		return;
	}
	if(Number(msk_totAmt.value) > Number(msk_supplyAmt.value) && msk_totAmt.value < 0){
		alert("품목 공급가액이 품목 합계보다 작습니다.");
		msk_supplyAmt.value = ds_list.getSum("supplyAmt");
		msk_vatAmt.value = ds_list.getSum("vatAmt");
		
		return;
	}
	msk_vatAmt.value = Number(msk_totAmt.value) - Number(msk_supplyAmt.value);
}
]]></Script>
  </Form>
</FDL>
