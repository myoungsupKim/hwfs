<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="../../../default_typedef.xml"/>
  <Form id="MAS10030E" onload="form_onload" titletext="고객관리" position="absolute 0 0 1252 725" scrollbars="none">
    <Layouts>
      <Layout>
        <Static id="sta_detail13" class="sta_WFDA_Labelbg" position="absolute 403 242 1237 269"/>
        <Static id="sta_detail12" class="sta_WFDA_Labelbg" position="absolute 403 216 1237 243"/>
        <Static id="sta_detail11" class="sta_WFDA_Labelbg" position="absolute 111 242 325 269"/>
        <Static id="sta_detail10" class="sta_WFDA_Labelbg" position="absolute 111 216 325 243"/>
        <Static id="sta_detail09" class="sta_WFDA_Labelbg" position="absolute 655 190 1237 217"/>
        <Static id="sta_detail08" class="sta_WFDA_Labelbg" position="absolute 403 190 545 217"/>
        <Static id="sta_detail07" class="sta_WFDA_Labelbg" position="absolute 111 190 325 217"/>
        <Static id="sta_detail06" class="sta_WFDA_Labelbg" position="absolute 111 164 1237 191"/>
        <Static id="sta_detail05" class="sta_WFDA_Labelbg" position="absolute 403 138 1237 165"/>
        <Static id="sta_detail04" class="sta_WFDA_Labelbg" position="absolute 111 138 325 165"/>
        <Static id="sta_detail03" class="sta_WFDA_Labelbg" position="absolute 655 112 1237 139"/>
        <Static id="sta_detail02" class="sta_WFDA_Labelbg" position="absolute 403 112 545 139"/>
        <Static id="sta_detail01" class="sta_WFDA_Labelbg" position="absolute 111 112 325 139"/>
        <Static id="sta_detail00" class="sta_WFDA_Labelbg" position="absolute 655 86 1237 113"/>
        <Static id="sta_detail25" class="sta_WFDA_Labelbg" position="absolute 111 86 545 113"/>
        <Edit enable="false" id="ed_Empno" taborder="17" position="absolute 114 89 238 110" class="edt_WF_Essential"/>
        <Edit id="ed_Id" onkeydown="common_OnKeyDown" taborder="2" position="absolute 239 89 458 110" class="edt_WF_Essential"/>
        <Static id="Static01" class="sta_WFSA_Labelbg" position="absolute 0 30 1237 71" anchor="left top right"/>
        <Tab id="tab_User" onchanged="tab_User_OnChanged" canchange="tab_User_OnChanging" preload="true" taborder="19" position="absolute 0 284 1237 710" showextrabutton="false">
          <Tabpages>
            <Tabpage id="tab0" taborder="1" text="상세" url="U_MAS::MAS10031E.xfdl" position="absolute 2 24 974 391" scrollbars="none"/>
            <Tabpage id="tab1" taborder="5" text="하위고객" url="U_MAS::MAS10032E.xfdl" position="absolute 2 24 974 391" scrollbars="none"/>
            <Tabpage id="tab2" taborder="25" text="계약이력" url="U_MAS::MAS10033E.xfdl" position="absolute 2 24 974 391" scrollbars="none"/>
            <Tabpage id="tab3" taborder="25" text="특이사항" url="U_MAS::MAS10034E.xfdl" position="absolute 2 24 974 391" scrollbars="none"/>
          </Tabpages>
        </Tab>
        <Static id="st_Custnm" text="고객조회" position="absolute 15 40 87 61" class="sta_WFSA_label"/>
        <Edit id="ed_Custnm" ontextchanged="ed_Custnm_OnChanged" onkeydown="ed_Custnm_OnKeyDown" readonly="true" taborder="1" position="absolute 82 40 280 61" class="edt_WF_Essential"/>
        <Button id="btn_CustPop" onclick="btn_CustPop_OnClick" taborder="16" text="" position="absolute 279 40 300 61" class="btn_WF_popSearchEssential" image=""/>
        <Edit id="ed_Custcd" taborder="20" visible="false" position="absolute 310 40 405 61"/>
        <Edit id="ed_CustID" taborder="21" visible="false" position="absolute 406 40 501 61"/>
        <Static id="st_Empno1" text="고객" position="absolute 0 86 112 113" class="sta_WFDA_Label01"/>
        <Static id="st_Upjang1" text="업태" position="absolute 0 112 112 139" class="sta_WFDA_Label01"/>
        <Static id="Static5" text="우편번호" position="absolute 0 138 112 165" class="sta_WFDA_Label01"/>
        <Static id="Static6" text="대표자명" position="absolute 0 164 112 191" class="sta_WFDA_Label01"/>
        <Static id="Static7" text="담당자명" position="absolute 0 190 112 217" class="sta_WFDA_Label01"/>
        <Static id="Static8" text="담당자이메일" position="absolute 0 216 112 243" class="sta_WFDA_Label01"/>
        <Static id="Static9" text="회계고객여부" position="absolute 0 242 112 269" class="sta_WFDA_Label01"/>
        <Edit id="ed_Pax" onkeydown="common_OnKeyDown" taborder="3" position="absolute 658 89 850 110"/>
        <Static id="st_Pax1" text="사업자번호" position="absolute 544 86 656 113" class="sta_WFDA_Label01"/>
        <Edit id="Edit0" onkeydown="common_OnKeyDown" taborder="6" position="absolute 658 115 850 136"/>
        <Edit id="Edit1" onkeydown="common_OnKeyDown" taborder="12" position="absolute 658 193 850 214"/>
        <Edit id="ed_Email" onkeydown="common_OnKeyDown" taborder="8" position="absolute 406 141 850 162"/>
        <Edit id="ed_LoginDate" onkeydown="common_OnKeyDown" taborder="11" position="absolute 406 193 542 214"/>
        <Edit id="ed_Phone" onkeydown="common_OnKeyDown" taborder="5" position="absolute 406 115 542 136"/>
        <Edit id="ed_Tel" onkeydown="common_OnKeyDown" taborder="4" position="absolute 114 115 238 136"/>
        <Edit id="ed_Jumin" onkeydown="common_OnKeyDown" taborder="7" position="absolute 114 141 172 162"/>
        <Edit id="Edit2" onkeydown="common_OnKeyDown" taborder="9" position="absolute 114 167 238 188"/>
        <Edit id="Edit3" onkeydown="common_OnKeyDown" taborder="10" position="absolute 114 193 238 214"/>
        <Edit id="ed_Ip" onkeydown="common_OnKeyDown" taborder="13" position="absolute 114 219 322 240"/>
        <Static id="Static11" text="업종" position="absolute 324 112 404 139" class="sta_WFDA_Label01"/>
        <Static id="Static12" text="전화번호" position="absolute 544 112 656 139" class="sta_WFDA_Label01"/>
        <Static id="Static13" text="주소" position="absolute 324 138 404 165" class="sta_WFDA_Label01"/>
        <Static id="Static14" text="담당자전화" position="absolute 324 190 404 217" class="sta_WFDA_Label01"/>
        <Static id="Static15" text="담당자휴대전화" position="absolute 544 190 656 217" class="sta_WFDA_Label01"/>
        <Static id="Static16" text="사용여부" position="absolute 324 216 404 243" class="sta_WFDA_Label01"/>
        <CheckBox enable="false" falsevalue="N" id="Checkbox0" taborder="18" truevalue="Y" position="absolute 114 249 127 262" value="true"/>
        <CheckBox falsevalue="N" id="chk_Dtlyn" onclick="chk_Dtlyn_OnClick" taborder="15" truevalue="Y" position="absolute 406 249 419 262" value="true"/>
        <CheckBox falsevalue="N" id="chk_Useyn" taborder="14" truevalue="Y" position="absolute 406 223 419 236" value="true"/>
        <Static id="Static17" text="하위고객" position="absolute 324 242 404 269" class="sta_WFDA_Label01"/>
        <Static id="Static06" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1237 0 1252 710" anchor="top right"/>
        <Static id="Static71" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 710 1252 725" anchor="left bottom"/>
        <Div id="div_cmnBtn" anchor="left top right" taborder="1" url="cmn::CmnBtn.xfdl" scrollbars="none" position="absolute 0 0 1237 30"/>
        <Static id="Static09" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 40 15 61"/>
        <Static id="Static05" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 30 93 40"/>
        <Static id="Static02" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 72 40 82 61"/>
        <Static id="Static07" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 61 120 71"/>
        <Static id="Static04" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 584 38 614 59"/>
        <Static id="Static18" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 300 40 310 61"/>
        <Static id="Static00" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 71 1252 86" anchor="left bottom"/>
        <Static id="Static03" text="h15" class="Guide01_AreaRed" visible="false" position="absolute -4 269 1248 284" anchor="left bottom"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_CustDetail" cancolumnchange="ds_CustDetail_CanColumnChange">
        <ColumnInfo>
          <Column id="ADDR" size="100" type="STRING"/>
          <Column id="ATTR01" size="200" type="STRING"/>
          <Column id="ATTR02" size="200" type="STRING"/>
          <Column id="ATTR03" size="200" type="STRING"/>
          <Column id="ATTR04" size="200" type="STRING"/>
          <Column id="ATTR05" size="200" type="STRING"/>
          <Column id="ATTR06" size="22" type="BIGDECIMAL"/>
          <Column id="ATTR07" size="22" type="BIGDECIMAL"/>
          <Column id="ATTR08" size="22" type="BIGDECIMAL"/>
          <Column id="ATTR09" size="22" type="BIGDECIMAL"/>
          <Column id="ATTR10" size="22" type="BIGDECIMAL"/>
          <Column id="BIZ_CAT" size="50" type="STRING"/>
          <Column id="BIZ_NUM" size="10" type="STRING"/>
          <Column id="BIZ_TYPE" size="50" type="STRING"/>
          <Column id="CDATE" size="7" type="DATE"/>
          <Column id="CEO_NAME" size="30" type="STRING"/>
          <Column id="CON_DEPT_ID_NM" size="50" type="STRING"/>
          <Column id="CON_NM_KOR" size="20" type="STRING"/>
          <Column id="CONT_DEPT_ID" size="22" type="BIGDECIMAL"/>
          <Column id="CONT_USER" size="20" type="STRING"/>
          <Column id="CUSER" size="20" type="STRING"/>
          <Column id="CUST_CD" size="6" type="STRING"/>
          <Column id="CUST_MST_ID" size="22" type="BIGDECIMAL"/>
          <Column id="CUST_NAME" size="100" type="STRING"/>
          <Column id="DTL_YN" size="1" type="STRING"/>
          <Column id="FISCAL_YN" size="1" type="STRING"/>
          <Column id="FOOD_PAY_DATE" size="8" type="STRING"/>
          <Column id="FOOD_UPRICE" size="22" type="BIGDECIMAL"/>
          <Column id="MAIL_NUM" size="7" type="STRING"/>
          <Column id="OP_DEPT_ID" size="22" type="BIGDECIMAL"/>
          <Column id="OP_DEPT_ID_NM" size="50" type="STRING"/>
          <Column id="OP_NM_KOR" size="20" type="STRING"/>
          <Column id="OP_USER" size="20" type="STRING"/>
          <Column id="REMARK_DESC" size="800" type="STRING"/>
          <Column id="TEL_NUM" size="20" type="STRING"/>
          <Column id="UDATE" size="7" type="DATE"/>
          <Column id="USE_YN" size="1" type="STRING"/>
          <Column id="USER_EMAIL" size="30" type="STRING"/>
          <Column id="USER_HP" size="20" type="STRING"/>
          <Column id="USER_NAME" size="30" type="STRING"/>
          <Column id="USER_TEL" size="20" type="STRING"/>
          <Column id="UUSER" size="20" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_Cust">
        <ColumnInfo>
          <Column id="CUST_MST_ID" size="256" type="INT"/>
          <Column id="CUST_CD" size="256" type="STRING"/>
          <Column id="CUST_NAME" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_LowCust"/>
      <Dataset id="ds_yn">
        <ColumnInfo>
          <Column id="CD" size="256" type="STRING"/>
          <Column id="NM" size="256" type="STRING"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="CD">Y</Col>
            <Col id="NM">예</Col>
          </Row>
          <Row>
            <Col id="CD">N</Col>
            <Col id="NM">아니요</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_CustLog"/>
      <Dataset id="ds_CustLogDtl"/>
      <Dataset id="ds_CustCD"/>
    </Objects>
    <Bind>
      <BindItem id="ed_Empno_value" compid="ed_Empno" propid="value" datasetid="ds_CustDetail" columnid="CUST_CD"/>
      <BindItem id="ed_Id_value" compid="ed_Id" propid="value" datasetid="ds_CustDetail" columnid="CUST_NAME"/>
      <BindItem id="ed_Pax_value" compid="ed_Pax" propid="value" datasetid="ds_CustDetail" columnid="BIZ_NUM"/>
      <BindItem id="Edit0_value" compid="Edit0" propid="value" datasetid="ds_CustDetail" columnid="TEL_NUM"/>
      <BindItem id="Edit1_value" compid="Edit1" propid="value" datasetid="ds_CustDetail" columnid="USER_HP"/>
      <BindItem id="ed_Email_value" compid="ed_Email" propid="value" datasetid="ds_CustDetail" columnid="ADDR"/>
      <BindItem id="ed_LoginDate_value" compid="ed_LoginDate" propid="value" datasetid="ds_CustDetail" columnid="USER_TEL"/>
      <BindItem id="ed_Phone_value" compid="ed_Phone" propid="value" datasetid="ds_CustDetail" columnid="BIZ_CAT"/>
      <BindItem id="ed_Tel_value" compid="ed_Tel" propid="value" datasetid="ds_CustDetail" columnid="BIZ_TYPE"/>
      <BindItem id="ed_Jumin_value" compid="ed_Jumin" propid="value" datasetid="ds_CustDetail" columnid="MAIL_NUM"/>
      <BindItem id="Edit2_value" compid="Edit2" propid="value" datasetid="ds_CustDetail" columnid="CEO_NAME"/>
      <BindItem id="Edit3_value" compid="Edit3" propid="value" datasetid="ds_CustDetail" columnid="USER_NAME"/>
      <BindItem id="ed_Ip_value" compid="ed_Ip" propid="value" datasetid="ds_CustDetail" columnid="USER_EMAIL"/>
      <BindItem id="Checkbox0_value" compid="Checkbox0" propid="value" datasetid="ds_CustDetail" columnid="FISCAL_YN"/>
      <BindItem id="chk_Dtlyn_value" compid="chk_Dtlyn" propid="value" datasetid="ds_CustDetail" columnid="DTL_YN"/>
      <BindItem id="chk_Useyn_value" compid="chk_Useyn" propid="value" datasetid="ds_CustDetail" columnid="USE_YN"/>
      <BindItem id="item25" compid="sta_detail25" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item0" compid="sta_detail00" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item1" compid="sta_detail01" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item2" compid="sta_detail02" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item3" compid="sta_detail03" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item4" compid="sta_detail04" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item5" compid="sta_detail05" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item6" compid="sta_detail06" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item7" compid="sta_detail07" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item8" compid="sta_detail08" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item9" compid="sta_detail09" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item10" compid="sta_detail10" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item11" compid="sta_detail11" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item12" compid="sta_detail12" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item13" compid="sta_detail13" propid="text" datasetid="ds_view" columnid="D_1"/>
    </Bind>
    <Script type="xscript4.0"><![CDATA[/*
 ******************************************************************************************
 * 시스템구분   : 영업관리>기준정보
 * 프로그램명   : MAS10030E
 * 기      능   : 고객관리
 * 작  성  자   : 윤상혁
 * 작성  일자   : 20071129
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 *  1) 
 ******************************************************************************************
 */
//******************************************************************************************(90)
// [ PART 1 ]
// Form에서 Include 할 내용을 정의
//
//******************************************************************************************
include "U_lib::lib_conversionCom.xjs";
//@@컨버터에서 주석처리 #include "lib::sc_comon.js"
//@@컨버터에서 주석처리 #include "LIB::lib_comm_0001.js"		//JAVA 코딩시
//@@컨버터에서 주석처리 #include "lib::tit_comm_0001.js"		// X-Framework Lib
//******************************************************************************************
// [ PART 2 ]
// Form에서 사용될 전역변수를 선언
//
//******************************************************************************************

//******************************************************************************************
// [ PART 3 ]
// Form Loading 시 작업 정의
//
//******************************************************************************************
function form_onload(obj:Form, e:LoadEventInfo)
{
	gfn_formOnLoad(obj, false);

	fsp_init(this);
}
//콜백 프로세스 처리
function fn_call_back(cd,errmsg)
{
	if(cd!=0) 
	{
		g_Message("EE",fn_AlertMsg("002"));
		return;
	}
	else
	{
	}	
}//	ds_CustDetail
function fn_call_back_search(cd,errmsg)
{
	if(cd!=0)
	{
		//g_Message("EE",fn_AlertMsg("002"));
		return;
	}
	else
	{
		//trace(ds_CustDetail.SaveXML());
		if(ds_CustDetail.getColumn(0,"FISCAL_YN")=="Y")
		{
			chk_Useyn.enable=false;
		}
		else
		{
			chk_Useyn.enable=true;
		}
		fn_Set();	// 회계 고개과 아닌고객 구분으로 화면 세팅
		if(tab_User.tabindex==1)
		{
			if(ds_CustDetail.getColumn(0,"DTL_YN")=="N")
			{
				tab_User.tabindex=0;
			}
		}
		switch(tab_User.tabindex)
		{
		 case 0:
			//tab_User.tab0.fn_T1_Search();
			break;
		 case 1:
			tab_User.tab1.fn_T2_Search();
			break;				
		 case 2:
			tab_User.tab2.fn_T3_Search();
			break;				
		 case 3:
			break;				
		}		
	}	
}
function fn_Set()
{

	if(ds_CustDetail.getColumn(0,"FISCAL_YN")=="Y")
	{
		ed_Id.enable	=false;
		ed_Pax.enable	=false;
		ed_Tel.enable	=false;
		ed_Phone.enable	=false;
	}
	else
	{
		ed_Id.enable	=true;
		ed_Pax.enable	=true;
		ed_Tel.enable	=true;
		ed_Phone.enable	=true;	
	}
}
//******************************************************************************************
// [ PART 4 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,도움말,form닫기)
//
//******************************************************************************************

/*
 ******************************************************************************************
 * 함  수  명   : fn_Search()
 * 입      력   : 검색조건
 * 반      환   : 없음
 * 기      능   : 사용자 등록정보
 * 작  성  자   : 윤상혁
 * 작성  일자   : 20071129
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 *  1) 
 ******************************************************************************************
 */

function fn_search()
{
	if(GetRowType(ds_CustLog,0)=="insert")
	{
		if(gfn_length(gfn_trim(ds_CustLog.getColumn(0,"CONTRACT_METHOD")))==0 &&
			gfn_length(gfn_trim(ds_CustLog.getColumn(0,"RE_CONTRACT_POSS")))==0 &&
			gfn_length(gfn_trim(ds_CustLog.getColumn(0,"CUST_STS")))==0 &&
			gfn_length(gfn_trim(ds_CustLog.getColumn(0,"OUR_COM_GOOD")))==0 &&
			gfn_length(gfn_trim(ds_CustLog.getColumn(0,"LABOR_GOOD")))==0 )
		{
			ds_CustLog.reset(); 
		}
	}
	if(gfn_dsIsUpdated(ds_CustDetail)==true	||
		gfn_dsIsUpdated(ds_LowCust)==true	||
		gfn_dsIsUpdated(ds_CustLog)==true	||
		gfn_dsIsUpdated(ds_CustLogDtl)==true	)
	{
		if(g_Confirm("02","변경된 정보가 있습니다.\n\n저장 하시겠습니까?")==true)
		{
			fn_save();
			return;
		}
	}
	
	if( gfn_length(gfn_trim(ed_Custnm.value))=="" || gfn_trim(ed_Custnm.value)==null )
	{
		g_Message("EE",fn_AlertMsg("003"));
		return;
	}
	ds_Cust.clearData();
	ds_Cust.addRow();
	ds_Cust.setColumn(0,"CUST_CD",gfn_trim(ed_Custcd.value));
	ds_Cust.setColumn(0,"CUST_MST_ID",gfn_trim(ed_CustID.value));
	ds_Cust.setColumn(0,"CUST_NAME",gfn_trim(ed_Custnm.value));
	tab_User.tabindex=0;
    fsp_clear(this);
    ds_CustDetail.clearData();
    fsp_addSearch(this, "ma/mas:MAS10030E_S002");
    fsp_callService(this, "", "", "ds_Cust=ds_Cust", "ds_CustDetail=ds_CustDetail", "", "fn_call_back_search");	

}

/*
 ******************************************************************************************
 * 함  수  명   : fn_Insert()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 고객정보 입력
 * 작  성  자   : 윤상혁
 * 작성  일자   : 20071129
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 *  1) 
 ******************************************************************************************
 */
function fn_insert()
{
	if(GetRowType(ds_CustDetail,ds_CustDetail.rowposition)=="insert")
	{
		if(g_Confirm("02",fn_AlertMsg("008"))==true)
		{
			fn_save();
			return;
		}
	}
	if(GetRowType(ds_CustDetail,ds_CustDetail.rowposition)=="update")
	{
		if(g_Confirm("02",fn_AlertMsg("006"))==true)
		{
			fn_save();
			return;
		}
	}
	
	fn_sClear();// 입력시 검색 조건 클리어
	fn_GetCustCD();	// 고객 코드 생성
// 	입력 화면 초기화

	tab_User.tabindex=0;		
//	데이타 초기화	
	ds_CustDetail.clearData();
	ds_LowCust.clearData();
	ds_CustLog.clearData();
	ds_CustLogDtl.clearData();
//	마스터 데이타 입력	
	ds_CustDetail.addRow();
	ds_CustDetail.setColumn(0,"FISCAL_YN","N");
	ds_CustDetail.setColumn(0,"DTL_YN","N");
	ds_CustDetail.setColumn(0,"USE_YN","Y");
	fn_Set();
	
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_Save()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 저장
 * 작  성  자   : 윤상혁
 * 작성  일자   : 20071129
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 *  1) 
 ******************************************************************************************
 */

function fn_save()
{
	if( gfn_length(gfn_trim(ds_CustDetail.getColumn(0,"CUST_NAME")))==0 || gfn_trim(ds_CustDetail.getColumn(0,"CUST_NAME"))==null )
	{
		g_Message("EE",fn_AlertMsg("007"));
		return;
	}
	fsp_clear(this);

    if(gfn_dsIsUpdated(ds_CustDetail)==true)
    {
		// 서비스셋팅
		var actionName, cmdName, inData, outData, otherArg, callBackFnc;
		var insertSql, updateSql, deleteSql,saveFlagColumn, keySqlName, keyIncrement, callbackSql;	
		//입력및 업데이트 저장
		inData		= "ds_CustDetail=ds_CustDetail:U";
		outData		= "";
		callBackFnc	= "";
		insertSql 	= "ma/mas:MAS10030E_I001";
		updateSql	= "ma/mas:MAS10030E_U001";
		deleteSql	= "";
		keyIncrement= -1;
		callbackSql	= "";
		
		fsp_addSave(this, insertSql, updateSql, deleteSql,saveFlagColumn, keySqlName, keyIncrement, callbackSql);
		
		fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);		// 서비스 호출 
	}
	switch(tab_User.tabindex)
	{
		 // case 0:
			// if(ds_CustDetail.GetUpdate()==true)
			// {
				// if(confirm(fn_AlertMsg("006"))==true)
				// {
					// fn_Save();
					// return false;
				// }
				// else
				// {
					// ds_CustDetail.Reset();
					// return;
				// }
			// }
			// break;
		 case 1:
			if(gfn_dsIsUpdated(ds_LowCust)==true)
			{
				if(g_Confirm("02",fn_AlertMsg("006"))==true)
				{
					tab_User.tab1.fn_T2_Save();
				}
			}		 
			//tab_User.tab1.fn_T2_Search();
			break;				
		 case 2:
			if(gfn_dsIsUpdated(ds_CustLog)==true)
			{
				if(g_Confirm("02",fn_AlertMsg("006"))==true)
				{
					tab_User.tab2.fn_T3_Save_Log();
				}
			}
			if(gfn_dsIsUpdated(ds_CustLogDtl)==true)
			{
				if(g_Confirm("02",fn_AlertMsg("006"))==true)
				{
					tab_User.tab2.fn_T3_Save_LogDtl();
				}
			}					 
			//tab_User.tab2.fn_T3_Search();
			break;				
		 // case 3:
			// if(ds_CustDetail.GetUpdate()==true)
			// {
				// if(confirm(fn_AlertMsg("006"))==true)
				// {
					// fn_Save();
					// return false;
				// }
				// else
				// {
					// ds_CustDetail.Reset();
					// return;
				// }
			// }		 
			// break;				
	}    
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_Delete()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 없음
 * 작  성  자   : 윤상혁
 * 작성  일자   : 20071129
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 *  1) 
 ******************************************************************************************
 */
function fn_delete()
{
	//	삭제 없음
	// var v_str="["+ds_person.GetColumn(0,"SABUN")+"]"+ds_person.GetColumn(0,"NM_KOR");
		// v_str+="의 자료를 삭제하시겠습니까?";
	// if(confirm(v_str)==true)
	// {
	// }
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_Print()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 인쇄
 * 작  성  자   : 윤상혁
 * 작성  일자   : 20071129
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 *  1) 
 ******************************************************************************************
 */
function fn_print()
{
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_Close()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 화면닫기
 * 작  성  자   : 윤상혁
 * 작성  일자   : 20071129
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 *  1) 
 ******************************************************************************************
 */
function fn_Close()
{
	if(gfn_dsIsUpdated(ds_CustDetail)==true	||
		gfn_dsIsUpdated(ds_LowCust)==true	||
		gfn_dsIsUpdated(ds_CustLog)==true	||
		gfn_dsIsUpdated(ds_CustLogDtl)==true	)
	{
		if(g_Confirm("02","변경된 정보가 있습니다.\n\n저장 하시겠습니까?")==true)
		{
			fn_save();
			return;
		}
	}
	this.close();
}

/******************************************************************************************
 * 함  수  명   : fn_Help()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 도움말
 * 작  성  자   : 윤상혁
 * 작성  일자   : 20071129
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 *  1) 
 ******************************************************************************************
 */
function fn_help()
{
}
//******************************************************************************************
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
//
//******************************************************************************************

/******************************************************************************************
 * 함  수  명   : fn_AlertMsg(cd)
 * 입      력   : 메시지 코드
 * 반      환   : 메세지 텍스트
 * 기      능   : 메시지 처리
 * 작  성  자   : 윤상혁
 * 작성  일자   : 20071129
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 *  1) 
 ******************************************************************************************
 */

function fn_AlertMsg(cd)
{
	var v_Msg="";
	switch(cd)
	{
		case "001":
			v_Msg= "버튼이 정의 되어 있지않습니다.";
			break;
		case "002":
			v_Msg="서비스 오류:시스템 관리자에게 문의하십시오.";
			break;
		case "003":
			v_Msg="조회할 고객명을 입력하세요.";
			break;
		case "004":
			v_Msg="조회된 데이타가 없습니다.";
			break;														
		case "005":
			v_Msg="다수의 데이타가 존재합니다.\n\n시스템관리자에게 문의하십시오.";
			break;
		case "006":
			v_Msg="변경된 데이타가 있습니다.\n\n저장하시겠습니까?";
			break;
		case "007":
			v_Msg="고객명을 입력하세요.";
			break;
		case "008":
			v_Msg="데이타를 입력중입니다.";
			break;
		case "009":
			v_Msg="데이타를 입력중입니다.\n\n저장하신후 탭을 옮기세요.";
			break;
		case "010":
			v_Msg="회계고객입니다.\n\n하위고객체크박스를 제외하고 입력수정할수 없습니다.";
			break;																					
		case "011":
			v_Msg="고객을 입력하세요.";
			break;
		case "012":
			v_Msg="계약 이력 마스터를 먼저 저장하세요.";
			break;	
		case "012":
			v_Msg="계약 이력 마스터가 없습니다.";
			break;						
/*			
		case "":
			v_Msg="";
			break;
*/			
		default:
			break;			
	}
	return v_Msg;
}

//******************************************************************************************
// [ PART 6 ]
// component Event 정의 ( User Define function )
// --> component Event의 기요,기능,동작 등 상세내용은 MiPlatform 메뉴얼을 참조하시기 바랍니다.
//******************************************************************************************
/******************************************************************************************
 * 함  수  명   : tab_User_OnChanged
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 탭별 조회 함수 호출
 * 작  성  자   : 윤상혁
 * 작성  일자   : 20071129
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 *  1) 
 ******************************************************************************************
 */
function tab_User_OnChanged(obj:Tab, e:TabIndexChangeEventInfo)
{
	switch(e.postindex)
	{
		 case 0:
			//tab_User.tab0.fn_T1_Search();
			break;
		 case 1:
			tab_User.tab1.fn_T2_Search();
			break;				
		 case 2:
			tab_User.tab2.fn_T3_Search();
			break;				
		 case 3:
			break;				
	}
}
/******************************************************************************************
 * 함  수  명   : btn_CustPop_OnClick
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 고객조회팝업호출
 * 작성  일자   : 20071129
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 *  1) 
 ******************************************************************************************
 */
function btn_CustPop_OnClick(obj:Button, e:ClickEventInfo)
{
	var v_rtn=gfn_dialog("MAS10035P", "U_MAS::MAS10035P.xfdl","");
	var v_result=gfn_split(v_rtn,";");
	//	0 코드 1 명
	if(gfn_length(gfn_trim(v_rtn))==0)
	{
		ed_Custcd.value="";// 코드
		ed_Custnm.value="";// 명
		ed_CustID.value="";// ID
	}
	ed_Custcd.value=gfn_trim(v_result[0]);// 코드
	ed_Custnm.value=gfn_trim(v_result[1]);// 명
	ed_CustID.value=gfn_trim(v_result[2]);// ID
}
/******************************************************************************************
 * 함  수  명   : ed_Custnm_OnChanged
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 조회에디트 지우면 코드에디트 초기화
 * 작성  일자   : 20071129
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 *  1) 
 ******************************************************************************************
 */
function ed_Custnm_OnChanged(obj:Edit, e:TextChangedEventInfo)
{
	if(gfn_length(e.posttext.trim)==0 || gfn_trim(e.posttext)==null )
	{
		ed_Custcd.value="";
		ed_Custnm.value="";
		ed_CustID.value="";
	}
}
/******************************************************************************************
 * 함  수  명   : tab_User_OnChanging
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 탭전환, 화면 전환전에 상태체크
 * 작성  일자   : 20071129
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 *  1) 
 ******************************************************************************************
 */
function tab_User_OnChanging(obj:Tab, e:TabIndexChangeEventInfo)
{
	if(GetRowType(ds_CustDetail,ds_CustDetail.rowposition)=="insert")
	{
		g_Message("EE",fn_AlertMsg("009"));
		return false;
	}
	switch(e.postindex)
	{
		 case 1:
			if(ds_CustDetail.getColumn(0,"DTL_YN")=="N")
			{
				
				return false;
			}
			break;			
	}
	switch(e.preindex)
	{
		 case 0:
			// if(ds_CustDetail.GetUpdate()==true)
			// {
				// if(g_Confirm("02",fn_AlertMsg("006"))==true)
				// {
					// fn_Save();
					// return false;
				// }
				// else
				// {
					// ds_CustDetail.Reset();
					// return;
				// }
			// }
			break;
		 case 1:
			if(gfn_dsIsUpdated(ds_LowCust)==true)
			{
				if(g_Confirm("02",fn_AlertMsg("006"))==true)
				{
					tab_User.tab1.fn_T2_Save();
					return false;
				}
				else
				{
					ds_LowCust.reset();
					return;
				}
			}		 
			//tab_User.tab1.fn_T2_Search();
			break;				
		 case 2:
			if(gfn_dsIsUpdated(ds_CustLog)==true)
			{
				if(GetRowType(ds_CustLog,0)!="insert")
				{
					if(g_Confirm("02",fn_AlertMsg("006"))==true)
					{
						tab_User.tab2.fn_T3_Save_Log();
						return false;
					}
					else
					{
						ds_CustLog.reset();
						return;
					}
				}
				else
				{
					if(gfn_length(gfn_trim(ds_CustLog.getColumn(0,"CONTRACT_METHOD")))==0 &&
						gfn_length(gfn_trim(ds_CustLog.getColumn(0,"RE_CONTRACT_POSS")))==0 &&
						gfn_length(gfn_trim(ds_CustLog.getColumn(0,"CUST_STS")))==0 &&
						gfn_length(gfn_trim(ds_CustLog.getColumn(0,"OUR_COM_GOOD")))==0 &&
						gfn_length(gfn_trim(ds_CustLog.getColumn(0,"LABOR_GOOD")))==0 )
					{
						ds_CustLog.reset(); 
					}
					else
					{
						if(g_Confirm("02",fn_AlertMsg("006"))==true)
						{
							tab_User.tab2.fn_T3_Save_Log();
							return false;
						}
						else
						{
							ds_CustLog.reset();
							return;
						}
					}
				}
			}
			if(gfn_dsIsUpdated(ds_CustLogDtl)==true)
			{
				if(g_Confirm("02",fn_AlertMsg("006"))==true)
				{
					tab_User.tab2.fn_T3_Save_LogDtl();
					return false;
				}
				else
				{
					ds_CustLogDtl.reset();
					return;
				}
			}					 
			//tab_User.tab2.fn_T3_Search();
			break;				
		 case 3:
			// if(ds_CustDetail.GetUpdate()==true)
			// {
				// if(g_Confirm("02",fn_AlertMsg("006"))==true)
				// {
					// fn_Save();
					// return false;
				// }
				// else
				// {
					// ds_CustDetail.Reset();
					// return;
				// }
			// }		 
			break;				
	}
}
/******************************************************************************************
 * 함  수  명   : chk_Dtlyn_OnClick
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 하위고객체크 상태에 따른 탭콘트롤
 * 작성  일자   : 20071129
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 *  1) 
 ******************************************************************************************
 */
function chk_Dtlyn_OnClick(obj:CheckBox, e:ClickEventInfo)
{
	if(obj.isChecked()=="N")
	{
		if(tab_User.tabindex==1)
		{
			ds_LowCust.reset();   // 하위고객 언체크시에 데이타셋 원본상태로 돌리고 첫탭이동(하위고객 언체크시에 비활성탭이므로)
			tab_User.tabindex=0;
		}
	}
}
/******************************************************************************************
 * 함  수  명   : ds_CustDetail_CanColumnChange
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 회계 고객이면 하위고객체크를 제외하고 메인데이타는 변경이 불가합니다.
 * 작성  일자   : 20071129
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 *  1) 
 ******************************************************************************************
 */
function ds_CustDetail_CanColumnChange(obj:Dataset, e:DSColChangeEventInfo)
{
	// if(ds_CustDetail.GetColumn(0,"FISCAL_YN")=="Y")
	// {
		// if(strColumnID!="DTL_YN")
		// {
			// g_Message("EE",fn_AlertMsg("010"));
			// return false;
		// }
	// }
}

function ed_Custnm_OnKeyDown(obj:Edit, e:KeyEventInfo)
{
	if(e.keycode==13)
	{
		if(gfn_length(gfn_trim(obj.value))>0)
		{
			fn_search();
		}
		else
		{
			btn_CustPop.click();
		}
	}
	if(e.keycode==46)
	{
		ed_Custcd.value="";
		ed_Custnm.value="";
		ed_CustID.value="";
	}
}
function fn_sClear()
{
	ed_Custcd.value="";
	ed_Custnm.value="";
	ed_CustID.value="";
}
function fn_GetCustCD()
{
	fsp_clear(this);
	
	ds_CustCD.clearData();
	fsp_addSearch(this,"ma/mas:MAS10030E_S007");
	fsp_callService(this,"","","","ds_CustCD=ds_CustCD","","fn_Call_back_CustCD");

}

function fn_Call_back_CustCD(cd,errmsg)
{
	if(cd==-1)
	{
		g_Message("EE","시시템 오류!\n\n전산 담당자에게 문의하세요.");
		return;
	}
	else
	{
		if(ds_CustDetail.getRowCount()>0)
		{
			ds_CustDetail.setColumn(0,"CUST_CD",ds_CustCD.getColumn(0,"CUST_CD"));
			ds_CustDetail.setColumn(0,"CUST_MST_ID",ds_CustCD.getColumn(0,"CUST_MST_ID"));
		}
		else
		{
			g_Message("EE","고객 코드 생성에 문제가 있습니다.\n\n전산 담당자게 문의 하세요.");
			return;
		}
	}
}
function common_OnKeyDown(obj:Edit, e:KeyEventInfo)
{
	if(e.keycode==13)
	{
		var nObj=GetNextComponent(null);
		nObj.setFocus();
	}
}
]]></Script>
  </Form>
</FDL>
