<?xml version="1.0" encoding="UTF-8"?>
<hqml xmlns="http://hone.hanwha.co.kr/schema/hqml"
	name="sc.app.mainDAO">
	<desc>FC POS 마스터 외부 인터페이스 HQML</desc>









	<statement name="selectTest"><![CDATA[SELECT '1' AS CHECK_NUM
  FROM DUAL]]></statement>
	<statement name="logInsert"><![CDATA[INSERT INTO APP_INTERFACE_LOG(
INSDT,
TXID,
TXDIV,
TXHEADER,
TXDATA,
TXRESULT)
VALUES(
TO_CHAR(SYSDATE,'YYYY-MM-DD HH24:MI:SS'),
<#if txId?has_content >:txId,<#else>null,</#if> 
<#if txDiv?has_content >:txDiv,<#else>null,</#if> 
<#if tHeader?has_content >:tHeader,<#else>null,</#if> 
<#if tData?has_content >:tData,<#else>null,</#if> 
<#if tResult?has_content >:tResult<#else>null</#if> 
)]]></statement>
	<statement name="selectUpjang"><![CDATA[SELECT T1.UPJANG AS UPJANG_CD,
       NVL(T4.CREDIT_AMOUNT,0) AS CREDIT_AMOUNT,
       NVL(T4.CREDIT_RMN_AMT,0) AS CREDIT_RMN_AMT,
       NVL(T4.CREDIT_AMOUNT,0) - NVL(T4.CREDIT_RMN_AMT,0) AS BOND_AMT,
       (SELECT NM_KOR FROM SCC_USERINFO WHERE SABUN = T3.PART_SALES_SABUN) AS SALES_NM, --담당영업사원
       SC_CRYPTO_FUN('DEC',T3.PART_SALES_TEL_NO_ENC) AS SALES_TELNO, --담당영업사원전화번호
       (SELECT NM_KOR FROM SCC_USERINFO WHERE SABUN = T3.CS_SABUN) AS CS_NM, --CS사원
       SC_CRYPTO_FUN('DEC',T3.CS_TEL_NO_ENC) AS CS_TELNO, --CS전화번호
       (SELECT BANKNM FROM HLDC_ST_BANK WHERE BANKCD = T3.BANK_CD) BANK_NM,
       SC_CRYPTO_FUN('DEC',T2.BANK_ACCT_NO_ENC) AS VACCT_NO--가상계좌
  FROM (SELECT :upjangCd AS UPJANG
          FROM DUAL) T1,
       ST_UPJANG     T2,
       FMS_UPJANG    T3,
       TABLE(FT_UPJANG_CREDIT_LIMIT(:upjangCd, :needDate)) T4
 WHERE T1.UPJANG = T2.UPJANG(+)
   AND T1.UPJANG = T3.UPJANG(+)
   AND T1.UPJANG = T4.UPJANG(+)]]></statement>
	<statement name="selectSubinv"><![CDATA[
SELECT T1.SUBINV_CODE
     , T1.SUBINV_NAME
     , GREATEST(NVL(T1.D_DAYS,0),NVL(T3.D_DAYS,0))
     + DECODE(NVL(T1.D_DAYS,0)+NVL(T3.D_DAYS,0),0,0,DECODE(T4.UPJ_CNT,0,NVL(T5.ALL_D,0),NVL(T4.UPJ_D,0))) AS D_DAYS
     , TO_CHAR(TO_DATE(TRIM(TO_CHAR(DECODE(SIGN(NVL(T1.D_DAYS,0)-NVL(T3.D_DAYS,0)),1,NVL(TO_NUMBER(T1.D_TIMES),0),0,LEAST(NVL(TO_NUMBER(T1.D_TIMES),0),NVL(TO_NUMBER(T3.D_TIMES),0)),NVL(TO_NUMBER(T3.D_TIMES),0)),'0000')),'HH24MI'),'HH24MI') AS D_TIMES
     , DECODE(GREATEST(NVL(T1.D_DAYS,0),NVL(T3.D_DAYS,0))+DECODE(NVL(T1.D_DAYS,0)+NVL(T3.D_DAYS,0),0,0,DECODE(T4.UPJ_CNT,0,NVL(T5.ALL_D,0),NVL(T4.UPJ_D,0))),0,'-','D-'||TO_CHAR(GREATEST(NVL(T1.D_DAYS,0),NVL(T3.D_DAYS,0))+DECODE(NVL(T1.D_DAYS,0)+NVL(T3.D_DAYS,0),0,0,DECODE(T4.UPJ_CNT,0,NVL(T5.ALL_D,0),NVL(T4.UPJ_D,0)))))
       ||' '||DECODE(GREATEST(NVL(T1.D_DAYS,0),NVL(T3.D_DAYS,0))+DECODE(NVL(T1.D_DAYS,0)+NVL(T3.D_DAYS,0),0,0,DECODE(T4.UPJ_CNT,0,NVL(T5.ALL_D,0),NVL(T4.UPJ_D,0))),0,'-',TO_CHAR(TO_DATE(TRIM(TO_CHAR(DECODE(SIGN(NVL(T1.D_DAYS,0)-NVL(T3.D_DAYS,0)),1,NVL(TO_NUMBER(T1.D_TIMES),0),0,LEAST(NVL(TO_NUMBER(T1.D_TIMES),0),NVL(TO_NUMBER(T3.D_TIMES),0)),NVL(TO_NUMBER(T3.D_TIMES),0)),'0000')),'HH24MI'),'HH24:MI')) AS DAYS
     , NVL(T3.D_OVER_DAYS,0) AS D_OVER_DAYS, T3.QTY_CONTROL_YN
  FROM HLDC_PO_SUBINVENTORY T1, FMS_SUBINVENTORY T2, FMS_UPJANG T3
     ,(SELECT COUNT(*) AS UPJ_CNT
            , SUM(DECODE(USE_YN,'Y',1,0)) AS UPJ_D
         FROM FMS_EXC_DAYS
        WHERE UPJANG = :upjangCd
          AND EXC_DATE BETWEEN TO_CHAR(SYSDATE,'YYYYMMDD') AND NVL(:needDate,TO_CHAR(SYSDATE,'YYYYMMDD'))) T4
     ,(SELECT COUNT(*) AS ALL_CNT
            , SUM(DECODE(USE_YN,'Y',1,0)) AS ALL_D
         FROM FMS_EXC_DAYS
        WHERE UPJANG = -1
          AND EXC_DATE BETWEEN TO_CHAR(SYSDATE,'YYYYMMDD') AND NVL(:needDate,TO_CHAR(SYSDATE,'YYYYMMDD'))) T5
 WHERE T2.SUBINV_CODE = T1.SUBINV_CODE
   AND T2.SUBINV_CODE LIKE 'S1%'
   AND T2.UPJANG = :upjangCd
   AND T1.USE_YN = 'Y' 
   AND T2.USE_YN = 'Y'
   AND T2.UPJANG = T3.UPJANG
 ORDER BY T2.SUBINV_CODE]]></statement>
	<statement name="selectCtrlday"><![CDATA[
SELECT T1.CTRL_DATE
  FROM (
SELECT CTRL_DATE
  FROM FMP_ORD_CTRL_DAYS T1
 WHERE UPJANG = :upjangCd
   AND USE_YN = 'Y'
UNION
SELECT CTRL_DATE
  FROM FMP_ORD_CTRL_DAYS
 WHERE UPJANG = -1
   AND USE_YN = 'Y') T1, (SELECT D_OVER_DAYS FROM FMS_UPJANG WHERE UPJANG = :upjangCd) T2
 WHERE 1=1
   AND T1.CTRL_DATE BETWEEN TO_CHAR(SYSDATE,'YYYYMMDD') AND TO_CHAR(SYSDATE+NVL(T2.D_OVER_DAYS,0),'YYYYMMDD')
ORDER BY 1]]></statement>
</hqml>
