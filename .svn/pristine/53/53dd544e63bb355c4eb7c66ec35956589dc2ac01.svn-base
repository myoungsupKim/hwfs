<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.5">
  <TypeDefinition url="..\..\..\default_typedef.xml"/>
  <Form id="ClaimProcessDetailReportPop" classname="frmCalendar" inheritanceid="" position="absolute" titletext="클레임신청상세등록" onload="form_onload" left="0" top="0" width="520" height="628" scrollbars="none" enable="true">
    <Layouts>
      <Layout>
        <Static id="staFormSize" position="absolute" left="0" top="0" width="520" height="629" cssclass="sta_POP_Bg"/>
        <Static id="Static00" taborder="7" left="0" top="0" height="70" cssclass="sta_POP_TitleBg" width="520" text="상세신청"/>
        <Button id="btnClose" taborder="6" onclick="btnClose_onclick" cssclass="btn_POP_XBtn" top="0" height="70" width="70" right="0"/>
        <Static id="Static02" taborder="9" text="h10" cssclass="sta_GUIDE_Area" visible="false" left="442" top="618" width="102" height="10" style="align:right middle;"/>
        <Static id="Static03" taborder="10" text="w10" cssclass="sta_GUIDE_Area" visible="false" left="0" top="588" width="10" height="100" style="align:left bottom;"/>
        <Static id="Static04" taborder="11" text="w10" cssclass="sta_GUIDE_Area" visible="false" left="510" top="588" width="10" height="100" style="align:left bottom;"/>
        <Static id="Static05" taborder="12" left="29.23%" top="80" right="26.92%" height="84" onclick="Static05_onclick"/>
        <Static id="Static06" taborder="13" cssclass="sta_WF_TopLine" left="0" top="70" right="0" height="2"/>
        <Static id="Static43" taborder="19" text="글자사이간격w20" cssclass="sta_GUIDE_Area2" visible="false" left="119" top="89" width="20" height="29"/>
        <Static id="Static09" taborder="20" cssclass="sta_WFSA_LabelBg" left="10" top="80" right="10" height="59" style="background:#ffffffff;"/>
        <MaskEdit id="msk_reqQty" taborder="21" mask="#,##0.0" left="610" top="86" height="47" style="padding:0 10 0 10;align:right middle; :disabled {color:#555555ff;}" autoselect="false" right="-238"/>
        <Static id="Static01" taborder="22" cssclass="sta_WFSA_LabelBg" left="10" top="138" right="10" height="59" style="background:#ffffffff;"/>
        <Combo id="cbo_ctClaimKind" taborder="23" innerdataset="@ds_claimTypeCd" codecolumn="cd" datacolumn="cdNm" ondropdown="cbo_claimType_ondropdown" left="196" top="144" right="10" height="47" index="-1"/>
        <Static id="Static07" taborder="24" cssclass="sta_WFSA_LabelBg" left="10" top="196" right="10" height="59" style="background:#ffffffff;"/>
        <Combo id="cbo_reqKind" taborder="25" innerdataset="ds_processTypeCd" codecolumn="cd" datacolumn="cdNm" ondropdown="cbo_processType_ondropdown" left="196" top="202" right="10" height="47" index="-1"/>
        <TextArea id="txt_claimMemo" taborder="26" imemode="hangul" autoselect="false" left="196" top="261" height="88" right="10" acceptstab="false"/>
        <Static id="Static08" taborder="27" cssclass="sta_WFSA_LabelBg" left="10" top="354" right="10" height="59" style="background:#ffffffff;"/>
        <Calendar id="cal_reqDate" taborder="28" dateformat="yyyy-MM-dd" left="196" top="360" height="47" style="padding:0 10 0 0;" right="10" value="null" autoselect="true"/>
        <Static id="Static10" taborder="29" cssclass="sta_WFSA_LabelBg" left="10" top="412" right="10" height="59" style="background:#ffffffff;"/>
        <MaskEdit id="msk_reqTime" taborder="30" mask="##:##" left="196" top="418" height="47" style="padding:0 10 0 10;align:left middle; :disabled {color:#555555ff;}" right="10" oneditclick="msk_reqTime_oneditclick" type="string" autoselect="true" trimtype="both" maskchar="_" clipmode="includespace" enable="false"/>
        <TextArea id="txt_etcMemo" taborder="31" imemode="hangul" autoselect="false" left="196" top="477" height="88" right="10" visible="false"/>
        <Button id="btn_save" taborder="32" text="저장" onclick="btn_save_onclick" cssclass="btn_WF_Function" left="445" top="571" width="65" height="47"/>
        <MaskEdit id="msk_dlvyQty" taborder="33" mask="#,##0.0" autoselect="false" left="196" top="86" height="47" style="padding:0 10 0 10;align:right middle; :disabled {color:#555555ff;}" enable="false" width="161"/>
        <Static id="Static11" taborder="34" text="입고량/요청량" cssclass="sta_WF_Label02" left="10" top="80" width="182" height="59"/>
        <Static id="Static13" taborder="36" text="클레임유형" cssclass="sta_WF_Label02" left="10" top="139" width="169" height="59"/>
        <Static id="Static12" taborder="37" text="요청사항" cssclass="sta_WF_Label02" left="10" top="196" width="169" height="59"/>
        <Static id="Static14" taborder="38" text="클레임상세" cssclass="sta_WF_Label02" left="10" top="274" width="154" height="59"/>
        <Static id="Static15" taborder="39" text="입고요청일자" cssclass="sta_WF_Label02" left="10" top="354" width="198" height="59"/>
        <Static id="Static16" taborder="40" text="입고요청시간" cssclass="sta_WF_Label02" left="10" top="412" width="200" height="59"/>
        <Static id="Static17" taborder="41" text="기타사항" cssclass="sta_WF_Label02" left="10" top="491" width="169" height="59" visible="false"/>
        <Static id="sta_reqDate" taborder="42" left="196" top="360" width="314" height="47" onclick="sta_reqDate_onclick"/>
        <Edit id="edt_reqQty" taborder="43" left="363" top="86" width="147" height="47" style="align:right middle;" inputtype="number,dot"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_processTypeCd" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="cd" type="STRING" size="256"/>
          <Column id="cdNm" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_claimTypeCd" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="cd" type="STRING" size="256"/>
          <Column id="cdNm" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_list" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="false" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="checked" type="STRING" size="256"/>
          <Column id="reqQty" type="STRING" size="256"/>
          <Column id="poId" type="STRING" size="256"/>
          <Column id="poNum" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_listqty" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" oncolumnchanged="ds_list_oncolumnchanged">
        <ColumnInfo>
          <Column id="checked" type="BIGDECIMAL" size="255"/>
          <Column id="itemCode" type="STRING" size="255"/>
          <Column id="itemName" type="STRING" size="255"/>
          <Column id="itemSize" type="STRING" size="255"/>
          <Column id="poUom" type="STRING" size="255"/>
          <Column id="custcd" type="STRING" size="255"/>
          <Column id="custnm" type="STRING" size="255"/>
          <Column id="poQty" type="BIGDECIMAL" size="255"/>
          <Column id="reqQty" type="BIGDECIMAL" size="255"/>
          <Column id="ctClaimKind" type="STRING" size="255"/>
          <Column id="reqDate" type="STRING" size="255"/>
          <Column id="reqTime" type="STRING" size="255"/>
          <Column id="reqKind" type="STRING" size="255"/>
          <Column id="claimMemo" type="STRING" size="255"/>
          <Column id="prcsStatus" type="STRING" size="255"/>
          <Column id="dlvyKind" type="STRING" size="255"/>
          <Column id="createBy" type="STRING" size="255"/>
          <Column id="mobileGubun" type="STRING" size="255"/>
          <Column id="photo" type="BIGDECIMAL" size="255"/>
          <Column id="poId" type="BIGDECIMAL" size="255"/>
          <Column id="centerCode" type="STRING" size="255"/>
          <Column id="subinvCode" type="STRING" size="255"/>
          <Column id="upjang" type="STRING" size="255"/>
          <Column id="needDate" type="STRING" size="255"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Bind>
      <BindItem id="item6" compid="txt_claimMemo" propid="value" datasetid="ds_grd00" columnid="remark"/>
      <BindItem id="item0" compid="txt_etcMemo" propid="value" datasetid="ds_grd00" columnid="remark"/>
    </Bind>
    <Script type="xscript5.0"><![CDATA[//########################################################
// [프로젝트]		FC종합전산 모바일시스템 구축
// [시스템명]		클레임신청상세현황
// [부시스템명]	클레임신청상세현황
// [설명]		    클레임신청상세현황.
// [작성자명] 		강대성
// [작성일자]		2015.05.26
// -----------------[수정이력]--------------------------
// 수정일자 : 수정자 : 수정내용
// 2015.05.26 : 강대성 : 클레임신청상세현황 신규
//########################################################
include "lib::lib_Com.xjs"
/*================================================================================
 * 1. 변수 선언
 *===============================================================================*/
this.preDate = undefined; //현재날짜
this.preDateTime = undefined; //현재날짜 + 시간(시분)
this.inputDateTime = undefined; //입고요청일자 + 입고요청시간(시분)
this.fv_totalpageRow;	// 전체건수
this.reqNum = undefined;

this.reqQty = undefined;
this.ctClaimKind = undefined;
this.reqKind = undefined;
this.claimMemo = undefined;
this.reqDate = undefined;
this.reqTime = undefined;
this.etcMemo = undefined;

this.vRtn = 0;
this.vRtn2 = 0;

/*================================================================================
 * 2. Form관련 Script
 *===============================================================================*/
/** 
 * Form의 모든 컴포넌트가 생성되고, 모든 Object가 Load 되었을 때에 발생하는 Event
 * @param
	obj : Event가 발생한 Object
	e : Event Object
 * @return : 없음
 */ 
this.form_onload = function(obj:Form, e:nexacro.LoadEventInfo)
{
	//필수
	this.fn_init();
	
}

// 데이터 초기화
this.fn_init = function ()
{
	application.goMain.gfn_POP_resize(this);
	
	this.preDate = this.gfn_Today();
	
	//클레임 유형
	this.fn_common_code("C05", "", "");	
	this.ds_claimTypeCd.copyData(application.gds_common_code);
	
	//요청사항
	this.fn_common_code("C02", "", "");	
	this.ds_processTypeCd.copyData(application.gds_common_code);	
	
	//this.fsp_init();
	this.arg = application.goMain.gfn_POP_getArg();
	
	this.reqQty = this.arg[0];
	this.ctClaimKind = this.arg[1];
	this.reqKind = this.arg[2];
	this.claimMemo = this.arg[3];
	this.reqDate = this.arg[4];
	this.reqTime = this.arg[5];
	this.etcMemo = this.arg[6];
	
	this.edt_reqQty.set_value(this.arg[0]);
 	this.cbo_ctClaimKind.set_value(this.arg[1]);
 	this.cbo_reqKind.set_value(this.arg[2]);
 	this.txt_claimMemo.set_value(this.arg[3]);
 	this.cal_reqDate.set_value(this.arg[4]);
	this.msk_reqTime.set_value(this.arg[5]);
	this.txt_etcMemo.set_value(this.arg[6]);
	this.msk_dlvyQty.set_value(this.arg[7]);
	
	var nRow = this.ds_list.addRow();
	this.ds_list.setColumn(nRow, "checked", "1");
	this.ds_list.setColumn(nRow, "reqQty", this.arg[0]);
	this.ds_list.setColumn(nRow, "poId", this.arg[8]);
	this.ds_list.setColumn(nRow, "poNum", this.arg[9]);
	//this.fn_chk();
	
	var values = this.cbo_reqKind.value;
	if(values == "C0203" || values == "C0204")
	{	
		this.msk_reqTime.set_enable(true);
	}
	else
	{
		this.msk_reqTime.set_enable(false);
	}	
	
	this.edt_reqQty.setFocus();
	this.edt_reqQty.setSelect(this.edt_reqQty.text.length, this.edt_reqQty.text.length);
}

// 달력 클릭 시(From)
this.sta_reqDate_onclick = function(obj:Static,  e:nexacro.ClickEventInfo)
{
	var objCalArg = this.cal_reqDate.value;
	
	application.goMain.gfn_POP_create("PopCalFrom", "cmmn::CmmnCalendarPop.xfdl", "fn_callbackPOP", this, objCalArg, "POP", application.goMain.divBase);
	return false;
}

//클레임유형  콤보 팝업창 호출
this.cbo_claimType_ondropdown = function(obj:Combo, e:nexacro.EventInfo)
{
	var arg = new Array();
	arg[0] = this.ds_claimTypeCd;
	arg[1] = "클레임유형";
	arg[2] = "";
	arg[3] = "cdNm";
	application.goMain.gfn_POP_create("ClaimType", "cmmn::CmmnComboList.xfdl", "fn_callbackPOP", this, arg, "POP", application.goMain.divBase);
	return false;
}

//요청사항  콤보 팝업창 호출
this.cbo_processType_ondropdown = function(obj:Combo, e:nexacro.EventInfo)
{
	var arg = new Array();
	arg[0] = this.ds_processTypeCd;
	arg[1] = "요청사항";
	arg[2] = "";
	arg[3] = "cdNm";
	application.goMain.gfn_POP_create("ProcessType", "cmmn::CmmnComboList.xfdl", "fn_callbackPOP", this, arg, "POP", application.goMain.divBase);
	return false;
}

/*******************************************************************************
* 기      능   :  저장버튼 클릭시
* 설      명   :  저장버튼 클릭시
********************************************************************************/ 
this.btn_save_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	//저장 체크
 	if(!this.fn_SaveCheck())
	{
		return;
	}
	//this.fn_chk();
	this.fn_save();
}

this.fn_save = function ()
{
	var arg = new Array();
	
	arg[0] = this.edt_reqQty.value;     							 //요청수량
	arg[1] = this.ds_claimTypeCd.getColumn(this.vRtn, "cd"); 		 //클레임유형
	arg[2] = this.ds_processTypeCd.getColumn(this.vRtn2, "cd");      //요청사항
	arg[3] = this.txt_claimMemo.text;    							 //클레임상세내용
	arg[4] = this.cal_reqDate.value;    							 //입고요청일자
	arg[5] = this.msk_reqTime.value;     							 //입고요청시간
	arg[6] = this.txt_etcMemo.text;      							 //기타사항
	
	application.goMain.gfn_POP_close(this, arg);
}

/*******************************************************************************
* 기      능   :  저장체크
* 설      명   :  저장체크
********************************************************************************/
this.fn_chk = function ()
{
	this.ds_list.setColumn(0, "reqQty", this.edt_reqQty.value);
	
	this.ds_list.setRowType(0 , "U");
	
	var strSvcID   		 = "claimQty";
	var strUrl     		 = "fm/fmc/claimReg/selectItemQty.xdo";
	var strInDataset     = "ds_list=ds_list:U";
	var strOutDataset    = "ds_listqty=ds_listqty";
	var strArguments	 = "";
	var strCallbackFunc	 = "fn_callBack";
	var bAsync			 = true;

	this.gfn_transaction(this, strSvcID, strUrl, strInDataset, strOutDataset, strArguments, strCallbackFunc, bAsync);
}

/*******************************************************************************
* 기      능   :  저장체크
* 설      명   :  저장체크
********************************************************************************/
this.fn_SaveCheck = function ()
{
	if ( this.gfn_isNull(this.edt_reqQty.value) )
	{
		application.goMain.gfn_Msg("ALERT_0", "알림", "요청량을 입력하세요.", "OK", true, this);
		return false;
	}	 	
 	
 	if( this.gfn_isNull(this.cbo_ctClaimKind.value) )
 	{
 		application.goMain.gfn_Msg("ALERT_0", "알림", "클레임유형를 입력하세요.", "OK");	
 		return false;
 	}
 	
 	if ( this.gfn_isNull(this.cbo_reqKind.value) )
	{
		application.goMain.gfn_Msg("ALERT_0", "알림", "요청사항을 입력하세요.", "OK", true, this);
		return false;
	}
		
	if ( this.gfn_isNull(this.txt_claimMemo.value) )
	{
		application.goMain.gfn_Msg("ALERT_0", "알림", "클레임상세내용을 입력하세요.", "OK", true, this);
		return false;
	}	
	
	var values = this.cbo_reqKind.value;
 	
 	this.preDateTime = this.gfn_subStr(this.gfn_TodayTime(),0,12);  //현재날짜 + 현재시간 + 분
	this.inputDateTime = this.cal_reqDate.value + this.msk_reqTime.value; //입고요청일자 + 입고요청시간 + 분
	
	if(values == "C0203" || values == "C0204")
	{	
		if ( this.gfn_isNull(this.cal_reqDate.value) )
		{
			application.goMain.gfn_Msg("ALERT_0", "알림", "입고요청일자를 입력하세요.", "OK", true, this);
			return false;
		} 	
 	
		if ( this.gfn_isNull(this.gfn_Ltrim(this.msk_reqTime.value)) )
		{
			application.goMain.gfn_Msg("ALERT_0", "알림", "교환일경우 입고요청시간을 입력하셔야 합니다.", "OK", true, this);
			return false;
		}
		
		if(!this.gfn_IsTime(this.msk_reqTime.value + "00")) 
		{
			application.goMain.gfn_Msg("ALERT_0", "알림", "시간 형식에서 벗어났습니다.", "OK", true, this);
			this.msk_reqTime.set_value(this.arg[5]);
			return false;
		}
		
		if(nexacro.toNumber(this.inputDateTime) < nexacro.toNumber(this.preDateTime))
		{
			application.goMain.gfn_Msg("ALERT_0", "알림", "입고요청일자 및 시간은 현재날짜 및 현재시간 이전일수 없습니다!", "OK", true, this);
			return false;
		}
	}
	else
	{
		if ( !this.gfn_isNull(this.cal_reqDate.value) )
		{
			if(nexacro.toNumber(this.cal_reqDate.value) < nexacro.toNumber(this.preDate))
			{
				application.goMain.gfn_Msg("ALERT_0", "알림", "입고요청일자는 현재날짜 이전일수 없습니다!", "OK", true, this);
				return false;
			}
		}	
		
	}		
	
	var reqQty = new Number(this.edt_reqQty.value);
	var dlvyQty = new Number(this.msk_dlvyQty.value);

	if(reqQty > dlvyQty)
	{
		application.goMain.gfn_Msg("ALERT_0", "알림", "요청량이 입고수량보다 큽니다.", "OK", true, this);
		return false;
	}	
		
// 	if(this.ds_listqty.getRowCount() > 0){
// 		if(this.ds_listqty.getColumn(0,"claimQty") == "N"){
// 			var msg = "["+this.ds_listqty.getColumn(0,"upjangnm")+"]업장에 ["+this.ds_listqty.getColumn(0,"itemName") +"]는\n";
// 			application.goMain.gfn_Msg("ALERT_0", "알림", msg+"재고부족으로 클레임 요청을 하실 수 없습니다.", "OK", true, this);
// 			return false;			
// 		}		
// 	}
	
	if(this.reqQty == this.edt_reqQty.value && this.ctClaimKind == this.cbo_ctClaimKind.value && this.reqKind == this.cbo_reqKind.value && this.claimMemo == this.txt_claimMemo.value && 
	   this.reqDate == this.cal_reqDate.value && this.reqTime == this.msk_reqTime.value && this.etcMemo == this.txt_etcMemo.value)
	{
		application.goMain.gfn_Msg("ALERT_0", "알림", "변경된 데이터가 없습니다.", "OK", true, this);
		return false;
	}
	
	
	return true;
}

this.btnClose_onclick = function (obj:Button, e:ClickEventInfo)
{
	application.goMain.gfn_POP_close(this, "CLOSEONLY");
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 트랜잭션 콜백 함수 (필수)
 *---------------------------------------------------------------------------------------------*/
this.fn_callBack = function (strSvcID, nErrorCode, strErrorMsg)
{
	// 에러시 gfn_callBack에서 메시지 제공, 화면별 특정 에러 발생시에만 사용하세요.
	if (nErrorCode < 0) 
	{
		application.goMain.gfn_POP_close(this, "CLOSEONLY");		
	}
	
    switch(strSvcID)
    {
		case "claimQty" :
			this.fn_save();
			break;
    }
}


/** 
 * 팝업 callBack
 * @param  : popname - 팝업을 구분짓는 id
 rtn : 팝업이 닫히면서 전달된 값
 * @return : 없음
 */
this.fn_callbackPOP = function (popname, rtn)
{
	switch (popname)
	{
		case "PopCalFrom":
			this.cal_reqDate.set_value(rtn);
			break;
		case "ClaimType":
			this.cbo_ctClaimKind.set_index(rtn);
			this.vRtn = rtn;
			
			var ctClaimKind = this.cbo_ctClaimKind.value;
			//업체주의요청_클레임유형이 업체 주의요청일 경우 양쪽 모두(업체주의요청) 셋팅
			if(ctClaimKind == "C0519")
			{	
				var nIndex1 = this.ds_processTypeCd.findRowExpr("cd=='C0206'");
				this.cbo_reqKind.set_index(nIndex1);	
				this.vRtn2 = nIndex1;
			}	
			
			break;	
		case "ProcessType":
			this.cbo_reqKind.set_index(rtn);
			this.vRtn2 = rtn;
			
			var values = this.cbo_reqKind.value;
			if(values == "C0203" || values == "C0204")
			{	
				this.msk_reqTime.set_enable(true);
			}
			else
			{
				this.msk_reqTime.set_enable(false);
			}
			
			//업체주의요청_요청사항이 업체 주의요청일 경우 양쪽 모두(업체주의요청) 셋팅
			if(values == "C0206")
			{		
				var nIndex2 = this.ds_claimTypeCd.findRowExpr("cd=='C0519'");
				this.cbo_ctClaimKind.set_index(nIndex2);	
				this.vRtn = nIndex2;
			}	
			
			break;	
	}
}

/** 
 * 팝업 callBack
 * @param  : popname - 팝업을 구분짓는 id
 rtn : 팝업이 닫히면서 전달된 값
 * @return : 없음
 */
this.msg_callback = function (id, rtn)
{
	if (id == "ALERT_0") // 조회 시 오류
	{
		// 아무 일도 안함.
	}
}
]]></Script>
  </Form>
</FDL>
