<%----------------------------------------------------------- - Project     : 한화 FS System - MenuID      : 메뉴관리 > 위생관리 > 위생일지출력 > CCP1 - ViewPage    : FSC00110R.xml - Description : 선택 메뉴 레시피 리스트 조회 - Author      : 손 창 덕 - History     : 1) 2008. 03. 20 - 최초작성. -               2)  ------------------------------------------------------------%><%@page import="com.sz.util.AppDataUtility"%><%@page import="com.ifis.sc.scc.CommonUtil"%><%@page contentType="text/html; charset=EUC-KR" %><%@ include file = "../../sc/main/common.jsp" %><%	try {		PlatformRequest platformRequest = this.proc_input(request);  		in_vl = platformRequest.getData().getVariableList();		in_dl = platformRequest.getData().getDataSetList();		//입력 데이타		DataSet ds_Cond     = in_dl.get("ds_Cond");		DataSet ds_List     = in_dl.get("ds_List");// 변경된 데이타				//입력 파라메터		//String g_Upjang     = nullToBlank(in_vl.getString("g_Upjang"));		//String g_EmpNo      = nullToBlank(in_vl.getString("g_EmpNo"));					DataSet ds_out;		StringBuffer sbSql = new StringBuffer();		sbSql.setLength(0);        sbSql.append("SELECT   A.MU_NM, A.TM_CD, A.TM_NM, A.UPJANG, A.UPJANGNM, A.CHECK_DATE         \n");        sbSql.append("       , SUM(CD1) AS CD1                                                       \n");        sbSql.append("       , SUM(CD2) AS CD2                                                       \n");        sbSql.append("       , SUM(CD3) AS CD3                                                       \n");        sbSql.append("       , SUM(CD4) AS CD4                                                       \n");        sbSql.append("       , SUM(CD5) AS CD5                                                       \n");        sbSql.append("       , SUM(CD6) AS CD6                                                       \n");        sbSql.append("       , SUM(CD7) AS CD7                                                       \n");        sbSql.append("       , SUM(CD8) AS CD8                                                       \n");        sbSql.append("       , SUM(CD9) AS CD9                                                       \n");        sbSql.append("       , SUM(CD10) AS CD10                                                     \n");        sbSql.append("       , SUM(CD11) AS CD11                                                     \n");        sbSql.append("       , SUM(CD12) AS CD12                                                     \n");        sbSql.append("       , SUM(CD13) AS CD13                                                     \n");        sbSql.append("       , SUM(CD14) AS CD14                                                     \n");        sbSql.append("       , SUM(CD15) AS CD15                                                     \n");        sbSql.append("       , SUM(CD16) AS CD16                                                     \n");        sbSql.append("       , SUM(CD17) AS CD17                                                     \n");        sbSql.append("       , SUM(CD18) AS CD18                                                     \n");        sbSql.append("       , SUM(CD19) AS CD19                                                     \n");        sbSql.append("       , SUM(CD20) AS CD20                                                     \n");        sbSql.append("  FROM (                                                                       \n");        sbSql.append("        SELECT A.TM_CD                                                         \n");        sbSql.append("             , (SELECT DISTINCT TM_NM FROM HLDC_SC_DEPT_V WHERE A.TM_CD = TM_CD) AS TM_NM \n");        sbSql.append("             , C.MU_NM                                                         \n");        sbSql.append("             , A.UPJANG                                                        \n");        sbSql.append("             , C.UPJANGNM                                                      \n");        sbSql.append("             , B.CHECK_DATE                                                    \n");        sbSql.append("             , B.CLASS_CD                                                      \n");        sbSql.append("             , B.MARK                                                          \n");        sbSql.append("             , DECODE(CLASS_CD, '01008001', B.MARK, 0) CD1                     \n");        sbSql.append("             , DECODE(CLASS_CD, '01008002', B.MARK, 0) CD2                     \n");        sbSql.append("             , DECODE(CLASS_CD, '01008003', B.MARK, 0) CD3                     \n");        sbSql.append("             , DECODE(CLASS_CD, '01008004', B.MARK, 0) CD4                     \n");        sbSql.append("             , DECODE(CLASS_CD, '01008005', B.MARK, 0) CD5                     \n");        sbSql.append("             , DECODE(CLASS_CD, '01008006', B.MARK, 0) CD6                     \n");        sbSql.append("             , DECODE(CLASS_CD, '01008007', B.MARK, 0) CD7                     \n");        sbSql.append("             , DECODE(CLASS_CD, '01008008', B.MARK, 0) CD8                     \n");        sbSql.append("             , DECODE(CLASS_CD, '01008009', B.MARK, 0) CD9                     \n");        sbSql.append("             , DECODE(CLASS_CD, '01008010', B.MARK, 0) CD10                    \n");        sbSql.append("             , DECODE(CLASS_CD, '01008011', B.MARK, 0) CD11                    \n");        sbSql.append("             , DECODE(CLASS_CD, '01008012', B.MARK, 0) CD12                    \n");        sbSql.append("             , DECODE(CLASS_CD, '01008013', B.MARK, 0) CD13                    \n");        sbSql.append("             , DECODE(CLASS_CD, '01008014', B.MARK, 0) CD14                    \n");        sbSql.append("             , DECODE(CLASS_CD, '01008015', B.MARK, 0) CD15                    \n");        sbSql.append("             , DECODE(CLASS_CD, '01008016', B.MARK, 0) CD16                    \n");        sbSql.append("             , DECODE(CLASS_CD, '01008017', B.MARK, 0) CD17                    \n");        sbSql.append("             , DECODE(CLASS_CD, '01008018', B.MARK, 0) CD18                    \n");        sbSql.append("             , DECODE(CLASS_CD, '01008019', B.MARK, 0) CD19                    \n");        sbSql.append("             , DECODE(CLASS_CD, '01008020', B.MARK, 0) CD20                    \n");        sbSql.append("          FROM FSC_RESULT_MST A, FSC_RESULT_DTL B                              \n");        sbSql.append("             , ( \n");        sbSql.append("               SELECT UPJANG, UPJANGNM, MU_CD, MU_NM, TM_CD, TM_NAME \n");        sbSql.append("                 FROM FSA_UPJANG_V \n");        sbSql.append("                WHERE 1=1 \n");        if (!nullToBlank(ds_Cond.getString(0, "MU_CD")).equals("")) {            sbSql.append("      AND    MU_CD='" + nullToBlank(ds_Cond.getString(0, "MU_CD")) + "' \n");        }        if (!nullToBlank(ds_Cond.getString(0, "TM_CD")).equals("")) {            sbSql.append("      AND    TM_CD='" + nullToBlank(ds_Cond.getString(0, "TM_CD")) + "' \n");        }        sbSql.append("               ) C \n");                sbSql.append("         WHERE A.UPJANG = C.UPJANG                                             \n");        sbSql.append("           AND A.TABLE_TYPE = B.TABLE_TYPE                                     \n");        sbSql.append("           AND A.FORM_CD = B.FORM_CD                                           \n");        sbSql.append("           AND A.UPJANG = B.UPJANG                                             \n");        sbSql.append("           AND A.CHECK_DATE = B.CHECK_DATE                                     \n");        sbSql.append("           AND SUBSTR(B.CLASS_CD,1,5) = '01008'                                \n");        sbSql.append("           AND A.CONFIRM_YN = 'Y'                                              \n");        sbSql.append("           AND A.CHECK_DATE BETWEEN '" + nullToBlank(ds_Cond.getString(0, "S_DATE")) + "' AND '" + nullToBlank(ds_Cond.getString(0, "E_DATE")) + "'  \n");        sbSql.append("           AND A.CHECK_TYPE IN ('001','003')                                   \n");                sbSql.append("        ) A                                                                    \n");        sbSql.append(" GROUP BY A.MU_NM, A.TM_CD, A.TM_NM, A.UPJANG, A.UPJANGNM, A.CHECK_DATE                 \n");        sbSql.append(" ORDER BY A.MU_NM, A.TM_CD, A.TM_NM, A.UPJANG, A.UPJANGNM, A.CHECK_DATE                 \n");        //System.out.print("===================================>6");		pstmt = conn.prepareStatement(sbSql.toString());		rs = pstmt.executeQuery();				ds_List = this.makeDataSet(rs, "ds_List");		out_dl.add(ds_List);			   	this.setResultMessage(0, "OK", out_vl);	} catch(Exception ex) {	   ex.printStackTrace();       this.setResultMessage(-1, ex.toString(), out_vl);	} finally {		if(rs != null) {			try {				rs.close();			}catch(Exception e) {}		}		if(pstmt != null) {			try {				pstmt.close();			}catch(Exception e) {}		}		if(conn != null) {			try {				conn.close();			}catch(Exception e) {}		}		proc_output(response, out, out_vl, out_dl);	}%>