<?xml version="1.0" encoding="euc-kr"?>
<query>
	<type>select</type>
	<description><![CDATA[]]></description>
	<reload>true</reload>
	<monitoring>true</monitoring>
	<result-count>1</result-count>
	<statement>
<![CDATA[
SELECT SUBSTR(MENU_DATE,7,2) ||'일('|| TO_CHAR(TO_DATE(MENU_DATE,'YYYYMMDD'),'DY','NLS_DATE_LANGUAGE=KOREAN') ||')' AS DAYS
-- 최근 4주간 실식수 현황
-- 1주전
     , WDESC
     , DECODE(D.ACT_SCHEDULE,NULL,D.FCT_SCHEDULE,D.ACT_SCHEDULE) SCHEDULE
     , REAL_MEAL_QTY
     , FSM_REAL_RECIPE_NAME_FUN(A.UPJANG,MENU_CD) AS SIKDAN
     , MENU_FEATURE
  FROM FSM_REAL_MENU_MST A
     ,(SELECT WDESC, AREA_CODE FROM UPOS_SC_WEATHER_INFO_V
       WHERE  CUR_DATE = TO_CHAR(TO_DATE(#SEL_DATE#,'YYYYMMDD') - 7,'YYYYMMDD')) B
     , SCO_UPJANG_MST C
     , (
        SELECT  FCT_SCHEDULE, ACT_SCHEDULE, OP_DATE
        FROM    MAF_OP_CALENDAR
        WHERE   UPJANG = #UPJANG#
        AND     TM_CD = (SELECT TM_CD FROM MAC_UPJANG_V WHERE UPJANG = #UPJANG#)
        AND     OP_DATE = TO_CHAR(TO_DATE(#SEL_DATE#,'YYYYMMDD') - 7,'YYYYMMDD')
       ) D
 WHERE A.UPJANG = #UPJANG#
   AND MENU_DATE = TO_CHAR(TO_DATE(#SEL_DATE#,'YYYYMMDD') - 7,'YYYYMMDD')
   AND A.HALL_CD = #HALL_CD#
   AND A.MEAL = #MEAL#
   AND A.CORNER = #CORNER#
   AND A.UPJANG = C.UPJANG
   AND C.LOC_CD = B.AREA_CODE (+)
   AND A.MENU_DATE = D.OP_DATE(+)
 UNION ALL
-- 2주전
SELECT SUBSTR(MENU_DATE,7,2) ||'일('|| TO_CHAR(TO_DATE(MENU_DATE,'YYYYMMDD'),'DY','NLS_DATE_LANGUAGE=KOREAN') ||')' AS DAYS
     , WDESC
     , DECODE(D.ACT_SCHEDULE,NULL,D.FCT_SCHEDULE,D.ACT_SCHEDULE) SCHEDULE
     , REAL_MEAL_QTY
     , FSM_REAL_RECIPE_NAME_FUN(A.UPJANG,MENU_CD) AS SIKDAN
     , MENU_FEATURE
  FROM FSM_REAL_MENU_MST A
     ,(SELECT WDESC, AREA_CODE FROM UPOS_SC_WEATHER_INFO_V
       WHERE  CUR_DATE = TO_CHAR(TO_DATE(#SEL_DATE#,'YYYYMMDD') - 14,'YYYYMMDD')) B
     , SCO_UPJANG_MST C
     , (
        SELECT  FCT_SCHEDULE, ACT_SCHEDULE, OP_DATE
        FROM    MAF_OP_CALENDAR
        WHERE   UPJANG = #UPJANG#
        AND     TM_CD = (SELECT TM_CD FROM MAC_UPJANG_V WHERE UPJANG = #UPJANG#)
        AND     OP_DATE = TO_CHAR(TO_DATE(#SEL_DATE#,'YYYYMMDD') - 14,'YYYYMMDD')
       ) D
 WHERE A.UPJANG = #UPJANG#
   AND MENU_DATE = TO_CHAR(TO_DATE(#SEL_DATE#,'YYYYMMDD') - 14,'YYYYMMDD')
   AND A.HALL_CD = #HALL_CD#
   AND A.MEAL = #MEAL#
   AND A.CORNER = #CORNER#
   AND A.UPJANG = C.UPJANG
   AND C.LOC_CD = B.AREA_CODE (+)
   AND A.MENU_DATE = D.OP_DATE(+)
UNION ALL
-- 3주전
SELECT SUBSTR(MENU_DATE,7,2) ||'일('|| TO_CHAR(TO_DATE(MENU_DATE,'YYYYMMDD'),'DY','NLS_DATE_LANGUAGE=KOREAN') ||')' AS DAYS
     , WDESC
     , DECODE(D.ACT_SCHEDULE,NULL,D.FCT_SCHEDULE,D.ACT_SCHEDULE) SCHEDULE
     , REAL_MEAL_QTY
     , FSM_REAL_RECIPE_NAME_FUN(A.UPJANG,MENU_CD) AS SIKDAN
     , MENU_FEATURE
  FROM FSM_REAL_MENU_MST A
     ,(SELECT WDESC, AREA_CODE FROM UPOS_SC_WEATHER_INFO_V
       WHERE  CUR_DATE = TO_CHAR(TO_DATE(#SEL_DATE#,'YYYYMMDD') - 21,'YYYYMMDD')) B
     , SCO_UPJANG_MST C
     , (
        SELECT  FCT_SCHEDULE, ACT_SCHEDULE, OP_DATE
        FROM    MAF_OP_CALENDAR
        WHERE   UPJANG = #UPJANG#
        AND     TM_CD = (SELECT TM_CD FROM MAC_UPJANG_V WHERE UPJANG = #UPJANG#)
        AND     OP_DATE = TO_CHAR(TO_DATE(#SEL_DATE#,'YYYYMMDD') - 21,'YYYYMMDD')
       ) D
 WHERE A.UPJANG = #UPJANG#
   AND MENU_DATE = TO_CHAR(TO_DATE(#SEL_DATE#,'YYYYMMDD') - 21,'YYYYMMDD')
   AND A.HALL_CD = #HALL_CD#
   AND A.MEAL = #MEAL#
   AND A.CORNER = #CORNER#
   AND A.UPJANG = C.UPJANG
   AND C.LOC_CD = B.AREA_CODE (+)
   AND A.MENU_DATE = D.OP_DATE(+)
 UNION ALL
-- 4주전
SELECT SUBSTR(MENU_DATE,7,2) ||'일('|| TO_CHAR(TO_DATE(MENU_DATE,'YYYYMMDD'),'DY','NLS_DATE_LANGUAGE=KOREAN') ||')' AS DAYS
     , WDESC
     , DECODE(D.ACT_SCHEDULE,NULL,D.FCT_SCHEDULE,D.ACT_SCHEDULE) SCHEDULE
     , REAL_MEAL_QTY
     , FSM_REAL_RECIPE_NAME_FUN(A.UPJANG,MENU_CD) AS SIKDAN
     , MENU_FEATURE
  FROM FSM_REAL_MENU_MST A
     ,(SELECT WDESC, AREA_CODE FROM UPOS_SC_WEATHER_INFO_V
       WHERE  CUR_DATE = TO_CHAR(TO_DATE(#SEL_DATE#,'YYYYMMDD') - 28,'YYYYMMDD')) B
     , SCO_UPJANG_MST C
     , (
        SELECT  FCT_SCHEDULE, ACT_SCHEDULE, OP_DATE
        FROM    MAF_OP_CALENDAR
        WHERE   UPJANG = #UPJANG#
        AND     TM_CD = (SELECT TM_CD FROM MAC_UPJANG_V WHERE UPJANG = #UPJANG#)
        AND     OP_DATE = TO_CHAR(TO_DATE(#SEL_DATE#,'YYYYMMDD') - 28,'YYYYMMDD')
       ) D
 WHERE A.UPJANG = #UPJANG#
   AND MENU_DATE = TO_CHAR(TO_DATE(#SEL_DATE#,'YYYYMMDD') - 28,'YYYYMMDD')
   AND A.HALL_CD = #HALL_CD#
   AND A.MEAL = #MEAL#
   AND A.CORNER = #CORNER#
   AND A.UPJANG = C.UPJANG
   AND C.LOC_CD = B.AREA_CODE (+)
   AND A.MENU_DATE = D.OP_DATE(+)	]]></statement>
	<input default-name="ds_input">
	</input>
	<output default-name="ds_view">
	</output>
</query>