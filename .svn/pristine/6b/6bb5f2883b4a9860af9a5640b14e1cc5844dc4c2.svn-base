<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.5">
  <TypeDefinition url="..\..\..\default_typedef.xml"/>
  <Form id="MessageBoard" classname="GUIDE_class" left="0" top="0" width="540" height="760" titletext="공지사항" onload="form_onload">
    <Layouts>
      <Layout>
        <Button id="btn_moreView" taborder="118" onclick="btn_moreView_onclick" visible="false" left="128" right="136" bottom="0" height="42" style="background:darkgray;color:white;opacity:75;"/>
        <Grid id="grd_list" taborder="122" binddataset="ds_list" useinputpanel="false" autofittype="col" onvscroll="grd_list_onvscroll" oncellclick="grd_list_oncellclick" left="0" top="0" right="0" bottom="0" onslide="grd_list_onslide" treeusecheckbox="false" treeuseexpandkey="true">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="541"/>
              </Columns>
              <Rows>
                <Row size="90"/>
              </Rows>
              <Band id="body">
                <Cell displaytype="tree" edittype="tree" text="bind:bbsName" treelevel="bind:levels" treeexpandimage="URL('theme://Image\btn_WF_SpinMinusP.png')" treecollapseimage="URL('theme://Image\btn_WF_SpinPlusP.png')"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
      </Layout>
    </Layouts>
    <Bind/>
    <Objects>
      <Dataset id="ds_list" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="bbsId" type="bigdecimal" size="255"/>
          <Column id="bbsName" type="string" size="255"/>
          <Column id="parentBbsId" type="bigdecimal" size="255"/>
          <Column id="bbsType" type="string" size="255"/>
          <Column id="bbsGubun" type="string" size="255"/>
          <Column id="levels" type="bigdecimal" size="255"/>
          <Column id="sortSeq" type="bigdecimal" size="255"/>
          <Column id="useYn" type="string" size="255"/>
          <Column id="level" type="bigdecimal" size="255"/>
          <Column id="isMobile" type="bigdecimal" size="255"/>
          <Column id="tot" type="bigdecimal" size="255"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Script type="xscript5.0"><![CDATA[include "lib::lib_Com.xjs";

this.bbsId = undefined;

this.form_onload = function(obj:Form, e:nexacro.LoadEventInfo) {
	//필수
	this.fn_init();
}

this.fn_init = function () {
	this.fn_search();	
}

this.fn_search = function() {
	//검색
	var strSvcID   		 = "search";
	var strUrl     		 = "ms/mmb/messageBoard/selectList.xdo";
	var strInDataset     = "";
	var strOutDataset    = "ds_list=ds_list";
	var strArguments	 = " userId=" + nexacro.wrapQuote(application.g_userId);
		strArguments	+= " upjangCd=" + nexacro.wrapQuote(application.g_Upjang);
		strArguments	+= " gubun=" + nexacro.wrapQuote("01");
	var strCallbackFunc	 = "fn_callBack";
	var bAsync			 = true;

	this.gfn_transaction(this, strSvcID, strUrl, strInDataset, strOutDataset, strArguments, strCallbackFunc, bAsync);  	
}

this.fn_callBack = function (strSvcID, nErrorCode, strErrorMsg) {	
	if ( nErrorCode < 0 ) {
		return;
	}
	
    switch ( strSvcID ) {		
		//공지사항
        case "search" :
			trace(this.ds_list.saveXML());
			break;
    }    
}

this.grd_list_oncellclick = function(obj:Grid, e:nexacro.GridClickEventInfo) {
	
	//trace(e.canvasX);
	
	//추가 - 트리버튼의 영역이 눌렸을 경우는 로직을 타지 않도록 처리 함.
	if( e.canvasX < 18 ) { 
		return; 
	}
	
	var objDs = this[obj.binddataset];

	if ( this.treeStatus == 1 ) {
		this.treeStatus = 0;
		return;
	}

	var childRow = obj.getTreeChildRow(objDs.rowposition, 0, true);

	// 자식 노드가 존재할 경우
	if ( childRow >= 0 ) {
		var gridRow = obj.getTreeRow(objDs.rowposition);
		if (obj.isTreeCollapsedRow(childRow, true)) {
			obj.setTreeStatus(gridRow, true);
		} else {
			obj.setTreeStatus(gridRow, false);
		}
	}
	this.treeStatus = 0;
	
	if ( obj.isTreeLeafRow(e.row) ) {
		this.parent.pArgument = objDs.getColumn(e.row, "bbsId");
		application.gfn_setTitleMain(objDs.getColumn(e.row, "bbsName"));
		
		// action 실행
		application.gv_menuBefId = "3244";
		application.gv_formBefUrl = "M_MMB::MessageBoard2.xfdl";
		application.gv_menuBefName = "게시판";
		application.gv_progrmBefId = "";
		application.gv_backFlag = "CUSTOM";
		this.parent.divWork.set_url("M_MMB::MessageBoardList.xfdl");
	}
}
]]></Script>
  </Form>
</FDL>
