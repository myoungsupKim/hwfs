<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="..\..\..\default_typedef.xml"/>
  <Form id="FoodMaterialsSalePrice" classname="COMP_GUIDE_13" inheritanceid="" position="absolute 0 0 1252 725" titletext="식자재영업 판매단가" scrollbars="autoboth" onload="form_onload" onkeydown="FoodMaterialsSalePrice_onkeydown">
    <Layouts>
      <Layout>
        <Static id="Static06" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1237 0 1252 710" anchor="top right"/>
        <Static id="Static71" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 710 1252 725" anchor="left bottom"/>
        <Div id="div_cmnBtn" anchor="left top right" taborder="11" url="cmn::CmnBtn.xfdl" text="Div00" scrollbars="none" position="absolute 0 0 1237 30" tabstop="false"/>
        <Static id="Static29" class="sta_WFSA_Labelbg" position="absolute -1 30 1236 97" anchor="left top right"/>
        <Static id="Static45" text="W15" visible="false" position="absolute -1 30 14 97" style="background:#ff000055;align:center middle;"/>
        <Static id="Static43" text="W10" visible="false" position="absolute 14 30 277 40" style="background:#ff000055;align:center middle;"/>
        <Static id="Static44" text="W10" visible="false" position="absolute 14 87 277 97" style="background:#ff000055;align:center middle;"/>
        <Static id="Static28" text="센터" class="sta_WFSA_label" position="absolute 15 40 77 61" anchor="left top"/>
        <Static id="Static11" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 85 40 95 61" anchor="left top"/>
        <Edit id="edt_upjang" taborder="1" onkeydown="edt_upjang_onkeydown" position="absolute 351 40 548 61" style=":disabled {cursor:arrowwait;}" userdata="" class="edt_WF_Essential" readonly="true"/>
        <Button id="btn_upjang" taborder="2" tabstop="false" class="btn_WF_popSearchEssential" position="absolute 546 40 567 61" onclick="btn_upjang_onclick"/>
        <Static id="Static09" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 255 40 285 61" anchor="left top"/>
        <Static id="Static03" text="단가개시일" class="sta_WFSA_label" position="absolute 14 68 98 89" anchor="left top"/>
        <Static id="Static00" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 84 66 94 87" anchor="left top"/>
        <Static id="Static01" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 255 66 285 87" anchor="left top"/>
        <Static id="Static51" text="W05." visible="false" position="absolute 0 61 538 66" style="background:#ff000055;align:center middle;"/>
        <Static id="Static02" text="W05." visible="false" position="absolute 476 61 1014 66" style="background:#ff000055;align:center middle;"/>
        <Static id="Static04" text="고객사" class="sta_WFSA_label" position="absolute 285 40 347 61" anchor="left top"/>
        <Static id="Static05" text="납품업체" class="sta_WFSA_label" position="absolute 285 66 347 87" anchor="left top"/>
        <Static id="Static07" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 341 40 351 61" anchor="left top"/>
        <Static id="Static08" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 342 66 352 87" anchor="left top"/>
        <Static id="Static10" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 567 40 597 61" anchor="left top"/>
        <Static id="Static12" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 567 66 597 87" anchor="left top"/>
        <Static id="Static13" text="단가계약번호" class="sta_WFSA_label" position="absolute 598 40 696 61" anchor="left top"/>
        <Static id="Static14" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 683 40 693 61" anchor="left top"/>
        <Combo id="cbo_contract" taborder="3" position="absolute 693 40 1022 61" anchor="left top" innerdataset="@ds_contract" codecolumn="contractId" datacolumn="contractDisp" index="-1" onitemchanged="cbo_contract_onitemchanged" class="cmb_WF_Essential"/>
        <Static id="Static17" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 684 66 694 87" anchor="left top"/>
        <Static id="Static22" text="판매단가 목록" class="sta_WF_Title01" position="absolute 0 109 450 127" anchor="left top"/>
        <Static id="Static20" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 0 123 450 128" anchor="left top"/>
        <Grid id="grd_list" taborder="10" binddataset="ds_list" autoenter="select" useinputpanel="false" cellsizingtype="col" position="absolute 0 128 1237 710" anchor="all" autofittype="none" autosizingtype="none" oncellclick="grd_list_oncellclick" scrollbars="autoboth" selecttype="multirow" onheadclick="grd_list_onheadclick" formatid="default">
          <Formats>
            <Format id="w_income_price">
              <Columns>
                <Column size="22"/>
                <Column size="63"/>
                <Column size="188"/>
                <Column size="71"/>
                <Column size="112"/>
                <Column size="185"/>
                <Column size="56"/>
                <Column size="93"/>
                <Column size="89"/>
                <Column size="89"/>
                <Column size="79"/>
                <Column size="64"/>
                <Column size="125"/>
                <Column size="100"/>
                <Column size="64"/>
                <Column size="87"/>
                <Column size="92"/>
                <Column size="84"/>
                <Column size="80"/>
                <Column size="82"/>
                <Column size="88"/>
                <Column size="82"/>
                <Column size="90"/>
                <Column size="64"/>
                <Column size="125"/>
                <Column size="100"/>
                <Column size="110"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="0"/>
              </Columns>
              <Rows>
                <Row size="26" band="head"/>
                <Row size="24" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell class="head_Excel"/>
                <Cell col="1" text="업체" taborder="undefined"/>
                <Cell col="2" rowspan="2" text="업체명"/>
                <Cell col="3" rowspan="2" text="자재코드"/>
                <Cell col="4" rowspan="2" text="자재명"/>
                <Cell col="5" rowspan="2" text="규격"/>
                <Cell col="6" rowspan="2" text="구매단위"/>
                <Cell col="7" colspan="8" text="[기존]단가구성"/>
                <Cell col="15" colspan="12" text="[적용]단가구성"/>
                <Cell col="27" rowspan="2" text="구매계약번호"/>
                <Cell col="28" rowspan="2" text="과/면세"/>
                <Cell col="29" rowspan="2" text="centerCode"/>
                <Cell col="30" rowspan="2" text="upjang"/>
                <Cell col="31" rowspan="2" text="stdDate"/>
                <Cell col="32" rowspan="2" text="contractId"/>
                <Cell col="33" rowspan="2" text="contractNm"/>
                <Cell col="34" rowspan="2" text="stdUpjang"/>
                <Cell col="35" rowspan="2" text="salePriceStart"/>
                <Cell col="36" rowspan="2" text="salePriceEnd"/>
                <Cell row="1"/>
                <Cell row="1" col="1" text="코드" taborder="undefined"/>
                <Cell row="1" col="7" text="단가개시일"/>
                <Cell row="1" col="8" text="단가종료일"/>
                <Cell row="1" col="9" text="매입단가"/>
                <Cell row="1" col="10" text="판매단가"/>
                <Cell row="1" col="11" text="마진"/>
                <Cell row="1" col="12" text="매입단가(차감반영)"/>
                <Cell row="1" col="13" text="마진(차감반영)"/>
                <Cell row="1" col="14" text="센터"/>
                <Cell row="1" col="15" text="단가개시일"/>
                <Cell row="1" col="16" text="단가종료일"/>
                <Cell row="1" col="17" text="매입단가"/>
                <Cell row="1" col="18" text="전략단가"/>
                <Cell row="1" col="19" text="기획단가"/>
                <Cell row="1" col="20" text="판매단가"/>
                <Cell row="1" col="21" text="이익율"/>
                <Cell row="1" col="22" text="마진"/>
                <Cell row="1" col="23" text="센터"/>
                <Cell row="1" col="24" text="매입단가(차감반영)"/>
                <Cell row="1" col="25" text="마진(차감반영)"/>
                <Cell row="1" col="26" text="이익률(차감반영)"/>
              </Band>
              <Band id="body">
                <Cell text="expr:currow+1"/>
                <Cell col="1" displaytype="text" style="align:center middle;" text="bind:custCd"/>
                <Cell col="2" displaytype="text" style="align:left middle;" text="bind:custNm"/>
                <Cell col="3" displaytype="text" style="align:center middle;" text="bind:itemCode"/>
                <Cell col="4" displaytype="text" style="align:left middle;" text="bind:itemName"/>
                <Cell col="5" displaytype="text" style="align:left middle;" text="bind:itemSize"/>
                <Cell col="6" style="align:center middle;" text="bind:itemUnit"/>
                <Cell col="7" displaytype="text" style="align:center middle;" text="bind:contractStart"/>
                <Cell col="8" displaytype="text" style="align:center middle;" text="bind:contractEnd"/>
                <Cell col="9" displaytype="number" style="align:right middle;" text="bind:contractPriceS1" mask="#,##0.#0"/>
                <Cell col="10" displaytype="number" style="align:right middle;" text="bind:salePrice1"/>
                <Cell col="11" displaytype="number" style="align:right;" text="bind:marginRate1" mask="##0.#"/>
                <Cell col="12" displaytype="number" style="align:right;" text="expr:contractPriceS1-incomePrice" mask="#,##0.#0"/>
                <Cell col="13" displaytype="number" style="align:right;" text="expr:salePrice1-(contractPriceS1-incomePrice)" mask="#,##0.#0"/>
                <Cell col="14" displaytype="text" edittype="none" style="align:center middle;" text="expr:centerFlag1=='VC'?'직송':centerFlag1" combodisplay="edit"/>
                <Cell col="15" displaytype="text" style="align:center middle;" text="bind:contractStart2"/>
                <Cell col="16" displaytype="text" style="align:center middle;" text="bind:contractEnd2"/>
                <Cell col="17" displaytype="number" edittype="none" style="align:right middle;background2: ;color:blue;color2:blue;" text="bind:contractPriceS2" mask="#,##0.#0"/>
                <Cell col="18" displaytype="number" edittype="none" text="bind:strategyPrice" mask="#,##0.#0"/>
                <Cell col="19" displaytype="number" edittype="none" text="bind:planningPrice" mask="#,##0.#0"/>
                <Cell col="20" displaytype="number" edittype="masknumber" style="align:right middle;color:blue;color2:blue;" class="grd_WF_Essential" text="bind:salePrice2" editautoselect="true"/>
                <Cell col="21" displaytype="number" text="bind:stdMarginRate" mask="##0.#"/>
                <Cell col="22" displaytype="number" style="align:right middle;" text="bind:marginRate2" mask="##0.#"/>
                <Cell col="23" displaytype="text" edittype="none" style="align:center middle;" text="expr:centerFlag2=='VC'?'직송':centerFlag2"/>
                <Cell col="24" displaytype="number" style="align:right;" text="expr:contractPriceS2-incomePrice" mask="#,##0.#0"/>
                <Cell col="25" displaytype="number" style="align:right;" text="expr:salePrice2-(contractPriceS2-incomePrice)" mask="#,##0.#0"/>
                <Cell col="26" displaytype="number" style="align:right;" text="expr:(salePrice2-(contractPriceS2-incomePrice))/salePrice2" mask="#,##0.#"/>
                <Cell col="27" displaytype="text" text="bind:poContractId"/>
                <Cell col="28" text="bind:taxCode"/>
                <Cell col="29" displaytype="text" text="bind:centerCode"/>
                <Cell col="30" displaytype="text" text="bind:upjang"/>
                <Cell col="31" displaytype="text" text="bind:stdDate"/>
                <Cell col="32" displaytype="text" text="bind:contractId"/>
                <Cell col="33" displaytype="text" text="bind:contractNm"/>
                <Cell col="34" displaytype="text" text="bind:stdUpjang"/>
                <Cell col="35" displaytype="text" text="bind:salePriceStart"/>
                <Cell col="36" displaytype="text" text="bind:salePriceEnd"/>
              </Band>
            </Format>
            <Format id="default">
              <Columns>
                <Column size="22"/>
                <Column size="63"/>
                <Column size="188"/>
                <Column size="71"/>
                <Column size="112"/>
                <Column size="185"/>
                <Column size="56"/>
                <Column size="93"/>
                <Column size="89"/>
                <Column size="89"/>
                <Column size="79"/>
                <Column size="64"/>
                <Column size="64"/>
                <Column size="87"/>
                <Column size="92"/>
                <Column size="84"/>
                <Column size="80"/>
                <Column size="82"/>
                <Column size="88"/>
                <Column size="82"/>
                <Column size="90"/>
                <Column size="64"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="0"/>
              </Columns>
              <Rows>
                <Row size="26" band="head"/>
                <Row size="24" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell class="head_Excel"/>
                <Cell col="1" text="업체" taborder="undefined"/>
                <Cell col="2" rowspan="2" text="업체명"/>
                <Cell col="3" rowspan="2" text="자재코드"/>
                <Cell col="4" rowspan="2" text="자재명"/>
                <Cell col="5" rowspan="2" text="규격"/>
                <Cell col="6" rowspan="2" text="구매단위"/>
                <Cell col="7" colspan="6" text="[기존]단가구성"/>
                <Cell col="13" colspan="9" text="[적용]단가구성"/>
                <Cell col="22" rowspan="2" text="구매계약번호"/>
                <Cell col="23" rowspan="2" text="과/면세"/>
                <Cell col="24" rowspan="2" text="centerCode"/>
                <Cell col="25" rowspan="2" text="upjang"/>
                <Cell col="26" rowspan="2" text="stdDate"/>
                <Cell col="27" rowspan="2" text="contractId"/>
                <Cell col="28" rowspan="2" text="contractNm"/>
                <Cell col="29" rowspan="2" text="stdUpjang"/>
                <Cell col="30" rowspan="2" text="salePriceStart"/>
                <Cell col="31" rowspan="2" text="salePriceEnd"/>
                <Cell row="1"/>
                <Cell row="1" col="1" text="코드" taborder="undefined"/>
                <Cell row="1" col="7" text="단가개시일"/>
                <Cell row="1" col="8" text="단가종료일"/>
                <Cell row="1" col="9" text="매입단가"/>
                <Cell row="1" col="10" text="판매단가"/>
                <Cell row="1" col="11" text="마진"/>
                <Cell row="1" col="12" text="센터"/>
                <Cell row="1" col="13" text="단가개시일"/>
                <Cell row="1" col="14" text="단가종료일"/>
                <Cell row="1" col="15" text="매입단가"/>
                <Cell row="1" col="16" text="전략단가"/>
                <Cell row="1" col="17" text="기획단가"/>
                <Cell row="1" col="18" text="판매단가"/>
                <Cell row="1" col="19" text="이익율"/>
                <Cell row="1" col="20" text="마진"/>
                <Cell row="1" col="21" text="센터"/>
              </Band>
              <Band id="body">
                <Cell text="expr:currow+1"/>
                <Cell col="1" displaytype="text" style="align:center middle;" text="bind:custCd"/>
                <Cell col="2" displaytype="text" style="align:left middle;" text="bind:custNm"/>
                <Cell col="3" displaytype="text" style="align:center middle;" text="bind:itemCode"/>
                <Cell col="4" displaytype="text" style="align:left middle;" text="bind:itemName"/>
                <Cell col="5" displaytype="text" style="align:left middle;" text="bind:itemSize"/>
                <Cell col="6" style="align:center middle;" text="bind:itemUnit"/>
                <Cell col="7" displaytype="text" style="align:center middle;" text="bind:contractStart"/>
                <Cell col="8" displaytype="text" style="align:center middle;" text="bind:contractEnd"/>
                <Cell col="9" displaytype="number" style="align:right middle;" text="bind:contractPriceS1" mask="#,##0.#0"/>
                <Cell col="10" displaytype="number" style="align:right middle;" text="bind:salePrice1"/>
                <Cell col="11" displaytype="number" style="align:right;" text="bind:marginRate1" mask="##0.#"/>
                <Cell col="12" displaytype="text" edittype="none" style="align:center middle;" text="expr:centerFlag1=='VC'?'직송':centerFlag1" combodisplay="edit"/>
                <Cell col="13" displaytype="text" style="align:center middle;" text="bind:contractStart2"/>
                <Cell col="14" displaytype="text" style="align:center middle;" text="bind:contractEnd2"/>
                <Cell col="15" displaytype="number" edittype="none" style="align:right middle;background2: ;color:blue;color2:blue;" text="bind:contractPriceS2" mask="#,##0.#0"/>
                <Cell col="16" displaytype="number" edittype="none" text="bind:strategyPrice" mask="#,##0.#0"/>
                <Cell col="17" displaytype="number" edittype="none" text="bind:planningPrice" mask="#,##0.#0"/>
                <Cell col="18" displaytype="number" edittype="masknumber" style="align:right middle;color:blue;color2:blue;" class="grd_WF_Essential" text="bind:salePrice2" editautoselect="true"/>
                <Cell col="19" displaytype="number" text="bind:stdMarginRate" mask="##0.#"/>
                <Cell col="20" displaytype="number" style="align:right middle;" text="bind:marginRate2" mask="##0.#"/>
                <Cell col="21" displaytype="text" edittype="none" style="align:center middle;" text="expr:centerFlag2=='VC'?'직송':centerFlag2"/>
                <Cell col="22" displaytype="text" text="bind:poContractId"/>
                <Cell col="23" text="bind:taxCode"/>
                <Cell col="24" displaytype="text" text="bind:centerCode"/>
                <Cell col="25" displaytype="text" text="bind:upjang"/>
                <Cell col="26" displaytype="text" text="bind:stdDate"/>
                <Cell col="27" displaytype="text" text="bind:contractId"/>
                <Cell col="28" displaytype="text" text="bind:contractNm"/>
                <Cell col="29" displaytype="text" text="bind:stdUpjang"/>
                <Cell col="30" displaytype="text" text="bind:salePriceStart"/>
                <Cell col="31" displaytype="text" text="bind:salePriceEnd"/>
              </Band>
            </Format>
            <Format id="w_barcode">
              <Columns>
                <Column size="22"/>
                <Column size="63"/>
                <Column size="188"/>
                <Column size="71"/>
                <Column size="100"/>
                <Column size="112"/>
                <Column size="185"/>
                <Column size="56"/>
                <Column size="93"/>
                <Column size="89"/>
                <Column size="89"/>
                <Column size="79"/>
                <Column size="64"/>
                <Column size="64"/>
                <Column size="87"/>
                <Column size="92"/>
                <Column size="84"/>
                <Column size="80"/>
                <Column size="82"/>
                <Column size="88"/>
                <Column size="82"/>
                <Column size="90"/>
                <Column size="64"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="0"/>
              </Columns>
              <Rows>
                <Row size="26" band="head"/>
                <Row size="24" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell class="head_Excel"/>
                <Cell col="1" text="업체" taborder="undefined"/>
                <Cell col="2" rowspan="2" text="업체명"/>
                <Cell col="3" rowspan="2" text="자재코드"/>
                <Cell col="4" rowspan="2" text="바코드"/>
                <Cell col="5" rowspan="2" text="자재명"/>
                <Cell col="6" rowspan="2" text="규격"/>
                <Cell col="7" rowspan="2" text="구매단위"/>
                <Cell col="8" colspan="6" text="[기존]단가구성"/>
                <Cell col="14" colspan="9" text="[적용]단가구성"/>
                <Cell col="23" rowspan="2" text="구매계약번호"/>
                <Cell col="24" rowspan="2" text="과/면세"/>
                <Cell col="25" rowspan="2" text="centerCode"/>
                <Cell col="26" rowspan="2" text="upjang"/>
                <Cell col="27" rowspan="2" text="stdDate"/>
                <Cell col="28" rowspan="2" text="contractId"/>
                <Cell col="29" rowspan="2" text="contractNm"/>
                <Cell col="30" rowspan="2" text="stdUpjang"/>
                <Cell col="31" rowspan="2" text="salePriceStart"/>
                <Cell col="32" rowspan="2" text="salePriceEnd"/>
                <Cell row="1"/>
                <Cell row="1" col="1" text="코드" taborder="undefined"/>
                <Cell row="1" col="8" text="단가개시일"/>
                <Cell row="1" col="9" text="단가종료일"/>
                <Cell row="1" col="10" text="매입단가"/>
                <Cell row="1" col="11" text="판매단가"/>
                <Cell row="1" col="12" text="마진"/>
                <Cell row="1" col="13" text="센터"/>
                <Cell row="1" col="14" text="단가개시일"/>
                <Cell row="1" col="15" text="단가종료일"/>
                <Cell row="1" col="16" text="매입단가"/>
                <Cell row="1" col="17" text="전략단가"/>
                <Cell row="1" col="18" text="기획단가"/>
                <Cell row="1" col="19" text="판매단가"/>
                <Cell row="1" col="20" text="이익율"/>
                <Cell row="1" col="21" text="마진"/>
                <Cell row="1" col="22" text="센터"/>
              </Band>
              <Band id="body">
                <Cell text="expr:currow+1"/>
                <Cell col="1" displaytype="text" style="align:center middle;" text="bind:custCd"/>
                <Cell col="2" displaytype="text" style="align:left middle;" text="bind:custNm"/>
                <Cell col="3" displaytype="text" style="align:center middle;" text="bind:itemCode"/>
                <Cell col="4" text="bind:winItemCd"/>
                <Cell col="5" displaytype="text" style="align:left middle;" text="bind:itemName"/>
                <Cell col="6" displaytype="text" style="align:left middle;" text="bind:itemSize"/>
                <Cell col="7" style="align:center middle;" text="bind:itemUnit"/>
                <Cell col="8" displaytype="text" style="align:center middle;" text="bind:contractStart"/>
                <Cell col="9" displaytype="text" style="align:center middle;" text="bind:contractEnd"/>
                <Cell col="10" displaytype="number" style="align:right middle;" text="bind:contractPriceS1" mask="#,##0.#0"/>
                <Cell col="11" displaytype="number" style="align:right middle;" text="bind:salePrice1"/>
                <Cell col="12" displaytype="number" style="align:right;" text="bind:marginRate1" mask="##0.#"/>
                <Cell col="13" displaytype="text" edittype="none" style="align:center middle;" text="expr:centerFlag1=='VC'?'직송':centerFlag1" combodisplay="edit"/>
                <Cell col="14" displaytype="text" style="align:center middle;" text="bind:contractStart2"/>
                <Cell col="15" displaytype="text" style="align:center middle;" text="bind:contractEnd2"/>
                <Cell col="16" displaytype="number" edittype="none" style="align:right middle;background2: ;color:blue;color2:blue;" text="bind:contractPriceS2" mask="#,##0.#0"/>
                <Cell col="17" displaytype="number" edittype="none" text="bind:strategyPrice" mask="#,##0.#0"/>
                <Cell col="18" displaytype="number" edittype="none" text="bind:planningPrice" mask="#,##0.#0"/>
                <Cell col="19" displaytype="number" edittype="masknumber" style="align:right middle;color:blue;color2:blue;" class="grd_WF_Essential" text="bind:salePrice2" editautoselect="true"/>
                <Cell col="20" displaytype="number" text="bind:stdMarginRate" mask="##0.#"/>
                <Cell col="21" displaytype="number" style="align:right middle;" text="bind:marginRate2" mask="##0.#"/>
                <Cell col="22" displaytype="text" edittype="none" style="align:center middle;" text="expr:centerFlag2=='VC'?'직송':centerFlag2"/>
                <Cell col="23" displaytype="text" text="bind:poContractId"/>
                <Cell col="24" text="bind:taxCode"/>
                <Cell col="25" displaytype="text" text="bind:centerCode"/>
                <Cell col="26" displaytype="text" text="bind:upjang"/>
                <Cell col="27" displaytype="text" text="bind:stdDate"/>
                <Cell col="28" displaytype="text" text="bind:contractId"/>
                <Cell col="29" displaytype="text" text="bind:contractNm"/>
                <Cell col="30" displaytype="text" text="bind:stdUpjang"/>
                <Cell col="31" displaytype="text" text="bind:salePriceStart"/>
                <Cell col="32" displaytype="text" text="bind:salePriceEnd"/>
              </Band>
            </Format>
            <Format id="w_income_price_barcode">
              <Columns>
                <Column size="22"/>
                <Column size="63"/>
                <Column size="188"/>
                <Column size="71"/>
                <Column size="100"/>
                <Column size="112"/>
                <Column size="185"/>
                <Column size="56"/>
                <Column size="93"/>
                <Column size="89"/>
                <Column size="89"/>
                <Column size="79"/>
                <Column size="64"/>
                <Column size="125"/>
                <Column size="100"/>
                <Column size="64"/>
                <Column size="87"/>
                <Column size="92"/>
                <Column size="84"/>
                <Column size="80"/>
                <Column size="82"/>
                <Column size="88"/>
                <Column size="82"/>
                <Column size="90"/>
                <Column size="64"/>
                <Column size="125"/>
                <Column size="100"/>
                <Column size="110"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="0"/>
                <Column size="0"/>
              </Columns>
              <Rows>
                <Row size="26" band="head"/>
                <Row size="24" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell class="head_Excel"/>
                <Cell col="1" text="업체" taborder="undefined"/>
                <Cell col="2" rowspan="2" text="업체명"/>
                <Cell col="3" rowspan="2" text="자재코드"/>
                <Cell col="4" rowspan="2" text="바코드"/>
                <Cell col="5" rowspan="2" text="자재명"/>
                <Cell col="6" rowspan="2" text="규격"/>
                <Cell col="7" rowspan="2" text="구매단위"/>
                <Cell col="8" colspan="8" text="[기존]단가구성"/>
                <Cell col="16" colspan="12" text="[적용]단가구성"/>
                <Cell col="28" rowspan="2" text="구매계약번호"/>
                <Cell col="29" rowspan="2" text="과/면세"/>
                <Cell col="30" rowspan="2" text="centerCode"/>
                <Cell col="31" rowspan="2" text="upjang"/>
                <Cell col="32" rowspan="2" text="stdDate"/>
                <Cell col="33" rowspan="2" text="contractId"/>
                <Cell col="34" rowspan="2" text="contractNm"/>
                <Cell col="35" rowspan="2" text="stdUpjang"/>
                <Cell col="36" rowspan="2" text="salePriceStart"/>
                <Cell col="37" rowspan="2" text="salePriceEnd"/>
                <Cell row="1"/>
                <Cell row="1" col="1" text="코드" taborder="undefined"/>
                <Cell row="1" col="8" text="단가개시일"/>
                <Cell row="1" col="9" text="단가종료일"/>
                <Cell row="1" col="10" text="매입단가"/>
                <Cell row="1" col="11" text="판매단가"/>
                <Cell row="1" col="12" text="마진"/>
                <Cell row="1" col="13" text="매입단가(차감반영)"/>
                <Cell row="1" col="14" text="마진(차감반영)"/>
                <Cell row="1" col="15" text="센터"/>
                <Cell row="1" col="16" text="단가개시일"/>
                <Cell row="1" col="17" text="단가종료일"/>
                <Cell row="1" col="18" text="매입단가"/>
                <Cell row="1" col="19" text="전략단가"/>
                <Cell row="1" col="20" text="기획단가"/>
                <Cell row="1" col="21" text="판매단가"/>
                <Cell row="1" col="22" text="이익율"/>
                <Cell row="1" col="23" text="마진"/>
                <Cell row="1" col="24" text="센터"/>
                <Cell row="1" col="25" text="매입단가(차감반영)"/>
                <Cell row="1" col="26" text="마진(차감반영)"/>
                <Cell row="1" col="27" text="이익률(차감반영)"/>
              </Band>
              <Band id="body">
                <Cell text="expr:currow+1"/>
                <Cell col="1" displaytype="text" style="align:center middle;" text="bind:custCd"/>
                <Cell col="2" displaytype="text" style="align:left middle;" text="bind:custNm"/>
                <Cell col="3" displaytype="text" style="align:center middle;" text="bind:itemCode"/>
                <Cell col="4" text="bind:winItemCd"/>
                <Cell col="5" displaytype="text" style="align:left middle;" text="bind:itemName"/>
                <Cell col="6" displaytype="text" style="align:left middle;" text="bind:itemSize"/>
                <Cell col="7" style="align:center middle;" text="bind:itemUnit"/>
                <Cell col="8" displaytype="text" style="align:center middle;" text="bind:contractStart"/>
                <Cell col="9" displaytype="text" style="align:center middle;" text="bind:contractEnd"/>
                <Cell col="10" displaytype="number" style="align:right middle;" text="bind:contractPriceS1" mask="#,##0.#0"/>
                <Cell col="11" displaytype="number" style="align:right middle;" text="bind:salePrice1"/>
                <Cell col="12" displaytype="number" style="align:right;" text="bind:marginRate1" mask="##0.#"/>
                <Cell col="13" displaytype="number" style="align:right;" text="expr:contractPriceS1-incomePrice" mask="#,##0.#0"/>
                <Cell col="14" displaytype="number" style="align:right;" text="expr:salePrice1-(contractPriceS1-incomePrice)" mask="#,##0.#0"/>
                <Cell col="15" displaytype="text" edittype="none" style="align:center middle;" text="expr:centerFlag1=='VC'?'직송':centerFlag1" combodisplay="edit"/>
                <Cell col="16" displaytype="text" style="align:center middle;" text="bind:contractStart2"/>
                <Cell col="17" displaytype="text" style="align:center middle;" text="bind:contractEnd2"/>
                <Cell col="18" displaytype="number" edittype="none" style="align:right middle;background2: ;color:blue;color2:blue;" text="bind:contractPriceS2" mask="#,##0.#0"/>
                <Cell col="19" displaytype="number" edittype="none" text="bind:strategyPrice" mask="#,##0.#0"/>
                <Cell col="20" displaytype="number" edittype="none" text="bind:planningPrice" mask="#,##0.#0"/>
                <Cell col="21" displaytype="number" edittype="masknumber" style="align:right middle;color:blue;color2:blue;" class="grd_WF_Essential" text="bind:salePrice2" editautoselect="true"/>
                <Cell col="22" displaytype="number" text="bind:stdMarginRate" mask="##0.#"/>
                <Cell col="23" displaytype="number" style="align:right middle;" text="bind:marginRate2" mask="##0.#"/>
                <Cell col="24" displaytype="text" edittype="none" style="align:center middle;" text="expr:centerFlag2=='VC'?'직송':centerFlag2"/>
                <Cell col="25" displaytype="number" style="align:right;" text="expr:contractPriceS2-incomePrice" mask="#,##0.#0"/>
                <Cell col="26" displaytype="number" style="align:right;" text="expr:salePrice2-(contractPriceS2-incomePrice)" mask="#,##0.#0"/>
                <Cell col="27" displaytype="number" style="align:right;" text="expr:(salePrice2-(contractPriceS2-incomePrice))/salePrice2" mask="#,##0.#"/>
                <Cell col="28" displaytype="text" text="bind:poContractId"/>
                <Cell col="29" text="bind:taxCode"/>
                <Cell col="30" displaytype="text" text="bind:centerCode"/>
                <Cell col="31" displaytype="text" text="bind:upjang"/>
                <Cell col="32" displaytype="text" text="bind:stdDate"/>
                <Cell col="33" displaytype="text" text="bind:contractId"/>
                <Cell col="34" displaytype="text" text="bind:contractNm"/>
                <Cell col="35" displaytype="text" text="bind:stdUpjang"/>
                <Cell col="36" displaytype="text" text="bind:salePriceStart"/>
                <Cell col="37" displaytype="text" text="bind:salePriceEnd"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Static id="Static16" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 0 97 450 109" anchor="left top"/>
        <Static id="Static21" text="h06" class="Guide01_AreaRed" visible="false" position="absolute 1179 96 1237 102" anchor="top right"/>
        <Static id="Static18" text="h05" class="Guide01_AreaRed" visible="false" position="absolute 1179 123 1237 128" anchor="top right"/>
        <Button id="btn_clsUpload" taborder="9" text="엑셀복사" class="btn_WF_Function" position="absolute 1173 102 1238 122" anchor="top right" onclick="btn_clsUpload_onclick"/>
        <Static id="Static19" text="w02" class="Guide01_AreaRed" visible="false" position="absolute 1171 100 1173 120" anchor="top right"/>
        <Combo id="cbo_centerCode" taborder="0" innerdataset="ds_center" codecolumn="centerCode" datacolumn="centerName" position="absolute 94 40 254 61" anchor="left top" class="cmb_WF_Essential" onitemchanged="cbo_centerCode_onitemchanged" tabstop="true"/>
        <Button id="btn_cust" taborder="6" tabstop="false" class="btn_WF_popSearch" position="absolute 546 66 567 87" onclick="btn_cust_onclick"/>
        <Edit id="edt_cust" taborder="5" onkeydown="edt_cust_onkeydown" position="absolute 351 66 548 87" style=":disabled {cursor:arrowwait;}" userdata="" readonly="true"/>
        <Edit id="edt_contractNm" taborder="7" tabstop="false" position="absolute 693 66 960 87"/>
        <Static id="Static15" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 1021 40 1031 61" anchor="left top"/>
        <ObjCalendar id="cal_date" titletext="캘린더" taborder="4" text="20150101" scrollbars="none" position="absolute 94 66 190 87"/>
        <Static id="Static23" text="계약명" class="sta_WFSA_label" position="absolute 597 66 683 87" anchor="left top"/>
        <Div id="div_margin" taborder="12" position="absolute 1306 186 1526 385" style="background:#f0f5ffff;border:1 solid #808080ff ;" visible="false">
          <Layouts>
            <Layout>
              <Static id="Static41" text="판매장려율 적용" class="sta_WFDA_Label03" position="absolute 10 28 208 55" anchor="left top" style="align:left middle;"/>
              <MaskEdit id="msk_saleRate" taborder="1" value="0" displaynulltext="0" mask="+#,##0.0" maskchar="-" position="absolute 125 31 155 52" anchor="top right" style="align:center middle;" autoselect="true"/>
              <Static id="Static00" text="%" position="absolute 165 34 195 51" anchor="default"/>
              <Button id="btn_sale" taborder="2" text="과세품목 적용" class="btn_WF_Function" position="absolute 10 60 104 80" anchor="default" onclick="div_margin_btn_sale_onclick"/>
              <Button id="btn_noSale" taborder="3" text="면세품목 적용" class="btn_WF_Function" position="absolute 114 60 208 80" anchor="default" onclick="div_margin_btn_noSale_onclick"/>
              <Static id="Static01" text="w10" position="absolute 104 60 114 81" style="background:#f97878ff;" anchor="default" visible="false"/>
              <Static id="Static02" text="w05" position="absolute 2 80 102 85" style="background:#f97878ff;" anchor="default" visible="false"/>
              <Static id="Static03" text="원 단위 일괄 올림조정" class="sta_WFDA_Label03" position="absolute 10 116 208 143" anchor="left top" style="align:left middle;"/>
              <Static id="Static04" text="w05" position="absolute 9 55 109 60" style="background:#f97878ff;" anchor="default" visible="false"/>
              <Button id="btn_allSale" taborder="4" text="과/면세 전체품목 적용" class="btn_WF_Function" position="absolute 10 85 208 105" anchor="default" onclick="div_margin_btn_allSale_onclick"/>
              <Static id="Static05" text="w05" position="absolute 0 106 100 115" style="background:#f97878ff;" anchor="default" visible="false"/>
              <Radio id="rdo_price" taborder="5" columncount="3" rowcount="0" index="1" codecolumn="codecolumn" datacolumn="datacolumn" value="2" position="absolute 10 143 208 171" anchor="default" style="align:center middle;">
                <Dataset id="innerdataset">
                  <ColumnInfo>
                    <Column id="codecolumn" size="256"/>
                    <Column id="datacolumn" size="256"/>
                  </ColumnInfo>
                  <Rows>
                    <Row>
                      <Col id="codecolumn">1</Col>
                      <Col id="datacolumn">1원</Col>
                    </Row>
                    <Row>
                      <Col id="codecolumn">2</Col>
                      <Col id="datacolumn">10원</Col>
                    </Row>
                    <Row>
                      <Col id="codecolumn">3</Col>
                      <Col id="datacolumn">100원</Col>
                    </Row>
                  </Rows>
                </Dataset>
              </Radio>
              <Button id="btn_price" taborder="6" text="판매가 올림 일괄적용" class="btn_WF_Function" position="absolute 10 171 208 191" anchor="default" onclick="div_margin_btn_price_onclick"/>
              <Static id="Static06" text="w05" position="absolute 0 166 100 171" style="background:#f97878ff;" anchor="default" visible="false"/>
              <Static id="Static07" text="w05" position="absolute -1 143 99 148" style="background:#f97878ff;" anchor="default" visible="false"/>
              <Static id="Static08" text="w05" visible="false" position="absolute -1 191 99 196" style="background:#f97878ff;" anchor="default"/>
              <Static id="Static10" text="w10" visible="false" position="absolute 0 28 10 188" style="background:#f97878ff;" anchor="default"/>
              <Static id="Static11" text="w10" visible="false" position="absolute 0 118 10 139" style="background:#f97878ff;" anchor="default"/>
              <Static id="Static09" text="w10" visible="false" position="absolute 208 27 218 187" style="background:#f97878ff;" anchor="default"/>
              <Static id="Static24" text="◎ 장려율 적용여부" position="absolute 0 0 218 28" anchor="top right" style="background:pink;align:center middle;" class="sta_WFDA_Label03"/>
            </Layout>
          </Layouts>
        </Div>
        <Button id="btn_margin" taborder="8" text="장려율 적용여부 ▼" class="btn_WF_Function" position="absolute 1058 102 1171 122" onclick="btn_margin_onclick" anchor="top right"/>
        <Div id="div_excel" taborder="14" position="absolute 1578 278 1927 458" style="background:#f0f5ffff;border:1 solid #808080ff ;" visible="false">
          <Layouts>
            <Layout>
              <Static id="Static00" class="sta_WF_AlertMessege" position="absolute -1 0 347 178" anchor="default"/>
              <Static id="sta_title" text="◎ 엑셀 업로드 작업 체크" class="sta_WF_MessegeTitle" position="absolute 4 0 269 28" anchor="left top"/>
              <Static id="Static01" class="sta_WF_AltMsgInformationImg" position="absolute 12 65 46 99" anchor="left top"/>
              <TextArea id="txt_msg_1" taborder="1" value="엑셀 업로드 자료에 대한 오류사항을 체크중입니다.                                    오류가 없는 경우 저장 확인여부 메시지를 반드시 확인하십시요." wordwrap="both" class="txt_WF_Messege" position="absolute 58 45 325 154" anchor="all"/>
              <TextArea id="txt_msg_2" taborder="2" value="마진일괄 작업중입니다.                             잠시만 기다리세요!" wordwrap="both" class="txt_WF_Messege" position="absolute 58 45 325 154" anchor="all"/>
              <TextArea id="txt_msg_3" taborder="3" value="판매단가를 저장합니다.                자료건수에 따라 작업시간이 오래 걸릴 수 있습니다.                                          &quot;완료&quot; 메시지를 확인하세요!" wordwrap="both" class="txt_WF_Messege" position="absolute 58 45 325 154" anchor="all"/>
              <TextArea id="txt_msg_4" taborder="4" value="판매가 일괄 올림 작업중입니다.                잠시만 기다리세요!" wordwrap="both" class="txt_WF_Messege" position="absolute 58 45 325 154" anchor="all"/>
            </Layout>
          </Layouts>
        </Div>
        <Static id="Static24" text="엑셀 업로드 시 마진은 재계산 됩니다." class="sta_WF_DiscInfo" position="absolute 663 105 917 123" anchor="top right"/>
        <Button id="Button00" taborder="15" text="Button00" position="absolute 459 293 596 319" visible="false"/>
        <ProgressBar id="pbr_status" taborder="16" text="판매단가 생성작업" max="100" min="0" position="absolute 288 100 654 124" anchor="top right" visible="true"/>
        <Button id="btn_errorView" taborder="19" text="오류메시지확인" class="btn_WF_Function" position="absolute 184 101 285 121" anchor="top right" visible="false" onclick="btn_errorView_onclick"/>
        <Button id="btn_itemAdd" taborder="21" text="자재추가" class="btn_WF_Function" position="absolute 992 102 1057 122" anchor="top right" onclick="btn_itemAdd_onclick"/>
        <Static id="Static25" text="w02" class="Guide01_AreaRed" visible="false" position="absolute 1057 104 1059 124" anchor="top right"/>
        <Button id="Button01" taborder="22" text="테스트저장" position="absolute 102 98 182 121" visible="false" onclick="Button01_onclick"/>
        <Button id="btn_gridSearch" taborder="24" text="그리드검색" class="btn_WF_Custom" position="absolute 914 102 991 123" onclick="btn_gridSearch_onclick" anchor="top right"/>
        <Static id="Static26" text="w02" class="Guide01_AreaRed" visible="false" position="absolute 991 104 993 124" anchor="top right"/>
        <Grid id="Grid00" taborder="25" useinputpanel="false" position="absolute 150 315 1059 542" binddataset="ds_excel" visible="false">
          <Formats>
            <Format id="default">
              <Columns>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
              </Columns>
              <Rows>
                <Row band="head" size="24"/>
                <Row band="body" size="24"/>
              </Rows>
              <Band id="head">
                <Cell col="0" disptype="normal" text="rowNum"/>
                <Cell col="1" disptype="normal" text="custCd"/>
                <Cell col="2" disptype="normal" text="custNm"/>
                <Cell col="3" disptype="normal" text="itemCode"/>
                <Cell col="4" disptype="normal" text="itemName"/>
                <Cell col="5" disptype="normal" text="itemSize"/>
                <Cell col="6" disptype="normal" text="itemUnit"/>
                <Cell col="7" disptype="normal" text="contractStart"/>
                <Cell col="8" disptype="normal" text="contractEnd"/>
                <Cell col="9" disptype="normal" text="contractPriceS1"/>
                <Cell col="10" disptype="normal" text="salePrice1"/>
                <Cell col="11" disptype="normal" text="marginRate1"/>
                <Cell col="12" disptype="normal" text="centerFlag1"/>
                <Cell col="13" disptype="normal" text="contractStart2"/>
                <Cell col="14" disptype="normal" text="contractEnd2"/>
                <Cell col="15" disptype="normal" text="contractPriceS2"/>
                <Cell col="16" disptype="normal" text="strategyPrice"/>
                <Cell col="17" disptype="normal" text="planningPrice"/>
                <Cell col="18" disptype="normal" text="salePrice2"/>
                <Cell col="19" disptype="normal" text="stdMarginRate"/>
                <Cell col="20" disptype="normal" text="marginRate2"/>
                <Cell col="21" disptype="normal" text="centerFlag2"/>
              </Band>
              <Band id="body">
                <Cell col="0" disptype="normal" text="bind:rowNum"/>
                <Cell col="1" disptype="normal" text="bind:custCd"/>
                <Cell col="2" disptype="normal" text="bind:custNm"/>
                <Cell col="3" disptype="normal" text="bind:itemCode"/>
                <Cell col="4" disptype="normal" text="bind:itemName"/>
                <Cell col="5" disptype="normal" text="bind:itemSize"/>
                <Cell col="6" disptype="normal" text="bind:itemUnit"/>
                <Cell col="7" disptype="normal" text="bind:contractStart"/>
                <Cell col="8" disptype="normal" text="bind:contractEnd"/>
                <Cell col="9" disptype="normal" text="bind:contractPriceS1"/>
                <Cell col="10" disptype="normal" text="bind:salePrice1"/>
                <Cell col="11" disptype="normal" text="bind:marginRate1"/>
                <Cell col="12" disptype="normal" text="bind:centerFlag1"/>
                <Cell col="13" disptype="normal" text="bind:contractStart2"/>
                <Cell col="14" disptype="normal" text="bind:contractEnd2"/>
                <Cell col="15" disptype="normal" text="bind:contractPriceS2"/>
                <Cell col="16" disptype="normal" text="bind:strategyPrice"/>
                <Cell col="17" disptype="normal" text="bind:planningPrice"/>
                <Cell col="18" disptype="normal" text="bind:salePrice2"/>
                <Cell col="19" disptype="normal" text="bind:stdMarginRate"/>
                <Cell col="20" disptype="normal" text="bind:marginRate2"/>
                <Cell col="21" disptype="normal" text="bind:centerFlag2"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Combo id="cbo_income_price" taborder="27" position="absolute 1147 40 1215 61" index="1" codecolumn="codecolumn" datacolumn="datacolumn" value="N" text="N" onitemchanged="cbo_income_price_onitemchanged">
          <Dataset id="innerdataset">
            <ColumnInfo>
              <Column id="codecolumn" size="256"/>
              <Column id="datacolumn" size="256"/>
            </ColumnInfo>
            <Rows>
              <Row>
                <Col id="codecolumn">Y</Col>
                <Col id="datacolumn">Y</Col>
              </Row>
              <Row>
                <Col id="codecolumn">N</Col>
                <Col id="datacolumn">N</Col>
              </Row>
            </Rows>
          </Dataset>
        </Combo>
        <Static id="Static27" text="차감반영 유무" class="sta_WFSA_label" position="absolute 1051 40 1149 61" anchor="left top"/>
        <Static id="Static30" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 1022 51 1052 72" anchor="left top"/>
        <Static id="Static31" text="W05." visible="false" position="absolute 679 61 1217 66" style="background:#ff000055;align:center middle;"/>
        <Combo id="cbo_winItem_code" taborder="28" value="N" text="N" codecolumn="codecolumn" datacolumn="datacolumn" index="1" position="absolute 1147 66 1215 87" onitemchanged="cbo_winItem_code_onitemchanged">
          <Dataset id="innerdataset">
            <ColumnInfo>
              <Column id="codecolumn" size="256"/>
              <Column id="datacolumn" size="256"/>
            </ColumnInfo>
            <Rows>
              <Row>
                <Col id="codecolumn">Y</Col>
                <Col id="datacolumn">Y</Col>
              </Row>
              <Row>
                <Col id="codecolumn">N</Col>
                <Col id="datacolumn">N</Col>
              </Row>
            </Rows>
          </Dataset>
        </Combo>
        <Static id="Static32" text="바코드 유무" class="sta_WFSA_label" position="absolute 1051 66 1149 87" anchor="left top"/>
      </Layout>
    </Layouts>
    <Bind>
      <BindItem id="item1" compid="edt_upjang" propid="userdata" datasetid="ds_search" columnid="GUBUN"/>
      <BindItem id="item3" compid="edt_upjang" propid="UserData" datasetid="ds_search" columnid="GUBUN"/>
      <BindItem id="item4" compid="cbo_centerCode" propid="value" datasetid="ds_search" columnid="schCenter"/>
      <BindItem id="item0" compid="edt_cust" propid="userdata" datasetid="ds_search" columnid="schCust"/>
      <BindItem id="item2" compid="edt_cust" propid="UserData" datasetid="ds_search" columnid="GUBUN"/>
      <BindItem id="item5" compid="cal_date" propid="text" datasetid="ds_search" columnid="schDate"/>
      <BindItem id="item6" compid="edt_upjang" propid="value" datasetid="ds_search" columnid=""/>
      <BindItem id="item7" compid="edt_contractNm" propid="value" datasetid="ds_search" columnid="schContractNm"/>
      <BindItem id="item8" compid="cbo_contract" propid="value" datasetid="ds_search" columnid="schContractId"/>
    </Bind>
    <Objects>
      <Dataset id="ds_center" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="centerCode" type="STRING" size="256"/>
          <Column id="centerName" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_search" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" oncolumnchanged="ds_search_oncolumnchanged">
        <ColumnInfo>
          <Column id="schCenter" type="STRING" size="256"/>
          <Column id="schDate" type="STRING" size="256"/>
          <Column id="schDate2" type="STRING" size="256"/>
          <Column id="schDateDisp" type="STRING" size="256"/>
          <Column id="schUpjang" type="STRING" size="256"/>
          <Column id="schUpjangNm" type="STRING" size="256"/>
          <Column id="schContractId" type="STRING" size="256"/>
          <Column id="schContractNm" type="STRING" size="256"/>
          <Column id="schCust" type="STRING" size="256"/>
          <Column id="schPdate" type="STRING" size="256"/>
          <Column id="schWinItemCodeYn" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_contract" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="contractId" type="STRING" size="256"/>
          <Column id="contractDisp" type="STRING" size="256"/>
          <Column id="contractNm" type="STRING" size="256"/>
          <Column id="contractStart" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_list" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" oncolumnchanged="ds_list_oncolumnchanged" cancolumnchange="ds_list_cancolumnchange">
        <ColumnInfo>
          <Column id="rowNum" type="STRING" size="256"/>
          <Column id="custCd" type="STRING" size="256"/>
          <Column id="custNm" type="STRING" size="256"/>
          <Column id="itemCode" type="STRING" size="256"/>
          <Column id="itemName" type="STRING" size="256"/>
          <Column id="itemSize" type="STRING" size="256"/>
          <Column id="itemUnit" type="STRING" size="256"/>
          <Column id="contractStart" type="STRING" size="256"/>
          <Column id="contractEnd" type="STRING" size="256"/>
          <Column id="contractPriceS1" type="STRING" size="256"/>
          <Column id="salePrice1" type="STRING" size="256"/>
          <Column id="marginRate1" type="STRING" size="256"/>
          <Column id="centerFlag1" type="STRING" size="256"/>
          <Column id="contractStart2" type="STRING" size="256"/>
          <Column id="contractEnd2" type="STRING" size="256"/>
          <Column id="contractPriceS2" type="STRING" size="256"/>
          <Column id="strategyPrice" type="STRING" size="256"/>
          <Column id="planningPrice" type="STRING" size="256"/>
          <Column id="salePrice2" type="BIGDECIMAL" size="256"/>
          <Column id="stdMarginRate" type="STRING" size="256"/>
          <Column id="marginRate2" type="BIGDECIMAL" size="256"/>
          <Column id="centerFlag2" type="STRING" size="256"/>
          <Column id="strategyRate" type="STRING" size="256"/>
          <Column id="planningRate" type="STRING" size="256"/>
          <Column id="poContractId" type="STRING" size="256"/>
          <Column id="taxCode" type="STRING" size="256"/>
          <Column id="centerCode" type="STRING" size="256"/>
          <Column id="upjang" type="STRING" size="256"/>
          <Column id="stdDate" type="STRING" size="256"/>
          <Column id="stdDate2" type="STRING" size="256"/>
          <Column id="contractId" type="STRING" size="256"/>
          <Column id="contractNm" type="STRING" size="256"/>
          <Column id="stdUpjang" type="STRING" size="256"/>
          <Column id="salePriceStart" type="STRING" size="256"/>
          <Column id="salePriceEnd" type="STRING" size="256"/>
          <Column id="stdPdate" type="STRING" size="256"/>
          <Column id="vdSn" type="STRING" size="256"/>
          <Column id="applySd" type="STRING" size="256"/>
          <Column id="fixedPrice" type="BIGDECIMAL" size="256"/>
          <Column id="upjangGrp" type="STRING" size="256"/>
          <Column id="incomePrice" type="STRING" size="256"/>
          <Column id="winItemCd" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_searchValid" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="schCenter" type="STRING" size="256"/>
          <Column id="schUpjang" type="STRING" size="256"/>
          <Column id="schContractId" type="STRING" size="256"/>
          <Column id="schContractNm" type="STRING" size="256"/>
          <Column id="schDate" type="STRING" size="256"/>
          <Column id="schCust" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="schCenter">title:센터,required:true,focus:cbo_centerCode</Col>
            <Col id="schUpjang">title:고객사,required:true,focus:edt_upjang</Col>
            <Col id="schContractId">title:단가계약번호,required:true,focus:cbo_contract</Col>
            <Col id="schDate">title:단가개시일,required:true,date;true,focus:cal_date</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_searchSave" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="schCenter" type="STRING" size="256"/>
          <Column id="schUpjang" type="STRING" size="256"/>
          <Column id="schContractId" type="STRING" size="256"/>
          <Column id="schContractNm" type="STRING" size="256"/>
          <Column id="schDate" type="STRING" size="256"/>
          <Column id="schCust" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="schCenter">title:센터,required:true,focus:cbo_centerCode</Col>
            <Col id="schUpjang">title:고객사,required:true,focus:edt_upjang</Col>
            <Col id="schContractId">title:단가계약번호,required:true,focus:cbo_contract</Col>
            <Col id="schContractNm">title:계약명,required:true,focus:edt_contractNm</Col>
            <Col id="schDate">title:단가개시일,required:true,date;true,focus:cal_date</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_searchItem" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="schCenter" type="STRING" size="256"/>
          <Column id="schDate" type="STRING" size="256"/>
          <Column id="schDate2" type="STRING" size="256"/>
          <Column id="schUpjang" type="STRING" size="256"/>
          <Column id="schCust" type="STRING" size="256"/>
          <Column id="schItemCode" type="STRING" size="256"/>
          <Column id="schContractStart" type="STRING" size="256"/>
          <Column id="schPdate" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_item" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="rowNum" type="STRING" size="256"/>
          <Column id="custCd" type="STRING" size="256"/>
          <Column id="custNm" type="STRING" size="256"/>
          <Column id="itemCode" type="STRING" size="256"/>
          <Column id="itemName" type="STRING" size="256"/>
          <Column id="itemSize" type="STRING" size="256"/>
          <Column id="itemUnit" type="STRING" size="256"/>
          <Column id="contractStart" type="STRING" size="256"/>
          <Column id="contractEnd" type="STRING" size="256"/>
          <Column id="contractPriceS1" type="STRING" size="256"/>
          <Column id="salePrice1" type="STRING" size="256"/>
          <Column id="marginRate1" type="STRING" size="256"/>
          <Column id="centerFlag1" type="STRING" size="256"/>
          <Column id="contractPrice2" type="STRING" size="256"/>
          <Column id="contractStart2" type="STRING" size="256"/>
          <Column id="contractEnd2" type="STRING" size="256"/>
          <Column id="contractPriceS2" type="STRING" size="256"/>
          <Column id="negoPrice2" type="STRING" size="256"/>
          <Column id="strategyPrice" type="STRING" size="256"/>
          <Column id="planningPrice" type="STRING" size="256"/>
          <Column id="salePrice2" type="STRING" size="256"/>
          <Column id="marginRate2" type="STRING" size="256"/>
          <Column id="centerFlag2" type="STRING" size="256"/>
          <Column id="strategyRate" type="STRING" size="256"/>
          <Column id="planningRate" type="STRING" size="256"/>
          <Column id="poContractId" type="STRING" size="256"/>
          <Column id="taxCode" type="STRING" size="256"/>
          <Column id="centerCode" type="STRING" size="256"/>
          <Column id="upjang" type="STRING" size="256"/>
          <Column id="stdDate" type="STRING" size="256"/>
          <Column id="stdDate2" type="STRING" size="256"/>
          <Column id="contractId" type="STRING" size="256"/>
          <Column id="contractNm" type="STRING" size="256"/>
          <Column id="stdUpjang" type="STRING" size="256"/>
          <Column id="salePriceStart" type="STRING" size="256"/>
          <Column id="salePriceEnd" type="STRING" size="256"/>
          <Column id="stdPdate" type="STRING" size="256"/>
          <Column id="vdSn" type="STRING" size="256"/>
          <Column id="applySd" type="STRING" size="256"/>
          <Column id="fixedPrice" type="BIGDECIMAL" size="256"/>
          <Column id="upjangGrp" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_deleteItem" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="centerCode" type="STRING" size="256"/>
          <Column id="upjang" type="STRING" size="256"/>
          <Column id="itemCode" type="STRING" size="256"/>
          <Column id="contractStart2" type="STRING" size="256"/>
          <Column id="stdDate" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_listCopy" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="rowNum" type="STRING" size="256"/>
          <Column id="custCd" type="STRING" size="256"/>
          <Column id="custNm" type="STRING" size="256"/>
          <Column id="itemCode" type="STRING" size="256"/>
          <Column id="itemName" type="STRING" size="256"/>
          <Column id="itemSize" type="STRING" size="256"/>
          <Column id="itemUnit" type="STRING" size="256"/>
          <Column id="contractStart" type="STRING" size="256"/>
          <Column id="contractEnd" type="STRING" size="256"/>
          <Column id="contractPriceS1" type="STRING" size="256"/>
          <Column id="salePrice1" type="STRING" size="256"/>
          <Column id="marginRate1" type="STRING" size="256"/>
          <Column id="centerFlag1" type="STRING" size="256"/>
          <Column id="contractStart2" type="STRING" size="256"/>
          <Column id="contractEnd2" type="STRING" size="256"/>
          <Column id="contractPriceS2" type="STRING" size="256"/>
          <Column id="strategyPrice" type="STRING" size="256"/>
          <Column id="planningPrice" type="STRING" size="256"/>
          <Column id="salePrice2" type="BIGDECIMAL" size="256"/>
          <Column id="marginRate2" type="BIGDECIMAL" size="256"/>
          <Column id="centerFlag2" type="STRING" size="256"/>
          <Column id="strategyRate" type="STRING" size="256"/>
          <Column id="planningRate" type="STRING" size="256"/>
          <Column id="poContractId" type="STRING" size="256"/>
          <Column id="taxCode" type="STRING" size="256"/>
          <Column id="centerCode" type="STRING" size="256"/>
          <Column id="upjang" type="STRING" size="256"/>
          <Column id="stdDate" type="STRING" size="256"/>
          <Column id="stdDate2" type="STRING" size="256"/>
          <Column id="contractId" type="STRING" size="256"/>
          <Column id="contractNm" type="STRING" size="256"/>
          <Column id="stdUpjang" type="STRING" size="256"/>
          <Column id="salePriceStart" type="STRING" size="256"/>
          <Column id="salePriceEnd" type="STRING" size="256"/>
          <Column id="stdPdate" type="STRING" size="256"/>
          <Column id="vdSn" type="STRING" size="256"/>
          <Column id="applySd" type="STRING" size="256"/>
          <Column id="fixedPrice" type="BIGDECIMAL" size="256"/>
          <Column id="upjangGrp" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_excel" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="rowNum" type="STRING" size="256"/>
          <Column id="custCd" type="STRING" size="256"/>
          <Column id="custNm" type="STRING" size="256"/>
          <Column id="itemCode" type="STRING" size="256"/>
          <Column id="itemName" type="STRING" size="256"/>
          <Column id="itemSize" type="STRING" size="256"/>
          <Column id="itemUnit" type="STRING" size="256"/>
          <Column id="contractStart" type="STRING" size="256"/>
          <Column id="contractEnd" type="STRING" size="256"/>
          <Column id="contractPriceS1" type="STRING" size="256"/>
          <Column id="salePrice1" type="STRING" size="256"/>
          <Column id="marginRate1" type="STRING" size="256"/>
          <Column id="centerFlag1" type="STRING" size="256"/>
          <Column id="contractStart2" type="STRING" size="256"/>
          <Column id="contractEnd2" type="STRING" size="256"/>
          <Column id="contractPriceS2" type="STRING" size="256"/>
          <Column id="strategyPrice" type="STRING" size="256"/>
          <Column id="planningPrice" type="STRING" size="256"/>
          <Column id="salePrice2" type="BIGDECIMAL" size="256"/>
          <Column id="stdMarginRate" type="STRING" size="256"/>
          <Column id="marginRate2" type="BIGDECIMAL" size="256"/>
          <Column id="centerFlag2" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_yn" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="code" type="STRING" size="256"/>
          <Column id="name" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="code">Y</Col>
            <Col id="name">Y</Col>
          </Row>
          <Row>
            <Col id="code">N</Col>
            <Col id="name">N</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_save" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="rowNum" type="STRING" size="256"/>
          <Column id="custCd" type="STRING" size="256"/>
          <Column id="custNm" type="STRING" size="256"/>
          <Column id="itemCode" type="STRING" size="256"/>
          <Column id="itemName" type="STRING" size="256"/>
          <Column id="itemSize" type="STRING" size="256"/>
          <Column id="itemUnit" type="STRING" size="256"/>
          <Column id="contractStart" type="STRING" size="256"/>
          <Column id="contractEnd" type="STRING" size="256"/>
          <Column id="contractPriceS1" type="STRING" size="256"/>
          <Column id="salePrice1" type="STRING" size="256"/>
          <Column id="marginRate1" type="STRING" size="256"/>
          <Column id="centerFlag1" type="STRING" size="256"/>
          <Column id="contractStart2" type="STRING" size="256"/>
          <Column id="contractEnd2" type="STRING" size="256"/>
          <Column id="contractPriceS2" type="STRING" size="256"/>
          <Column id="strategyPrice" type="STRING" size="256"/>
          <Column id="planningPrice" type="STRING" size="256"/>
          <Column id="salePrice2" type="BIGDECIMAL" size="256"/>
          <Column id="stdMarginRate" type="STRING" size="256"/>
          <Column id="marginRate2" type="BIGDECIMAL" size="256"/>
          <Column id="centerFlag2" type="STRING" size="256"/>
          <Column id="strategyRate" type="STRING" size="256"/>
          <Column id="planningRate" type="STRING" size="256"/>
          <Column id="poContractId" type="STRING" size="256"/>
          <Column id="taxCode" type="STRING" size="256"/>
          <Column id="centerCode" type="STRING" size="256"/>
          <Column id="upjang" type="STRING" size="256"/>
          <Column id="stdDate" type="STRING" size="256"/>
          <Column id="stdDate2" type="STRING" size="256"/>
          <Column id="contractId" type="STRING" size="256"/>
          <Column id="contractNm" type="STRING" size="256"/>
          <Column id="stdUpjang" type="STRING" size="256"/>
          <Column id="salePriceStart" type="STRING" size="256"/>
          <Column id="salePriceEnd" type="STRING" size="256"/>
          <Column id="stdPdate" type="STRING" size="256"/>
          <Column id="vdSn" type="STRING" size="256"/>
          <Column id="applySd" type="STRING" size="256"/>
          <Column id="fixedPrice" type="BIGDECIMAL" size="256"/>
          <Column id="upjangGrp" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_saveRow" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="rowNum" type="STRING" size="256"/>
          <Column id="custCd" type="STRING" size="256"/>
          <Column id="custNm" type="STRING" size="256"/>
          <Column id="itemCode" type="STRING" size="256"/>
          <Column id="itemName" type="STRING" size="256"/>
          <Column id="itemSize" type="STRING" size="256"/>
          <Column id="itemUnit" type="STRING" size="256"/>
          <Column id="contractStart" type="STRING" size="256"/>
          <Column id="contractEnd" type="STRING" size="256"/>
          <Column id="contractPriceS1" type="STRING" size="256"/>
          <Column id="salePrice1" type="STRING" size="256"/>
          <Column id="marginRate1" type="STRING" size="256"/>
          <Column id="centerFlag1" type="STRING" size="256"/>
          <Column id="contractStart2" type="STRING" size="256"/>
          <Column id="contractEnd2" type="STRING" size="256"/>
          <Column id="contractPriceS2" type="STRING" size="256"/>
          <Column id="strategyPrice" type="STRING" size="256"/>
          <Column id="planningPrice" type="STRING" size="256"/>
          <Column id="salePrice2" type="BIGDECIMAL" size="256"/>
          <Column id="stdMarginRate" type="STRING" size="256"/>
          <Column id="marginRate2" type="BIGDECIMAL" size="256"/>
          <Column id="centerFlag2" type="STRING" size="256"/>
          <Column id="strategyRate" type="STRING" size="256"/>
          <Column id="planningRate" type="STRING" size="256"/>
          <Column id="poContractId" type="STRING" size="256"/>
          <Column id="taxCode" type="STRING" size="256"/>
          <Column id="centerCode" type="STRING" size="256"/>
          <Column id="upjang" type="STRING" size="256"/>
          <Column id="stdDate" type="STRING" size="256"/>
          <Column id="stdDate2" type="STRING" size="256"/>
          <Column id="contractId" type="STRING" size="256"/>
          <Column id="contractNm" type="STRING" size="256"/>
          <Column id="stdUpjang" type="STRING" size="256"/>
          <Column id="salePriceStart" type="STRING" size="256"/>
          <Column id="salePriceEnd" type="STRING" size="256"/>
          <Column id="stdPdate" type="STRING" size="256"/>
          <Column id="vdSn" type="STRING" size="256"/>
          <Column id="applySd" type="STRING" size="256"/>
          <Column id="fixedPrice" type="BIGDECIMAL" size="256"/>
          <Column id="upjangGrp" type="STRING" size="256"/>
          <Column id="isLast" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_excelBak" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="rowNum" type="STRING" size="256"/>
          <Column id="custCd" type="STRING" size="256"/>
          <Column id="custNm" type="STRING" size="256"/>
          <Column id="itemCode" type="STRING" size="256"/>
          <Column id="itemName" type="STRING" size="256"/>
          <Column id="itemSize" type="STRING" size="256"/>
          <Column id="itemUnit" type="STRING" size="256"/>
          <Column id="contractStart" type="STRING" size="256"/>
          <Column id="contractEnd" type="STRING" size="256"/>
          <Column id="contractPriceS1" type="STRING" size="256"/>
          <Column id="salePrice1" type="STRING" size="256"/>
          <Column id="marginRate1" type="STRING" size="256"/>
          <Column id="centerFlag1" type="STRING" size="256"/>
          <Column id="contractStart2" type="STRING" size="256"/>
          <Column id="contractEnd2" type="STRING" size="256"/>
          <Column id="contractPriceS2" type="STRING" size="256"/>
          <Column id="strategyPrice" type="STRING" size="256"/>
          <Column id="planningPrice" type="STRING" size="256"/>
          <Column id="salePrice2" type="BIGDECIMAL" size="256"/>
          <Column id="stdMarginRate" type="STRING" size="256"/>
          <Column id="marginRate2" type="BIGDECIMAL" size="256"/>
          <Column id="centerFlag2" type="STRING" size="256"/>
          <Column id="strategyRate" type="STRING" size="256"/>
          <Column id="planningRate" type="STRING" size="256"/>
          <Column id="poContractId" type="STRING" size="256"/>
          <Column id="taxCode" type="STRING" size="256"/>
          <Column id="centerCode" type="STRING" size="256"/>
          <Column id="upjang" type="STRING" size="256"/>
          <Column id="stdDate" type="STRING" size="256"/>
          <Column id="stdDate2" type="STRING" size="256"/>
          <Column id="contractId" type="STRING" size="256"/>
          <Column id="contractNm" type="STRING" size="256"/>
          <Column id="stdUpjang" type="STRING" size="256"/>
          <Column id="salePriceStart" type="STRING" size="256"/>
          <Column id="salePriceEnd" type="STRING" size="256"/>
          <Column id="stdPdate" type="STRING" size="256"/>
          <Column id="vdSn" type="STRING" size="256"/>
          <Column id="applySd" type="STRING" size="256"/>
          <Column id="fixedPrice" type="BIGDECIMAL" size="256"/>
          <Column id="upjangGrp" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Script type="xscript4.0"><![CDATA[/*
  화 면 명 : FoodMaterialsSalePrice
  파 일 명 : FoodMaterialsSalePrice.xfdl
  기    능 : 식재영업 / 기준관리 / 단가관리 / 식자재영업 판매단가

    수정일    수정자                  수정내용
  ----------   -------  --------------------------------------------------
  2015.04.14   최성연   최초 생성
  2015.09.23   최성연   화면UI 변경
      
  1) 공통 버튼 정의
  - 조회, 삭제, 저장, 닫기, 도움말 버튼 활성화
  
  2) 엑셀 업로드 시 판매단가 기준으로 마진은 자동계산
  
*/
/************************************************************************************************
 * 공통 라이브러리 INCLUDE 영역 (필수)
************************************************************************************************/
include "lib::lib_com.xjs";


/************************************************************************************************
 * FORM 변수 선언 영역 (필수)
************************************************************************************************/
var fv_processCnt = 0;			//처리건수
var fv_poCnt = 0;				//PO건수(조회여부 CHECK)	
var fv_objColInfo;				//데이터셋 컬럼정보
var fv_Key = "";				//저장 시 Key값 SET(계약번호)
var fv_excelFlag = false;		//엑셀업로드 후 갱신여부 CHECK
var fv_saveFlag = "";			//신규저장 시 CallBack 처리 구분
var fv_editFlag = "";


// 저장 관련 변수
var fv_errorFlag;				//에러발생 여부(Y/N)
var fv_errorMsg;				//에러발생 메시지
var fv_saveRowCnt;				//저장대상 Row Count
var fv_saveRow;					//저장대상 Row Index
var fv_row;						//저장대상 ROW ID 
var fv_ret;						//트랜잭션 리턴 값 (E:오류)
var fv_retMsg;					//트랜잭션 리턴 메시지(오류시)

/************************************************************************************************
 * FORM EVENT 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : Form Load (필수)
 *---------------------------------------------------------------------------------------------*/
function form_onload(obj:Form, e:LoadEventInfo)
{	
	// Form Load 시 공통 기능 처리(obj:Form, bCreateEvent:이벤트 생성 여부)
	gfn_formOnLoad(this);
	
	// 초기값 셋팅
	fn_init();
	
	// 임시 set
	if (g_EmpNo == "200702250") Button01.visible = true;
	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 초기값 셋팅
 *---------------------------------------------------------------------------------------------*/
function fn_init()
{
	// 업데이트여부를 체크할 DataSet, 여러개 있을 경우 ;로 구분
	v_ds_check = "ds_list";

	// 센터정보 COMBO 초기화 : 조건
	fn_searchCenter();
	
	
	//조회조건을 초기화한다.
	var nRow= ds_search.addRow();
	ds_search.setColumn(nRow, "schCenter", "");								// 센터
	ds_search.setColumn(nRow, "schDate", gfn_today());						// 일자

	// 일자 Obj SET
	cal_date.fn_initMonthCal(this, "", "", ds_search, "schDate", "Y");		// 판매단가개시일 SET

	// 현재일자 기준으로 단가종료일 SET
	fn_searchDateSet();	
	
	// 적용_식재매입단가/네고단가/구매계약번호/과면세 항목 표시 숨기기
	this.grd_list.setFormatColProperty(27,"size",0);
	this.grd_list.setFormatColProperty(28,"size",0);
}

/************************************************************************************************
 * 공통기능 FUNCTION 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 조회 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_search()
{
	var v_Pdate = "";						// 전략이익율 관련 날짜 SET

	// 조회시 Validation Check
	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;

	// 전략이익율 기준일자 SET
	if (cal_date.text.substr(6,2) > "15") v_Pdate = cal_date.text.substr(0,4) + cal_date.text.substr(4,2) + "16";
	else v_Pdate = cal_date.text.substr(0,4) + cal_date.text.substr(4,2) + "01";

	// 조건 SET
	var nRow = ds_search.rowposition;
	ds_search.setColumn(nRow, "schContractId", cbo_contract.value);	// 계약번호
	ds_search.setColumn(nRow, "schCust", edt_cust.userdata);		// 업체코드
	ds_search.setColumn(nRow, "schPdate", v_Pdate);					// 전략이익율 일자 SET
	//trace(edt_cust.userdata);
	ds_search.setColumn(nRow, "schCust",	edt_cust.userdata);

	div_excel.visible = false;

	// 에러메시지 버튼 숨기기
	fn_errorView(false);
	
	// Progress Bar 초기화
	fn_processBarInit();
	

    // Grid sort 표시 초기화(필수)
    gfn_clearSortMark(grd_list);

   	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
	fv_objColInfo = gfn_getDatasetInfo (ds_list);
    
    var strSvcID    = "search";
	var strURL      = "fm/fms/foodMaterialsSalePrice/selectList.xdo";
    var strInDs     = "ds_search=ds_search:A";
    var strOutDs    = "ds_list=ds_list";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 신규 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 * 자재추가 팝업
 *---------------------------------------------------------------------------------------------*/
function fn_insert()
{	

}

/*----------------------------------------------------------------------------------------------
 * 설명      : 삭제 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 * 멀티 삭제 가능하게 처리
 *---------------------------------------------------------------------------------------------*/
function fn_delete()
{
	var nRowCnt = ds_list.getRowCount();	// DataSet Count
	var iCnt = 0;
	var jCnt = 0;

	// 삭제할 자료 CHECK
	for (var i = 0 ; i < nRowCnt ; i++)
	{
 		// Dataset이 선택된 것만 적용
 		if (ds_list.getSelect(i))	
 		{
 			iCnt++;
 			if (ds_list.getRowType(i) <> Dataset.ROWTYPE_INSERT) {
				jCnt++;
 			}
 			
 		}
	}
	// 삭재 COUNT CHECK
	if(iCnt == 0)
	{
		sMsg = "삭제할 단가정보가 없습니다.";
		gfn_alert(sMsg, "", "A");
		return;
	}	
	
	

	// 판매단가 목록에서 삭제 : 선택한 행의 자재를 바로 삭제
	var v_contractId = ds_search.getColumn(ds_search.rowposition, "schContractId");		// 계약번호

	var sMsg = "선택한 자재를 삭제합니다.\n계속 진행 하시겠습니까?\n\n";
	if (jCnt > 0) {
		sMsg = sMsg + " - 기존 자재에 대한 삭제 후 자료를 재조회 합니다.\n";
	}
		sMsg = sMsg + " - 대상건수   : " + iCnt + "\n";

	var rtVal = gfn_confirm(sMsg, "", "C");	// 선택된 자료를 삭제 하시겠습니까?

	if (rtVal == false) return;
	

	// 신규생성일 경우에는 해당 ROW를 바로 삭제 : Transaction 처리 않하고
	if (v_contractId=="NEW") {
	
// 		// 삭제할 대상 dataset 선택
// 		for (var i = 0 ; i < nRowCnt ; i++)
// 		{
// 			// Dataset이 선택된 것만 적용
// 			if (ds_list.getSelect(i))	
// 			{
// 				ds_list.deleteRow(i);
// 			}
// 	
// 		}
		// 선택되어진 Dataset에 대한 자료 일괄 삭제
		var nSucc = ds_list.deleteSelectedRows();
		
		//trace("nSucc : " + nSucc);

		gfn_alert("msg.delete.success");	// 삭제 되었습니다.
		return;
	}

	// 삭제용 dataset Clear
	ds_deleteItem.clearData();
	
	iCnt = 0;
	// 삭제할 대상 dataset 생성 : TR 대상
	for (var i = 0 ; i < nRowCnt ; i++)
	{
		// Dataset이 선택된 것만 적용
			if (ds_list.getSelect(i))	
			{
				//trace("delete : " + i);
				if (ds_list.getRowType(i) == Dataset.ROWTYPE_INSERT) {
					//ds_list.deleteRow(i);
					// 실제 TR 을 수행하게 되면 삭제하고자 하는 (추가)행은 조회 시 반영 안됨, 별도의 삭제를 할 필요가 없음
				} else {
					// 기존 자료인 경우
					iCnt++;
					ds_deleteItem.addRow();
					
					// 삭제용 dataset SET
					ds_deleteItem.setColumn(ds_deleteItem.rowposition, "centerCode", ds_list.getColumn(i, "centerCode"));			// 센터코드
					ds_deleteItem.setColumn(ds_deleteItem.rowposition, "upjang", ds_list.getColumn(i, "upjang"));					// 업장
					ds_deleteItem.setColumn(ds_deleteItem.rowposition, "itemCode", ds_list.getColumn(i, "itemCode"));				// 자재코드
					var v_contractStart2 = ds_list.getColumn(i, "contractStart2");
					v_contractStart2 = v_contractStart2.replace("-","");
					ds_deleteItem.setColumn(ds_deleteItem.rowposition, "contractStart2", v_contractStart2);								// 계약시작일(적용_계약시작일)
					ds_deleteItem.setColumn(ds_deleteItem.rowposition, "stdDate", ds_list.getColumn(i, "stdDate"));					// 단가개시일(삭제 후 일자 Update)
				}
			}
	}
	
	//trace("iCnt : " + iCnt);
	
	if (iCnt > 0) {
		// Transaction 바로 호출해서 삭제 처리 함 
		var strSvcID    = "deleteItem";
		var strURL      = "fm/fms/foodMaterialsSalePrice/deleteItem.xdo";
		var strInDs     = "ds_deleteItem=ds_deleteItem:A";
		var strOutDs    = "";
		var strArg      = "";
		var strCallback = "fn_callBack";
		var bAsync      = true;
		
		gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
	} else {
		// 신규 추가행만 존재하는 경우
		var nSucc = ds_list.deleteSelectedRows();
		
		//trace("nSucc : " + nSucc);

		gfn_alert("msg.delete.success");	// 삭제 되었습니다.
		return;
	}
}



/*----------------------------------------------------------------------------------------------
 * 설명      : 삭제 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_delete_old()
{
	// 판매단가 목록에서 삭제 : 선택한 행의 자재를 바로 삭제
	var nRow = ds_list.rowposition;
	var v_contractId = ds_search.getColumn(ds_search.rowposition, "schContractId");		// 계약번호
	
	if(ds_list.rowposition == -1) 
	{
		gfn_alert("msg.err.grid.noselect", "삭제할 row");	// 선택된 항목이 없습니다.
		return;
	}
	
	var sCustNm = ds_list.getColumn(nRow, "custNm");
	var sItemCode = ds_list.getColumn(nRow, "itemCode");
	var sItemName = ds_list.getColumn(nRow, "itemName");
	
	var sMsg = "선택한 자재를 삭제합니다.\n계속 진행 하시겠습니까?\n\n";
		sMsg = sMsg + " - 업체명   : " + sCustNm + "\n";
		sMsg = sMsg + " - 자재코드 : " + sItemCode + "\n";
		sMsg = sMsg + " - 자재명   : " + sItemName + "\n";


	var rtVal = gfn_confirm(sMsg, "", "C");	// 선택된 자료를 삭제 하시겠습니까?

	if (rtVal == true) 
	{	
		// 신규생성일 경우에는 해당 ROW를 삭제
		if (v_contractId=="NEW") {
			var bSucc = ds_list.deleteRow(nRow);
			if (bSucc) gfn_alert("msg.delete.success");	// 삭제 되었습니다.
			else gfn_alert("msg.err.grid.noselect");	// 선택된 항목이 없습니다.	
			return;
		}
	
	
		// 삭제용 dataset Clear
		ds_deleteItem.clearData();
		
		// 삭제용 dataset SET
		ds_deleteItem.addRow();
		ds_deleteItem.setColumn(ds_deleteItem.rowposition, "centerCode", ds_list.getColumn(nRow, "centerCode"));			// 센터코드
		ds_deleteItem.setColumn(ds_deleteItem.rowposition, "upjang", ds_list.getColumn(nRow, "upjang"));					// 업장
		ds_deleteItem.setColumn(ds_deleteItem.rowposition, "itemCode", ds_list.getColumn(nRow, "itemCode"));				// 자재코드
		var v_contractStart2 = ds_list.getColumn(nRow, "contractStart2");
		v_contractStart2 = v_contractStart2.replace("-","");
		ds_deleteItem.setColumn(ds_deleteItem.rowposition, "contractStart2", v_contractStart2);								// 계약시작일(적용_계약시작일)
		ds_deleteItem.setColumn(ds_deleteItem.rowposition, "stdDate", ds_list.getColumn(nRow, "stdDate"));					// 단가개시일(삭제 후 일자 Update)
		

		
		// Transaction 바로 호출해서 삭제 처리 함 
		var strSvcID    = "deleteItem";
		var strURL      = "fm/fms/foodMaterialsSalePrice/deleteItem.xdo";
		var strInDs     = "ds_deleteItem=ds_deleteItem:A";
		var strOutDs    = "";
		var strArg      = "";
		var strCallback = "fn_callBack";
		var bAsync      = true;
		
		gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 저장 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 * 1 Transaction
 *---------------------------------------------------------------------------------------------*/
function fn_save()
{
	var nRowCnt = ds_list.getRowCount();	// DataSet Count
	var nRow= ds_search.rowposition;
	var sMsg = "";
	var iCnt = 0;
	
	// 저장할 자료 여부 CHECK
	if(nRowCnt == 0) 
	{
		gfn_alert("msg.save.nodata", "저장할 데이터");	// 저장할 데이터가 없습니다.
		return;
	}

	var v_contractId = ds_search.getColumn(nRow, "schContractId");

	if (v_contractId != "NEW") {
		// v_ds_check 미사용시 변경사항 체크 : 엑셀업로드 시에는 CHECK X
		if (gfn_dsIsUpdated(ds_list) == false && fv_excelFlag == false)
		{
			gfn_alert("msg.save.nochange");	// 변경된 내역이 없습니다.
			return;
		}
	}
 	
	// 저장 시 조건 Check	: 조회조건 기준으로 CHECK
	if (gfn_validCheck(ds_search, ds_searchSave, true) == false) return;
 	

	// 저장 시 Validation Check : 중복 CHECK	
	if( !fn_saveCheck() ) 
	{
		return;
	}


	// 2015-12-14 엑셀 업로드 시 체크 제외
// 	if (fv_excelFlag == true) {
// 		sMsg = "엑셀 업로드 시 자료에 대한 중복여부 및 필수입력 사항을 체크합니다.\n\n";
// 	    sMsg = sMsg + "계속 진행 하시겠습니까?\n\n";
// 		if (!gfn_confirm(sMsg, "", "C")) return;
// 
// 		fn_processInit("excel");
// 
// 		// 저장 시 Validation Check : 중복 CHECK	
// 		if( !fn_saveItemChk() ) 
// 		{
// 			fn_processInit("close");
// 			return;
// 		} 
// 		fn_processInit("close");
// 	}	
	
	// 전략이익율 기준일자 SET
	var v_Pdate = "";
	if (cal_date.text.substr(6,2) > "15") v_Pdate = cal_date.text.substr(0,4) + cal_date.text.substr(4,2) + "16";
	else v_Pdate = cal_date.text.substr(0,4) + cal_date.text.substr(4,2) + "01";
	
	
	var sDate = cal_date.text.substr(0,4) + "-" + cal_date.text.substr(4,2) + "-" + cal_date.text.substr(6,2);

	if (ds_search.getColumn(nRow, "schContractId")=="NEW") {
		fv_saveFlag = "I";
		sMsg = "판매단가를 저장합니다.\n계속 진행 하시겠습니까?\n\n";
		sMsg = sMsg + " - 단가개시일 : " + sDate + "\n";
	} else {
		fv_saveFlag = "U";
		sMsg = "현 단가계약 수정작업은 수정 전 단가계약 금액으로\n";
		sMsg = sMsg + "발주된 자재에는 반영되지 않습니다.\n";
		sMsg = sMsg + "수정하시겠습니까?\n\n";
	}

	if (!gfn_confirm(sMsg, "", "C")) return;
	
 	// 저장 시 Progress Bar 표시 창 
	fn_processInit("save");
 	
	// 2015-12-14 로직 추가
	/////////////////////////////////////////////////////////////////////////////////////////////
	// 저장할 Dataset Clear
	ds_save.clearData();

	// 저장 대상 개수 
	for (var i = 0 ; i < nRowCnt ; i++)
	{
		// 신규일경우 - 전체, 그외 변경분만 처리
		if (fv_saveFlag == "U") {
			// 신규 및 수정건에 대해서만 처리
			if (ds_list.getRowType(i) == Dataset.ROWTYPE_INSERT || ds_list.getRowType(i) == Dataset.ROWTYPE_UPDATE) {
				iCnt++;
				// 대상을 ds_save로 복사
				ds_save.addRow();
				iRow = ds_save.rowposition;
				ds_save.copyRow(iRow, ds_list, i);
			}
		} else {
			iCnt++;
			// 전체를 ds_save로 복사
			ds_save.addRow();
			iRow = ds_save.rowposition;
			ds_save.copyRow(iRow, ds_list, i);
		}
	}
	
	
	var nRow = ds_search.rowposition;
 	// 저장 시 조건(KEY)을 ds_list의 KEY 값으로 복사
 	for (var i = 0 ; i < iCnt ; i++)
 	{
 		ds_save.setColumn(i, "centerCode", ds_search.getColumn(nRow, "schCenter"));		
 		ds_save.setColumn(i, "upjang", ds_search.getColumn(nRow, "schUpjang"));		
 		ds_save.setColumn(i, "stdDate", ds_search.getColumn(nRow, "schDate"));		
 		ds_save.setColumn(i, "stdDate2", ds_search.getColumn(nRow, "schDate2"));		
 		ds_save.setColumn(i, "contractId", ds_search.getColumn(nRow, "schContractId"));		
 		ds_save.setColumn(i, "contractNm", ds_search.getColumn(nRow, "schContractNm"));		
 		ds_save.setColumn(i, "stdPdate", v_Pdate);		// 전략이익율 기준일자
 	}
	// 2015-12-14 END
 	///////////////////////////////////////////////////////////////////////////////////
 	
 	
	// 저장 시 조건(KEY)을 ds_list의 KEY 값으로 복사
// 	for (var i = 0 ; i < nRowCnt ; i++)
// 	{
// 		ds_list.setColumn(i, "centerCode", ds_search.getColumn(nRow, "schCenter"));		
// 		ds_list.setColumn(i, "upjang", ds_search.getColumn(nRow, "schUpjang"));		
// 		ds_list.setColumn(i, "stdDate", ds_search.getColumn(nRow, "schDate"));		
// 		ds_list.setColumn(i, "stdDate2", ds_search.getColumn(nRow, "schDate2"));		
// 		ds_list.setColumn(i, "contractId", ds_search.getColumn(nRow, "schContractId"));		
// 		ds_list.setColumn(i, "contractNm", ds_search.getColumn(nRow, "schContractNm"));		
// 		ds_list.setColumn(i, "stdPdate", v_Pdate);		// 전략이익율 기준일자
// 	}
 	
 	// KEY SET
 	//fv_Key = ds_search.getColumn(nRow, "schDate") + '-' + ds_search.getColumn(nRow, "schUpjang") + '-' + '001';
 	fv_Key = ds_search.getColumn(nRow, "schDate") + '-' + ds_search.getColumn(nRow, "schCenter") + '-' + ds_search.getColumn(nRow, "schUpjang") + '-' + '001';
	//trace("fv_Key : " + fv_Key);
 	
 	
	// Transaction 처리
	var strSvcID    = "saveList2";
	var strURL      = "fm/fms/foodMaterialsSalePrice/saveList2.xdo";
	//var strInDs     = "ds_list=ds_list:A";
	var strInDs     = "ds_save=ds_save:A";
	var strOutDs    = "";
	var strArg      = "";
	var strCallback = "fn_callBack";
	var bAsync      = true;
	
	gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 저장 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 * N Transaction 처리, 프로그래스 바 이용
 *---------------------------------------------------------------------------------------------*/
function fn_save_old()
{
	var nRowCnt = ds_list.getRowCount();	// DataSet Count
	var nRow= ds_search.rowposition;
	var sMsg = "";
	
	// 저장할 자료 여부 CHECK
	if(nRowCnt == 0) 
	{
		gfn_alert("msg.save.nodata", "저장할 데이터");	// 저장할 데이터가 없습니다.
		return;
	}

	var v_contractId = ds_search.getColumn(nRow, "schContractId");

	if (v_contractId != "NEW") {
		// v_ds_check 미사용시 변경사항 체크 : 엑셀업로드 시에는 CHECK X
		if (gfn_dsIsUpdated(ds_list) == false && fv_excelFlag == false)
		{
			gfn_alert("msg.save.nochange");	// 변경된 내역이 없습니다.
			return;
		}
	}
 	
	// 저장 시 조건 Check	: 조회조건 기준으로 CHECK
	if (gfn_validCheck(ds_search, ds_searchSave, true) == false) return;
 	

	// 저장 시 Validation Check : 중복 CHECK	
	if( !fn_saveCheck() ) 
	{
		return;
	}

// 	if (fv_excelFlag == true) {
// 		sMsg = "엑셀 업로드 시 자료에 대한 중복여부 및 필수입력 사항을 체크합니다.\n\n";
// 	    sMsg = sMsg + "계속 진행 하시겠습니까?\n\n";
// 		if (!gfn_confirm(sMsg, "", "C")) return;
// 
// 		fn_processInit("excel");
// 
// 		// 저장 시 Validation Check : 중복 CHECK	
// 		if( !fn_saveItemChk() ) 
// 		{
// 			fn_processInit("close");
// 			return;
// 		} 
// 		fn_processInit("close");
// 	}	
	
	// 에러메시지 버튼 숨기기
	fn_errorView(false);
	
	
	var sDate = cal_date.text.substr(0,4) + "-" + cal_date.text.substr(4,2) + "-" + cal_date.text.substr(6,2);

	if (ds_search.getColumn(nRow, "schContractId")=="NEW") {
		fv_saveFlag = "I";
		sMsg = "판매단가를 저장합니다.\n계속 진행 하시겠습니까?\n\n";
		sMsg = sMsg + " - 단가개시일 : " + sDate + "\n";
	} else {
		fv_saveFlag = "U";
		sMsg = "현 단가계약 수정작업은 수정 전 단가계약 금액으로\n";
		sMsg = sMsg + "발주된 자재에는 반영되지 않습니다.\n";
		sMsg = sMsg + "수정하시겠습니까?\n\n";
	}

	if (!gfn_confirm(sMsg, "", "C")) return;
	
//  	// 저장 시 Progress Bar 표시 창 
// 	fn_processInit("save");
 	
 	
// 	// 저장 시 조건(KEY)을 ds_list의 KEY 값으로 복사
// 	for (var i = 0 ; i < nRowCnt ; i++)
// 	{
// 		ds_list.setColumn(i, "centerCode", ds_search.getColumn(nRow, "schCenter"));		
// 		ds_list.setColumn(i, "upjang", ds_search.getColumn(nRow, "schUpjang"));		
// 		ds_list.setColumn(i, "stdDate", ds_search.getColumn(nRow, "schDate"));		
// 		ds_list.setColumn(i, "stdDate2", ds_search.getColumn(nRow, "schDate2"));		
// 		ds_list.setColumn(i, "contractId", ds_search.getColumn(nRow, "schContractId"));		
// 		ds_list.setColumn(i, "contractNm", ds_search.getColumn(nRow, "schContractNm"));		
// 		ds_list.setColumn(i, "stdPdate", v_Pdate);		// 전략이익율 기준일자
// 	}
 	
 	// KEY SET
 	//fv_Key = ds_search.getColumn(nRow, "schDate") + '-' + ds_search.getColumn(nRow, "schUpjang") + '-' + '001';
 	fv_Key = ds_search.getColumn(nRow, "schDate") + '-' + ds_search.getColumn(nRow, "schCenter") + '-' + ds_search.getColumn(nRow, "schUpjang") + '-' + '001';
	//trace("fv_Key : " + fv_Key);
 	
 	
// 	// Transaction 처리
// 	var strSvcID    = "saveList";
// 	var strURL      = "fm/fms/foodMaterialsSalePrice/saveList.xdo";
// 	var strInDs     = "ds_list=ds_list:A";
// 	var strOutDs    = "";
// 	var strArg      = "";
// 	var strCallback = "fn_callBack";
// 	var bAsync      = true;
// 	
// 	gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);

	// Progress Bar 처리 
	fn_processSet();
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 출력 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_print()
{
	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 도움말 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_help()
{
	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 화면 닫기 전 변경 유무 체크 (필수-Frame에서 창 닫힐때 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_close()
{	
	// v_ds_check 사용시 변경사항 체크
	if(gfn_length(v_ds_check) == 0) 
	{	
		// v_ds_check 설정기준 변경사항 체크
		if (gfn_isDataChange() == true) 
		{		
			// 변경된 데이터가 있습니다. 현재 화면을 닫겠습니까?
			if (!gfn_confirm("confirm.before.movepage")) return false;
		}
	}
    
	// 조회프로그램에도 Return true; 기술해 주세요!
	return true;
}


/************************************************************************************************
 * TRANSACTION 및 CallBack 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 트랜잭션 콜백 함수 (필수)
 *---------------------------------------------------------------------------------------------*/
function fn_callBack(strSvcID, nErrorCode, strErrorMsg)
{
	// 에러시 gfn_callBack에서 메시지 제공, 화면별 특정 에러 발생시에만 사용하세요.
	if (nErrorCode < 0) 
	{
		if(strSvcID=="saveList")
		{
			fv_errorFlag="Y";
			fv_errorMsg = strErrorMsg;
			fn_processStep();
			return;
		}
		else 
		{
			return;
		}
	}
	
    switch(strSvcID)
    {
		// 목록 조회
        case "search" :
            //trace(ds_list.saveXML());
            if (ds_list.getRowCount() == 0) {
				//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
				gfn_loadDatasetInfo (ds_list, fv_objColInfo);
				gfn_alert("msg.search.nodata");	// 조건에 해당하는 자료가 없습니다.
            } //else fn_set_mprice_all();
            // 엑셀업로드 관련 변수 초기화
			fv_excelFlag = false;
            break;
            
		// 센터 조회
        case "searchCenter" :
            //trace(ds_center.saveXML());
            fn_center_init();
            break;

		// 계약번호 조회
        case "searchContract" :
            //trace(ds_contract.saveXML());
            fn_contract_init();
            break;

		// 자재추가 후 조회 : 구매정보 GET
        case "searchItemPo" :
            //trace(ds_item.saveXML());
            fn_itemListAdd();
            break;

        // 저장 : 1 Transaction
        case "saveList2" :
			trace("처리건수 : " + fv_processCnt);
			//gfn_alert("msg.save.success");	// 저장 되었습니다.
			fn_processInit("close");
			
			var sMsg = "저장 되었습니다.\r\r";
			sMsg = sMsg + "-. 전체건수 : " + ds_list.rowcount + " 건\r";
			sMsg = sMsg + "-. 처리건수 : " + fv_processCnt + " 건";
			gfn_alert(sMsg, "", "A");
			
			if (fv_saveFlag=="I") {
				// 계약번호 재조회
				fn_contract();
			} else {		
				// 판매단가 목록 재조회
				fn_search();
			} 
            break;    


        // 저장 : N Transaction
        case "saveList" :
			if (fv_processCnt > 0) {	
				fv_closeFlag = "OK";
				fv_errorFlag="";
				fv_errorMsg="";
			}
			//gfn_alert("msg.save.success");	// 저장 되었습니다.
			fn_processStep();
            break;    



        // 삭제
        case "deleteItem" :
			trace("삭제건수 : " + fv_processCnt);
			gfn_alert("msg.delete.success");	// 삭제 되었습니다.
			// 판매단가 목록 재조회
			fn_search();
            break;    
    }
}


/************************************************************************************************
 * 사용자 FUNCTION 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : Progress Bar 초기화
 *---------------------------------------------------------------------------------------------*/
function fn_processBarInit()
{
	pbr_status.text = "판매단가 생성작업";
	pbr_status.pos = 0;
}


/*----------------------------------------------------------------------------------------------
 * 설명      : Progress Bar - 저장 용
 *---------------------------------------------------------------------------------------------*/
function fn_processSet()
{
	var nRowCnt = ds_list.getRowCount();	// DataSet Count
	var iCnt = 0;
	var iRow = 0;

	// 전략이익율 기준일자 SET
	var v_Pdate = "";
	if (cal_date.text.substr(6,2) > "15") v_Pdate = cal_date.text.substr(0,4) + cal_date.text.substr(4,2) + "16";
	else v_Pdate = cal_date.text.substr(0,4) + cal_date.text.substr(4,2) + "01";



  	// 저장 시 Progress Bar 표시 창 
 	fn_processInit("save");


	// 저장할 Dataset Clear
	ds_save.clearData();

	// 저장 대상 개수 
	for (var i = 0 ; i < nRowCnt ; i++)
	{
		// 신규일경우 - 전체, 그외 변경분만 처리
		if (fv_saveFlag == "U") {
			// 신규 및 수정건에 대해서만 처리
			if (ds_list.getRowType(i) == Dataset.ROWTYPE_INSERT || ds_list.getRowType(i) == Dataset.ROWTYPE_UPDATE) {
				iCnt++;
				// 대상을 ds_save로 복사
				ds_save.addRow();
				iRow = ds_save.rowposition;
				ds_save.copyRow(iRow, ds_list, i);
			}
		} else {
			iCnt++;
			// 전체를 ds_save로 복사
			ds_save.addRow();
			iRow = ds_save.rowposition;
			ds_save.copyRow(iRow, ds_list, i);
		}
	}
	
	
	var nRow = ds_search.rowposition;
 	// 저장 시 조건(KEY)을 ds_list의 KEY 값으로 복사
 	for (var i = 0 ; i < iCnt ; i++)
 	{
 		ds_save.setColumn(i, "centerCode", ds_search.getColumn(nRow, "schCenter"));		
 		ds_save.setColumn(i, "upjang", ds_search.getColumn(nRow, "schUpjang"));		
 		ds_save.setColumn(i, "stdDate", ds_search.getColumn(nRow, "schDate"));		
 		ds_save.setColumn(i, "stdDate2", ds_search.getColumn(nRow, "schDate2"));		
 		ds_save.setColumn(i, "contractId", ds_search.getColumn(nRow, "schContractId"));		
 		ds_save.setColumn(i, "contractNm", ds_search.getColumn(nRow, "schContractNm"));		
 		ds_save.setColumn(i, "stdPdate", v_Pdate);		// 전략이익율 기준일자
 	}
	

	// 저장 대상 ROW
	fv_saveRowCnt = iCnt;

	trace("iCnt : " + iCnt);

	//trace("fv_saveRowCnt : " + fv_saveRowCnt);

	if(fv_saveRowCnt>0)
	{
		// progress bar 초기 set
		pbr_status.max = fv_saveRowCnt;
		pbr_status.step = 1;
	
		// 최초 process 실행 호출
		fv_saveRow = 0;
		fn_process(fv_saveRow);
	}
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 저장 로직 처리, 1 Row 씩 처리
 * arg : 처리 Index(row id)
 *---------------------------------------------------------------------------------------------*/
function fn_process(arg)
{
	// 최초 실행 시 첫번째 Row
	if (arg=="") arg = 0;

	// 선택 Row 가 최대 Row보다 클 경우 종료
	if ((arg+1) > fv_saveRowCnt) {
		fn_processInit("close");
		
		var sMsg = "저장 되었습니다.\r\r";
		sMsg = sMsg + "-. 처리건수 : " + fv_saveRowCnt + " 건";
		gfn_alert(sMsg, "", "A");
			
		if (fv_saveFlag=="I") {
			// 계약번호 재조회
			fn_contract();
		} else {		
			// 판매단가 목록 재조회
			fn_search();
		} 
		return;
	}

	//trace("arg : " + arg);
	
	// saveRow Dataset Clear
	ds_saveRow.clearData();
	
	// saveRow Dataset 에 복사 
	var iIdx = ds_saveRow.addRow();
	
	ds_saveRow.copyRow(iIdx, ds_save, arg);
	// Find Row Value 지정
	fv_row = ds_save.getColumn(arg, "itemCode");


	// 최종 ROW일 경우에 최종자료 여부 SET
	if ((arg+1) == fv_saveRowCnt) 
		ds_saveRow.setColumn(0, "isLast", "Y");
	else 
		ds_saveRow.setColumn(0, "isLast", "");
	
	// Transaction 처리
 	var strSvcID    = "saveList";
 	var strURL      = "fm/fms/foodMaterialsSalePrice/saveList.xdo";
	var strInDs     = "ds_saveRow=ds_saveRow:A";
 	var strOutDs    = "";
 	var strArg      = "";
 	var strCallback = "fn_callBack";
 	var bAsync      = true;
 	
 	gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}


/*----------------------------------------------------------------------------------------------
 * 설명      : Callback 후 작업진행 여부 CHECK 및 프로세스 호출
 *---------------------------------------------------------------------------------------------*/
function fn_processStep()
{
	if(fv_errorFlag=="Y")
	{
		// ERROR 발생 시 결과 표시
		fn_error();
		return;
	}

	
	var msg = "";
	
	//trace("fv_errorFlag : " + fv_errorFlag);

	// 해당 ROW POSITION 위치 : 최종 ROW
	var nRow = ds_list.findRowExpr("itemCode=='"+fv_row+"'");
	ds_list.rowposition = nRow;
	
	//trace("fv_row : " + fv_row);
	//trace("nRow : " + nRow);
	
	// Progress Bar SET
	pbr_status.text = "판매단가 생성작업 ("+(fv_saveRow+1)+"/"+ fv_saveRowCnt+")";
	
	
	pbr_status.pos = fv_saveRow+1;
	pbr_status.stepIt();
	this.updateWindow(); // 이 부분 추가
	//trace("iRow : " + iRow);

	//다음 Transaction 처리 실행
	fv_saveRow++;
		
	//trace("fv_saveRow : " + fv_saveRow); 
	fn_process(fv_saveRow);
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 시스템오류 발생 시 오류메시지 저장
 *---------------------------------------------------------------------------------------------*/
function fn_error()
{
	trace("작업종료");
	fn_processInit("close");
	
	// 에러표시 후 작업중단 창 표시
	var sMsg = "단가생성 시 오류가 발생했습니다.\n\n";
	sMsg = sMsg + "※ 기 진행중인 단가자료는 모두 취소됩니다.\n";
	sMsg = sMsg + "  오류 메시지를 확인한 후 재 작업하세요";
	gfn_alert(sMsg, "", "A");
	
	fn_errorView(true);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 시스템오류 발생 시 오류메시지 콘트롤
 *---------------------------------------------------------------------------------------------*/
function fn_errorView(flag)
{
	if (flag) {
		btn_errorView.visible = true;
	} else {
		btn_errorView.visible = false;
	}
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 단가 종료일자 SET
 * 
 *---------------------------------------------------------------------------------------------*/
function fn_searchDateSet()
{
	// 조건 SET 
	var nRow = ds_search.rowposition;

	var sDate = ds_search.getColumn(nRow, "schDate");					// 단가개시일

	// 조건 : 기준일자 종료일 SET
	ds_search.setColumn(nRow, "schDate2", fn_dateGet(sDate));			// 단가종료일 SET
}


/*----------------------------------------------------------------------------------------------
 * 설명  : 기준일자에 대한 종료일자를 GET한다
 *---------------------------------------------------------------------------------------------*/
function fn_dateGet(sDate)
{
	var v_date;
	
	if (gfn_isNull(sDate)) 
	{
		return "-1";
	}
	
	var nDay  = parseInt(gfn_subStr(sDate,6, 2))
	
	
	if (nDay > 15) {
		v_date = gfn_addMonth(sDate, 1);
		v_date = gfn_subStr(v_date, 0, 6) + "15";		
	} else {
		v_date = sDate;
		v_date = gfn_getLastDate(v_date);
	}
	
	return v_date;
}

/*----------------------------------------------------------------------------------------------
 * 설명      : Progress Bar 초기화
 *---------------------------------------------------------------------------------------------*/
function fn_processInit(flag)
{
	div_excel.position.left = Button00.position.left-20;
	div_excel.position.width = 349;

	if (flag=="excel") {
		div_excel.visible = true;
		div_excel.sta_title.text = "◎ 엑셀 업로드 작업 체크";
		div_excel.txt_msg_1.visible = true;
		div_excel.txt_msg_2.visible = false;
		div_excel.txt_msg_3.visible = false;
		div_excel.txt_msg_4.visible = false;
	} else if (flag=="margin") {
		div_excel.visible = true;
		div_excel.sta_title.text = "◎ 마진 일괄 작업";
		div_excel.txt_msg_1.visible = false;
		div_excel.txt_msg_2.visible = true;
		div_excel.txt_msg_3.visible = false;
		div_excel.txt_msg_4.visible = false;
	} else if (flag=="save") {
		div_excel.visible = true;
		div_excel.sta_title.text = "◎ 판매단가 저장 작업";
		div_excel.txt_msg_1.visible = false;
		div_excel.txt_msg_2.visible = false;
		div_excel.txt_msg_3.visible = true;
		div_excel.txt_msg_4.visible = false;
	} else if (flag=="round") {
		div_excel.visible = true;
		div_excel.sta_title.text = "◎ 판매가 올림 일괄 작업";
		div_excel.txt_msg_1.visible = false;
		div_excel.txt_msg_2.visible = false;
		div_excel.txt_msg_3.visible = false;
		div_excel.txt_msg_4.visible = true;
	} else {
		div_excel.visible = false;
	}
	this.updateWindow(); // 이 부분 추가
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 자재 추가 팝업 호출
 *---------------------------------------------------------------------------------------------*/
function fn_itemAdd()
{
	var v_Pdate = "";						// 전략이익율 관련 날짜 SET

	// 전략이익율 기준일자 SET
	if (cal_date.text.substr(6,2) > "15") v_Pdate = cal_date.text.substr(0,4) + cal_date.text.substr(4,2) + "16";
	else v_Pdate = cal_date.text.substr(0,4) + cal_date.text.substr(4,2) + "01";


	// 팝업창을 호출한다	
	var strId       = "SalePriceItemSearch";
	var strURL      = "X_FMS::SalePriceItemSearchPop.xfdl";
	var objArgument = {
		P_DATASET : ds_search
	};
	
	var nWidth      = 734;
	var nHeight     = 495;
	var strStyle    = "";
	var nLeft       = -1;
	var nTop        = -1;
	var isModeless  = false;
	var bShowTitle  = true;
	var strAlign    = "-1";
	
	// 리턴값을 배열로 받을 경우	
 	var arrRtn = gfn_dialog(strId, strURL, objArgument, nWidth, nHeight, strStyle, nLeft, nTop, isModeless, bShowTitle, strAlign);
 	
 	//trace("arrRtn : " + arrRtn);

 	if (arrRtn instanceof Object)
 	{
// 		// 자재코드 추가 관련 Dataset Clear
// 		ds_searchItem.clearData();
// 		ds_searchItem.addRow();	
// 		// DataSet SET
// 		ds_searchItem.setColumn(ds_searchItem.rowposition, "schCenter", arrRtn["centerCode"]);		
// 		ds_searchItem.setColumn(ds_searchItem.rowposition, "schUpjang", arrRtn["upjang"]);		
// 		ds_searchItem.setColumn(ds_searchItem.rowposition, "schDate", arrRtn["stdDate"]);		
// 		ds_searchItem.setColumn(ds_searchItem.rowposition, "schDate2", arrRtn["stdDate2"]);		
// 		ds_searchItem.setColumn(ds_searchItem.rowposition, "schCust", arrRtn["custCd"]);		
// 		ds_searchItem.setColumn(ds_searchItem.rowposition, "schItemCode", arrRtn["itemCode"]);		
// 		ds_searchItem.setColumn(ds_searchItem.rowposition, "schContractStart", arrRtn["contractStart"]);	
// 		ds_searchItem.setColumn(ds_searchItem.rowposition, "schPdate", v_Pdate);	// 전략이익율 기준일자 SET	
// 			
// 		fn_itemSet();	
			
 	}

}


/*----------------------------------------------------------------------------------------------
 * 설명      : 자재 추가 팝업에서 전달되어진 Dataset
 *---------------------------------------------------------------------------------------------*/
function fn_itemReturn(dsObj)
{
	var v_Pdate = "";						// 전략이익율 관련 날짜 SET
	var iCnt = 0;

	// 전략이익율 기준일자 SET
	if (cal_date.text.substr(6,2) > "15") v_Pdate = cal_date.text.substr(0,4) + cal_date.text.substr(4,2) + "16";
	else v_Pdate = cal_date.text.substr(0,4) + cal_date.text.substr(4,2) + "01";


	if(dsObj != null)
	{

		for(var i=0; i<dsObj.rowcount; i++)
		{	
			//trace("itemCode : " + i + " : " + dsObj.getColumn(i, "itemCode"));
			// 자재코드 추가 관련 Dataset Clear
			ds_searchItem.clearData();
			ds_searchItem.addRow();	
			// DataSet SET
			ds_searchItem.setColumn(ds_searchItem.rowposition, "schCenter", dsObj.getColumn(i, "centerCode"));		
			ds_searchItem.setColumn(ds_searchItem.rowposition, "schUpjang", dsObj.getColumn(i, "upjang"));		
			//ds_searchItem.setColumn(ds_searchItem.rowposition, "schDate", dsObj.getColumn(i, "stdDate"));	
			//ds_searchItem.setColumn(ds_searchItem.rowposition, "schDate2", dsObj.getColumn(i, "stdDate2")); 
			ds_searchItem.setColumn(ds_searchItem.rowposition, "schDate", dsObj.getColumn(i, "stdOrgDate"));	// 2015-10-16 기준일자 변경으로 인해 원본 일자 저장
			ds_searchItem.setColumn(ds_searchItem.rowposition, "schDate2", dsObj.getColumn(i, "stdOrgDate2")); 	// 2015-10-16 기준일자 변경으로 인해 원본 일자 저장
			ds_searchItem.setColumn(ds_searchItem.rowposition, "schCust", dsObj.getColumn(i, "custCd"));
			ds_searchItem.setColumn(ds_searchItem.rowposition, "schItemCode", dsObj.getColumn(i, "itemCode"));
			ds_searchItem.setColumn(ds_searchItem.rowposition, "schContractStart", dsObj.getColumn(i, "contractStart"));
			ds_searchItem.setColumn(ds_searchItem.rowposition, "schPdate", v_Pdate);	// 전략이익율 기준일자 SET	
			
			fn_itemSet();
			
			iCnt++;
		}
		sMsg = iCnt + "건이 추가되었습니다.";
		gfn_alert(sMsg, "", "A");
	}

}



/*----------------------------------------------------------------------------------------------
 * 설명      : 자재 추가 정보에 대한 판매단가정보 SET
 *---------------------------------------------------------------------------------------------*/
function fn_itemSet()
{
	// 자재 중복여부 CHECK
	if( !fn_itemCheck() ) 
	{
		return;
	}

	// Clear
	ds_item.clearData();

	// 추가된 자재의 구매정보 SELECT 호출
    var strSvcID    = "searchItemPo";
    var strURL      = "fm/fms/foodMaterialsSalePrice/selectItemPo.xdo";
    var strInDs     = "ds_searchItem=ds_searchItem";
    var strOutDs    = "ds_item=ds_item";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = false;
    //var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 자재 추가 정보 중복여부 CHECK
 *---------------------------------------------------------------------------------------------*/
function fn_itemCheck()
{
	// 기존 판매단가 목록에 중복 체크 
	var v_centerCode = ds_searchItem.getColumn(ds_searchItem.rowposition, "schCenter");
	var v_upjang = ds_searchItem.getColumn(ds_searchItem.rowposition, "schUpjang");
	var v_itemCode = ds_searchItem.getColumn(ds_searchItem.rowposition, "schItemCode");
	
	
	// 이미 자재코드가 존재하는지를 확인한다.
	var iFindRowIdx = ds_list.findRowExpr("centerCode == '"+v_centerCode+"' && upjang == '"+v_upjang+"' && itemCode == '"+v_itemCode+"'", 0, ds_list.rowcount);
	var sMsg = "";
				
	//검색된 행이 존재할 시에는 중복 메시지를 표시한다.
	if (iFindRowIdx != -1)
	{
		// 삭제된 ROW일 경우에는 제외
		if (ds_list.getRowType(iFindRowIdx) == Dataset.ROWTYPE_DELETE) return true;
	
		// 중복자재는 메시지 표시 않하고 그냥  PASS
		sMsg = "이미 등록된 자재가 존재합니다.\r작업을 취소합니다.";
		trace(sMsg);
		//gfn_alert(sMsg, "", "A");
		//ds_list.rowposition = iFindRowIdx;
		return false;
	}

	return true;
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 추가된 자재정보에 대한 판매단가목록 Ds 반영
 * CallBack 처리 
 * 2015/10/15 - 멀티 자재 추가로 인해 메시지 표시 않함
 *---------------------------------------------------------------------------------------------*/
function fn_itemListAdd()
{
  var sMsg = "";	
    if (ds_item.getRowCount() == 0) {
		sMsg = "선택한 자재의 단가정보가 존재하지 않습니다.\r작업을 취소합니다.";
		trace(sMsg);
		//gfn_alert(sMsg, "", "A");
		return;
	}
	
	var nRow = ds_list.addRow();
	var bSucc;
	bSucc = ds_list.copyRow(nRow,ds_item,ds_item.rowposition);

	if (bSucc) {
		sMsg = "선택한 자재가 추가되었습니다.";
		//gfn_alert(sMsg, "", "A");
		trace(sMsg);
		ds_list.rowposition = nRow;
		return;
	}	
	
}



/*----------------------------------------------------------------------------------------------
 * 설명      : 저장 시 CHECK 
 *---------------------------------------------------------------------------------------------*/
function fn_saveCheck()
{
	var v_contractId = ds_search.getColumn(ds_search.rowposition, "schContractId");		// 계약번호
	var v_date = ds_search.getColumn(ds_search.rowposition, "schDate");					// 단가개시일
	var sMsg = "";
	
	//trace("v_date : " + v_date);

	//이미 개시일자가 존재하는지를 확인한다. : 신규생성일 때만 CHECK
	var iFindRowIdx = ds_contract.findRowExpr("contractStart >= '"+v_date+"' && contractId != 'NEW'", 0, ds_contract.rowcount);

	//trace("iFindRowIdx : " + iFindRowIdx);

	
	// 신규등록이면서 중복자료가 존재 시
	if (v_contractId == "NEW" && iFindRowIdx != -1) {
		sMsg = "동일한 일자 및 이후에 단가계약이 등록되어 있습니다.\r작업을 취소합니다.";
		gfn_alert(sMsg, "", "A");
		return false;
	}

	return true;

}

/*----------------------------------------------------------------------------------------------
 * 설명      : 센터정보 조회
 *---------------------------------------------------------------------------------------------*/
function fn_searchCenter()
{
    var strSvcID    = "searchCenter";
    var strURL      = "fm/fms/upriceContractUpjangSet/selectCenter.xdo";
    var strInDs     = "";
    var strOutDs    = "ds_center=ds_center";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 센터 COMBO 초기화 
 *---------------------------------------------------------------------------------------------*/
function fn_center_init()
{
	var defVal = "";
	ds_center.filter("centerCode != '*'");
	// COMBO 에 첫번째 Row에 기본값을 SET
	if (ds_center.getRowCount() > 0) {
		defVal = ds_center.getColumn(0, "centerCode");
	}
	cbo_centerCode.value = defVal;
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 단가계약번호 조회
 *---------------------------------------------------------------------------------------------*/
function fn_contract()
{
	// 조건 SET : 센터, 고객사
	var nRow = ds_search.rowposition;
	ds_search.setColumn(nRow, "schUpjang", edt_upjang.userdata);		// 고객사코드

    var strSvcID    = "searchContract";
    var strURL      = "fm/fms/foodMaterialsSalePrice/selectContract.xdo";
    var strInDs     = "ds_search=ds_search:A";
    var strOutDs    = "ds_contract=ds_contract";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 계약번호 COMBO 초기화 
 *---------------------------------------------------------------------------------------------*/
function fn_contract_init()
{
	var defVal = "";
	var v_init = "";	// 최초 COMBO LOAD 시
	//ds_contract.filter("contractId != '*'");
	// COMBO 에 첫번째 Row에 기본값을 SET
	if (ds_contract.getRowCount() > 0) {
		// 저장이후 재조회 여부
		if (fv_Key=="") {
			defVal = ds_contract.getColumn(0, "contractId");
			v_init = "1";
		} else {
			defVal = fv_Key;
		}
	}
	//trace("defVal : " + defVal);
	//trace("defVal : " + ds_contract.getColumn(0, "contractDisp"));
	cbo_contract.value = defVal;

	if (v_init=="1") fn_contractCompSet("1");

	// 저장이후 조회
	if (fv_saveFlag=="I") {
		// 계약번호COMBO 설정에 따른 콤포넌트 처리(기존자료 조회)
		fn_contractCompSet("0");
		// 판매단가 목록 재조회
		fn_search();
	} 
	
	// Flag Init
	fv_saveFlag = "";
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 단가계시일, 계약명 COMP 처리
 *---------------------------------------------------------------------------------------------*/
function fn_contract_comp(arg)
{
	if (arg=="1") {
		cal_date.enable = false;
		edt_contractNm.enable = false;
	} else {
		cal_date.enable = true;
		edt_contractNm.enable = true;
	}
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 매입단가 변경 시 마진율 자동계산
 *              ((판매단가 / 매입단가) - 1) * 100
 *---------------------------------------------------------------------------------------------*/
function fn_saleRate(row, amt)
{
	var v_salePrice = 0; 	// 판매단가
	var v_calcRate = 0;
	
	v_salePrice = ds_list.getColumn(row, "salePrice2");

	if (amt==0) return 0;

	if (v_salePrice == "") return 0;

	//trace("salePrice : " + v_salePrice);
	//trace("contractPrice : " + amt);
	
	v_calcRate = ((v_salePrice / amt)-1) * 100;
	
	v_calcRate = gfn_round(v_calcRate, 1);
	//v_calcRate = gfn_round(v_calcRate, 0);
	
	// 마진율이 100 이상이면 100으로 표시
	//if (v_calcRate > 100) v_calcRate = 100;

	return v_calcRate;
} 

/*----------------------------------------------------------------------------------------------
 * 설명      : 마진일괄작업 - 과세, 면세, 전체
 * taxFlag (1:과세, 2:면세, 3:전체)  
 *---------------------------------------------------------------------------------------------*/
function fn_saleMargin(taxFlag)
{
	var nRowCnt = ds_list.getRowCount();					// DataSet Count
	var v_saleRate = div_margin.msk_saleRate.value;			// 적용할 판매_장려율
	var sGubun = div_margin.rdo_price.value;				// 올림구분(1, 2, 3)

	if (nRowCnt < 1) return;

	if (v_saleRate.valueOf() == "undefined" || v_saleRate == "") v_saleRate = 0;

	if (v_saleRate==0) {
		gfn_alert("msg.err.validator.required", "판매장려율");	// 은(는) 필수 입력 항목입니다..
		return;
	}

	var sTax = "";
	
	if(taxFlag=="1") 
		sTax = "과세";
	else if(taxFlag=="2") 
		sTax = "면세";
	else
		sTax = "전체";
	
	var sMsg = sTax + " 품목에 대한 판매율을 적용합니다.\n계속 진행 하시겠습니까?\n\n";
		sMsg = sMsg + " - 판매장려율 : " + v_saleRate + " %\n";
	
	if (!gfn_confirm(sMsg, "", "C")) return;

	
	var v_salePrice = 0;
	var v_rate = 0;

	fn_processInit("margin");
	ds_list.enableevent = false;
	for (var i = 0 ; i < nRowCnt ; i++)
	{
		if (taxFlag=="1") 	// 과세품목만 적용
		{
			if (ds_list.getColumn(i, "taxCode")=="과세") {
				v_salePrice = ds_list.getColumn(i, "salePrice2");
				v_salePrice = v_salePrice + ((v_salePrice * v_saleRate) / 100);

				// 금액 재계산(올림 적용) : 적용 X
				//v_salePrice = fn_amtRound(sGubun, v_salePrice);
				ds_list.setColumn(i, "salePrice2", v_salePrice);	// 판매금액 SET
				
				// 마진율 재계산 (처리하지 x), 그냥 대입
				v_rate = fn_saleRate(i, ds_list.getColumn(i, "contractPriceS2"));
				ds_list.setColumn(i, "marginRate2", v_rate); 
				//ds_list.setColumn(i, "marginRate2", v_saleRate); 
			}
		} else if (taxFlag=="2")	 // 면세품목만 적용		
		{
			if (ds_list.getColumn(i, "taxCode")!="과세") {
				v_salePrice = ds_list.getColumn(i, "salePrice2");
				v_salePrice = v_salePrice + ((v_salePrice * v_saleRate) / 100);

				// 금액 재계산(올림 적용) : 적용 X
				//v_salePrice = fn_amtRound(sGubun, v_salePrice);
				ds_list.setColumn(i, "salePrice2", v_salePrice);	// 판매금액 SET

				// 마진율 재계산 (처리하지 x), 그냥 대입
				v_rate = fn_saleRate(i, ds_list.getColumn(i, "contractPriceS2"));
				ds_list.setColumn(i, "marginRate2", v_rate); 
				//ds_list.setColumn(i, "marginRate2", v_saleRate); 
			}
		} else						// 전체 적용 
		{
				v_salePrice = ds_list.getColumn(i, "salePrice2");
				v_salePrice = v_salePrice + ((v_salePrice * v_saleRate) / 100);

				// 금액 재계산(올림 적용) : 적용 X
				//v_salePrice = fn_amtRound(sGubun, v_salePrice);
				ds_list.setColumn(i, "salePrice2", v_salePrice);	// 판매금액 SET

				// 마진율 재계산 (처리하지 x), 그냥 대입
				v_rate = fn_saleRate(i, ds_list.getColumn(i, "contractPriceS2"));
				ds_list.setColumn(i, "marginRate2", v_rate); 
				//ds_list.setColumn(i, "marginRate2", v_saleRate); 
		}
	}	// end for
	ds_list.enableevent = true;	
	fn_processInit("close");
	gfn_alert("msg.action.success");	// 처리 되었습니다.
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 판매금액에 대한 올림처리
 * gubun (1:1원, 2:10원, 3:100원)  
 *---------------------------------------------------------------------------------------------*/
function fn_amtRound(gubun, amt)
{
	var v_calcAmt = 0;
	
	if (amt == 0) return 0;

	if(gubun=="1") {
		v_calcAmt = Math.ceil(amt / 1) * 1;
	} else if(gubun=="3") {
		v_calcAmt = Math.ceil(amt / 100) * 100;
	} else {
		v_calcAmt = Math.ceil(amt / 10) * 10;
	}
	
	return v_calcAmt;
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 계약번호(COMBO)에 따른 COMP 활성화/비활성화 처리
 * flag = 1(신규)
 *---------------------------------------------------------------------------------------------*/
function fn_contractCompSet(flag)
{
	// 계약명 표시
	var v_contractId = cbo_contract.value; 
	// 조건 SET 
	var nRow = ds_search.rowposition;

	if (flag=="1")
	{
		ds_search.setColumn(nRow, "schDate", gfn_today());					// 단가개시일
		ds_search.setColumn(nRow, "schContractNm", "");						// 계약명
		fn_contract_comp("0");
	} else {
		var iRow = ds_contract.findRowExpr("contractId=='"+v_contractId+"'");
		
		ds_search.setColumn(nRow, "schDate", ds_contract.getColumn(iRow, "contractStart"));		// 단가개시일
		ds_search.setColumn(nRow, "schContractNm", ds_contract.getColumn(iRow, "contractNm"));	// 계약명
		fn_contract_comp("1");
	}
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 엑셀 업로드 시 자재코드 관련 기본 CHECK
 *---------------------------------------------------------------------------------------------*/
function fn_saveItemChk()
{
	var nRowCnt = ds_list.getRowCount();	// DataSet Count
	var v_itemCode = "";
	
	// DataSet Copy
	ds_listCopy.clearData();
	ds_listCopy.copyData(ds_list);

	this.setWaitCursor(true);

	for (var i = 0 ; i < nRowCnt ; i++)
	{
		trace(" i : " + i);
		
		v_itemCode = gfn_transNullToEmpty(ds_list.getColumn(i, "itemCode"));
		
		// 필수입력 CHECK
		if (gfn_transNullToEmpty(ds_list.getColumn(i, "custCd"))=="") {
			this.setWaitCursor(false);
			sMsg = "업체코드는 필수입력 사항입니다.";
			gfn_alert(sMsg, "", "A");
			ds_list.selectRow(i);	// MultiRow 일 경우 rowposition 사용 X
			return false;
		}	
	
		if (v_itemCode=="") {
			this.setWaitCursor(false);
			sMsg = "자재코드는 필수입력 사항입니다.";
			gfn_alert(sMsg, "", "A");
			ds_list.selectRow(i);	// MultiRow 일 경우 rowposition 사용 X
			return false;
		}	
		
		// 중복자재 체크 필요성 X
		
// 		ds_listCopy.filterRow(i);
// 		
// 		var iFindRowIdx = ds_listCopy.findRowExpr("itemCode == '"+v_itemCode+"'", 0, ds_listCopy.rowcount);
// 		
// 		if (iFindRowIdx != -1)
// 		{
// 			this.setWaitCursor(false);
// 			sMsg = "중복된 자재코드가 존재합니다.\r\r";
// 			sMsg = sMsg + "- 자재코드 : " + ds_list.getColumn(i, "itemCode");
// 			gfn_alert(sMsg, "", "A");
// 			ds_list.selectRow(i);	// MultiRow 일 경우 rowposition 사용 X
// 			return false;
// 		}
// 		ds_listCopy.filter("");
	}
	this.setWaitCursor(false);
	return true;
}


/*----------------------------------------------------------------------------------------------
 * 설명      : Edit 관련 이벤트 실제 처리
 *---------------------------------------------------------------------------------------------*/
function fn_Trigger_edBtn(obj)
{
	switch(obj)
	{
		// 센터
		case cbo_centerCode:
			// 업장 초기화
			edt_upjang.value="";
			edt_upjang.userdata="";
			ds_search.setColumn(ds_search.rowposition, "schUpjang", "");
			ds_search.setColumn(ds_search.rowposition, "schUpjangNm", "");
			// 고객사 Combo 초기화
			ds_contract.clearData();
			ds_search.setColumn(ds_search.rowposition, "schContractId", "");
			// 계약명 초기화
			edt_contractNm.value="";
			break;
		
		// 고객사
		case edt_upjang:
			// 고객사 Combo 초기화
			ds_contract.clearData();
			ds_search.setColumn(ds_search.rowposition, "schContractId", "");
			// 계약명 초기화
			edt_contractNm.value="";
			break;
	
		default:

			break;
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 기존_단가구성 CHECK BOX SET
 *---------------------------------------------------------------------------------------------*/
function fn_centerFlag1(row)
{
	var v_flag = "";
	
	if (ds_list.getColumn(row, "centerFlag1")=="Y") v_flag = "1";
	else v_flag = "0";
	
	return v_flag;
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 적용_단가구성 CHECK BOX SET
 *---------------------------------------------------------------------------------------------*/
function fn_centerFlag2(row)
{
	var v_flag = "";
	
	if (ds_list.getColumn(row, "centerFlag2")=="Y") v_flag = "1";
	else v_flag = "0";
	
	return v_flag;
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 전략단가 SET
 *---------------------------------------------------------------------------------------------*/
function fn_set_sprice(row)
{
	var v_contractId = ds_search.getColumn(ds_search.rowposition, "schContractId");		// 계약번호
	var v_strategyPrice = 0;
	var v_strategyRate = ds_list.getColumn(row, "strategyRate");
	var v_contractPrice2 = ds_list.getColumn(row, "contractPrice2");


	if (v_contractId=="NEW") {
		if (toNumber(v_strategyRate)==0) {
			v_strategyPrice = v_contractPrice2;
		} else {
			v_strategyPrice =  v_contractPrice2 * (1 + (v_strategyRate / 100));
			v_strategyPrice = gfn_round(v_strategyPrice, 0);
		}
		// SET
		ds_list.setColumn(row, "strategyPrice", v_strategyPrice);
	} else {
		v_strategyPrice = ds_list.getColumn(row, "strategyPrice");
	}

	
	return v_strategyPrice;
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 기획단가 SET
 *---------------------------------------------------------------------------------------------*/
function fn_set_pprice(row)
{
	var v_contractId = ds_search.getColumn(ds_search.rowposition, "schContractId");		// 계약번호
	var v_strategyPrice = 0;
	var v_strategyRate = ds_list.getColumn(row, "strategyRate");
	var v_contractPrice2 = ds_list.getColumn(row, "contractPrice2");
	var v_planningRate = ds_list.getColumn(row, "planningRate");
	var v_planningPrice = 0;


	if (v_contractId=="NEW") {
		if (toNumber(v_planningRate)==0) {
			v_planningPrice = 0;
		} else {
			// 1) 전략단가 계산
			v_strategyPrice =  v_contractPrice2 * (1 + (v_strategyRate / 100));
			v_strategyPrice = gfn_round(v_strategyPrice, 0);
			// 2) 전략단가가 0이면 매입단가 set
			if (v_strategyPrice == 0) v_strategyPrice = v_contractPrice2;
			// 3) 기획단가 계산
			v_planningPrice = v_strategyPrice * (1 + (v_planningRate / 100));
			v_planningPrice = gfn_round(v_planningPrice, 0);
		}
		
		if (v_planningPrice == 0) {
			if (v_strategyPrice == 0) v_planningPrice = v_contractPrice2;
			else v_planningPrice = v_strategyPrice;
		}
		
		// SET
		ds_list.setColumn(row, "planningPrice", v_planningPrice);
	} else {
		v_planningPrice = ds_list.getColumn(row, "planningPrice");
	}

	
	return v_planningPrice;
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 판매단가 SET
 *---------------------------------------------------------------------------------------------*/
function fn_set_mprice_all()
{
	var v_contractId = ds_search.getColumn(ds_search.rowposition, "schContractId");		// 계약번호
	
	var nRowCnt = ds_list.getRowCount();

	if (v_contractId!="NEW") return;
	
	fv_editFlag = "1";
	
	// 저장 시 조건(KEY)을 ds_list의 KEY 값으로 복사
	for (var row = 0 ; row < nRowCnt ; row++)
	{
		var v_strategyPrice = 0;
		var v_strategyRate = ds_list.getColumn(row, "strategyRate");
		var v_contractPrice2 = ds_list.getColumn(row, "contractPrice2");
		var v_planningRate = ds_list.getColumn(row, "planningRate");
		var v_planningPrice = 0;
		var v_marginRate2 = ds_list.getColumn(row, "marginRate2");
		var v_fixedPrice = ds_list.getColumn(row, "fixedPrice");
		var v_salePrice2 = 0;
	
		if (toNumber(v_fixedPrice)==0) {
			// 1) 전략단가 계산
			v_strategyPrice =  v_contractPrice2 * (1 + (v_strategyRate / 100));
			v_strategyPrice = gfn_round(v_strategyPrice, 0);
			if (v_strategyPrice == 0) v_strategyPrice = v_contractPrice2;
			
			// 2) 기획단가 계산
			v_planningPrice = v_strategyPrice * (1 + (v_planningRate / 100));
			v_planningPrice = gfn_round(v_planningPrice, 0);
			if (v_planningPrice == 0) v_planningPrice = v_strategyPrice;
			
			
			// 3) 판매단가 계산
			v_salePrice2 = v_planningPrice * (1 + (v_marginRate2 / 100));
			v_salePrice2 = gfn_round(v_salePrice2, 0);
		} else {
			v_salePrice2 = v_fixedPrice;
		}
		
		// SET
		ds_list.setColumn(row, "strategyPrice", v_strategyPrice);
		ds_list.setColumn(row, "planningPrice", v_planningPrice);
		ds_list.setColumn(row, "salePrice2", v_salePrice2);
	}
	
	fv_editFlag = "";
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 판매단가 SET
 *---------------------------------------------------------------------------------------------*/
function fn_set_mprice(row)
{
	var v_contractId = ds_search.getColumn(ds_search.rowposition, "schContractId");		// 계약번호
	var v_strategyPrice = 0;
	var v_strategyRate = ds_list.getColumn(row, "strategyRate");
	var v_contractPrice2 = ds_list.getColumn(row, "contractPrice2");
	var v_planningRate = ds_list.getColumn(row, "planningRate");
	var v_planningPrice = 0;
	var v_marginRate2 = ds_list.getColumn(row, "marginRate2");
	var v_fixedPrice = ds_list.getColumn(row, "fixedPrice");
	var v_salePrice2 = 0;

	if (v_contractId=="NEW") {
		if (toNumber(v_fixedPrice)==0) {
			// 1) 전략단가 계산
			v_strategyPrice =  v_contractPrice2 * (1 + (v_strategyRate / 100));
			v_strategyPrice = gfn_round(v_strategyPrice, 0);
			if (v_strategyPrice == 0) v_strategyPrice = v_contractPrice2;
			
			// 2) 기획단가 계산
			v_planningPrice = v_strategyPrice * (1 + (v_planningRate / 100));
			v_planningPrice = gfn_round(v_planningPrice, 0);
			if (v_planningPrice == 0) v_planningPrice = v_strategyPrice;
			
			
			// 3) 판매단가 계산
			v_salePrice2 = v_planningPrice * (1 + (v_marginRate2 / 100));
			v_salePrice2 = gfn_round(v_salePrice2, 0);
		} else {
			v_salePrice2 = v_fixedPrice;
		}
		
		// SET
		ds_list.setColumn(row, "strategyPrice", v_strategyPrice);
		ds_list.setColumn(row, "planningPrice", v_planningPrice);
		ds_list.setColumn(row, "salePrice2", v_salePrice2);
	} else {
		v_salePrice2 = ds_list.getColumn(row, "salePrice2");
	}

	
	return v_salePrice2;
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 고객사 검색 팝업 이벤트
 *              
 *---------------------------------------------------------------------------------------------*/
function fn_upjangPop()
{
	// 팝업창을 호출한다	
	var strId       = "FoodMaterialsUpjang";
	var strURL      = "X_FMS::FoodMaterialsUpjangPop.xfdl";
	var objArgument = {
		P_DATASET : ds_search
	};
	
	var nWidth      = 513;
	var nHeight     = 495;
	var strStyle    = "";
	var nLeft       = -1;
	var nTop        = -1;
	var isModeless  = false;
	var bShowTitle  = true;
	var strAlign    = "-1";
	
	// 리턴값을 배열로 받을 경우	
	var arrRtn = gfn_dialog(strId, strURL, objArgument, nWidth, nHeight, strStyle, nLeft, nTop, isModeless, bShowTitle, strAlign);
	
	if (arrRtn instanceof Object)
	{
		edt_upjang.value    = arrRtn["upjangNm"];
		edt_upjang.userdata = arrRtn["upjang"];
		//obj.userdata       = arrRtn["upjangNm"];
		
		// 고객사 조회
		fn_contract();
	}
}

/************************************************************************************************
 * 각 COMPONENT 별 EVENT 영역 (필수)
************************************************************************************************/

/*----------------------------------------------------------------------------------------------
 * 설명      : 고객사 검색 팝업 이벤트
 *              
 *---------------------------------------------------------------------------------------------*/
function btn_upjang_onclick(obj:Button,  e:ClickEventInfo)
{
	fn_upjangPop();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 고객사 검색 콘트롤 이벤트 - 삭제 시 DATA SET Clear
 *              
 *---------------------------------------------------------------------------------------------*/
function edt_upjang_onkeydown(obj:Edit, e:KeyEventInfo)
{
	// Del 키
	if(e.keycode == 46) 
	{	
		// 고객사 정보 초기화
		edt_upjang.value="";
		edt_upjang.userdata="";
		ds_search.setColumn(ds_search.rowposition, "schUpjang", "");
		ds_search.setColumn(ds_search.rowposition, "schUpjangNm", "");
		fn_Trigger_edBtn(obj);
	}

	// Enter 키
	if(e.keycode == 13) 
	{		
		fn_upjangPop();
	}	
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 납품업체 검색 팝업 이벤트
 *              
 *---------------------------------------------------------------------------------------------*/
function btn_cust_onclick(obj:Button,  e:ClickEventInfo)
{

	// 팝업창을 호출한다	
	var strId       = "SaleCustSearch";
	var strURL      = "X_FMS::SalePriceCustSearchPop.xfdl";
	var objArgument = {
		P_DATASET : ds_search
	};
	
	var nWidth      = 513;
	var nHeight     = 495;
	var strStyle    = "";
	var nLeft       = -1;
	var nTop        = -1;
	var isModeless  = false;
	var bShowTitle  = true;
	var strAlign    = "-1";
	
	// 리턴값을 배열로 받을 경우	
	var arrRtn = gfn_dialog(strId, strURL, objArgument, nWidth, nHeight, strStyle, nLeft, nTop, isModeless, bShowTitle, strAlign);
	
	if (arrRtn instanceof Object)
	{
		edt_cust.value    = arrRtn["custNm"];
		edt_cust.userdata = arrRtn["custCd"];
		obj.userdata       = arrRtn["custNm"];
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 납품업체 검색 콘트롤 이벤트 - 삭제 시 DATA SET Clear
 *              
 *---------------------------------------------------------------------------------------------*/
function edt_cust_onkeydown(obj:Edit, e:KeyEventInfo)
{
	// Del 키
	if(e.keycode == 46) 
	{		
		edt_cust.value="";
		edt_cust.userdata="";
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 단가계약번호 COMNBO 변경 시 이벤트 처리
 *              
 *---------------------------------------------------------------------------------------------*/
function cbo_contract_onitemchanged(obj:Combo, e:ItemChangeEventInfo)
{
	// 계약명 표시
	var v_contractId = cbo_contract.value; 
	// 조건 SET 
	var nRow = ds_search.rowposition;
	
	// LIST Clear
	ds_list.clearData();

 	// KEY Clear
 	fv_Key = "";
	
	if (v_contractId=="NEW")
	{	// 신규생성
		fn_contractCompSet("1");
	} else {
		// 기존
		fn_contractCompSet("0");
	}
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 판매단가 목록의 DS 변경 이벤트 처리
 * 해당 Column의 값이 변경될 때에만 적용
 *---------------------------------------------------------------------------------------------*/
function ds_list_oncolumnchanged(obj:Dataset, e:DSColChangeEventInfo)
{
	var v_rate;
	
    switch(e.columnid)
    {
    
		case "contractPrice2" :		// 적용_식재매입단가
			break;
    
        case "contractPriceS2" :	// 적용_매입단가 : EDIT X
			//v_rate = fn_saleRate(e.row, ds_list.getColumn(e.row, "contractPriceS2"));
			//ds_list.setColumn(e.row, "marginRate2", v_rate); 
			//trace("매입단가 변경 마진 재계산");
            break;
            
		case "salePrice2" :			// 적용_판매단가
			if (fv_editFlag == "1") return;
			v_rate = fn_saleRate(e.row, ds_list.getColumn(e.row, "contractPriceS2"));
			trace("v_rate : " + v_rate);
			ds_list.setColumn(e.row, "marginRate2", v_rate); 
			trace("판매단가 변경 마진 재계산");
			break;	

		case "centerFlag2" :		// 적용_센터경유	
			//if (e.newvalue == "1") obj.setColumn(e.row, "centerFlag2", "Y");
			//else obj.setColumn(e.row, "centerFlag2", "N");
			break;
			
	}	

}




function fn_calcAmt(row, gubun)
{
	var v_addPrice = 0; 	// 추가단가
	var v_calcAmt = 0;
	
	v_addPrice = ds_list.getColumn(row, "contractPriceS2");

	if (v_addPrice == 0) return 0;

	trace("gubun : " + gubun);
	v_calcAmt = gfn_ceil(v_addPrice, gubun);
	
	trace("1 : " + Math.ceil(v_addPrice / 10) * 10);
	trace("2 : " + Math.ceil(v_addPrice / 100) * 100);
	trace("3 : " + Math.ceil(v_addPrice / 1000) * 1000);
	
	//v_calcAmt = gfn_round(v_calcAmt, 0);

	return v_calcAmt;
} 

/*----------------------------------------------------------------------------------------------
 * 설명      : 마진일괄작업 클릭 시 이벤트 처리
 *              
 *---------------------------------------------------------------------------------------------*/
function btn_margin_onclick(obj:Button,  e:ClickEventInfo)
{
	var nRowCnt = ds_list.getRowCount();	// DataSet Count

	div_margin.position.right = btn_clsUpload.position.right - 230;
	div_margin.position.width = 220;

	if (div_margin.visible) {
		div_margin.visible = false;
		btn_margin.text = "장려율 적용여부 ▼";
	}
	else {
		// 자료 여부 CHECK
		if(nRowCnt == 0) 
		{
			gfn_alert("msg.err.grid.nodata", "");	// 데이타가 없습니다.
			return;
		}
		div_margin.visible = true;
		btn_margin.text = "장려율 적용여부 ▲";
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 마진일괄작업 - 과세품목 적용
 *---------------------------------------------------------------------------------------------*/
function div_margin_btn_sale_onclick(obj:Button,  e:ClickEventInfo)
{
	fn_saleMargin("1");
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 마진일괄작업 - 면세품목 적용
 *---------------------------------------------------------------------------------------------*/
function div_margin_btn_noSale_onclick(obj:Button,  e:ClickEventInfo)
{
	fn_saleMargin("2");
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 마진일괄작업 - 전체품목 적용
 *---------------------------------------------------------------------------------------------*/
function div_margin_btn_allSale_onclick(obj:Button,  e:ClickEventInfo)
{
	fn_saleMargin("3");
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 판매가올림적용 - 1, 10, 100
 *---------------------------------------------------------------------------------------------*/
function div_margin_btn_price_onclick(obj:Button,  e:ClickEventInfo)
{
	var nRowCnt = ds_list.getRowCount();					// DataSet Count
	var sGubun = div_margin.rdo_price.value;				// 올림구분(1, 2, 3)

	if (nRowCnt < 1) return;
	
	var sRound = div_margin.rdo_price.text;
	
	var sMsg = "일괄 조정작업을 수행합니다.\n계속 진행 하시겠습니까?\n\n";
		sMsg = sMsg + " - 원단위기준 : " + sRound + "\n";
	
	if (!gfn_confirm(sMsg, "", "C")) return;
	
	var v_salePrice = 0;
	var v_rate = 0;
	
	fn_processInit("round");	
	
	ds_list.enableevent = false;
	for (var i = 0 ; i < nRowCnt ; i++)
	{
		v_salePrice = ds_list.getColumn(i, "salePrice2");
		// 금액 재계산(올림 적용)
		v_salePrice = fn_amtRound(sGubun, v_salePrice);
		ds_list.setColumn(i, "salePrice2", v_salePrice);	// 판매금액 SET
		
		// 마진율 재계산
		v_rate = fn_saleRate(i, ds_list.getColumn(i, "contractPriceS2"));
		ds_list.setColumn(i, "marginRate2", v_rate); 
		
	}	// end for
	ds_list.enableevent = true;
	
	fn_processInit("close");
	gfn_alert("msg.action.success");	// 처리 되었습니다.
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 조건관련 Dataset 변경 시 이벤트 처리
 *---------------------------------------------------------------------------------------------*/
function ds_search_oncolumnchanged(obj:Dataset, e:DSColChangeEventInfo)
{
    switch(e.columnid)
    {
		case "schCenter" :			// 센터정보
			ds_list.clearData();
			break;

		case "schUpjang" :			// 고객사
			ds_list.clearData();
			break;
			
		case "schContractId" :		// 계약번호			
			ds_list.clearData();
			break;
    
		case "schDate" :			// 기준일자
			fn_searchDateSet();
			ds_list.clearData();
			break;
			
		case "schCust" :			// 납품업체
			ds_list.clearData();
			break;
	}	
}


// /*----------------------------------------------------------------------------------------------
//  * 설명      : 판매단가 목록에 대한 엑셀 업로드 
//  * 주) 연동 시 SQL 항목 순서와 Dataset 순서를 동일하게 해야 함
//  *---------------------------------------------------------------------------------------------*/
// function btn_clsUpload_onclick(obj:Button,  e:ClickEventInfo)
// {
// 	var nRowCnt = ds_list.getRowCount();	// DataSet Count
// 
// 	// 조회시 Validation Check
// 	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;
// 	
// 	
// 	// 단가목록 여부 CHECK
// 	//if(nRowCnt < 1) 
// 	//{
// 	//	gfn_alert("msg.err.grid.nodata");	// 데이타가 없습니다.
// 	//	return;
// 	//}
// 
// 	this.setWaitCursor(true);
// 
// 	// 파일 선택
// 	var strFileName = gfn_excelFileDialog("LOAD", "EXCEL");
// 
// 	if (strFileName.length == 0)
// 	{
// 		this.setWaitCursor(false);
// 		return;
// 	}
// 
// 	/*********************************************************************************************
// 	** argument             : strFileName		파일명 (경로 포함)
// 	**                        strDsName			Import 대상 Dataset Name
// 	**                        nStartRow			Import 시작 행(사용된 Range 기준, 1 base)
// 	**						  bKeepColInfo		Dataset의 컬럼 정보를 유지할지 여부
// 	*********************************************************************************************/
// 	
// 	var rtn = gfn_importExcel(strFileName, "ds_list", 3, true);
// 	
// 	this.setWaitCursor(false);
// 
// 	var nRow= ds_search.rowposition;
// 
// 	var v_rate;
// 	
// 	// 엑셀 업로드 후 기본정보(코드)를 Ds_list에 복사함
// 	// 저장 시 조건(KEY)을 ds_list의 KEY 값으로 복사
// 	// 엑셀 업로드 후에 Rowtype 속성 변경
// 	ds_list.updatecontrol = false;
// 	for (var i = 0 ; i < nRowCnt ; i++)
// 	{
// 		ds_list.setRowType(i, Dataset.ROWTYPE_INSERT);
// 
// 		// 마진율 계산
// 		v_rate = fn_saleRate(i, ds_list.getColumn(i, "contractPriceS2"));
// 		ds_list.setColumn(i, "marginRate2", v_rate); 
// 		
// 		ds_list.setColumn(i, "centerCode", ds_search.getColumn(nRow, "schCenter"));		
// 		ds_list.setColumn(i, "upjang", ds_search.getColumn(nRow, "schUpjang"));		
// 		ds_list.setColumn(i, "stdDate", ds_search.getColumn(nRow, "schDate"));		
// 		ds_list.setColumn(i, "contractId", ds_search.getColumn(nRow, "schContractId"));		
// 		ds_list.setColumn(i, "contractNm", ds_search.getColumn(nRow, "schContractNm"));		
// 	}
// 	ds_list.updatecontrol = true;
// 
// 	
// 	if (ds_list.getRowCount()>0) {
// 		fv_excelFlag = true;
// 		gfn_alert("msg.copy.success");	// 복사되었습니다
// 	}
// 	else {
// 		gfn_alert("msg.err.grid.nodata");	// 데이타가 없습니다
// 	}
// 	
// 	//trace(ds_list.saveXML());
// }

/*----------------------------------------------------------------------------------------------
 * 설명      : 판매단가 목록에 대한 엑셀 업로드 
 * 주) 연동 시 SQL 항목 순서와 Dataset 순서를 동일하게 해야 함
 *---------------------------------------------------------------------------------------------*/
function btn_clsUpload_onclick(obj:Button,  e:ClickEventInfo)
{
	var nRowCnt = ds_list.getRowCount();	// DataSet Count

	// 조회시 Validation Check
	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;
	
	
	// 목록 여부 CHECK
	if(nRowCnt < 1) 
	{
		gfn_alert("msg.err.grid.nodata");	// 데이타가 없습니다.
		return;
	}

	this.setWaitCursor(true);

	// 파일 선택
	var strFileName = gfn_excelFileDialog("LOAD", "EXCEL");

	if (strFileName.length == 0)
	{
		this.setWaitCursor(false);
		return;
	}

	/*********************************************************************************************
	** argument             : strFileName		파일명 (경로 포함)
	**                        strDsName			Import 대상 Dataset Name
	**                        nStartRow			Import 시작 행(사용된 Range 기준, 1 base)
	**						  bKeepColInfo		Dataset의 컬럼 정보를 유지할지 여부
	*********************************************************************************************/
	
	var rtn = gfn_importExcel(strFileName, "ds_excel", 3, true);
	
	this.setWaitCursor(false);

	var nRow= ds_search.rowposition;

	// 이익율 기준일자
	var v_Pdate = "";
	if (cal_date.text.substr(6,2) > "15") v_Pdate = cal_date.text.substr(0,4) + cal_date.text.substr(4,2) + "16";
	else v_Pdate = cal_date.text.substr(0,4) + cal_date.text.substr(4,2) + "01";

	// 엑셀업로드 처리관련 변수
	var v_itemCode;
	var v_rate;
	var iRow = 0;
	var v_upload = "";

	// 엑셀 업로드 후 기본정보(코드)를 Ds_list에 복사함
	// 저장 시 조건(KEY)을 ds_list의 KEY 값으로 복사
	// 엑셀 업로드 후에 Rowtype 속성 변경
	//ds_excel.updatecontrol = false;
	for (var i = 0 ; i < ds_excel.getRowCount() ; i++)
	{
		//ds_excel.setRowType(i, Dataset.ROWTYPE_INSERT);
		v_itemCode = ds_excel.getColumn(i, "itemCode");
		
		// 자재코드가 없으면 PASS
		if (v_itemCode=="") continue;
		
		// 기존 ds_list에서 Key값을 찾는다 : 실제 itemCode 기준으로 검색
		var nfindRow = ds_list.findRowExpr("itemCode=='" + v_itemCode + "'");
		
		if (nfindRow != -1) {
		// 신규 : 행추가하여 반영 ---- 제외
			//v_upload = "Y";
			//ds_list.addRow();
			//iRow = ds_list.rowposition;
			//ds_list.copyRow(iRow, ds_excel, i);
			//nfindRow = i;		// 해당 ROW를 SET
		//} else {
		// 기존자료 변경
			v_upload = "N";
			if (gfn_isNull(ds_excel.getColumn(i, "salePrice2")))
				ds_list.setColumn(nfindRow, "salePrice2", 0);		// 판매단가 변경	
			else
				ds_list.setColumn(nfindRow, "salePrice2", ds_excel.getColumn(i, "salePrice2"));		// 판매단가 변경	
			//ds_list.setColumn(nfindRow, "centerFlag2", ds_excel.getColumn(i, "centerFlag2"));	// 센터
		}
		
		// 마진율 재계산 : 공통
		v_rate = fn_saleRate(nfindRow, ds_list.getColumn(nfindRow, "contractPriceS2"));
		ds_list.setColumn(nfindRow, "marginRate2", v_rate); 
		
		ds_list.setColumn(nfindRow, "centerCode", ds_search.getColumn(nRow, "schCenter"));		
		ds_list.setColumn(nfindRow, "upjang", ds_search.getColumn(nRow, "schUpjang"));
		ds_list.setColumn(nfindRow, "stdDate", ds_search.getColumn(nRow, "schDate"));		
		ds_list.setColumn(nfindRow, "stdDate2", ds_search.getColumn(nRow, "schDate2"));		
		ds_list.setColumn(nfindRow, "contractId", ds_search.getColumn(nRow, "schContractId"));		
		ds_list.setColumn(nfindRow, "contractNm", ds_search.getColumn(nRow, "schContractNm"));
		ds_list.setColumn(nfindRow, "stdPdate", v_Pdate);		// 전략이익율 기준일자 SET
		
		// 엑셀업로드 시에는 PO_CONTRACT_ID(구매계약번호)를 초기화한다
		// 저장 시에 PO_CONTRACT_F를 재조회하여 값을 변경함
		if (v_upload=="Y") {
			ds_list.setColumn(nfindRow, "poContractId", "");		
		}
		
	}
	//ds_excel.updatecontrol = true;

	
	if (ds_excel.getRowCount()>0) {
		fv_excelFlag = true;
		gfn_alert("msg.copy.success");	// 복사되었습니다
	}
	else {
		gfn_alert("msg.err.grid.nodata");	// 데이타가 없습니다
	}
	
	//trace(ds_list.saveXML());
}



function ds_list_cancolumnchange(obj:Dataset, e:DSColChangeEventInfo)
{
	//alert("11111");
	//trace(obj.getColumn(e.row, "itemCode"));
	if(obj.findRow("itemCode", e.newvalue) > 0)
	{
		alert("중복 값이 존재합니다.");
		return false;
	}

}

/*----------------------------------------------------------------------------------------------
 * 설명      : 센터 COMNBO 변경 시 이벤트 처리
 *              
 *---------------------------------------------------------------------------------------------*/
function cbo_centerCode_onitemchanged(obj:Combo, e:ItemChangeEventInfo)
{
	fn_Trigger_edBtn(obj);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 그리드 COMP 의 적용단가구성의 센터 CHECK 이벤트 처리
 *              
 *---------------------------------------------------------------------------------------------*/
function grd_list_oncellclick(obj:Grid, e:GridClickEventInfo)
{
	var nCell = e.cell;
	var nRow = e.row;
	var nVal = "";
	
	// 적용_센터경유 CHECK
// 	if (nCell == 20) {
// 		if (ds_list.getColumn(ds_list.rowposition, "centerFlag2")=="Y") nVal = "N";
// 		else nVal = "Y";
// 	
// 		ds_list.setColumn(ds_list.rowposition, "centerFlag2", nVal);
// 	}
	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 판매단가 생성 오류 메시지 확인 팝업
 *              
 *---------------------------------------------------------------------------------------------*/
function btn_errorView_onclick(obj:Button,  e:ClickEventInfo)
{
	var arrParam = new Array();

	// 전송할 파라미터 1 : 오류메시지
	arrParam[0] = fv_errorMsg;												

	var rtnVal = gfn_dialog("SalePriceAutoPop"					// Dialog ID
							, "X_FMS::SalePriceAutoPop.xfdl"	// Form URL
							, {fv_Contents:arrParam}			// 배열
							, null, null, null, null, null, false, true, -1);
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 자재추가 버튼
 *              
 *---------------------------------------------------------------------------------------------*/
function btn_itemAdd_onclick(obj:Button,  e:ClickEventInfo)
{
	// 조회조건 기준으로 CHECK
	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;

	var sDate = cal_date.text.substr(0,4) + "-" + cal_date.text.substr(4,2) + "-" + cal_date.text.substr(6,2);
	
	// 업장명을 ds_search에 복사 : 팝업화면 상단에 표시
	var nRow= ds_search.rowposition;
	ds_search.setColumn(nRow, "schUpjangNm", edt_upjang.text);	
	ds_search.setColumn(nRow, "schDateDisp", sDate);	

	fn_itemAdd();
}

// 임시 저장 테스트
function Button01_onclick(obj:Button,  e:ClickEventInfo)
{
	fn_save_old();
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 그리드 검색 버튼
 *              
 *---------------------------------------------------------------------------------------------*/
function btn_gridSearch_onclick(obj:Button,  e:ClickEventInfo)
{
	var nRowCnt = ds_list.getRowCount();	// DataSet Count
	
	// 목록 여부 CHECK
	if(nRowCnt < 1) 
	{
		gfn_alert("msg.err.grid.nodata");	// 데이타가 없습니다.
		return;
	}


	var strId       = "FoodMaterialsGridFind";
	var strURL      = "X_FMS::FoodMaterialsGridFind.xfdl";
	var objArgument = {arg1:this, arg2:this.grd_list, arg3:"2"};
	var nWidth      = -1;
	var nHeight     = -1;
	var strStyle    = "";	
	var nLeft       = -1;
	var nTop        = -1;
	var isModeless  = false;
	var bShowTitle  = true;
	var strAlign    = "-1";

	var vRtn = gfn_dialog(strId, strURL, objArgument, nWidth, nHeight, strStyle, nLeft, nTop, isModeless, bShowTitle, strAlign);
	
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 엑셀다운로드 
 * 공통기능 사용하지 않고 별도로 구현
 *---------------------------------------------------------------------------------------------*/
function grd_list_onheadclick(obj:Grid, e:GridClickEventInfo)
{
    // 엑셀 아이콘시에 엑셀 다운로드
    var strHeadClass = obj.getCellProperty("head", e.col,"class");
    if(strHeadClass == "head_Excel")
    {
		fn_excelDown();
		return;
    } else gfn_gridSort(obj, e);
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 엑셀다운로드 
 *---------------------------------------------------------------------------------------------*/
function fn_excelDown()
{
	var titleName = "판매단가";
	var exportObj = new ExportObject();	
	exportObj.clear();
	exportObj.exporttype = ExportTypes.EXCEL;
	
	var fileName = titleName + "_" + gfn_todayTime() + ".xlsx";
	var sheetName = titleName;
	
	exportObj.activepagename = sheetName;
	exportObj.exportfilename = fileName;	
	exportObj.exportopenmode = "overwrite";
	
	var ret = exportObj.addExportItem(ExportItemTypes.GRID, grd_list, sheetName + "!A1", "" ,"" ,"" ,"" ,"onlyvalue");
	
	exportObj.exporteventtype = "itemrecord";
	exportObj.exportuitype = "exportprogress";
	exportObj.exportmessageprocess = "엑셀을 생성중 입니다."; 

	var result = exportObj.export();
	exportObj == null;
}



// 차감 바코드
//  N      N     -> default  
//  Y      N     -> w_income_price
//  N      Y     -> w_barcode
//  Y      Y     -> w_income_price_barcode


function cbo_income_price_onitemchanged(obj:Combo, e:ItemChangeEventInfo) {
	switch (e.postvalue) {
		case "Y" :
			if(cbo_winItem_code.value == "N") {  
				grd_list.setFormat("w_income_price"); // Y N
				break;
			} else {
				grd_list.setFormat("w_income_price_barcode"); // Y Y
				break;
			}
		case "N" :
			if(cbo_winItem_code.value == "N") {  
				grd_list.setFormat("default"); //  N N
				break;
			} else {
				grd_list.setFormat("w_barcode"); // N Y
				break;
			}
	}
}

function cbo_winItem_code_onitemchanged(obj:Combo, e:ItemChangeEventInfo) {
	switch (e.postvalue) {
		case "Y" :
			if(cbo_income_price.value == "N") { 
				grd_list.setFormat("w_barcode");  // N Y
				break;
			} else { 
				grd_list.setFormat("w_income_price_barcode");  // Y Y
				break;
			}
		case "N" :
			if(cbo_income_price.value == "N") { 
				grd_list.setFormat("default");  // N N
				break;
			} else { 
				grd_list.setFormat("w_income_price"); // Y N
				break;
			}
	}
}
]]></Script>
  </Form>
</FDL>
