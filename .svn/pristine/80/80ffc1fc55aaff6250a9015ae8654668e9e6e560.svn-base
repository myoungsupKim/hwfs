<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="../../../default_typedef.xml"/>
  <Form id="FSC00041V" onkeydown="frm_OnKeyDown" onload="form_onload" titletext="분기별" position="absolute 0 0 1235 554" scrollbars="none" style="background:#ffffffff;">
    <Layouts>
      <Layout>
        <Grid autoenter="select" binddataset="ds_list" cellsizingtype="both" readonly="false" enable="true" id="grd_list" useinputpanel="false" oncelldblclick="grd_list_OnCellDblClick" onheadclick="grd_List_OnHeadClick" taborder="1" tabstop="true" usecontextmenu="true" useselcolor="true" visible="true" position="absolute 10 10 1225 303" selecttype="row" anchor="left top right" suppresslevel="sameskip">
          <Formats>
            <Format id="Default">
              <Columns>
                <Column size="30" band="left"/>
                <Column size="80" band="left"/>
                <Column size="90" band="left"/>
                <Column size="60" band="left"/>
                <Column size="60" band="left"/>
                <Column size="60" band="left"/>
                <Column size="60" band="left"/>
                <Column size="60" band="left"/>
                <Column size="60" band="left"/>
                <Column size="3" band="left"/>
                <Column size="60"/>
                <Column size="60"/>
                <Column size="60"/>
                <Column size="60"/>
                <Column size="60"/>
                <Column size="60"/>
                <Column size="60"/>
                <Column size="60"/>
                <Column size="60"/>
                <Column size="60"/>
                <Column size="60"/>
                <Column size="60"/>
                <Column size="60"/>
                <Column size="60"/>
                <Column size="60"/>
                <Column size="60"/>
                <Column size="60"/>
                <Column size="60"/>
                <Column size="60"/>
                <Column size="60"/>
              </Columns>
              <Rows>
                <Row size="24" band="head"/>
                <Row size="24" band="head"/>
                <Row size="24"/>
                <Row size="22" band="summ"/>
              </Rows>
              <Band id="head">
                <Cell rowspan="2" displaytype="text" class="head_Excel"/>
                <Cell col="1" rowspan="2" displaytype="text" text="사업부"/>
                <Cell col="2" rowspan="2" displaytype="text" text="운영부서"/>
                <Cell col="3" rowspan="2" displaytype="text" text="대팀장"/>
                <Cell col="4" rowspan="2" displaytype="text" text="소팀장"/>
                <Cell col="5" rowspan="2" displaytype="text" text="운영업장&#10;갯수"/>
                <Cell col="6" rowspan="2" displaytype="text" text="점검횟수&#10;누계"/>
                <Cell col="7" rowspan="2" displaytype="text" text="평균점수"/>
                <Cell col="8" rowspan="2" displaytype="text" text="평균&#10;부적합률"/>
                <Cell col="9" rowspan="2" displaytype="text"/>
                <Cell col="10" colspan="5" displaytype="text" text="1분기"/>
                <Cell col="15" colspan="5" displaytype="text" text="2분기"/>
                <Cell col="20" colspan="5" displaytype="text" text="3분기"/>
                <Cell col="25" colspan="5" displaytype="text" text="4분기"/>
                <Cell row="1" col="10" displaytype="text" text="상승률"/>
                <Cell row="1" col="11" displaytype="text" text="점검횟수"/>
                <Cell row="1" col="12" displaytype="text" text="평균점수"/>
                <Cell row="1" col="13" displaytype="text" text="부적합수"/>
                <Cell row="1" col="14" displaytype="text" text="부적합률"/>
                <Cell row="1" col="15" displaytype="text" text="상승률"/>
                <Cell row="1" col="16" displaytype="text" text="점검횟수"/>
                <Cell row="1" col="17" displaytype="text" text="평균점수"/>
                <Cell row="1" col="18" displaytype="text" text="부적합수"/>
                <Cell row="1" col="19" displaytype="text" text="부적합률"/>
                <Cell row="1" col="20" displaytype="text" text="상승률"/>
                <Cell row="1" col="21" displaytype="text" text="점검횟수"/>
                <Cell row="1" col="22" displaytype="text" text="평균점수"/>
                <Cell row="1" col="23" displaytype="text" text="부적합수"/>
                <Cell row="1" col="24" displaytype="text" text="부적합률"/>
                <Cell row="1" col="25" displaytype="text" text="상승률"/>
                <Cell row="1" col="26" displaytype="text" text="점검횟수"/>
                <Cell row="1" col="27" displaytype="text" text="평균점수"/>
                <Cell row="1" col="28" displaytype="text" text="부적합수"/>
                <Cell row="1" col="29" displaytype="text" text="부적합률"/>
              </Band>
              <Band id="body">
                <Cell displaytype="text" style="align:center middle;background:#ffffff;background2:#ffffffff;" expr="expr:currow+1"/>
                <Cell col="1" displaytype="text" style="background:EXPR(iif(getRowLevel(currow)==3,'#ff8b4dff','#ffffff'));background2:EXPR(iif(getRowLevel(currow)==3,'#ff8b4dff','#ffffff'));" text="bind:MU_NM" subsumtext="expr:(getRowLevel(currow) == 3) ? &quot;사업부계&quot;:&quot;&quot;" suppress="1"/>
                <Cell col="2" displaytype="text" style="background:EXPR(iif(getRowLevel(currow)==2,'#ffcfb5ff',iif(getRowLevel(currow)==3,'#ff8b4dff','#ffffff')));background2:EXPR(iif(getRowLevel(currow)==2,'#ffcfb5ff',iif(getRowLevel(currow)==3,'#ff8b4dff','#ffffff')));" text="bind:TM_NM" subsumtext="expr:(getRowLevel(currow) == 2) ? &quot;운영부서계&quot;:&quot;&quot;" suppress="2"/>
                <Cell col="3" displaytype="text" style="background:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));background2:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));" text="bind:TEAM_MST_NM" subsumtext="expr:(getRowLevel(currow) == 1) ? &quot;소계&quot;:&quot;&quot;" suppress="3"/>
                <Cell col="4" displaytype="text" style="background:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff', iif(getRowLevel(currow)==2, '#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));background2:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff', iif(getRowLevel(currow)==2, '#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));" text="bind:SUBTEAM_MST_NM"/>
                <Cell col="5" displaytype="number" style="background:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff', iif(getRowLevel(currow)==2, '#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));background2:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff', iif(getRowLevel(currow)==2, '#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));" text="bind:UPJ_TOT"/>
                <Cell col="6" displaytype="number" style="background:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));background2:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));" text="bind:CNT_TOT"/>
                <Cell col="7" displaytype="number" style="background:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));background2:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));" expr="expr:Math.round(SCORE_TOT/CNT_TOTR,1)" mask="#0.0"/>
                <Cell col="8" displaytype="number" style="background:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));background2:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));" expr="expr:gfn_parseFloat(numFormat(NOT_FIT_TOT/CNT_TOT*100,1))" mask="#0.0%"/>
                <Cell col="9" displaytype="text" style="align: ;"/>
                <Cell col="10" displaytype="number" style="align: ;background:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));background2:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));" expr="expr:gfn_parseFloat(numFormat(((SCORE1/CNTR1)-(SCORE0/CNTR0))/(SCORE0/CNTR0)*100,1))" mask="#0.0%"/>
                <Cell col="11" displaytype="number" style="align: ;background:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));background2:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));" text="bind:CNT1"/>
                <Cell col="12" displaytype="number" style="align: ;background:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));background2:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));" expr="expr:gfn_parseFloat(Math.round(SCORE1/CNTR1,1))" mask="#0.0"/>
                <Cell col="13" displaytype="number" style="align: ;background:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));background2:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));" text="bind:NOT_FIT1"/>
                <Cell col="14" displaytype="number" style="align: ;background:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));background2:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));" expr="expr:gfn_parseFloat((numFormat(NOT_FIT1/CNT1*100,1))" mask="#0.0%"/>
                <Cell col="15" displaytype="number" style="align: ;background:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));background2:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));" expr="expr:gfn_parseFloat(numFormat(((SCORE2/CNTR2)-(SCORE1/CNTR1))/(SCORE1/CNTR1)*100,1))" mask="#0.0%"/>
                <Cell col="16" displaytype="number" style="align: ;background:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));background2:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));" text="bind:CNT2"/>
                <Cell col="17" displaytype="number" style="align: ;background:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));background2:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));" expr="expr:gfn_parseFloat(Math.round(SCORE2/CNTR2,1))" mask="#0.0"/>
                <Cell col="18" displaytype="number" style="align: ;background:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));background2:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));" text="bind:NOT_FIT2"/>
                <Cell col="19" displaytype="number" style="align: ;background:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));background2:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));" expr="expr:gfn_parseFloat(numFormat(NOT_FIT2/CNT2*100,1))" mask="#0.0%"/>
                <Cell col="20" displaytype="number" style="align: ;background:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));background2:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));" expr="expr:gfn_parseFloat(numFormat(((SCORE3/CNTR3)-(SCORE2/CNTR2))/(SCORE2/CNTR2)*100,1))" mask="#0.0%"/>
                <Cell col="21" displaytype="number" style="align: ;background:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));background2:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));" text="bind:CNT3"/>
                <Cell col="22" displaytype="number" style="align: ;background:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));background2:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));" expr="expr:gfn_parseFloat(Math.round(SCORE3/CNTR3,1))" mask="#0.0"/>
                <Cell col="23" displaytype="number" style="align: ;background:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));background2:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));" text="bind:NOT_FIT3"/>
                <Cell col="24" displaytype="number" style="align: ;background:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));background2:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));" expr="expr:gfn_parseFloat(numFormat(NOT_FIT3/CNT3*100,1))" mask="#0.0%"/>
                <Cell col="25" displaytype="number" style="align: ;background:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));background2:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));" expr="expr:gfn_parseFloat(numFormat(((SCORE4/CNTR4)-(SCORE3/CNTR3))/(SCORE3/CNTR3)*100,1))" mask="#0.0%"/>
                <Cell col="26" displaytype="number" style="align: ;background:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));background2:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));" text="bind:CNT4"/>
                <Cell col="27" displaytype="number" style="align: ;background:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));background2:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));" expr="expr:gfn_parseFloat(Math.round(SCORE4/CNTR4,1))" mask="#0.0"/>
                <Cell col="28" displaytype="number" style="align: ;background:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));background2:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));" text="bind:NOT_FIT4"/>
                <Cell col="29" displaytype="number" style="align: ;background:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));background2:EXPR(iif(getRowLevel(currow)==1,'#e7e7ffff',iif(getRowLevel(currow)==2,'#ffcfb5ff', iif(getRowLevel(currow)==3, '#ff8b4dff','#ffffff'))));" expr="expr:gfn_parseFloat(numFormat(NOT_FIT4/CNT4*100,1))" mask="#0.0%"/>
              </Band>
              <Band id="summary">
                <Cell colspan="6" displaytype="text" style="align:center;" text="합    계" taborder="undefined"/>
                <Cell col="6" displaytype="number" style="align: ;" expr="expr:TotalSum(ds_list,'CNT_TOT')"/>
                <Cell col="7" displaytype="number" style="align: ;" expr="expr:gfn_parseFloat(Math.round(TotalSum(ds_list,'SCORE_TOT')/TotalSum(ds_list,'CNT_TOTR'),1))" mask="#0.0"/>
                <Cell col="8" displaytype="number" style="align: ;" expr="expr:gfn_parseFloat(numFormat(TotalSum(ds_list,'NOT_FIT_TOT')/TotalSum(ds_list,'CNT_TOT')*100,1))" mask="#0.0%"/>
                <Cell col="9" displaytype="text" style="align: ;"/>
                <Cell col="10" displaytype="number" style="align: ;" expr="expr:gfn_parseFloat(numFormat((TotalSum(ds_list,'SCORE1')/TotalSum(ds_list,'CNTR1')-TotalSum(ds_list,'SCORE0')/TotalSum(ds_list,'CNTR0'))/(TotalSum(ds_list,'SCORE0')/TotalSum(ds_list,'CNTR0'))*100,1))" mask="#0.0%"/>
                <Cell col="11" displaytype="number" style="align: ;" expr="expr:TotalSum(ds_list,'CNT1')"/>
                <Cell col="12" displaytype="number" style="align: ;" expr="expr:gfn_parseFloat(Math.round(TotalSum(ds_list,'SCORE1')/TotalSum(ds_list,'CNTR1'),1))" mask="#0.0"/>
                <Cell col="13" displaytype="number" style="align: ;" expr="expr:TotalSum(ds_list,'NOT_FIT1')"/>
                <Cell col="14" displaytype="number" style="align: ;" expr="expr:gfn_parseFloat(numFormat(TotalSum(ds_list,'NOT_FIT1')/TotalSum(ds_list,'CNT1')*100,1))" mask="#0.0%"/>
                <Cell col="15" displaytype="number" style="align: ;" expr="expr:gfn_parseFloat(numFormat((TotalSum(ds_list,'SCORE2')/TotalSum(ds_list,'CNTR2')-TotalSum(ds_list,'SCORE1')/TotalSum(ds_list,'CNTR1'))/(TotalSum(ds_list,'SCORE1')/TotalSum(ds_list,'CNTR1'))*100,1))" mask="#0.0%"/>
                <Cell col="16" displaytype="number" style="align: ;" expr="expr:TotalSum(ds_list,'CNT2')"/>
                <Cell col="17" displaytype="number" style="align: ;" expr="expr:gfn_parseFloat(Math.round(TotalSum(ds_list,'SCORE2')/TotalSum(ds_list,'CNTR2'),1))" mask="#0.0"/>
                <Cell col="18" displaytype="number" style="align: ;" expr="expr:TotalSum(ds_list,'NOT_FIT2')"/>
                <Cell col="19" displaytype="number" style="align: ;" expr="expr:gfn_parseFloat(numFormat(TotalSum(ds_list,'NOT_FIT2')/TotalSum(ds_list,'CNT2')*100,1))" mask="#0.0%"/>
                <Cell col="20" displaytype="number" style="align: ;" expr="expr:gfn_parseFloat(numFormat((TotalSum(ds_list,'SCORE3')/TotalSum(ds_list,'CNTR3')-TotalSum(ds_list,'SCORE2')/TotalSum(ds_list,'CNTR2'))/(TotalSum(ds_list,'SCORE2')/TotalSum(ds_list,'CNTR2'))*100,1))" mask="#0.0%"/>
                <Cell col="21" displaytype="number" style="align: ;" expr="expr:TotalSum(ds_list,'CNT3')"/>
                <Cell col="22" displaytype="number" style="align: ;" expr="expr:gfn_parseFloat(Math.round(TotalSum(ds_list,'SCORE3')/TotalSum(ds_list,'CNTR3'),1))" mask="#0.0"/>
                <Cell col="23" displaytype="number" style="align: ;" expr="expr:TotalSum(ds_list,'NOT_FIT3')"/>
                <Cell col="24" displaytype="number" style="align: ;" expr="expr:gfn_parseFloat(numFormat(TotalSum(ds_list,'NOT_FIT3')/TotalSum(ds_list,'CNT3')*100,1))" mask="#0.0%"/>
                <Cell col="25" displaytype="number" style="align: ;" expr="expr:gfn_parseFloat(numFormat((TotalSum(ds_list,'SCORE4')/TotalSum(ds_list,'CNTR4')-TotalSum(ds_list,'SCORE3')/TotalSum(ds_list,'CNTR3'))/(TotalSum(ds_list,'SCORE3')/TotalSum(ds_list,'CNTR3'))*100,1))" mask="#0.0%"/>
                <Cell col="26" displaytype="number" style="align: ;" expr="expr:TotalSum(ds_list,'CNT4')"/>
                <Cell col="27" displaytype="number" style="align: ;" expr="expr:gfn_parseFloat(Math.round(TotalSum(ds_list,'SCORE4')/TotalSum(ds_list,'CNTR4'),1))" mask="#0.0"/>
                <Cell col="28" displaytype="number" style="align: ;" expr="expr:TotalSum(ds_list,'NOT_FIT4')"/>
                <Cell col="29" displaytype="number" style="align: ;" expr="expr:gfn_parseFloat(numFormat(TotalSum(ds_list,'NOT_FIT4')/TotalSum(ds_list,'CNT4')*100,1))" mask="#0.0%"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Grid autoenter="select" binddataset="ds_DetailPivot" cellsizingtype="both" readonly="false" enable="true" id="grd_Detail" useinputpanel="false" oncelldblclick="grd_Detail_OnCellDblClick" onheadclick="grd_List_OnHeadClick" taborder="3" tabstop="true" usecontextmenu="true" useselcolor="true" visible="true" position="absolute 10 323 1225 544" selecttype="row" anchor="left right bottom">
          <Formats>
            <Format id="Default">
              <Columns>
                <Column size="30" band="left"/>
                <Column size="50" band="left"/>
                <Column size="60" band="left"/>
                <Column size="120" band="left"/>
                <Column size="50" band="left"/>
                <Column size="50" band="left"/>
                <Column size="50" band="left"/>
                <Column size="70" band="left"/>
                <Column size="3" band="left"/>
              </Columns>
              <Rows>
                <Row size="24" band="head"/>
                <Row size="24" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell rowspan="2" displaytype="image" class="head_Excel"/>
                <Cell col="1" rowspan="2" text="직군"/>
                <Cell col="2" rowspan="2" displaytype="text" text="상세직군"/>
                <Cell col="3" rowspan="2" text="사업장"/>
                <Cell col="4" rowspan="2" displaytype="text" text="평균&#10;점수"/>
                <Cell col="5" rowspan="2" displaytype="text" text="점검횟수&#10;누계"/>
                <Cell col="6" rowspan="2" text="평균&#10;등급"/>
                <Cell col="7" rowspan="2" text="부적합&#10;누계"/>
                <Cell col="8" rowspan="2"/>
              </Band>
              <Band id="body">
                <Cell displaytype="text" style="align:center middle;" expr="expr:currow+1"/>
                <Cell col="1" displaytype="text" style="align: ;" text="bind:JOB_NAME"/>
                <Cell col="2" displaytype="text" style="align: ;" text="bind:SUB_JOB_NAME"/>
                <Cell col="3" displaytype="text" style="align: ;" text="bind:UPJANGNM"/>
                <Cell col="4" displaytype="number" style="align: ;" expr="expr:gfn_parseFloat(Math.round(getSum('TOT_SCORE',currow)/getSum('CNT',currow),1))"/>
                <Cell col="5" displaytype="number" style="align: ;" text="bind:RST_CNT"/>
                <Cell col="6" style="align: ;" expr="expr:fn_GetGrade(currow)"/>
                <Cell col="7" displaytype="number" style="align: ;" expr="expr:getSum('NOT_FIT',currow)"/>
                <Cell col="8" style="align: ;"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Splitter type="vertical" id="sp_line" onmove="sp_line_OnMove" position="absolute 10 303 1225 308" min="303">
          <Formats>
            <Format id="default">
              <SplitterItems id="items">
                <SplitterItem id="item00" position="leftortop" bindtype="resize" componentid="grd_list"/>
                <SplitterItem id="item01" position="leftortop" bindtype="resize" componentid="st_bk1"/>
                <SplitterItem id="item02" position="rightorbottom" bindtype="resize" componentid="grd_Detail"/>
                <SplitterItem id="item03" position="rightorbottom" bindtype="resize" componentid="st_bk2"/>
              </SplitterItems>
            </Format>
          </Formats>
        </Splitter>
        <Static id="Static58" text="w10" class="Guide01_AreaRed" visible="false" position="absolute 0 0 10 406"/>
        <Static id="Static59" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 11 544 1226 554"/>
        <Static id="Static61" text="w10" class="Guide01_AreaRed" visible="false" position="absolute 1225 249 1235 511"/>
        <Static id="Static12" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 10 308 460 323" anchor="left top"/>
        <Static id="Static00" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 10 0 1225 10"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_list" keystring="G:MU_NM,TM_NM,TEAM_MST_NM"/>
      <Dataset id="ds_Detail">
        <ColumnInfo>
          <Column id="CHECK_DATE" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_DetailPivot">
        <ColumnInfo>
          <Column id="Column0" type="STRING" size="256"/>
          <Column id="Column1" type="STRING" size="256"/>
          <Column id="Column2" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Script type="xscript4.0"><![CDATA[include "U_lib::lib_conversionCom.xjs";
/*
 ******************************************************************************************
 * 시스템구분   : 메뉴관리/위생관리/운영부서별 점검결과 조회
 * 프로그램명   : FSC90041V.XML
 * 기      능   : 운영부서별 점검결과 조회-분기별
 * 작  성  자   : 박지영
 * 작성  일자   : 2008-03-31
 * 비      고   : 
 *		- ds_input				: [input DS] 조회조건 파라미터 DS
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
                 1)박은규 2012-10-22 CSR#(CH201210_00118) 요청자:홍호준(식품연구소)
                  운영사업장 전체갯수, 부적합사업장 갯수 표시(상단)
                  사업장별 누적 점검횟수 표시(하단), 년도별 조회에서 기간별 조회로 변경
******************************************************************************************
 */
//=========================================================================================
// [ PART 1 ]
// Form에서 Include 할 내용을 정의
//
//=========================================================================================
//@@컨버터에서 주석처리 #include "lib::sc_comon.js"
//@@컨버터에서 주석처리 #include "LIB::lib_comm_0001.js"
//@@컨버터에서 주석처리 #include "lib::tit_comm_0001.js"		// X-Framework Lib
//@@컨버터에서 주석처리 #include "lib::sc_sql_common.js"
//=========================================================================================
// [ PART 2 ]
// Form에서 사용될 전역변수를 선언
//
//=========================================================================================
//=========================================================================================
// [ PART 3 ]
// Form Loading 시 작업 정의
//
//=========================================================================================
function form_onload(obj:Form, e:LoadEventInfo)
{
	gfn_formOnLoad(obj, false);

	
}

function frm_OnKeyDown(obj:Form, e:KeyEventInfo)
{
	gfn_formKeyDown(obj, e); //(obj,e.fromreferenceobject,e.keycode,e.shiftKey,e.ctrlKey,e.altKey,-1,-1);
}
//=========================================================================================
// [ PART 4 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,도움말,form닫기)
//
//=========================================================================================
/*
 ******************************************************************************************
 * 함  수  명   : fn_Search()
 * 기      능   : [조회버튼] 검색조건에 해당하는 정보를 조회
 ******************************************************************************************
 */
function fn_search()
{
	// 초기화
	ds_list.clearData();
	ds_Detail.clearData();
	
	//============================================================================================
	//(2012-10-22 수정) 시작
	// 박은규 2012-10-22 CSR#(CH201210_00118) 요청자:홍호준(식품연구소)
	// 년도조회에서 기간조회로 변경
	//============================================================================================
	//ds_input.SetColumn(0,"PRE_YEAR",toNumber(sp_YEAR.Value)-1);
	//============================================================================================
	//(2012-10-22 수정) 끝
	//============================================================================================
	
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	
	actionName		= "FSC90041V_T001";
	cmdName			= "U_svc::" + "fs/fsc/FSC90041V_T001.jsp";
	inData			= "ds_input=ds_input";
	outData			= "ds_list=ds_list";
	callBackFnc		= "fn_afterSearchList";
	
	jsp_transaction(this,actionName, cmdName ,inData ,outData,otherArg,callBackFnc,true,false,false);
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_Print()
 * 기      능   : [출력버튼] 출력 시 처리되는 작업
 ******************************************************************************************
 */
function fn_print()
{
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_Excel()
 * 기      능   : [엑셀버튼] 엑셀 시 처리되는 작업
 ******************************************************************************************
 */
function fn_Excel()
{
	gfn_exportExcel(grd_list, "Sheet1");
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_Close()
 * 기      능   : [닫기버튼] 화면을 닫을때 처리되는 작업
 ******************************************************************************************
 */
function fn_Close()
{
	this.close();
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_Help()
 * 기      능   : [도움말버튼] 도움말
 ******************************************************************************************
 */
function fn_help()
{
	// tit_addSearchActionInfo(this, "fs/fsm:SCC_MENU_SELECT");
	// tit_callService(this, "", "", "ds_cond=ds_cond", "ds_Menu=ds_list", "", "");	
}
//=========================================================================================
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
//
//=========================================================================================
/*
 ******************************************************************************************
 * 함  수  명   : fn_SearchSub1(nRow)
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 상세내역 조회
 * 작  성  자   : 박지영
 * 작성  일자   : 2008-03-18  
 ******************************************************************************************
 */
function fn_SearchSub(nRow)
{
	if (nRow < 0)
	{
		return;
	}
	
	// 초기화
	ds_Detail.clearData();
	
	// 조회
	var actionName, cmdName, inData, outData, otherArg,callBackFnc;
	
	ds_input.setColumn(0,"MST_TM_CD",ds_list.getColumn(nRow,"TM_CD"));
	ds_input.setColumn(0,"MST_TEAM_MST_SABUN",ds_list.getColumn(nRow,"TEAM_MST_SABUN"));
	ds_input.setColumn(0,"MST_SUBTEAM_MST_SABUN",ds_list.getColumn(nRow,"SUBTEAM_MST_SABUN"));
	
	
	actionName		= "FSC90041V_T002";
	cmdName			= "U_svc::" + "fs/fsc/FSC90041V_T002.jsp";
	inData			= "ds_input=ds_input";
	outData			= "ds_Detail=ds_list";
	callBackFnc		= "fn_afterSearch";
	
	jsp_transaction(this,actionName, cmdName ,inData ,outData,otherArg,callBackFnc,true,false,false);
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_afterSearchList()
 * 입      력   : errCode 	= 에러코드
				  errMsg	= 에러메세지
 * 반      환   : 없음
 * 기      능   : 개별 표준 식단 조회 후 실행 함수
 * 작  성  자   : 박지영
 * 작성  일자   : 2008-03-18  
 ******************************************************************************************
 */
function fn_afterSearchList(errCode, errMsg)
{
	if(errCode!=0)
	{
		g_Message("EE", "서비스 오류:시스템 관리자에게 문의하십시오");
		return;
	}
		
	if (ds_list.rowcount > 0) {
		fn_SearchSub(0);
	}
	
	
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_afterSearch()
 * 입      력   : errCode 	= 에러코드
				  errMsg	= 에러메세지
 * 반      환   : 없음
 * 기      능   : 사업장 조회 후 실행 함수
 * 작  성  자   : 박지영
 * 작성  일자   : 2008-03-18  
 ******************************************************************************************
 */
function fn_afterSearch(errCode, errMsg)
{	
	if(errCode!=0)
	{
		g_Message("EE", "서비스 오류:시스템 관리자에게 문의하십시오");
		return;
	}else{
		//Dataset생성
		var objPivotHeadDs = fn_makeHeadDs(ds_Detail);
 		var objPivotBodyDs = fn_makeBodyDs(ds_Detail,objPivotHeadDs);
		fn_crossTabGrid(grd_Detail,objPivotHeadDs,objPivotBodyDs);				
	}
//	ds_DetailPivot.copyData(ds_Detail);

// 	ds_DetailPivot.keystring = "";
// 	ds_DetailPivot.keystring = "G:UPJANG";
	
// 	var nrt = ds_DetailPivot.getColumn(0, "CHECK_DATE")	
// 	grd_Detail.setCellProperty( "Head", 9, "text", nrt);
// 	grd_Detail.setCellProperty( "Head", 9, "mask", "@@@@.@@");
		
	
//	fn_crossTab(ds_DetailPivot, grd_Detail);


	//trace(ds_Detail.saveXML());
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_GetGrade()
 * 입      력   : currow : 현재로우
 * 반      환   : 평균등급리턴
 * 기      능   : 평균등급리턴
 * 작  성  자   : 박지영
 * 작성  일자   : 2008-03-31  
 ******************************************************************************************
 */
function fn_GetGrade(val)
{
	//var nScore = /*  PivotSum은 지원되지 않는 메서드입니다. PivotSum은 지원되지 않는 메서드입니다.*/ toNumber(ds_DetailPivot.PivotSum('TOT_SCORE',currow)/ds_DetailPivot.PivotSum('CNT',currow));
	var nScore = val;
	if (nScore >= 90)
	{
		return "A";
	}
	else if (nScore >= 80)
	{
		return "B";
	}
	else if (nScore >= 70)
	{
		return "C";
	}
	else if (nScore >= 60)
	{
		return "D";
	}
	else
	{
		return "E";
	}
}

//=========================================================================================
// [ PART 6 ]
// component Event 정의 ( User Define function )
// --> component Event의 기요,기능,동작 등 상세내용은 MiPlatform 메뉴얼을 참조하시기 바랍니다.
//=========================================================================================
 /******************************************************************************************
 * 함  수  명   : grd_List_OnHeadClick(obj,nCell,nX,nY,nPivotIndex)
 * 기      능   : 그리드헤드 더블클릭시 Sort
 * 작  성  자   : 박지영
 * 작성  일자   : 2008-03-18  
 ******************************************************************************************
 */
function grd_List_OnHeadClick(obj:Grid, e:GridClickEventInfo)
{
	//if (obj.id == "grd_Detail" && nCell != 0) return;
	
	gfn_gridSort(obj, e); //(eval(obj.binddataset), obj, e.cell);
}
/*
 ******************************************************************************************
 * 함  수  명   : grd_list_OnCellDblClick(obj,nRow,nCell,nX,nY,nPivotIndex)
 * 기      능   : 상세내역조회
 * 작  성  자   : 박지영
 * 작성  일자   : 2008-04-01  
 ******************************************************************************************
 */
function grd_list_OnCellDblClick(obj:Grid, e:GridClickEventInfo)
{
	ds_list.rowposition = e.row;
	
	if (ds_list.getRowLevel(ds_list.rowposition)== 0)
	{
		fn_SearchSub(e.row);
	}
}
function grd_Detail_OnCellDblClick(obj:Grid, e:GridClickEventInfo)
{
	//2008.12.29 박은규, 이명희 : 부접합누계를 더블클릭 시 부적합내용 상세화면 팝업처리
	if (e.cell != 6) return;
	//if (/* PivotSum은 지원되지 않는 메서드입니다.*/ eval(obj.binddataset).PivotSum('NOT_FIT',e.row) <= 0)	//As-Is
	if (eval(obj.binddataset).getColumn(e.row,"NOT_FIT") <= 0)	//To-Be 피벗데이터셋에서 값셋팅
	{
		g_Message("01", "데이터가 없습니다.");
		return;
	}
	var sParm;
	//============================================================================================
	//(2012-10-22 수정) 시작
	// 박은규 2012-10-22 CSR#(CH201210_00118) 요청자:홍호준(식품연구소)
	// 년도조회에서 기간조회로 변경
	//============================================================================================
	//sParm  = "fa_Year=" + quote(sp_YEAR.Value);
	//============================================================================================
	//(2012-10-22 수정) 끝
	//============================================================================================
	sParm = {fa_FromDate:ds_input.getColumn(0,"FROM_DATE"),fa_ToDate:ds_input.getColumn(0,"TO_DATE"),fa_Upjang:eval(obj.binddataset).getColumn(e.row,"UPJANG"),fa_UpjangNm:eval(obj.binddataset).getColumn(e.row,"UPJANGNM")};
	gfn_dialog("", "U_FSC::FSC90041P.xfdl",sParm);
}



//Pivot Head Dataset생성
function fn_makeHeadDs(objDs)
{
	var sPivotHeadDs = objDs.name + "_PivotHead";
	var objPivotHeadDs;
	if ( this.isValidObject(sPivotHeadDs) )
	{
		objPivotHeadDs = eval(sPivotHeadDs);
	}
	else
	{
		objPivotHeadDs = new Dataset();
		objPivotHeadDs.name = sPivotHeadDs;
		this.addChild(objPivotHeadDs.name,objPivotHeadDs);
	}

	objPivotHeadDs.clear();
	
	objDs.keystring = "S:CHECK_DATE";
	var sPreKey 	  = "";
	var sCurrCode 	  = "";
	var sCurrText 	  = "";
	var nRow;
	for ( var i = 0; i < objDs.rowcount; i++ )
	{
		sPrevDate = objDs.getColumn(i, "CHECK_DATE");
		sNextDate = objDs.getColumn(i-1, "CHECK_DATE");
		if ( sPrevDate != sNextDate)	
		{			
			nRow = objPivotHeadDs.addRow();
			objPivotHeadDs.addColumn("CHECK_DATE","STRING",255);						
			objPivotHeadDs.addColumn("DISP_HEAD1","STRING",255);
			objPivotHeadDs.addColumn("DISP_HEAD2","STRING",255);
			objPivotHeadDs.addColumn("DISP_HEAD3","STRING",255);
			objPivotHeadDs.setColumn(nRow,"CHECK_DATE",sPrevDate);
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD1","점수");
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD2","등급");
			objPivotHeadDs.setColumn(nRow,"DISP_HEAD3","부적합누계");
		}
	}
	return objPivotHeadDs;
}

//Pivot Dataset생성
function fn_makeBodyDs(objDs,objPivotHeadDs)
{
	var sPivotDs = objDs.name + "_Pivot";
	var objPivotDs;
	if ( this.isValidObject(sPivotDs) ) {
		objPivotDs = eval(sPivotDs);
	} else {
		objPivotDs = new Dataset();
		objPivotDs.name = sPivotDs;
		this.addChild(objPivotDs.name,objPivotDs);
	}
	objPivotDs.clear();
	
	//고정컬럼 추가
	objPivotDs.addColumn("JOB_CD","STRING",3);
	objPivotDs.addColumn("JOB_NAME","STRING",20);
	objPivotDs.addColumn("SUB_JOB_CD","STRING",6);
	objPivotDs.addColumn("SUB_JOB_NAME","STRING",20);
	objPivotDs.addColumn("UPJANG","BIGDECIMAL",7);
	objPivotDs.addColumn("UPJANGNM","STRING",50);
	objPivotDs.addColumn("CHECK_DATE","STRING",6);
	objPivotDs.addColumn("SCORE","BIGDECIMAL",39);
	objPivotDs.addColumn("GRADE","STRING",1);
	objPivotDs.addColumn("TOT_SCORE","BIGDECIMAL",39);
	objPivotDs.addColumn("CNT","BIGDECIMAL",39);
	objPivotDs.addColumn("RST_CNT","BIGDECIMAL",39);
	objPivotDs.addColumn("NOT_FIT","BIGDECIMAL",39);

	//Pivot컬럼 추가
	for (var i=0; i<objPivotHeadDs.rowcount; i++) {
		objPivotDs.addColumn("P_TOT_SCORE"+objPivotHeadDs.getColumn(i,0),"BIGDECIMAL",39);		//점수
		objPivotDs.addColumn("P_SCORE"+objPivotHeadDs.getColumn(i,0),"BIGDECIMAL",39);		//점수
		objPivotDs.addColumn("P_GRADE"+objPivotHeadDs.getColumn(i,0),"STRING",1);			//등급
		objPivotDs.addColumn("P_NOT_FIT"+objPivotHeadDs.getColumn(i,0),"BIGDECIMAL",39);	//부족합누계
		objPivotDs.addColumn("P_RSCNT"+objPivotHeadDs.getColumn(i,0),"BIGDECIMAL",39);		//점검횟수누계
	}

	//objPivotHeadDs	헤더데이터셋	
	var sPrevSEQ = "";
	var sNextSEQ = "";
	var nAddRow;
	var sYYDD;
	var sPrevUPJANG = "";
	var sNextUPJANG = "";
	objDs.keystring = "S:JOB_CD+JOB_NAME+SUB_JOB_CD+SUB_JOB_NAME+UPJANG+UPJANGNM+CHECK_DATE";
	
	objDs.enableevent = false;
	for(var j=0; j<objDs.rowcount;j++){
		
		sPrevUPJANG = objDs.getColumn(j,"UPJANG");
		sNextUPJANG = objDs.getColumn(j-1, "UPJANG");
		
		if(sPrevUPJANG != sNextUPJANG){
			nAddRow = objPivotDs.addRow();	
			objPivotDs.setColumn(nAddRow,"UPJANG",objDs.getColumn(j,"UPJANG"));
			objPivotDs.setColumn(nAddRow,"UPJANGNM",objDs.getColumn(j,"UPJANGNM"));
			objPivotDs.setColumn(nAddRow,"JOB_NAME",objDs.getColumn(j,"JOB_NAME"));
			objPivotDs.setColumn(nAddRow,"SUB_JOB_NAME",objDs.getColumn(j,"SUB_JOB_NAME"));
		}
	}
	
	for(var k=0; k<objDs.rowcount;k++){
		var nRow = objPivotDs.findRow("UPJANG",objDs.getColumn(k,"UPJANG"));
		objPivotDs.setColumn(nRow,"P_TOT_SCORE" + objDs.getColumn(k,"CHECK_DATE"),objDs.getColumn(k,"TOT_SCORE"));		
		objPivotDs.setColumn(nRow,"P_SCORE" + objDs.getColumn(k,"CHECK_DATE"),objDs.getColumn(k,"SCORE"));		
		objPivotDs.setColumn(nRow,"P_GRADE" + objDs.getColumn(k,"CHECK_DATE"),objDs.getColumn(k,"GRADE"));
		objPivotDs.setColumn(nRow,"P_NOT_FIT" + objDs.getColumn(k,"CHECK_DATE"),objDs.getColumn(k,"NOT_FIT"));					
		objPivotDs.setColumn(nRow,"P_RSCNT" + objDs.getColumn(k,"CHECK_DATE"),objDs.getColumn(k,"RST_CNT"));					
	}
	objDs.enableevent = true;

	var curColid = "";
	var sumSCORE = 0;
	var sumTOT_SCORE = 0;
	var sumCNT = 0;
	var sumNOT_FIT = 0;
	var sumRST_CNT = 0;
	objPivotDs.enableevent = false;
	for(var m=0; m<objPivotDs.rowcount;m++){
	    sumSCORE = 0;
		sumTOT_SCORE = 0;
		sumCNT = 0;
		sumNOT_FIT = 0;
		sumRST_CNT = 0;
 		for(var l=0;l<objPivotDs.colcount;l++){
			curColid = objPivotDs.getColID(l+13);
			curColid = String(curColid).substr(0, 7);					
			if(curColid == "P_SCORE") {
				sumSCORE += gfn_nvl(objPivotDs.getColumn(m, objPivotDs.getColID(l+13)), 0);
			}else if(curColid == "P_TOT_S"){
				sumTOT_SCORE += gfn_nvl(objPivotDs.getColumn(m, objPivotDs.getColID(l+13)), 0);
			}else if(curColid == "P_GRADE"){
				sumCNT += gfn_nvl(objPivotDs.getColumn(m, objPivotDs.getColID(l+13)), 0);
			}else if(curColid == "P_NOT_F"){
				sumNOT_FIT += gfn_nvl(objPivotDs.getColumn(m, objPivotDs.getColID(l+13)), 0);
			}else if(curColid == "P_RSCNT"){
				sumRST_CNT += gfn_nvl(objPivotDs.getColumn(m, objPivotDs.getColID(l+13)), 0);
			}
 		} 		
 		objPivotDs.setColumn(m, "SCORE", sumSCORE);
 		objPivotDs.setColumn(m, "TOT_SCORE", sumTOT_SCORE);
 		objPivotDs.setColumn(m, "GRADE", sumCNT); 		
 		objPivotDs.setColumn(m, "NOT_FIT", sumNOT_FIT); 		
 		objPivotDs.setColumn(m, "RST_CNT", sumRST_CNT); 		
	}
	objPivotDs.enableevent = true;
	return objPivotDs;
}

//Pivot 그리드포맷생성
function fn_crossTabGrid(objGrid,objPivotHeadDs,objPivotBodyDs)
{
		var v_Formats = "";
		var v_Columns = "";
		var v_Rows = "";
		var v_BandHead = "";
		var v_BandBody = "";

		v_Columns += '<Column size="30" band="left" />\n';
		v_Columns += '<Column size="50" band="left" />\n';
		v_Columns += '<Column size="60" band="left" />\n';
		v_Columns += '<Column size="120" band="left" />\n';
		v_Columns += '<Column size="50" band="left" />\n';
		v_Columns += '<Column size="50" band="left" />\n';
		v_Columns += '<Column size="50" band="left" />\n';
		v_Columns += '<Column size="70" band="left" />\n';
		v_Columns += '<Column size="3" band="left" />\n';
											
		
		v_Rows += '<Row size="24" band="head" />\n';
		v_Rows += '<Row size="24" band="head" />\n';
		v_Rows += '<Row size="24" />\n';
		
		v_BandHead += '<Cell rowspan="2" displaytype="image" class="head_Excel"/>\n';
		v_BandHead += '<Cell col="1" rowspan="2" text="직군"/>\n';
		v_BandHead += '<Cell col="2" rowspan="2" displaytype="text" text="상세직군"/>\n';
		v_BandHead += '<Cell col="3" rowspan="2" text="사업장"/>\n';
		v_BandHead += '<Cell col="4" rowspan="2" displaytype="text" text="평균&#10;점수"/>\n';
		v_BandHead += '<Cell col="5" rowspan="2" displaytype="text" text="점검횟수&#10;누계"/>\n';
		v_BandHead += '<Cell col="6" rowspan="2" text="평균&#10;등급"/>\n';
		v_BandHead += '<Cell col="7" rowspan="2" text="부적합&#10;누계"/>\n';
		v_BandHead += '<Cell col="8" rowspan="2"/>\n';
		
		    
    
		
		v_BandBody += '<Cell displaytype="text" style="align:center&#32;middle;" expr="expr:currow+1"/>\n';
		v_BandBody += '<Cell col="1" displaytype="text" style="align:&#32;;" text="bind:JOB_NAME"/>\n';
		v_BandBody += '<Cell col="2" displaytype="text" style="align:&#32;;" text="bind:SUB_JOB_NAME"/>\n';
		v_BandBody += '<Cell col="3" displaytype="text" style="align:&#32;;" text="bind:UPJANGNM"/>\n';
		v_BandBody += '<Cell col="4" displaytype="number" style="align:&#32;;" expr="expr:gfn_parseFloat(Math.round(TOT_SCORE/RST_CNT,1))"/>\n';	//평균점수
		v_BandBody += '<Cell col="5" displaytype="number" style="align:&#32;;" text="bind:RST_CNT"/>\n';	//점검횟수누계
		v_BandBody += '<Cell col="6" style="align:&#32;;" expr="expr:fn_GetGrade(gfn_parseFloat(Math.round(TOT_SCORE/RST_CNT,1)))"/>\n';	//평균등급		
		v_BandBody += '<Cell col="7" displaytype="number" style="align:&#32;;" expr="expr:NOT_FIT"/>\n';	//부적합누계	
		v_BandBody += '<Cell col="8" style="align:&#32;;"/>\n';		
		
		// 포맷 생성
		var v_HeadText = '';
		var v_HeadColIdx = 9;
		var v_BodyColIdx = 9;
		
		for (var i=0; i<objPivotHeadDs.getRowCount(); i++) {
			
			// Column 생성
			v_Columns += '<Column size="78" />\n';
			v_Columns += '<Column size="78" />\n';
			v_Columns += '<Column size="78" />\n';

			// Head 생성
			if (v_HeadText != objPivotHeadDs.getColumn(i, "CHECK_DATE")) {
				v_HeadText = objPivotHeadDs.getColumn(i, "CHECK_DATE");
								
				// Row 1
				v_BandHead += '<Cell col="'+v_HeadColIdx+'" colspan="'+3+'" text="'+gfn_getFormat(v_HeadText,"@@@@.@@")+'"/>\n';
				
				// Row 2
				for (var j=i; j<objPivotHeadDs.getRowCount(); j++) {
					if (v_HeadText == objPivotHeadDs.getColumn(j, "CHECK_DATE")) {
						v_BandHead += '<Cell row="1" col="'+v_HeadColIdx+'" text="점수"/>\n';
						v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+1)+'" text="등급"/>\n';
						v_BandHead += '<Cell row="1" col="'+(v_HeadColIdx+2)+'" text="부적합누계"/>\n';
						v_HeadColIdx += 3;
					}
				}
			}

			// Body 생성
			v_BandBody += '<Cell style="align:right;" col="'+v_BodyColIdx+'" displaytype="number" text="expr:P_SCORE'+objPivotHeadDs.getColumn(i, "CHECK_DATE")+'"/>\n';
 			v_BandBody += '<Cell style="align:center;" col="'+(v_BodyColIdx+1)+'" displaytype="number" text="expr:P_GRADE'+objPivotHeadDs.getColumn(i, "CHECK_DATE")+'"/>\n';
 			v_BandBody += '<Cell style="align:right;" col="'+(v_BodyColIdx+2)+'" displaytype="number" text="expr:P_NOT_FIT'+objPivotHeadDs.getColumn(i, "CHECK_DATE")+'"/>\n';
			v_BodyColIdx+=3;
		}

		v_Formats = '<Formats>\n';
		v_Formats += '<Format id="default">\n';
		v_Formats += '<Columns>\n';
		v_Formats += v_Columns;
		v_Formats += '</Columns>\n';
		v_Formats += '<Rows>\n';
		v_Formats += v_Rows;
		v_Formats += '</Rows>\n';
		v_Formats += '<Band id="head">\n';
		v_Formats += v_BandHead;
		v_Formats += '</Band>\n';	
		v_Formats += '<Band id="body">\n';
		v_Formats += v_BandBody;
		v_Formats += '</Band>\n';		
		v_Formats += '</Format>\n';	
		v_Formats += '</Formats>\n';
		
		//trace(v_Formats);
		objGrid.enableredraw = false;
		objGrid.formats = v_Formats;
		objGrid.binddataset = objPivotBodyDs.name;
		objGrid.enableredraw = true;	
}]]></Script>
  </Form>
</FDL>
