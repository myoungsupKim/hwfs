<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="..\..\..\default_typedef.xml"/>
  <Form id="FMP00080E" onactivate="FMP00080E_OnActivate" ondeactivate="FMP00080E_OnDeactivate" onkeydown="fn_FormKeyDown" onload="form_onload" ontimer="FMP00080E_OnTimer" titletext="입고예정일수정_요구사항반영" position="absolute 0 0 996 593" scrollbars="none">
    <Layouts>
      <Layout>
        <Static id="Static49" class="sta_WFDA_Labelbg" position="absolute 78 86 981 113" anchor="left top right"/>
        <Static id="Static08" class="sta_WFSA_Labelbg" position="absolute 0 30 981 71" anchor="left top right"/>
        <Static id="Static04" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 30 677 40"/>
        <Static id="Static07" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 40 15 61"/>
        <Static id="Static05" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 61 677 71"/>
        <Static id="Static09" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 240 40 270 61"/>
        <Edit autoselect="true" enable="false" id="ed_Pamt" imemode="native" taborder="22" tabstop="false" position="absolute 335 89 430 110" style="align:right;"/>
        <Grid autoenter="select" binddataset="ds_List" cellmovingtype="col" cellsizingtype="both" readonly="false" enable="true" id="gd_list" useinputpanel="false" oncellclick="gd_list_OnCellClick" onselectchanged="gd_list_OnCellPosChanged" onenterdown="gd_list_OnEnterDown" onheadclick="gd_list_OnHeadClick" taborder="8" tabstop="true" usecontextmenu="true" useselcolor="true" visible="true" wheelscrollrow="1" position="absolute 0 128 981 578" selecttype="row" anchor="all">
          <Formats>
            <Format id="Default">
              <Columns>
                <Column size="28"/>
                <Column size="80"/>
                <Column size="150"/>
                <Column size="100"/>
                <Column size="50"/>
                <Column size="60"/>
                <Column size="100"/>
                <Column size="80"/>
                <Column size="60"/>
                <Column size="90"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="122"/>
                <Column size="50"/>
                <Column size="60"/>
                <Column size="150"/>
              </Columns>
              <Rows>
                <Row size="26" band="head"/>
                <Row size="20"/>
                <Row size="22" band="summ"/>
              </Rows>
              <Band id="head">
                <Cell displaytype="text" class="head_Excel"/>
                <Cell col="1" displaytype="text" text="상품코드"/>
                <Cell col="2" displaytype="text" text="상품명"/>
                <Cell col="3" displaytype="text" text="규격"/>
                <Cell col="4" displaytype="text" text="단위"/>
                <Cell col="5" displaytype="text" text="보관유형"/>
                <Cell col="6" displaytype="text" text="입고예정일"/>
                <Cell col="7" displaytype="text" text="단가"/>
                <Cell col="8" displaytype="text" text="수량"/>
                <Cell col="9" displaytype="text" text="금액"/>
                <Cell col="10" displaytype="text" text="부가세"/>
                <Cell col="11" displaytype="text" text="합계"/>
                <Cell col="12" displaytype="text" text="비고"/>
                <Cell col="13" displaytype="text" text="마감"/>
                <Cell col="14" displaytype="text" text="마감일"/>
                <Cell col="15" displaytype="text" text="주문번호"/>
              </Band>
              <Band id="body">
                <Cell celltype="head" displaytype="text" style="align:right;backgroundimage:EXPR(expr_GetRowTypeImg(rowposition));" expr="expr:currow + 1"/>
                <Cell col="1" displaytype="text" style="align:center;color2: ;" text="bind:ITEM_CODE"/>
                <Cell col="2" displaytype="text" style="align:left;color2: ;" text="bind:ITEM_NAME"/>
                <Cell col="3" displaytype="text" style="align:left;color2: ;" text="bind:ITEM_SIZE"/>
                <Cell col="4" displaytype="text" style="align:center;color2: ;" text="bind:PO_UOM"/>
                <Cell col="5" displaytype="text" style="align:center;color2: ;"/>
                <Cell col="6" displaytype="date" edittype="date" style="align:center;background:lightyellow;background2:lightyellow;" calendardisplay="display"/>
                <Cell col="7" displaytype="number" style="color2: ;" text="bind:OP_PRICE" mask="#,##0"/>
                <Cell col="8" displaytype="number" edittype="expr:setEditExpr(iif(CLS_STATUS=='마감',&quot;none&quot;,&quot;number&quot;))" editfilter="expr:setfilterExpr(iif(CLS_STATUS=='마감',&quot;none&quot;,&quot;number&quot;))" style="color2: ;" text="bind:PR_QTY" mask="#,##0.0" editautoselect="true"/>
                <Cell col="9" displaytype="number" style="color2: ;" text="bind:OP_AMOUNT" mask="#,##0"/>
                <Cell col="10" displaytype="number" style="color2: ;" expr="expr:Math.round(iif(TAX_CODE==&quot;100&quot;,0.1,0)* OP_AMOUNT)" mask="#,##0"/>
                <Cell col="11" displaytype="number" style="color2: ;" expr="expr:Math.round(iif(TAX_CODE==&quot;100&quot;,1.1,1)* OP_AMOUNT)" mask="#,##0"/>
                <Cell col="12" displaytype="text" edittype="none" style="align:left;color2: ;" text="bind:PR_REMARK" editimemode="native" editautoselect="true"/>
                <Cell col="13" displaytype="text" style="align:center;color2: ;" text="bind:CLS_STATUS"/>
                <Cell col="14" displaytype="text" style="align:center;color2: ;" text="bind:D_DAY_DISP"/>
                <Cell col="15" displaytype="text" style="align:center;color2: ;" text="bind:PR_NUM"/>
              </Band>
              <Band id="summary">
                <Cell displaytype="text" style="align:left;"/>
                <Cell col="1" displaytype="text" style="align:center;" text="합  계"/>
                <Cell col="2" displaytype="number" style="align: ;" expr="expr:getCaseCount(&quot;PR_QTY&gt;0&quot;)" mask="#,##0"/>
                <Cell col="3" displaytype="text" style="align:left;" text="건"/>
                <Cell col="4" displaytype="text" style="align:left;"/>
                <Cell col="5" displaytype="text" style="align:left;"/>
                <Cell col="6" displaytype="text" style="align:left;"/>
                <Cell col="7" displaytype="text" style="align:left;"/>
                <Cell col="8" displaytype="number" style="align: ;" expr="expr:getSum(&quot;PR_QTY&quot;)" mask="#,##0.0"/>
                <Cell col="9" displaytype="number" style="align: ;" expr="expr:getSum(&quot;OP_AMOUNT&quot;)" mask="#,##0"/>
                <Cell col="10" displaytype="number" style="align: ;" expr="expr:getCaseSum(&quot;TAX_CODE=='100'&quot;,&quot;Math.round(OP_AMOUNT/10)&quot;)" mask="#,##0"/>
                <Cell col="11" displaytype="number" style="align: ;" expr="expr:getSum(&quot;Math.round(iif(TAX_CODE=='100',1.1,1)* OP_AMOUNT)&quot;)" mask="#,##0"/>
                <Cell col="12" displaytype="text" style="align:left;"/>
                <Cell col="13" displaytype="text" style="align:left;"/>
                <Cell col="14" displaytype="text" style="align:left;"/>
                <Cell col="15" displaytype="text" style="align:left;"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Combo codecolumn="SUBINV_CODE" datacolumn="SUBINV_NAME" displayrowcount="10" id="cbo_Subinv" imemode="native" innerdataset="ds_Subinv" onitemchanged="cbo_Subinv_OnChanged" type="filter" taborder="3" position="absolute 350 40 550 61"/>
        <Static id="st_Days" text="(발주 마감 : D-0 00시)" position="absolute 805 41 962 62" style="font:Gulim,9, bold;"/>
        <Button id="btn_Upjang" onclick="fn_edBtn_OnClick" taborder="2" tabstop="false" text="" position="absolute 219 40 240 61" class="btn_WF_popSearch" image=""/>
        <Edit autoselect="true" id="ed_Upjang" imemode="native" onkeydown="fn_edBtn_OnKeyDown" readonly="true" taborder="1" position="absolute 70 40 220 61"/>
        <Static id="st_Upjang" text="사업장" userdata="strQuery_FMUpjang" position="absolute 15 40 68 61" class="sta_WFSA_label"/>
        <Static id="Static6" text="식당(창고)" position="absolute 270 40 347 61" class="sta_WFSA_label"/>
        <Static id="Static8" text="입고예정일" position="absolute 580 40 653 61" class="sta_WFSA_label"/>
        <MaskEdit id="me_NeedDate" mask="####-##-##" oneditclick="g_Date_OnFocus" onsetfocus="g_Date_OnFocus" taborder="4" type="string" position="absolute 660 40 760 61" class="msk_WF_Cal" onkillfocus="me_NeedDate_onkillfocus"/>
        <Button id="btn_NeedDate" onclick="g_CalButton_OnClick" taborder="5" tabstop="false" text="" userdata="me_NeedDate" position="absolute 739 40 760 61" class="btn_WF_cal" image=""/>
        <Static id="st_Week" text="(월)" position="absolute 768 41 796 62" style="font:Gulim,9,bold;"/>
        <TextArea id="ta_Sql" readonly="true" taborder="12" tabstop="false" visible="false" position="absolute 360 0 474 40" scrollbars="none"/>
        <Edit autoselect="true" enable="false" id="ed_Pcnt" imemode="native" taborder="24" tabstop="false" position="absolute 263 89 334 110" style="align:right;"/>
        <Static id="Static28" text="최종 발주정보" position="absolute 164 86 261 113" class="sta_WFDA_Label01"/>
        <MaskEdit enable="false" id="me_Pdate" mask="####-##-##" oneditclick="g_Date_OnFocus" onsetfocus="g_Date_OnFocus" onkillfocus="g_Date_OnKillFocus" taborder="23" tabstop="false" type="string" position="absolute 84 89 162 110" class="msk_WF_Cal"/>
        <Static id="Static23" text="최종발주일" position="absolute 0 86 82 113" class="sta_WFDA_Label01"/>
        <Button id="btn_RcpConf" onclick="btn_RcpConf_OnClick" taborder="49" tabstop="false" text="실시간 입금확인" userdata="1" visible="false" position="absolute 870 89 978 110" class="btn_WF_Custom" image="" anchor="top right"/>
        <Div id="dv_RcpConf" taborder="50" tabstop="false" text="Div0" visible="false" position="absolute 998 187 1133 301" class="div_WFGRD_graybg" scrollbars="none" style="background:#ffffffff;border:2 solid #515d6fff ;">
          <Layouts>
            <Layout>
              <Button id="btn_RcpRun" onclick="dv_MultiUpj_btn_Hidden_OnClick" taborder="0" text="입금확인" position="absolute 4 84 128 106" class="btn_WF_Custom" image="" anchor="default"/>
              <Static id="Static1" text="입금확인일자" position="absolute 4 6 127 33" class="sta_WFDA_Label01" anchor="default"/>
              <MaskEdit enable="false" id="me_RcpDateF" mask="####-##-##" oneditclick="g_Date_OnFocus" onsetfocus="g_Date_OnFocus" readonly="true" taborder="3" type="string" position="absolute 5 36 105 57" class="msk_WF_Cal" anchor="default"/>
              <Button enable="false" id="btn_RcpDateF" onclick="g_CalButton_OnClick" taborder="4" tabstop="false" text="" userdata="dv_RcpConf.me_RcpDateF" position="absolute 84 36 105 57" class="btn_WF_cal" image="" anchor="default"/>
              <MaskEdit id="me_RcpDateT" mask="####-##-##" oneditclick="g_Date_OnFocus" onsetfocus="g_Date_OnFocus" readonly="true" taborder="5" type="string" position="absolute 17 59 117 80" class="msk_WF_Cal" anchor="default" onkillfocus="dv_RcpConf_me_RcpDateT_onkillfocus"/>
              <Button id="btn_RcpDateT" onclick="g_CalButton_OnClick" taborder="6" tabstop="false" text="" userdata="dv_RcpConf.me_RcpDateT" position="absolute 96 59 117 80" class="btn_WF_cal" image="" anchor="default"/>
              <Static id="Static0" text="~" position="absolute 5 63 13 76" anchor="default"/>
            </Layout>
          </Layouts>
        </Div>
        <Static id="st_Credit" text="발주가능금액" visible="false" position="absolute 432 86 524 113" class="sta_WFDA_Label01"/>
        <Edit autoselect="true" enable="false" id="ed_Credit" imemode="native" taborder="21" tabstop="false" visible="false" position="absolute 526 89 636 110" style="align:right; :disabled {background:#ffffffff;color:red;}"/>
        <Static id="st_Bond" text="채권잔액" visible="false" position="absolute 638 86 733 113" class="sta_WFDA_Label01"/>
        <Edit autoselect="true" enable="false" id="ed_Bond" imemode="native" taborder="51" tabstop="false" visible="false" position="absolute 735 89 845 110" style="align:right; :disabled {background:#ffffffff;color:red;}"/>
        <Div id="div_cmnBtn" anchor="left top right" taborder="52" url="cmn::CmnBtn.xfdl" text="Div0" scrollbars="none" position="absolute 0 0 981 30"/>
        <Static id="Static06" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 981 0 996 593" anchor="top right"/>
        <Static id="Static71" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 578 981 593" anchor="left bottom"/>
        <Static id="Static11" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 60 40 70 61"/>
        <Static id="Static10" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 340 40 350 61"/>
        <Static id="Static12" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 650 40 660 61"/>
        <Static id="Static13" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 550 40 580 61"/>
        <Static id="Static60" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 71 450 86" anchor="left top"/>
        <Static id="Static01" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 113 565 128" anchor="left top"/>
        <Static id="st_Timer" text="마감시간 : 00일 00시간 00분 전" class="sta_WF_RedhelpB" position="absolute 702 116 975 128" anchor="top right" style="color:red;align:right middle;font:굴림,9,bold;"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_Cond">
        <ColumnInfo>
          <Column id="ITEM_NAME" size="100" type="STRING"/>
          <Column id="NEED_DATE" size="8" type="STRING"/>
          <Column id="UPJANG" size="22" type="INT"/>
          <Column id="SUBINV_CODE" size="8" type="STRING"/>
          <Column id="CONSUM_YN" size="1" type="STRING"/>
          <Column id="QTY_CONTROL_YN" size="1" type="STRING"/>
          <Column id="CENTER_CODE" size="22" type="INT"/>
          <Column id="AP_UNITPRICE_UPJANG" size="22" type="INT"/>
          <Column id="OTCUST_PRICE_UPJANG" size="22" type="INT"/>
          <Column id="FAVOR_GROUP" size="50" type="STRING"/>
          <Column id="NEED_DATEP" size="8" type="STRING"/>
          <Column id="UPJANGP" size="22" type="INT"/>
          <Column id="SUBINV_CODEP" size="8" type="STRING"/>
          <Column id="ITEM_CLASS2" size="8" type="STRING"/>
          <Column id="ITEM_CLASS3" size="8" type="STRING"/>
          <Column id="ITEM_CLASS4" size="8" type="STRING"/>
          <Column id="ITEM_CODE" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_Subinv">
        <ColumnInfo>
          <Column id="SUBINV_CODE" size="8" type="STRING"/>
          <Column id="SUBINV_NAME_DISP" size="100" type="STRING"/>
          <Column id="CONSUM_YN" size="1" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_Days">
        <ColumnInfo>
          <Column id="D_DAYS" size="22" type="INT"/>
          <Column id="D_TIMES" size="4" type="STRING"/>
          <Column id="DAYS" size="50" type="STRING"/>
          <Column id="D_OVER_DAYS" size="22" type="INT"/>
          <Column id="QTY_CONTROL_YN" size="1" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_OrdCtrl">
        <ColumnInfo>
          <Column id="CTRL_TYPE" size="50" type="STRING"/>
          <Column id="FRI" size="1" type="STRING"/>
          <Column id="ITEM_TYPE" size="50" type="STRING"/>
          <Column id="MON" size="1" type="STRING"/>
          <Column id="SAT" size="1" type="STRING"/>
          <Column id="SUN" size="1" type="STRING"/>
          <Column id="THU" size="1" type="STRING"/>
          <Column id="TUE" size="1" type="STRING"/>
          <Column id="WED" size="1" type="STRING"/>
          <Column id="CHK_TYPE" size="100" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_CrdInfo">
        <ColumnInfo>
          <Column id="CREDIT_AMOUNT" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="CREDIT_AMOUNT_CONTROL_YN" size="1" prop="default" type="STRING"/>
          <Column id="CREDIT_AMOUNT_TOT" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="CREDIT_AVAIL_AMT" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="CREDIT_EXT_AMOUNT" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="CREDIT_EXT_DAYS" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="CREDIT_OVER_AMOUNT" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="CREDIT_RMN_AMT" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="CREDIT_TURN_CONTROL_YN" size="1" prop="default" type="STRING"/>
          <Column id="CREDIT_TURN_DAYS" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="CREDIT_TURN_DAYS_TOT" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="L_BILL_DATE" size="8" prop="default" type="STRING"/>
          <Column id="L_BILL_DATE_DISP" size="50" prop="default" type="STRING"/>
          <Column id="LAST_TURN_CNT" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="PO_AMT" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="PR_AMT" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="RMN_AMT" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="TR_AMT" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="BOND_AMT" size="22" prop="default" type="BIGDECIMAL"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_Fav">
        <ColumnInfo>
          <Column id="FAVOR_GROUP" size="50" type="STRING"/>
          <Column id="FAVOR_NAME" size="100" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_CtUpj">
        <ColumnInfo>
          <Column id="AP_UNITPRICE_UPJANG" size="22" type="INT"/>
          <Column id="CENTER_CODE" size="22" type="INT"/>
          <Column id="OTCUST_PRICE_UPJANG" size="22" type="INT"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_List" cancolumnchange="ds_List_CanColumnChange" oncolumnchanged="ds_List_OnColumnChanged">
        <ColumnInfo>
          <Column id="CENTER_CODE" size="22" prop="default" type="INT"/>
          <Column id="CENTER_FLAG" size="1" prop="default" type="STRING"/>
          <Column id="CLS_STATUS" size="50" prop="default" type="STRING"/>
          <Column id="CUSTCD" size="22" prop="default" type="INT"/>
          <Column id="INVAT_FLAG" size="1" prop="default" type="STRING"/>
          <Column id="ITEM_CODE" size="50" prop="default" type="STRING"/>
          <Column id="ITEM_NAME" size="200" prop="default" type="STRING"/>
          <Column id="ITEM_SIZE" size="100" prop="default" type="STRING"/>
          <Column id="LINE_STATUS" size="50" prop="default" type="STRING"/>
          <Column id="MARGIN_PRICE" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="MIN_ORD_QTY" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="MAX_ORD_QTY" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="MULTIPLIER_QTY" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="NEED_DATE" size="8" prop="default" type="STRING"/>
          <Column id="OTCUSTCD" size="50" prop="default" type="STRING"/>
          <Column id="OUTVAT_FLAG" size="1" prop="default" type="STRING"/>
          <Column id="PO_UOM" size="10" prop="default" type="STRING"/>
          <Column id="POINT_FLAG" size="1" prop="default" type="STRING"/>
          <Column id="PR_ID" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="PR_NUM" size="50" prop="default" type="STRING"/>
          <Column id="PR_QTY" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="PR_REMARK" size="300" prop="default" type="STRING"/>
          <Column id="PR_UPJANG" size="22" prop="default" type="INT"/>
          <Column id="RC_UPJANG" size="22" prop="default" type="INT"/>
          <Column id="SALE_AMOUNT" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="SALE_PRICE" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="SUBINV_CODE" size="8" prop="default" type="STRING"/>
          <Column id="TAX_CODE" size="3" prop="default" type="STRING"/>
          <Column id="UNIT_PRICE" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="OP_PRICE" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="OP_AMOUNT" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="D_DAYS" size="4" prop="default" type="BIGDECIMAL"/>
          <Column id="D_TIMES" size="4" prop="default" type="BIGDECIMAL"/>
          <Column id="D_DAY_DISP" size="200" prop="default" type="STRING"/>
          <Column id="IMAGE_PATH" size="200" prop="default" type="STRING"/>
          <Column id="OP_AMOUNT_OLD" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="DOCU_SOURCE" size="256" prop="default" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_List1">
        <ColumnInfo>
          <Column id="CENTER_CODE" size="22" type="INT"/>
          <Column id="CENTER_FLAG" size="1" type="STRING"/>
          <Column id="CLS_STATUS" size="50" type="STRING"/>
          <Column id="CUSTCD" size="22" type="INT"/>
          <Column id="INVAT_FLAG" size="1" type="STRING"/>
          <Column id="ITEM_CODE" size="50" type="STRING"/>
          <Column id="ITEM_NAME" size="200" type="STRING"/>
          <Column id="ITEM_SIZE" size="100" type="STRING"/>
          <Column id="LINE_STATUS" size="50" type="STRING"/>
          <Column id="MARGIN_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="MIN_ORD_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="MAX_ORD_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="MULTIPLIER_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="NEED_DATE" size="8" type="STRING"/>
          <Column id="OTCUSTCD" size="50" type="STRING"/>
          <Column id="OUTVAT_FLAG" size="1" type="STRING"/>
          <Column id="PO_UOM" size="10" type="STRING"/>
          <Column id="POINT_FLAG" size="1" type="STRING"/>
          <Column id="PR_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="PR_REMARK" size="300" type="STRING"/>
          <Column id="PR_UPJANG" size="22" type="INT"/>
          <Column id="RC_UPJANG" size="22" type="INT"/>
          <Column id="SALE_AMOUNT" size="22" type="BIGDECIMAL"/>
          <Column id="SALE_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="SUBINV_CODE" size="8" type="STRING"/>
          <Column id="TAX_CODE" size="3" type="STRING"/>
          <Column id="UNIT_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="OP_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="OP_AMOUNT" size="22" type="BIGDECIMAL"/>
          <Column id="G_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="D_DAYS" size="4" type="INT"/>
          <Column id="D_DAY_DISP" size="50" type="STRING"/>
          <Column id="D_TIMES" size="4" type="INT"/>
          <Column id="OTCUSTNM" size="100" type="STRING"/>
          <Column id="KG_CONVERT_RATE" size="22" type="BIGDECIMAL"/>
          <Column id="FEATURE_NAME" size="100" type="STRING"/>
          <Column id="IMAGE_PATH" size="200" type="STRING"/>
          <Column id="LIMIT_ITEM" size="50" type="STRING"/>
          <Column id="LIMIT_REASON" size="300" type="STRING"/>
          <Column id="WEEK_ITEM_CODE" size="300" type="STRING"/>
          <Column id="CONSUM_YN" size="1" type="STRING"/>
          <Column id="IMAGE_YN" size="2" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_List2">
        <ColumnInfo>
          <Column id="CENTER_CODE" size="22" type="INT"/>
          <Column id="CENTER_FLAG" size="1" type="STRING"/>
          <Column id="CLS_STATUS" size="50" type="STRING"/>
          <Column id="CUSTCD" size="22" type="INT"/>
          <Column id="INVAT_FLAG" size="1" type="STRING"/>
          <Column id="ITEM_CODE" size="50" type="STRING"/>
          <Column id="ITEM_NAME" size="200" type="STRING"/>
          <Column id="ITEM_SIZE" size="100" type="STRING"/>
          <Column id="LINE_STATUS" size="50" type="STRING"/>
          <Column id="MARGIN_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="MIN_ORD_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="MAX_ORD_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="MULTIPLIER_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="NEED_DATE" size="8" type="STRING"/>
          <Column id="OTCUSTCD" size="50" type="STRING"/>
          <Column id="OUTVAT_FLAG" size="1" type="STRING"/>
          <Column id="PO_UOM" size="10" type="STRING"/>
          <Column id="POINT_FLAG" size="1" type="STRING"/>
          <Column id="PR_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="PR_REMARK" size="300" type="STRING"/>
          <Column id="PR_UPJANG" size="22" type="INT"/>
          <Column id="RC_UPJANG" size="22" type="INT"/>
          <Column id="SALE_AMOUNT" size="22" type="BIGDECIMAL"/>
          <Column id="SALE_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="SUBINV_CODE" size="8" type="STRING"/>
          <Column id="TAX_CODE" size="3" type="STRING"/>
          <Column id="UNIT_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="OP_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="OP_AMOUNT" size="22" type="BIGDECIMAL"/>
          <Column id="G_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="D_DAYS" size="4" type="INT"/>
          <Column id="D_DAY_DISP" size="50" type="STRING"/>
          <Column id="D_TIMES" size="4" type="INT"/>
          <Column id="OTCUSTNM" size="100" type="STRING"/>
          <Column id="KG_CONVERT_RATE" size="22" type="BIGDECIMAL"/>
          <Column id="FEATURE_NAME" size="100" type="STRING"/>
          <Column id="IMAGE_PATH" size="200" type="STRING"/>
          <Column id="LIMIT_ITEM" size="50" type="STRING"/>
          <Column id="LIMIT_REASON" size="300" type="STRING"/>
          <Column id="WEEK_ITEM_CODE" size="300" type="STRING"/>
          <Column id="CONSUM_YN" size="1" type="STRING"/>
          <Column id="IMAGE_YN" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_List3">
        <ColumnInfo>
          <Column id="CENTER_CODE" size="22" type="INT"/>
          <Column id="CENTER_FLAG" size="1" type="STRING"/>
          <Column id="CLS_STATUS" size="50" type="STRING"/>
          <Column id="CUSTCD" size="22" type="INT"/>
          <Column id="INVAT_FLAG" size="1" type="STRING"/>
          <Column id="ITEM_CODE" size="50" type="STRING"/>
          <Column id="ITEM_NAME" size="200" type="STRING"/>
          <Column id="ITEM_SIZE" size="100" type="STRING"/>
          <Column id="LINE_STATUS" size="50" type="STRING"/>
          <Column id="MARGIN_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="MIN_ORD_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="MAX_ORD_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="MULTIPLIER_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="NEED_DATE" size="8" type="STRING"/>
          <Column id="OTCUSTCD" size="50" type="STRING"/>
          <Column id="OUTVAT_FLAG" size="1" type="STRING"/>
          <Column id="PO_UOM" size="10" type="STRING"/>
          <Column id="POINT_FLAG" size="1" type="STRING"/>
          <Column id="PR_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="PR_REMARK" size="300" type="STRING"/>
          <Column id="PR_UPJANG" size="22" type="INT"/>
          <Column id="RC_UPJANG" size="22" type="INT"/>
          <Column id="SALE_AMOUNT" size="22" type="BIGDECIMAL"/>
          <Column id="SALE_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="SUBINV_CODE" size="8" type="STRING"/>
          <Column id="TAX_CODE" size="3" type="STRING"/>
          <Column id="UNIT_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="OP_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="OP_AMOUNT" size="22" type="BIGDECIMAL"/>
          <Column id="G_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="D_DAYS" size="4" type="INT"/>
          <Column id="D_DAY_DISP" size="50" type="STRING"/>
          <Column id="D_TIMES" size="4" type="INT"/>
          <Column id="OTCUSTNM" size="100" type="STRING"/>
          <Column id="KG_CONVERT_RATE" size="22" type="BIGDECIMAL"/>
          <Column id="FEATURE_NAME" size="100" type="STRING"/>
          <Column id="IMAGE_PATH" size="200" type="STRING"/>
          <Column id="LIMIT_ITEM" size="50" type="STRING"/>
          <Column id="LIMIT_REASON" size="300" type="STRING"/>
          <Column id="WEEK_ITEM_CODE" size="300" type="STRING"/>
          <Column id="CONSUM_YN" size="1" type="STRING"/>
          <Column id="IMAGE_YN" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_List4">
        <ColumnInfo>
          <Column id="CENTER_CODE" size="22" type="INT"/>
          <Column id="CENTER_FLAG" size="1" type="STRING"/>
          <Column id="CLS_STATUS" size="50" type="STRING"/>
          <Column id="CUSTCD" size="22" type="INT"/>
          <Column id="INVAT_FLAG" size="1" type="STRING"/>
          <Column id="ITEM_CODE" size="50" type="STRING"/>
          <Column id="ITEM_NAME" size="200" type="STRING"/>
          <Column id="ITEM_SIZE" size="100" type="STRING"/>
          <Column id="LINE_STATUS" size="50" type="STRING"/>
          <Column id="MARGIN_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="MIN_ORD_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="MAX_ORD_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="MULTIPLIER_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="NEED_DATE" size="8" type="STRING"/>
          <Column id="OTCUSTCD" size="50" type="STRING"/>
          <Column id="OUTVAT_FLAG" size="1" type="STRING"/>
          <Column id="PO_UOM" size="10" type="STRING"/>
          <Column id="POINT_FLAG" size="1" type="STRING"/>
          <Column id="PR_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="PR_REMARK" size="300" type="STRING"/>
          <Column id="PR_UPJANG" size="22" type="INT"/>
          <Column id="RC_UPJANG" size="22" type="INT"/>
          <Column id="SALE_AMOUNT" size="22" type="BIGDECIMAL"/>
          <Column id="SALE_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="SUBINV_CODE" size="8" type="STRING"/>
          <Column id="TAX_CODE" size="3" type="STRING"/>
          <Column id="UNIT_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="OP_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="OP_AMOUNT" size="22" type="BIGDECIMAL"/>
          <Column id="G_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="D_DAYS" size="4" type="INT"/>
          <Column id="D_DAY_DISP" size="50" type="STRING"/>
          <Column id="D_TIMES" size="4" type="INT"/>
          <Column id="OTCUSTNM" size="100" type="STRING"/>
          <Column id="KG_CONVERT_RATE" size="22" type="BIGDECIMAL"/>
          <Column id="FEATURE_NAME" size="100" type="STRING"/>
          <Column id="IMAGE_PATH" size="200" type="STRING"/>
          <Column id="LIMIT_ITEM" size="50" type="STRING"/>
          <Column id="LIMIT_REASON" size="300" type="STRING"/>
          <Column id="WEEK_ITEM_CODE" size="300" type="STRING"/>
          <Column id="CONSUM_YN" size="1" type="STRING"/>
          <Column id="IMAGE_YN" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_SubinvP"/>
      <Dataset id="ds_Class2"/>
      <Dataset id="ds_Class3"/>
      <Dataset id="ds_Class4"/>
      <Dataset id="ds_Excel"/>
      <Dataset id="ds_ErrLst">
        <ColumnInfo>
          <Column id="errmsg" size="500" type="STRING"/>
          <Column id="errcode" size="100" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_Excel_IN">
        <ColumnInfo>
          <Column id="UPJANG" size="255" type="STRING"/>
          <Column id="ITEM_CODE" size="256" type="STRING"/>
          <Column id="NEED_DATE" size="256" type="STRING"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="ITEM_CODE"/>
            <Col id="NEED_DATE"/>
            <Col id="UPJANG"/>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_Excel_OUT"/>
      <Dataset id="ds_Green">
        <ColumnInfo>
          <Column id="BALANCE_AMT" size="22" type="BIGDECIMAL"/>
          <Column id="GREEN_AMT" size="200" type="STRING"/>
          <Column id="USE_YN" size="2" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_Green_Proc">
        <ColumnInfo>
          <Column id="UPJANG" size="256" type="BIGDECIMAL"/>
          <Column id="NEED_DATE" size="256" type="STRING"/>
          <Column id="CUSER" size="256" type="STRING"/>
          <Column id="OUT_RTN_MESSAGE" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Script type="xscript4.0"><![CDATA[include "U_lib::lib_conversionCom.xjs";
/*
 ******************************************************************************************
 * 시스템구분   : 식재영업/발주관리/상품 발주
 * 프로그램명   : FMP00080E.XML
 * 기      능   : 상품 발주
 * 작  성  자   : 박은규
 * 작성  일자   : 2008-01-17
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
*/
//=========================================================================================
// [ PART 1 ]
// Form에서 Include 할 내용을 정의
//
//=========================================================================================
//@@컨버터에서 주석처리 #include "lib::sc_comon.js"				// 시스템 공통
//@@컨버터에서 주석처리 #include "LIB::lib_comm_0001.js"		//JAVA 코딩시
//@@컨버터에서 주석처리 #include "LIB::tit_comm_0001.js"		// X-Framework Lib
//@@컨버터에서 주석처리 #include "lib::sc_sql_common.js"		// 공통팝업
//@@컨버터에서 주석처리 #include "lib::fm_common.js"			// FM공통
//=========================================================================================
// [ PART 2 ]
// Form에서 사용될 전역변수를 선언
//
//=========================================================================================
var fa_Sql;
var fa_sDay;
var fa_DocSrc = '07 FM(상품)';
var fa_DocSrc1 = '07 FM';             //구 푸드엠 주문내용  ---> 상품발주로 간주
var fa_DocSrc2 = '01 BO';             //아이리스 주문내용   ---> 상품발주로 간주
var pre_need_date = gfn_addDate(gfn_today(),1);  				  //날짜 변경전 이전 날짜 기억
//=========================================================================================
// [ PART 3 ]
// Form Loading 시 작업 정의
//
//=========================================================================================
function form_onload(obj:Form, e:LoadEventInfo)
{
	gfn_formOnLoad(obj, false);

	//초기화
	fsp_init(this);
	v_ds_check = "ds_List";
	
	//ta_Sql.visible = (application.g_AuthLevel == "999");

	//사용자관리화면에서 [여신/공급업체] 항목의 값을 들고와서 
	//발주가능금액, 채권잔액, 실시간입금확인을 컨트롤 함 - (김진희 2014.02.19)
	if (g_Simple_Po_Yn == "Y") 
	{
		//발주가능금액 컨트롤
		st_Credit.visible = false;
		ed_Credit.visible = false;
		//채권잔액 컨트롤
		st_Bond.visible = false;
		ed_Bond.visible = false;
		//실시간입금확인 컨트롤
		btn_RcpConf.visible = false;

		//공급업체 컬럼 컨트롤
		tab_list.tab1.gd_list.setFormatColProperty(11, "size", 0);
		tab_list.tab2.gd_list.setFormatColProperty(11, "size", 0);
		tab_list.tab3.gd_list.setFormatColProperty(11, "size", 0);
		tab_list.tab4.gd_list.setFormatColProperty(12, "size", 0);
	}	
	else 
	{
		//발주가능금액 컨트롤
		st_Credit.visible = true;
		ed_Credit.visible = true;
		//채권잔액 컨트롤
		st_Bond.visible = true;
		ed_Bond.visible = true;
		//실시간입금확인 컨트롤
		btn_RcpConf.visible = true;

		//공급업체 컬럼 컨트롤
		tab_list.tab1.gd_list.setFormatColProperty(11, "size", 80);
		tab_list.tab2.gd_list.setFormatColProperty(11, "size", 80);
		tab_list.tab3.gd_list.setFormatColProperty(11, "size", 80);
		tab_list.tab4.gd_list.setFormatColProperty(12, "size", 80);		
	}

	//기본적으로 사업장은 채권잔액 공개않함. - 이혜은(20130422)
	if(application.g_UserKind == "사업장")
	{
		st_Bond.visible = false;
		ed_Bond.visible = false;
	}

	//실시간 입금확인
	var nX = btn_RcpConf.position.left - (dv_RcpConf.position.width - btn_RcpConf.position.width);
	var nY = btn_RcpConf.position.bottom + 1
	dv_RcpConf.move(nX, nY);	
	
	dv_RcpConf.me_RcpDateT.value = fn_CurrDateWeek();
	dv_RcpConf.me_RcpDateF.value = gfn_addDate(fn_CurrDateWeek(),-1);
	
	ed_Upjang.userdata = application.g_Upjang;
	ed_Upjang.value     = application.g_UpjangNm;
	me_NeedDate.value  = gfn_addDate(fn_CurrDateWeek(),1); //addDate(today(),1);
	if (g_UserKind == '본부')
	{
		btn_copy.visible = true;
	}
	else {	btn_copy.visible = false; }
	//초기화
	fn_ResetData();
	//보조금 사용업장 유무 체크
	//fn_Green_Upjang();
	//보조금 사용 후 잔액 조회
	//fn_Green_Amt();	
	//창고세팅
	fn_SetSubinv(ds_Subinv);
	//디데이
	fn_GetDays();
	//여신정보
	fn_GetCredit(false);
	//최종 발주정보
	//fn_GetLastOrd();
	
	//센터단가업장정보
	fn_SetCtUpj();	
	//분류세팅  2008.12.11 분류 추가. By Noh Kyu Wan
	
	fn_sql_common("C", strQuery_FMItemClass	," AND A.USE_YN = 'Y' AND A.CLASS_TYPE = 'M' AND A.CLASS_CODE LIKE '01%' "," ORDER BY A.CLASS_CODE","all",tab_list.tab1.cbo_Class2,-1,ds_Class2); tab_list.tab1.cbo_Class2.index = 0;
	fn_sql_common("C", strQuery_FMItemClass	," AND A.USE_YN = 'Y' AND A.CLASS_TYPE = 'S' AND A.CLASS_CODE LIKE '01%' "," ORDER BY A.CLASS_CODE","all",tab_list.tab1.cbo_Class3,-1,ds_Class3); tab_list.tab1.cbo_Class3.index = 0;
	fn_sql_common("C", strQuery_FMItemClass	," AND A.USE_YN = 'Y' AND A.CLASS_TYPE = 'D' AND A.CLASS_CODE LIKE '01%' "," ORDER BY A.CLASS_CODE","all",tab_list.tab1.cbo_Class4,-1,ds_Class4); tab_list.tab1.cbo_Class4.index = 0;
	//타이머...
	fn_SetTimer();
	setTimer(777,30000); //일단 30초 세팅
	//
	tab_list.tab4.ed_UpjangP.userdata = ed_Upjang.userdata;
	tab_list.tab4.ed_UpjangP.value     = ed_Upjang.value;
	Copy(ds_SubinvP,ds_Subinv);
	tab_list.tab4.cbo_SubinvP.value   = cbo_Subinv.value;
	tab_list.tab4.me_NeedDateP.value  = gfn_addDate(me_NeedDate.value,-7);
	//자동조회
	fn_search();
	//플래쉬
	//Flash10.Movie = "IMG::WorkingCercle.swf";
	//Flash10.Play();
	//if (ed_Upjang.Enable) ed_Upjang.SetFocus();
	tab_list.tabindex = 0;
	tab_list.tab1.ed_Item.setFocus();
	
	//엑셀 업로드 시 메시지 좌표 기본값 설정
	//dv_Prg.position.left = 264;      dv_Prg.position.top = 452;
	//div_Error.position.left =8;      div_Error.position.top = 368;
	
	//메모리에 상품 검색쿼리 올림 -> 최초 상품 검색시 느린 것을 방지
	//fn_searchItemUpMemory();
}
//=========================================================================================
// [ PART 4 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,도움말,form닫기)
//
//=========================================================================================
/*------------------------------------------------------------(60)
	1. Function ID : fn_Search()
	2. 개       요 : 업무프로세스에 따른 조회작업
	3. 기       능 : 검색조건에 해당하는 정보를 조회
	4. 인 수 설 명 : 
*/
function fn_search()
{
	//필수항목 
	if (fn_ChkManNull()) return;
	//입고통제일 체크 
	if (fn_NeedDateCheck()) 
	{
	    g_Message("EE","해당일자는 입고통제일 입니다.");
	    ds_List.clearData();
	    ds_List1.clearData();
		return;
	}	
		
	fn_SetTimer();
	//최종발주정보
	fn_GetLastOrd();
	// 초기화
	ds_Cond.clearData();
	ds_List.clearData();
	ds_Cond.addRow();
	ds_Cond.setColumn(0, "SUBINV_CODE",    cbo_Subinv.value);
	ds_Cond.setColumn(0, "NEED_DATE",      me_NeedDate.value);
	ds_Cond.setColumn(0, "QTY_CONTROL_YN", ds_Days.getColumn(0,"QTY_CONTROL_YN"));
	
	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	
	// 파라미터셋팅
    inData		= "ds_Cond=ds_Cond";
    outData		= "ds_List=ds_List";
    callBackFnc	= "fn_CallBack_Search";
	otherArg    = "DocSrc=" + wrapQuote(fa_DocSrc);
	otherArg   += " DocSrc1=" + wrapQuote(fa_DocSrc1);
	otherArg   += " DocSrc2=" + wrapQuote(fa_DocSrc2);
	//action 정보 초기화 
	fsp_clear(this); 
    // 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "fm/fmp:FMP00160E_S002");
	// 서버 호출 
	http.Sync = true;
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);		// 서비스 호출 
    http.Sync = false;
    
    if (ed_Green.visible == 'true');
    {
		//보조금 금액 재 계산 프로시져 호출     
		fn_Create_Green_Amt();
		
		//보조금 사용 후 잔액 조회
		//fn_Green_Amt();    
    }    
}
function fn_NeedDateCheck()
{
	//ds임시생성
	var dsObjin, dsObjot;
		
	create("Dataset", "ds_Dummyin");
	create("Dataset", "ds_Dummyot");
	
	dsObjin = eval("ds_Dummyin");
	dsObjin.addColumn("UPJANG", "INT", 22);
	dsObjin.addColumn("NEED_DATE", "STRING", 8);
	dsObjot = eval("ds_Dummyot");
	dsObjot.addColumn("CNT", "INT", 22);
	
	/*-------------*/
	http.Sync = true;
	/*-------------*/
	// 초기화
	ds_Dummyin.clearData();
	ds_Dummyot.clearData();
	ds_Dummyin.addRow();
	ds_Dummyin.setColumn(0, "UPJANG",         ed_Upjang.userdata);
	ds_Dummyin.setColumn(0, "NEED_DATE",      me_NeedDate.value);
	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	// 파라미터셋팅
    inData		= "ds_Cond=ds_Dummyin";
    outData		= "ds_Dummyot=ds_List";
	//action 정보 초기화 
	fsp_clear(this); 
    // 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "fm/fmz:FMZ_ORD_CTRL_S002");
	// 서버 호출 
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);
	/*-------------*/
	http.Sync = false;
	/*-------------*/
	var bYn = (ds_Dummyot.getColumn(0, "CNT") > 0);
	//ds임시생성 해제
	Destroy("ds_Dummyin");
	Destroy("ds_Dummyot");
	
	return bYn;
}
function fn_SearchItem()
{
	//필수항목 
	if (fn_ChkManNull()) return;
	//발주가능 체크
	if (! fn_OrdChk())
	{
		me_NeedDate.setFocus();
		return;
	}
/*
	//입고통제일 체크 
	if (fn_NeedDateCheck()) 
	{
	    g_Message("EE","해당일자는 입고통제일 입니다.");
		return;
	}	
*/
	// 초기화
	ds_Cond.clearData();
	eval("ds_List" + gfn_toString(tab_list.tabindex+1)).clearData();
	ds_Cond.addRow();
	ds_Cond.setColumn(0, "UPJANG",        ed_Upjang.userdata);
	ds_Cond.setColumn(0, "SUBINV_CODE",   cbo_Subinv.value);
	ds_Cond.setColumn(0, "NEED_DATE",     me_NeedDate.value);
	ds_Cond.setColumn(0, "CONSUM_YN",     ds_Subinv.getColumn(ds_Subinv.rowposition,"CONSUM_YN"));
	ds_Cond.setColumn(0, "QTY_CONTROL_YN",ds_Days.getColumn(0,"QTY_CONTROL_YN"));
	ds_Cond.setColumn(0, "CENTER_CODE",   			ds_CtUpj.getColumn(0,"CENTER_CODE"));
	ds_Cond.setColumn(0, "AP_UNITPRICE_UPJANG",     ds_CtUpj.getColumn(0,"AP_UNITPRICE_UPJANG"));
	ds_Cond.setColumn(0, "OTCUST_PRICE_UPJANG",     ds_CtUpj.getColumn(0,"OTCUST_PRICE_UPJANG"));
	ds_Cond.setColumn(0, "ITEM_NAME",     eval("tab_list.tab" + gfn_toString(tab_list.tabindex+1)).ed_Item.text);
	if (tab_list.tabindex == 1)
		ds_Cond.setColumn(0, "FAVOR_GROUP",   tab_list.tab2.cbo_Fav.value);
		
	else if (tab_list.tabindex == 0) // 2008.12.11 추가(분류별 상품 조회 기능)
	{
		ds_Cond.setColumn(0, "ITEM_CLASS2", tab_list.tab1.cbo_Class2.value);    //대분류
		ds_Cond.setColumn(0, "ITEM_CLASS3", tab_list.tab1.cbo_Class3.value);	//중분류
		ds_Cond.setColumn(0, "ITEM_CLASS4", tab_list.tab1.cbo_Class4.value);	//소분류
	}
	else if (tab_list.tabindex == 3)
	{
		if (ffn_ChkNull(tab_list.tab4.me_NeedDateP.value))
		{
			g_Message("EE", "복사대상 일자를 선택하세요."); tab_list.tab4.me_NeedDateP.setFocus(); return;
		}
		if (ffn_ChkNull(tab_list.tab4.ed_UpjangP.userdata))
		{
			g_Message("EE", "복사대상 업장을 선택하세요."); tab_list.tab4.ed_UpjangP.setFocus(); return;
		}
		if (ffn_ChkNull(tab_list.tab4.cbo_SubinvP.value))
		{
			g_Message("EE", "복사대상 식당을 선택하세요."); tab_list.tab4.cbo_SubinvP.setFocus(); return;
		}
		ds_Cond.setColumn(0, "NEED_DATEP",    tab_list.tab4.me_NeedDateP.value);
		ds_Cond.setColumn(0, "UPJANGP",       tab_list.tab4.ed_UpjangP.userdata);
		ds_Cond.setColumn(0, "SUBINV_CODEP",  tab_list.tab4.cbo_SubinvP.value);
	}
	
	// 조회
	var strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc;
	// 경로 설정
	strSvcID = "FMP00080E_T001";
	strURL   = "U_svc::" + "fm/fmp/FMP00080E_T001.jsp";
	// 데이터셋 설정
	strInDatasets  = "ds_Cond=ds_Cond";
	strOutDatasets = "ds_List" + gfn_toString(tab_list.tabindex+1)+ "=ds_List";
	// 파라메터 설정
	strArgument  = "g_Upjang=" + wrapQuote(g_Upjang);
	strArgument += " g_EmpNo=" + wrapQuote(g_EmpNo);
	strArgument += " Holiday_YN=" + wrapQuote(application.g_HOLIDAY_CHK_YN);	
	strArgument += " strIndex=" + wrapQuote(gfn_toString(tab_list.tabindex+1));
    if (eval("tab_list.tab" + gfn_toString(tab_list.tabindex+1)).chk_Only.value)
		strArgument += " strOnly='TRUE'";
	else
		strArgument += " strOnly='FALSE'";
	strArgument += " sType=" + wrapQuote(cbo_Type.value);

	// 콜백함수 지정
	strCallbackFunc = "fn_CallBack_SearchItem";
	// 서버 호출 
	//Transaction(strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc);
	jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, false, false, true);
}
/*------------------------------------------------------------
	1. Function ID : fn_Insert()
	2. 개       요 : 업무프로세스에 따른 입력작업
	3. 기       능 : 입력버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*/
function fn_insert()
{
}
/*------------------------------------------------------------
	1. Function ID : fn_Delete()
	2. 개       요 : 업무프로세스에 따른 입력작업
	3. 기       능 : 입력버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*/
function fn_delete()
{
	if (ds_List.rowcount < 1)
	{
		g_Message("EE", fn_AlertMsg("006"));
		return;
	}
	if (ds_List.rowposition < 0)
	{
		g_Message("EE", "삭제할 상품을 선택하세요.");
		return;
	}
	//if (ds_List.GetColumn(ds_List.row,"LINE_STATUS") <> "004")
	if (ds_List.getColumn(ds_List.rowposition,"CLS_STATUS") == "마감")
	{
		g_Message("EE", "해당상품은 마감이 완료되어 삭제가 불가합니다.");
		return;
	}
	//발주가능 체크
	if (! fn_OrdChk()) return;
	//기존 자료인 경우 디데이 체크
	if (GetRowType(ds_List,ds_List.rowposition)<> 'insert')
	{
		if (fn_GetDayStatus(ds_List.getColumn(ds_List.rowposition,"D_DAYS"), ds_List.getColumn(ds_List.rowposition,"D_TIMES")) == "0")
		{
			g_Message("EE","해당 상품은 마감시간(D-Days)이 초과되어 삭제가 불가합니다.");
			return;
		}
	}
	//
	if (! g_Confirm("01", '선택하신 주문상품을 삭제하시겠습니까?!')) return;
	if (GetRowType(ds_List,ds_List.rowposition)== 'insert')
	{
		ds_List.deleteRow(ds_List.rowposition);
		return;
	}
	
	//실제 Table자료 삭제 시 Table에서 즉시 삭제처리
	//필수항목 
	if (fn_ChkManNull()) return;
	//
	var strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc;
	// 경로 설정
	strSvcID = "FMP00160E_T003";
	strURL   = "U_svc::" + "fm/fmp/FMP00160E_T003.jsp";
	// 데이터셋 설정U
	strInDatasets  = "";
	strOutDatasets = "";
	// 파라메터 설정
	strArgument  = "g_Upjang=" + wrapQuote(g_Upjang);
	strArgument += " g_EmpNo=" + wrapQuote(g_EmpNo);
	strArgument += " sDocSrc=" + wrapQuote(fa_DocSrc);
	strArgument += " sPrID=" + wrapQuote(ds_List.getColumn(ds_List.rowposition,"PR_ID"));
	strArgument += " sOtcustCD=" + wrapQuote(ds_List.getColumn(ds_List.rowposition,"OTCUSTCD"));
	//strArgument += " sMenuFlag=" + wrapQuote(ds_List.getColumn(ds_List.rowposition,"MENU_FLAG"));
	strArgument += " sUpjang=" + wrapQuote(ds_List.getColumn(ds_List.rowposition,"RC_UPJANG"));
	strArgument += " sMenuCD=" + wrapQuote(ds_List.getColumn(ds_List.rowposition,"NEED_DATE") + "-" + ds_List.getColumn(ds_List.rowposition,"SUBINV_CODE"));
	strArgument += " sItemCode=" + wrapQuote(ds_List.getColumn(ds_List.rowposition,"ITEM_CODE"));
	// 콜백함수 지정
	strCallbackFunc = "fn_CallBack_Delete";
	// 서버 호출 
	//Transaction(strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc);
	jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, false, false, true);
}
/*------------------------------------------------------------
	1. Function ID : fn_Save(confirmYn)
	2. 개       요 : 업무프로세스에 따른 입력작업
	3. 기       능 : 입력버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : confirmYn = null 이면 저장하시겠습니까라는 창을 띄움
	                 confirmYn = 1 이면 저장하시겠습니까라는 창을 안띄움
*/
function fn_save(confirmYn)
{
	//저장 버튼 누른 후 팝업 상태에서 마감시간 이후 저장 체크를 위한 변경
	//[HISTORY] : 수정일 > 2009/01/19
	//            수정자 > 노규완
	//            수정 내용 > 저장 Confirm 팝업 메시지를 제일 먼저 띄어 줌.
	
/*
	//입고통제일 체크 
	if (fn_NeedDateCheck()) 
	{
	    g_Message("EE","해당일자는 입고통제일 입니다.");
		return;
	}	
*/
	//if(confirmYn = null)
	//{
	//	if (! g_Confirm("02", '주문내역을 저장하시겠습니까?!')) return;
	//}
	
	//발주량 0상품 확인
	var nRow;
	nRow = ds_List.findRowExpr("PR_QTY==0");
	if (nRow >= 0)
	{
		if (! g_Confirm("02", '발주량이 0인 상품이 있습니다.\n\n그대로 저장하시겠습니까?!'))
		{
			ds_List.rowposition = nRow;
			gd_list.setFocus();
			gd_list.setCellPos(ffn_Get_HeaderTitleColIdx(gd_list,"수량"));
			return;
		}
	}
	
	//현재시간 초기화. 
	//발주가능, 데이타체크에서 현재시간을 통해 계산하기때문에
	fn_SetTimer();
	//필수항목 
	if (fn_ChkManNull()) return;
	//발주가능 체크(창고)
	if (! fn_OrdChk()) return;
	// 데이타체크(여신및 상품별 디데이체크)
	var sRtn = fn_ChkData();
	if (sRtn != null)
	{
		g_Message("EE", sRtn);
		return;
	}
	
/*
   	// action 정보 초기화 
    tit_clearActionInfo(this);
	// 초기화
	ds_Cond.ClearData();
	ds_Cond.AddRow();
	ds_Cond.SetColumn(0, "SUBINV_CODE",    cbo_Subinv.Value);
	ds_Cond.SetColumn(0, "NEED_DATE",      me_NeedDate.Value);
    // 서비스셋팅
    var actionName, cmdName, inData, outData, otherArg, callBackFnc;
    var singleSql, insertSql, updateSql, deleteSql, saveFlagColumn, keySqlName, keyIncrement, callbackSql;
    inData		= "ds_IUD=ds_List:U ds_Cond=ds_Cond";
    outData		= "ds_List=ds_List";
    callBackFnc	= "fn_CallBack_Save";
	// 파라미터셋팅
    insertSql	= "fm/fmp:FMP00160E_I001";
    updateSql	= "fm/fmp:FMP00160E_U001";
    deleteSql	= "fm/fmp:FMP00160E_D001";
//    keySqlName	= "fm/fmz:FMZ_PR_NUM_S002";
//    keyIncrement= 0;
    callbackSql	= "fm/fmp:FMP00160E_S002";
	// 서버에서 작업할 정보 추가
	tit_addSearchActionInfo(this, "fm/fmz:FMZ_PR_NUM_S002", true);
	tit_addSaveActionInfo(this, insertSql, updateSql, deleteSql, saveFlagColumn, keySqlName, keyIncrement, callbackSql);
	// 서버 호출
	tit_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);		// 서비스 호출 
*/
	var strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc;
	// 경로 설정
	strSvcID = "FMP00160E_T001";
	strURL   = "U_svc::" + "fm/fmp/FMP00160E_T001.jsp";
	// 데이터셋 설정U
	strInDatasets  = "ds_IUD=ds_List:U";
	strOutDatasets = "";
	// 파라메터 설정
	strArgument  = "sSubinv=" + wrapQuote(cbo_Subinv.value);
	strArgument += " sNeedDate=" + wrapQuote(me_NeedDate.value);
	strArgument += " g_Upjang=" + wrapQuote(g_Upjang);
	strArgument += " g_EmpNo=" + wrapQuote(g_EmpNo);
	strArgument += " sDocSrc=" + wrapQuote(fa_DocSrc);
	// 콜백함수 지정
	strCallbackFunc = "fn_CallBack_Save";
	//바이너리 통신 설정
	//http.Compress = true;
	//http.CompressMethod = "ZLIB";
	////http.XmlFormat = false;
	//바이너리 통신 설정	
	// 서버 호출 
	//Transaction(strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc);
	jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, false, false, true);
}
/*------------------------------------------------------------
	1. Function ID : fn_Print()
	2. 개       요 : 업무프로세스에 따른 입력작업
	3. 기       능 : 입력버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*/
function fn_print()
{
	//gd_listE.ExportExcelEx("단가표");
}
/*------------------------------------------------------------
	1. Function ID : fn_Close()
	2. 개       요 : 업무프로세스에 따른 입력작업
	3. 기       능 : 입력버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*/
function fn_Close()
{
	This.close();
}
/*------------------------------------------------------------
	1. Function ID : fn_Help()
	2. 개       요 : 업무프로세스에 따른 입력작업
	3. 기       능 : 입력버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*/
function fn_help()
{
}
//=========================================================================================
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
//
//=========================================================================================
/*------------------------------------------------------------
	1. Function ID : fn_AlertMsg(cd)
	2. 개       요 : 메세지 처리
	3. 기       능 : 화면에 나타나는 메시지 코드및 텍스트 리턴
	4. 인 수 설 명 : cd : 원하는 메시지 코드
*/
function fn_AlertMsg(cd)
{
	var v_Msg="";
	switch(cd)
	{
		case "000":
			v_Msg= "이(가) 저장되었습니다.";
			break;
		case "001":
			v_Msg= "버튼이 정의 되어 있지않습니다.";
			break;
		case "002":
			v_Msg="서비스 오류:시스템 관리자에게 문의하십시오";
			break;
		case "003":
			v_Msg="필수항목은 반드시 선택하시기 바랍니다.";
			break;	
		case "004":
			v_Msg="작업대상 본사를 선택하세요.";
			break;
		case "005":
			v_Msg="을(를) 입력하세요";
			break;
		case "006":
			v_Msg="삭제할 데이터가 없습니다.";
			break;
		case "007":
			v_Msg="변경된 데이터가 없습니다.";
			break;
		case "008":
			v_Msg="시스템ID가 없습니다.";
			break;			
/*			
		case "":
			v_Msg="";
			break;
*/			
		default:
			break;			
	}
	return v_Msg;
}
//콜백
function fn_CallBack_Search(errCode, errMsg)
{
	if (errCode == 0)
	{
		if (ds_List.rowcount < 1)
		{
			g_Message("EE","주문등록한 상품이 없습니다.");
			//me_NeedDate.SetFocus();
			eval("tab_list.tab" + gfn_toString(tab_list.tabindex+1)).ed_Item.setFocus();
		}
		else
			fn_CLS_STATUS_Setting();
	}
	else
		g_Message("EE",fn_AlertMsg("002"));
}
//function fn_CallBack_SearchItem(SvcID, errCode, errMsg)
function fn_CallBack_SearchItem(errCode, errMsg)
{
ta_Sql.value = fa_Sql;
	if (errCode == 0)
	{
		if (eval("ds_List" + gfn_toString(tab_list.tabindex+1)).rowcount < 1)
		{
			g_Message("EE","검색된 상품이 없습니다.");
			eval("tab_list.tab" + gfn_toString(tab_list.tabindex+1)).ed_Item.setFocus();
		}
		else
		{
			eval("tab_list.tab" + gfn_toString(tab_list.tabindex+1)).gd_list.setFocus();
			if (tab_list.tabindex < 3)
				Sort(eval("ds_List" + gfn_toString(tab_list.tabindex+1)),"ITEM_CODE");
			else
				Sort(eval("ds_List" + gfn_toString(tab_list.tabindex+1)),"PR_ID");
				
			eval("ds_List" + gfn_toString(tab_list.tabindex+1)).rowposition = 0;
		}
	}
	else
		g_Message("EE","주문상품 조회하는 중에 오류가 발생하였습니다! \n 관리자에게 문의하세요.");
}
//function fn_CallBack_Delete(SvcID, errCode, errMsg)
function fn_CallBack_Delete(errCode, errMsg)
{
ta_Sql.value = fa_Sql;
	if (errCode == 0)
	{
		//PR_ID를 (-)으로 설정하여 저장 시 다시 삭제하는 일이 없도록 한다.
		ds_List.setColumn(ds_List.rowposition,"PR_ID","-1");
		ds_List.deleteRow(ds_List.rowposition);
		//삭제자료만 존재한다면 데이타셑의 row type을 초기화 하여 삭제상태를 초기화 한다.
		if (ds_List.getCaseCount("rowtype='insert'||rowtype='update'") <= 0) ds_List.applyChange();
	}
	else
		g_Message("EE",fn_AlertMsg("002"));
}
//function fn_CallBack_Save(SvcID, errCode, errMsg)
function fn_CallBack_Save(errCode, errMsg)
{
ta_Sql.value = fa_Sql;

	//바이너리 통신 해제
	//http.Compress = false;
	//http.CompressMethod = "";
	//http.XmlFormat = true;
	//바이너리 통신 해제
	if (errCode == 0)
	{
		fn_GetCredit(false);
		fn_search();
		g_Message("02","주문자료" + fn_AlertMsg("000"));
	}
	else
		g_Message("EE",fn_AlertMsg("002"));
}
function fn_ChkManNull()
{
	if (ffn_ChkNull(ed_Upjang.userdata))
	{
		g_Message("EE", "사업장" + fn_AlertMsg("005"));
		if (ed_Upjang.enable) ed_Upjang.setFocus();
		return true;
	}
	if (ffn_ChkNull(cbo_Subinv.value))
	{
		g_Message("EE", "식당을 선택하세요.");
		if (cbo_Subinv.enable) cbo_Subinv.setFocus();
		return true;
	}
	if ( ffn_ChkNull(me_NeedDate.value) || (gfn_length(me_NeedDate.value)< 8) )
	{
		g_Message("EE", "입고예정일을 정확하게 입력하세요.");
		me_NeedDate.setFocus();
		return true;
	}
	//
	return false;
}
function fn_ChkData()
{
	//변경여부 확인
	if ( (! gfn_dsIsUpdated(ds_List)) )
	{
		return fn_AlertMsg("007");
	}
	//여신정보 재조회
	fn_GetCredit(true);
	//여신한도초과여부
	//if (ed_Credit.Text != "무 제 한")
	if (ds_CrdInfo.rowcount > 0)
	{
		//여신금액
		if (ds_CrdInfo.getColumn(0,"CREDIT_AMOUNT_CONTROL_YN") == "Y")
		{
			var nAmt = 0;
			for (i=0; i<ds_List.rowcount; i++)
				nAmt += Math.round((ds_List.getColumn(i,"OP_AMOUNT") - ds_List.getColumn(i,"OP_AMOUNT_OLD")) * iif(ds_List.getColumn(i,"TAX_CODE")=="100",1.1,1));
			if (nAmt > toNumber(ds_CrdInfo.getColumn(0,"CREDIT_AVAIL_AMT")))
			{
				return "주문가능한 여신한도를 초과하여 주문이 불가합니다.";
			}
		}
		//여신회전일
		if (ds_CrdInfo.getColumn(0,"CREDIT_TURN_CONTROL_YN") == "Y")
		{
			if (toNumber(ds_CrdInfo.getColumn(0,"LAST_TURN_CNT")) >= 0)
			{
				if (toNumber(ds_CrdInfo.getColumn(0,"LAST_TURN_CNT")) > toNumber(ds_CrdInfo.getColumn(0,"CREDIT_TURN_DAYS_TOT")))
				{
					return ds_CrdInfo.getColumn(0,"L_BILL_DATE_DISP") + "에 매출채권이 존재하여 주문이 불가합니다.";
				}
			}
		}
	}
	//상품별 디데이 체크
	for (i=0; i<ds_List.rowcount; i++)
	{
		if (GetRowType(ds_List,i)<> 'normal')
		{
			//수량 0인건 어차피 지울꺼니 패스...
			//if ( NumFormat(ds_List.GetColumn(i,"PR_QTY"),1) == "0.0" ) continue;
			if (( GetRowType(ds_List,i)== 'insert' ) && ( gfn_numFormat(gfn_trim(ds_List.getColumn(i,"PR_QTY")),1)== "0" )) continue;
			//기존자료이거나 무통제면 패스...
			if ( numFormat(ds_List.getColumn(i,"D_DAYS"))== "0" ) continue;
			//디데이체크
/*			
			if ( addDate(gds_currdate.GetColumn(0,"YMD"),ds_List.GetColumn(i,"D_DAYS")) > me_NeedDate.Value )
			{
				ds_List.row = i;
				return ("[" + ds_List.GetColumn(i,"ITEM_NAME") + "]상품은 주문일자(D-" + ds_List.GetColumn(i,"D_DAYS") + ")를 초과하여 주문이 불가합니다.");
			}
			else if ( addDate(gds_currdate.GetColumn(0,"YMD"),ds_List.GetColumn(i,"D_DAYS")) = me_NeedDate.Value )
			{
				//디타임체크
				if ( substr(gds_currdate.GetColumn(0, "YMD_TM"),8,4) > ds_List.GetColumn(i,"D_TIMES") )
				{
					ds_List.row = i;
					return ("[" + ds_List.GetColumn(i,"ITEM_NAME") + "]상품은 주문시간(" + right("0"+ds_List.GetColumn(i,"D_TIMES"),4) + ")을 초과하여 주문이 불가합니다.");
				}
			}
*/
			if (fn_GetDayStatus(ds_List.getColumn(i,"D_DAYS"), ds_List.getColumn(i,"D_TIMES")) == "0")
			{
				ds_List.rowposition = i;
				return ("[" + ds_List.getColumn(i,"ITEM_NAME") + "]상품은 마감시간(D-Days)을 초과하여 주문이 불가합니다.");
			}
		}
        //-----------------------------------------------------------------------------------
		//--- 체크로직 추가 
		//    수정일    : 2010/10/28 BY 노규완
		//    수정내용  : 상품 수량 입력 시 기존에는 라인별로 최대발주량 체크 하였으나,
		//                추가 상품으로 동일 상품을 등록 한 다음 최대 발주량만 넘지 않으면 
		//                추가로 상품이 저장 되는 문제가 발생하여, 입고 예정일 기준으로 
		//                동일 상품의 총 합계를 체크 하여 최대 발주량을 넘는지 체크 한다.
		//    수정일    : 2013/08/01 BY 박용대
		//    수정내용  : 상품을 저장할때 아이리스에서 취소한 목록들이 발주내역에 올라오게되는데
		//                이것들이 최대 발주량계산에 포함되어 있어 발주상태가 003,005인 항목을
		//                제외하고 CASESUM 하는 부분을 추가.
		//-----------------------------------------------------------------------------------
		if ((ds_List.getColumn(i,"MAX_ORD_QTY") > 0) && ( ds_List.getCaseSum("ITEM_CODE=='"+ds_List.getColumn(i,"ITEM_CODE")+"'&& (LINE_STATUS <> '005' && LINE_STATUS <> '003') && DOCU_SOURCE <> '01 BO'","PR_QTY") > ds_List.getColumn(i,"MAX_ORD_QTY")))  
		{   
		    if (toNumber(ds_List.getColumn(i,"PR_NUM")) <> 0)
		    {
		        //동일상품의 다른 주문날짜일 경우 합산은 최대발주량을 넘어도 상관없다.
		        if ( ds_List.getCaseSum("PR_NUM=='"+ds_List.getColumn(i,"PR_NUM")+"'","PR_QTY") <= ds_List.getColumn(i,"MAX_ORD_QTY"))
		            continue;
		    }
       	    ds_List.rowposition = i;
		    return ("[" + ds_List.getColumn(i,"ITEM_NAME") + "] 상품이 최대 발주량" + ds_List.getColumn(i,"MAX_ORD_QTY") + ")를 초과하여 주문이 불가합니다.");
		}		
	}
	//수량 0인거 제거...
	for (i=ds_List.rowcount-1; i>=0; i--)
	{
		if ( gfn_numFormat(gfn_trim(ds_List.getColumn(i,"PR_QTY")),1)== "0" ) ds_List.deleteRow(i);
	}
}
function fn_FormKeyDown(obj:Form, e:KeyEventInfo)
{
	gfn_formKeyDown(obj, e); //(obj,e.fromreferenceobject,e.keycode,e.shiftKey,e.ctrlKey,e.altKey,-1,-1);
	//입고예정일에서 엔터시 조회
	//if ( (nChar == 13) && (objSenderObj == me_NeedDate) ) fn_Search();
	//임시로...'F12'입력시 타이머 작동중지
	if (e.keycode == 123) killTimer(777);
}	
function fn_edBtn_OnClick(obj:Button, e:ClickEventInfo)
{
	if(gfn_dsIsUpdated(ds_List)==true)
	{
		if(g_Confirm("02","변경된 내역이 있습니다. 변경된 내역을 저장하시겠습니까?"))
		{
			fn_save(1);
		}
	}
	
	var sAddWhere = "";
	var sOnBoard  = "";
	
	switch(obj.name)
	{
		case "btn_Upjang":
			sAddWhere = " AND A.USE_YN = 'Y'";
			//본사인 경우 해당 사업장 조회
			if (application.g_UserKind == '본사')
				sAddWhere += " AND A.MAIN_UPJANG = " + application.g_Main_Upjang;
			//사업장인 경우 관리업장만 조회
			else if (application.g_UserKind == '사업장')
				sAddWhere += " AND ( A.UPJANG = " + application.g_Upjang + " OR EXISTS (SELECT 1 FROM FMS_USER_UPJANG B WHERE B.USE_YN = 'Y' AND B.UPJANG = A.UPJANG AND B.SABUN = '" + application.g_EmpNo + "') )";
			break;
		case "btn_UpjangP":
			sAddWhere = " AND A.USE_YN = 'Y'";
			//본사인 경우 해당 사업장 조회
			if (application.g_UserKind == '본사')
				sAddWhere += " AND A.MAIN_UPJANG = " + application.g_Main_Upjang;
			//사업장인 경우 관리업장만 조회
			else if (application.g_UserKind == '사업장')
				sAddWhere += " AND ( A.UPJANG = " + application.g_Upjang + " OR EXISTS (SELECT 1 FROM FMS_USER_UPJANG B WHERE B.USE_YN = 'Y' AND B.UPJANG = A.UPJANG AND B.SABUN = '" + application.g_EmpNo + "') )";
			sOnBoard  = "tab_list.tab4.";
			break;
		default:
			break;
	}
	//fm공통 팝업클릭 호출
	if (ffn_btn_OnClick(obj, sAddWhere, sOnBoard)) fn_Trigger_edBtn(eval(sOnBoard + "ed_" + gfn_subStr(obj.name, 4)));
}
function fn_edBtn_OnKeyDown(obj:Edit, e:KeyEventInfo)
{
	if(gfn_dsIsUpdated(ds_List)==true)
	{
		g_Message("EE","변경된 내역이 있습니다. 저장해 주십시요");
		return;
		/*
		if(g_Confirm("02","변경된 내역이 있습니다. 변경된 내역을 저장하시겠습니까?"))
		{
			fn_Save(1);
		}
		*/
	}
	
	var sOnBoard = "";
	if (obj == tab_list.tab4.ed_UpjangP) sOnBoard = "tab_list.tab4.";
	
	ffn_ed_OnKeyDown(obj,e.keycode,sOnBoard);
	//Del의 경우 뒷처리
	//if (nChar == 46) fn_Trigger_edBtn(obj);
	if (e.keycode == 46) fn_Trigger_edBtn(eval(sOnBoard + "ed_" + gfn_subStr(obj.name, 3)));
}
function fn_Trigger_edBtn(obj)
{
	switch(obj)
	{
		case ed_Upjang:
			//초기화
			fn_ResetData();
			if (! ffn_ChkNull(obj.userdata))
			{
				//창고세팅
				fn_SetSubinv(ds_Subinv);
				//디데이
				fn_GetDays();
				//
				//fn_SetTimer();
				//여신정보
				fn_GetCredit(false);
				//최종 발주정보
				//fn_GetLastOrd();
				//즐겨찾기그룹
				fn_SetFav();
				//센터단가업장정보
				fn_SetCtUpj();
				//자동조회
				fn_search();
			}
			break;
			
		case tab_list.tab4.ed_UpjangP:
			//초기화
			ds_List4.clearData();
			//창고세팅
			fn_SetSubinv(ds_SubinvP);
			break;
			
		default:
			break;
	}
}
function fn_ResetData()
{
	ds_Subinv.clearData();
	//ds_SubinvP.ClearData();
	st_Days.text = "(발주 마감 : - -)";
	st_Timer.text = "";
	ed_Credit.value = "";
	me_Pdate.value = "";
	ed_Pcnt.value = "";
	ed_Pamt.value = "";
	ds_List.clearData();
	ds_List1.clearData();
	ds_List2.clearData();
	ds_List3.clearData();
	ds_List4.clearData();
	//
	me_NeedDate.value  = gfn_addDate(gds_currdate.getColumn(0, "YMD"),1);
}
function fn_SetSubinv(ds_Obj)
{
	/*-------------*/
	http.Sync = true;
	/*-------------*/
	// 초기화
	ds_Obj.clearData();
	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	// 파라미터셋팅
    outData		= ds_Obj.name + "=ds_List";
    if (ds_Obj == ds_Subinv)
		otherArg	= "UPJANG=" + wrapQuote(ed_Upjang.userdata);
	else
		otherArg	= "UPJANG=" + wrapQuote(tab_list.tab4.ed_UpjangP.userdata);
	//action 정보 초기화 
	fsp_clear(this); 
    // 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "fm/fmz:FMZ_PO_SUBINV_S001");
	// 서버 호출 
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);
	/*-------------*/
	http.Sync = false;
	/*-------------*/
	//기본창고지정
    if (ds_Obj == ds_Subinv)
    {
		if (ds_Obj.rowcount > 0) cbo_Subinv.index = 0;
	}
	else
	{
		if (ds_Obj.rowcount > 0) tab_list.tab4.cbo_SubinvP.index = 0;
	}
}
function fn_GetDays()
{
	// 초기화(디데이)
	ds_Days.clearData();
	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	// 파라미터셋팅
    outData		= "ds_Days=ds_List";
    otherArg	= "UPJANG=" + wrapQuote(ed_Upjang.userdata) + " SUBINV_CODE=" + wrapQuote(cbo_Subinv.value) + " NEED_DATE=" + wrapQuote(me_NeedDate.value);
	//action 정보 초기화 
	fsp_clear(this); 
    // 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "fm/fmz:FMZ_GETDAYS_S001");
	// 서버 호출 
	http.Sync = true;
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);
	http.Sync = false;
	//디데이 표시
	if (ds_Days.rowcount > 0)
		st_Days.text = "(발주 마감 : " + ds_Days.getColumn(0,"DAYS") + ")";
	else
	{
		g_Message("EE","발주마감정보를 확인할 수 없습니다.!" + "\n\n" + "관리자에게 문의하세요.");
		//close();
	}
	// 초기화(주문통제)
	ds_OrdCtrl.clearData();
	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	// 파라미터셋팅
    outData		= "ds_OrdCtrl=ds_List";
    otherArg	= "UPJANG=" + wrapQuote(ed_Upjang.userdata);
	//action 정보 초기화 
	fsp_clear(this); 
    // 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "fm/fmz:FMZ_ORD_CTRL_S001");
	// 서버 호출 
	http.Sync = true;
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);
	http.Sync = false;
}
function fn_GetCredit(isSync)
{
	if (! fn_GetCrdYn())
	{
		//여신정보 초기화
		ds_CrdInfo.clearData();
		ed_Credit.value = "무 제 한";
		return;
	}
	// 초기화
	ds_Cond.clearData();
	ds_CrdInfo.clearData();
	ds_Cond.addRow();
	ds_Cond.setColumn(0, "UPJANG",         ed_Upjang.userdata);
	ds_Cond.setColumn(0, "NEED_DATE",      me_NeedDate.value);
/*
	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	// 파라미터셋팅
    inData		= "ds_Cond=ds_Cond";
    outData		= "ds_CrdInfo=ds_List";
	//action 정보 초기화 
	tit_clearActionInfo(this); 
    // 서버에서 조회할 정보 추가 
	tit_addSearchActionInfo(this, "fm/fmz:FMZ_CREDIT_INFO_S001");
	// 서버 호출 
    tit_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);
*/
	// 조회
	var strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc;
	// 경로 설정
	strSvcID = "FMZ_CREDIT_INFO_T001";
	strURL   = "U_svc::" + "fm/fmz/FMZ_CREDIT_INFO_T001.jsp";
	// 데이터셋 설정
	strInDatasets  = "ds_Cond=ds_Cond";
	strOutDatasets = "ds_CrdInfo=ds_List";
	// 파라메터 설정
	strArgument  = "g_Upjang=" + wrapQuote(g_Upjang);
	strArgument += " g_EmpNo=" + wrapQuote(g_EmpNo);
	strCallbackFunc = "fn_GetCredit_callback";
	//strArgument += " strDate=" + quote(me_Pdate.Value);
	// 서버 호출 
	//Transaction(strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc);
	jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, false, false, isSync);
}

function fn_GetCredit_callback(errCode, errMsg)
{
ta_Sql.value = fa_Sql;
		if (errCode == 0)
	{
		//여신 표시
		if (ds_CrdInfo.rowcount > 0) 
		{
			if (ds_CrdInfo.getColumn(0,"CREDIT_AMOUNT_CONTROL_YN") == "Y")
			{
				ed_Credit.value = gfn_numFormat(ds_CrdInfo.getColumn(0,"CREDIT_RMN_AMT"))+ " 원";
				ed_Bond.value = gfn_numFormat(ds_CrdInfo.getColumn(0,"BOND_AMT"))+ " 원";
			}
			else
				ed_Credit.value = "무 제 한";
		}
		else
		{
			g_Message("EE","업장여신정보를 확인할 수 없습니다.!" + "\n\n" + "관리자에게 문의하세요.");
			close();
		}
	}
	else
		g_Message("EE",fn_AlertMsg("002"));	
}
function fn_GetCrdYn()
{
	//ds임시생성
	var dsObjin, dsObjot;
		
	create("Dataset", "ds_Dummyin");
	create("Dataset", "ds_Dummyot");
	
	dsObjin = eval("ds_Dummyin");
	dsObjin.addColumn("UPJANG", "INT", 22);
	dsObjin.addColumn("NEED_DATE", "STRING", 8);
	dsObjot = eval("ds_Dummyot");
	dsObjot.addColumn("CRD_YN", "STRING", 1);
	
	/*-------------*/
	http.Sync = true;
	/*-------------*/
	// 초기화
	ds_Dummyin.clearData();
	ds_Dummyot.clearData();
	ds_Dummyin.addRow();
	ds_Dummyin.setColumn(0, "UPJANG",         ed_Upjang.userdata);
	ds_Dummyin.setColumn(0, "NEED_DATE",      me_NeedDate.value);
	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	// 파라미터셋팅
    inData		= "ds_Cond=ds_Dummyin";
    outData		= "ds_Dummyot=ds_List";
	//action 정보 초기화 
	fsp_clear(this); 
    // 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "fm/fmz:FMZ_CREDIT_CHKYN_S001");
	// 서버 호출 
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);
	/*-------------*/
	http.Sync = false;
	/*-------------*/
	var bYn = (ds_Dummyot.rowcount > 0);
	//ds임시생성 해제
	Destroy("ds_Dummyin");
	Destroy("ds_Dummyot");
	return  bYn;
}
function fn_GetLastOrd()
{
	//ds임시생성
	var dsObjin, dsObjot;
		
	create("Dataset", "ds_Dummyin");
	create("Dataset", "ds_Dummyot");
	
	dsObjin = eval("ds_Dummyin");
	dsObjin.addColumn("SUBINV_CODE", "STRING", 8);
	dsObjin.addColumn("NEED_DATE", "STRING", 8);
	dsObjin.addColumn("DOCU_SOURCE", "STRING", 50);
	dsObjot = eval("ds_Dummyot");
	dsObjot.addColumn("NEED_DATE", "STRING", 8);
	dsObjot.addColumn("CNT", "DECIMAL", 22);
	dsObjot.addColumn("AMT", "DECIMAL", 22);
	
	// 초기화
	dsObjin.clearData();
	dsObjot.clearData();
	dsObjin.addRow();
	dsObjin.setColumn(0, "SUBINV_CODE",    cbo_Subinv.value);
	dsObjin.setColumn(0, "NEED_DATE",      me_NeedDate.value);
	dsObjin.setColumn(0, "DOCU_SOURCE",    fa_DocSrc);
	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	// 파라미터셋팅
    inData		= "ds_Cond=ds_Dummyin";
    outData		= "ds_Dummyot=ds_List";
	otherArg    = "DocSrc1=" + wrapQuote(fa_DocSrc1);
	otherArg   += " DocSrc2=" + wrapQuote(fa_DocSrc2);
	callBackFnc = "fn_GetLastOrd_callback";
	//action 정보 초기화 
	fsp_clear(this); 
    // 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "fm/fmp:FMP00160E_S001");
	// 서버 호출 
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);		// 서비스 호출 

}

function fn_GetLastOrd_callback(errCode, errMsg)
{
	if (errCode == 0)
	{
		//최근 발주 표시
		if (ds_Dummyot.rowcount > 0)
		{
			me_Pdate.value = ds_Dummyot.getColumn(ds_Dummyot.rowcount-1,"NEED_DATE");
			ed_Pcnt.value = '총 (' + numFormat(ds_Dummyot.getColumn(ds_Dummyot.rowcount-1,"CNT"))+ ') 건';
			ed_Pamt.value = numFormat(ds_Dummyot.getColumn(ds_Dummyot.rowcount-1,"AMT"))+ ' 원';
		}
		else
		{
			me_Pdate.value = "";
			ed_Pcnt.value = "";
			ed_Pamt.value = "";
		}
		//ds임시생성 해제
		Destroy("ds_Dummyin");
		Destroy("ds_Dummyot");
	}
	else
		g_Message("EE",fn_AlertMsg("002"));
}

function fn_OrdChk()
{
	fn_GetDays();
	fn_CurrDateWeek();

	//입고통제일 체크 
	if (fn_NeedDateCheck()) 
	{
	    g_Message("EE","해당일자는 입고통제일 입니다.");
   	    ds_List.clearData();
	    ds_List1.clearData();

		return false;
	}

	//발주통제일자
	if (toNumber(ds_Days.getColumn(0,"D_OVER_DAYS")) > 0)
	{
		if (me_NeedDate.value > gfn_addDate(gds_currdate.getColumn(0, "YMD"),toNumber(ds_Days.getColumn(0,"D_OVER_DAYS"))))
		{
			g_Message("EE", ds_Days.getColumn(0,"D_OVER_DAYS") + "일을 초과하여 입고예정일을 지정할 수 없습니다.");
			return false;
		}
	}
	//발주제한일자
	if (toNumber(ds_Days.getColumn(0,"D_DAYS")) > 0)
	{
		if (me_NeedDate.value < gfn_addDate(gds_currdate.getColumn(0, "YMD"),toNumber(ds_Days.getColumn(0,"D_DAYS"))))
		{
			g_Message("EE", "발주마감은 " + ds_Days.getColumn(0,"DAYS") + "입니다.");
			return false;
		}
		if (me_NeedDate.value == gfn_addDate(gds_currdate.getColumn(0, "YMD"),toNumber(ds_Days.getColumn(0,"D_DAYS"))))
		{
			if (gfn_subStr(gds_currdate.getColumn(0, "YMD_TM"),8,6)> ds_Days.getColumn(0,"D_TIMES"))
			{
				g_Message("EE", "발주마감은 " + ds_Days.getColumn(0,"DAYS") + "입니다.");
				return false;
			}
		}
	}
	//창고가 식재 또는 소모품 전용창고인 경우 주문통제 점검
	if (! ffn_ChkNull(ds_Subinv.getColumn(ds_Subinv.rowposition,"CONSUM_YN")))
	{
		//주문통제(주문일자)
		var nRow;
		nRow = ds_OrdCtrl.findRowExpr("CTRL_TYPE=='주문'&&ITEM_TYPE==decode('" + ds_Subinv.getColumn(ds_Subinv.rowposition,"CONSUM_YN") + "','Y','소모품','식자재')");
		if (nRow >= 0)
		{
			if (ds_OrdCtrl.getColumn(nRow,ToUpper(gds_currdate.getColumn(0, "WEEK_ENG"))) == "Y")
			{
				g_Message("EE", gds_currdate.getColumn(0, "WEEK_KOR") + "요일은 주문불가 요일입니다.");
				return false;
			}
		}
		//주문통제(입고일자)
		nRow = ds_OrdCtrl.findRowExpr("CTRL_TYPE=='입고'&&ITEM_TYPE==decode('" + ds_Subinv.getColumn(ds_Subinv.rowposition,"CONSUM_YN") + "','Y','소모품','식자재')");
		if (nRow >= 0)
		{
			if (ds_OrdCtrl.getColumn(nRow,ToUpper(ffn_DayToWeek(me_NeedDate.value,"1"))) == "Y")
			{
				g_Message("EE", ffn_DayToWeek(me_NeedDate.value) + "요일은 입고불가 요일입니다." + "\n\n" + "입고예정일을 변경하세요.");
				return false;
			}
		}
	}
	//
	return true;
}
function fn_SetFav()
{
	/*-------------*/
	http.Sync = true;
	/*-------------*/
	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	// 파라미터셋팅
    outData		= "ds_Fav=ds_List";
    otherArg	= "UPJANG=" + wrapQuote(ed_Upjang.userdata);
	//action 정보 초기화 
	fsp_clear(this); 
    // 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "fm/fmz:FMZ_FAVORITE_GROUP_S001");
	// 서버 호출 
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);
	/*-------------*/
	http.Sync = false;
	/*-------------*/
	if (ds_Fav.rowcount > 0) tab_list.tab2.cbo_Fav.index = 0;
}
function fn_SetCtUpj()
{
	/*-------------*/
	http.Sync = true;
	/*-------------*/
	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	// 파라미터셋팅
    outData		= "ds_CtUpj=ds_List";
    otherArg	= "UPJANG=" + wrapQuote(ed_Upjang.userdata);
	//action 정보 초기화 
	fsp_clear(this); 
    // 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "fm/fmz:FMZ_GET_CTUPJ_S001");
	// 서버 호출 
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);
	/*-------------*/
	http.Sync = false;
	/*-------------*/
	if (ds_CtUpj.rowcount <= 0)
	{
		g_Message("EE","업장기초정보를 확인할 수 없습니다.!" + "\n\n" + "관리자에게 문의하세요.");
		//close();
	}
}
function fn_CopyRow(obj,nRow)
{
	if ( ds_List.findRowExpr("ITEM_CODE=="+wrapQuote(obj.getColumn(nRow,"ITEM_CODE"))) >= 0 )
	{
		if (! g_Confirm("01", '이미 주문등록한 상품입니다.\n\n추가주문 하시겠습니까?!')) return;
	}
	ds_List.addRow();
	ds_List.copyRow(ds_List.rowposition, obj, nRow);
	//기본적으로 신청수량은 기본 0으로 설정한다.
	ds_List.setColumn(ds_List.rowposition, "PR_QTY", 0);
	//obj.DeleteRow(nRow);
}
function fn_SetRowImg(nDdays,nDtimes,sWeekItemCode)
{
	//return decode(fn_GetDayStatus(nDdays,nDtimes),"0","img_RC","1","img_YC","2","img_GC","");
	//품목별 D-Day설정과 전체 D-Day설정을 비교하여 빠른것을 기준으로 한다.
	var nDdays1 = greatest(toNumber(nDdays), toNumber(ds_Days.getColumn(0,"D_DAYS")));
	var nDtimes1;
	if ( toNumber(nDdays) > toNumber(ds_Days.getColumn(0,"D_DAYS")) )
		nDtimes1 = nDtimes;
	else if ( toNumber(nDdays) == toNumber(ds_Days.getColumn(0,"D_DAYS")) )
		nDtimes1 = least(nDtimes,ds_Days.getColumn(0,"D_TIMES"));
	else if ( toNumber(nDdays) < toNumber(ds_Days.getColumn(0,"D_DAYS")) )
		nDtimes1 = ds_Days.getColumn(0,"D_TIMES");
		
	return decode(fn_GetDayStatus(nDdays1,nDtimes1,sWeekItemCode),"0","theme://convertImages\\img_RC.png","1","theme://convertImages\\img_YC.png","2","theme://convertImages\\img_GC.png","");
}
function fn_SetRowColor(nDdays,nDtimes,sWeekItemCode)
{
	return iif(fn_GetDayStatus(nDdays,nDtimes,sWeekItemCode)=="0","thistle","white");
}
function fn_GetDayStatus(nDdays,nDtimes,sWeekItemCode)
{
	//리조트 물류스케주울 체크
	if (! ffn_ChkNull(sWeekItemCode)) return "0";
	//무통제면 패스...
	if ( numFormat(nDdays)== "0" )	return "2";
	//디데이체크
	if ( gfn_addDate(gds_currdate.getColumn(0,"YMD"),nDdays)> me_NeedDate.value )
		return "0";
	else if ( gfn_addDate(gds_currdate.getColumn(0,"YMD"),nDdays)== me_NeedDate.value )
	{
		//디타임체크
		if ( gfn_subStr(gds_currdate.getColumn(0, "YMD_TM"),8,4)> nDtimes )
			return "0";
		else if ( G_fn_GapTime(0, gfn_subStr(gds_currdate.getColumn(0, "YMD_TM"),8,4), nDtimes, "") <= "0030" )
			return "1";
		else
			return "2";
	}
	else
		return "2";
}
//=========================================================================================
// [ PART 6 ]
// component Event 정의 ( User Define function )
// --> component Event의 기요,기능,동작 등 상세내용은 MiPlatform 메뉴얼을 참조하시기 바랍니다.
//=========================================================================================
function gd_list_OnHeadClick(obj:Grid, e:GridClickEventInfo)
{
	gfn_gridSort(obj, e); //(eval(obj.binddataset), obj, e.cell);
}
function cbo_Subinv_OnChanged(obj:Combo, e:ItemChangeEventInfo)
{
	if(gfn_dsIsUpdated(ds_List)==true)
	{
		if(g_Confirm("02","변경된 내역이 있습니다. 변경된 내역을 저장하시겠습니까?"))
		{
			fn_save(1);
		}
	}
	
	//데이타셑 위치변경
	eval(obj.innerdataset).rowposition = e.postindex;
	//초기화
	if (obj == cbo_Subinv)
	{
		me_Pdate.value = "";
		ed_Pcnt.value = "";
		ed_Pamt.value = "";
		ds_List.clearData();
		ds_List1.clearData();
		ds_List2.clearData();
		ds_List3.clearData();
		ds_List4.clearData();
		//최종 발주정보
		//fn_GetLastOrd();
		//디데이
		fn_GetDays();
		//자동조회
		fn_search();
	}
	else if (obj == tab_list.tab2.cbo_Fav)
	{
		ds_List2.clearData();
	}
	else if (obj == tab_list.tab4.cbo_SubinvP)
	{
		ds_List4.clearData();
	}
}
function me_NeedDate_OnChanged(obj:MaskEdit, e:TextChangedEventInfo)
{
	//변경되면 포커스를 잃고 글로벌 함수 실행(여기서 글자수를 체크하여 제대로 된 데이터 넘김)
	g_Date_OnKillFocus(obj);
	
	//변경된 사항이 있는지 확인
	if(gfn_dsIsUpdated(ds_List)==true)
	{
		g_Message("EE","변경된 내역이 있습니다. 저장해 주십시요");
		me_NeedDate.value = pre_need_date;	//변경전의 날짜를 되돌림
		return;
	}else{
		fn_search();
	}
}

function me_NeedDate_onkillfocus(obj:MaskEdit, e:KillFocusEventInfo)
{
	//변경되면 포커스를 잃고 글로벌 함수 실행(여기서 글자수를 체크하여 제대로 된 데이터 넘김)
	g_Date_OnKillFocus(obj);
	
	//변경된 사항이 있는지 확인
	if(gfn_dsIsUpdated(ds_List)==true)
	{
		g_Message("EE","변경된 내역이 있습니다. 저장해 주십시요");
		me_NeedDate.value = pre_need_date;	//변경전의 날짜를 되돌림
		return;
	}else{
		fn_search();
	}
}

function ds_List_CanColumnChange(obj:Dataset, e:DSColChangeEventInfo)
{
	//수량체크
	if (e.columnid == "PR_QTY")
	{
		//(-)발주여부
		if ( toNumber(e.newvalue) < 0 )
		{
			g_Message("EE","(-)발주는 불가합니다.");
			return false;
		}
		//발주마감체크
		fn_CurrDateWeek();
		if (fn_GetDayStatus(obj.getColumn(e.row,"D_DAYS"), obj.getColumn(e.row,"D_TIMES")) == "0")
		{
			g_Message("EE","해당 상품은 마감시간(D-Days)이 초과되어 수정이 불가합니다.");
			return false;
		}
		//수량통제 안하는 업장의 경우 이하 패스...
		//if (ds_Days.GetColumn(0,"QTY_CONTROL_YN") = "N") return;
		//
		//수량통제 안하는 업장의 경우 소숫점발주가 Y이면 무조건 최소발주량/발주승수량을 무조건 0.1로 세팅하여 조회
		if ( toNumber(e.newvalue) > 0 )
		{
			//최소발주량 체크
			if ( (toNumber(obj.getColumn(e.row,"MIN_ORD_QTY")) > 0) && (toNumber(obj.getColumn(e.row,"MIN_ORD_QTY")) > toNumber(e.newvalue)) )
			{
				g_Message("EE","해당 상품은 최소발주량이 " + obj.getColumn(e.row,"MIN_ORD_QTY") + "입니다.");
				return false;
			}
			//최대발주량 체크
			if ( (toNumber(obj.getColumn(e.row,"MAX_ORD_QTY")) > 0) && (toNumber(obj.getColumn(e.row,"MAX_ORD_QTY")) < toNumber(e.newvalue)) )
			{
				g_Message("EE","해당 상품은 최대발주량이 " + obj.getColumn(e.row,"MAX_ORD_QTY") + "입니다.");
				return false;
			}
			//소숫점발주여부
			if ( (obj.getColumn(e.row,"POINT_FLAG") != "Y") && (Math.ceil(toNumber(e.newvalue)) != toNumber(e.newvalue)) )
			{
				g_Message("EE","해당 상품은 소숫점발주가 불가합니다.");
				return false;
			}
			//발주승수량
			if ( (toNumber(obj.getColumn(e.row,"MULTIPLIER_QTY")) > 0) && ((Math.round(toNumber(e.newvalue) * 1000) % Math.round(toNumber(obj.getColumn(e.row,"MULTIPLIER_QTY")) * 1000)) <> 0) )
			{
				g_Message("EE","해당 상품은 발주승수량이 " + obj.getColumn(e.row,"MULTIPLIER_QTY") + "입니다.");
				return false;
			}
			
			//최근 3개월치 최대 발주량 보다 많으면 체크
			if ( 50 < toNumber(e.newvalue) )
			{
				//gfn_message("A","해당 상품은 최근 3개월 최대 발주량이 50입니다.");
				g_Message("EE","해당 상품은 최근 3개월 최대 발주량이 50입니다.");
				return true;
			}
		}
	}
	return true;
}
function ds_List_OnColumnChanged(obj:Dataset, e:DSColChangeEventInfo)
{
	//금액계산
	if (e.columnid == "PR_QTY")
	{
		var nAmt = Math.round(toNumber(obj.getColumn(e.row,"SALE_PRICE")) * toNumber(e.newvalue));
		obj.setColumn(e.row, "SALE_AMOUNT", nAmt);
		nAmt = Math.round(toNumber(obj.getColumn(e.row,"OP_PRICE")) * toNumber(e.newvalue));
		obj.setColumn(e.row, "OP_AMOUNT", nAmt);
	}
}
function FMP00080E_OnTimer(obj:Form, e:TimerEventInfo)
{
	if (e.timerid == 777) fn_SetTimer();
}
function fn_SetTimer()
{
	fn_CurrDateWeek();
		
	var sChkDate, sDay, sTime;
	if ( gfn_subStr(gds_currdate.getColumn(0, "YMD_TM"),8,4)>= gfn_trim(ds_Days.getColumn(0,"D_TIMES")) )
	{
		sChkDate = gfn_addDate(me_NeedDate.value, (-1 * (toNumber(gfn_trim(ds_Days.getColumn(0,"D_DAYS"))) + 1)));	
		sTime = G_fn_GapTime("1", gfn_subStr(gds_currdate.getColumn(0, "YMD_TM"),8,4), toNumber(gfn_trim(ds_Days.getColumn(0,"D_TIMES"))), "");	
	}
	else
	{
		sChkDate = gfn_addDate(me_NeedDate.value, (-1 * toNumber(gfn_trim(ds_Days.getColumn(0,"D_DAYS")))));
		sTime = G_fn_GapTime("0", gfn_subStr(gds_currdate.getColumn(0, "YMD_TM"),8,4), gfn_trim(ds_Days.getColumn(0,"D_TIMES")), "");
	}
	
	if (parseInt(gds_currdate.getColumn(0, "YMD")) <= parseInt(sChkDate))
		sDay = G_fn_CalcDay(gds_currdate.getColumn(0, "YMD"), sChkDate);		
	else
		sDay = G_fn_CalcDay(sChkDate, gds_currdate.getColumn(0, "YMD")) * (-1);		
		
	if ((toNumber(sDay) >= 0) && (toNumber(sDay) < 10)) sDay = "0" + sDay;	
	st_Timer.text = "마감시간 : " + sDay + "일 " + gfn_left(sTime,2)+ "시간 " + gfn_right(sTime,2)+ "분 전";
	
	st_Week.text = "(" + ffn_DayToWeek(me_NeedDate.value) + ")";
	if (st_Week.text == "(토)")
		st_Week.style.color = "blue";
	else if (st_Week.text == "(일)")
		st_Week.style.color = "red";
	else
		st_Week.style.color = "black";
		
	fa_sDay = sDay;	
	if (toNumber(sDay) < 0) fn_CLS_STATUS_Setting(); 		
}

function fn_CLS_STATUS_Setting()
{
    if (fa_sDay >= 0) return;
    
	for (i=0; i<ds_List.rowcount; i++)
	{
		if (ds_List.getColumn(i, "OTCUSTCD") != "0000")
		{
			ds_List.setColumn(i, "CLS_STATUS", "마감");
		}
	}	
}
function ed_Item_OnKeyDown(obj, e)
{
	if ( e.keycode == 13 ) fn_SearchItem();
}
function btn_search_OnClick(obj:Button, e:ClickEventInfo)
{
	fn_SearchItem();
}
function btn_search_OnKeyDown(obj:Button, e:KeyEventInfo)
{
	if ( e.keycode == 13 ) btn_search_OnClick(obj);
}
function gd_list_OnCellDblClick(obj:Grid, e)
{

	/*
	  주문시점의 업장, 창고, 입고일자를 저장한다.
	  왜냐하면 주문을 하고 발주내역에 등록이 된 뒤에
	  날짜를 변경하면 발주된된 데이터에 대해서 
	  변경을 하겠습니까? 라고 확인메세지를 주는데
	  여기서 아니오라고 해도 업장과 창고 입고일자는 
	  바뀌어 버리기 때문에(공통함수라서) 
	  아니오 일때는 주문시점의 데이터를 다시 불러와야함
	*/
	pre_need_date = me_NeedDate.value;
	

	if (obj == gd_list) return;
	if (eval(obj.binddataset).rowcount < 1) return;
	if (e.row < 0) return;
	//리조트 물류스케주울 체크
	if (! ffn_ChkNull(eval(obj.binddataset).getColumn(e.row,"WEEK_ITEM_CODE")))
	{
		g_Message("EE","해당 상품은 요일통제 상품입니다!");
		return;
	}
	//주문통제체크	
	if (!ffn_ChkNull(eval(obj.binddataset).getColumnInfo("LIMIT_ITEM"))) {	
		if (! ffn_ChkNull(eval(obj.binddataset).getColumn(e.row,"LIMIT_ITEM")))
		{
			g_Message("EE","해당 상품은 주문통제 상품입니다!" + "\n\n" + "통제내용:" + eval(obj.binddataset).getColumn(e.row,"LIMIT_REASON"));
			return;
		}
	}
	//발주마감체크
	if (fn_GetDayStatus(eval(obj.binddataset).getColumn(e.row,"D_DAYS"), eval(obj.binddataset).getColumn(e.row,"D_TIMES")) == "0")
	{
		//g_Message("EE","마감시간이 초과되어 주문이 불가합니다.");
		return;
	}
	//창고가 식재/소모품 통합창고인 경우 주문통제 점검
	if (ffn_ChkNull(ds_Subinv.getColumn(ds_Subinv.rowposition,"CONSUM_YN")))
	{
		//주문통제(주문일자)
		var jRow;
		jRow = ds_OrdCtrl.findRowExpr("CTRL_TYPE=='주문'&&ITEM_TYPE==iif('" + eval(obj.binddataset).getColumn(e.row,"CONSUM_YN") + "','Y','소모품','식자재')");
		if (jRow >= 0)
		{
			if (ds_OrdCtrl.getColumn(jRow,ToUpper(gds_currdate.getColumn(0, "WEEK_ENG"))) == "Y")
			{
				g_Message("EE", gds_currdate.getColumn(0, "WEEK_KOR") + "요일은 " + ds_OrdCtrl.getColumn(jRow,"ITEM_TYPE") + " 주문불가 요일입니다.");
				return;
			}
		}
		//주문통제(입고일자)
		jRow = ds_OrdCtrl.findRowExpr("CTRL_TYPE=='입고'&&ITEM_TYPE==iif('" + eval(obj.binddataset).getColumn(e.row,"CONSUM_YN") + "','Y','소모품','식자재')");
		if (jRow >= 0)
		{
			if (ds_OrdCtrl.getColumn(jRow,ToUpper(ffn_DayToWeek(me_NeedDate.value,"1"))) == "Y")
			{
				g_Message("EE", ffn_DayToWeek(me_NeedDate.value) + "요일은 " + ds_OrdCtrl.getColumn(jRow,"ITEM_TYPE") + " 입고불가 요일입니다." + "\n\n" + "입고예정일을 변경하세요.");
				return;
			}
		}
	}
	//라인복사
	fn_CopyRow(eval(obj.binddataset), e.row);
	
	//obj.SetFocus();
	gd_list.setFocus();
	gd_list.setCellPos(6);
}

function tab_list_tab1_gd_list_OnEnterDown(obj,nRow,nCell,strVal,nPivotIndex)
{
	//2007버젼의 CyGridU.dll에 있는 오류를 수정하기 위해 온 엔터 다운코드를 제거함.
	//오류내용 : 1번째 그리드를 선택하고 엔터를 누르면 2번째 레코드 nRow가 넘어가는 현상
	//때문에 keyDown 함수에 구현함.
}


var fa_Chk;
function btn_CallPop_OnClick(obj:Button, e:ClickEventInfo)
{
/*
	if (object(obj.UserData).rowcount < 1) return;
	if (object(obj.UserData).row < 0) return;
	if (! g_Confirm("02","해당 상품을 " + obj.Text + "하시겠습니까?!")) return;
	
	//필수항목 
	if (fn_ChkManNull()) return;
	//
	var strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc;
	// 경로 설정
	strSvcID = "FMP00080E_T002";
	strURL   = "S_FMP::FMP00080E_T002.jsp";
	// 데이터셋 설정U
	strInDatasets  = "";
	strOutDatasets = "";
	// 파라메터 설정
	strArgument  = "g_Upjang=" + quote(g_Upjang);
	strArgument += " g_EmpNo=" + quote(g_EmpNo);
	strArgument += " sUpjang=" + quote(ed_Upjang.UserData);
	strArgument += " sFavGroup=" + quote(tab_list.tab2.cbo_Fav.Value);
	strArgument += " sItemCode=" + quote(object(obj.UserData).GetColumn(object(obj.UserData).row,"ITEM_CODE"));
	if (obj.UserData == "ds_List2")
		strArgument += " sGB='0'";
	else
		strArgument += " sGB='1'";
	
	// 콜백함수 지정
	strCallbackFunc = "";
	// 서버 호출 
	http.Sync = true;
	Transaction(strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc);
	http.Sync = false;
	//결과
	if (! ffn_ChkNull(fa_Chk)) g_Message("EE",fa_Chk);
*/
	//해당 작업화면 링크
	if (obj.userdata == "ds_List2")
		gfn_openMenuForm("FMP00860E.xfdl","U_FMP","","즐겨찾기 상품등록");
	else if (obj.userdata == "ds_List3")
		gfn_openMenuForm("FMP00890E.xfdl","U_FMP","","주간발주 상품등록");
	else if (obj.userdata == "ds_List4")	//지난발주 복사일 경우
	{
		for (i=0; i<eval(obj.userdata).rowcount; i++)	//선택된 상품에 대해 추가 작업을 함.
		{
			if (eval(obj.userdata).getSelect(i))
			{
				var e = new EventInfo();
				e.row = i;
				gd_list_OnCellDblClick(tab_list.tab4.gd_list,e);
			}
		}
	}
}
function tab_list_OnChanged(obj:Tab, e:TabIndexChangeEventInfo)
{
	eval("tab_list.tab" + gfn_toString(e.postindex + 1)).ed_Item.setFocus();
	
	if(e.postindex == '1')
	{
		//즐겨찾기그룹
		fn_SetFav();
	};
}
function gd_list_OnCellClick(obj:Grid, e:GridClickEventInfo)
{
	
	if(tab_list.tabindex=='0') //상품추가 탭에서
	{
		//즐겨찾기 추가 버튼을 누를 때
		if(e.cell == 13)
		{
			//alert(obj +"|"+ nRow +"|"+ nCell +"|"+ nX +"|"+ nY +"|"+ nPivotIndex);
			var strParam = {};
			strParam["fa_ItemCode"] = eval(obj.binddataset).getColumn(e.row, "ITEM_CODE");
			strParam["fa_ItemName"] = eval(obj.binddataset).getColumn(e.row, "ITEM_NAME");
			strParam["fa_Upjang"] = ed_Upjang.userdata;
			
			
			gfn_dialog("", "U_FMP::FMP00080P.xfdl", strParam);
		}
	}else if(tab_list.tabindex=='1') //즐겨찾기 탭에서
	{
		//즐겨찾기 삭제 버튼을 누를 때
		if(e.cell == 13)
		{
			//삭제확인
			if (! g_Confirm("01", '선택하신 주문상품을 삭제하시겠습니까?!')) return;
			fn_deleteFav(e.row);
		}
	}
	
	//2010/03/22 수량 입력 클릭 시 공백 처리 == by Noh Kyu Wan ==
	if (e.cell == 6)
	{
	    if (ds_List.getColumn(e.row,"PR_QTY") <> 0)
	    {}
	    else	    
		ds_List.setColumn(e.row,"PR_QTY","");		
     }			
	
	if (eval(obj.binddataset).rowcount < 1) return;
	if (e.row < 0) return;
	if (e.cell <> 1) return;
	
	//상품이미지
/*
	if (object(obj.BindDataset).GetColumn(nRow, "OTCUSTCD") = "0000")
		gfn_dialog("", "U_SCC::SCC91000P.xml","fa_Image="+quote(gfmsImgPathH + object(obj.BindDataset).GetColumn(nRow, "IMAGE_PATH")));
	else
		gfn_dialog("", "U_SCC::SCC91000P.xml","fa_Image="+quote(gfmsImgPathO + object(obj.BindDataset).GetColumn(nRow, "IMAGE_PATH")));
*/
	var strParam = {};
	strParam["fa_CenterCode"] = gfn_trim(eval(obj.binddataset).getColumn(e.row, "CENTER_CODE"));
	strParam["fa_Custcd"] = gfn_trim(eval(obj.binddataset).getColumn(e.row, "CUSTCD"));
	strParam["fa_ItemCode"] = gfn_trim(eval(obj.binddataset).getColumn(e.row, "ITEM_CODE"));
	if (gfn_length(eval(obj.binddataset).getColumn(e.row, "IMAGE_PATH"))<= 0)
		strParam["fa_Image"] = '';
	else
	{
		if (eval(obj.binddataset).getColumn(e.row, "OTCUSTCD") == "0000")
		{
			strParam["fa_Image"] = gfn_trim(gfmsImgPathH + eval(obj.binddataset).getColumn(e.row, "IMAGE_PATH"));
		}
		else
		{
			//기존에 쓰던 서버가 바뀌어서 강제로 변경함.
			var ImgPath = "http://203.233.82.50/hwfs/upload/fm/item/";
			strParam["fa_Image"] = gfn_trim(ImgPath + eval(obj.binddataset).getColumn(e.row, "IMAGE_PATH"));
			//trace("pppppp : " + strParam);
		}
	}
	strParam["fa_ItemPrice"] = eval(obj.binddataset).getColumn(e.row, "OP_PRICE");
	gfn_dialog("", "U_FMP::FMP00010P.xfdl", strParam);
}
function FMP00080E_OnActivate(obj:Form, e:ActivateEventInfo)
{
	//화면 액트브시 타이머 재설정
	fn_SetTimer();
	setTimer(777,30000); //일단 30초 세팅
}
function FMP00080E_OnDeactivate(obj:Form, e:ActivateEventInfo)
{
	//타이머 종료...(타이머 발생으로 쿼리 수행하여 결과값 가져오면 화면이 앞으로 올라온다.
	killTimer(777);
}
// 2008.12.11 추가 (조회 분류 OnChanged 추가) by Noh Kyu Wan
function cbo_Class2_OnChanged(obj:Combo, e:ItemChangeEventInfo)
{
	if (obj == tab_list.tab1.cbo_Class2)
	{
		// 중분류 데이터셋 필터
		ds_Class3.filter("gfn_left(CLASS_CODE,4)=="+wrapQuote(gfn_left(e.postvalue,4))+"||CLASS_CODE==''");
		tab_list.tab1.cbo_Class3.index = 0;
		// 소분류 데이터셋 필터
		ds_Class4.filter("gfn_left(CLASS_CODE,4)=="+wrapQuote(gfn_left(e.postvalue,4))+"||CLASS_CODE==''");
		tab_list.tab1.cbo_Class4.index = 0;
	}
	else if (obj == tab_list.tab1.cbo_Class3)
	{
		ds_Class4.filter("gfn_left(CLASS_CODE,6)=="+wrapQuote(gfn_left(e.postvalue,6))+"||CLASS_CODE==''");
		tab_list.tab1.cbo_Class4.index=0;
	}	
}
function cbo_Class2_OnKeyDown(obj:Combo, e:KeyEventInfo)
{
	ffn_SetComboNull(obj, e.keycode);	
}
function gd_list_OnEnterDown(obj:Grid, e:GridEditEventInfo)
{	
	//********************************************************************************************
	// 기능 추가 : CSR Number <26200> 
	// 변 경 자  : 노규완
	// 수정 일자 : 2009-04-10 
	// 수정 내역 : 기존 상품 조회 추가 시 마우스 포커스 이동이 수량 -> 비고.
	//             그리드에 등록 된 마지막 Row의 비고란에서 Enter값이 들어 오면 
	//             마우스 포커스가 상품검색란으로 이동 시켜 준다.
	//********************************************************************************************	
	if ( obj == gd_list );	
	{
		if ( (ds_List.getCountNF() == ds_List.rowposition + 1) && (gd_list.getCellPos() == 10) )	
		{
		  if (tab_list.tabindex == 0)  tab_list.tab1.ed_Item.setFocus();
		  if (tab_list.tabindex == 1)  tab_list.tab2.ed_Item.setFocus();
		  if (tab_list.tabindex == 2)  tab_list.tab3.ed_Item.setFocus();
		  if (tab_list.tabindex == 3)  tab_list.tab4.ed_Item.setFocus();
		}	
	}	
}
function gd_list_OnCellPosChanged(obj:Grid, e:GridSelectEventInfo)
{
	//2010/03/22 수량 입력 클릭 시 공백 처리 == by Noh Kyu Wan ==
	if (e.cell == 6)
	{
	    if (ds_List.getColumn(e.row,"PR_QTY") <> 0)
	    {}
	    else	    
		ds_List.setColumn(e.row,"PR_QTY","");		
     }	
}
//************************************************************************************************
// Excel 상품 일괄 발주 기능 추가  2010/06/25 by 노규완
//************************************************************************************************
function fn_Excel_Import(obj:Button, e:ClickEventInfo)
{	
	//필수항목 
	if (fn_ChkManNull()) return;
	//발주가능 체크
	if (! fn_OrdChk())
	{
		me_NeedDate.setFocus();
		return;
	}	
	
	if (ed_Upjang.userdata == ""){
		g_Message("EE","사업장 코드를 반드시 입력 하시기 바랍니다.");
		return;
	}
	if (cbo_Subinv.value == ""){
		g_Message("EE","창고 코드를 반드시 입력 하시기 바랍니다.");
		return;
	}	
	
	//엑셀 임포트
	fd_Excel.Type = "OPEN";
	fd_Excel.Filter = "All(*.*)|*.*|Excel File(*.xls)|*.xls|";
	
	if( fd_Excel.Open() )
	{		
		var nX = parseInt(this.position.width/2) - parseInt(dv_Prg.position.width/2);		
		var nY = parseInt(this.position.height/2) - parseInt(dv_Prg.position.height/2);		
		dv_Prg.move(nX, nY);
	
		dv_Prg.visible = true;
		var sFullFileName = fd_Excel.FilePath + '\\' + fd_Excel.FileName;
		gd_list.enableredraw = false;
		ds_Excel.clearData();
		//ext_ExcelImportByIndex(파일풀패스, 시트순번, 깡통데이타셑);
		ext_ExcelImportByIndex(sFullFileName, 0, "ds_Excel");
		
		
		
		fn_SetImpData();
		gd_list.enableredraw = true;
	}	
}
function fn_SetImpData()
{
	var sErrMsg = "";
	var sErrCode = "";
	
	ds_List.clearData();
	ds_ErrLst.clearData();
	
	//SetWaitCursor(true);
	//trace(ds_Excel.saveXML());
	
	
	for (var i = 1; i < ds_Excel.rowcount; i++)
	{	
        //**********************************************************************************
        // 기본적인 엑셀 데이터 중 미등록 항목 체크 [Start]
        //**********************************************************************************
		if (gfn_length(gfn_trim(ds_Excel.getColumn(i,"Col01")))== 0)  //상품코드 체크
		{
			ds_ErrLst.addRow();
			ds_ErrLst.setColumn(ds_ErrLst.rowposition, "errmsg", i + "행)상품코드 미등록");
			continue;
		}
		if (gfn_length(gfn_trim(ds_Excel.getColumn(i,"Col02")))== 0)  //상품명 체크
		{
			ds_ErrLst.addRow();
			ds_ErrLst.setColumn(ds_ErrLst.rowposition, "errmsg", i + "행)상품명 미등록");
			continue;
		}		
		if (gfn_length(gfn_trim(ds_Excel.getColumn(i,"Col03")))== 0)  //규격 체크
		{
			ds_ErrLst.addRow();
			ds_ErrLst.setColumn(ds_ErrLst.rowposition, "errmsg", i + "행)규격 미등록");
			continue;
		}												
		if (gfn_length(gfn_trim(ds_Excel.getColumn(i,"Col04")))== 0)  //단위 체크
		{
			ds_ErrLst.addRow();
			ds_ErrLst.setColumn(ds_ErrLst.rowposition, "errmsg", i + "행)단위 미등록");
			continue;
		}
		if (gfn_length(gfn_trim(ds_Excel.getColumn(i,"Col05")))== 0)  //수량 체크
		{
			ds_ErrLst.addRow();
			ds_ErrLst.setColumn(ds_ErrLst.rowposition, "errmsg", i + "행)수량 미등록");
			continue;
		}
        //**********************************************************************************
        // 기본적인 엑셀 데이터 중 미등록 항목 체크 [End]
        //**********************************************************************************		
		
		ds_Cond.clearData();
		eval("ds_List" + gfn_toString(tab_list.tabindex+1)).clearData();
		ds_Cond.addRow();
		ds_Cond.setColumn(0, "UPJANG",        ed_Upjang.userdata);
		ds_Cond.setColumn(0, "SUBINV_CODE",   cbo_Subinv.value);
		ds_Cond.setColumn(0, "NEED_DATE",     me_NeedDate.value);
		ds_Cond.setColumn(0, "CONSUM_YN",     ds_Subinv.getColumn(ds_Subinv.rowposition,"CONSUM_YN"));
		ds_Cond.setColumn(0, "QTY_CONTROL_YN",ds_Days.getColumn(0,"QTY_CONTROL_YN"));
		ds_Cond.setColumn(0, "CENTER_CODE",   			ds_CtUpj.getColumn(0,"CENTER_CODE"));
		ds_Cond.setColumn(0, "AP_UNITPRICE_UPJANG",     ds_CtUpj.getColumn(0,"AP_UNITPRICE_UPJANG"));
		ds_Cond.setColumn(0, "OTCUST_PRICE_UPJANG",     ds_CtUpj.getColumn(0,"OTCUST_PRICE_UPJANG"));
		ds_Cond.setColumn(0, "ITEM_CODE",ds_Excel.getColumn(i,"Col01"));
		
		if (tab_list.tabindex == 1)
			ds_Cond.setColumn(0, "FAVOR_GROUP",   tab_list.tab2.cbo_Fav.value);
			
		else if (tab_list.tabindex == 0) // 2008.12.11 추가(분류별 상품 조회 기능)
		{
			ds_Cond.setColumn(0, "ITEM_CLASS2", tab_list.tab1.cbo_Class2.value);    //대분류
			ds_Cond.setColumn(0, "ITEM_CLASS3", tab_list.tab1.cbo_Class3.value);	//중분류
			ds_Cond.setColumn(0, "ITEM_CLASS4", tab_list.tab1.cbo_Class4.value);	//소분류
		}
		http.Sync = true;
		// 조회
		var strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc;
		// 경로 설정
		strSvcID = "FMP00080E_T001";
		strURL   = "U_svc::" + "fm/fmp/FMP00080E_T001.jsp";
		// 데이터셋 설정
		strInDatasets  = "ds_Cond=ds_Cond";
		strOutDatasets = "ds_List" + gfn_toString(tab_list.tabindex+1)+ "=ds_List";
		// 파라메터 설정
		strArgument  = "g_Upjang=" + wrapQuote(g_Upjang);
		strArgument += " g_EmpNo=" + wrapQuote(g_EmpNo);
		strArgument += " strIndex=" + wrapQuote(gfn_toString(tab_list.tabindex+1));
		if (eval("tab_list.tab" + gfn_toString(tab_list.tabindex+1)).chk_Only.value)
			strArgument += " strOnly='TRUE'";
		else
			strArgument += " strOnly='FALSE'";
		strArgument += " sType=" + wrapQuote(cbo_Type.value);
		// 콜백함수 지정
		strCallbackFunc = "";
		// 서버 호출 
		//Transaction(strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc);
		jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, false, false, true);	
		http.Sync = false;
		
		
		//*****************************************************************
		// 조회 한 상품 별로 발주 리스트로 복사 하기 전 체크               
		//*****************************************************************
		if (ds_List1.rowcount < 1) return;
		
		//리조트 물류스케주울 체크
		if (! ffn_ChkNull(ds_List1.getColumn(ds_List1.rowposition,"WEEK_ITEM_CODE")))
		{
			g_Message("EE","해당 상품은 요일통제 상품입니다!");
			return;
		}
		//주문통제체크
		if (!ffn_ChkNull(ds_List1.getColumnInfo("LIMIT_ITEM"))) {
			if (! ffn_ChkNull(ds_List1.getColumn(ds_List1.rowposition,"LIMIT_ITEM")))
			{
				g_Message("EE","해당 상품은 주문통제 상품입니다!" + "\n\n" + "통제내용:" + ds_List1.getColumn(ds_List1.rowposition,"LIMIT_REASON"));
				return;
			}
		}
		//발주마감체크
		if (fn_GetDayStatus(ds_List1.getColumn(ds_List1.rowposition,"D_DAYS"), ds_List1.getColumn(ds_List1.rowposition,"D_TIMES")) == "0")
		{
			//g_Message("EE","마감시간이 초과되어 주문이 불가합니다.");
			return;
		}
		//창고가 식재/소모품 통합창고인 경우 주문통제 점검
		if (ffn_ChkNull(ds_Subinv.getColumn(ds_Subinv.rowposition,"CONSUM_YN")))
		{
			//주문통제(주문일자)
			var jRow;
			jRow = ds_OrdCtrl.findRowExpr("CTRL_TYPE=='주문'&&ITEM_TYPE==iif('" + ds_List1.getColumn(ds_List1.rowposition,"CONSUM_YN") + "','Y','소모품','식자재')");
			if (jRow >= 0)
			{
				if (ds_OrdCtrl.getColumn(jRow,ToUpper(gds_currdate.getColumn(0, "WEEK_ENG"))) == "Y")
				{
					g_Message("EE", gds_currdate.getColumn(0, "WEEK_KOR") + "요일은 " + ds_OrdCtrl.getColumn(jRow,"ITEM_TYPE") + " 주문불가 요일입니다.");
					return;
				}
			}
			//주문통제(입고일자)
			jRow = ds_OrdCtrl.findRowExpr("CTRL_TYPE=='입고'&&ITEM_TYPE==iif('" + eval(obj.Binddataset).getColumn(nRow,"CONSUM_YN") + "','Y','소모품','식자재')");
			if (jRow >= 0)
			{
				if (ds_OrdCtrl.getColumn(jRow,ToUpper(ffn_DayToWeek(me_NeedDate.value,"1"))) == "Y")
				{
					g_Message("EE", ffn_DayToWeek(me_NeedDate.value) + "요일은 " + ds_OrdCtrl.getColumn(jRow,"ITEM_TYPE") + " 입고불가 요일입니다." + "\n\n" + "입고예정일을 변경하세요.");
					return;
				}
			}
		}	
	
		
		if ( ds_List.findRow("ITEM_CODE", ds_Excel.getColumn(i,"Col01")) )  //상품코드 체크
		{
			ds_ErrLst.addRow();
			ds_ErrLst.setColumn(ds_ErrLst.rowposition, "errmsg", i + "행)상품코드 기등록");
			continue;
		}
		else
		{
			ds_List.addRow();
			ds_List.copyRow(ds_List.rowposition,ds_List1,ds_List1.rowposition);
			ds_List.setColumn(ds_List.rowposition, "PR_QTY", ds_Excel.getColumn(i,"Col05"));              //수량
			if (gfn_length(gfn_trim(ds_List1.getColumn(ds_List1.rowposition,"ITEM_CODE")))== 0)  //조회 한 상품 코드가 있는지 체크
			{
				ds_ErrLst.addRow();
				ds_ErrLst.setColumn(ds_ErrLst.rowposition, "errmsg", i + "행)창고,발주예정일 체크:조회한 상품이 없습니다.");
				ds_List.deleteRow();
				continue; 
			}
		}

   }
	
	ds_List1.clearData();
	
	SetWaitCursor(false);
	dv_Prg.visible = false;
	
	
	if (ds_ErrLst.rowcount < ds_Excel.rowcount)
	{		
		if (ds_ErrLst.rowcount > 0)
		{
			sErrMsg += '\n오류 데이타가 존재합니다.\n확인하시겠습니까?!';
			
			div_Error.move(0, Static2.position.top - 12);
			
			ds_ErrLst.rowposition = 0;
			div_Error.visible = (g_Confirm("04", sErrMsg));
			if (div_Error.visible) div_Error.grd_ErrLst.setFocus();
			ds_List.clearData();
		}
		else
			g_Message("02", "정상적으로 업로드 되었습니다.");
	}		
	
}
function div_Error_btn_Hidden_OnClick(obj:Button, e:ClickEventInfo)
{
	div_Error.visible = false;
}
//*************************************************************
// 2010-08-05  보조금 관련 추가 ( 사업장 보조금 관리 유무조회)
//*************************************************************
function fn_Green_Upjang()
{
	/*-------------*/
	http.Sync = true;
	/*-------------*/
	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	// 파라미터셋팅
    outData		= "ds_Green=ds_Green";
    otherArg	= "UPJANG=" + wrapQuote(ed_Upjang.userdata);	
	//action 정보 초기화 
	fsp_clear(this); 
    // 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "sc/scc:SCC_GREEN_USER");
	// 서버 호출 
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);
	/*-------------*/
	http.Sync = false;
	/*-------------*/	
	
	//*********************************************************************
	//	me_Pdate   Width : 160  --> 80
	//	Static28  : Width : 95  , Left : 268     --> Left : 190
	//	ed_Pcnt : Width 110 , Left : 365  -->   Width 90  , Left :  287
	//	ed_Pamt : Width : 224 , Left : 477   -> Width : 130 , Left : 378	
	//*********************************************************************
	if (ds_Green.getColumn(0,"USE_YN") == 'Y')
	{
		me_Pdate.position.width = 80;                      //최종발주일자 edit 사이즈 변경
		Static28.position.left = 190;                       //최종발주정보 Static 위치 변경
		ed_Pcnt.position.width = 90;  ed_Pcnt.position.left = 287;   //최종발주 카운터 사이즈 및 위치 변경
		ed_Pamt.position.width = 130; ed_Pamt.position.left = 378;   //최종발주 금액 사이즈 및 위치 변경
		Sta_Green.visible = true;                  //보조금 잔액 Static 화면 보이기
		ed_Green.visible = true;				   //보조금 잔액 금액 표시 화면 보이기.
	}
}
//*************************************************************
// 2010-08-05  보조금 관련 추가 ( 사업장 보조금 잔액 조회)
//*************************************************************
function fn_Green_Amt()
{
	/*-------------*/
	http.Sync = true;
	/*-------------*/
	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	// 파라미터셋팅
    outData		= "ds_Green=ds_Green";
    otherArg	= "UPJANG=" + wrapQuote(ed_Upjang.userdata);
	otherArg	+=" NEED_DATE="+ wrapQuote(gfn_trim(me_NeedDate.value));        	
	//action 정보 초기화 
	fsp_clear(this); 
    // 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "sc/scc:SCC_GREEN_AMT");
	// 서버 호출 
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);
	/*-------------*/
	http.Sync = false;
	/*-------------*/	
	ed_Green.value = numFormat(ds_Green.getColumn(0,"BALANCE_AMT"))+ " 원";	
}
//*****************************************************************************
// 2010-08-05  보조금 관련 추가 (로그인 사업장 보조금 재 생성 프로시져 호출)
//*****************************************************************************
function  fn_Create_Green_Amt()
{
	var t_timeout;
	// action 정보 초기화
	fsp_clear(this);	

	// 데이타체크
	ds_Green_Proc.clearData();	
	ds_Green_Proc.addRow();				

	ds_Green_Proc.setColumn(0,"UPJANG",ed_Upjang.userdata);				
	ds_Green_Proc.setColumn(0,"NEED_DATE",me_NeedDate.value);
	ds_Green_Proc.setColumn(0,"CUSER", g_EmpNo);		
	http.Sync = true;			

	t_timeout = application.httptimeout;
	application.httptimeout=2000; //1800초 

	//setCapture();

	fsp_addSingle(this, "sc/scc:SCC_GREEN_PROC");
	fsp_callService(this, "", "", "ds_Green_Proc=ds_Green_Proc:A", "",  "", "");

	application.httptimeout=t_timeout; //60초

	http.Sync = false;
}

function btn_RcpConf_OnClick(obj:Button, e:ClickEventInfo)
{
	dv_RcpConf.visible = (! dv_RcpConf.visible);
}

function dv_RcpConf_me_RcpDateT_onkillfocus(obj:MaskEdit, e:KillFocusEventInfo)
{
	dv_RcpConf.me_RcpDateF.value = gfn_addDate(obj.value,-1);
}

function dv_MultiUpj_btn_Hidden_OnClick(obj:Button, e:ClickEventInfo)
{
	if (ffn_ChkNull(ed_Upjang.userdata))
	{
		g_Message("EE", "사업장을 선택하세요!");
		return;
	}
	if (ffn_ChkNull(dv_RcpConf.me_RcpDateF.value))
	{
		g_Message("EE", "입금확인일자를 지정하세요!");
		return;
	}
	if (ffn_ChkNull(dv_RcpConf.me_RcpDateT.value))
	{
		g_Message("EE", "입금확인일자를 지정하세요!");
		return;
	}
	//ds임시생성
	var dsObjin;
	create("Dataset", "ds_Dummyin");
	dsObjin = eval("ds_Dummyin");
	dsObjin.addColumn("RCP_DATEF", "STRING", 8);
	dsObjin.addColumn("RCP_DATET", "STRING", 8);
	dsObjin.addColumn("UPJANG", "STRING", 6);
	// 초기화
	ds_Dummyin.clearData();
	ds_Dummyin.addRow();
	ds_Dummyin.setColumn(0, "RCP_DATEF",  dv_RcpConf.me_RcpDateF.value);
	ds_Dummyin.setColumn(0, "RCP_DATET",  dv_RcpConf.me_RcpDateT.value);
	ds_Dummyin.setColumn(0, "UPJANG",    ed_Upjang.userdata);
	// 트랜잭션 호출
	var strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc;
	// 경로 설정
	strSvcID = "FMZ_CREDIT_INFO_T002";
	strURL   = "U_svc::" + "fm/fmz/FMZ_CREDIT_INFO_T002.jsp";
	// 데이터셋 설정
	strInDatasets  = "ds_Cond=ds_Dummyin";
	jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, false, false, true);
ta_Sql.value = fa_Sql;
	//ds임시생성 해제
	Destroy("ds_Dummyin");
	//여신정보
	fn_GetCredit(false);
	dv_RcpConf.visible = false;
	g_Message("01","실시간 입금확인이 완료되었습니다.");
}

function fn_searchItemUpMemory()
{
	var strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc;
	
	strSvcID = "FMP00080E_T003";
	strURL   = "U_svc::" + "fm/fmp/FMP00080E_T003.jsp";

	jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, false, false, false);
}


function tab_list_tab1_gd_list_OnKeyDown(obj:Grid, e:KeyEventInfo)
{
	var nRow = ds_List1.rowposition;
	var nCell = '0';
	var nPivotIndex = '-1';
	
	//엔터키일때 입력
	if(e.keycode == '13')
	{
		var e = new EventInfo();
		e.row = this[obj.binddataset].rowposition;
	
		gd_list_OnCellDblClick(obj,e);
	}
}

function tab_list_tab2_gd_list_OnKeyDown(obj:Grid, e:KeyEventInfo)
{
	var nRow = ds_List2.rowposition;
	var nCell = '0';
	var nPivotIndex = '-1';
	
	//엔터키일때 입력
	if(e.keycode == '13')
	{
		var e = new EventInfo();
		e.row = this[obj.binddataset].rowposition;
		gd_list_OnCellDblClick(obj,e);
	}
}

function tab_list_tab3_gd_list_OnKeyDown(obj:Grid, e:KeyEventInfo)
{
	var nRow = ds_List3.rowposition;
	var nCell = '0';
	var nPivotIndex = '-1';
	
	//엔터키일때 입력
	if(e.keycode == '13')
	{
		var e = new EventInfo();
		e.row = this[obj.binddataset].rowposition;
	
		gd_list_OnCellDblClick(obj,e);
	}
}

//즐겨찾기 삭제 함수
function fn_deleteFav(nRow)
{
	var fa_Upjang		= ed_Upjang.userdata;
	var favorGroupCode	= ds_Fav.getColumn(ds_Fav.rowposition,"FAVOR_GROUP");
	var itemCode 		= ds_List2.getColumn(nRow,"ITEM_CODE");
	
	//trace(upjang +"/"+ group +"/"+ itemCode);
	
	ds_List2.deleteRow(nRow);
	
	ds_Cond.clearData();
	ds_Cond.addRow();
	ds_Cond.setColumn(0,"UPJANG",fa_Upjang);
	ds_Cond.setColumn(0,"FAVOR_GROUP",favorGroupCode);
	ds_Cond.setColumn(0,"ITEM_CODE",itemCode);
		
	//Transaction 설정
	var formObj			= this;
	var strSvcID		= "FMP00080P_T003";
	var strURL			= "U_svc::" + "fm/fmp/FMP00080P_T004.jsp";
	var strInDatasets	= "ds_Cond=ds_Cond:A";
	var strOutDatasets	= "";
	var strArgument = "";	//= "name1=park name2=yongdae";
	//var strCallbackFunc	= "fn_Add_callback"; //없는함수임.
	var strCallbackFunc	= "";
	var isErrorNotCall	= false;
	var isNotShow		= false;	//false 메세지 보여줌 --> sync일때 표현 안됨.
	var isSync			= true;		//true 다실행하고 실행됨.(async)

	//서버호출
	jsp_transaction(formObj, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, isErrorNotCall, isNotShow, isSync);
	
}

//최근 3개월치 최대 발주량보다 많으면 색 표시
function fn_checkMaxOrdQty(nPrQty)
{
	if ( 50 < toNumber(nPrQty) )
	{
		return "red";
	}
}



]]></Script>
  </Form>
</FDL>
