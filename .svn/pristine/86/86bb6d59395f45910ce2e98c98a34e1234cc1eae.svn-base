<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="..\..\..\default_typedef.xml"/>
  <Form id="FSC00031P" onkeydown="frm_OnKeyDown" onload="form_onload" titletext="개선사항 사진정보" position="absolute 0 0 647 505" scrollbars="none">
    <Layouts>
      <Layout>
        <Static id="st_note" text="점검결과 사진별로 개선사진을 첨부해 주세요." position="absolute 7 476 360 491" class="sta_WF_DiscInfo"/>
        <Button id="btn_close" onclick="fn_Close" taborder="2" text="닫기" position="absolute 587 10 632 35" class="btn_WF_CRUD" image=""/>
        <Div id="div_photo" scrollbars="autoboth" taborder="3" position="absolute 15 40 632 469">
          <Layouts>
            <Layout/>
          </Layouts>
        </Div>
        <MPFileDialog id="saveDialog" taborder="3" Type="SAVE" position="absolute 648 64 672 88"/>
        <MPFileDialog Filter="All image files|*.bmp; *.jpg; *.jpeg; *.jpe; *.jfif; *.gif|Bitmap (.BMP)|*.bmp|JPEG (*.JPG;*.JPEG;*.JPE;*.JFIF)|*.jpg; *.jpeg; *.jpe; *.jfif|GIF (.GIF)|*.gif|" id="fileDialog" taborder="3" position="absolute 648 96 672 120"/>
        <Static id="Static01" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 0 15 341"/>
        <Static id="Static15" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 15 0 531 10"/>
        <Static id="Static00" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 15 491 531 506"/>
        <Static id="Static02" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 632 0 647 341"/>
        <MPFile id="httpFile" taborder="4" visible="false" position="absolute 648 131 672 155" FileName="" UserData=""/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_list">
        <ColumnInfo>
          <Column id="CHECK_DATE" size="8" type="STRING"/>
          <Column id="CHK" size="1" type="STRING"/>
          <Column id="CLASS_CD" size="8" type="STRING"/>
          <Column id="FORM_CD" size="20" type="STRING"/>
          <Column id="IN_PHOTO" size="200" type="STRING"/>
          <Column id="PHOTO_TYPE" size="1" type="STRING"/>
          <Column id="SEQ" size="22" type="BIGDECIMAL"/>
          <Column id="SPHOTO" size="200" type="STRING"/>
          <Column id="TABLE_TYPE" size="20" type="STRING"/>
          <Column id="UPJANG" size="20" type="BIGDECIMAL"/>
          <Column id="IM_PHOTO" size="200" type="STRING"/>
          <Column id="IM_SPHOTO" size="200" type="STRING"/>
          <Column id="IM_SEQ" size="200" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_input">
        <ColumnInfo>
          <Column id="TABLE_TYPE" size="256" type="STRING"/>
          <Column id="FORM_CD" size="256" type="STRING"/>
          <Column id="MST_UPJANG" size="20" type="BIGDECIMAL"/>
          <Column id="CHECK_DATE" size="256" type="STRING"/>
          <Column id="CLASS_CD" size="256" type="STRING"/>
          <Column id="IM_SEQ" size="256" type="STRING"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="CHECK_DATE"/>
            <Col id="CLASS_CD"/>
            <Col id="FORM_CD"/>
            <Col id="IM_SEQ"/>
            <Col id="MST_UPJANG"/>
            <Col id="TABLE_TYPE"/>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="Dataset00" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="TABLE_TYPE" type="STRING" size="20"/>
          <Column id="FORM_CD" type="STRING" size="20"/>
          <Column id="UPJANG" type="BIGDECIMAL" size="7"/>
          <Column id="CHECK_DATE" type="STRING" size="8"/>
          <Column id="CLASS_CD" type="STRING" size="8"/>
          <Column id="SEQ" type="BIGDECIMAL" size="39"/>
          <Column id="PHOTO_TYPE" type="STRING" size="1"/>
          <Column id="PHOTO" type="STRING" size="200"/>
          <Column id="SPHOTO" type="STRING" size="200"/>
          <Column id="IM_SEQ" type="BIGDECIMAL" size="39"/>
          <Column id="IM_PHOTO" type="STRING" size="200"/>
          <Column id="IM_SPHOTO" type="STRING" size="200"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="TABLE_TYPE">002</Col>
            <Col id="FORM_CD">201101</Col>
            <Col id="UPJANG">122710</Col>
            <Col id="CHECK_DATE">20131216</Col>
            <Col id="CLASS_CD">01001002</Col>
            <Col id="SEQ">1</Col>
            <Col id="PHOTO_TYPE">0</Col>
            <Col id="PHOTO">20131216_150055.jpg</Col>
            <Col id="SPHOTO">20131216_150055_1387354416968.jpg</Col>
            <Col id="IM_SEQ">2</Col>
            <Col id="IM_PHOTO">Chrysanthemum.jpg</Col>
            <Col id="IM_SPHOTO">Chrysanthemum_20150128114045059.jpg</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="Dataset01" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="TABLE_TYPE" type="STRING" size="20"/>
          <Column id="FORM_CD" type="STRING" size="20"/>
          <Column id="UPJANG" type="BIGDECIMAL" size="7"/>
          <Column id="CHECK_DATE" type="STRING" size="8"/>
          <Column id="CLASS_CD" type="STRING" size="8"/>
          <Column id="SEQ" type="BIGDECIMAL" size="39"/>
          <Column id="PHOTO_TYPE" type="STRING" size="1"/>
          <Column id="PHOTO" type="STRING" size="200"/>
          <Column id="SPHOTO" type="STRING" size="200"/>
          <Column id="IM_SEQ" type="BIGDECIMAL" size="39"/>
          <Column id="IM_PHOTO" type="STRING" size="200"/>
          <Column id="IM_SPHOTO" type="STRING" size="200"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="TABLE_TYPE">002</Col>
            <Col id="FORM_CD">201101</Col>
            <Col id="UPJANG">122710</Col>
            <Col id="CHECK_DATE">20130226</Col>
            <Col id="CLASS_CD">01007004</Col>
            <Col id="SEQ">1</Col>
            <Col id="PHOTO_TYPE">0</Col>
            <Col id="PHOTO">CAM03577.jpg</Col>
            <Col id="SPHOTO">CAM03577_1361932800565.jpg</Col>
            <Col id="IM_SEQ">2</Col>
            <Col id="IM_PHOTO">CAM00076.jpg</Col>
            <Col id="IM_SPHOTO">CAM00076_1362476286229.jpg</Col>
          </Row>
          <Row>
            <Col id="TABLE_TYPE">002</Col>
            <Col id="FORM_CD">201101</Col>
            <Col id="UPJANG">122710</Col>
            <Col id="CHECK_DATE">20130226</Col>
            <Col id="CLASS_CD">01007004</Col>
            <Col id="SEQ">1</Col>
            <Col id="PHOTO_TYPE">0</Col>
            <Col id="PHOTO">CAM03577.jpg</Col>
            <Col id="SPHOTO">CAM03577_1361932800565.jpg</Col>
            <Col id="IM_SEQ">3</Col>
            <Col id="IM_PHOTO">Desert.jpg</Col>
            <Col id="IM_SPHOTO">Desert_20150128112625901.jpg</Col>
          </Row>
        </Rows>
      </Dataset>
    </Objects>
    <Script type="xscript4.0"><![CDATA[include "U_lib::lib_conversionCom.xjs";
/*
 ******************************************************************************************
 * 시스템구분   : 메뉴관리/위생관리/점검결과등록
 * 프로그램명   : FSC00031P.XML
 * 기      능   : 개선개획작성- 사진선택
 * 작  성  자   : 박지영
 * 작성  일자   : 2008-03-25
 * 비      고   : 
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
//=========================================================================================
// [ PART 1 ]
// Form에서 Include 할 내용을 정의
//
//=========================================================================================
//@@컨버터에서 주석처리 #include "lib::sc_comon.js"
////@@컨버터에서 주석처리 #include "LIB::lib_comm_0001.js"
//=========================================================================================
// [ PART 2 ]
// Form에서 사용될 전역변수를 선언
//
//=========================================================================================
var fnSEQ;			// 선택된 사진SEQ
var fstrSPhoto;		// 선택된 사진명
var fa_Enable;
var serverSaveDir = "FSC_RESULT_PHOTO";		// 파일패스
var saveFlag = false;
//=========================================================================================
// [ PART 3 ]
// Form Loading 시 작업 정의
//
//=========================================================================================
function form_onload(obj:Form, e:LoadEventInfo)
{
	gfn_formOnLoad(obj, false);

	try
	{
		if (fa_Enable == "false")
		{
			st_note.visible = false;
		}
	}
	catch(e)
	{
	}	
	
	fstrSPhoto = this.opener.ds_Detail.getColumn(this.opener.ds_Detail.rowposition,"SINDICATE_PHOTO");
	fn_search();
}

function frm_OnKeyDown(obj:Form, e:KeyEventInfo)
{
	gfn_formKeyDown(obj, e); //(obj,e.fromreferenceobject,e.keycode,e.shiftKey,e.ctrlKey,e.altKey,-1,-1);
}
//=========================================================================================
// [ PART 4 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,도움말,form닫기)
//
//=========================================================================================
/*
 ******************************************************************************************
 * 함  수  명   : fn_Search()
 * 기      능   : [조회버튼] 검색조건에 해당하는 정보를 조회
 ******************************************************************************************
 */
function fn_search(){
	// 초기화
	ds_list.clearData();
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	ds_input.setColumn(0,"TABLE_TYPE",this.opener.ds_Detail.getColumn(this.opener.ds_Detail.rowposition,"TABLE_TYPE"));
	ds_input.setColumn(0,"FORM_CD",this.opener.ds_Detail.getColumn(this.opener.ds_Detail.rowposition,"FORM_CD"));
	ds_input.setColumn(0,"MST_UPJANG",this.opener.ds_Detail.getColumn(this.opener.ds_Detail.rowposition,"UPJANG"));
	ds_input.setColumn(0,"CHECK_DATE",this.opener.ds_Detail.getColumn(this.opener.ds_Detail.rowposition,"CHECK_DATE"));
	ds_input.setColumn(0,"CLASS_CD",this.opener.ds_Detail.getColumn(this.opener.ds_Detail.rowposition,"CLASS_CD"));
	actionName		= "FSC00031P_T001";
	cmdName			= "U_svc::" + "fs/fsc/FSC00031P_T001.jsp";
	inData			= "ds_input=ds_input";
	outData			= "ds_list=ds_list";
	callBackFnc		= "fn_afterSearch";
	jsp_transaction(this,actionName, cmdName ,inData ,outData,otherArg,callBackFnc,true,false,false);
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_Close()
 * 기      능   : [닫기버튼] 화면을 닫을때 처리되는 작업
 ******************************************************************************************
 */
function fn_Close(obj:Button, e:ClickEventInfo)
{
	var nRow, nFRow;
	
	nRow = this.opener.ds_Detail.rowposition;
	nFRow = ds_list.findRow("SEQ",fnSEQ);
	// 선택항목 셋팅
	if (nFRow >= 0)
	{
		this.opener.ds_Detail.setColumn(nRow,"INDICATE_PHOTO",ds_list.getColumn(nFRow,"PHOTO"));
		this.opener.ds_Detail.setColumn(nRow,"SINDICATE_PHOTO",ds_list.getColumn(nFRow,"SPHOTO"));
	}
	this.close();
}
//=========================================================================================
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
//
//=========================================================================================
/*
 ******************************************************************************************
 * 함  수  명   : fn_afterSearch()
 * 입      력   : errCode 	= 에러코드
				  errMsg	= 에러메세지
 * 반      환   : 없음
 * 기      능   : 사업장 조회 후 실행 함수
 * 작  성  자   : 박지영
 * 작성  일자   : 2008-02-14  
 ******************************************************************************************
 */
function fn_afterSearch(errCode, errMsg)
{
	fn_MakeDetail();
	
	//trace(fnSEQ);
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_MakeDetail()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 상세내역 생성
 * 작  성  자   : 박지영
 * 작성  일자   : 2007-12-12  
 ******************************************************************************************
 */
function fn_MakeDetail()
{
	if ( ds_list.getRowCount() > 0 ) 
	{
        var strTotContents,nPos;
        var nSEQ,strInSPhoto,strImSPhoto, strSPhoto;
        div_photo.visible = false;
        // 상세내역 생성
        nPos = 0;
        for ( i = 0; i < ds_list.getRowCount(); i++ ) 
        {
			nSEQ 		= ds_list.getColumn(i, "SEQ");
			strInSPhoto 	= ds_list.getColumn(i, "SPHOTO");
			strImSPhoto 	= ds_list.getColumn(i, "IM_SPHOTO");
			bValue		= iif(fstrSPhoto==strSPhoto,true,false);
			fnSEQ		= iif(fstrSPhoto==strSPhoto,nSEQ,fnSEQ);

			strTotContents += fn_MakeComp(nSEQ, nPos, strInSPhoto, bValue, strImSPhoto);	// 이미지 추가
			
			nPos += 205;
			
        }
     
        //div_photo.layout = '<Contnets>' + strTotContents +'</Contnets>';        
        div_photo.visible = true;
        this.div_photo.resetScroll();
    }
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_MakeComp(nSEQ, nPos, strSPhoto, bValue) 
 * 입      력   : nSEQ=사진생성  , nPos=위치	, strSPhoto=사진명	, bValue=체크박스값
 * 반      환   : 없음
 * 기      능   : 레시피코드별 컴포넌트 그룹생성 
 * 작  성  자   : 박지영
 * 작성  일자   : 
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function fn_MakeComp(nSEQ, nPos, strInSPhoto, bValue, strImSPhoto) 
{	
    var objImgBkStatic = new Static("st_bk_" + nSEQ, nPos, 0, 196+nPos, 180);
	this.div_photo.addChild("st_bk_" + nSEQ, objImgBkStatic);
	objImgBkStatic.style.background 	= "#ffffff";
	objImgBkStatic.style.border 		= "1 solid #aaaaaa";
	objImgBkStatic.show();
	
	nPos += 2;
	var objImageViewer = new ImageViewer("img_photo_" + nSEQ, nPos, 3, 192+nPos, 148);
	this.div_photo.addChild("img_photo_" + nSEQ, objImageViewer);
	objImageViewer.stretch = "fit";
	objImageViewer.image = this.opener.serverSaveUrl + strInSPhoto;
	objImageViewer.show();

	var objChkImgStatic = new Static("st_chkbk_" + nSEQ, nPos, 151, 192+nPos, 177);
	this.div_photo.addChild("st_chkbk_" + nSEQ, objChkImgStatic);
	objChkImgStatic.style.background 	= "#ffffff";
	objChkImgStatic.style.border		= "1 solid #aaaaaa";
	objChkImgStatic.show();

	
	
	
	nPos -= 2;
	var objImgBkStatic1 = new Static("st_bk" + nSEQ + nSEQ, nPos, 192, 196+nPos, 392);
	this.div_photo.addChild("st_bk" + nSEQ + nSEQ, objImgBkStatic1);
	objImgBkStatic1.style.background 	= "#ffffff";
	objImgBkStatic1.style.border 		= "1 solid #aaaaaa";
	objImgBkStatic1.show();

	nPos = nPos + 2;
	var objImageViewer1 = new ImageViewer("img_photo_" + nSEQ + nSEQ, nPos, 195, 192+nPos, 343);
	this.div_photo.addChild("img_photo_" + nSEQ + nSEQ, objImageViewer1);
	objImageViewer1.stretch  = "fit";
	objImageViewer1.image  = strImSPhoto ? this.opener.serverSaveUrl + strImSPhoto : "";

	if(gfn_isNull(strImSPhoto))
    {
		objImageViewer1.userdata = "N";
	}
	else
	{
		objImageViewer1.userdata = "Y";
	}
	objImageViewer1.show();
	
	var objChkImgStatic1 = new Static("st_chkbk" + nSEQ + nSEQ, nPos, 346, 192+nPos, 389);
	this.div_photo.addChild("st_chkbk" + nSEQ + nSEQ, objChkImgStatic1);
	objChkImgStatic1.style.background 	= "#ffffff";
	objChkImgStatic1.style.border		= "1 solid #aaaaaa";
	objChkImgStatic1.show();

	var objButtonU = new Button("btn_Upload" + nSEQ, nPos+5, 355, 53+nPos, 379);
	this.div_photo.addChild("btn_Upload" + nSEQ, objButtonU);
	objButtonU.onclick.addHandler(btn_Upload_OnClick);
	objButtonU.class = "btn_WF_Append";
	objButtonU.text  = "첨부";
	objButtonU.show();

	nPos += 56;
	var objButtonD = new Button("btn_Delete" + nSEQ, nPos+5, 355, 53+nPos, 379);
	this.div_photo.addChild("btn_Delete" + nSEQ, objButtonD);
	objButtonD.onclick.addHandler(btn_Delete_OnClick);
	objButtonD.class = "btn_WF_Delete";
	objButtonD.text  = "삭제";
	objButtonD.show();
	
	nPos += 56;
	var objButtonS = new Button("btn_FileSave" + nSEQ, nPos+5, 355, 75+nPos, 379);
	this.div_photo.addChild("btn_FileSave" + nSEQ, objButtonS); 
	objButtonS.onclick.addHandler(btn_FileSave_OnClick);
	objButtonS.class = "btn_WF_Custom";
	objButtonS.text  = "파일다운";
	objButtonS.show();
    
//	   var strContents, str_st_bk, str_st_imgbk, str_chkbk, str_img, str_chk;
//	   var strContents2, str_st_bk2, str_st_imgbk2, str_chkbk2, str_img2, str_chk2;    
//     // BK 생성
//     str_st_bk 		=  '<Static Height="390" Id="st_bk_' + nSEQ + '" Left="' + nPos + '" Style="sty_st1" ';
//     str_st_bk 	   +=  'TabOrder="2" Width="200"></Static>\n';
//     
//     // 이미지BK 생성
//     nPos = nPos + 2;
//     str_st_imgbk	=  '<Static Align="Center" Border="Flat" Height="150" Id="st_imgbk_' + nSEQ + '" ';
//     str_st_imgbk   +=  'Left="' + nPos + '" Style="sty_st3" TabOrder="3" Top="2" VAlign="Middle" Width="196"></Static>\n';
//     
//     // 이미지생성
//     str_img			=  '<Image FillType="STRETCH" Height="148" Id="img_photo_' + nSEQ + '" ImageID="' + this.opener.serverSaveUrl + strInSPhoto + '" ';
//     str_img		   +=  'Left="' + nPos + '" Style="sty_st5" TabOrder="1" Top="3" Width="194"></Image>\n';
//     
// 
//     // 체크박스BK생성
//     str_chkbk		=  '<Static Align="Center" Border="Flat" Height="22" Id="st_chkbk_' + nSEQ + '" Left="' + nPos + '" ';
//     str_chkbk	   +=  'Style="sty_st3" TabOrder="4" Top="156" VAlign="Middle" Width="196"></Static>\n';
//     strContents = str_st_bk + str_st_imgbk + str_img + str_chkbk + str_chk;
//     
//     //================================================
//     // 개선사항 사진 출력
//     //================================================
//     // 이미지BK 생성
// 	str_st_imgbk2	=  '<Static Align="Center" Border="Flat" Height="150" Id="st_imgbk_' + nSEQ + nSEQ + '" ';
// 	str_st_imgbk2   +=  'Left="' + nPos + '" Style="sty_st3" TabOrder="6" Top="182" VAlign="Middle" Width="196"></Static>\n';
//     // 이미지생성
// 	str_img2			=  '<Image FillType="STRETCH" Height="148" Id="img_photo_' + nSEQ + nSEQ + '" ImageID="' + this.opener.serverSaveUrl + strImSPhoto + '" ';
// 	
// 	// 개선사진이 저장 안되어 있으면 UserData = 'N' 그렇지 않으면 UserData = 'Y'
// 	if(gfn_length(gfn_trim(strImSPhoto))== 0){
// 		str_img2 += ' UserData = "N" ';
// 	}else{
// 		str_img2 += ' UserData = "Y" ';
// 	}
//     str_img2		   +=  'Left="' + nPos + '" Style="sty_st5" TabOrder="1" Top="183" Width="194"></Image>\n';
//     // 버튼BK생성
//     str_chkbk2		=  '<Static Align="Center" Border="Flat" Height="50" Id="st_chkbk_' + nSEQ + nSEQ + '" Left="' + nPos + '" ';
//     str_chkbk2	   +=  'Style="sty_st3" TabOrder="4" Top="336" VAlign="Middle" Width="196"></Static>\n';
//     // 버튼생성
//     // 첨부버튼
//     str_chk2 = '<Button Left="' + nPos + '" Top="350"  Cursor="HAND" Font="굴림,9" Height="22" Id="btn_Upload' + nSEQ + nSEQ + '" ImageID="btn_Append" OnClick="btn_Upload_OnClick" TabOrder="2" Transparent="TRUE" Width="51"></Button>\n';
//     	
// 	nPos += 56;
// 	
// 	// 삭제버튼
// 	str_chk2 += '<Button Left="' + nPos + '" Top="350" ButtonStyle="TRUE" Cursor="HAND" Font="굴림,9" Height="22" Id="btn_Delete' + nSEQ + nSEQ + '" ImageID="btn_Del02" LeftMargin="20" OnClick="btn_Delete_OnClick" TabOrder="3" Text="삭제" Transparent="TRUE" Width="51"></Button>\n';
// 	
// 	nPos += 56;
// 	
// 	// 다운로드 버튼
// 	str_chk2 += '<Button Left="' + nPos + '" Top="350" ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btn_FileSave' + nSEQ + nSEQ + '" ImageID="n_btn_4t" OnClick="btn_FileSave_OnClick" Style="n_btn" TabOrder="7" TabStop="FALSE" Text="&#32;파일다운" Transparent="TRUE" Width="75"></Button>\n';
//     
//     strContents2 = str_st_bk2 + str_st_imgbk2 + str_img2 + str_chkbk2 + str_chk2;    
//g_alert(strContents + strContents2);

    //return strContents + strContents2;
}

//============================================
// 파일다운
//============================================
function btn_FileSave_OnClick(obj, e){
	var strNo;

	strNo = gfn_subStr(obj.name, 12, 1);
	
	//saveDialog.FileName = ds_list.getColumn(parseInt(strNo) - 1, "IM_SPHOTO");
	
	//if (! saveDialog.Open()) return;
	
	//alert('serverSaveDir' : + serverSaveDir);
	//alert('IM_SPHOTO : ' + ds_list.GetColumn(parseInt(strNo) - 1, "IM_SPHOTO"));
	//alert(saveDialog.FilePath);
	//alert(saveDialog.FileName);
	
	
	
	var arr = fsp_fileRead(httpFile
	                     , serverSaveDir
                         , ds_list.getColumn(parseInt(strNo) - 1, "IM_SPHOTO")
                         , ""
                         , ds_list.getColumn(parseInt(strNo) - 1, "IM_SPHOTO"));	
}

//==============================================
// 첨부버튼 클릭
//==============================================
function btn_Upload_OnClick(obj, e)
{
	var strNo;
	
	strNo = gfn_subStr(obj.name, 10);
	
	if (eval("div_photo.img_photo_" + strNo + strNo).userdata == "Y")
	{
		g_Message("EE","사진을 삭제하신 후 첨부해 주십시오.");
		return;
	}
	
	// 서버로 전송 할 파일 선택하기 
	var btp = fileDialog.Open();
	if (btp)
	{
		//파일사이즈 체크(1M(1048576)초과 불가)
		var size = httpFile.GetLength(fileDialog.FilePath + fileDialog.FileName)
		var totSize = size * 1024;
		
		if ( size > GF_FILE_UPLOAD_SIZE )
		//if ( httpFile.GetFileSizeLocal(fileDialog.FilePath + fileDialog.FileName) > 1048576 )
		{
			g_Message("EE", "파일 사이즈는 1M를 초과할 수 없습니다.");
			return false;
		}
		// 파일 서버로 전송 
		var arr = fsp_fileWrite(httpFile, serverSaveDir, fileDialog.FilePath, fileDialog.FileName);  
		// 처리 결과 확인하기 
		
		//if( arr[0] == "S" ) 	// 성공 
		if( true ) 	// 성공 
		{
			eval("div_photo.img_photo_" + strNo).image = fileDialog.FilePath +"\\"+ fileDialog.FileName;
			fn_saveData(gfn_subStr(strNo, 0, 1), fileDialog.FileName, arr[2]);
			//fn_SaveData(substr(strNo, 0, 1), fileDialog.FileName, "11111111.jsp");  // 테스트용
			
		}
		else
		{
			g_Message("EE", "파일저장에 실패하였습니다.");
			return false;
		}
	}
}

//-------------------------------------
// 첨부파일(이미지) 저장
//-------------------------------------
function fn_saveData(strNo, fileName, filePath){
    // 서비스셋팅
    var actionName, cmdName, inData, outData, otherArg, callBackFnc;
    
    ds_list.setColumn(parseInt(strNo) - 1, "IM_PHOTO",  fileName);
	ds_list.setColumn(parseInt(strNo) - 1, "IM_SPHOTO", filePath);
	SetRowType(ds_list,parseInt(strNo) - 1, 'update');
	saveFlag = true;
	actionName		= "FSC00033P_T002";
	cmdName			= "U_svc::" + "fs/fsc/FSC00033P_T002.jsp";
	inData			= "ds_list=ds_list:U";
    outData			= "";
    callBackFnc		= "fn_aftersaveData";
	jsp_transaction(this, actionName, cmdName, inData, outData, otherArg, callBackFnc, true, false, true);
}

function fn_aftersaveData(errCode, errMsg)
{
	if(errCode == -1)
	{
		saveFlag = false;
	}
	else
	{	
		removeComp();
		fn_search();
	}
	
}

/*
 ******************************************************************************************
 * 함  수  명   : btn_Delete_OnClick(obj)
 * 기      능   : 파일삭제
 * 작  성  자   : 김장욱
 * 작성  일자   : 2013-08-06
 ******************************************************************************************
 */
function btn_Delete_OnClick(obj){
	var strNo;
	
	strNo = gfn_subStr(obj.name, 10);
	
	if (eval("div_photo.img_photo_" + strNo + strNo).userdata == "N")
	{
		g_Message("EE","삭제할 이미지가 없습니다.");
		return;
	}

    // 삭제확인
	if(!g_Confirm("01","사진을 삭제하시겠습니까?")){
		return;
	}

	var btp = fsp_fileDelete(serverSaveDir, ds_list.getColumn(ds_list.rowposition,"IM_SPHOTO"),true);

	if (btp){
		// substr(strNo, 0, 1)로 자르는 이유는 Object의 ID의 숫자가 같은 숫자 두개로 넣어있음.
		// 예) 두번째 개선사항 사진이면 ObjectID+숫자+숫자(btnDelete22)라서 위치값을 잘라서 사용.
		fn_DeleteData(gfn_subStr(strNo, 0, 1));
	}else{
		g_Message("EE", "사진 삭제를 실패하였습니다.");
	}
}

//-------------------------------------
// 첨부파일(이미지) 저장
//-------------------------------------
function fn_DeleteData(strNo){
    // 서비스셋팅
    var actionName, cmdName, inData, outData, otherArg, callBackFnc;
    
    // 삭제 할 건이 있는지 체크
	//if(gfn_length(gfn_trim(ds_list.getColumn(parseInt(strNo) - 1, "IM_SEQ")))== 0){
		//g_alert("삭제할 이미지가 없습니다.");
	//	return;
	//}
	
	
	//alert(ds_list.GetColumn(parseInt(strNo) - 1, "TABLE_TYPE"));
	//alert(ds_list.GetColumn(parseInt(strNo) - 1, "FORM_CD"));
	//alert(ds_list.GetColumn(parseInt(strNo) - 1, "UPJANG"));
	//alert(ds_list.GetColumn(parseInt(strNo) - 1, "CHECK_DATE"));
	//alert(ds_list.GetColumn(parseInt(strNo) - 1, "CLASS_CD"));
	//alert(ds_list.GetColumn(parseInt(strNo) - 1, "IM_SEQ"));
	
	ds_input.setColumn(0, "TABLE_TYPE", ds_list.getColumn(parseInt(strNo) - 1, "TABLE_TYPE"));
	ds_input.setColumn(0, "FORM_CD",    ds_list.getColumn(parseInt(strNo) - 1, "FORM_CD"));
	ds_input.setColumn(0, "MST_UPJANG", ds_list.getColumn(parseInt(strNo) - 1, "UPJANG"));
	ds_input.setColumn(0, "CHECK_DATE", ds_list.getColumn(parseInt(strNo) - 1, "CHECK_DATE"));
	ds_input.setColumn(0, "CLASS_CD",   ds_list.getColumn(parseInt(strNo) - 1, "CLASS_CD"));    
	ds_input.setColumn(0, "IM_SEQ",     ds_list.getColumn(parseInt(strNo) - 1, "IM_SEQ"));
	SetRowType(ds_input,0, 'Update');
	
	// 삭제 후 데이타 초기화
	eval("div_photo.img_photo_" + strNo + strNo).image = "";
	eval("div_photo.img_photo_" + strNo + strNo).userdata = "N";
	
	ds_list.setColumn(parseInt(strNo) - 1, "IM_PHOTO",  "");
	ds_list.setColumn(parseInt(strNo) - 1, "IM_SPHOTO", "");	
	ds_list.setColumn(parseInt(strNo) - 1, "IM_SEQ",    "");	
	    
	actionName		= "FSC00033P_T001";
	cmdName			= "U_svc::" + "fs/fsc/FSC00033P_T001.jsp";
	inData			= "ds_list=ds_input:A";
    outData			= "";
    callBackFnc		= "";
    
	jsp_transaction(this, actionName, cmdName, inData, outData, otherArg, callBackFnc, true, false, true);
}

function removeComp()
{
	var len = this.div_photo.components.length
	for(var i = len-1; i >= 0; i--)
	{
		this.div_photo.removeChild(this.div_photo.components[i].name);
	}
	saveFlag = false;
}
]]></Script>
  </Form>
</FDL>
