<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="..\..\..\default_typedef.xml"/>
  <Form id="FSM90030E" classname="SAMPLE01" inheritanceid="" position="absolute 0 0 1252 725" titletext="식단등록(일반식)" onload="form_onload">
    <Layouts>
      <Layout>
        <Static id="Static06" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1237 0 1252 710" anchor="top right"/>
        <Static id="Static71" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 710 1252 725" anchor="left bottom"/>
        <Div id="div_cmnBtn" anchor="left top right" taborder="5" url="cmn::CmnBtn.xfdl" text="Div00" scrollbars="none" position="absolute 0 0 1237 30"/>
        <Static id="Static08" class="sta_WFSA_Labelbg" position="absolute 0 30 1237 71" anchor="left top right"/>
        <Static id="Static04" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 30 1237 40" anchor="left top"/>
        <Static id="Static05" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 61 1237 71" anchor="left top"/>
        <Static id="Static07" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 40 15 61" anchor="left top"/>
        <Static id="Static19" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 0 71 813 84"/>
        <Static id="Static03" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 258 40 268 61" anchor="left top"/>
        <Static id="Static37" text="h06" class="Guide01_AreaRed" visible="false" position="absolute 1179 71 1237 77" anchor="top right"/>
        <Static id="Static10" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 514 40 544 61" anchor="left top"/>
        <Static id="Static14" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 589 40 599 61" anchor="left top"/>
        <Static id="Static15" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 771 40 801 61" anchor="left top"/>
        <Static id="Static23" text="제공일" class="sta_WFSA_label" position="absolute 801 41 861 62" anchor="left top"/>
        <Static id="Static24" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 846 40 856 61" anchor="left top"/>
        <ObjCalendar id="cal_menuDate" anchor="left top" titletext="캘린더" taborder="3" scrollbars="none" position="absolute 856 40 959 61" onkeydown="cal_menuDate_onkeydown"/>
        <Static id="Static01" text="사업장" class="sta_WFSA_label" position="absolute 213 41 273 62" anchor="left top"/>
        <UpjangSearchComponent id="edt_upjang" titletext="업장 검색용 Component" taborder="1" text="UpjangSearchComponent00" position="absolute 268 40 514 61" bindDataset="ds_cond" bindUpjangCodeColumn="UPJANG" bindUpjangNameColumn="UPJANGNM" eventBeforeTrigger="" eventAfterTrigger="fn_hallSearch" roleSetId=""/>
        <Static id="Static00" text="식당명" class="sta_WFSA_label" position="absolute 544 41 604 62" anchor="left top"/>
        <Combo id="cbo_hall" taborder="2" position="absolute 599 40 771 61" index="-1" innerdataset="@ds_cboHall" codecolumn="HALL_CD" datacolumn="HALL_NAME" onitemchanged="cbo_hall_onitemchanged"/>
        <Tab id="tab_menu" taborder="4" tabindex="0" scrollbars="autoboth" position="absolute 0 83 1237 670" anchor="all" onchanged="tab_menu_onchanged" style="showextrabutton:false;">
          <Tabpages>
            <Tabpage id="tabpage1" text="식수예측">
              <Layouts>
                <Layout>
                  <Static id="Static07" visible="false" position="absolute 0 0 10 599" style="background:#ff000033;font:Dotum,8;"/>
                  <Static id="Static04" visible="false" position="absolute 0 549 1235 559" style="background:#ff000033;font:Dotum,8;"/>
                  <Static id="Static01" visible="false" position="absolute 1225 0 1235 599" style="background:#ff000033;font:Dotum,8;"/>
                  <Static id="Static00" visible="false" position="absolute 0 0 1235 10" style="background:#ff000033;font:Dotum,8;"/>
                  <Grid id="grd_mealQtyList" taborder="1" binddataset="ds_mealQtyList" useinputpanel="false" selecttype="multiarea" autofittype="col" position="absolute 10 42 1225 374" anchor="all" style="border:1 solid #53606cff,1 solid #c3c3c3ff,1 solid #c3c3c3ff,1 solid #c3c3c3ff;" autoenter="select" onheadclick="tab_menu_tabpage1_grd_mealQtyList_onheadclick" oncellclick="tab_menu_tabpage1_grd_mealQtyList_oncelldblclick">
                    <Formats>
                      <Format id="default">
                        <Columns>
                          <Column size="100"/>
                          <Column size="61"/>
                          <Column size="116"/>
                          <Column size="35"/>
                          <Column size="116"/>
                          <Column size="35"/>
                          <Column size="116"/>
                          <Column size="35"/>
                          <Column size="116"/>
                          <Column size="35"/>
                          <Column size="116"/>
                          <Column size="35"/>
                          <Column size="116"/>
                          <Column size="35"/>
                          <Column size="116"/>
                          <Column size="35"/>
                        </Columns>
                        <Rows>
                          <Row size="24" band="head"/>
                          <Row size="24" band="head"/>
                          <Row size="24"/>
                          <Row size="24" band="summ"/>
                        </Rows>
                        <Band id="head">
                          <Cell colspan="2" text="구분" taborder="undefined"/>
                          <Cell col="2" text="월" taborder="undefined"/>
                          <Cell col="3" rowspan="2" taborder="undefined"/>
                          <Cell col="4" text="화" taborder="undefined"/>
                          <Cell col="5" rowspan="2" taborder="undefined"/>
                          <Cell col="6" text="수" taborder="undefined"/>
                          <Cell col="7" rowspan="2" taborder="undefined"/>
                          <Cell col="8" text="목" taborder="undefined"/>
                          <Cell col="9" rowspan="2" taborder="undefined"/>
                          <Cell col="10" text="금" taborder="undefined"/>
                          <Cell col="11" rowspan="2" taborder="undefined"/>
                          <Cell col="12" style="color:#99ccffff;" text="토" taborder="undefined"/>
                          <Cell col="13" rowspan="2" taborder="undefined"/>
                          <Cell col="14" style="color:#ff7878;" text="일" taborder="undefined"/>
                          <Cell col="15" rowspan="2" taborder="undefined"/>
                          <Cell row="1" text="끼니" taborder="undefined"/>
                          <Cell row="1" col="1" text="코너"/>
                          <Cell row="1" col="2" taborder="undefined"/>
                          <Cell row="1" col="4" taborder="undefined"/>
                          <Cell row="1" col="6" taborder="undefined"/>
                          <Cell row="1" col="8" taborder="undefined"/>
                          <Cell row="1" col="10" taborder="undefined"/>
                          <Cell row="1" col="12" taborder="undefined"/>
                          <Cell row="1" col="14" taborder="undefined"/>
                        </Band>
                        <Band id="body">
                          <Cell style="line: ;background:whitesmoke;background2:whitesmoke;" text="expr:!gfn_isNull(KEY) ? SGBN_NM : ''" suppress="1" suppressalign="middle"/>
                          <Cell col="1" style="background:#fffdecff;background2:#fffdecff;" text="expr:!gfn_isNull(KEY) ? CGBN : ''"/>
                          <Cell col="2" colspan="2" displaytype="number" edittype="expr:L2 == 1 ? 'masknumber' : 'none'" style="padding:0 5 0 0;background:EXPR(L2 == 1 ? 'white' : 'whitesmoke');background2:EXPR(L2 == 1 ? 'white' : 'whitesmoke');color:EXPR(!gfn_isNull(C2) ? &quot;C2&quot; : &quot;black&quot;);" text="bind:Q2" editautoselect="true" taborder="undefined"/>
                          <Cell col="4" colspan="2" displaytype="number" edittype="expr:L3 == 1 ? 'masknumber' : 'none'" style="padding:0 5 0 0;background:EXPR(L3 == 1 ? 'white' : 'whitesmoke');background2:EXPR(L3 == 1 ? 'white' : 'whitesmoke');" text="bind:Q3" editautoselect="true" taborder="undefined"/>
                          <Cell col="6" colspan="2" displaytype="number" edittype="expr:L4 == 1 ? 'masknumber' : 'none'" style="padding:0 5 0 0;background:EXPR(L4 == 1 ? 'white' : 'whitesmoke');background2:EXPR(L4 == 1 ? 'white' : 'whitesmoke');" text="bind:Q4" editautoselect="true" taborder="undefined"/>
                          <Cell col="8" colspan="2" displaytype="number" edittype="expr:L5 == 1 ? 'masknumber' : 'none'" style="padding:0 5 0 0;background:EXPR(L5 == 1 ? 'white' : 'whitesmoke');background2:EXPR(L5 == 1 ? 'white' : 'whitesmoke');" text="bind:Q5" editautoselect="true" taborder="undefined"/>
                          <Cell col="10" colspan="2" displaytype="number" edittype="expr:L6 == 1 ? 'masknumber' : 'none'" style="padding:0 5 0 0;background:EXPR(L6 == 1 ? 'white' : 'whitesmoke');background2:EXPR(L6 == 1 ? 'white' : 'whitesmoke');" text="bind:Q6" editautoselect="true" taborder="undefined"/>
                          <Cell col="12" colspan="2" displaytype="number" edittype="expr:L7 == 1 ? 'masknumber' : 'none'" style="padding:0 5 0 0;background:EXPR(L7 == 1 ? 'white' : 'whitesmoke');background2:EXPR(L7 == 1 ? 'white' : 'whitesmoke');" text="bind:Q7" editautoselect="true" taborder="undefined"/>
                          <Cell col="14" colspan="2" displaytype="number" edittype="expr:L1 == 1 ? 'masknumber' : 'none'" style="padding:0 5 0 0;background:EXPR(L1 == 1 ? 'white' : 'whitesmoke');background2:EXPR(L1 == 1 ? 'white' : 'whitesmoke');" text="bind:Q1" editautoselect="true" taborder="undefined"/>
                        </Band>
                        <Band id="summary">
                          <Cell style="align:center;" text="합계"/>
                          <Cell col="1"/>
                          <Cell col="2" colspan="2" displaytype="number" text="expr:fn_clearNaN(getSum('Q2'))" taborder="undefined"/>
                          <Cell col="4" colspan="2" displaytype="number" text="expr:fn_clearNaN(getSum('Q3'))" taborder="undefined"/>
                          <Cell col="6" colspan="2" displaytype="number" text="expr:fn_clearNaN(getSum('Q4'))" taborder="undefined"/>
                          <Cell col="8" colspan="2" displaytype="number" text="expr:fn_clearNaN(getSum('Q5'))" taborder="undefined"/>
                          <Cell col="10" colspan="2" displaytype="number" text="expr:fn_clearNaN(getSum('Q6'))" taborder="undefined"/>
                          <Cell col="12" colspan="2" displaytype="number" text="expr:fn_clearNaN(getSum('Q7'))" taborder="undefined"/>
                          <Cell col="14" colspan="2" displaytype="number" text="expr:fn_clearNaN(getSum('Q1'))" taborder="undefined"/>
                        </Band>
                      </Format>
                    </Formats>
                  </Grid>
                  <Button id="btn_copyMealQty" taborder="2" text="전주예상식수복사" class="btn_WF_Function" position="absolute 1112 17 1225 37" onclick="tab_menu_tabpage1_btn_copyMealQty_onclick" anchor="top right"/>
                  <Static id="Static16" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 10 37 1225 42"/>
                  <Static id="Static12" text="주간 목표식재료율(%)" class="sta_WFDA_Label01" position="absolute 10 10 171 37" anchor="left top" style="background:lavender;font:Gulim,9;"/>
                  <MaskEdit id="edt_goalCostRate" taborder="3" readonly="false" mask="#,###.#" position="absolute 170 10 286 37" anchor="left top" style="color:blue;font:Gulim,9,bold;" ontextchanged="tab_menu_tabpage1_edt_goalCostRate_ontextchanged"/>
                  <Static id="Static22" text="4주간 실식수" class="sta_WF_Title01" position="absolute 10 387 460 405" anchor="left bottom"/>
                  <Static id="Static02" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 10 400 460 405"/>
                  <Static id="Static20" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 10 374 460 387" anchor="left top"/>
                  <Grid id="grd_realMealQtyList" taborder="4" useinputpanel="false" position="absolute 10 404 1225 549" autofittype="col" binddataset="ds_realMealQtyList" scrollbars="none" anchor="left right bottom">
                    <Formats>
                      <Format id="default">
                        <Columns>
                          <Column size="100"/>
                          <Column size="100"/>
                          <Column size="133"/>
                          <Column size="100"/>
                          <Column size="668"/>
                          <Column size="100"/>
                        </Columns>
                        <Rows>
                          <Row size="24" band="head"/>
                          <Row size="24"/>
                          <Row size="24" band="summ"/>
                        </Rows>
                        <Band id="head">
                          <Cell text="일자"/>
                          <Cell col="1" text="날씨"/>
                          <Cell col="2" text="일정"/>
                          <Cell col="3" text="실식수"/>
                          <Cell col="4" text="제공식단"/>
                          <Cell col="5" text="식단특성"/>
                        </Band>
                        <Band id="body">
                          <Cell style="background:white;background2:white;" text="bind:DAYS"/>
                          <Cell col="1" style="background:white;background2:white;" text="bind:WDESC"/>
                          <Cell col="2" style="background:white;background2:white;" text="bind:SCHEDULE"/>
                          <Cell col="3" displaytype="number" style="background:white;background2:white;" text="bind:REAL_MEAL_QTY"/>
                          <Cell col="4" displaytype="text" style="background:white;background2:white;" text="bind:SIKDAN"/>
                          <Cell col="5" style="background:white;background2:white;" text="bind:MENU_FEATURE"/>
                        </Band>
                        <Band id="summary">
                          <Cell style="align:center;" text="평균"/>
                          <Cell col="1"/>
                          <Cell col="2"/>
                          <Cell col="3" displaytype="number" text="expr:fn_clearNaN(Math.round(getAvg(&quot;REAL_MEAL_QTY&quot;),0))"/>
                          <Cell col="4"/>
                          <Cell col="5"/>
                        </Band>
                      </Format>
                    </Formats>
                  </Grid>
                  <Static id="Static03" text="%" position="absolute 291 16 315 33"/>
                  <Static id="Static18" text="발주자재가 있는 식단, 식단(실재식단)에 실식수 인원이 등록되어 있는 경우 입력 또는 수정 할 수 없습니다." class="sta_WF_DiscPoint" position="absolute 314 16 974 31" anchor="default"/>
                </Layout>
              </Layouts>
            </Tabpage>
            <Tabpage id="tabpage2" text="식단등록">
              <Layouts>
                <Layout width="1235" height="559">
                  <Static id="Static07" visible="false" position="absolute 0 0 10 599" style="background:#ff000033;font:Dotum,8;"/>
                  <Static id="Static00" visible="false" position="absolute 0 0 1235 10" style="background:#ff000033;font:Dotum,8;"/>
                  <Static id="Static01" visible="false" position="absolute 1225 0 1235 599" style="background:#ff000033;font:Dotum,8;"/>
                  <Static id="Static04" visible="false" position="absolute 0 549 1235 559" style="background:#ff000033;font:Dotum,8;"/>
                  <Grid id="grd_menuList" taborder="1" binddataset="ds_menuList" useinputpanel="false" autofittype="col" position="absolute 10 42 1225 514" anchor="all" style="border:1 solid #53606cff,1 solid #c3c3c3ff,1 solid #c3c3c3ff,1 solid #c3c3c3ff;" oncellclick="tab_menu_tabpage2_grd_menuList_oncellclick" readonly="false" useselcolor="true" onmousemove="tab_menu_tabpage2_grd_menuList_onmousemove" onrbuttondown="tab_menu_tabpage2_grd_menuList_onrbuttondown" selecttype="area" oncelldblclick="tab_menu_tabpage2_grd_menuList_oncelldblclick" onheadclick="tab_menu_tabpage2_grd_menuList_onheadclick" class="grd_WF_LineNone">
                    <Formats>
                      <Format id="default">
                        <Columns>
                          <Column size="100"/>
                          <Column size="120"/>
                          <Column size="35"/>
                          <Column size="120"/>
                          <Column size="35"/>
                          <Column size="120"/>
                          <Column size="35"/>
                          <Column size="120"/>
                          <Column size="35"/>
                          <Column size="120"/>
                          <Column size="35"/>
                          <Column size="120"/>
                          <Column size="35"/>
                          <Column size="120"/>
                          <Column size="35"/>
                        </Columns>
                        <Rows>
                          <Row size="24" band="head"/>
                          <Row size="24" band="head"/>
                          <Row size="24"/>
                          <Row size="24" band="summ"/>
                        </Rows>
                        <Band id="head">
                          <Cell rowspan="2" text="일자" taborder="undefined"/>
                          <Cell col="1" text="월" taborder="undefined"/>
                          <Cell col="2" rowspan="2" taborder="undefined"/>
                          <Cell col="3" text="화" taborder="undefined"/>
                          <Cell col="4" rowspan="2" taborder="undefined"/>
                          <Cell col="5" text="수" taborder="undefined"/>
                          <Cell col="6" rowspan="2" taborder="undefined"/>
                          <Cell col="7" text="목" taborder="undefined"/>
                          <Cell col="8" rowspan="2" taborder="undefined"/>
                          <Cell col="9" text="금" taborder="undefined"/>
                          <Cell col="10" rowspan="2" taborder="undefined"/>
                          <Cell col="11" style="color:#99ccffff;" text="토" taborder="undefined"/>
                          <Cell col="12" rowspan="2" taborder="undefined"/>
                          <Cell col="13" style="color:#ff7878;" text="일" taborder="undefined"/>
                          <Cell col="14" rowspan="2" taborder="undefined"/>
                          <Cell row="1" col="1" taborder="undefined"/>
                          <Cell row="1" col="3" taborder="undefined"/>
                          <Cell row="1" col="5" taborder="undefined"/>
                          <Cell row="1" col="7" taborder="undefined"/>
                          <Cell row="1" col="9" taborder="undefined"/>
                          <Cell row="1" col="11" taborder="undefined"/>
                          <Cell row="1" col="13" taborder="undefined"/>
                        </Band>
                        <Band id="body">
                          <Cell style="line:1 none transparent transparent;background:whitesmoke;background2:whitesmoke;" text="expr:!gfn_isNull(KEY) ? SGBN_NM + '(' + CGBN + ')' : ''" suppress="1" suppressalign="middle"/>
                          <Cell col="1" displaytype="text" style="padding:0 0 0 5;line:1 none transparent transparent;background:EXPR(gfn_isNull(KEY) ? &quot;#DDFCDB&quot; : (Z2 == '1' ? &quot;lightskyblue&quot;:&quot;white&quot;));background2:EXPR(gfn_isNull(KEY) ? &quot;#DDFCDB&quot; : (Z2 == '1' ? &quot;lightskyblue&quot;:&quot;white&quot;));color:EXPR(!gfn_isNull(C2) ? &quot;C2&quot; : &quot;black&quot;);" text="bind:M2"/>
                          <Cell col="2" displaytype="number" style="padding:0 3 0 0;line:1 none transparent transparent;background:EXPR(!gfn_isNull(C2) ? C2 : gfn_isNull(KEY) ? &quot;#DDFCDB&quot; : &quot;whitesmoke&quot;);background2:EXPR(!gfn_isNull(C2) ? C2 : gfn_isNull(KEY) ? &quot;#DDFCDB&quot; : &quot;whitesmoke&quot;);" text="bind:P2"/>
                          <Cell col="3" displaytype="text" style="padding:0 0 0 5;line:1 none transparent transparent;background:EXPR(gfn_isNull(KEY) ? &quot;#DDFCDB&quot; : (Z3 == '1' ? &quot;lightskyblue&quot;:&quot;white&quot;));background2:EXPR(gfn_isNull(KEY) ? &quot;#DDFCDB&quot; : (Z3 == '1' ? &quot;lightskyblue&quot;:&quot;white&quot;));color:EXPR(!gfn_isNull(C2) ? &quot;C2&quot; : &quot;black&quot;);" text="bind:M3"/>
                          <Cell col="4" displaytype="number" style="padding:0 3 0 0;line:1 none transparent transparent;background:EXPR(!gfn_isNull(C3) ? C3 : gfn_isNull(KEY) ? &quot;#DDFCDB&quot; : &quot;whitesmoke&quot;);background2:EXPR(!gfn_isNull(C3) ? C3 : gfn_isNull(KEY) ? &quot;#DDFCDB&quot; : &quot;whitesmoke&quot;);" text="bind:P3"/>
                          <Cell col="5" displaytype="text" style="padding:0 0 0 5;line:1 none transparent transparent;background:EXPR(gfn_isNull(KEY) ? &quot;#DDFCDB&quot; : (Z4 == '1' ? &quot;lightskyblue&quot;:&quot;white&quot;));background2:EXPR(gfn_isNull(KEY) ? &quot;#DDFCDB&quot; : (Z4 == '1' ? &quot;lightskyblue&quot;:&quot;white&quot;));color:EXPR(!gfn_isNull(C2) ? &quot;C2&quot; : &quot;black&quot;);" text="bind:M4"/>
                          <Cell col="6" displaytype="number" style="padding:0 3 0 0;line:1 none transparent transparent;background:EXPR(!gfn_isNull(C4) ? C4 : gfn_isNull(KEY) ? &quot;#DDFCDB&quot; : &quot;whitesmoke&quot;);background2:EXPR(!gfn_isNull(C4) ? C4 : gfn_isNull(KEY) ? &quot;#DDFCDB&quot; : &quot;whitesmoke&quot;);" text="bind:P4"/>
                          <Cell col="7" displaytype="text" style="padding:0 0 0 5;line:1 none transparent transparent;background:EXPR(gfn_isNull(KEY) ? &quot;#DDFCDB&quot; : (Z5 == '1' ? &quot;lightskyblue&quot;:&quot;white&quot;));background2:EXPR(gfn_isNull(KEY) ? &quot;#DDFCDB&quot; : (Z5 == '1' ? &quot;lightskyblue&quot;:&quot;white&quot;));color:EXPR(!gfn_isNull(C2) ? &quot;C2&quot; : &quot;black&quot;);" text="bind:M5"/>
                          <Cell col="8" displaytype="number" style="padding:0 3 0 0;line:1 none transparent transparent;background:EXPR(!gfn_isNull(C5) ? C5 : gfn_isNull(KEY) ? &quot;#DDFCDB&quot; : &quot;whitesmoke&quot;);background2:EXPR(!gfn_isNull(C5) ? C5 : gfn_isNull(KEY) ? &quot;#DDFCDB&quot; : &quot;whitesmoke&quot;);" text="bind:P5"/>
                          <Cell col="9" displaytype="text" style="padding:0 0 0 5;line:1 none transparent transparent;background:EXPR(gfn_isNull(KEY) ? &quot;#DDFCDB&quot; : (Z6 == '1' ? &quot;lightskyblue&quot;:&quot;white&quot;));background2:EXPR(gfn_isNull(KEY) ? &quot;#DDFCDB&quot; : (Z6 == '1' ? &quot;lightskyblue&quot;:&quot;white&quot;));color:EXPR(!gfn_isNull(C2) ? &quot;C2&quot; : &quot;black&quot;);" text="bind:M6"/>
                          <Cell col="10" displaytype="number" style="padding:0 3 0 0;line:1 none transparent transparent;background:EXPR(!gfn_isNull(C6) ? C6 : gfn_isNull(KEY) ? &quot;#DDFCDB&quot; : &quot;whitesmoke&quot;);background2:EXPR(!gfn_isNull(C6) ? C6 : gfn_isNull(KEY) ? &quot;#DDFCDB&quot; : &quot;whitesmoke&quot;);" text="bind:P6"/>
                          <Cell col="11" displaytype="text" style="padding:0 0 0 5;line:1 none transparent transparent;background:EXPR(gfn_isNull(KEY) ? &quot;#DDFCDB&quot; : (Z7 == '1' ? &quot;lightskyblue&quot;:&quot;white&quot;));background2:EXPR(gfn_isNull(KEY) ? &quot;#DDFCDB&quot; : (Z7 == '1' ? &quot;lightskyblue&quot;:&quot;white&quot;));color:EXPR(!gfn_isNull(C2) ? &quot;C2&quot; : &quot;black&quot;);" text="bind:M7"/>
                          <Cell col="12" displaytype="number" style="padding:0 3 0 0;line:1 none transparent transparent;background:EXPR(!gfn_isNull(C7) ? C7 : gfn_isNull(KEY) ? &quot;#DDFCDB&quot; : &quot;whitesmoke&quot;);background2:EXPR(!gfn_isNull(C7) ? C7 : gfn_isNull(KEY) ? &quot;#DDFCDB&quot; : &quot;whitesmoke&quot;);" text="bind:P7"/>
                          <Cell col="13" displaytype="text" style="padding:0 0 0 5;line:1 none transparent transparent;background:EXPR(gfn_isNull(KEY) ? &quot;#DDFCDB&quot; : (Z1 == '1' ? &quot;lightskyblue&quot;:&quot;white&quot;));background2:EXPR(gfn_isNull(KEY) ? &quot;#DDFCDB&quot; : (Z1 == '1' ? &quot;lightskyblue&quot;:&quot;white&quot;));color:EXPR(!gfn_isNull(C2) ? &quot;C2&quot; : &quot;black&quot;);" text="bind:M1"/>
                          <Cell col="14" displaytype="number" style="padding:0 3 0 0;line:1 none transparent transparent;background:EXPR(!gfn_isNull(C1) ? C1 : gfn_isNull(KEY) ? &quot;#DDFCDB&quot; : &quot;whitesmoke&quot;);background2:EXPR(!gfn_isNull(C1) ? C1 : gfn_isNull(KEY) ? &quot;#DDFCDB&quot; : &quot;whitesmoke&quot;);" text="bind:P1"/>
                        </Band>
                        <Band id="summary">
                          <Cell style="align:center;" text="평균원가"/>
                          <Cell col="1" colspan="2" taborder="undefined"/>
                          <Cell col="3" colspan="2" taborder="undefined"/>
                          <Cell col="5" colspan="2" taborder="undefined"/>
                          <Cell col="7" colspan="2" taborder="undefined"/>
                          <Cell col="9" colspan="2" taborder="undefined"/>
                          <Cell col="11" colspan="2" taborder="undefined"/>
                          <Cell col="13" colspan="2" taborder="undefined"/>
                        </Band>
                      </Format>
                    </Formats>
                  </Grid>
                  <Static id="Static12" text="주간 목표식재료율" class="sta_WFDA_Label01" position="absolute 10 10 131 37" anchor="left top" style="background:lavender;font:Gulim,9;"/>
                  <Static id="Static16" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 10 37 1225 42"/>
                  <Button id="btn_copyMenu" taborder="3" text="식단복사" class="btn_WF_Function" position="absolute 857 17 922 37" anchor="top right" onclick="tab_menu_tabpage2_btn_copyMenu_onclick"/>
                  <Button id="btn_myRecipe" taborder="4" text="MY 레시피구성" class="btn_WF_Function" position="absolute 924 17 1024 37" anchor="top right" onclick="tab_menu_tabpage2_btn_myRecipe_onclick"/>
                  <Button id="btn_nutAnalysis" taborder="5" text="영양분석" class="btn_WF_Function" position="absolute 1026 17 1091 37" anchor="top right" onclick="tab_menu_tabpage2_btn_nutAnalysis_onclick"/>
                  <Button id="btn_excel" taborder="6" text="Excel" class="btn_WF_Function" position="absolute 1093 17 1158 37" anchor="top right" onclick="tab_menu_tabpage2_btn_excel_onclick"/>
                  <Button id="btn_eval" taborder="7" text="식단평가" class="btn_WF_Function" position="absolute 1160 17 1225 37" anchor="top right" onclick="tab_menu_tabpage2_btn_eval_onclick"/>
                  <Static id="Static02" text="주간 예상식재료율" class="sta_WFDA_Label01" position="absolute 199 10 320 37" anchor="left top" style="background:lavender;font:Gulim,9;"/>
                  <Static id="Static61" text="h08" class="Guide01_AreaRed" visible="false" position="absolute 10 514 1225 522" anchor="left top"/>
                  <Static id="Static44" text="오른쪽 버튼 : MY레시피등록" class="sta_WF_DiscInfo" position="absolute 10 529 216 544" anchor="left bottom"/>
                  <Static id="Static03" text="왼쪽 버튼 : 레시피검색 및 등록/수정" class="sta_WF_DiscInfo" position="absolute 218 529 463 544" anchor="left bottom"/>
                  <Button id="btn_po" taborder="9" text="구매신청" class="btn_WF_Function" position="absolute 790 17 855 37" anchor="top right" onclick="tab_menu_tabpage2_btn_po_onclick"/>
                  <Edit id="edt_goalCostRate" taborder="12" position="absolute 130 10 200 37" readonly="true" style="color:blue;padding:1 10 0 5;align:right middle;font:Gulim,9,bold;"/>
                  <Edit id="edt_exptCostRate" taborder="13" position="absolute 319 10 389 37" readonly="true" style="color:blue;padding:1 10 0 5;align:right middle;font:Gulim,9,bold;"/>
                  <Edit id="edt_resultRate" taborder="14" readonly="true" position="absolute 487 10 589 37" style="padding:1 10 0 5;align:right middle;font:Gulim,9,bold;"/>
                  <Static id="Static17" text="달성율" class="sta_WFDA_Label01" position="absolute 388 10 488 37" anchor="left top" style="background:lavender;font:Gulim,9;"/>
                  <Static id="Static13" class="sta_WFDA_Labelbg" position="absolute 1049 522 1225 549" anchor="right bottom" visible="true" onclick="tab_menu_tabpage2_Static13_onclick"/>
                  <Button id="btn_costReflash" taborder="15" text="원가갱신" class="btn_WF_Function" position="absolute 1157 525 1222 545" anchor="right bottom" onclick="tab_menu_tabpage2_btn_costReflash_onclick" visible="true"/>
                  <ObjCalendar id="cal_costReflash" anchor="right bottom" titletext="캘린더" taborder="16" scrollbars="none" position="absolute 1052 525 1155 546" visible="true"/>
                  <Static id="Static05" text="원가 갱신일" class="sta_WFDA_Label01" position="absolute 964 522 1050 549" anchor="right bottom" style="background:lavender;font:Gulim,9;" visible="true"/>
                  <Button id="btn_menuGuid" taborder="17" text="메뉴지도" class="btn_WF_Function" position="absolute 632 17 697 37" anchor="top right" visible="false" onclick="tab_menu_tabpage2_btn_menuGuid_onclick"/>
                  <Button id="btn_menuCreate" taborder="18" text="식단일괄생성" onclick="btn_menuCreate_onclick" class="btn_WF_Function" position="absolute 699 17 788 37" anchor="top right"/>
                </Layout>
              </Layouts>
            </Tabpage>
          </Tabpages>
        </Tab>
        <Static id="Static41" text="원가는 입고예정일 기준 사업장 원가입니다." class="sta_WF_DiscInfo" position="absolute 957 689 1237 704" anchor="right bottom"/>
        <Static id="Static12" text="계획 식재료율 (%)" class="sta_WFDA_Label01" position="absolute 0 683 136 710" anchor="left bottom" style="background:lavender;font:Gulim,9;"/>
        <Static id="Static09" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 0 670 1237 683"/>
        <Div id="div_eval" anchor="top right" taborder="17" url="U_FSM::FSM90011P.xfdl" scrollbars="none" visible="false" position="absolute 676 152 1226 652"/>
        <Static id="Static02" text="실적 식재료율 (%)" class="sta_WFDA_Label01" position="absolute 250 683 386 710" anchor="left bottom" style="background:lavender;font:Gulim,9;"/>
        <Static id="Static11" text="달성율 (%P)" class="sta_WFDA_Label01" position="absolute 500 683 644 710" anchor="left bottom" style="background:lavender;font:Gulim,9;"/>
        <Static id="Static13" text="팀" class="sta_WFSA_label" position="absolute 15 41 75 62" anchor="left top"/>
        <TmSearchComponent id="edt_tm" titletext="팀 검색용 Component" taborder="0" text="TmSearchComponent00" position="absolute 44 40 183 61" bindDataset="" bindTmCdColumn="" bindTmNmColumn="" qoBuCd="" qoMuCd="" qoUseYn="" eventAfterTrigger="fn_tmChange" eventBeforeTrigger=""/>
        <Static id="Static16" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 183 40 213 61" anchor="left top"/>
        <Static id="Static17" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 34 40 44 61" anchor="left top"/>
        <MuSearchComponent id="cbo_mu" titletext="사업부 선택 Component" taborder="22" text="MuSearchComponent00" position="absolute 999 40 1144 61" bindDataset="" bindMuCdColumn="" appendText="" onItemChangedEvent="" visible="false"/>
        <Button id="btn_next" taborder="23" class="btn_WF_rightMove" position="absolute 1217 83 1237 103" onclick="btn_next_onclick" anchor="top right"/>
        <Button id="btn_prev" taborder="24" class="btn_WF_leftMove" position="absolute 1194 83 1214 103" onclick="btn_prev_onclick" anchor="top right"/>
        <Edit id="edt_rate03" taborder="25" position="absolute 643 683 759 710" readonly="true" enable="false" anchor="left bottom" style=":disabled {align:center middle;font:Gulim,9,bold;}"/>
        <Edit id="edt_rate02" taborder="26" readonly="true" enable="false" position="absolute 385 683 501 710" anchor="left bottom" style=":disabled {align:center middle;font:Gulim,9,bold;}"/>
        <Edit id="edt_rate01" taborder="27" readonly="true" enable="false" position="absolute 135 683 251 710" anchor="left bottom" style=":disabled {align:center middle;font:Gulim,9,bold;}"/>
        <Static id="sta_info" position="absolute 230 88 695 113"/>
        <Button id="btn_searchRate" taborder="28" text="식재료율조회" class="btn_WF_Function" position="absolute 764 686 853 706" anchor="left bottom" onclick="btn_searchRate_onclick"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_cboHall" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="HALL_CD" type="STRING" size="256"/>
          <Column id="HALL_NAME" type="STRING" size="256"/>
          <Column id="SUBINV_CODE" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cond" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" onvaluechanged="ds_cond_onvaluechanged">
        <ColumnInfo>
          <Column id="UPJANG" type="STRING" size="256"/>
          <Column id="UPJANGNM" type="STRING" size="256"/>
          <Column id="HALL_CD" type="STRING" size="256"/>
          <Column id="HALL_NM" type="STRING" size="256"/>
          <Column id="MENU_DATE" type="STRING" size="256"/>
          <Column id="MENU_SDATE" type="STRING" size="256"/>
          <Column id="MENU_EDATE" type="STRING" size="256"/>
          <Column id="EMP_NO" type="STRING" size="256"/>
          <Column id="SUBINV_CODE" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_headList" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_bodyList" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_menuList" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="KEY" type="STRING" size="256"/>
          <Column id="MENU_CD" type="STRING" size="256"/>
          <Column id="SGBN" type="STRING" size="256"/>
          <Column id="SGBN_NM" type="STRING" size="256"/>
          <Column id="CGBN_CD" type="STRING" size="256"/>
          <Column id="CGBN" type="STRING" size="256"/>
          <Column id="SSEQ" type="STRING" size="256"/>
          <Column id="SALE_PRICE" type="BIGDECIMAL" size="256"/>
          <Column id="M2" type="STRING" size="256"/>
          <Column id="M3" type="STRING" size="256"/>
          <Column id="M4" type="STRING" size="256"/>
          <Column id="M5" type="STRING" size="256"/>
          <Column id="M6" type="STRING" size="256"/>
          <Column id="M7" type="STRING" size="256"/>
          <Column id="M1" type="STRING" size="256"/>
          <Column id="P2" type="BIGDECIMAL" size="256"/>
          <Column id="P3" type="BIGDECIMAL" size="256"/>
          <Column id="P4" type="BIGDECIMAL" size="256"/>
          <Column id="P5" type="BIGDECIMAL" size="256"/>
          <Column id="P6" type="BIGDECIMAL" size="256"/>
          <Column id="P7" type="BIGDECIMAL" size="256"/>
          <Column id="P1" type="BIGDECIMAL" size="256"/>
          <Column id="T2" type="STRING" size="256"/>
          <Column id="T3" type="STRING" size="256"/>
          <Column id="T4" type="STRING" size="256"/>
          <Column id="T5" type="STRING" size="256"/>
          <Column id="T6" type="STRING" size="256"/>
          <Column id="T7" type="STRING" size="256"/>
          <Column id="T1" type="STRING" size="256"/>
          <Column id="D2" type="STRING" size="256"/>
          <Column id="D3" type="STRING" size="256"/>
          <Column id="D4" type="STRING" size="256"/>
          <Column id="D5" type="STRING" size="256"/>
          <Column id="D6" type="STRING" size="256"/>
          <Column id="D7" type="STRING" size="256"/>
          <Column id="D1" type="STRING" size="256"/>
          <Column id="C2" type="STRING" size="256"/>
          <Column id="C3" type="STRING" size="256"/>
          <Column id="C4" type="STRING" size="256"/>
          <Column id="C5" type="STRING" size="256"/>
          <Column id="C6" type="STRING" size="256"/>
          <Column id="C7" type="STRING" size="256"/>
          <Column id="C1" type="STRING" size="256"/>
          <Column id="Q2" type="STRING" size="256"/>
          <Column id="Q3" type="STRING" size="256"/>
          <Column id="Q4" type="STRING" size="256"/>
          <Column id="Q5" type="STRING" size="256"/>
          <Column id="Q6" type="STRING" size="256"/>
          <Column id="Q7" type="STRING" size="256"/>
          <Column id="Q1" type="STRING" size="256"/>
          <Column id="S2" type="STRING" size="256"/>
          <Column id="S3" type="STRING" size="256"/>
          <Column id="S4" type="STRING" size="256"/>
          <Column id="S5" type="STRING" size="256"/>
          <Column id="S6" type="STRING" size="256"/>
          <Column id="S7" type="STRING" size="256"/>
          <Column id="S1" type="STRING" size="256"/>
          <Column id="Z2" type="STRING" size="256"/>
          <Column id="Z3" type="STRING" size="256"/>
          <Column id="Z4" type="STRING" size="256"/>
          <Column id="Z5" type="STRING" size="256"/>
          <Column id="Z6" type="STRING" size="256"/>
          <Column id="Z7" type="STRING" size="256"/>
          <Column id="Z1" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_mealQtyBodyList" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_realMealQtyList" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="DAYS" type="STRING" size="256"/>
          <Column id="WDESC" type="STRING" size="256"/>
          <Column id="REAL_MEAL_QTY" type="STRING" size="256"/>
          <Column id="SIKDAN" type="STRING" size="256"/>
          <Column id="MENU_FEATURE" type="STRING" size="256"/>
          <Column id="SCHEDULE" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_mealQtyList" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="KEY" type="STRING" size="256"/>
          <Column id="TERM_MENU_CD" type="STRING" size="256"/>
          <Column id="SGBN" type="STRING" size="256"/>
          <Column id="SGBN_NM" type="STRING" size="256"/>
          <Column id="CGBN_CD" type="STRING" size="256"/>
          <Column id="CGBN" type="STRING" size="256"/>
          <Column id="SSEQ" type="STRING" size="256"/>
          <Column id="Q2" type="BIGDECIMAL" size="256"/>
          <Column id="Q3" type="BIGDECIMAL" size="256"/>
          <Column id="Q4" type="BIGDECIMAL" size="256"/>
          <Column id="Q5" type="BIGDECIMAL" size="256"/>
          <Column id="Q6" type="BIGDECIMAL" size="256"/>
          <Column id="Q7" type="BIGDECIMAL" size="256"/>
          <Column id="Q1" type="BIGDECIMAL" size="256"/>
          <Column id="D2" type="STRING" size="256"/>
          <Column id="D3" type="STRING" size="256"/>
          <Column id="D4" type="STRING" size="256"/>
          <Column id="D5" type="STRING" size="256"/>
          <Column id="D6" type="STRING" size="256"/>
          <Column id="D7" type="STRING" size="256"/>
          <Column id="D1" type="STRING" size="256"/>
          <Column id="L2" type="STRING" size="256"/>
          <Column id="L3" type="STRING" size="256"/>
          <Column id="L4" type="STRING" size="256"/>
          <Column id="L5" type="STRING" size="256"/>
          <Column id="L6" type="STRING" size="256"/>
          <Column id="L7" type="STRING" size="256"/>
          <Column id="L1" type="STRING" size="256"/>
          <Column id="O2" type="STRING" size="256"/>
          <Column id="O3" type="STRING" size="256"/>
          <Column id="O4" type="STRING" size="256"/>
          <Column id="O5" type="STRING" size="256"/>
          <Column id="O6" type="STRING" size="256"/>
          <Column id="O7" type="STRING" size="256"/>
          <Column id="O1" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_goalCostRate">
        <ColumnInfo>
          <Column id="UPJANG" size="256" type="STRING"/>
          <Column id="HALL_CD" size="256" type="STRING"/>
          <Column id="MENU_DATE" size="256" type="STRING"/>
          <Column id="GOAL_COST_RATE" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_costRate">
        <ColumnInfo>
          <Column id="RMK" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_sgbn">
        <ColumnInfo>
          <Column id="SGBN" size="256" type="STRING"/>
          <Column id="SGBN_NM" size="256" type="STRING"/>
          <Column id="CGBN" size="256" type="STRING"/>
          <Column id="CGBN_NM" size="256" type="STRING"/>
          <Column id="CGBN_CD" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_return">
        <ColumnInfo>
          <Column id="RTN" size="256" type="STRING"/>
          <Column id="RTNMSG" size="256" type="STRING"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="RTN"/>
            <Col id="RTNMSG"/>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_input">
        <ColumnInfo>
          <Column id="UPJANG" size="256" type="STRING"/>
          <Column id="SDATE" size="256" type="STRING"/>
          <Column id="O_RTN" size="256" type="STRING"/>
          <Column id="O_RTNMSG" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_sikck"/>
      <Dataset id="ds_subSum" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="WEEK" type="STRING" size="256"/>
          <Column id="SGBN" type="STRING" size="256"/>
          <Column id="CGBN_CD" type="STRING" size="256"/>
          <Column id="SD_WON" type="BIGDECIMAL" size="256"/>
          <Column id="MEAL_QTY" type="BIGDECIMAL" size="256"/>
          <Column id="SALE_PRICE" type="BIGDECIMAL" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_menuGuid" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="GUID_YEAR" type="STRING" size="256"/>
          <Column id="GUID_SEQ" type="STRING" size="256"/>
          <Column id="REQ_NUM" type="STRING" size="256"/>
          <Column id="SDATE" type="STRING" size="256"/>
          <Column id="EDATE" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_rateMonth" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="PLAN_RATE" type="STRING" size="256"/>
          <Column id="RESULT_RATE" type="STRING" size="256"/>
          <Column id="DIFF_RATE" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_enfUpjangList" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="UPJANG" type="STRING" size="256"/>
          <Column id="START_DD" type="STRING" size="256"/>
          <Column id="END_DD" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Bind>
      <BindItem id="item0" compid="cbo_hall" propid="value" datasetid="ds_cond" columnid="HALL_CD"/>
      <BindItem id="item1" compid="edt_rate03" propid="value" datasetid="ds_rateMonth" columnid="DIFF_RATE"/>
      <BindItem id="item3" compid="edt_rate02" propid="value" datasetid="ds_rateMonth" columnid="RESULT_RATE"/>
      <BindItem id="item2" compid="edt_rate01" propid="value" datasetid="ds_rateMonth" columnid="PLAN_RATE"/>
    </Bind>
    <Script type="xscript4.0"><![CDATA[include "U_lib::lib_conversionCom.xjs";

/******************************************************************************************
 * 시스템구분 : 메뉴관리/식단관리
 * 프로그램명 : FSM90030E.XML
 * 기ㅡㅡㅡ능 : 식단등록(일반식)
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************/

//=========================================================================================
// [ PART 1 ]
// Form에서 Include 할 내용을 정의
//
//=========================================================================================

//=========================================================================================
// [ PART 2 ]
// Form에서 사용될 전역변수를 선언
//
//=========================================================================================
var menuCnt    = 0;	          // 식단등록 수
var salePriceSum = 0;         // 식단판매가
var isEvalShow = false;       // 식단평가 팝업 여부
var fa_PFormID = "FSM90030E"  // 식단평가 팝업에서 분기 조건으로 사용

//=========================================================================================
// [ PART 3 ]
// Form Loading 시 작업 정의
//
//=========================================================================================
function form_onload(obj:Form, e:LoadEventInfo)
{
	gfn_formOnLoad(this);

	// X-Framework : Action 정보 생성
	fsp_init(this);
	
	// 초기화
	fn_init();
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_init()
 * 기ㅡㅡㅡ능 : 초기화
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_init()
{
	// 조회조건 초기화
	ds_cond.clearData();
	ds_cond.addRow();

	// 권한처리
	edt_tm.applyAuthLevel(cbo_mu);
	edt_upjang.applyAuthLevel(edt_tm);

	// 전주예상식수복사 초기화
	tab_menu.tabpage1.btn_copyMealQty.visible = false;

	// 공통코드 조회
	var v_fil_cond;
	var v_ds = fn_common_code("'FS0029','FS0030','FS0031','FS0023'","","","non","Y");
	
	// 제공일 초기화
	cal_menuDate.fn_initMonthCal(this, gfn_today(), "", ds_cond, "MENU_DATE", "Y");
	
	// 원가갱신일
	tab_menu.tabpage2.cal_costReflash.fn_initMonthCal(this, gfn_addDate(gfn_today(), 1), "", "", "", "");
	
	// 업장코드가 존재할 경우 식당조회
	if(!gfn_isNull(ds_cond.getColumn(0, "UPJANG")))
	{
		fn_hallSearch();
	}
	
	// 그룹레시피 대상사업장 체크
	fn_checkEnfUpjang();
	
	// 식재료율 조회
	//fn_getRateMonth();
}

function fn_getRateMonth()
{
	// 식재료율 조회
	var ActionVal	= "";
	ActionVal += "UPJANG="		+ wrapQuote(ds_cond.getColumn(0, "UPJANG"));
	ActionVal += " START_DATE="	+ wrapQuote(gfn_getFirstDate(ds_cond.getColumn(0, "MENU_SDATE")));
	ActionVal += " END_DATE="	+ wrapQuote(gfn_getLastDate(ds_cond.getColumn(0, "MENU_SDATE")));
	
	Transaction("FSM90900E_S001","U_svc::" + "fs/fsm/FSM90900E_S001.jsp", "", "ds_rateMonth=ds_rateMonth", ActionVal, "fn_searchRateMonth");
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_checkEnfUpjang()
 * 기ㅡㅡㅡ능 : 그룹레시피 대상업장 여부 조회
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_checkEnfUpjang()
{
	ds_enfUpjangList.clearData();
	
	fsp_clear(this);
	fsp_addSearch(this, "fs/fsr:FSR90120E_S002");	// 그룹레시피 대상사업장 여부조회
	fsp_callService(this, "", "", "ds_cond=ds_cond", "ds_enfUpjangList=ds_list", "", "fn_callbackCheckEnfUpjang");
}

function fn_callbackCheckEnfUpjang()
{
	if(ds_enfUpjangList.getRowCount() > 0)
	{
		sta_info.class = "sta_WF_DiscInfo";
		sta_info.text = "그룹레시피 기간 : " + gfn_getFormat(ds_enfUpjangList.getColumn(0, "START_DATE"), '@@@@년 @@월 @@일') + " ~ " + gfn_getFormat(ds_enfUpjangList.getColumn(0, "END_DATE"), '@@@@년 @@월 @@일');
		tab_menu.tabpage2.btn_menuCreate.enable = false;    // 식단일괄생성
		//tab_menu.tabpage2.btn_copyMenu.enable = false;      // 식단복사
		tab_menu.tabpage2.btn_copyMenu.enable = true;      // 식단복사
		tab_menu.tabpage2.btn_myRecipe.enable = false;      // MY레시피 구성
	}
	else
	{
		sta_info.class = "";
		sta_info.text = "";
		tab_menu.tabpage2.btn_menuCreate.enable = true;     // 식단일괄생성
		tab_menu.tabpage2.btn_copyMenu.enable = true;      // 식단복사
		tab_menu.tabpage2.btn_myRecipe.enable = true;      // MY레시피 구성
	}
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_initData()
 * 기ㅡㅡㅡ능 : 화면 초기화
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_initData() {

	// 그리드 데이터 초기화
	ds_mealQtyList.clearData();		// 식수예측
	ds_realMealQtyList.clearData();	// 4주간 실식수
	ds_menuList.clearData();		// 식단
	
	// Text 초기화
	tab_menu.tabpage1.edt_goalCostRate.value = "";
	tab_menu.tabpage2.edt_goalCostRate.value = "";
	tab_menu.tabpage2.edt_exptCostRate.value = "";
	tab_menu.tabpage2.edt_resultRate.value = "";
	
	// 전주예상식수복사 초기화
	tab_menu.tabpage1.btn_copyMealQty.visible = false;
}

//=========================================================================================
// [ PART 4 ]
// Main Process Event 정의(조회,입력,삭제,저장,출력)
//
//=========================================================================================
/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_search()
 * 기ㅡㅡㅡ능 : 조회
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_search()
{
	// 업장 체크
	if(gfn_isNull(ds_cond.getColumn(0, "UPJANG")))
	{
		g_Message("EE",	"업장을 입력해주세요.");
		return;
	}

	// 식당 체크
	if(gfn_isNull(ds_cond.getColumn(0, "HALL_CD")))
	{
		g_Message("EE",	"식당을 선택해주세요.");
		return;
	}

	// 식단제공일 필수 체크
	if(gfn_isNull(ds_cond.getColumn(0, "MENU_DATE")))
	{
		g_Message("EE",	"식단 제공일을 입력해주세요.");
		return;
	}

	// 정보 조회
	fn_dataSearch();
}

function fn_callback(errCode, errMsg) 
{
	if(errCode!=0)
	{
		g_Message("EE", "서비스 오류:시스템 관리자에게 문의하십시오!");
		return;
	}
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_save()
 * 기ㅡㅡㅡ능 : 저장
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_save()
{
	if (ds_mealQtyList.getRowCount() <= 0) {
		g_Message("EE",	"저장할 데이터가 없습니다.");
		return;
	}

	var nGoalCostRate = tab_menu.tabpage1.edt_goalCostRate.value;
	if ((gfn_length(gfn_trim(nGoalCostRate)) <= 0) || (toNumber(nGoalCostRate) <= 0))
	{
		g_Message("EE",	"[주간 목표식재료율]을 입력하세요!");
		tab_menu.tabpage1.edt_goalCostRate.setFocus();
		return;
	}

	// 원본 데이터셋에 그리드 데이터셋 정보를 세팅한다.
	var nMealQty = 0;
	var nRow = -1;
	var sCond = "";
	var sWeek = "";
	for(var i=0; i < ds_mealQtyList.getRowCount(); i++) {
		for(var j=0; j < ds_headList.getRowCount(); j++) {
			
			sWeek = ds_headList.getColumn(j, "WEEK");
			
			// 원본 데이터에서 아래 조건의 정보를 찾는다.
			sCond = "FDAY=='" + ds_headList.getColumn(j, "FDAY")
	              + "'&&SGBN=='" + ds_mealQtyList.getColumn(i, "SGBN")
	              + "'&&CGBN=='" + ds_mealQtyList.getColumn(i, "CGBN")
	              + "'&&CGBN_CD=='" + ds_mealQtyList.getColumn(i, "CGBN_CD") + "'";

			nRow = ds_mealQtyBodyList.findRowExpr(sCond);
			
			// 예상 식수
			nMealQty = ds_mealQtyList.getColumn(i, "Q" + sWeek);
			
			// 예상식수 정보가 0이거나 공백일 경우 원본데이터 삭제
			if (nMealQty == 0 || gfn_length(nMealQty) <= 0) 
			{
				ds_mealQtyBodyList.deleteRow(nRow);
			}
			else 
			{
				ds_mealQtyBodyList.setColumn(nRow, "EXPECT_MEAL_QTY", ds_mealQtyList.getColumn(i, "Q" + sWeek));	// 예상식수
				ds_mealQtyBodyList.setColumn(nRow, "GOAL_COST_RATE", nGoalCostRate);	// 목표식재료율
			}
		}
	}
	
	// 변경된 주간식단목표 식재료율을 setting 한다. 2008-01-07 추가됨
	for(var i=0; i < ds_goalCostRate.getRowCount(); i++) {
		ds_goalCostRate.setColumn(i, "GOAL_COST_RATE", nGoalCostRate);
	}
	
	/*
	// 기존 코드가 20080701이전 데이터를 삭제하게 되어 있는데 필요하실 경우 주석 해제해 주세요.
	for (i=ds_mealQtyBodyList.rowcount; i >= 0 ; i--) {
		if ( ds_mealQtyBodyList.getColumn(i, "FDAY") < "20080701" ) {
			ds_mealQtyBodyList.deleteRow(i);
		}
	}
	*/
	
	ds_cond.setColumn(0, "EMP_NO", g_EmpNo);
    var actionName, cmdName, inData, outData, otherArg, callBackFnc;
    var selectSqlId, notFoundSql, foundSql, saveFlagColumn, keySqlName, keyIncrement, callbackSql;
    var	insertSql, updateSql, deleteSql;

	// 주간목표식재료율 저장
	inData		= "ds_sikrate=ds_goalCostRate:A ds_input=ds_cond";
	outData		= "";
	callBackFnc	= "fn_callbackSave";
	selectSqlId = "fs/fsm:FSM00051E_S005";		// 데이타있는지 체크 sql
	notFoundSql	= "fs/fsm:FSM00051E_I002";		// insert sql
	foundSql	= "fs/fsm:FSM00051E_U002";		// update sql	
	callbackSql	= "";							// callback sql
	
	fsp_clear(this);
	fsp_addSelectExecute(this, selectSqlId, notFoundSql, foundSql);
    
	http.Sync = true;
	fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);
	http.Sync = false;
	
	// 주간식수예측 저장
	inData		= "DS_body1=ds_mealQtyBodyList:A ds_input=ds_cond";
	outData		= "";
	callBackFnc	= "fn_callbackSave";
	selectSqlId = "fs/fsm:FSM00051E_S004";		// 데이타있는지 체크 sql
	notFoundSql	= "fs/fsm:FSM00051E_I001";		// insert sql
	foundSql	= "fs/fsm:FSM00051E_U001";		// update sql	
	callbackSql	= "";							// callback sql(재조회)
	
	insertSql	= "";							// insertSql
	updateSql	= "";							// updateSql
	deleteSql	= "fs/fsm:FSM00051E_D001";		// deleteSql 임시로 명희씨랑 애기중 (2008.06.09)
	
	fsp_clear(this);
	fsp_addSelectExecute(this, selectSqlId, notFoundSql, foundSql);
	fsp_addSave(this, insertSql, updateSql, deleteSql, saveFlagColumn, keySqlName, keyIncrement, callbackSql);
    
	http.Sync = true;
	fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);
	http.Sync = false;
	
	// 재조회
	fn_search();
}

function fn_callbackSave(errCode, errMsg) 
{
	if(errCode!=0)
	{
		g_Message("EE", "서비스 오류:시스템 관리자에게 문의하십시오!");
		return;
	}
}

//=========================================================================================
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
//
//=========================================================================================
/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_dataSearch()
 * 기ㅡㅡㅡ능 : 정보 조회 (일자, 날씨정보, 식수예측, 4주간 실식수)
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_dataSearch()
{
	// 데이터 초기화
	fn_initData();

	// 주(Week)의 시작일, 종료일 세팅
	fn_setPeriodOfWeek(ds_cond.getColumn(0, "MENU_DATE"));

	ds_headList.clearData();
	ds_mealQtyBodyList.clearData();
	fsp_clear(this); 
    fsp_addSearch(this, "fs/fsm:FSM00020E_S002");  // 헤더 정보
    fsp_addSearch(this, "fs/fsm:FSM00052E_S001");  // 끼니-코너 정보
    fsp_addSearch(this, "fs/fsm:FSM00051E_S003");  // 식수예측 조회
    fsp_addSearch(this, "fs/fsm:FSM00051E_S002");  // 식당목표식재료율(주간)
    //fsp_addSearch(this, "fs/fsm:FSM00050E_S002");  // 식재료율
    fsp_addSearch(this, "fs/fsm:FSM00051E_S006");  // 제공일에 해당하는 주의 식수예측
    fsp_addSearch(this, "fs/fsm:FSM90030E_S002");  // 메뉴지도신청정보
    fsp_addSearch(this, "fs/fsr:FSR90120E_S002");  // 그룹레시피 대상사업장 여부조회
	fsp_callService(this, "", "", "ds_cond=ds_cond ds_input=ds_cond", "ds_headList=DS_head ds_sgbn=DS_sgbn ds_mealQtyBodyList=DS_body1 ds_goalCostRate=ds_sikrate ds_costRate=ds_sik ds_sikck=ds_sikck ds_menuGuid=ds_menuGuid ds_enfUpjangList=ds_list", "", "fn_callbackDataSearch");
	
	// 식단정보 조회
	var ActionVal	= "";
	ActionVal += "UPJANG="		+ wrapQuote(ds_cond.getColumn(0, "UPJANG"));
	ActionVal += " HALL_CD="	+ wrapQuote(ds_cond.getColumn(0, "HALL_CD"));
	ActionVal += " MENU_SDATE="	+ wrapQuote(ds_cond.getColumn(0, "MENU_SDATE"));
	
	http.Sync = true;
	Transaction("FSM00052E_S003","U_svc::" + "fs/fsm/FSM00052E_S003.jsp", "", "ds_bodyList=DS_body", ActionVal, "");
	http.Sync = false;	
}

function fn_callbackDataSearch(errCode, errMsg) 
{
	if(errCode!=0)
	{
		g_Message("EE", "서비스 오류:시스템 관리자에게 문의하십시오!");
		return;
	}
	else
	{
		// 끼니, 코너 정보가 없을 경우 오류 메시지 처리
		if(ds_mealQtyBodyList.getRowCount() == 0)
		{
			g_Message("EE",	"해당 식당의 끼니, 코너정보가 등록되어 있지 않습니다.\n식단기본정보설정 메뉴에서 등록하신 후 처리하시기 바랍니다.");
			return;
		}
		
		// 식수예측 그리드 데이터 세팅
		fn_setMealQtyGridData(tab_menu.tabpage1.grd_mealQtyList, ds_mealQtyList, ds_headList, ds_mealQtyBodyList);
		
		// 식단등록 그리드 데이터 세팅
		fn_setMenuGridData(tab_menu.tabpage2.grd_menuList, ds_menuList, ds_headList, ds_bodyList);
		
		// 해당 주의 식수가 존재할 경우 예상식수 복사기능을 막는다.
		if (ds_sikck.getRowCount() > 0) 
		{
			tab_menu.tabpage1.btn_copyMealQty.visible = false;
		}
		else 
		{
			tab_menu.tabpage1.btn_copyMealQty.visible = true;
		}

		// 메뉴지도 신청대상업장의 경우 메뉴지도 버튼 활성화
		if(ds_menuGuid.getRowCount() > 0)
		{
			tab_menu.tabpage2.btn_menuGuid.visible = true;
		}
		else
		{
			tab_menu.tabpage2.btn_menuGuid.visible = false;
		}
		
		fn_callbackCheckEnfUpjang();
	
		// 식단평가 DIV 팝업의 날짜버튼 세팅
		div_eval.setBtnDate();
	}
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_searchRateMonth
 * 기ㅡㅡㅡ능 : 하단 식재료율 표시방법 처리 (추후 색상변경이 필요할 경우 사용하세요.)
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_searchRateMonth() 
{
	// 계획식재료율
	if(Number(edt_rate01.value) > 0) edt_rate01.style.color = "black";
	else if(Number(edt_rate01.value) < 0) edt_rate01.style.color = "black";
	else edt_rate01.style.color = "black";
	
	// 실적식재료율
	if(Number(edt_rate02.value) > 0) edt_rate02.style.color = "black";
	else if(Number(edt_rate02.value) < 0) edt_rate02.style.color = "black";
	else edt_rate02.style.color = "black";

	// 달성율
	if(Number(edt_rate03.value) > 0) 
	{
		edt_rate03.style.color = "blue";
	}
	else if(Number(edt_rate03.value) < 0) 
	{
		edt_rate03.style.color = "red";
	}
	else 
	{
		edt_rate03.style.color = "black";
	}
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : function fn_realMealQtySearch(otherArg)
 * 기ㅡㅡㅡ능 : 4주간 실식수 조회
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_realMealQtySearch(otherArg)
{
	ds_realMealQtyList.clearData();
	fsp_clear(this);
	fsp_addSearch(this, "fs/fsm:FSM00051E_S001");
	fsp_callService(this, "", "", "ds_input=ds_cond", "ds_realMealQtyList=ds_view", otherArg, "");
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_hallSearch()
 * 기ㅡㅡㅡ능 : 식당정보 조회
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_hallSearch()
{
	// 그룹레시피 대상사업장 조회
	fn_checkEnfUpjang();

	// 업장이 선택되어 있을 경우에만 조회한다.
	if(gfn_isNull(ds_cond.getColumn(0, "UPJANG"))) {
		ds_cboHall.clearData();
		return;
	}

	// 기존 데이터 초기화
	fn_initData();
	
	var args = "UPJANG=" + wrapQuote(ds_cond.getColumn(0, "UPJANG"));

	fsp_clear(this); 
	fsp_addSearch(this, "fs/fsc:FSA_HALL_MST_S001");  // 식당정보
	fsp_callService(this, "", "", "", "ds_cboHall=gds_Csqlout", args, "fn_callbackHallSearch");
}

function fn_callbackHallSearch(errCode, errMsg) 
{
	if(errCode!=0)
	{
		g_Message("EE", "서비스 오류:시스템 관리자에게 문의하십시오!");
		return;
	}

	// 식재료율 조회
	//fn_getRateMonth();	
	
	// 일반식 식단등록은 아래의 식당군에 대해서만 등록 가능
	// 001:일반식당, 002:학생식당(면세식당), 003:학생식당, 004:푸드코트식당, 006:기타식당
	ds_cboHall.filter("gfn_subStr(HALL_CD,0,3)=='001' || gfn_subStr(HALL_CD,0,3)=='002' || gfn_subStr(HALL_CD,0,3)=='003' || gfn_subStr(HALL_CD,0,3)=='004' || gfn_subStr(HALL_CD,0,3)=='006'");
	cbo_hall.index = 0;
	ds_cond.setColumn(0, "SUBINV_CODE", ds_cboHall.getColumn(cbo_hall.index, "SUBINV_CODE"));
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_setHeader(tabPage, menuObj, headObj)
 * 기ㅡㅡㅡ능 : 헤더 데이터 세팅
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_setHeader(grdObj, dsGrdObj, dsHeadObj, sSecondRowIdx) {

	// 메뉴지도 기간
	var sGuidDate;
	var eGuidDate;
	if(ds_menuGuid.getRowCount() > 0) 
	{
		sGuidDate = Number(ds_menuGuid.getColumn(0, "SDATE"));
		eGuidDate = Number(ds_menuGuid.getColumn(0, "EDATE"));
	}

	var sEnfDate;
	var eEnfDate;
	if(ds_enfUpjangList.getRowCount() > 0)
	{
		sEnfDate = Number(ds_enfUpjangList.getColumn(0, "START_DATE"));
		eEnfDate = Number(ds_enfUpjangList.getColumn(0, "END_DATE"));
	}

	// 헤더 데이터 세팅
	var idx = 0;
	var fDay = "";
	var sDay = "";
	var sImage = "";
	for(var i=0; i < grdObj.getFormatColCount() - 1; i++)
	{
		if(i < 1) continue;
		
		if(i % 2 != 0) 
		{
			// 날짜 세팅
			fDay = dsHeadObj.getColumn(idx, "FDAY");
			sDay = gfn_subStr(fDay, 4, 2) + "/" + gfn_subStr(fDay, 6, 2) + "(" + dsHeadObj.getColumn(idx, "WE") + ")";
			grdObj.setCellProperty("Head", i, "text", sDay);
			
			// 메뉴지도 표시
			if(ds_menuGuid.getRowCount() > 0)
			{
				if(Number(fDay) >= sGuidDate && Number(fDay) <= eGuidDate)
				{
					grdObj.setCellProperty('head', sSecondRowIdx, 'displaytype', 'image'); 
					grdObj.setCellProperty("Head", sSecondRowIdx, "text", "URL('theme://images/new/grd_WF_Pencil.png') middle center");
				}
				else
				{
					grdObj.setCellProperty("Head", sSecondRowIdx, "text", "");
				}
			}
			else
			{
				grdObj.setCellProperty("Head", sSecondRowIdx, "text", "");
			}			
			
			// 그룹레시피 표시
			/*
			if(ds_enfUpjangList.getRowCount() > 0)
			{
				if(Number(fDay) >= sEnfDate && Number(fDay) <= eEnfDate)
				{
					grdObj.setCellProperty("Head", i, "backgroundimage", "URL('theme://images/new/btn_MAIN_QuickBgO.png')");
				}
				else
				{
					grdObj.setCellProperty("Head", i, "backgroundimage", "");
				}
			}
			else
			{
				grdObj.setCellProperty("Head", i, "backgroundimage", "");
			}
			*/
			
			// 날씨 이미지 세팅
			if(!gfn_isNull(dsHeadObj.getColumn(idx, "WIMG")))
			{
				sImage = "URL('theme://convertImages/" + dsHeadObj.getColumn(idx, "WIMG") + ".png')";
			} else {
				sImage = "";
			}
  		    grdObj.setCellProperty('head', i + 1, 'displaytype', 'image'); 
			grdObj.setCellProperty("head", i + 1, "text", sImage);
			sSecondRowIdx ++;
			idx ++;
		}
	}
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_setMealQtyGridData(menuObj, headObj, bodyObj)
 * 기ㅡㅡㅡ능 : 식수예측 그리드 데이터 세팅
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_setMealQtyGridData(grdObj, dsGrdObj, dsHeadObj, dsBodyObj)
{
	menuCnt = 0;
	dsGrdObj.clearData();

	// 헤더 세팅
	fn_setHeader(grdObj, dsGrdObj, dsHeadObj, 17);

	// 컬럼 데이터 세팅
	var sKey = "";
	var nRow = 0;
	for(var i=0; i<dsBodyObj.getRowCount(); i++)
	{
		nRow = dsGrdObj.findRow("KEY", dsBodyObj.getColumn(i, "KEY"));
		// 키가 존재하지 않을 경우 행 추가 후 세팅
		if(nRow == -1)
		{
			nRow = dsGrdObj.addRow();
			dsGrdObj.setColumn(nRow, "KEY"         , dsBodyObj.getColumn(i, "KEY"));			// 끼니코드 + 코너코드 + 레시피순번
			dsGrdObj.setColumn(nRow, "SGBN"        , dsBodyObj.getColumn(i, "SGBN"));			// 끼니코드
			dsGrdObj.setColumn(nRow, "SGBN_NM"     , dsBodyObj.getColumn(i, "SGBN_NM"));		// 끼니명
			dsGrdObj.setColumn(nRow, "CGBN_CD"     , dsBodyObj.getColumn(i, "CGBN_CD"));		// 코너코드
			dsGrdObj.setColumn(nRow, "CGBN"        , dsBodyObj.getColumn(i, "CGBN"));			// 코너명
		}
		dsGrdObj.setColumn(nRow, "Q" + dsBodyObj.getColumn(i, "WEEK"), dsBodyObj.getColumn(i, "EXPECT_MEAL_QTY")); // 식수
		dsGrdObj.setColumn(nRow, "D" + dsBodyObj.getColumn(i, "WEEK"), dsBodyObj.getColumn(i, "FDAY"));            // 제공일
		dsGrdObj.setColumn(nRow, "L" + dsBodyObj.getColumn(i, "WEEK"), dsBodyObj.getColumn(i, "LK")); 			   // 잠금여부
		dsGrdObj.setColumn(nRow, "O" + dsBodyObj.getColumn(i, "WEEK"), dsBodyObj.getColumn(i, "ORDER_YN"));	       // 주문여부
	}

/*
	// 메뉴 제공일이 시스템 일자보다 작을경우 수정불가하도록 처리
	for(var i=1; i<dsHeadObj.getRowCount() + 1; i++)
	{
		// 그리드 컬럼 접근시에는 바인딩된 컬럼 인덱스를 구해서 처리한다.
		var colidx = grdObj.getBindCellIndex("body", "Q" + i);
		if(dsGrdObj.getColumn(0, "L" + i) == '0') 
		{
			grdObj.setCellProperty("body", colidx, "edittype", "none");
			grdObj.setCellProperty("body", colidx, "background", "whitesmoke");
			grdObj.setCellProperty("body", colidx, "background2", "whitesmoke");
		}
		else
		{
			grdObj.setCellProperty("body", colidx, "edittype", "masknumber");
			grdObj.setCellProperty("body", colidx, "background", "white");
			grdObj.setCellProperty("body", colidx, "background2", "white");
		}
	}
*/

	// 표준식단 그리드의 끼니 컬럼 bold 처리
	grdObj.setCellProperty("body", 0, "font", "굴림,9,bold");
	grdObj.setCellProperty("body", 1, "font", "굴림,9,bold");
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_setMenuGridData(menuObj, headObj, bodyObj)
 * 기ㅡㅡㅡ능 : 식단등록 그리드 데이터 세팅
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_setMenuGridData(grdObj, dsGrdObj, dsHeadObj, dsBodyObj)
{
	ds_subSum.clearData();
	menuCnt = 0;
	salePriceSum = 0;
	dsGrdObj.clearData();

	// 헤더 세팅
	fn_setHeader(grdObj, dsGrdObj, dsHeadObj, 15);

	var vCond = "";
	var nRow = 0;
	var nSdWon = 0;  // 소계처리용 변수
	var nSumStartRow = 0;
	for(var i=0; i<ds_sgbn.getRowCount(); i++)
	{
		vCond = "SGBN=='" + ds_sgbn.getColumn(i, "SGBN") + "' && CGBN=='" + ds_sgbn.getColumn(i, "CGBN") + "' && CGBN_CD=='" + ds_sgbn.getColumn(i, "CGBN_CD")+"'";
		dsBodyObj.filter(vCond);
		
		if(dsBodyObj.getRowCount() == 0)
		{
			nRow = dsGrdObj.addRow();
			dsGrdObj.setColumn(nRow, "KEY"         , "N" + i);                          // KEY
			dsGrdObj.setColumn(nRow, "SGBN"        , ds_sgbn.getColumn(i, "SGBN"));		// 끼니코드
			dsGrdObj.setColumn(nRow, "SGBN_NM"     , ds_sgbn.getColumn(i, "SGBN_NM"));	// 끼니명
			dsGrdObj.setColumn(nRow, "CGBN"        , ds_sgbn.getColumn(i, "CGBN"));		// 코너명
			dsGrdObj.setColumn(nRow, "CGBN_CD"     , ds_sgbn.getColumn(i, "CGBN_CD"));	// 코너코드			
			
			// 소계
			nRow = dsGrdObj.addRow();
			dsGrdObj.setColumn(nRow, "SGBN"        , ds_sgbn.getColumn(i, "SGBN"));		// 끼니코드
			dsGrdObj.setColumn(nRow, "SGBN_NM"     , ds_sgbn.getColumn(i, "SGBN_NM"));	// 끼니명
			dsGrdObj.setColumn(nRow, "CGBN"        , ds_sgbn.getColumn(i, "CGBN"));		// 코너명
			dsGrdObj.setColumn(nRow, "CGBN_CD"     , ds_sgbn.getColumn(i, "CGBN_CD"));	// 코너코드			
		}
		else
		{
			for(var j=0; j<dsBodyObj.getRowCount(); j++)
			{
				nRow = dsGrdObj.findRow("KEY", dsBodyObj.getColumn(j, "KEY"));
				// 키가 존재하지 않을 경우 행 추가 후 세팅
				if(nRow == -1)
				{
					nRow = dsGrdObj.addRow();
					dsGrdObj.setColumn(nRow, "KEY"         , dsBodyObj.getColumn(j, "KEY"));			// 끼니코드 + 코너코드 + 레시피순번
					dsGrdObj.setColumn(nRow, "SGBN"        , dsBodyObj.getColumn(j, "SGBN"));			// 끼니코드
					dsGrdObj.setColumn(nRow, "SGBN_NM"     , dsBodyObj.getColumn(j, "SGBN_NM"));		// 끼니명
					dsGrdObj.setColumn(nRow, "CGBN_CD"     , dsBodyObj.getColumn(j, "CGBN_CD"));		// 코너코드
					dsGrdObj.setColumn(nRow, "CGBN"        , dsBodyObj.getColumn(j, "CGBN"));			// 코너명
					dsGrdObj.setColumn(nRow, "SSEQ"        , dsBodyObj.getColumn(j, "SSEQ"));			// 레시피순번
					//dsGrdObj.setColumn(nRow, "SALE_PRICE"  , dsBodyObj.getColumn(j, "SALE_PRICE"));		// 판매가
					dsGrdObj.setColumn(nRow, "MENU_CD"     , dsBodyObj.getColumn(j, "MENU_CD"));	    // 메뉴코드
				}
				dsGrdObj.setColumn(nRow, "T" + dsBodyObj.getColumn(j, "WEEK"), dsBodyObj.getColumn(j, "MENU_CD"));				// 메뉴코드
				dsGrdObj.setColumn(nRow, "D" + dsBodyObj.getColumn(j, "WEEK"), dsBodyObj.getColumn(j, "FDAY"));					// 제공일
				dsGrdObj.setColumn(nRow, "M" + dsBodyObj.getColumn(j, "WEEK"), dsBodyObj.getColumn(j, "SD_NM"));				// 레시피명
				dsGrdObj.setColumn(nRow, "P" + dsBodyObj.getColumn(j, "WEEK"), dsBodyObj.getColumn(j, "SD_WON"));				// 레시피원가
				dsGrdObj.setColumn(nRow, "C" + dsBodyObj.getColumn(j, "WEEK"), dsBodyObj.getColumn(j, "DUP_COLOR"));			// 식단평가색상
				dsGrdObj.setColumn(nRow, "Q" + dsBodyObj.getColumn(j, "WEEK"), dsBodyObj.getColumn(j, "EXPECT_MEAL_QTY"));		// 예상식수
				dsGrdObj.setColumn(nRow, "S" + dsBodyObj.getColumn(j, "WEEK"), dsBodyObj.getColumn(j, "SALE_PRICE"));			// 예상식수
				dsGrdObj.setColumn(nRow, "Z" + dsBodyObj.getColumn(j, "WEEK"), dsBodyObj.getColumn(j, "ATTR02"));				// 대표레시피
			}
			
			// 소계 처리
			var subSumidx = dsBodyObj.getRowCount() - 1;
			nRow = dsGrdObj.addRow();
			dsGrdObj.setColumn(nRow, "SGBN"        , dsBodyObj.getColumn(subSumidx, "SGBN"));
			dsGrdObj.setColumn(nRow, "SGBN_NM"     , dsBodyObj.getColumn(subSumidx, "SGBN_NM"));
			dsGrdObj.setColumn(nRow, "CGBN_CD"     , dsBodyObj.getColumn(subSumidx, "CGBN_CD"));
			dsGrdObj.setColumn(nRow, "CGBN"        , dsBodyObj.getColumn(subSumidx, "CGBN"));
			dsGrdObj.setColumn(nRow, "SSEQ"        , dsBodyObj.getColumn(subSumidx, "SSEQ"));
			dsGrdObj.setColumn(nRow, "SALE_PRICE"  , dsBodyObj.getColumn(subSumidx, "SALE_PRICE"));
			
			for(var j=0; j<dsHeadObj.getRowCount(); j++)
			{
				nSdWon = dsGrdObj.getSum("P" + (j + 1), nSumStartRow, nRow);
				if(nSdWon > 0 || !gfn_isNull(dsGrdObj.getMax("M" + (j + 1), nSumStartRow, nRow)))
				{
					dsGrdObj.setColumn(nRow, "T" + (j + 1), dsGrdObj.getMax("T" + (j + 1)));        // 메뉴코드
					dsGrdObj.setColumn(nRow, "D" + (j + 1), dsGrdObj.getMax("D" + (j + 1)));        // 제공일
					dsGrdObj.setColumn(nRow, "M" + (j + 1), Put_comma(nSdWon, 0) + " 원(" + Math.round(nSdWon / dsGrdObj.getMax("S" + (j + 1), nSumStartRow, nRow) * 100, 1) + "%)");   // 소계
					var nSumRow = ds_subSum.addRow();
					ds_subSum.setColumn(nSumRow, "WEEK", j + 1);
					ds_subSum.setColumn(nSumRow, "SGBN", dsBodyObj.getColumn(subSumidx, "SGBN"));
					ds_subSum.setColumn(nSumRow, "CGBN_CD", dsBodyObj.getColumn(subSumidx, "CGBN_CD"));
					ds_subSum.setColumn(nSumRow, "SD_WON", nSdWon * dsGrdObj.getMax("Q" + (j + 1), nSumStartRow, nRow));
					ds_subSum.setColumn(nSumRow, "MEAL_QTY", dsGrdObj.getMax("Q" + (j + 1), nSumStartRow, nRow));
					ds_subSum.setColumn(nSumRow, "SALE_PRICE", dsGrdObj.getMax("S" + (j + 1), nSumStartRow, nRow) * dsGrdObj.getMax("Q" + (j + 1), nSumStartRow, nRow));
					
					// 주간평균원가 계산용 식단제공수 처리
					menuCnt ++;
					
					salePriceSum = salePriceSum + Number(dsGrdObj.getMax("S" + (j + 1)));
				}
			}
			nSumStartRow = nRow + 1;
			nSdWon = 0;
		}
		
	}

	var sProp1 = "0 none #c3c3c3ff, 1 solid #c3c3c3ff, 0 none #c3c3c3ff,  0 none #c3c3c3ff";   // body line
	var sProp2 = "0 none #c3c3c3ff, 0 none #c3c3c3ff,  0 none #c3c3c3ff,  0 none #c3c3c3ff";   // body line (오른쪽라인 없는 Style)
	var sProp3 = "0 none #c3c3c3ff, 1 solid #c3c3c3ff, 1 solid #c3c3c3ff, 0 none #c3c3c3ff";   // 소계 line
	var sProp4 = "0 none #c3c3c3ff, 0 none #c3c3c3ff,  1 solid #c3c3c3ff, 0 none #c3c3c3ff";   // 소계 line (오른쪽라인 없는 Style)
	sImage = "URL('theme://Images/new/grd_WF_ExpandImageX.png') middle center #DDFCDB";
	var expr = "";
	
	var weekNum = "";
	for(var i=0; i<grdObj.getFormatColCount(); i++)
	{
		if(i % 2 == 0 && i > 0)
		{
			expr = 'EXPR(!gfn_isNull(KEY)?"' + sProp1 + '":"' + sProp3 + '")';
			
			// 식단평가 색상처리를 위해 색상컬럼 ID를 찾는다.
			var val = grdObj.getCellProperty("body", i, "text");
			weekNum = gfn_right(val.replace("bind:", ""), 1);
		
			grdObj.setCellProperty("body", i, "background", 'EXPR(!gfn_isNull(C' + weekNum + ') ?C' + weekNum + ':!gfn_isNull(KEY)?"whitesmoke":gfn_isNull(M' + weekNum + ')?"#DDFCDB":"' + sImage + '")');
			grdObj.setCellProperty("body", i, "background2", 'EXPR(!gfn_isNull(C' + weekNum + ') ?C' + weekNum + ':!gfn_isNull(KEY)?"whitesmoke":gfn_isNull(M' + weekNum + ')?"#DDFCDB":"' + sImage + '")');
		}
		else
		{
			if(i == 0)
			{
				expr = 'EXPR(!gfn_isNull(KEY)?"' + sProp1 + '":"' + sProp3 + '")';
			}
			else
			{
				expr = 'EXPR(!gfn_isNull(KEY)?"' + sProp2 + '":"' + sProp4 + '")';				
			}
		}
		grdObj.setCellProperty("body", i, "line", expr);
		
		if(i > 0)
		{
			grdObj.setCellProperty("body", i, "font", 'EXPR(!gfn_isNull(KEY)?"굴림,9":"굴림,9,bold right")');
			grdObj.setCellProperty("body", i, "selectfont", 'EXPR(!gfn_isNull(KEY)?"굴림,9":"굴림,9,bold")');
			grdObj.setCellProperty("body", i, "align", 'EXPR(!gfn_isNull(KEY)?"":"center middle")');
		}
	}

	// 표준식단 그리드의 끼니 컬럼 bold 처리
	grdObj.setCellProperty("body", 0, "font", "굴림,9,bold");
	
	// [중요] 모든 데이터 세팅작업이 끝난뒤 필터 초기화
	dsBodyObj.filter("");
	
	grdObj.setCellProperty("summ", 0, "text", "평균원가");
	var nSumSdWon = 0;
	for(var i=1; i<=dsHeadObj.getRowCount(); i++) 
	{
		//trace("SD_WON > 0 && WEEK==" + dsHeadObj.getColumn(i-1, "WEEK"));
		ds_subSum.filter("SD_WON > 0 && WEEK==" + dsHeadObj.getColumn(i-1, "WEEK"));
		if(ds_subSum.getSum("SD_WON") > 0)
		{
			nSumSdWon = Put_comma(gfn_round(ds_subSum.getSum("SD_WON") / ds_subSum.getSum("MEAL_QTY"), 0), 0) + " 원(" + Math.round(ds_subSum.getSum("SD_WON") / ds_subSum.getSum("SALE_PRICE") * 100, 1) + "%)";
		}
		else
		{
			nSumSdWon = "";
		}

		grdObj.setCellProperty("summ", i, "align", "right");
		grdObj.setCellProperty("summ", i, "text", nSumSdWon);
		ds_subSum.filter("");
	}
	
	// 식당목표식재료율(주간) 세팅
	var goalCostRate = ds_goalCostRate.getMax("GOAL_COST_RATE");
	tab_menu.tabpage1.edt_goalCostRate.value = goalCostRate;
	tab_menu.tabpage2.edt_goalCostRate.value = goalCostRate + ' %';
	
	//var exptCostRate = fn_clearNaN(Math.round(ds_bodyList.getSum("SD_WON") / salePriceSum * 100, 1));
	var exptCostRate = fn_clearNaN(Math.round(ds_subSum.getSum("SD_WON") / ds_subSum.getSum("SALE_PRICE") * 100, 1));
	tab_menu.tabpage2.edt_exptCostRate.value = exptCostRate + ' %';

	// 달성율 세팅
	if((goalCostRate - exptCostRate) < 0)
	{
		tab_menu.tabpage2.edt_resultRate.value = goalCostRate - exptCostRate + ' %P';
		tab_menu.tabpage2.edt_resultRate.style.color = "red";
	}
	else if((goalCostRate - exptCostRate) > 0)
	{
		tab_menu.tabpage2.edt_resultRate.value = goalCostRate - exptCostRate + ' %P';
		tab_menu.tabpage2.edt_resultRate.style.color = "blue";
	} else 
	{
		tab_menu.tabpage2.edt_resultRate.value = '0 %P';
	}
	
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_setPeriodOfWeek(menuDate)
 * 기ㅡㅡㅡ능 : 일자가 속한 주(Week)의 시작일, 종료일 세팅 (월 ~ 일)
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_setPeriodOfWeek(menuDate)
{
	var objCalendar = new Calendar();
	objCalendar.value = menuDate;

	var startDate = gfn_getStartOfWeek(objCalendar);	// 시작일
	var endDate = gfn_getEndOfWeek(objCalendar);		// 종료일
	
	// 조회조건의 식단 제공일이 일요일일 경우 전주 식단을 제공
	var addDay = 0;
	if(startDate == menuDate) 
	{
		addDay = -6;
	}
	else
	{
		addDay = 1;
	}
	
	ds_cond.setColumn(0, "MENU_SDATE", gfn_addDate(startDate, addDay));
	ds_cond.setColumn(0, "MENU_EDATE", gfn_addDate(endDate, addDay));
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : grd_menuList_oncellclick(obj:Grid, e:GridClickEventInfo)
 * 기ㅡㅡㅡ능 : 식단평가 팝업에서 선택시 식단 그리드에 색상마킹 처리
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_dupColor(p_eval, p_date, p_row, p_title)
{
	var if_col = ""; // 컬러를 적용할 조건 컬럼
	var v_case = ""; // fillter 할 조건

	// 색을 적용할 조건 컬럼을 셋팅
	switch(p_eval) {
		case 0:
			if_col = "SD_NM";	        // 레시피명 중복횟수
			break;
		case 1:
			if_col = "MAIN_ITEM_CODE1";	// 주재료군 중복횟수
			break;
		case 2:
			if_col = "CUISINE_TYPE";    // 조리법 중복횟수
			break;
	}
	
	if (gfn_length(gfn_toString(p_row))> 0) {
		v_case += if_col + "=='" + ds_evalList.getColumn(p_row, "CD") + "'";
	}
	else {
		for (var i=0; i < ds_evalList.rowcount; i++)
		{
			if (i > 0) {
				v_case += " || ";
			}
			v_case += if_col + "=='" + ds_evalList.getColumn(i, "CD") + "'";
		}
	}
	
	// 특정일을 선택했을 경우 일자 조건 추가
	if (gfn_length(gfn_toString(p_date)) == 8) { // 일자 선택 시
		v_case += " && FDAY=='" + p_date + "'";
	}
	
	// 데이터 초기화
	ds_bodyList.filter('');
	for (var i=0; i < ds_bodyList.rowcount; i++)
	{
    	ds_bodyList.setColumn(i, "DUP_COLOR", '');
	}
	
	// 조건에 맞는 데이터를 필터링 하여 색상 데이터 세팅
  	ds_bodyList.filter(v_case);
	for (var i=0; i < ds_bodyList.rowcount; i++)
	{
    	ds_bodyList.setColumn(i, "DUP_COLOR", div_eval.fn_getColor(p_row));
	}
  	ds_bodyList.filter('');
  	
  	// 변경된 색상 정보로 그리드에 데이터를 다시 세팅한다.
  	fn_setMenuGridData(tab_menu.tabpage2.grd_menuList, ds_menuList, ds_headList, ds_bodyList);
}

//=========================================================================================
// [ PART 6 ]
// component Event 정의 ( User Define function )
// 
//=========================================================================================
/******************************************************************************************
 * 함ㅡ수ㅡ명 : tab_menu_tabpage1_btn_copyMealQty_onclick(obj:Button,  e:ClickEventInfo)
 * 기ㅡㅡㅡ능 : 전주예상식수복사
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function tab_menu_tabpage1_btn_copyMealQty_onclick(obj:Button,  e:ClickEventInfo)
{
	ds_cond.setColumn(0, "EMP_NO", g_EmpNo);
	
    fsp_clear(this);
	fsp_addMulti(this, "fs/fsm:FSM00051E_I010");
	fsp_callService(this, "", "", "ds_input=ds_cond", "", "", "fn_callbackCopy", "", true);	
}

function fn_callbackCopy(errCode, errMsg) 
{
	if(errCode!=0)
	{
		g_Message("EE", "서비스 오류:시스템 관리자에게 문의하십시오!");
		return;
	}
	else
	{
		g_Message("02", "전주 예상식수 복사가 완료되었습니다.");
		
		// 전주예상식수복사 후 데이터 조회
		fn_search();
	}
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : tab_menu_tabpage2_btn_eval_onclick(obj:Button,  e:ClickEventInfo)
 * 기ㅡㅡㅡ능 : 식단평가
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-22
 ******************************************************************************************/
function tab_menu_tabpage2_btn_eval_onclick(obj:Button,  e:ClickEventInfo)
{
	// 상단 검색조건 변경시는 조회 후  처리하여야 한다.
	if (gfn_dsIsUpdated(ds_cond)) {
		g_Message("EE",	"검색조건이 변경되었습니다.\n\n조회후 작업을 처리하세요.");
		return;
	}
	
	div_eval.visible = !isEvalShow;
	isEvalShow = !isEvalShow;	
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : tab_menu_tabpage2_btn_nutAnalysis_onclick(obj:Button,  e:ClickEventInfo)
 * 기ㅡㅡㅡ능 : 영양분석
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-22
 ******************************************************************************************/
function tab_menu_tabpage2_btn_nutAnalysis_onclick(obj:Button,  e:ClickEventInfo)
{
	var v_arg = {fa_UPJANG:ds_cond.getColumn(0, "UPJANG")
	            ,fa_HALL_CD:ds_cond.getColumn(0, "HALL_CD")
	            ,fa_FROM_MENU_DATE:ds_cond.getColumn(0, "MENU_SDATE")
	            ,fa_TO_MENU_DATE:ds_cond.getColumn(0, "MENU_EDATE")}; 
	
	gfn_dialog("", "U_FSM::FSM00170V.xfdl", v_arg);	
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : tab_menu_tabpage2_btn_excel_onclick(obj:Button,  e:ClickEventInfo)
 * 기ㅡㅡㅡ능 : 엑셀 다운로드
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-22
 ******************************************************************************************/
function tab_menu_tabpage2_btn_excel_onclick(obj:Button,  e:ClickEventInfo)
{
	if (ds_menuList.getRowCount() == 0) {
		g_Message("EE",	"출력할 메뉴정보가 없습니다.");
		return;
	}

	gfn_exportExcel(tab_menu.tabpage2.grd_menuList, "식단표", "", "", "", "", "cellline");
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : tab_menu_tabpage2_btn_myRecipe_onclick(obj:Button,  e:ClickEventInfo)
 * 기ㅡㅡㅡ능 : MY레시피구성
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-22
 ******************************************************************************************/
function tab_menu_tabpage2_btn_myRecipe_onclick(obj:Button,  e:ClickEventInfo)
{
	var v_arg =  {fa_Upjang:ds_cond.getColumn(0, "UPJANG")
	             ,fa_UpjangNm:ds_cond.getColumn(0, "UPJANGNM")
	             ,fa_HallCd:ds_cond.getColumn(0, "HALL_CD")
	             ,fa_HallName:cbo_hall.text
	             ,fa_MenuDate:ds_cond.getColumn(0, "MENU_DATE")
	             ,fa_SubinvCode:ds_cond.getColumn(0, "SUBINV_CODE")};
	
	gfn_dialog("", "U_FSM::FSM00110E.xfdl", v_arg);
	fn_search();
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : tab_menu_tabpage2_btn_myRecipe_onclick(obj:Button,  e:ClickEventInfo)
 * 기ㅡㅡㅡ능 : 식당 변경시 SUBINV_CODE 세팅
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-22
 ******************************************************************************************/
function cbo_hall_onitemchanged(obj:Combo, e:ItemChangeEventInfo)
{
	ds_cond.setColumn(0, "SUBINV_CODE", ds_cboHall.getColumn(cbo_hall.index, "SUBINV_CODE"));
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : tab_menu_tabpage2_btn_copyMenu_onclick(obj:Button,  e:ClickEventInfo)
 * 기ㅡㅡㅡ능 : 식단복사
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-22
 ******************************************************************************************/
function tab_menu_tabpage2_btn_copyMenu_onclick(obj:Button,  e:ClickEventInfo)
{
	var isEnf = "N";
	if(ds_enfUpjangList.getRowCount() > 0)
	{
		isEnf = "Y";
	}

	var v_arg =  {fa_UPJANG:ds_cond.getColumn(0, "UPJANG")
	             ,fa_UPJANG_NM:ds_cond.getColumn(0, "UPJANGNM")
	             ,fa_HALL_CD:ds_cond.getColumn(0, "HALL_CD")
	             ,fa_HALL_NAME:cbo_hall.text
	             ,fa_FROM_DT:ds_cond.getColumn(0, "MENU_SDATE")
	             ,fa_SUBINV_CODE:ds_cond.getColumn(0, "SUBINV_CODE")
	             ,fa_CALL_PGM:'G'
	             ,fa_TO_DT:ds_cond.getColumn(0, "MENU_EDATE")
	             ,fa_IS_ENF:isEnf};
	
	gfn_dialog("", "U_FSM::FSM00100E.xfdl", v_arg);
	fn_search();	
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : tab_menu_tabpage2_btn_po_onclick(obj:Button,  e:ClickEventInfo)
 * 기ㅡㅡㅡ능 : 구매신청
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-22
 ******************************************************************************************/
function tab_menu_tabpage2_btn_po_onclick(obj:Button,  e:ClickEventInfo)
{
	gfn_openMenuForm("FSP00030E.xfdl", "U_FSP", "", "구매신청");
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : tab_menu_tabpage2_grd_menuList_oncellclick(obj:Grid, e:GridClickEventInfo)
 * 기ㅡㅡㅡ능 : 메뉴삭제
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-22
 ******************************************************************************************/
function tab_menu_tabpage2_grd_menuList_oncellclick(obj:Grid, e:GridClickEventInfo)
{
	if(e.col > 0)
	{
		var sCellType = tab_menu.tabpage2.grd_menuList.getCellProperty("body", e.col, "displaytype");
		
		// 레시피 삭제
		if(sCellType == "number" && gfn_isNull(ds_menuList.getColumn(e.row, "KEY")))
		{
		
			var val = tab_menu.tabpage2.grd_menuList.getCellProperty("body", e.col, "text");
			var weekNum = '';
			if(!gfn_isNull(val))
			{
				weekNum = gfn_right(val.replace("bind:", ""), 1);
			}
			
			var sMenuCd = ds_menuList.getColumn(e.row, "T" + weekNum);
			var sFday = ds_menuList.getColumn(e.row, "D" + weekNum);

			if(gfn_isNull(sMenuCd)) return;
			
			// 삭제 가능여부 체크 ( 1. 예상식수 등록여부, 2. 주문 여부 )
			var vCond = "FDAY=='" + sFday + "'&&SGBN=='" + ds_menuList.getColumn(e.row, "SGBN") + "'&&CGBN=='" + ds_menuList.getColumn(e.row, "CGBN") + "'&&CGBN_CD=='" + ds_menuList.getColumn(e.row, "CGBN_CD") + "'";
			var nRow = ds_mealQtyBodyList.findRowExpr(vCond);
			
			if (nRow < 0) 
			{
					g_Message("EE",	"예상식수 정보가 없습니다.\n\n식수정보를 확인 후 처리하세요.");
					return;
			}
			else 
			{
				if (ds_mealQtyBodyList.getColumn(nRow, "ORDER_YN") == "Y") 
				{
					g_Message("EE",	"식자재가 발주되었습니다.\n\n메뉴를 삭제할수 없습니다.");
					return;
				}
			}

			// 확인메시지
			var msg = tab_menu.tabpage2.grd_menuList.getCellProperty("head",  e.col - 1, "text") + " : " + ds_menuList.getColumn(e.row, "SGBN_NM") + ds_menuList.getColumn(e.row, "CGBN") + "을(를) 삭제하시겠습니까?\n\n[ " + sMenuCd + " ]";
			
			if (g_Confirm("04",	msg) == true) {
				// 삭제처리
				var actionName, cmdName, inData, outData, otherArg, callBackFnc;
				
				inData			= "";
				outData			= "";
				otherArg		= "UPJANG=" + wrapQuote(ds_cond.getColumn(0, "UPJANG")) + " MENU_CD=" + wrapQuote(sMenuCd);
				callBackFnc		= "";
				
				fsp_clear(this); 
				fsp_addSearch(this, "fs/fsm:FSM00052E_D001");									// 조회 
				http.Sync = true;
				fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);		// 서비스 호출 
				http.Sync = false;

				fn_search();
			}		
		}
	}	
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : tab_menu_tabpage2_grd_menuList_oncelldblclick(obj:Grid, e:GridClickEventInfo)
 * 기ㅡㅡㅡ능 : 레시피검색 및 등록 
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-22
 ******************************************************************************************/
function tab_menu_tabpage2_grd_menuList_oncelldblclick(obj:Grid, e:GridClickEventInfo)
{
	if(e.col > 0)
	{
		var sCellType = tab_menu.tabpage2.grd_menuList.getCellProperty("body", e.col, "displaytype");

		// 레시피검색 및 등록
		var sFday = ds_headList.getColumn((e.cell - 1) / 2, "FDAY");

		// 예상식수 등록여부 체크
		var vCond = "FDAY=='" + sFday + "'&&SGBN=='" + ds_menuList.getColumn(e.row, "SGBN") + "'&&CGBN=='" + ds_menuList.getColumn(e.row, "CGBN") + "'&&CGBN_CD=='" + ds_menuList.getColumn(e.row, "CGBN_CD") + "'";
		var nRow = ds_mealQtyBodyList.findRowExpr(vCond);

		if (nRow < 0 || ds_mealQtyBodyList.getColumn(nRow, "EXPECT_MEAL_QTY") < 1) 
		{
				g_Message("EE",	"예상식수 정보가 없습니다.\n\n식수정보를 확인 후 처리하세요.");
				return;
		}			

		// 확인메시지
		var msg = tab_menu.tabpage2.grd_menuList.getCellProperty("head",  e.col - ((e.col - 1) % 2), "text") + ":" + ds_menuList.getColumn(e.row, "SGBN_NM") + ds_menuList.getColumn(e.row, "CGBN")+" 에 대한\n\n레시피 검색 및 등록/수정 작업을\n\n하시겠습니까?";

		if (g_Confirm("04",	msg) == true) {
			var v_arg = {fa_UPJANG:ds_cond.getColumn(0, "UPJANG")
						,fa_HALL_CD:ds_cond.getColumn(0, "HALL_CD")
						,fa_HALL_CLASS:ds_cboHall.lookup("HALL_CD", ds_cond.getColumn(0, "HALL_CD"), "HALL_CLASS")
						,fa_FROM_DT:ds_cond.getColumn(0, "MENU_SDATE")
						,fa_TO_DT:ds_cond.getColumn(0, "MENU_EDATE")
						,fa_MEAL:ds_menuList.getColumn(e.row, "SGBN")
						,fa_CORNER:ds_menuList.getColumn(e.row, "CGBN_CD")
						,fa_MENU_DATE:sFday
						,fa_SUBINV_CODE:ds_cond.getColumn(0, "SUBINV_CODE")
						,fa_CALL_PGM:'G'};	// G:일반식, H:병원식

			gfn_dialog("", "U_FSM::FSM90030P.xfdl", v_arg, "", "", "", "", "", "", "", "", true);  // FSM00060E.xfdl
			fn_search();
		}		
	}		
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : tab_menu_tabpage2_grd_menuList_onmousemove(obj:Grid, e:GridMouseEventInfo)
 * 기ㅡㅡㅡ능 : 이미지 버튼에 대한 커서 처리
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-22
 ******************************************************************************************/
function tab_menu_tabpage2_grd_menuList_onmousemove(obj:Grid, e:GridMouseEventInfo)
{
	if(e.col > 0)
	{
		var val = tab_menu.tabpage2.grd_menuList.getCellProperty("body", e.col, "text");
		var weekNum = '';
		if(!gfn_isNull(val))
		{
			weekNum = gfn_right(val.replace("bind:", ""), 1);
		}
	
		if(gfn_isNull(ds_menuList.getColumn(e.row, "KEY")) && gfn_isNull(ds_menuList.getColumn(e.row, "C" + weekNum)) && !gfn_isNull(ds_menuList.getColumn(e.row, "M" + weekNum)))
		{
			tab_menu.tabpage2.grd_menuList.setCellProperty('body', e.col, 'cursor', 'pointer');
		}
		else
		{
			tab_menu.tabpage2.grd_menuList.setCellProperty('body', e.col, 'cursor', '');
		}
	}
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : tab_menu_tabpage2_grd_menuList_onmousemove(obj:Grid, e:GridMouseEventInfo)
 * 기ㅡㅡㅡ능 : MY 레시피 등록
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-22
 ******************************************************************************************/
function tab_menu_tabpage2_grd_menuList_onrbuttondown(obj:Grid, e:GridMouseEventInfo)
{
	if (e.cell < 1 || e.row < 0) {
		return;
	}

	// 그룹레시피의 경우 MY 레시피 등록 불가 
	if(ds_enfUpjangList.getRowCount() > 0)
	{
		return;
	}

	var sFday = ds_headList.getColumn((e.cell - 1) / 2, "FDAY");
	
	// 예상식수 등록여부 체크
	var vCond = "FDAY=='" + sFday + "'&&SGBN=='" + ds_menuList.getColumn(e.row, "SGBN") + "'&&CGBN=='" + ds_menuList.getColumn(e.row, "CGBN") + "'&&CGBN_CD=='" + ds_menuList.getColumn(e.row, "CGBN_CD") + "'";
	var nRow = ds_mealQtyBodyList.findRowExpr(vCond);
	
	if (nRow < 0) 
	{
			g_Message("EE",	"예상식수 정보가 없습니다.\n\n식수정보를 확인 후 처리하세요.");
			return;
	}
	
	// 확인메시지
	var msg = tab_menu.tabpage2.grd_menuList.getCellProperty("head",  e.col - ((e.col - 1) % 2), "text") + ":" + ds_menuList.getColumn(e.row, "SGBN_NM") + ds_menuList.getColumn(e.row, "CGBN") + "의\n\nMY레시피 등록 작업을 하시겠습니까?";

	if (g_Confirm("04",	msg) == true) {
	
		var v_arg = {fa_upjang:ds_cond.getColumn(0, "UPJANG")
	                ,fa_hall_cd:ds_cond.getColumn(0, "HALL_CD")
		            ,fa_meal:ds_menuList.getColumn(e.row, "SGBN")
		            ,fa_corner:ds_menuList.getColumn(e.row, "CGBN_CD")
		            ,fa_menu_date:sFday
		            ,fa_menu_cd:sFday + "-" + ds_cond.getColumn(0, "HALL_CD") + ds_menuList.getColumn(e.row, "SGBN") + ds_menuList.getColumn(e.row, "CGBN_CD")
	                ,fa_subinv_code:ds_cond.getColumn(0,"SUBINV_CODE")};
	
		gfn_dialog("", "U_FSM::FSM00130E.xfdl", v_arg);
		fn_search();
	}	
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : tab_menu_tabpage2_btn_costReflash_onclick(obj:Button,  e:ClickEventInfo)
 * 기ㅡㅡㅡ능 : 원가갱신
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-22
 ******************************************************************************************/
function tab_menu_tabpage2_btn_costReflash_onclick(obj:Button,  e:ClickEventInfo)
{
	var sCostReflashDate = tab_menu.tabpage2.cal_costReflash.fn_getValue();
	if (sCostReflashDate < gfn_addDate(gfn_today(), 1)){
		g_Message("EE",	"갱신일 지정 오류!!\n\n당일 또는 과거 날짜는 갱신 할 수 없습니다.");
		return;
	}	  

	if (gfn_length(ds_cond.getColumn(0, "UPJANG"))== 0) {
		g_Message("EE",	"업장정보 오류!!\n\n 업장정보를 입력하세요.");
		return;
	}	  
	
	if (gfn_length(sCostReflashDate)== 0) {
		g_Message("EE",	"갱신일 오류!!\n\n갱신일을 입력하세요.");
		return;
	}
	
	if (!g_Confirm("02","원가 갱신 작업을 하시겠습니까?!\n\n지정일 ~ 지정일+6일(제공일기준)")) return;
	
	// 데이타체크
	ds_input.clearData();
	ds_input.addRow();
	ds_input.setColumn(0,"SDATE", sCostReflashDate);
	ds_input.setColumn(0,"UPJANG", ds_cond.getColumn(0, "UPJANG"));
	  	  
    http.Sync = true;
	var t_timeout = application.httptimeout;
	application.httptimeout = 2000; //1800초

	fsp_clear(this);	
	fsp_addSingle(this, "fs/fsm:FSM00052E_I001");
	fsp_callService(this, "", "", "ds_input2=ds_input:A", "ds_return=ds_return",  "", "fn_callbackCostReflash");

	application.httptimeout = t_timeout; //60초
	http.Sync = false;	
}

function fn_callbackCostReflash(errCode, errMsg) 
{
	if(errCode != 0)
	{
		g_Message("EE","서비스 에러");
	}
	else
	{
		if ((ds_return.getColumn(0, "O_RTN")) == 'TRUE'){	
			g_Message("04", ds_return.getColumn(0,"O_RTNMSG"));
		}
		else
		{
			g_Message("EE","갱신 도중 오류가 발생 하였습니다. \n\n " + ds_return.getColumn(0, "O_RTNMSG"));
		}
	}
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : tab_menu_onchanged(obj:Tab, e:TabIndexChangeEventInfo)
 * 기ㅡㅡㅡ능 : 탭변경시 식단평가 DIV 숨김처리
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-22
 ******************************************************************************************/
function tab_menu_onchanged(obj:Tab, e:TabIndexChangeEventInfo)
{
	div_eval.visible = false;
	isEvalShow = false;	
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : ds_cond_onvaluechanged(obj:Dataset,  e:DSColChangeEventInfo)
 * 기ㅡㅡㅡ능 : 조회조건 변경시 데이터 초기화
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-22
 ******************************************************************************************/
function ds_cond_onvaluechanged(obj:Dataset,  e:DSColChangeEventInfo)
{
	fn_initData();
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : tab_menu_tabpage2_btn_menuGuid_onclick(obj:Button,  e:ClickEventInfo)
 * 기ㅡㅡㅡ능 : 메뉴지도
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-22
 ******************************************************************************************/
function tab_menu_tabpage2_btn_menuGuid_onclick(obj:Button,  e:ClickEventInfo)
{
	if(ds_menuGuid.getRowCount() > 0)
	{
		var fa_GUID_YEAR = ds_menuGuid.getColumn(0, "GUID_YEAR");
		var fa_GUID_SEQ = ds_menuGuid.getColumn(0, "GUID_SEQ");
		var fa_REQ_NUM = ds_menuGuid.getColumn(0, "REQ_NUM");

		var	v_arg = {fa_CALL_MODE:"U",fa_GUID_YEAR:fa_GUID_YEAR,fa_GUID_SEQ:fa_GUID_SEQ,fa_REQ_NUM:fa_REQ_NUM};
		gfn_dialog("", "U_FSM::FSM00732P.xfdl", v_arg);
	}
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_tmChange(obj, data)
 * 기ㅡㅡㅡ능 : 운영부서 변경시 사업장 초기화
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-03-27
 ******************************************************************************************/
function fn_tmChange(obj, data)
{
	if(gfn_isNull(edt_tm.getTmCode()))
	{
		cbo_mu.setMuCode("");
	}
	edt_upjang.setUpjangCode("");
	ds_cboHall.clearData();
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : btn_prev_onclick(obj:Button,  e:ClickEventInfo)
 * 기ㅡㅡㅡ능 : 전주
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-03-27
 ******************************************************************************************/
function btn_prev_onclick(obj:Button,  e:ClickEventInfo)
{
	ds_cond.setColumn(0, "MENU_DATE", gfn_addDate(ds_cond.getColumn(0, "MENU_DATE"), -7));
	fn_search();
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : btn_next_onclick(obj:Button,  e:ClickEventInfo)
 * 기ㅡㅡㅡ능 : 차주
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-03-27
 ******************************************************************************************/
function btn_next_onclick(obj:Button,  e:ClickEventInfo)
{
	ds_cond.setColumn(0, "MENU_DATE", gfn_addDate(ds_cond.getColumn(0, "MENU_DATE"), 7));
	fn_search();
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : btn_menuCreate_onclick(obj:Button,  e:ClickEventInfo)
 * 기ㅡㅡㅡ능 : 식단일괄생성
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-22
 ******************************************************************************************/
function btn_menuCreate_onclick(obj:Button,  e:ClickEventInfo)
{
    var v_arg = {};
	v_arg["fa_UPJANG"]       = gfn_trim(ds_cond.getColumn(0, "UPJANG"));
	v_arg["fa_UPJANGNM"]     = gfn_trim(ds_cond.getColumn(0, "UPJANGNM"));
	v_arg["fa_HALL_CD"]      = gfn_trim(ds_cond.getColumn(0, "HALL_CD"));
	v_arg["fa_HALL_NAME"]    = gfn_trim(cbo_hall.text);
	v_arg["fa_FROM_DT"]      = gfn_trim(ds_cond.getColumn(0, "MENU_SDATE"));
	v_arg["fa_TO_DT"]        = gfn_trim(ds_cond.getColumn(0, "MENU_EDATE"));
	v_arg["fa_SUBINV_CODE"]  = gfn_trim(ds_cond.getColumn(0, "SUBINV_CODE"));
    v_arg["fa_HALL_CLASS"]   = ds_cboHall.lookup("HALL_CD", ds_cond.getColumn(0, "HALL_CD"), "HALL_CLASS");

	gfn_dialog("", "U_FSM::FSM90600P.xfdl", v_arg);	
	
	// 일괄등록이 완료되면 다시 조회한다.
	fn_search();	
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : tab_menu_tabpage1_grd_mealQtyList_oncelldblclick(obj:Grid, e:GridClickEventInfo)
 * 기ㅡㅡㅡ능 : 식수예측 그리드 클릭시 4주간 실식수 조회
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function tab_menu_tabpage1_grd_mealQtyList_oncelldblclick(obj:Grid, e:GridClickEventInfo)
{
	if(e.col < 2) return;

	// 일자정보를 추출하기 위해 선택된 컬럼의 ID를 찾는다.
	var val = tab_menu.tabpage1.grd_mealQtyList.getCellProperty("body", e.cell, "text");
	if(!gfn_isNull(val))
	{
		val = 'D' + gfn_right(val.replace("bind:", ""), 1);
	}
	
	// 조회조건 생성
	var otherArg = "";
	otherArg += "MEAL=" + wrapQuote(ds_mealQtyList.getColumn(e.row, "SGBN"));
	otherArg += " CORNER=" + wrapQuote(ds_mealQtyList.getColumn(e.row, "CGBN_CD"));
	otherArg += " SEL_DATE=" + wrapQuote(ds_mealQtyList.getColumn(e.row, val));
	
	fn_realMealQtySearch(otherArg);		
}

function tab_menu_tabpage1_grd_mealQtyList_onheadclick(obj:Grid, e:GridClickEventInfo)
{
	return false;
}

function tab_menu_tabpage2_grd_menuList_onheadclick(obj:Grid, e:GridClickEventInfo)
{
	return false;
}

function cal_menuDate_onkeydown(obj:ObjCalendar, e:KeyEventInfo)
{
	if(e.keycode == 13) {
		tab_menu.setFocus();
		fn_search();
	}
}

function btn_searchRate_onclick(obj:Button,  e:ClickEventInfo)
{
	// 식재료율 조회
	fn_getRateMonth();		
}]]></Script>
  </Form>
</FDL>
