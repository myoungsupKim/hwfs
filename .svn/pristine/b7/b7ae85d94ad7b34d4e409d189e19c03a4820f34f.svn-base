<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="../../../default_typedef.xml"/>
  <Form id="form" onkeydown="form_OnKeyDown" onload="form_onload" titletext="병원주기식단" position="absolute 0 0 1252 725" scrollbars="none">
    <Layouts>
      <Layout>
        <Grid selecttype="cell" autoenter="select" scrollbars="alwayshorz" binddataset="ds_FSH_CYCLE_Pivot" cellmovingtype="col" cellsizingtype="both" readonly="false" enable="true" id="grd_FSH_CYCLE_Pivot" useinputpanel="false" oncellclick="grd_FSH_CYCLE_Pivot_OnCellClick" oncelldblclick="grd_FSH_CYCLE_Pivot_OnCellDblClick" onheadclick="grd_FSH_CYCLE_Pivot_OnHeadClick" onkeydown="grd_FSH_CYCLE_Pivot_OnKeyDown" onmousemove="grd_FSH_CYCLE_Pivot_OnMouseOver" onrbuttondown="grd_FSH_CYCLE_Pivot_OnRButtonDown" taborder="11" tabstop="true" usecontextmenu="true" useselcolor="true" visible="true" wheelscrollrow="1" position="absolute 0 117 1237 710" anchor="all">
          <Formats>
            <Format id="Default">
              <Columns>
                <Column size="93" band="left"/>
                <Column size="50" band="left"/>
                <Column size="60" band="left"/>
              </Columns>
              <Rows>
                <Row size="30" band="head"/>
                <Row size="15"/>
              </Rows>
              <Band id="head">
                <Cell displaytype="text" style="align:center;background:#566572ff URL('theme://convertImages/new/img_WF_Excel.png') left middle;" class="head_Excel" text="코너"/>
                <Cell col="1" displaytype="text" text="끼니"/>
                <Cell col="2" displaytype="text" text="구성&#10;요소"/>
              </Band>
              <Band id="body">
                <Cell displaytype="text" style="align:center;background:#99ccffff;background2:#99ccffff;font:Gulim,9,bold;" text="bind:CORNER_NAME" expr="expr:fn_exprCornerName(currow)" suppress="1" suppressalign="middle,over"/>
                <Cell col="1" displaytype="text" style="align:center;background:#ffffccff;background2:#ffffccff;font:Gulim,9,bold;" text="bind:MEAL_NAME" subsumtext="*****" suppress="2" suppressalign="middle,over"/>
                <Cell col="2" displaytype="text" style="align:left;background:EXPR(iif(getRowLevel(currow)==1,'#FFFFBB','#F8F8F8'));background2:EXPR(iif(getRowLevel(currow)==1,'#FFFFBB','#F8F8F8'));" text="bind:MAJOR_DISH_INFO_NAME" subsumtext="식단원가"/>
              </Band>
            </Format>
            <Format id="B">
              <Columns>
                <Column size="93" band="left"/>
                <Column size="50" band="left"/>
                <Column size="60" band="left"/>
              </Columns>
              <Rows>
                <Row size="30" band="head"/>
                <Row size="15"/>
              </Rows>
              <Band id="head">
                <Cell displaytype="text" style="align:center;background:#566572ff URL('theme://convertImages/new/img_WF_Excel.png') left middle;" class="head_Excel" text="코너"/>
                <Cell col="1" displaytype="text" text="끼니"/>
                <Cell col="2" displaytype="text" text="구성&#10;요소"/>
              </Band>
              <Band id="body">
                <Cell displaytype="text" style="align:center;background:#99ccffff;background2:#99ccffff;font:Gulim,9,bold;" text="bind:CORNER_NAME" expr="expr:fn_exprCornerName(currow)" suppress="1" suppressalign="middle,over"/>
                <Cell col="1" displaytype="text" style="align:center;background:#ffffccff;background2:#ffffccff;font:Gulim,9,bold;" text="bind:MEAL_NAME" subsumtext="*****" suppress="2" suppressalign="middle,over"/>
                <Cell col="2" displaytype="text" style="align:left;background:EXPR(iif(getRowLevel(currow)==1,'#FFFFBB','#F8F8F8'));background2:EXPR(iif(getRowLevel(currow)==1,'#FFFFBB','#F8F8F8'));" text="bind:MAJOR_DISH_INFO_NAME" subsumtext="식단원가"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Static id="sta_detail05" onclick="sta_detail05_onclick" class="sta_WFDA_Labelbg" position="absolute 0 77 1237 104" anchor="left top right"/>
        <Static id="Static08" class="sta_WFSA_Labelbg" position="absolute 0 29 1237 70" anchor="left top right"/>
        <Edit enable="false" id="ed_MENU_CYCLE" taborder="22" visible="false" position="absolute 549 78 577 103"/>
        <Edit id="ed_UPJANG_NM" ontextchanged="ed_UPJANG_NM_OnChanged" onkeydown="ed_UPJANG_NM_OnKeyDown" readonly="true" taborder="1" tooltiptext="사업장" position="absolute 72 40 200 61"/>
        <Combo codecolumn="HALL_CD" datacolumn="HALL_NAME" id="cbo_upjang_hall" index="0" innerdataset="ds_upjang_hall" onitemchanged="cbo_upjang_hall_OnChanged" taborder="2" tooltiptext="식당명" position="absolute 305 40 437 61"/>
        <Static id="st10" text="사업장" position="absolute 16 41 114 62" class="sta_WFSA_label"/>
        <Static id="Static1" text="식당명" position="absolute 251 41 339 62" class="sta_WFSA_label"/>
        <Static id="Static2" text="주기식단등록월" position="absolute 671 41 778 62" class="sta_WFSA_label"/>
        <Static id="Static0" text="코너" position="absolute 468 41 534 62" class="sta_WFSA_label"/>
        <Combo codecolumn="CORNER" datacolumn="CORNER_NAME" id="cbo_upjang_hall_corner" index="0" innerdataset="ds_upjang_hall_corner" taborder="7" tooltiptext="코너" position="absolute 509 40 641 61"/>
        <Calendar enable="false" id="cal_START_DATE" taborder="9" tooltiptext="주기시작일" visible="false" position="absolute 380 80 463 101" dateformat="yyyy-MM-dd" type="normal"/>
        <Calendar enable="false" id="cal_END_DATE" taborder="10" tooltiptext="주기종료일" visible="false" position="absolute 465 80 548 101" dateformat="yyyy-MM-dd" type="normal"/>
        <MaskEdit id="me_Month" mask="####-##" onsetfocus="g_Date_OnFocus" onkillfocus="g_Month_OnKillFocus" taborder="12" tooltiptext="주기식단등록월" type="string" position="absolute 777 40 839 61" style="align:center;" canchange="me_Month_OnCharChanged" oneditclick="me_Month_oneditclick"/>
        <Button id="btn_MONTH" taborder="13" tabstop="false" userdata="me_Month" position="absolute 838 40 858 61" class="btn_WF_popSearch" text="" image="" onclick="btn_MONTH_onclick"/>
        <Static id="Static01" text="식재료율 목표/실적" position="absolute 0 77 132 104" class="sta_WFDA_Label01"/>
        <MaskEdit enable="false" id="me_GOAL_COST_RATE" mask="###.#" ontextchanged="me_sikrate_OnChanged" taborder="16" position="absolute 134 80 176 101"/>
        <Button id="btn_RECIPE_CHANGE" onclick="btn_RECIPE_CHANGE_OnClick" taborder="18" text="레시피 일괄변경" tooltiptext="레시피복사는화면에서 복사붙여넣기(Cont+C,V)를 하세요." position="absolute 821 80 920 101" class="btn_WF_Custom" image="" anchor="top right"/>
        <Button id="btn_CORNER_COPY" onclick="btn_CORNER_COPY_OnClick" taborder="19" text="코너일괄복사" position="absolute 921 80 1008 101" class="btn_WF_Custom" image="" anchor="top right"/>
        <Button id="btn_MENU_COPY" onclick="btn_MENU_COPY_OnClick" taborder="20" tooltiptext="레시피복사는화면에서 복사붙여넣기(Cont+C,V)를 하세요." position="absolute 1009 80 1084 101" class="btn_WF_Custom" image="" text="식단복사" anchor="top right"/>
        <Static id="Static5" text="%" position="absolute 178 86 199 98"/>
        <Button id="btn_UPJANG" onclick="btn_UPJANG_OnClick" taborder="23" text="" position="absolute 199 40 221 61" class="btn_WF_popSearch" image=""/>
        <CheckBox id="chk_SEARCH_ALL" onclick="chk_SEARCH_ALL_OnClick" taborder="24" text="원가포함조회" value="false" position="absolute 888 41 981 62" truevalue="1" falsevalue="0"/>
        <Edit enable="false" id="ed_MENU_CYCLE_NAME" readonly="true" taborder="25" tooltiptext="식단주기" position="absolute 344 80 378 101" style="align:center;"/>
        <PopupDiv id="PopupDiv0" OnKeyDown="PopupDiv0_OnKeyDown" taborder="28" tabstop="false" position="absolute 984 288 1216 455" scrollbars="none" style="background:#ffffffff;border:2 solid #515d6fff ;">
          <Layouts>
            <Layout>
              <Static id="Static1" text="★★★ 클립보드 레시피 정보 ★★★" position="absolute 2 2 226 23" style="background:#ffff99ff;" anchor="default"/>
              <Static id="Static0" text="식 당 명" position="absolute 2 44 90 62" class="sta_WFDA_Label01" anchor="default"/>
              <Static id="st_HALL" position="absolute 91 44 226 62" class="sta_WFDA_Labelbg" anchor="default"/>
              <Static id="Static2" text="코 너 명" position="absolute 2 64 90 82" class="sta_WFDA_Label01" anchor="default"/>
              <Static id="st_CORNER" position="absolute 91 64 226 82" class="sta_WFDA_Labelbg" anchor="default"/>
              <Static id="Static4" text="끼 니 명" position="absolute 2 84 90 102" class="sta_WFDA_Label01" anchor="default"/>
              <Static id="st_MEAL" position="absolute 91 84 226 102" class="sta_WFDA_Labelbg" anchor="default"/>
              <Static id="Static6" text="레시피코드" position="absolute 2 104 90 122" class="sta_WFDA_Label01" anchor="default"/>
              <Static id="st_RECIPE_CD" position="absolute 91 104 226 122" class="sta_WFDA_Labelbg" anchor="default"/>
              <Static id="Static8" text="레시피명" position="absolute 2 124 90 142" class="sta_WFDA_Label01" anchor="default"/>
              <Static id="st_RECIPE_NAME" position="absolute 91 124 226 142" class="sta_WFDA_Labelbg" anchor="default"/>
              <Static id="st_UPJANG" visible="false" position="absolute 4 25 20 39" class="sta_WFDA_Label01" anchor="default"/>
              <Static id="st_MENU_DATE" position="absolute 91 24 226 42" class="sta_WFDA_Labelbg" anchor="default"/>
              <Static id="Static00" text="메뉴날짜" position="absolute 2 24 90 42" class="sta_WFDA_Label01" anchor="default"/>
              <Static id="Static3" text="⊙ Control+c 키를 누르면 보입니다." position="absolute 2 144 226 163" style="background:#ffffffff;" anchor="default"/>
            </Layout>
          </Layouts>
        </PopupDiv>
        <Button id="btn_pyo" onclick="btn_pyo_OnClick" taborder="29" position="absolute 1085 80 1160 101" class="btn_WF_Custom" image="" text="식단평가" anchor="top right"/>
        <Button id="btn_rut" onclick="btn_rut_OnClick" taborder="30" position="absolute 1161 80 1236 101" class="btn_WF_Custom" image="" text="영양분석" anchor="top right"/>
        <MaskEdit enable="false" id="me_EXPECT_COST_RATE" mask="###.#" ontextchanged="me_sikrate_OnChanged" taborder="31" position="absolute 194 80 236 101"/>
        <Static id="Static6" text="%" position="absolute 236 86 257 98"/>
        <Static id="Static7" text="식단주기" position="absolute 254 77 342 104" class="sta_WFDA_Label01"/>
        <PopupDiv id="PopupDiv1" OnKeyDown="PopupDiv1_OnKeyDown" taborder="34" tabstop="false" position="absolute 984 163 1216 272" scrollbars="none" style="background:#ffffffff;border:2 solid #515d6fff ;">
          <Layouts>
            <Layout>
              <Static id="Static1" text="★★★ 복사된 식단 정보 ★★★" position="absolute 2 2 226 23" style="background:#ffff99ff;" anchor="default"/>
              <Static id="Static0" text="식 당 명" position="absolute 2 44 90 62" class="sta_WFDA_Label01" anchor="default"/>
              <Static id="st_HALL" position="absolute 91 44 226 62" class="sta_WFDA_Labelbg" anchor="default"/>
              <Static id="Static2" text="코 너 명" position="absolute 2 64 90 82" class="sta_WFDA_Label01" anchor="default"/>
              <Static id="st_CORNER" position="absolute 91 64 226 82" class="sta_WFDA_Labelbg" anchor="default"/>
              <Static id="Static4" text="끼 니 명" position="absolute 2 84 90 102" class="sta_WFDA_Label01" anchor="default"/>
              <Static id="st_MEAL" position="absolute 91 84 226 102" class="sta_WFDA_Labelbg" anchor="default"/>
              <Static id="st_UPJANG" visible="false" position="absolute 4 25 20 39" class="sta_WFDA_Label01" anchor="default"/>
              <Static id="st_MENU_DATE" position="absolute 91 24 226 42" class="sta_WFDA_Labelbg" anchor="default"/>
              <Static id="Static00" text="메뉴날짜" position="absolute 2 24 90 42" class="sta_WFDA_Label01" anchor="default"/>
            </Layout>
          </Layouts>
        </PopupDiv>
        <Div id="div_cmnBtn" anchor="left top right" taborder="35" url="cmn::CmnBtn.xfdl" text="Div00" scrollbars="none" position="absolute 0 0 1237 30"/>
        <Static id="Static21" text="W10" visible="false" position="absolute 0 30 1237 40" style="background:#ff000055;align:center middle;"/>
        <Static id="Static05" text="W10" visible="false" position="absolute 0 61 1237 71" style="background:#ff000055;align:center middle;"/>
        <Static id="Static28" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 767 40 777 61"/>
        <Static id="Static27" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 641 40 671 61"/>
        <Static id="Static26" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 499 40 509 61"/>
        <Static id="Static25" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 437 40 467 61"/>
        <Static id="Static24" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 295 40 305 61"/>
        <Static id="Static20" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 221 40 251 61"/>
        <Static id="Static18" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 62 40 72 61"/>
        <Static id="Static23" text="W15" visible="false" position="absolute 1 40 16 61" style="background:#ff000055;align:center middle;"/>
        <Static id="Static15" text="h06" onclick="Static03_onclick" class="Guide01_AreaRed" visible="false" position="absolute 0 71 144 84" anchor="top right"/>
        <Static id="Static16" text="h06" onclick="Static03_onclick" class="Guide01_AreaRed" visible="false" position="absolute 1093 71 1237 77" anchor="top right"/>
        <Static id="Static19" text="h05" class="Guide01_AreaRed" visible="false" position="absolute 1093 97 1237 102" anchor="top right"/>
        <Static id="Static17" text="w15" onclick="Static06_onclick" class="Guide01_AreaRed" visible="false" position="absolute 1237 0 1252 710" anchor="top right"/>
        <Static id="Static71" text="h15" onclick="Static71_onclick" class="Guide01_AreaRed" visible="false" position="absolute 0 710 1252 725" anchor="left bottom"/>
        <Static id="Static09" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 858 40 888 61"/>
        <Static id="Static03" text="h06" onclick="Static03_onclick" class="Guide01_AreaRed" visible="false" position="absolute 0 104 144 117" anchor="top right"/>
        <Grid scrollbars="alwaysvert" binddataset="ds_FSH_CYCLE_PRICE" enable="true" id="grd_FSH_CYCLE_PRICE" useinputpanel="false" onheadclick="grd_FSH_CYCLE_PRICE_OnHeadClick" taborder="26" tabstop="true" usecontextmenu="true" useselcolor="true" visible="false" wheelscrollrow="1" position="absolute 0 592 1237 710" readonly="true" selecttype="row" autofittype="col" anchor="left right bottom">
          <Formats>
            <Format id="Default">
              <Columns>
                <Column size="104"/>
                <Column size="155"/>
                <Column size="87"/>
                <Column size="58"/>
                <Column size="90"/>
                <Column size="140"/>
                <Column size="90"/>
                <Column size="140"/>
                <Column size="94"/>
              </Columns>
              <Rows>
                <Row size="22" band="head"/>
                <Row size="20"/>
                <Row size="22" band="summ"/>
              </Rows>
              <Band id="head">
                <Cell displaytype="text" style="align:center;background:#566572ff URL('theme://convertImages/new/img_WF_Excel.png') left middle;" class="head_Excel" text="주기식단일"/>
                <Cell col="1" displaytype="text" text="코너"/>
                <Cell col="2" displaytype="text" text="끼니"/>
                <Cell col="3" displaytype="text" text="예상식수"/>
                <Cell col="4" text="원가"/>
                <Cell col="5" text="(예상식수)원가"/>
                <Cell col="6" text="판매가"/>
                <Cell col="7" text="(예상식수)판매가"/>
                <Cell col="8" displaytype="text" text="식단원가율(%)"/>
              </Band>
              <Band id="body">
                <Cell displaytype="text" style="align:expr:iif(getRowLevel(currow)==1,'right');background:EXPR(iif(getRowLevel(currow)==1,'#FFFFBB','#FFFFFF'));background2:EXPR(iif(getRowLevel(currow)==1,'#FFFFBB','#FFFFFF'));" text="bind:MENU_DATE" expr="expr:fn_expr(currow)" suppress="1"/>
                <Cell col="1" displaytype="text" style="align:left;background:EXPR(iif(getRowLevel(currow)==1,'#FFFFBB','#FFFFFF'));background2:EXPR(iif(getRowLevel(currow)==1,'#FFFFBB','#FFFFFF'));" text="bind:CORNER_NAME" expr="expr:iif(getRowLevel(currow)==1,ds_FSH_CYCLE_PRICE.getColumn(currow-1,'CORNER_NAME')+&quot; (일)원가정보&quot;,CORNER_NAME)" suppress="2"/>
                <Cell col="2" displaytype="text" style="align:left;background:EXPR(iif(getRowLevel(currow)==1,'#FFFFBB','#FFFFFF'));background2:EXPR(iif(getRowLevel(currow)==1,'#FFFFBB','#FFFFFF'));" text="bind:MEAL_NAME" subsumtext="*****"/>
                <Cell col="3" displaytype="number" style="background:EXPR(iif(getRowLevel(currow)==1,'#FFFFBB','#FFFFFF'));background2:EXPR(iif(getRowLevel(currow)==1,'#FFFFBB','#FFFFFF'));" text="bind:EXPECT_MEAL_QTY"/>
                <Cell col="4" displaytype="number" style="background:EXPR(iif(getRowLevel(currow)==1,'#FFFFBB','#FFFFFF'));background2:EXPR(iif(getRowLevel(currow)==1,'#FFFFBB','#FFFFFF'));" text="bind:MENU_COST_PRICE" mask="#,##0"/>
                <Cell col="5" displaytype="number" style="background:EXPR(iif(getRowLevel(currow)==1,'#FFFFBB','#FFFFFF'));background2:EXPR(iif(getRowLevel(currow)==1,'#FFFFBB','#FFFFFF'));" text="bind:TOT_MENU_COST_PRICE"/>
                <Cell col="6" displaytype="number" style="background:EXPR(iif(getRowLevel(currow)==1,'#FFFFBB','#FFFFFF'));background2:EXPR(iif(getRowLevel(currow)==1,'#FFFFBB','#FFFFFF'));" text="bind:SALE_PRICE"/>
                <Cell col="7" displaytype="number" style="background:EXPR(iif(getRowLevel(currow)==1,'#FFFFBB','#FFFFFF'));background2:EXPR(iif(getRowLevel(currow)==1,'#FFFFBB','#FFFFFF'));" text="bind:TOT_SALE_PRICE"/>
                <Cell col="8" displaytype="number" style="background:EXPR(iif(getRowLevel(currow)==1,'#FFFFBB','#FFFFFF'));background2:EXPR(iif(getRowLevel(currow)==1,'#FFFFBB','#FFFFFF'));" text="bind:TOT_COST_RATE"/>
              </Band>
              <Band id="summary">
                <Cell colspan="5" style="align:right;" text="주기식단 &gt;&gt; 원가(합) | 판매가(합) | 주기식단원가율"/>
                <Cell col="5" displaytype="number" style="align: ;" expr="expr:getSum(&quot;TOT_MENU_COST_PRICE&quot;)"/>
                <Cell col="6" style="align: ;"/>
                <Cell col="7" displaytype="number" style="align: ;" expr="expr:getSum(&quot;TOT_SALE_PRICE&quot;)"/>
                <Cell col="8" displaytype="number" style="align: ;" expr="expr:getSum(&quot;TOT_SALE_PRICE&quot;)&lt;1 ? 0 : Math.round(getSum(&quot;TOT_MENU_COST_PRICE&quot;)/getSum(&quot;TOT_SALE_PRICE&quot;)*100,2)" tooltiptype="top" tooltiptext="expr:getSum(&quot;TOT_MENU_COST_PRICE&quot;) + &quot;:&quot; +  getSum(&quot;TOT_SALE_PRICE&quot;)"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_upjang_hall"/>
      <Dataset id="ds_input">
        <ColumnInfo>
          <Column id="UPJANG" size="256" type="STRING"/>
          <Column id="UPJANG_NM" size="256" type="STRING"/>
          <Column id="HALL_CD" size="256" type="STRING"/>
          <Column id="MENU_DATE" size="256" type="STRING"/>
          <Column id="MENU_SDATE" size="256" type="STRING"/>
          <Column id="MENU_EDATE" size="256" type="STRING"/>
          <Column id="CURR_DATE" size="256" type="STRING"/>
          <Column id="COPY_FLAG" size="256" type="STRING"/>
          <Column id="EMP_NO" size="256" type="STRING"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="COPY_FLAG"/>
            <Col id="CURR_DATE"/>
            <Col id="EMP_NO"/>
            <Col id="HALL_CD"/>
            <Col id="MENU_DATE"/>
            <Col id="MENU_EDATE"/>
            <Col id="MENU_SDATE"/>
            <Col id="UPJANG"/>
            <Col id="UPJANG_NM"/>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_upjang_hall_corner">
        <ColumnInfo>
          <Column id="CORNER" size="256" type="STRING"/>
          <Column id="CORNER_NAME" size="256" type="STRING"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="CORNER"/>
            <Col id="CORNER_NAME"/>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_FSH_CYCLE">
        <ColumnInfo>
          <Column id="MENU_CD" size="71" type="STRING"/>
          <Column id="MENU_DATE" size="10" prop="text:" type="STRING"/>
          <Column id="UPJANG" size="22" type="BIGDECIMAL"/>
          <Column id="HALL_CD" size="20" type="STRING"/>
          <Column id="MEAL" size="20" type="STRING"/>
          <Column id="MEAL_NAME" size="100" type="STRING"/>
          <Column id="CORNER" size="20" type="STRING"/>
          <Column id="CORNER_NAME" size="100" type="STRING"/>
          <Column id="MAJOR_DISH_INFO" size="50" type="STRING"/>
          <Column id="MAJOR_DISH_INFO_NAME" size="100" type="STRING"/>
          <Column id="RECIPE_CD" size="20" type="STRING"/>
          <Column id="RECIPE_NAME" size="50" type="STRING"/>
          <Column id="RECIPE_COST_PRICE" size="22" type="BIGDECIMAL"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_GOAL_COST_RATE" oncolumnchanged="ds_GOAL_COST_RATE_OnColumnChanged">
        <ColumnInfo>
          <Column id="MENU_DATE" size="10" type="STRING"/>
          <Column id="UPJANG" size="22" type="BIGDECIMAL"/>
          <Column id="HALL_CD" size="20" type="STRING"/>
          <Column id="GOAL_COST_RATE" size="22" type="BIGDECIMAL"/>
          <Column id="FLAG" size="1" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_FSH_CYCLE_PRICE" keystring="G:MENU_DATE+CORNER_NAME">
        <ColumnInfo>
          <Column id="MENU_DATE" size="8" type="STRING"/>
          <Column id="UPJANG" size="22" type="BIGDECIMAL"/>
          <Column id="CORNER" size="20" type="STRING"/>
          <Column id="CORNER_NAME" size="20" type="STRING"/>
          <Column id="MEAL" size="20" type="STRING"/>
          <Column id="MEAL_NAME" size="20" type="STRING"/>
          <Column id="EXPECT_MEAL_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="MENU_COST_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="TOT_MENU_COST_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="SALE_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="TOT_SALE_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="TOT_COST_RATE" size="22" type="BIGDECIMAL"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_FSH_CYCLE_Pivot"/>
    </Objects>
    <Bind>
      <BindItem id="ed_UPJANG_NM_value" compid="ed_UPJANG_NM" propid="value" datasetid="ds_input" columnid="UPJANG_NM"/>
      <BindItem id="cbo_upjang_hall_value" compid="cbo_upjang_hall" propid="value" datasetid="ds_input" columnid="HALL_CD"/>
      <BindItem id="item5" compid="sta_detail05" propid="text" datasetid="ds_view" columnid="D_1"/>
    </Bind>
    <Script type="xscript4.0"><![CDATA[include "U_lib::lib_conversionCom.xjs";
/*
 ******************************************************************************************
 * 시스템구분: IFIS/식단관리/식단등록(병원)
 * 프로그램명: FSM00221E.XML
 * 기ㅡㅡㅡ능: 식단등록(병원)-병원주기식단
 * 작ㅡ성ㅡ자: 한화S&C 박종세
 * 작성ㅡ일자: 2008-05-13
 * ----------------------------------------------------------------------------------------
 * HISTORY    : 
 ******************************************************************************************
 */

//iif(rowlevel==1,MENU_COST_PRICE.avg +"원 ("+ Round((MENU_COST_PRICE.AVG/MENU_SALE_PRICE.AVG)*100,2) + "%)")

//=========================================================================================
// [ PART 1 ]
// Form에서 Include 할 내용을 정의
//
//========================================================================================= 
//@@컨버터에서 주석처리 #include "lib::tit_comm_0001.js"
//@@컨버터에서 주석처리 #include "LIB::lib_comm_0001.js"
//@@컨버터에서 주석처리 #include "lib::sc_comon.js"
//@@컨버터에서 주석처리 #include "lib::sc_sql_common.js"		// 사업장팝업용 Lib
//@@컨버터에서 주석처리 #include "lib::fs_common.js"

//=========================================================================================
// [ PART 2 ]
// Form에서 사용될 전역변수를 선언
//
//=========================================================================================
//=========================================================================================
// [ PART 3 ]
// Form Loading 시 작업 정의
//
//=========================================================================================
function form_onload(obj:Form, e:LoadEventInfo)
{
	gfn_formOnLoad(obj, false);

	   //폼 초기화
		fn_InitForm(obj);
}

//폼 초기화
function fn_InitForm(obj)
{
	// action 정보 생성 초기화 
	fsp_init(this);		
	
	//사업장 권한 셋팅
	fn_SetAuth("","","ed_UPJANG_NM", "btn_UPJANG");
	
	// 폼 데이터 초기화
	fn_InitData(false);
	
	//////////////////////////////////////////////////////
	/// 식단등록 화면은 점에 속해 있는 인원외에는 불가능하다
	/// 2008.05.16
	/////////////////////////////////////////////////////
   	if(toNumber(g_AuthLevel) < 99)
	{
		ed_UPJANG_NM.enable = false;
		btn_UPJANG.enable = false;
	}
}

// 폼데이터 초기화 
function fn_InitData(blnAllClear)
{
	
	if(gfn_today()<"200807")
	{
		this.me_Month.value="200807";
	}
	else
	{
		this.me_Month.value=gfn_today();
	}
	
	
	//로그인한 사용자 업장 셋팅
	ds_input.setColumn(0,"UPJANG_NM",g_UpjangNm);	
	ds_input.setColumn(0,"UPJANG",g_Upjang);	
	//초기화 후
	fn_After_InitData();
}

//초기화 콜백함수
function fn_After_InitData()
{
    //식당조회
	fn_Upjang_HallSearch();
}

//=========================================================================================
// [ PART 4 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,도움말,form닫기)
//
//=========================================================================================
/*------------------------------------------------------------
	1. Function ID : fn_Search()
	2. 개       요 : 업무프로세스에 따른 조회작업
	3. 기       능 : 검색버튼 입력 시 처리되는 작업
	4. 인 수 설 명:
*------------------------------------------------------------*/
function fn_search()
{

	  //필수 입력사항 체크-----------------------------------------------------------------------
	   if (!fn_Chk_SearchKey()) return false;

	   
	  //조회 조건만들기-----------------------------------------------------------------------
	   var otherArg;
	   otherArg		= otherArg + " UPJANG="+wrapQuote(ds_input.getColumn(0,"UPJANG"));
	   otherArg		= otherArg + " HALL_CD="+wrapQuote(gfn_trim(cbo_upjang_hall.value));
	   otherArg		= otherArg + " CORNER="+wrapQuote(gfn_trim(cbo_upjang_hall_corner.value));
	   otherArg		= otherArg + " START_DATE="+wrapQuote(cal_START_DATE.value);
	   otherArg		= otherArg + " END_DATE="+wrapQuote(cal_END_DATE.value);



	  // action 정보 삭제 초기화 
	   fsp_clear(this);
		

	  //원가율 포함조회		
	  if(chk_SEARCH_ALL.value=="1")
	   {
		  // 서버에서 조회할 정보 추가 ->>>>메뉴 레시피원가(chk_SEARCH_ALL가 UNCHECK이면 원가 조회안함.)
		  fsp_addSearch(this, "fs/fsm:FSM00221E_S001");
		  
		  //-->>식단의 원가정보 조회
	      fsp_addSearch(this, "fs/fsm:FSM00221E_S003");
	   
	   }
	   else
	   {
	     // 서버에서 조회할 정보 추가 ->>>> 
		  fsp_addSearch(this, "fs/fsm:FSM00221E_S002");
	   }

	  //데이터 초기화
	  ds_FSH_CYCLE.clearData();
	  ds_FSH_CYCLE_PRICE.clearData();
	  
	  // 서버 호출 
	  http.Sync = true;
	  fsp_callService(this, "", "", "", "ds_FSH_CYCLE=ds_FSH_CYCLE ds_FSH_CYCLE_PRICE=ds_FSH_CYCLE_PRICE " , otherArg, "fn_After_Search");	
	  //조회 실행-----------------------------------------------------------------------------
	  http.Sync = false;
	  
	
}

// 조회 후 콜백 함수 
function fn_After_Search()
{
    // 데이터셋 플래그 클리어
	ds_FSH_CYCLE.applyChange();
	
	// 데이터셋 플래그 클리어
	ds_FSH_CYCLE_PRICE.applyChange();
	
	//식당 식재료율을 가져온다.
	fn_Search_Hall_Goal_cost_rate();

	//g_Debug("ds_FSH_CYCLE_Pivot");
	
	//원가율 포함조회일 경우 
	if(chk_SEARCH_ALL.value=="1")
	{
		me_EXPECT_COST_RATE.value = Math.round(ds_FSH_CYCLE_PRICE.getSum("TOT_MENU_COST_PRICE")/ds_FSH_CYCLE_PRICE.getSum("TOT_SALE_PRICE")*100,2);
	}
	
	fn_createPivotDataset();	
	fn_createPivotGrid();
	    
    ds_FSH_CYCLE_Pivot.keystring = "";
    ds_FSH_CYCLE_Pivot.keystring = "G:CORNER+MEAL";
		
}

//피봇 데이터셋 생성
function fn_createPivotDataset()
{
		
    // 컬럼 구조 생성 및 값 셋팅
    ds_FSH_CYCLE_Pivot.enableevent = false;
    
    ds_FSH_CYCLE.keystring = "S:+CORNER+MEAL+MAJOR_DISH_INFO+MENU_DATE";
        
    ds_FSH_CYCLE_Pivot.clear();    
    ds_FSH_CYCLE_Pivot.addColumn("CORNER","string");
    ds_FSH_CYCLE_Pivot.addColumn("CORNER_NAME","string");
    ds_FSH_CYCLE_Pivot.addColumn("MEAL","string");
    ds_FSH_CYCLE_Pivot.addColumn("MEAL_NAME","string");    
    ds_FSH_CYCLE_Pivot.addColumn("MAJOR_DISH_INFO","string");
    ds_FSH_CYCLE_Pivot.addColumn("MAJOR_DISH_INFO_NAME","string");    
        
    var sCurMajorDishInfo = "";
    var sOrgMajorDishInfo = "";
    for (var i=0; i<ds_FSH_CYCLE.rowcount; i++) {	
		
		sCurMajorDishInfo = ds_FSH_CYCLE.getColumn(i, "MAJOR_DISH_INFO");
		
		var sMenuDate = ds_FSH_CYCLE.getColumn(i, "MENU_DATE");		
		
		var nAddRow = -1;
		if (sCurMajorDishInfo != sOrgMajorDishInfo) {
			nAddRow = ds_FSH_CYCLE_Pivot.addRow();
			ds_FSH_CYCLE_Pivot.setColumn(nAddRow, "CORNER", ds_FSH_CYCLE.getColumn(i, "CORNER"));
			ds_FSH_CYCLE_Pivot.setColumn(nAddRow, "CORNER_NAME", ds_FSH_CYCLE.getColumn(i, "CORNER_NAME"));
			ds_FSH_CYCLE_Pivot.setColumn(nAddRow, "MEAL", ds_FSH_CYCLE.getColumn(i, "MEAL"));
			ds_FSH_CYCLE_Pivot.setColumn(nAddRow, "MEAL_NAME", ds_FSH_CYCLE.getColumn(i, "MEAL_NAME"));
			ds_FSH_CYCLE_Pivot.setColumn(nAddRow, "MAJOR_DISH_INFO", ds_FSH_CYCLE.getColumn(i, "MAJOR_DISH_INFO"));
			ds_FSH_CYCLE_Pivot.setColumn(nAddRow, "MAJOR_DISH_INFO_NAME", ds_FSH_CYCLE.getColumn(i, "MAJOR_DISH_INFO_NAME"));
		}
				
		if (ds_FSH_CYCLE_Pivot.rowcount == 1) {
			ds_FSH_CYCLE_Pivot.addColumn("date"+sMenuDate, "string");	
			ds_FSH_CYCLE_Pivot.addColumn("RECIPE_COST_PRICE"+sMenuDate, "BIGDECIMAL");			
			ds_FSH_CYCLE_Pivot.addColumn("EXPECT_MEAL_QTY"+sMenuDate, "BIGDECIMAL");			
		}
		ds_FSH_CYCLE_Pivot.setColumn(ds_FSH_CYCLE_Pivot.rowposition, "date"+sMenuDate, ds_FSH_CYCLE.getColumn(i, "RECIPE_NAME"));
		ds_FSH_CYCLE_Pivot.setColumn(ds_FSH_CYCLE_Pivot.rowposition, "RECIPE_COST_PRICE"+sMenuDate, ds_FSH_CYCLE.getColumn(i, "RECIPE_COST_PRICE"));
		ds_FSH_CYCLE_Pivot.setColumn(ds_FSH_CYCLE_Pivot.rowposition, "EXPECT_MEAL_QTY"+sMenuDate, ds_FSH_CYCLE.getColumn(i, "EXPECT_MEAL_QTY"));
				
		sOrgMajorDishInfo = sCurMajorDishInfo;		
    }
    
    ds_FSH_CYCLE.keystring = "";
    ds_FSH_CYCLE_Pivot.rowposition = -1;
    ds_FSH_CYCLE_Pivot.enableevent = true;      
}

//피봇 그리드 생성
function fn_createPivotGrid()
{
	//그리드 초기화
    for (var i=grd_FSH_CYCLE_Pivot.getFormatColCount()-1; i>2; i--) {
		grd_FSH_CYCLE_Pivot.deleteContentsCol("body", i, false);
    }   
	
	var nSeq = 1;
	for (var i=0; i<ds_FSH_CYCLE_Pivot.colcount; i++) {
		var sColId = ds_FSH_CYCLE_Pivot.getColID(i);
		
		if (sColId.substr(0,4) == "date") {
			var nAppendCol = grd_FSH_CYCLE_Pivot.appendContentsCol();
			if (nAppendCol > -1) {
				grd_FSH_CYCLE_Pivot.setFormatColProperty(nAppendCol, "size", 120);
				grd_FSH_CYCLE_Pivot.setCellProperty("head", nAppendCol, "text", gfn_right("0"+nSeq,2) + "일차");
				grd_FSH_CYCLE_Pivot.setCellProperty("body", nAppendCol, "text", "bind:"+sColId);
				grd_FSH_CYCLE_Pivot.setCellProperty("body", nAppendCol, "align", "expr:iif(getRowLevel(currow)==1,'right','left')");
				grd_FSH_CYCLE_Pivot.setCellProperty("body", nAppendCol, "subsumtext", "*****");
				grd_FSH_CYCLE_Pivot.setCellProperty("body", nAppendCol, "background", "EXPR(fn_setBkColor(currow, '"+sColId+"'))");
				grd_FSH_CYCLE_Pivot.setCellProperty("body", nAppendCol, "background2", "EXPR(fn_setBkColor(currow, '"+sColId+"'))");
				nSeq += 1;
			}
		} else if (sColId.substr(0,17) == "RECIPE_COST_PRICE") {
			
			if (grd_FSH_CYCLE_Pivot.formatid == "B") {	
				var nAppendCol = grd_FSH_CYCLE_Pivot.appendContentsCol();
				if (nAppendCol > -1) {
					grd_FSH_CYCLE_Pivot.setFormatColProperty(nAppendCol, "size", 40);				
					grd_FSH_CYCLE_Pivot.setCellProperty("body", nAppendCol, "text", "bind:"+sColId);
					grd_FSH_CYCLE_Pivot.setCellProperty("body", nAppendCol, "align", "right");					
					grd_FSH_CYCLE_Pivot.setCellProperty("body", nAppendCol, "displaytype", "number");
					grd_FSH_CYCLE_Pivot.setCellProperty("body", nAppendCol, "background", "EXPR(fn_setBkColor(currow, '"+sColId+"'))");
					grd_FSH_CYCLE_Pivot.setCellProperty("body", nAppendCol, "background2", "EXPR(fn_setBkColor(currow, '"+sColId+"'))");
				}			
			}
		}		
	}
	if (grd_FSH_CYCLE_Pivot.formatid == "B") {	
		for (var i=0; i<grd_FSH_CYCLE_Pivot.getCellCount("head"); i++) {					
			
			var sColId = grd_FSH_CYCLE_Pivot.getCellProperty("body", i, "text").replace("bind:","");
			if (sColId.substr(0,17) == "RECIPE_COST_PRICE") {
				grd_FSH_CYCLE_Pivot.mergeContentsCell("head",0,i-1,0,i,i-1,true);
			}
		}
	}	
}

//Pivot의 원본 데이터셋에서 매칭되는 값을 구한다.
function fn_getOrgValue(nRow, sDate, sColId)
{	
	if (gfn_isNull(sDate)) {return;}

	var sCorner = ds_FSH_CYCLE_Pivot.getColumn(nRow, "CORNER");
	var sMeal = ds_FSH_CYCLE_Pivot.getColumn(nRow, "MEAL");
	var sMajorDishInfo = ds_FSH_CYCLE_Pivot.getColumn(nRow, "MAJOR_DISH_INFO");

	var nFindRow = ds_FSH_CYCLE.findRowExpr("MENU_DATE=='"+sDate+"' && CORNER=='"+sCorner+"' && MEAL=='"+sMeal+"' && MAJOR_DISH_INFO=='"+sMajorDishInfo+"'");
	if (nFindRow > -1) {
		return gfn_trim(ds_FSH_CYCLE.getColumn(nFindRow, sColId));
	} else {
		return "";
	}
}

function fn_setOrgValue(nRow, sDate, sColId, sValue)
{	
	if (gfn_isNull(sDate)) {return;}

	var sCorner = ds_FSH_CYCLE_Pivot.getColumn(nRow, "CORNER");
	var sMeal = ds_FSH_CYCLE_Pivot.getColumn(nRow, "MEAL");
	var sMajorDishInfo = ds_FSH_CYCLE_Pivot.getColumn(nRow, "MAJOR_DISH_INFO");

	var nFindRow = ds_FSH_CYCLE.findRowExpr("MENU_DATE=='"+sDate+"' && CORNER=='"+sCorner+"' && MEAL=='"+sMeal+"' && MAJOR_DISH_INFO=='"+sMajorDishInfo+"'");
	if (nFindRow > -1) {
		return ds_FSH_CYCLE.setColumn(nFindRow, sColId, sValue);
	} else {
		return "";
	}
}

function fn_setBkColor(nRow, sColId)
{	
	if (ds_FSH_CYCLE_Pivot.getRowLevel(nRow) == 1) {
		return "#FFFF99";
	} else {	
		var sCorner = ds_FSH_CYCLE_Pivot.getColumn(nRow, "CORNER");
		if (sCorner == undefined || sCorner == null) {
			return "#CCCCCC";
		} else {
			var sMakeColId = "EXPECT_MEAL_QTY"+sColId.replace("date","").replace("RECIPE_COST_PRICE","");	
			if (Number(ds_FSH_CYCLE_Pivot.getColumn(nRow, sMakeColId)) <= 0) {
				return "orangered";
			} else {
				return "#FFFFFF"; 
			}
		}
	}
}

// 조회 조건 검색
function fn_Chk_SearchKey()
{
   //체크로직- 틀리면 return false;    
   //업장
   if(!mfn_Chk_Obj_MustInput(ed_UPJANG_NM)) return false;
   
   //식당명
   if(!mfn_Chk_Obj_MustInput(cbo_upjang_hall)) return false;   
   
   //업장주기
   //if(!mfn_Chk_Obj_MustInput(ed_MENU_CYCLE)) return false;
   if(gfn_length(ed_MENU_CYCLE.value)==0)
   {
	  g_Message("EE","식단주기가 설정되어 있지 않습니다.\n\n식단주기를 설정한 후 사용하여 주십시요.");
 	  return false;
   }
   
   
   return true;
}
       


/*------------------------------------------------------------
	1. Function ID : fn_Print()
	2. 개       요 : 업무프로세스에 따른 인쇄 처리
	3. 기       능 : 인쇄버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*------------------------------------------------------------*/
function fn_print()
{
}

/*------------------------------------------------------------
	1. Function ID : fn_Close()
	2. 개       요 : 업무프로세스에 따른 폼 종료 
	3. 기       능 : 닫기버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*------------------------------------------------------------*/
function fn_Close()
{
	this.close();
}

/*------------------------------------------------------------
	1. Function ID : fn_Help()
	2. 개       요 : 업무프로세스에 따른 도움말 
	3. 기       능 : 도움말버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*------------------------------------------------------------*/
function fn_help()
{
}

//=========================================================================================
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
//
//=========================================================================================

//=========================================================================================
// [ PART 6 ]
// component Event 정의 ( User Define function )
// --> component Event의 기요,기능,동작 등 상세내용은 MiPlatform 메뉴얼을 참조하시기 바랍니다.
//=========================================================================================


/*
 ******************************************************************************************
 * 함  수  명   : btn_UPJANG_OnClick(obj)
 * 기      능   : 사업장 조회
 * 작  성  자   : 박종세
 * 작성  일자   : 2007-12-03  
 ******************************************************************************************
 */
function btn_UPJANG_OnClick(obj:Button, e:ClickEventInfo)
{
	fn_sql_common_setup(fn_MakeUpjangSQL(), 
						strMAQuery_UpjangKeyField, 
						strMAQuery_UpjangValueField, 
						strMAQuery_UpjangKeyFieldNM, 
						strMAQuery_UpjangValueFieldNM, 
						"", 
						"",
						"",   // 팀 비교
						strMAQuery_UpjangCaption
						,"UPJANG;UPJANGNM");
		
    if (gds_sql_common.getColumn(0, "ret_code") != "")
    {
		ds_input.setColumn(0,"UPJANG",gds_sql_common.getColumn(0, "ret_code"));
		ds_input.setColumn(0,"UPJANG_NM",gds_sql_common.getColumn(0, "ret_name"));
		
		//업장의 식당을 찾는다.
		fn_Upjang_HallSearch();

		//ds_upjang_hall.Filter("UPJANG=" + quote(gds_sql_common.GetColumn(0, "ret_code")));
		//cbo_upjang_hall.Index = 0;
		cbo_upjang_hall.setFocus();
    }
    else
    {
    	ds_input.setColumn(0,"UPJANG","");
		ds_input.setColumn(0,"UPJANG_NM","");
		ds_upjang_hall.filter("");
    }
}

function ed_UPJANG_NM_OnKeyDown(obj:Edit, e:KeyEventInfo)
{
	if(e.keycode == "13") {
		btn_UPJANG.click();
		return;
	}	
}

function ed_UPJANG_NM_OnChanged(obj:Edit, e:TextChangedEventInfo)
{
	fn_Upjang_HallSearch();
}







/*
 ******************************************************************************************
 * 함  수  명   : fn_Upjang_HallSearch()
 * 기      능   : 식당 정보를 콤보에 연결
 * 작  성  자   : 박종세
 * 작성  일자   : 2007-12-20 
 ******************************************************************************************
 */
function fn_Upjang_HallSearch()
{
	// 식당 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	
	
	// 조회전 초기화
	ds_upjang_hall.clearData();
	
	inData			= "";
	outData			= "ds_upjang_hall=gds_Csqlout";
	callBackFnc		= "fn_Upjang_HallSearch_After";
	otherArg		= "UPJANG="+wrapQuote(ds_input.getColumn(0,"UPJANG"));

	fsp_clear(this); 
    fsp_addSearch(this, "fs/fsc:FSA_HALL_MST_S001");								// 조회 
	http.Sync = true;
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);		// 서비스 호출 
	http.Sync = false;
	
}

//식당조회 후 이벤트
function fn_Upjang_HallSearch_After(errCode, errMsg)
{
	if(errCode!=0)
	{
		g_Message("EE",	"서비스 오류:시스템 관리자에게 문의하십시오");
		return;
	}

	////////////////////////////////////////////	
	//메뉴사이클이 지정된 식당만 조회한다.
	ds_upjang_hall.filter("gfn_length(MENU_CYCLE)>0");
	/////////////////////////////////////////////

	// 식당초기값 셋팅
	cbo_upjang_hall.index = 0;
	
	// 식당의 주기식단데이터 값 셋팅
	fn_MENU_CYCLE_to_DAYS(ds_upjang_hall.getColumn(0,"MENU_CYCLE"));
	
	// 코너조회
	fn_Upjang_CornerSearch();
}

////////////////////식당 변경시 이벤트///////////////////////
function cbo_upjang_hall_OnChanged(obj:Combo, e:ItemChangeEventInfo)
{
	//그리드 초기화
    for (var i=grd_FSH_CYCLE_Pivot.getFormatColCount()-1; i>2; i--) {
		grd_FSH_CYCLE_Pivot.deleteContentsCol("body", i, false);
    }   



	// 코너조회
	fn_Upjang_CornerSearch();
	
	//식당의 식재료율을 가져온다.
	fn_Search_Hall_Goal_cost_rate();
	
	
	//식당의 주기를 다시 가져온다.
	ed_MENU_CYCLE.value = ds_upjang_hall.getColumn(e.postindex,"MENU_CYCLE");
		
		
    //alert(ed_MENU_CYCLE.Text );
		
	//메뉴사이클로 시작일 종료일 셋팅
	fn_MENU_CYCLE_to_DAYS(ed_MENU_CYCLE.value);
	
	
	//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	//****** 중요.:::::: 조회 데이터를 Clear 시킨다.
	//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	ds_FSH_CYCLE.clearData();
	ds_FSH_CYCLE_Pivot.clear();
}









/*
 ******************************************************************************************
 * 함  수  명   : fn_Upjang_CornerSearch()
 * 기      능   : 업장의 코너 조회
 * 작  성  자   : 박종세
 * 작성  일자   : 2007-12-20 
 ******************************************************************************************
 */
//코너 정의
function fn_Upjang_CornerSearch()
{
	// 식당 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	
	inData			= "";
	outData			= "ds_upjang_hall_corner=ds_upjang_hall_corner";
	callBackFnc		= "";
	otherArg		= "UPJANG="+wrapQuote(ds_input.getColumn(0,"UPJANG"));
	otherArg		= otherArg + " HALL_CD="+wrapQuote(cbo_upjang_hall.value);
	otherArg		= otherArg + " BLANK='A'";
	
	fsp_clear(this); 
    fsp_addSearch(this, "fs/fsc:FSC_UPJANG_HALL_CORNER_S001");								// 조회 
	http.Sync = true;
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);		// 서비스 호출 
	http.Sync = false;
	
	// 초기값 셋팅
	cbo_upjang_hall_corner.index = 0;
	
}








/*
 ******************************************************************************************
 * 함  수  명   : fn_MENU_CYCLE_to_DAYS()
 * 기      능   : 주기계산 ===>>> 주기를 주기 시작일, 주기 종료일로 변경
 * 작  성  자   : 박종세
 * 작성  일자   : 2007-12-20 
 ******************************************************************************************
 */
///////////////////////////////////////////////////
////// 주기 계산하기 
//////////////////////////////////////////////////
function fn_MENU_CYCLE_to_DAYS(MENU_CYCLE)
{
	 //시작일은 매달 첫번째 날 1일을 기준으로 한다.   
	ed_MENU_CYCLE.value   = MENU_CYCLE;
	cal_START_DATE.value = gfn_subStr(this.me_Month.value,0,6)+"01";
	cal_END_DATE.value   = cal_START_DATE.value;
	
	switch (MENU_CYCLE)
	{
		case "001": //--> 07 일		
		 	 END_DATE=7;
	         //종료일은 주기식단의 종료일로 설정한다.
		   cal_END_DATE.value	  = gfn_addDate(cal_END_DATE.value, 6);
		   ed_MENU_CYCLE_NAME.value="07일";
		 	 break;

		case "002": //--> 10 일		
		 	 END_DATE=10;
	         //종료일은 주기식단의 종료일로 설정한다.
		    cal_END_DATE.value	  = gfn_addDate(cal_END_DATE.value, 9);
		    ed_MENU_CYCLE_NAME.value="10일";
			break;


		case "003": //--> 14 일
			 END_DATE=14;
	         //종료일은 주기식단의 종료일로 설정한다.
		   cal_END_DATE.value	  = gfn_addDate(cal_END_DATE.value, 13);
		   ed_MENU_CYCLE_NAME.value="14일";
		 	 break;

		case "004": //--> 15 일
		 	 END_DATE=15;
	         //종료일은 주기식단의 종료일로 설정한다.
		   cal_END_DATE.value	  = gfn_addDate(cal_END_DATE.value, 14);
		   ed_MENU_CYCLE_NAME.value="15일";
		    break;

		case "005": //--> 한달
			 END_DATE=31;
	         //종료일은 주기식단의 종료일로 설정한다.
		   cal_END_DATE.value	  = gfn_addDate(cal_END_DATE.value, 30);	   			 	 
		   ed_MENU_CYCLE_NAME.value="한달";	
		 	 break;
		default :
		    //값이 없을 경우 초기화 한다.
		   cal_START_DATE.value    = "";
		   cal_END_DATE.value      = "";
		   ed_MENU_CYCLE_NAME.value = "없음";
		     break;
	}
		
	//alert(cal_END_DATE.value);
	//alert(getLastDay(this.me_Month.Value));
	
	//종료일과 해당월의 마지막 날을 비교합니다.		 	 
	if(cal_END_DATE.value> getLastDay(gfn_subStr(this.me_Month.value,0,6)))
	{
		cal_END_DATE.value = getLastDay(gfn_subStr(this.me_Month.value,0,6));
	}	
		 	 
}

//마지막날을 구하는 함수
function getLastDay(yyyymm)
{
   var tDay = gfn_addMonth(yyyymm+"01",1);
   return gfn_addDate(tDay,-1);
}  

//주기월 클릭버튼 
function me_Month_OnClick(retDate)
{
	//var retDate = gfn_dialog("", "U_SCC::SCC_CALMONTH.xfdl","fa_Date="+wrapQuote(me_Month.value), -1,-1,"Title=false Status=false AutoSize=true Resize=false");
	
	
	/////////////////////////////////
	/// 2008-07-01 월 부터 시작한다.
	/////////////////////////////////
	if(retDate < "200807")
	{
		g_Message("EE", "식단은 2008년 07월부터 작성하실 수 있습니다.\n\n2008년 07월 이후 날짜를 선택하여 주십시요.");
		return false;
	}
	
	me_Month.value= retDate;
	
	//날짜 다시 계산하기-수정완료
	fn_MENU_CYCLE_to_DAYS(this.ed_MENU_CYCLE.text);
}

function me_Month_oneditclick(obj:MaskEdit,  e:EditClickEventInfo)
{
	g_CalButton_OnClick(btn_MONTH, e);
	
	me_Month_OnClick(me_Month.value);
}

function btn_MONTH_onclick(obj:Button,  e:ClickEventInfo)
{
	g_CalButton_OnClick(btn_MONTH, e);
	
	me_Month_OnClick(me_Month.value);
}


//주기월 선택버튼
function btn_MONTH_OnClick(obj:Button, e:ClickEventInfo)
{
	me_Month_OnClick(obj,"","","");
	
	/////////////////////////////////
	/// 2008-07-01 월 부터 시작한다.
	/////////////////////////////////


}

//주기월이 변경되었을 경우
function me_Month_OnCharChanged(obj:MaskEdit, e)
{
	 fn_MENU_CYCLE_to_DAYS(this.ed_MENU_CYCLE.text);
}




//레시피 등록하는 화면으로 
function grd_FSH_CYCLE_Pivot_OnCellDblClick(obj:Grid, e:GridClickEventInfo)
{

   var fa_UPJANG="";
   var fa_HALL_CD="";
   var fa_FROM_DT="";
   var fa_TO_DT="";
   var fa_MEAL="";
   var fa_CORNER="";
   var fa_MENU_DATE="";//cur_date
   var fa_SUBINV_CODE="";//cur_date


	fa_UPJANG    = ds_input.getColumn(0,"UPJANG");
	fa_HALL_CD   = this.cbo_upjang_hall.value;
	fa_FROM_DT   = this.cal_START_DATE.value;
	fa_TO_DT     = this.cal_END_DATE.value;
	fa_CORNER    = ds_FSH_CYCLE_Pivot.getColumn(e.row,"CORNER");
	fa_MEAL      = ds_FSH_CYCLE_Pivot.getColumn(e.row,"MEAL");
	fa_SUBINV_CODE = ds_upjang_hall.getColumn(0,"SUBINV_CODE");
	
	//--------------
	var nCell = e.cell;
	var sTemp = "";
	if (nCell > 2) {		
		sTemp = grd_FSH_CYCLE_Pivot.getCellProperty("body", nCell, "text");
	} else {
		sTemp = grd_FSH_CYCLE_Pivot.getCellProperty("body", 3, "text");
	}
	
	var sColId = sTemp.replace("bind:","");	
	sTemp = sTemp.replace("bind:date","").replace("RECIPE_COST_PRICE","");
	
	
	//fa_MENU_DATE = ds_FSH_CYCLE_Pivot.getColumn(e.row,"MENU_DATE", -1);
	fa_MENU_DATE = sTemp;
	//trace("fa_MENU_DATE=====>"+fa_MENU_DATE);
	
	if(gfn_length(fa_CORNER)==0)
	{
		g_Message("EE", "해당식단은 설정되지 않았거나 예상식수가 0 입니다.\n\n다른식단을 선택 또는 예상식수를 입력하십시요.");
		return false;	
	}
	
	var sDate = "";
	if (e.cell > 2) {		
		sDate = obj.getCellProperty("body", e.cell, "text").replace("bind:date","").replace("bind:","RECIPE_COST_PRICE");
	} 
	
	fa_EXPECT_MEAL_QTY = fn_getOrgValue(e.row, sDate, "EXPECT_MEAL_QTY");
	
	//trace("fa_EXPECT_MEAL_QTY==="+fa_EXPECT_MEAL_QTY);
	
	if(toNumber(fa_EXPECT_MEAL_QTY)<=0)
	{
		g_Message("EE", "해당식단은 예상식수가 0 입니다.\n\n예상식수를 먼저 입력하여 주십시요.");
		return false;	
	}
	


	
	//테스트코드
	//alert(fa_UPJANG + "." + fa_HALL_CD + "." + fa_FROM_DT + "." + fa_TO_DT + "." + fa_CORNER + "."  + fa_MEAL + "." + fa_MENU_DATE);	
    var v_arg = {};
	v_arg["fa_UPJANG"] = gfn_trim(fa_UPJANG);
	v_arg["fa_HALL_CD"] = gfn_trim(fa_HALL_CD);
	v_arg["fa_HALL_CLASS"] = '';
	v_arg["fa_FROM_DT"] = gfn_trim(fa_FROM_DT);
	v_arg["fa_TO_DT"] = gfn_trim(fa_TO_DT);
	v_arg["fa_MEAL"] = gfn_trim(fa_MEAL);
	v_arg["fa_CORNER"] = gfn_trim(fa_CORNER);
	v_arg["fa_MENU_DATE"] = gfn_trim(fa_MENU_DATE);
	v_arg["fa_SUBINV_CODE"] = gfn_trim(fa_SUBINV_CODE);
	
	//for (var a in v_arg) {
	//	trace(a + "<-----" + v_arg[a]);
	//}		
	
	v_open	 	= "TitleBar=false Status=false AutoSize=false Resize=false NoMove=false";
	//v_rtn 		= gfn_dialog("", "U_FSM::FSM00060E.xml", v_arg, v_width, v_height, v_open, leftPx, topPx);
	v_rtn 		= gfn_dialog("", "U_FSM::FSM00060H.xfdl", v_arg);
 
 
 
 
 
	//원가 정보는 새로 가져오지 않는다.
	chk_SEARCH_ALL.value  = false;
	fn_chk_SEARCH_ALL_OnClick(this.chk_SEARCH_ALL, 0);
		
	//등록이 완료되면 다시 조회한다.
	fn_search();
} 


///////////////////////////////
///// 레시피 일괄 변경 버튼 클릭
////////////////////////////////
function btn_RECIPE_CHANGE_OnClick(obj:Button, e:ClickEventInfo)
{
	//업장
     if(!mfn_Chk_Obj_MustInput(ed_UPJANG_NM)) return false;   
	//업장식당
     if(!mfn_Chk_Obj_MustInput(cbo_upjang_hall)) return false;
    //시작날짜
     if(!mfn_Chk_Obj_MustInput(cal_START_DATE)) return false;
    //종료날짜
     if(!mfn_Chk_Obj_MustInput(cal_END_DATE)) return false;
     
       
    var v_arg = {};
	v_arg["fa_UPJANG"]     = gfn_trim(ds_input.getColumn(0,"UPJANG"));
	v_arg["fa_UPJANG_NM"] = gfn_trim(ed_UPJANG_NM.value);
	v_arg["fa_HALL_CD"]   = gfn_trim(cbo_upjang_hall.value);
	v_arg["fa_HALL_NAME"] = gfn_trim(cbo_upjang_hall.text);
	v_arg["fa_FROM_DT"]   = gfn_trim(cal_START_DATE.value);
	v_arg["fa_TO_DT"]            = gfn_trim(cal_END_DATE.value);
	v_arg["fa_CYCLE_REAL_GUBUN"] = gfn_trim("CYCLE");
		
	//수정요구사항-이지선:: 현재 선택한 레시피 정보==> 파라미터 전달.
	var currRow = ds_FSH_CYCLE_Pivot.rowposition;	
	
	var nCell = grd_FSH_CYCLE_Pivot.getCellPos();	
	var sDate = "";
	if (nCell > 2) {		
		sDate = grd_FSH_CYCLE_Pivot.getCellProperty("body", nCell, "text").replace("bind:date","").replace("bind:","RECIPE_COST_PRICE");
	} 
	
    var fa_RECIPE_CD   = fn_getOrgValue(currRow, sDate, "RECIPE_CD");    
	var fa_RECIPE_NAME = fn_getOrgValue(currRow, sDate, "RECIPE_NAME");    
	
	if(gfn_length(fa_RECIPE_CD)==0)
    {
      fa_RECIPE_CD   = "";
      fa_RECIPE_NAME = "";
    }  
	
	
	v_arg["fa_RECIPE_CD"] = gfn_trim(fa_RECIPE_CD);
	v_arg["fa_RECIPE_NAME"] = gfn_trim(fa_RECIPE_NAME);
	
	
    v_open	 	= "TitleBar=false Status=false AutoSize=false Resize=false NoMove=false";
	v_rtn 		= gfn_dialog("", "U_FSM::FSM00222P.xfdl", v_arg);
 
 	//v_rtn 변경된 데이터가 있을 경우....
	if(v_rtn=="Y")
	{
		//원가 정보는 새로 가져오지 않는다.
		chk_SEARCH_ALL.value  = false;
		fn_chk_SEARCH_ALL_OnClick(this.chk_SEARCH_ALL, 0);
		
		//등록이 완료되면 다시 조회한다.
		fn_search();
    }	
}

////////////////////////
///// 코너 일괄 복사
////////////////////////
function btn_CORNER_COPY_OnClick(obj:Button, e:ClickEventInfo)
{
	  
    //업장
     if(!mfn_Chk_Obj_MustInput(ed_UPJANG_NM)) return false;   
	//업장식당
     if(!mfn_Chk_Obj_MustInput(cbo_upjang_hall)) return false;
    //시작날짜
     if(!mfn_Chk_Obj_MustInput(cal_START_DATE)) return false;
    //종료날짜
     if(!mfn_Chk_Obj_MustInput(cal_END_DATE)) return false;
       
    var v_arg = {};
	v_arg["fa_UPJANG"]     = gfn_trim(ds_input.getColumn(0,"UPJANG"));
	v_arg["fa_UPJANG_NM"] = gfn_trim(ed_UPJANG_NM.value);
	v_arg["fa_HALL_CD"]   = gfn_trim(cbo_upjang_hall.value);
	v_arg["fa_HALL_NAME"] = gfn_trim(cbo_upjang_hall.text);
	v_arg["fa_FROM_DT"]   = gfn_trim(cal_START_DATE.value);
	v_arg["fa_TO_DT"]     = gfn_trim(cal_END_DATE.value);
     
     
    v_open	 	= "TitleBar=false Status=false AutoSize=false Resize=false NoMove=false";
	v_rtn 		= gfn_dialog("", "U_FSM::FSM00221P.xfdl", v_arg);
 
 
	//v_rtn 변경된 데이터가 있을 경우....
	if(v_rtn=="Y")
	{
		//원가 정보는 새로 가져오지 않는다.
		chk_SEARCH_ALL.value  = false;
		fn_chk_SEARCH_ALL_OnClick(this.chk_SEARCH_ALL, 0);
		
		//등록이 완료되면 다시 조회한다.
		fn_search();
    }
     
}


////////////////////////
////// 주기식을 실식단으로 복사
////////////////////////
function btn_MENU_COPY_OnClick(obj:Button, e:ClickEventInfo)
{

	//업장
     if(!mfn_Chk_Obj_MustInput(ed_UPJANG_NM)) return false;   
	//업장식당
     if(!mfn_Chk_Obj_MustInput(cbo_upjang_hall)) return false;

	var v_arg = {};
	v_arg["fa_UPJANG"]    = gfn_trim(ds_input.getColumn(0,"UPJANG"));
	v_arg["fa_UPJANG_NM"] = gfn_trim(ed_UPJANG_NM.value);
	v_arg["fa_HALL_CD"]   = gfn_trim(cbo_upjang_hall.value);
	v_arg["fa_HALL_NAME"] = gfn_trim(cbo_upjang_hall.text);
	v_arg["fa_MENU_TYPE"] = gfn_trim("CYCLE");
     	
	v_open	 	= "TitleBar=false Status=false AutoSize=false Resize=false NoMove=false";
	v_rtn 		= gfn_dialog("", "U_FSM::FSM00224P.xfdl", v_arg);
 
}


///////////////////////////////
///// 원가율원가 포함조회 체크시
///////////////////////////////
function chk_SEARCH_ALL_OnClick(obj:CheckBox, e:ClickEventInfo)
{
   fn_chk_SEARCH_ALL_OnClick(obj, obj.value);
}	

function fn_chk_SEARCH_ALL_OnClick(obj, strValue)
{
   //체크박스 워닝(경고) 표시 공통함수...... 
   mfn_chk_display_warning(obj, obj.isChecked(), "1", "원가,원가율을 포함하여 조회하면\n조회속도가 느려질수 있습니다.");

   //그리드 모양 바꾸기
   if(chk_SEARCH_ALL.value==1)
   { 
		grd_FSH_CYCLE_Pivot.formatid="B";    
		fn_createPivotGrid();
				
		grd_FSH_CYCLE_PRICE.visible = true;
		grd_FSH_CYCLE_Pivot.position.bottom = grd_FSH_CYCLE_PRICE.position.top-2;
   }
   else
   { 
		grd_FSH_CYCLE_Pivot.formatid=""; 	
		fn_createPivotGrid();
		
		grd_FSH_CYCLE_PRICE.visible = false;
		grd_FSH_CYCLE_Pivot.position.bottom = grd_FSH_CYCLE_PRICE.position.bottom;
   }
}

///////////////////////////////////////////////////////////////////////
////// 식재료율
///////////////////////////////////////////////////////////////////////

//식재료율 가져오는 함수
function fn_Search_Hall_Goal_cost_rate()
{
	  //필수 입력사항 체크-----------------------------------------------------------------------
	   if (!fn_Chk_Search_Hall_Goal_cost_rate()) return false;
	
	  //조회 조건만들기-----------------------------------------------------------------------
	   var otherArg;
	   otherArg		= otherArg + " UPJANG="+wrapQuote(ds_input.getColumn(0,"UPJANG"));
	   otherArg		= otherArg + " HALL_CD="+wrapQuote(cbo_upjang_hall.value);
	   otherArg		= otherArg + " START_DATE="+wrapQuote(cal_START_DATE.value);
	   otherArg		= otherArg + " END_DATE="+wrapQuote(cal_END_DATE.value);

	  // action 정보 삭제 초기화 
	   fsp_clear(this);
			
	 // 서버에서 조회할 정보 추가  -->> 주간식단식재료율
	  fsp_addSearch(this, "fs/fsm:FSM00223E_S002");
	
	  // 서버 호출 
	  http.Sync = true;
	  fsp_callService(this, "", "", "", "ds_GOAL_COST_RATE=ds_GOAL_COST_RATE" , otherArg, "fn_After_Search_Hall_Goal_cost_rate");	
	  //조회 실행-----------------------------------------------------------------------------
	  http.Sync = false;	  
	  
}
function fn_After_Search_Hall_Goal_cost_rate()
{
	//식재료 목표율 셋팅
	me_GOAL_COST_RATE.value = ds_GOAL_COST_RATE.getColumn(0,"GOAL_COST_RATE");
	//FLAG Clear
	ds_GOAL_COST_RATE.applyChange();
}

// 조회 조건 검색
function fn_Chk_Search_Hall_Goal_cost_rate()
{
   //체크로직- 틀리면 return false;    
   //업장
   if(!mfn_Chk_Obj_MustInput(ed_UPJANG_NM)) return false;
   //식당명
   if(!mfn_Chk_Obj_MustInput(cbo_upjang_hall)) return false;   
   return true;
}

//주기식단 그리드의 셀을 클릭하면......원가정보 그리드의 셀 이동??? 
function grd_FSH_CYCLE_Pivot_OnCellClick(obj:Grid, e:GridClickEventInfo)
{
	if(ds_FSH_CYCLE_PRICE.rowcount<1){return false;}

	var fa_MENU_DATE, fa_CORNER, fa_MEAL;	
	
	var sColId = "";
	if (e.cell > 2) {
		sColId = ds_FSH_CYCLE_Pivot.getColID(e.cell+3);
	} else {
		sColId = ds_FSH_CYCLE_Pivot.getColID(6);
	}
	
	//fa_MENU_DATE = ds_FSH_CYCLE_Pivot.getColumn(e.row,"MENU_DATE", -1);
	fa_MENU_DATE = sColId.replace("date","").replace("RECIPE_COST_PRICE","");
			
	fa_CORNER    = ds_FSH_CYCLE_Pivot.getColumn(e.row,"CORNER");
	fa_MEAL      = ds_FSH_CYCLE_Pivot.getColumn(e.row,"MEAL");
	
	//trace("MENU_DATE=='"+fa_MENU_DATE+"'&&CORNER=='"+ fa_CORNER +"'&&MEAL=='"+ fa_MEAL +"'");

	var fndIndex;	
	fndIndex = ds_FSH_CYCLE_PRICE.findRowExpr("MENU_DATE=='"+fa_MENU_DATE+"'&&CORNER=='"+ fa_CORNER +"'&&MEAL=='"+ fa_MEAL +"'");
	//trace(fndIndex);
	if(fndIndex==-1) { return false;}
	
	ds_FSH_CYCLE_PRICE.rowposition=fndIndex;
	
}


//////////////////////////////////////////////
// 삭제키를 누르면(DEL) 레시피 삭제를 구현한다.
//////////////////////////////////////////////
var nDeleteRow = -1
var sDeleteDate = "";
function grd_FSH_CYCLE_Pivot_OnKeyDown(obj:Grid, e:KeyEventInfo)
{
    //DEL 키코드는 46번이다.
	if(e.keycode<>"46"){ return false;}
	
	var currRow;   currRow   = ds_FSH_CYCLE_Pivot.rowposition;
	var currPvIdx; /* pivotIndex은 지원되지 않는 속성입니다.*/// currPvIdx = ds_FSH_CYCLE_Pivot.pivotIndex;
	
	var fa_MENU_DATE, fa_UPJANG, fa_HALL_CD, fa_CORNER,fa_CORNER_NAME, fa_MEAL, fa_MEAL_NAME;
	
	var nCell = obj.getCellPos();	
	var sDate = "";
	if (nCell > 2) {		
		sDate = obj.getCellProperty("body", nCell, "text").replace("bind:date","").replace("bind:","RECIPE_COST_PRICE");
	} 
	
			
	fa_UPJANG      = fn_getOrgValue(currRow, sDate, "UPJANG");
	fa_HALL_CD     = fn_getOrgValue(currRow, sDate, "HALL_CD");
	fa_MENU_DATE   = sDate;
	fa_CORNER      = ds_FSH_CYCLE_Pivot.getColumn(currRow,"CORNER");
	fa_CORNER_NAME = ds_FSH_CYCLE_Pivot.getColumn(currRow,"CORNER_NAME");
	fa_MEAL        = ds_FSH_CYCLE_Pivot.getColumn(currRow,"MEAL");
	fa_MEAL_NAME   = ds_FSH_CYCLE_Pivot.getColumn(currRow,"MEAL_NAME");
	fa_RECIPE_CD   = fn_getOrgValue(currRow, sDate, "RECIPE_CD");
	fa_RECIPE_NAME = fn_getOrgValue(currRow, sDate, "RECIPE_NAME");
	
// 	trace(fa_UPJANG);
// 	trace(fa_HALL_CD);
// 	trace(fa_MENU_DATE);
// 	trace(fa_CORNER);
// 	trace(fa_CORNER_NAME);
// 	trace(fa_MEAL);
// 	trace(fa_MEAL_NAME);
// 	trace(fa_RECIPE_CD);
// 	trace(fa_RECIPE_NAME);	
	
	//레시피코드 확인.
    if(gfn_length(fa_RECIPE_CD)==0){return false;}
    
    
    //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++//
    //주기 식단은 특별한 체크로직없이 삭제가 가능하다.
    
	
	//삭제 확인.
	var rtn = g_Confirm("01", "선택하신 레시피:["+ fa_RECIPE_NAME +"] 을(를)\n삭제 하시겠습니까?");
	if(!rtn){return false;}
	

	
	//데이터베이스 삭제
	// action 정보 초기화 
	fsp_clear(this);
	
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	
	this.nDeleteRow = currRow;
	this.sDeleteDate = fa_MENU_DATE;

	actionName		= "FSM00221E_T002";
	cmdName			= "U_svc::" + "fs/fsm/FSM00221E_T002.jsp";
	inData			= "";
	outData			= "";
	callBackFnc		= "fn_callBack_Deletekey";

	otherArg		= "UPJANG="+wrapQuote(ds_input.getColumn(0,"UPJANG"));
	otherArg		= otherArg + " MENU_DATE="+wrapQuote(fa_MENU_DATE);  
	otherArg		= otherArg + " HALL_CD="+wrapQuote(fa_HALL_CD);
	otherArg		= otherArg + " CORNER="+wrapQuote(fa_CORNER);
	otherArg		= otherArg + " MEAL="+wrapQuote(fa_MEAL);
	otherArg		= otherArg + " RECIPE_CD="+wrapQuote(fa_RECIPE_CD);
		
	jsp_transaction(this, actionName, cmdName ,inData ,outData,otherArg,callBackFnc,true,false,false);
	//트랜잭션종료
}

//Delete키로 삭제 후 

function fn_callBack_Deletekey(currRow, sDate)
{
	//삭제할 경우: UI 클리어
	//ds_FSH_CYCLE_Pivot.setColumn(currRow,"RECIPE_CD"        ,"" ,currPvIdx);
	ds_FSH_CYCLE_Pivot.setColumn(nDeleteRow,"date"+sDeleteDate,"");
	ds_FSH_CYCLE_Pivot.setColumn(nDeleteRow,"RECIPE_COST_PRICE"+sDeleteDate, 0);
	
}

//////////////////////////////////////////////
// 복사하기 붙여넣기 구현 (Control+C,Control+V 
//////////////////////////////////////////////
function form_OnKeyDown(obj:Form, e:KeyEventInfo)
{
	var currRow;   currRow   = ds_FSH_CYCLE_Pivot.rowposition;
	//var currPvIdx; /* pivotIndex은 지원되지 않는 속성입니다.*/ currPvIdx = ds_FSH_CYCLE_Pivot.pivotIndex;
	
	if ( e.keycode == 67 && e.ctrlKey && ToUpperCase(GetType(e.fromreferenceobject))== "GRID" ) // Ctrl+C 키
	{
		var nCell = grd_FSH_CYCLE_Pivot.getCellPos();
		var sDate = "";
		if (nCell > 2) {		
			sDate = grd_FSH_CYCLE_Pivot.getCellProperty("body", nCell, "text").replace("bind:date","").replace("bind:","RECIPE_COST_PRICE");
		} 
	
	
		var fa_MENU_DATE, fa_UPJANG, fa_HALL_CD, fa_CORNER,fa_CORNER_NAME, fa_MEAL, fa_MEAL_NAME;
		
		fa_MENU_DATE   = sDate;
		fa_UPJANG      = fn_getOrgValue(currRow, sDate, "UPJANG");
		fa_HALL_CD     = fn_getOrgValue(currRow, sDate, "HALL_CD");
		fa_CORNER      = ds_FSH_CYCLE_Pivot.getColumn(currRow,"CORNER");
		fa_CORNER_NAME = ds_FSH_CYCLE_Pivot.getColumn(currRow,"CORNER_NAME");
		fa_MEAL        = ds_FSH_CYCLE_Pivot.getColumn(currRow,"MEAL");
		fa_MEAL_NAME   = ds_FSH_CYCLE_Pivot.getColumn(currRow,"MEAL_NAME");
		fa_RECIPE_CD   = fn_getOrgValue(currRow, sDate, "RECIPE_CD");
	    fa_RECIPE_NAME = fn_getOrgValue(currRow, sDate, "RECIPE_NAME");
	
	    if(gfn_length(fa_RECIPE_CD)==0)
	    {
			return false;
		}
	   
	    PopupDiv0.st_UPJANG.text=fa_UPJANG; //Hidden 업장
	    PopupDiv0.st_MENU_DATE.text=fa_MENU_DATE;
	    PopupDiv0.st_HALL.text=this.cbo_upjang_hall.text;
	    PopupDiv0.st_HALL.userdata=this.cbo_upjang_hall.value;
	    PopupDiv0.st_CORNER.text= fa_CORNER_NAME;
	    PopupDiv0.st_CORNER.userdata= fa_CORNER;
	    PopupDiv0.st_MEAL.text=fa_MEAL_NAME;
	    PopupDiv0.st_MEAL.userdata=fa_MEAL;
	    PopupDiv0.st_RECIPE_CD.text=fa_RECIPE_CD;
	    PopupDiv0.st_RECIPE_NAME.text=fa_RECIPE_NAME;
	    
	    var objRect = grd_FSH_CYCLE_Pivot.getCellRect(currRow, nCell);
	    var nLeft = system.clientToScreenX(grd_FSH_CYCLE_Pivot, objRect.left);
		var nTop = system.clientToScreenY(grd_FSH_CYCLE_Pivot, objRect.top);
	    	    
	    PopupDiv0.trackPopup(nLeft + 200, nTop);
	}



	if ( e.keycode == 86 && e.ctrlKey && ToUpperCase(GetType(e.fromreferenceobject))== "GRID" ) // Ctrl+V 키
	{
		var nCell = grd_FSH_CYCLE_Pivot.getCellPos();
		var sDate = "";
		if (nCell > 2) {		
			sDate = grd_FSH_CYCLE_Pivot.getCellProperty("body", nCell, "text").replace("bind:date","").replace("bind:","RECIPE_COST_PRICE");
		} 
	
	
		 //// 0. 사용하지 못하는 식단일 경우
		if(gfn_length(ds_FSH_CYCLE_Pivot.getColumn(currRow,"CORNER"))==0)
			{
				gfn_alert("해당 식단은 설정되지 않은 식단입니다.\n\n설정된 식단에만 붙여넣기 할 수 있습니다.");
				return false;	
			}
			
			
		
		//// 1. 식수인원이 0인 식단일 경우
		if(toNumber(fn_getOrgValue(currRow, sDate, "EXPECT_MEAL_QTY"))<=0)
		{
			g_Message("EE","해당 식단의 예상식수 인원이 0 입니다.\n\n설정된 식단에만 붙여넣기 할 수 있습니다.");
			return false;	
		}

		
		 //// 1. 붙여넣기 조건 검색-붙여넣기 데이터가 없을때...
 		 if(gfn_length(PopupDiv0.st_RECIPE_CD.text)==0)
		 {
			return false;
		 }
 	
		 
 		 //// 2. 붙여넣기 대상이 있을 경우 
 	     if(gfn_length(fn_getOrgValue(currRow, sDate, "RECIPE_CD"))>0)
 	     {
 	      gfn_alert("해당 식단에 등록된 레시피가 있습니다.\n\n등록된 레시피를 삭제한 후 붙여넣기 하여 주십시요.");
 	      return false;
 	     }
 	 	
 	 	
		 //// 3. 해당 식단에 등록된 레시피가 있을 때
		 var fndIndex;	
		 fndIndex = ds_FSH_CYCLE.findRowExpr("MENU_DATE=='" + sDate
		                                  +"'&&UPJANG=='" + PopupDiv0.st_UPJANG.text
		                                  +"'&&HALL_CD=='"+ fn_getOrgValue(currRow, sDate, "HALL_CD")
		                                  +"'&&CORNER=='" + ds_FSH_CYCLE_Pivot.getColumn(currRow,"CORNER")
		                                  +"'&&MEAL=='"   + ds_FSH_CYCLE_Pivot.getColumn(currRow,"MEAL")
		                                  +"'&&RECIPE_CD=='"+PopupDiv0.st_RECIPE_CD.text+"'");
		    
		// alert("MENU_DATE='"+PopupDiv0.st_MENU_DATE.Text+"'&&UPJANG='"+ PopupDiv0.st_UPJANG.Text+"'&&HALL_CD='"+cbo_upjang_hall.Value+"'&&CORNER='"+ds_FSH_CYCLE_Pivot.GetColumn(currRow,"CORNER",currPvIdx)+"'&&MEAL='"+ds_FSH_CYCLE_Pivot.GetColumn(currRow,"MEAL",currPvIdx)+"'&&RECIPE_CD='"+PopupDiv0.st_RECIPE_CD.Text+"'");
		    
		 if(fndIndex >=0) 
		 { 
		   gfn_alert("해당 식단에 동일하게 등록된 레시피가 있습니다.\n\n등록된 레시피를 삭제한 후 붙여넣기 하여 주십시요.");
 	       return false;
		  }
		 
		 
		// alert(ds_FSH_CYCLE_Pivot.GetColumn(currRow,"MAJOR_DISH_INFO",currPvIdx));
		// return;
		 
		 ////////////////////
		 // 데이터 붙여넣기 	
		 ////////////////////
		 var ret1 = fn_setOrgValue(currRow, sDate, "RECIPE_CD", PopupDiv0.st_RECIPE_CD.text);
		 var ret2 = fn_setOrgValue(currRow, sDate, "RECIPE_NAME", PopupDiv0.st_RECIPE_NAME.text);
		 ds_FSH_CYCLE_Pivot.setColumn(currRow, "date"+sDate, PopupDiv0.st_RECIPE_NAME.text);
		 
		 //trace("ret1=="+ret1);
		 //trace("ret2=="+ret2);
		 
		 
		 //ds_FSH_CYCLE_Pivot.setColumn(currRow,"RECIPE_CD",PopupDiv0.st_RECIPE_CD.text,currPvIdx);
		 //ds_FSH_CYCLE_Pivot.setColumn(currRow,"RECIPE_NAME",PopupDiv0.st_RECIPE_NAME.text,currPvIdx);
	
		
		// action 정보 초기화 
		fsp_clear(this);
	
		var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	
		actionName		= "FSM00221E_T001";
		cmdName			= "U_svc::" + "fs/fsm/FSM00221E_T001.jsp";
		inData			= "";
		outData			= "";
		callBackFnc		= "fn_After_Copy";
	
		otherArg		= "UPJANG="+wrapQuote(ds_input.getColumn(0,"UPJANG"));
		otherArg		= otherArg + " SOURCE_MENU_DATE="+wrapQuote(PopupDiv0.st_MENU_DATE.text);  
        otherArg		= otherArg + " SOURCE_HALL_CD="+wrapQuote(PopupDiv0.st_HALL.userdata);
		otherArg		= otherArg + " SOURCE_CORNER="+wrapQuote(PopupDiv0.st_CORNER.userdata);
		otherArg		= otherArg + " SOURCE_MEAL="+wrapQuote(PopupDiv0.st_MEAL.userdata);
        otherArg		= otherArg + " SOURCE_RECIPE_CD="+wrapQuote(PopupDiv0.st_RECIPE_CD.text);
         
    	otherArg		= otherArg + " TARGET_MENU_DATE="+wrapQuote(sDate);  
        otherArg		= otherArg + " TARGET_HALL_CD="+wrapQuote(cbo_upjang_hall.value);
		otherArg		= otherArg + " TARGET_CORNER="+wrapQuote(ds_FSH_CYCLE_Pivot.getColumn(currRow,"CORNER"));
		otherArg		= otherArg + " TARGET_MEAL="+wrapQuote(ds_FSH_CYCLE_Pivot.getColumn(currRow,"MEAL"));
		otherArg		= otherArg + " TARGET_MAJOR_DISH_INFO="+wrapQuote(ds_FSH_CYCLE_Pivot.getColumn(currRow,"MAJOR_DISH_INFO"));

		jsp_transaction(this, actionName, cmdName ,inData ,outData,otherArg,callBackFnc,true,false,false);
		//트랜잭션종료
	}
	
}


//저장 후 콜백 함수 
function fn_After_Copy(errCode, errMsg)
{
	if (errCode != 0)
	{
		g_Message("EE", errMsg);
		return;
	}
}

//팝업 포커스 잃게 하기-아무키나 또는 포커스를 잃어버리면
function PopupDiv0_OnKeyDown(obj:PopupDiv, e:KeyEventInfo)
{
	if(PopupDiv0.isPopup())
	{
		grd_FSH_CYCLE_Pivot.setFocus();
	}
}



/////////////////////
//주기식단 엑셀 출력
/////////////////////
function grd_FSH_CYCLE_Pivot_OnHeadClick(obj:Grid, e:GridClickEventInfo)
{	
	if (e.cell == 0){
		gfn_exportExcel(obj, this.titletext);
	}
}

/////////////////////
//주기식단 원가정보 엑셀 출력
/////////////////////
function grd_FSH_CYCLE_PRICE_OnHeadClick(obj:Grid, e:GridClickEventInfo)
{
	if (obj.getCellProperty("head",e.cell,"backgroundimage") == "ico_Excel"){
		gfn_exportExcel(obj, this.titletext+"원가정보");
	}
}


		
		
/////////////////////
/// 영양분석
/////////////////////
function btn_rut_OnClick(obj:Button, e:ClickEventInfo)
{

    //업장
     if(!mfn_Chk_Obj_MustInput(ed_UPJANG_NM)) return false;   
	//업장식당
     if(!mfn_Chk_Obj_MustInput(cbo_upjang_hall)) return false;
    //시작날짜
     if(!mfn_Chk_Obj_MustInput(cal_START_DATE)) return false;
    //종료날짜
     if(!mfn_Chk_Obj_MustInput(cal_END_DATE)) return false;
     
    
    var v_arg = {};
	v_arg["fa_UPJANG"]    = gfn_trim(ds_input.getColumn(0,"UPJANG"));
	v_arg["fa_HALL_CD"]   = gfn_trim(cbo_upjang_hall.value);
	v_arg["fa_FROM_DT"]   = gfn_trim(cal_START_DATE.value);
	v_arg["fa_TO_DT"]     = gfn_trim(cal_END_DATE.value);
	
    v_open	 	= "TitleBar=false Status=false AutoSize=false Resize=false NoMove=false";
	v_rtn 		= gfn_dialog("", "U_FSM::FSM00226V.xfdl", v_arg);
 
}

		
		
		
/////////////////////
/// 식단평가
/////////////////////
function btn_pyo_OnClick(obj:Button, e:ClickEventInfo)
{
	//업장
     if(!mfn_Chk_Obj_MustInput(ed_UPJANG_NM)) return false;   
	//업장식당
     if(!mfn_Chk_Obj_MustInput(cbo_upjang_hall)) return false;
    //시작날짜
     if(!mfn_Chk_Obj_MustInput(cal_START_DATE)) return false;
    //종료날짜
     if(!mfn_Chk_Obj_MustInput(cal_END_DATE)) return false;
     
    
    var v_arg = {};
	v_arg["fa_UPJANG"]    = gfn_trim(ds_input.getColumn(0,"UPJANG"));
	v_arg["fa_HALL_CD"]   = gfn_trim(cbo_upjang_hall.value);
	v_arg["fa_FROM_DT"]   = gfn_trim(cal_START_DATE.value);
	v_arg["fa_TO_DT"]     = gfn_trim(cal_END_DATE.value);
	
    v_open	 	= "TitleBar=false Status=false AutoSize=false Resize=false NoMove=false";
	v_rtn 		= gfn_dialog("", "U_FSM::FSM00225V.xfdl", v_arg);
}


//빠른 식단 복사 로직 구현.
function grd_FSH_CYCLE_Pivot_OnRButtonDown(obj:Grid, e:GridMouseEventInfo)
{
	var sDate = "";
	if (e.cell > 2) {		
		sDate = obj.getCellProperty("body", e.cell, "text").replace("bind:date","").replace("bind:","RECIPE_COST_PRICE");
	} 


	if(gfn_length(PopupDiv1.st_UPJANG.text)<=0)
	{
		

		var currRow;   currRow   = e.row;
		//var currPvIdx; currPvIdx = -1;	
				
		//// 0. 사용하지 못하는 식단일 경우
		if(gfn_length(ds_FSH_CYCLE_Pivot.getColumn(currRow,"CORNER"))==0)
		{
			return false;	
		}
	
		//// 1. 식수인원이 0인 식단일 경우
		if(toNumber(fn_getOrgValue(currRow, sDate, "EXPECT_MEAL_QTY"))<=0)
		{
			return false;	
		}
				
		//현재 선택한 식단
		var fa_MENU_DATE, fa_UPJANG, fa_HALL_CD, fa_CORNER, fa_CORNER_NAME, fa_MEAL, fa_MEAL_NAME;
			
		fa_MENU_DATE   = sDate;
		fa_UPJANG      = fn_getOrgValue(currRow, sDate, "UPJANG");
		fa_HALL_CD     = fn_getOrgValue(currRow, sDate, "HALL_CD");
		fa_CORNER      = ds_FSH_CYCLE_Pivot.getColumn(currRow,"CORNER");
		fa_CORNER_NAME = ds_FSH_CYCLE_Pivot.getColumn(currRow,"CORNER_NAME");
		fa_MEAL        = ds_FSH_CYCLE_Pivot.getColumn(currRow,"MEAL");
		fa_MEAL_NAME   = ds_FSH_CYCLE_Pivot.getColumn(currRow,"MEAL_NAME");
		fa_RECIPE_CD   = fn_getOrgValue(currRow, sDate, "RECIPE_CD");
		
// 		trace(fa_UPJANG);
// 		trace(fa_HALL_CD);
// 		trace(fa_MENU_DATE);
// 		trace(fa_CORNER);
// 		trace(fa_CORNER_NAME);
// 		trace(fa_MEAL);
// 		trace(fa_MEAL_NAME);
		
		//// 2. 레시피가 없는 식단일 경우 복사하지 않는다.
		var v_Fnd = ds_FSH_CYCLE.findRowExpr("MENU_DATE=="+wrapQuote(fa_MENU_DATE)+"&&UPJANG=="+wrapQuote(fa_UPJANG)+"&&HALL_CD=="+wrapQuote(fa_HALL_CD)+"&&CORNER=="+wrapQuote(fa_CORNER)+"&&MEAL=="+wrapQuote(fa_MEAL)+"&&gfn_length(fa_RECIPE_CD)>0");
		if(v_Fnd < 0)  // -1 일떄 찾은 데이터가 없음. 
		{
			g_Message("EE", "[빠른식단복사] 선택하신 식단이 비어있습니다.\n\n[빠른식단복사]를 할 수 없습니다.");
			return false;
		}
		
		
			
	    var v_rtn = g_Confirm("01","[빠른식단복사] 제공일: "+ gfn_subStr(fa_MENU_DATE,4,2)+ "월 " + gfn_subStr(fa_MENU_DATE,6,2)+ "일" + G_fn_DayToWeek2(fa_MENU_DATE) + "\n"+cbo_upjang_hall.text+" / 코너:"+ fa_CORNER_NAME + " / 끼니:"+ fa_MEAL_NAME +"\n\n현재 선택하신 식단을 복사하시겠습니까?");
				
		//식단을 복사한다면
		if(v_rtn==true)
		{			 
		   
			PopupDiv1.st_UPJANG.text      = fa_UPJANG; //Hidden 업장
			PopupDiv1.st_MENU_DATE.text   = fa_MENU_DATE;
			PopupDiv1.st_HALL.text        = cbo_upjang_hall.text;
			PopupDiv1.st_HALL.userdata    = cbo_upjang_hall.value;
			PopupDiv1.st_CORNER.text      = fa_CORNER_NAME;
			PopupDiv1.st_CORNER.userdata  = fa_CORNER;
			PopupDiv1.st_MEAL.text        = fa_MEAL_NAME;
			PopupDiv1.st_MEAL.userdata    = fa_MEAL;
			
			
			
			PopupDiv1.trackPopup(e.screenX + 200, e.screenY);
		}
	}
	else
	{
		var v_rtn = g_Confirm("01","[빠른식단붙여넣기]를 하시겠습니까?\n\n※주의:발주자재, 실식단이 등록된 식단은 복사되지 않으며 식단을 복사하면 기존식단은 삭제됩니다.");
				
		
		var currRow;   currRow   = e.row;
		//var currPvIdx; currPvIdx = -1;
	
		//식단을 붙여넣는다면
		if(v_rtn==true)
		{
		
			//복사원본
			var fa_SOURCE_MENU_DATE, fa_SOURCE_UPJANG, fa_SOURCE_HALL_CD, fa_SOURCE_CORNER, fa_SOURCE_CORNER_NAME, fa_SOURCE_MEAL, fa_SOURCE_MEAL_NAME;
			
			fa_SOURCE_MENU_DATE   = PopupDiv1.st_MENU_DATE.text;
			fa_SOURCE_UPJANG      = PopupDiv1.st_UPJANG.text;
			fa_SOURCE_HALL_CD     = PopupDiv1.st_HALL.userdata;
			fa_SOURCE_CORNER      = PopupDiv1.st_CORNER.userdata;
			fa_SOURCE_CORNER_NAME = PopupDiv1.st_CORNER.text;
			fa_SOURCE_MEAL        = PopupDiv1.st_MEAL.userdata;
			fa_SOURCE_MEAL_NAME   = PopupDiv1.st_MEAL.text;
						
			
		
			//복사대상
			var fa_TARGET_MENU_DATE, fa_TARGET_UPJANG, fa_TARGET_HALL_CD, fa_TARGET_CORNER, fa_TARGET_CORNER_NAME, fa_TARGET_MEAL, fa_TARGET_MEAL_NAME;
			
			fa_TARGET_MENU_DATE   = sDate; 
			fa_TARGET_UPJANG      = fn_getOrgValue(currRow, sDate, "UPJANG");
			fa_TARGET_HALL_CD     = fn_getOrgValue(currRow, sDate, "HALL_CD");
			fa_TARGET_CORNER      = ds_FSH_CYCLE_Pivot.getColumn(currRow,"CORNER");
			fa_TARGET_CORNER_NAME = ds_FSH_CYCLE_Pivot.getColumn(currRow,"CORNER_NAME");
			fa_TARGET_MEAL        = ds_FSH_CYCLE_Pivot.getColumn(currRow,"MEAL");
			fa_TARGET_MEAL_NAME   = ds_FSH_CYCLE_Pivot.getColumn(currRow,"MEAL_NAME");
		
// 				trace(fa_TARGET_UPJANG);
// 				trace(fa_TARGET_HALL_CD);
// 				trace(fa_TARGET_MENU_DATE);
// 				trace(fa_TARGET_CORNER);
// 				trace(fa_TARGET_CORNER_NAME);
// 				trace(fa_TARGET_MEAL);
// 				trace(fa_TARGET_MEAL_NAME);
// 				trace(fa_TARGET_HALL_CD);
		
			//---------------------------------------------------//
			//1. 과거식단은 삭제할 수 없다. --> 주기식단은 상관없음.
			//	if(fa_TARGET_MENU_DATE<today())
			//	{	
			//		g_Message("EE", "과거식단에는 복사할 수 없습니다.");
			//		return false; 
			//	}    

			//// 0. 사용하지 못하는 식단일 경우
			if(gfn_length(ds_FSH_CYCLE_Pivot.getColumn(currRow,"CORNER"))==0)
			{
				g_Message("EE","해당 식단은 설정되지 않은 식단입니다.\n\n설정된 식단에만 붙여넣기 할 수 있습니다.");
				return false;	
			}

			//// 1. 식수인원이 0인 식단일 경우
			if(toNumber(fn_getOrgValue(currRow, sDate, "EXPECT_MEAL_QTY"))<=0)
			{
				g_Message("EE","해당 식단의 예상식수 인원이 0 입니다.\n\n설정된 식단에만 붙여넣기 할 수 있습니다.");
				return false;	
			}
			



			//복사원본 복사대상 체크
			if((fa_SOURCE_MENU_DATE==fa_TARGET_MENU_DATE)&&
			   (fa_SOURCE_UPJANG   ==fa_TARGET_UPJANG)&&
			   (fa_SOURCE_HALL_CD  ==fa_TARGET_HALL_CD)&&
			   (fa_SOURCE_CORNER   ==fa_TARGET_CORNER)&&
			   (fa_SOURCE_MEAL     ==fa_TARGET_MEAL))
		    {
				//복사원본과 복사대상이 같습니다.
				g_Message("EE", "복사원본 식단과 복사대상 식단이 같습니다.\n\n다른 식단을 선택하여 주십시요.");
				return false;		  	
		  	}
		    else
		    //빠른식단복사실행
		    {
		    
				 var otherArg= "GUBUN=" + wrapQuote("CYCLE");
	
				 otherArg		= otherArg + " SOURCE_UPJANG="    +wrapQuote(fa_SOURCE_UPJANG);
				 otherArg		= otherArg + " SOURCE_MENU_DATE=" +wrapQuote(fa_SOURCE_MENU_DATE);  
				 otherArg		= otherArg + " SOURCE_HALL_CD="   +wrapQuote(fa_SOURCE_HALL_CD);
				 otherArg		= otherArg + " SOURCE_CORNER="    +wrapQuote(fa_SOURCE_CORNER);
				 otherArg		= otherArg + " SOURCE_MEAL="      +wrapQuote(fa_SOURCE_MEAL);
			
				 otherArg		= otherArg + " TARGET_UPJANG="    +wrapQuote(fa_TARGET_UPJANG);
				 otherArg		= otherArg + " TARGET_MENU_DATE=" +wrapQuote(fa_TARGET_MENU_DATE);  
				 otherArg		= otherArg + " TARGET_HALL_CD="   +wrapQuote(fa_TARGET_HALL_CD);
				 otherArg		= otherArg + " TARGET_CORNER="    +wrapQuote(fa_TARGET_CORNER);
				 otherArg		= otherArg + " TARGET_MEAL="      +wrapQuote(fa_TARGET_MEAL);
				 
		         // action 정보 초기화 
				 fsp_clear(this);
				
				 var actionName, cmdName, inData, outData, callBackFnc;
			
				 actionName		= "FSM00222E_T003";
				 cmdName		= "U_svc::" + "fs/fsm/FSM00222E_T003.jsp";
				 inData			= "";
				 outData		= "";
				 callBackFnc	= "fn_Menu_Copy";
				
				 jsp_transaction(this, actionName, cmdName ,inData ,outData, otherArg, callBackFnc, true, false, false);
				// 트랜잭션 종료     				
		    }
		  	
		}
		//복사된 빠른식단을 취소합니다.
		else
		{
		 
			PopupDiv1.st_UPJANG.text     ="";         //Hidden 업장
			PopupDiv1.st_MENU_DATE.text  ="";
			PopupDiv1.st_HALL.text       ="";
			PopupDiv1.st_HALL.userdata   ="";
			PopupDiv1.st_CORNER.text     ="";
			PopupDiv1.st_CORNER.userdata ="";
			PopupDiv1.st_MEAL.text       ="";
			PopupDiv1.st_MEAL.userdata   ="";
			
			g_Message("01","작업을 취소하고 복사 데이터를 Clear 합니다.\n\n복사를 다시하시려면 원하는 식단을 선택한 후\n마우스 오른쪽버튼을 클릭하십시요!!"); 
		}
	}

}

function fn_Menu_Copy()
{
	
	//원가 정보는 새로가져오지 않는다.//chk_SEARCH_ALL_OnClick("", false);//chk_SEARCH_ALL.BkColor=-1;//chk_SEARCH_ALL.Color  =-1;
	chk_SEARCH_ALL.value  = false;
	fn_chk_SEARCH_ALL_OnClick(this.chk_SEARCH_ALL, 0);
	
	fn_search();
}

//팝업 포커스 잃게 하기-아무키나 또는 포커스를 잃어버리면
function PopupDiv1_OnKeyDown(obj:PopupDiv, e:KeyEventInfo)
{
	if(PopupDiv1.isPopup())
	{
		grd_FSH_CYCLE_Pivot.setFocus();
	}
}



// 툴팁보이기 
function grd_FSH_CYCLE_Pivot_OnMouseOver(obj:Grid, e:GridMouseEventInfo)
{
		if(e.row<=1)
		{
			grd_FSH_CYCLE_Pivot.tooltiptext = "◈ 레시피 단축키설명\nControl+C→복사 Control+V→붙여넣기 Del→삭제\n--------------------------------------------\n◈ 마우스 오른쪽버튼→빠른식단복사 및 붙여넣기";
		}
		else
		{
			grd_FSH_CYCLE_Pivot.tooltiptext = "";
		}
}

function fn_expr(nRow)
{
	var nTargetRow = nRow;
	if (ds_FSH_CYCLE_PRICE.getRowLevel(nRow) == 1) {
		nTargetRow = nRow - 1;
	}
	var MENU_DATE = ds_FSH_CYCLE_PRICE.getColumn(nTargetRow, "MENU_DATE");
	//return MENU_DATE;
	return MENU_DATE.substr(2,2) + '년' + MENU_DATE.substr(4,2) + '월  ' + MENU_DATE.substr(6,2)+ '일차';
}

function fn_exprCornerName(nRow)
{
	var nTargetRow = nRow;
	if (ds_FSH_CYCLE_Pivot.getRowLevel(nRow) == 1) {
		nTargetRow = nRow - 1;
	}
	
	return ds_FSH_CYCLE_Pivot.getColumn(nTargetRow,"CORNER_NAME");
}

]]></Script>
  </Form>
</FDL>
