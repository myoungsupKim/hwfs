<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="../../../default_typedef.xml"/>
  <Form id="FMM00160E" onload="form_onload" titletext="주간식단계획등록" userdata="FormLink='Y'" position="absolute 0 0 1252 725" scrollbars="none" onkeydown="fn_FormKeyDown">
    <Layouts>
      <Layout>
        <Static id="Static49" class="sta_WFDA_Labelbg" position="absolute 0 102 287 129"/>
        <MaskEdit id="me_sikrate" mask="#,###.#" taborder="5" position="absolute 162 105 267 126" limitbymask="both" autoselect="true"/>
        <Grid autoenter="select" selecttype="cell" cellsizingtype="both" readonly="false" enable="true" id="grd_lst" onselectchanged="grd_lst_OnCellPosChanged" onmouseleave="grd_lst_OnMouseOut" onmousemove="grd_lst_OnMouseOver" taborder="9" tabstop="true" useselcolor="false" wheelscrollrow="1" position="absolute 0 134 1237 402" autofittype="col" anchor="left top right" onkeydown="grd_lst_onkeydown">
          <Formats>
            <Format id="default"/>
          </Formats>
        </Grid>
        <Static id="Static7" text="%" position="absolute 271 105 283 126"/>
        <Button id="btn_copy" onclick="btn_copy_OnClick" taborder="7" text=" 전주예측 복사" visible="false" position="absolute 1035 108 1123 129" class="btn_WF_Custom" image="" style="align:left;" anchor="top right"/>
        <Button id="btn_sikdan" onclick="btn_sikdan_OnClick" taborder="8" text=" 식단등록 바로가기" position="absolute 1125 108 1237 129" class="btn_WF_Custom" image="" style="align:left;" anchor="top right"/>
        <Button id="btn_call" onclick="btn_call_OnClick" taborder="6" text=" 식당식수 불러오기" visible="false" position="absolute 922 108 1033 129" class="btn_WF_Custom" image="" style="align:left;" anchor="top right"/>
        <Static id="Static9" text="지난 4주 식단보기" position="absolute 0 415 176 433" class="sta_WF_Title01"/>
        <Static id="Static05" text="주간식단목표 식재료비율" position="absolute 0 102 160 129" class="sta_WFDA_Label01"/>
        <Div id="div_cmnBtn" anchor="left top right" taborder="41" url="cmn::CmnBtn.xfdl" text="Div00" scrollbars="none" position="absolute 0 0 1237 30"/>
        <Static id="Static06" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1237 0 1252 713" anchor="top right"/>
        <Static id="Static71" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 710 1245 725" anchor="left bottom"/>
        <Static id="Static08" class="sta_WFSA_Labelbg" position="absolute 0 30 1237 71" anchor="left top right"/>
        <Static id="Static04" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 30 1053 40"/>
        <Static id="Static01" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 61 1053 71"/>
        <Static id="Static07" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 40 15 61"/>
        <Static id="Static11" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 85 40 95 61"/>
        <Static id="Static09" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 247 40 277 61"/>
        <Static id="st_Upjang" text="사 업 장" userdata="strQuery_FMUpjang" position="absolute 15 40 83 61" class="sta_WFSA_label"/>
        <Button id="btn_Upjang" onclick="btn_Upjang_OnClick" taborder="1" text="" userdata="FMO00240E_S002" position="absolute 226 40 247 61" class="btn_WF_popSearch" image=""/>
        <Combo codecolumn="CODE" datacolumn="CODE_NAME" id="cbo_SUBINV" index="0" innerdataset="ds_SUBINV" taborder="2" position="absolute 328 40 560 61" displayrowcount="15"/>
        <Static id="Static2" text="식 당" position="absolute 279 40 324 61" class="sta_WFSA_label"/>
        <Static id="Static3" text="제 공 일" position="absolute 592 40 653 61" class="sta_WFSA_label"/>
        <Calendar id="cal_MENU_DATE" taborder="12" visible="false" position="absolute 956 40 1046 61" dateformat="yyyy-MM-dd" type="normal"/>
        <Static id="Static4" text="(" position="absolute 762 40 769 62"/>
        <Static id="Static5" text="∼" position="absolute 849 40 859 61"/>
        <Static id="Static6" text=")" position="absolute 947 40 954 62"/>
        <MaskEdit id="me_symd" mask="@@@@-@@-@@" readonly="true" taborder="22" type="string" position="absolute 773 40 852 61" style="background:transparent;border:0 solid #c2c2c2ff ;align:center middle;"/>
        <MaskEdit id="MaskEdit0" mask="@@@@-@@-@@" readonly="true" taborder="23" type="string" position="absolute 861 40 940 61" style="background:transparent;border:0 solid #c2c2c2ff ;align:center middle;"/>
        <Button id="btn_GiveCal" onclick="btn_GiveCal_OnClick" taborder="4" text="" position="absolute 735 40 756 61" class="btn_WF_cal" image="" userdata="me_GiveDay" tabstop="false"/>
        <MaskEdit autoselect="true" id="me_GiveDay" mask="####-##-##" taborder="3" trimtype="both" type="string" position="absolute 657 40 736 61" onkillfocus="me_GiveDay_onkillfocus"/>
        <Static id="Static8" text="예상식수 계획" position="absolute 0 84 176 102" class="sta_WF_Title01"/>
        <Edit id="ed_Upjang" onkeydown="fn_edBtn_OnKeyDown" readonly="true" taborder="0" position="absolute 95 40 227 61"/>
        <Static id="Static10" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 318 40 328 61"/>
        <Static id="Static12" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 560 40 590 61"/>
        <Static id="Static13" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 647 40 657 61"/>
        <Static id="Static17" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 0 71 450 84"/>
        <Static id="Static18" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 0 97 834 102"/>
        <Static id="Static14" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 0 402 450 415"/>
        <Static id="Static15" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 0 428 834 433"/>
        <Static id="Static00" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 184 129 1018 134"/>
        <Calendar dateformat="yyyy/MM/dd" id="cal_to_dt" taborder="17" visible="false" position="absolute 1139 40 1229 61" type="normal"/>
        <Calendar dateformat="yyyy/MM/dd" id="cal_from_dt" taborder="18" visible="false" position="absolute 1048 40 1138 61" type="normal"/>
        <Div id="Div_pop" scrollbars="autoboth" taborder="10" text="Div0" visible="false" position="absolute 32 512 282 612" class="sta_WFSA_Labelbg">
          <Layouts>
            <Layout width="250" height="100">
              <Grid enable="true" id="Grid0" useinputpanel="false" taborder="1" tabstop="true" usecontextmenu="true" useselcolor="true" visible="true" wheelscrollrow="1" position="absolute 6 6 240 90" readonly="true" selecttype="row" anchor="default">
                <Formats>
                  <Format id="Default">
                    <Columns>
                      <Column size="230"/>
                    </Columns>
                    <Rows>
                      <Row size="18"/>
                    </Rows>
                    <Band id="body">
                      <Cell col="0" displaytype="text" style="align:left;"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
            </Layout>
          </Layouts>
        </Div>
        <Grid binddataset="ds_view" enable="true" id="Grid00" useinputpanel="false" taborder="11" tabstop="true" usecontextmenu="true" userdata="y" useselcolor="false" visible="true" wheelscrollrow="1" position="absolute 0 433 1237 710" readonly="true" selecttype="row" anchor="all" autofittype="col">
          <Formats>
            <Format id="Default">
              <Columns>
                <Column size="90" band="left"/>
                <Column size="183"/>
                <Column size="100"/>
                <Column size="100"/>
                <Column size="75"/>
                <Column size="75"/>
                <Column size="600"/>
              </Columns>
              <Rows>
                <Row size="26" band="head"/>
                <Row size="24"/>
                <Row size="24" band="summ"/>
              </Rows>
              <Band id="head">
                <Cell displaytype="text" text="일자"/>
                <Cell col="1" displaytype="text" text="날씨"/>
                <Cell col="2" displaytype="text" text="끼니"/>
                <Cell col="3" displaytype="text" text="코너"/>
                <Cell col="4" displaytype="text" text="예상식수"/>
                <Cell col="5" displaytype="text" text="실식수"/>
                <Cell col="6" displaytype="text" text="제공식단"/>
              </Band>
              <Band id="body">
                <Cell displaytype="text" style="align:center;" text="bind:DAYS"/>
                <Cell col="1" displaytype="text" style="align:left;" text="bind:WDESC"/>
                <Cell col="2" displaytype="text" style="align:left;" text="bind:MEAL_NAME"/>
                <Cell col="3" displaytype="text" style="align:left;" text="bind:CORNER_NAME"/>
                <Cell col="4" displaytype="number" style="align:right;" text="bind:EXPECT_MEAL_QTY" mask="#,###,##0"/>
                <Cell col="5" displaytype="number" style="align:right;" text="bind:REAL_MEAL_QTY" mask="#,###,##0"/>
                <Cell col="6" displaytype="text" style="align:left;" text="bind:SIKDAN"/>
              </Band>
              <Band id="summary">
                <Cell displaytype="text" style="align:center;" text="평균"/>
                <Cell col="1" displaytype="text" style="align:left;"/>
                <Cell col="2" displaytype="text" style="align:left;"/>
                <Cell col="3" displaytype="text" style="align:left;"/>
                <Cell col="4" displaytype="number" style="align:right;" text="expr:fn_clearNaN(getAvg(&quot;EXPECT_MEAL_QTY&quot;))" mask="#,##0"/>
                <Cell col="5" displaytype="number" style="align:right;" text="expr:fn_clearNaN(getAvg(&quot;REAL_MEAL_QTY&quot;))" mask="#,##0"/>
                <Cell col="6" displaytype="text" style="align:left;"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="DS_menu1" cancolumnchange="DS_menu1_CanColumnChange">
        <ColumnInfo>
          <Column id="column0" size="256" type="STRING"/>
          <Column id="column1" size="256" type="STRING"/>
          <Column id="column2" size="256" type="STRING"/>
          <Column id="column3" size="256" type="STRING"/>
          <Column id="column4" size="256" type="STRING"/>
          <Column id="column5" size="256" type="STRING"/>
          <Column id="column6" size="256" type="STRING"/>
          <Column id="column7" size="256" type="STRING"/>
          <Column id="column8" size="256" type="STRING"/>
          <Column id="column9" size="256" type="STRING"/>
          <Column id="column10" size="256" type="STRING"/>
          <Column id="column11" size="256" type="STRING"/>
          <Column id="column12" size="256" type="STRING"/>
          <Column id="column13" size="256" type="STRING"/>
          <Column id="column14" size="256" type="STRING"/>
          <Column id="column15" size="256" type="STRING"/>
          <Column id="column16" size="256" type="STRING"/>
          <Column id="column17" size="256" type="STRING"/>
          <Column id="column18" size="256" type="STRING"/>
          <Column id="column19" size="256" type="STRING"/>
          <Column id="column20" size="256" type="STRING"/>
          <Column id="column21" size="256" type="STRING"/>
          <Column id="column22" size="256" type="STRING"/>
          <Column id="column23" size="256" type="STRING"/>
          <Column id="column24" size="256" type="STRING"/>
          <Column id="column25" size="256" type="STRING"/>
          <Column id="column26" size="256" type="STRING"/>
          <Column id="column27" size="256" type="STRING"/>
          <Column id="column28" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="DS_head1">
        <ColumnInfo>
          <Column id="fday" size="256" type="STRING"/>
          <Column id="we" size="256" type="STRING"/>
          <Column id="we_color" size="256" type="STRING"/>
          <Column id="wcd" size="256" type="STRING"/>
          <Column id="wnm" size="256" type="STRING"/>
          <Column id="wimg" size="256" type="STRING"/>
          <Column id="rem" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="DS_body1">
        <ColumnInfo>
          <Column id="fday" size="256" type="STRING"/>
          <Column id="sgbn" size="256" type="STRING"/>
          <Column id="sgbn_nm" size="256" type="STRING"/>
          <Column id="cgbn" size="256" type="STRING"/>
          <Column id="cgbn_nm" size="256" type="STRING"/>
          <Column id="cgbn_cd" size="256" type="STRING"/>
          <Column id="dup_sta" size="256" type="STRING"/>
          <Column id="dup_color" size="256" type="STRING"/>
          <Column id="sseq" size="256" type="STRING"/>
          <Column id="sd_cd" size="256" type="STRING"/>
          <Column id="sd_nm" size="256" type="STRING"/>
          <Column id="sd_won" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="DS_body_f1"/>
      <Dataset id="DS_body_c1"/>
      <Dataset id="DS_sgbn1">
        <ColumnInfo>
          <Column id="sgbn" size="256" type="STRING"/>
          <Column id="sgbn_nm" size="256" type="STRING"/>
          <Column id="cgbn" size="256" type="STRING"/>
          <Column id="cgbn_nm" size="256" type="STRING"/>
          <Column id="cgbn_cd" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_view">
        <ColumnInfo>
          <Column id="DAYS" size="256" type="STRING"/>
          <Column id="WDESC" size="256" type="STRING"/>
          <Column id="REAL_MEAL_QTY" size="256" type="BIGDECIMAL"/>
          <Column id="SIKDAN" size="256" type="STRING"/>
          <Column id="MENU_FEATURE" size="256" type="STRING"/>
          <Column id="EXPECT_MEAL_QTY" size="256" type="BIGDECIMAL"/>
          <Column id="MEAL_NAME" type="STRING" size="256"/>
          <Column id="CORNER_NAME" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_sikrate">
        <ColumnInfo>
          <Column id="UPJANG" size="256" type="STRING"/>
          <Column id="SUBINV_CODE" size="256" type="STRING"/>
          <Column id="MENU_DATE" size="256" type="STRING"/>
          <Column id="GOAL_COST_RATE" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_sikck"/>
      <Dataset id="ds_input">
        <ColumnInfo>
          <Column id="UPJANG" size="256" type="STRING"/>
          <Column id="UPJANG_NM" size="256" type="STRING"/>
          <Column id="SUBINV_CODE" size="256" type="STRING"/>
          <Column id="MENU_DATE" size="256" type="STRING"/>
          <Column id="MENU_SDATE" size="256" type="STRING"/>
          <Column id="MENU_EDATE" size="256" type="STRING"/>
          <Column id="CURR_DATE" size="256" type="STRING"/>
          <Column id="COPY_FLAG" size="256" type="STRING"/>
          <Column id="EMP_NO" size="256" type="STRING"/>
        </ColumnInfo>
        <Rows>
          <Row/>
        </Rows>
      </Dataset>
      <Dataset id="ds_SUBINV"/>
      <Dataset id="ds_list_dtl"/>
      <Dataset id="DS_body_test"/>
      <Dataset id="ds_sikrateCond" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" oncolumnchanged="ds_sikrateCond_oncolumnchanged">
        <ColumnInfo>
          <Column id="SIKRATE" type="BIGDECIMAL" size="20"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="SIKRATE">0</Col>
          </Row>
        </Rows>
      </Dataset>
    </Objects>
    <Bind>
      <BindItem id="cal_to_dt_value" compid="cal_to_dt" propid="value" datasetid="ds_input" columnid="MENU_EDATE"/>
      <BindItem id="cal_from_dt_value" compid="cal_from_dt" propid="value" datasetid="ds_input" columnid="MENU_SDATE"/>
      <BindItem id="cbo_SUBINV_value" compid="cbo_SUBINV" propid="value" datasetid="ds_input" columnid="SUBINV_CODE"/>
      <BindItem id="cal_MENU_DATE_value" compid="cal_MENU_DATE" propid="value" datasetid="ds_input" columnid="MENU_DATE"/>
      <BindItem id="me_symd_value" compid="me_symd" propid="value" datasetid="ds_input" columnid="MENU_SDATE"/>
      <BindItem id="MaskEdit0_value" compid="MaskEdit0" propid="value" datasetid="ds_input" columnid="MENU_EDATE"/>
      <BindItem id="ed_Upjang_value" compid="ed_Upjang" propid="value" datasetid="ds_input" columnid="UPJANG_NM"/>
      <BindItem id="item0" compid="me_sikrate" propid="value" datasetid="ds_sikrateCond" columnid="SIKRATE"/>
    </Bind>
    <Script type="xscript4.0"><![CDATA[/**
====================================================================================================(100)
 1. 시    스    템	: 	메뉴관리>식단관리>식단등록
 2. 서브    시스템 	:   FMM00160E 주간식단계획등록
 3. 프로그램  개요 	: 	
 4. 작    성    자 	:  	
 5. 작    성    일 	: 	
====================================================================================================
 6. 수정자/수정일   : 
 7. 수정사유/내역   : 
====================================================================================================
**/
//===========================================================================================(90)
// [ PART 1 ]
// Form에서 Include 할 내용을 정의
//
//******************************************************************************************
include "U_lib::lib_conversionCom.xjs";
//@@컨버터에서 주석처리 #include "lib::sc_comon.js"
//@@컨버터에서 주석처리 #include "LIB::lib_comm_0001.js"
//@@컨버터에서 주석처리 #include "lib::tit_comm_0001.js"		// X-Framework Lib
//@@컨버터에서 주석처리 #include "lib::sc_sql_common.js"		// 사업장팝업용 Lib
//@@컨버터에서 주석처리 #include "LIB::fm_common.js";
//******************************************************************************************
// [ PART 2 ]
// Form에서 사용될 전역변수를 선언
//
//******************************************************************************************
var	il_cnt		= 0;	// 기간에 해당되는 일수를 산정
var def_cha		= 2;	// 차감 col pointer
var curr_date	= "";	// 차감 col pointer
//******************************************************************************************
// [ PART 3 ]
// Form Loading 시 작업 정의
//
//******************************************************************************************
function form_onload(obj:Form, e:LoadEventInfo)
{
	gfn_formOnLoad(obj, false);

	// X-Framework : Action 정보 생성 
	fsp_init(this);
	
	v_ds_check = "DS_menu1";
	
	ds_input.setColumn(0,"UPJANG_NM",gfn_nvl(g_UpjangNm));	
	ds_input.setColumn(0,"UPJANG",gfn_nvl(g_Upjang));	
	
	fn_SearchSubinv();
	
	ds_input.setColumn(0,"MENU_DATE",fn_CurrDateWeek("YMD"));
	me_GiveDay.value = cal_MENU_DATE.value;
	
	//--------------------------------------------------(50)
	// 현재일에 해당하는 주단위 일자범위를 작성
	//--------------------------------------------------
	fn_week_create();
	
	ed_Upjang.setFocus();
}

//******************************************************************************************
// [ PART 4 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,도움말,form닫기)
//
//******************************************************************************************

/*------------------------------------------------------------(60)
	1. Function ID : fn_Search()
	2. 개       요 : 업무프로세스에 따른 조회작업
	3. 기       능 : 검색조건에 해당하는 정보를 조회
	4. 인 수 설 명 : 
*/
function fn_search()
{
	if (fn_Search_chk() == false) {
		return;
	}
	// 주간식당목표 식재료율 LOAD
	fn_sikrateSearch();
		
	// Grid Head : 주간 일정 [Local Data를 DataSet으로 전환--> 향후 서비스로 대체]
	fn_Sel_DS_head1();
	if (DS_head1.getRowCount() == 0) {
		g_Message("EE",	"주간일정 정보가 없습니다.");
		return;
	}
	// DS_sgbn1 : 식구분 [Local Data를 DataSet으로 전환--> 향후 서비스로 대체]
	fn_Sel_DS_sgbn1();
	if (DS_sgbn1.getRowCount() == 0) {
		g_Message("EE",	"식,끼니 정보가 없습니다.");
		return;
	}

	// Grid Body : 주간식단표 [Local Data를 DataSet으로 전환--> 향후 서비스로 대체]
	fn_Sel_DS_body1();
//return;	
	// Grid에 사용할 DataSet을 작성합니다.
	grd_lst.binddataset = "";
	fn_make_DS_menu1();

	// Grid Format을 작성합니다.
	grd_lst.binddataset = "";
	fn_make_grdlst();
	grd_lst.binddataset = "DS_menu1";
	grd_lst.enableredraw;
	grd_lst.setCellPos(1);
	grd_lst.setFocus();
	
	// 전주예측복사 button 작동
	fn_ds_sikck_search();

	if (ds_sikck.getRowCount() > 0) {
		btn_copy.visible = false;
		btn_call.visible = false;
	}
	else {
		btn_copy.visible = true;
		btn_call.visible = true;
	}
	
}

/*------------------------------------------------------------
	1. Function ID : fn_Insert()
	2. 개       요 : 업무프로세스에 따른 입력작업
	3. 기       능 : 입력버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*/
function fn_insert()
{
}

/*------------------------------------------------------------
	1. Function ID : fn_Save()
	2. 개       요 : 업무프로세스에 따른 정보 저장작업
	3. 기       능 : 저장버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*/
// 예측식수현황을 저장한다.
function fn_save()
{

	// 정보 저장을 위한 check 및 생성 삭제대상을 작성한다.
	for(var ii = 0; ii < DS_menu1.getRowCount(); ii++) {
		for(var kk = 0; kk < DS_head1.getRowCount(); kk++) {
			var set_col		= gfn_subStr(DS_head1.getColumn(kk, "FDAY"),4,4);
			var fil_cond	= "FDAY=='"+DS_head1.getColumn(kk, "FDAY")+"'&&SGBN=='"+DS_menu1.getColumn(ii, "SGBN")+"'&&CGBN=='"+DS_menu1.getColumn(ii, "CGBN")+"'&&CGBN_CD=='"+DS_menu1.getColumn(ii, "CGBN_CD")+"'";
			var n_row		= DS_body1.findRowExpr(fil_cond);
			
			if (DS_menu1.getColumn(ii, "EXPECT_MEAL_QTY_"+set_col) == 0) {
				DS_body1.deleteRow(n_row);
			}
			else {
				DS_body1.setColumn(n_row, "EXPECT_MEAL_QTY", DS_menu1.getColumn(ii, "EXPECT_MEAL_QTY_"+set_col));
				DS_body1.setColumn(n_row, "GOAL_COST_RATE", DS_menu1.getColumn(ii, "GOAL_COST_RATE_"+set_col));
			}
		}
	}
	
	ds_input.setColumn(0, "EMP_NO", g_EmpNo);
	// 식재료율을 저장한다.
	// ----------------------------
    // 서비스셋팅
    var actionName, cmdName, inData, outData, otherArg, callBackFnc;
    var selectSqlId, notFoundSql, foundSql, saveFlagColumn, keySqlName, keyIncrement, callbackSql;
    var	insertSql, updateSql, deleteSql;

	inData		= "ds_sikrate=ds_sikrate:A ds_input=ds_input";
	outData		= "";
	callBackFnc	= "fn_afterSearch";
	selectSqlId = "fm/fmm:FMM00160E_S006";		// 데이타있는지 체크 sql
	notFoundSql	= "fm/fmm:FMM00160E_I002";		// insert sql
	foundSql	= "fm/fmm:FMM00160E_U002";		// update sql	
	callbackSql	= "";							// callback sql(재조회)
	
	fsp_clear(this);
	fsp_addSelectExecute(this, selectSqlId, notFoundSql, foundSql);					// 저장
	// tit_addSearchActionInfo(this, callbackSql);												// CallBack조회 
	// tit_addSaveActionInfo(formObj, insertSql, updateSql, deleteSql,saveFlagColumn, keySqlName, keyIncrement, callbackSql)
    
	http.Sync = true;
	fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);		// 서비스 호출 
	http.Sync = false;
	
	// 주간식단목표 식수를 저장한다.
	// ----------------------------
    // 서비스셋팅
    var actionName, cmdName, inData, outData, otherArg, callBackFnc;
    var selectSqlId, notFoundSql, foundSql, saveFlagColumn, keySqlName, keyIncrement, callbackSql;
    var	insertSql, updateSql, deleteSql;

	inData		= "DS_body1=DS_body1:A ds_input=ds_input";
	outData		= "";
	callBackFnc	= "fn_afterSearch";
	selectSqlId = "fm/fmm:FMM00160E_S007";		// 데이타있는지 체크 sql
	notFoundSql	= "fm/fmm:FMM00160E_I001";		// insert sql
	foundSql	= "fm/fmm:FMM00160E_U001";		// update sql	
	callbackSql	= "";							// callback sql(재조회)
	
	insertSql	= "";							// insertSql
	updateSql	= "";							// updateSql
	//deleteSql	= "";							// deleteSql
	deleteSql	= "fm/fmm:FMM00160E_D001";		// deleteSql
	
	fsp_clear(this);
	fsp_addSelectExecute(this, selectSqlId, notFoundSql, foundSql);					// 저장
	fsp_addSave(this, insertSql, updateSql, deleteSql, saveFlagColumn, keySqlName, keyIncrement, callbackSql);
	// tit_addSearchActionInfo(this, callbackSql);												// CallBack조회 
	// tit_addSaveActionInfo(formObj, insertSql, updateSql, deleteSql,saveFlagColumn, keySqlName, keyIncrement, callbackSql)
    
	http.Sync = true;
	fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);		// 서비스 호출 
	http.Sync = false;
	//
	DS_menu1.applyChange();
	// 정보를 읽는다.
	
	fn_search();
	
}

/*------------------------------------------------------------
	1. Function ID : fn_Delete()
	2. 개       요 : 업무프로세스에 따른 정보 삭제작업
	3. 기       능 : 삭제버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*/
function fn_delete()
{
}

/*------------------------------------------------------------
	1. Function ID : fn_Print()
	2. 개       요 : 업무프로세스에 따른 선별된 정보를 출력지로 인쇄
	3. 기       능 : 인쇄버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*/
function fn_print()
{
}


/*------------------------------------------------------------
	1. Function ID : fn_close()
	2. 개       요 : 업무프로세스에 따른 선별된 정보를 출력지로 인쇄
	3. 기       능 : 인쇄버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*/
function fn_close()
{
	return true;
}

//******************************************************************************************
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
//
//******************************************************************************************
function fn_Search_chk()
{	
	if (gfn_length(ds_input.getColumn(0,"UPJANG"))== 0) {
		g_Message("EE",	"사업장 오류!!\n\n사업장을 선택하세요.");
		ed_Upjang.setFocus();
		return false;
	}
	if (gfn_length(ds_input.getColumn(0,"SUBINV_CODE"))== 0) {
		g_Message("EE","식당 오류!!\n\n식당을 선택하세요.");
		cbo_SUBINV.setFocus();
		return false;
	}
	if (gfn_length(ds_input.getColumn(0,"MENU_DATE"))== 0) {
		g_Message("EE",	"제공일 오류!!\n\n제공일을 입력하세요.");
		cal_MENU_DATE.setFocus();
		return false;
	}
	
	return true;
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_afterSearch()
 * 입      력   : errCode 	= 에러코드
				  errMsg	= 에러메세지
 * 반      환   : 없음
 * 기      능   : 사업장 조회 후 실행 함수
 * 작  성  자   : 박지영
 * 작성  일자   : 2007-11-20  
 ******************************************************************************************
 */
function fn_afterSearch(errCode, errMsg)
{
	if(errCode!=0)
	{
		g_Message("EE",	"서비스 오류:시스템 관리자에게 문의하십시오");
		return;
	}

}

/*
 ******************************************************************************************
	1. Function ID : fn_week_create()
	2. 개       요 : 입력일에 해당하는 주의 일자 범위를 작성
	3. 기       능 : 시작일자 입력 시 일자에 해당하는 주의 시작일과 끝나는 일자를
	                 구하고 차주의 시작일인 일요일을 구함.
	                 (금주(월) ∼ 차주(일)까지의 일자를 구함)
	4. 인 수 설 명 : 
 ******************************************************************************************
 */
function fn_week_create()
{
	cal_from_dt.value	= cal_MENU_DATE.value;
	//cal_from_dt.value	= "20070917";
	cal_to_dt.value		= cal_from_dt.value; 
	
	// start Date가 속해있는 주의 시작일자를 계산
	cal_from_dt.value = GetStartofWeek(cal_from_dt); 
	
	// 제공일이 일요일 이면 전주의 일정이 된다.
	if (cal_MENU_DATE.value == cal_from_dt.value) {
		cal_from_dt.value = gfn_addDate(cal_from_dt.value, -1);
 		
		cal_from_dt.value = GetStartofWeek(cal_from_dt);
 		
	}
	// 해당 주의 월요일을 계산
	cal_from_dt.value = gfn_addDate(cal_from_dt.value, 1); 
	
	// start Date 부터 1주의 마지막 Date를 계산 
	cal_to_dt.value	  = gfn_addDate(cal_from_dt.value, 6);
	 
	// 기간에 해당하는 일수를 구함 
	
	var dToDate = gfn_strToDate(cal_to_dt.value);  
	
	var tdFromDate = gfn_addDate(cal_from_dt.value,1);
	
	var dFromDate = gfn_strToDate(tdFromDate); 
		
	il_cnt = gfn_getDiffDay(cal_from_dt.value,cal_to_dt.value) + 1;  //7일
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_SearchSubinv()
 * 입      력   : 
 * 반      환   : 없음
 * 기      능   : 식당 정보를 콤보에 연결
 * 작  성  자   : 구종화
 * 작성  일자   : 2007-12-20 
 ******************************************************************************************
 */
function fn_SearchSubinv()
{
	// 식당 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	
	inData			= "";
	outData			= "ds_SUBINV=gds_Csqlout";
	callBackFnc		= "fn_afterSearch2";
	otherArg		= "UPJANG="+wrapQuote(ds_input.getColumn(0,"UPJANG"));

	fsp_clear(this); 
    fsp_addSearch(this, "fm/fmm:FMM_SUBINV_S001");								// 조회 
	http.Sync = true;
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);		// 서비스 호출 
	http.Sync = false;
	
	// 초기값 셋팅
	cbo_SUBINV.index = 0;
	
	ds_input.setColumn(0,"SUBINV_CODE", cbo_SUBINV.value);

}

function fn_afterSearch2()
{
	Sort(ds_SUBINV,"CODE",true);
}	


/*
 ******************************************************************************************
	1. Function ID : fn_ds_sikck_search()
	2. 개       요 : 주간 식수예측 현황 읽어오기
	3. 기       능 : 제공일에 해당하는 주의 식수예측을 load
	4. 인 수 설 명 : 
 ******************************************************************************************
 */
function fn_ds_sikck_search()
{
	// 초기화
	ds_sikck.clearData();
	
	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	
	inData			= "ds_input=ds_input";
	outData			= "ds_sikck=ds_sikck";
	callBackFnc		= "fn_afterSearch";
	
	fsp_clear(this); 
    fsp_addSearch(this, "fm/fmm:FMM00160E_S005");									// 조회 
	http.Sync = true;
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);		// 서비스 호출 
	http.Sync = false;

}

/*
 ******************************************************************************************
	1. Function ID : fn_sikrateSearch()
	2. 개       요 : 주간식당목표 식재료율을 load
	3. 기       능 : 제공일에 해당하는 주의 주간식당목표 식재료율을 load
	4. 인 수 설 명 : 
 ******************************************************************************************
 */
function fn_sikrateSearch()
{
	// 초기화
	ds_sikrate.clearData();
	
	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	
	inData			= "ds_input=ds_input";
	outData			= "ds_sikrate=ds_sikrate";
	callBackFnc		= "fn_afterSearch";
	
	fsp_clear(this); 
    fsp_addSearch(this, "fm/fmm:FMM00160E_S002");									// 조회 
	http.Sync = true;
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);		// 서비스 호출 
	http.Sync = false;

}
/*
 ******************************************************************************************
	1. Function ID : fn_Sel_DS_head()
	2. 개       요 : 식단표의 Head 구성요소를 작성한다.
	3. 기       능 : 제공일에 해당하는 주의 기준 Head Data를 작성한다.
	4. 인 수 설 명 : 
 ******************************************************************************************
 */
function fn_Sel_DS_head1()
{
	// 초기화
	DS_head1.clearData();
	
	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	
	inData			= "ds_input=ds_input";
	outData			= "DS_head1=DS_head";
	callBackFnc		= "fn_afterSearch";

	fsp_clear(this); 
    fsp_addSearch(this, "fm/fmm:FMM00052E_S002");									// 조회 
    http.Sync = true;
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);		// 서비스 호출 
	http.Sync = false;

}

/*
 ******************************************************************************************
	1. Function ID : fn_Sel_DS_sgbn()
	2. 개       요 : 식단표의 좌측 기준정보(식,끼니)를 작성한다.
	3. 기       능 : 제공일에 해당하는 주의 좌측 기준정보(식,끼니)를 작성한다.
	4. 인 수 설 명 : 
 ******************************************************************************************
 */
function fn_Sel_DS_sgbn1()
{
	// 초기화
	DS_sgbn1.clearData();
	
	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	
	inData			= "ds_input=ds_input";
	outData			= "DS_sgbn1=DS_sgbn";
	callBackFnc		= "fn_afterSearch";
	
	fsp_clear(this); 
    fsp_addSearch(this, "fm/fmm:FMM00160E_S003");									// 조회 
	http.Sync = true;
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);		// 서비스 호출 
	http.Sync = false;

}

/*
 ******************************************************************************************
	1. Function ID : fn_Sel_DS_body()
	2. 개       요 : 메뉴정보를 불러온다.
	3. 기       능 : 제공일에 해당하는 주의 메뉴정보를 불러온다.
	4. 인 수 설 명 : 
 ******************************************************************************************
 */
function fn_Sel_DS_body1()
{
	// 초기화
	DS_body1.clearData();
	
	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	
	inData			= "ds_input=ds_input";
	outData			= "DS_body1=DS_body1";
	callBackFnc		= "fn_afterSearch";

	fsp_clear(this); 
    fsp_addSearch(this, "fm/fmm:FMM00160E_S004");									// 조회 
	http.Sync = true;
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);		// 서비스 호출 
	http.Sync = false;
	
	DS_body_f1.copyData(DS_body1);

	// 주간식단목표 식재료율을 setting한다.
	fn_ds_sikrateCond_oncolumnchanged("", 0);
}

/*
 ******************************************************************************************
	1. Function ID : fn_ds_view_Search()
	2. 개       요 : 4주간 실식수 현황을 조회
	3. 기       능 : 설정된 일자/식/끼니에 대한 4주전 실식수 현황을 조회한다.
	4. 인 수 설 명 : 
 ******************************************************************************************
 */
function fn_ds_view_Search(nCell)
{
	// 초기화
	ds_view.clearData();
	
	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	
	outData			= "ds_view=ds_view";
	otherArg		= "UPJANG="+wrapQuote(gfn_nvl(ds_input.getColumn(0,"UPJANG")));
	otherArg		+= " SUBINV_CODE="+wrapQuote(gfn_nvl(ds_input.getColumn(0,"SUBINV_CODE")));
	otherArg		+= " MEAL="+wrapQuote(gfn_nvl(DS_menu1.getColumn(DS_menu1.rowposition, "SGBN")));
	otherArg		+= " CORNER="+wrapQuote(gfn_nvl(DS_menu1.getColumn(DS_menu1.rowposition, "CGBN_CD")));
	otherArg		+= " SEL_DATE="+wrapQuote(gfn_nvl(DS_head1.getColumn(nCell-1, "FDAY")));
	callBackFnc		= "fn_afterSearch";

	fsp_clear(this); 
    fsp_addSearch(this, "fm/fmm:FMM00160E_S001");									// 조회 
	http.Sync = true;
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);		// 서비스 호출 
	http.Sync = false;

}

/*------------------------------------------------------------
	1. Function ID : fn_make_DS_menu1()
	2. 개       요 : Grid body에 해당하는 DataSet을 작성
	3. 기       능 : Grid body Format에 맞게 DS_menu1 DataSet의 Format을 작성하고 DataSet Format에 맞게
	                 Data를 Loading 시킨다.
	4. 인 수 설 명 : 
*/
function fn_make_DS_menu1()
{
	DS_menu1.enableevent = false; 	
	DS_menu1.clear();  
	
	DS_menu1.addColumn('SGBN'   , 'STRING', 256);
	DS_menu1.addColumn('SGBN_NM', 'STRING', 256);
	DS_menu1.addColumn('CGBN'   , 'STRING', 256);
	DS_menu1.addColumn('CGBN_NM', 'STRING', 256);
	DS_menu1.addColumn('CGBN_CD', 'STRING', 256);
	DS_menu1.addColumn('SGBN_NO', 'STRING', 256);
	DS_menu1.addColumn('CURR_DATE', 'STRING', 256);
	
	for(var ii = 0; ii < il_cnt; ii++)
	{
		DS_menu1.addColumn('FDAY_'             + gfn_subStr(DS_head1.getColumn(ii, "FDAY"),4,4), 'STRING', 256);
		DS_menu1.addColumn('SALE_PRICE_'       + gfn_subStr(DS_head1.getColumn(ii, "FDAY"),4,4), 'STRING', 256);
		DS_menu1.addColumn('EXPECT_MEAL_QTY_'  + gfn_subStr(DS_head1.getColumn(ii, "FDAY"),4,4), 'STRING', 256);
		DS_menu1.addColumn('SSEQ_'             + gfn_subStr(DS_head1.getColumn(ii, "FDAY"),4,4), 'STRING', 256);
		DS_menu1.addColumn('REAL_MEAL_QTY_'    + gfn_subStr(DS_head1.getColumn(ii, "FDAY"),4,4), 'BIGDECIMAL', 256);
		DS_menu1.addColumn('RECIPE_YN_'        + gfn_subStr(DS_head1.getColumn(ii, "FDAY"),4,4), 'STRING', 256);
		DS_menu1.addColumn('ORDER_YN_'         + gfn_subStr(DS_head1.getColumn(ii, "FDAY"),4,4), 'STRING', 256);
		DS_menu1.addColumn('GOAL_COST_RATE_'   + gfn_subStr(DS_head1.getColumn(ii, "FDAY"),4,4), 'BIGDECIMAL', 256);
	}
 
	// Data를 작성합니다. [ DS_body -> DS_menu Create ]
	var	cnt_ds_total = 0;

	for(var ii = 0; ii < DS_sgbn1.getRowCount(); ii++) {
	
		DS_body_f1.filter("");

		var	fil_cond = "";
		var	max_row	 = 0;
		
		fil_cond	+= "SGBN=='"+DS_sgbn1.getColumn(ii, "SGBN")+"'&&CGBN=='"+DS_sgbn1.getColumn(ii, "CGBN")+"'&&CGBN_CD=='"+DS_sgbn1.getColumn(ii, "CGBN_CD")+"'";

		DS_body_f1.filter(fil_cond);
		
		DS_body_c1.clear();
		CopyF(DS_body_c1,"DS_body_f1");

		DS_body_c1.filter("SSEQ<>'99'");
		var max_row = toNumber(DS_body_c1.getMax("SSEQ"));

		// DS_menu DataSet에 Row를 생성
		for(var jj = 0; jj < max_row; jj++) {
			DS_menu1.addRow();
		}
		
		if (DS_body_c1.getRowCount() == 0) {
			var set_row = cnt_ds_total;
			
			DS_menu1.setColumn(set_row, "SGBN", 		DS_sgbn1.getColumn(ii, "SGBN"));
			DS_menu1.setColumn(set_row, "SGBN_NM", 		DS_sgbn1.getColumn(ii, "SGBN_NM"));
			DS_menu1.setColumn(set_row, "CGBN", 		DS_sgbn1.getColumn(ii, "CGBN"));
			DS_menu1.setColumn(set_row, "CGBN_NM", 		DS_sgbn1.getColumn(ii, "CGBN_NM"));
			DS_menu1.setColumn(set_row, "CGBN_CD", 		DS_sgbn1.getColumn(ii, "CGBN_CD"));
			DS_menu1.setColumn(set_row, "SGBN_NO", 		(ii+1));
			DS_menu1.setColumn(set_row, "CURR_DATE", 	curr_date);
		}
		else {
			// 생성된 Row에 Data를 setup 한다
			for(var kk = 0; kk < DS_body_c1.getRowCount(); kk++) {
			
				var set_row = cnt_ds_total + toNumber(DS_body_c1.getColumn(kk, "SSEQ")) - 1;
				
				DS_menu1.setColumn(set_row, "SGBN", 		DS_body_c1.getColumn(kk, "SGBN"));
				DS_menu1.setColumn(set_row, "SGBN_NM", 		DS_body_c1.getColumn(kk, "SGBN_NM"));
				DS_menu1.setColumn(set_row, "CGBN", 		DS_body_c1.getColumn(kk, "CGBN"));
				DS_menu1.setColumn(set_row, "CGBN_NM", 		DS_body_c1.getColumn(kk, "CGBN_NM"));
				DS_menu1.setColumn(set_row, "CGBN_CD", 		DS_body_c1.getColumn(kk, "CGBN_CD"));
				DS_menu1.setColumn(set_row, "SGBN_NO", 		(ii+1));
				DS_menu1.setColumn(set_row, "CURR_DATE", 	DS_body_c1.getColumn(kk, "CURR_DATE"));
				//
				var set_col = gfn_subStr(DS_body_c1.getColumn(kk, "FDAY"),4,4);

				DS_menu1.setColumn(set_row, "FDAY_"				+set_col, 	DS_body_c1.getColumn(kk, "FDAY"));
				DS_menu1.setColumn(set_row, "SALE_PRICE_"		+set_col, 	DS_body_c1.getColumn(kk, "SALE_PRICE"));
				DS_menu1.setColumn(set_row, "EXPECT_MEAL_QTY_"	+set_col, 	DS_body_c1.getColumn(kk, "EXPECT_MEAL_QTY"));
				DS_menu1.setColumn(set_row, "SSEQ_"				+set_col, 	DS_body_c1.getColumn(kk, "SSEQ"));
				DS_menu1.setColumn(set_row, "REAL_MEAL_QTY_"	+set_col, 	DS_body_c1.getColumn(kk, "REAL_MEAL_QTY"));
				DS_menu1.setColumn(set_row, "RECIPE_YN_"		+set_col, 	DS_body_c1.getColumn(kk, "RECIPE_YN"));
				DS_menu1.setColumn(set_row, "ORDER_YN_"			+set_col, 	DS_body_c1.getColumn(kk, "ORDER_YN"));
				DS_menu1.setColumn(set_row, "GOAL_COST_RATE_"	+set_col, 	DS_body_c1.getColumn(kk, "GOAL_COST_RATE"));
			}
		}
		// DS_menu Row 위치를 산정하기 위한 누적값
		cnt_ds_total = cnt_ds_total + max_row;
	}
	//
	DS_menu1.rowposition = 0;
	DS_menu1.applyChange();
	DS_menu1.enableevent = true;

	//G_debug("DS_menu1");
}

/*------------------------------------------------------------
	1. Function ID : fn_make_grdlst()
	2. 개       요 : 조건에 맞는 Grid Format을 작성
	3. 기       능 : 검색조건 기간이 유동적으로 구성되므로 조건에 해당하는 정보를 화면으로
	                 출력하기 위해 Grid를 재구성한다.
	4. 인 수 설 명 : 
*/
function fn_make_grdlst()
{
	// GRID 작성
	var Contents_grd_lst	 = "";
	var Contents_grd_column  = "";
	var Contents_grd_rows    = "";
	var Contents_grd_head    = "";
	var Contents_grd_body    = "";
	var Contents_grd_body1    = "";
	var Contents_grd_summary = "";
	// 
	// Grid를 작성합니다.
	//
	Contents_grd_lst	 = '<Formats>' + '\n';
	Contents_grd_lst    += '<Format id="default">' + '\n';
	
	// Grid columns를 작성합니다.
	Contents_grd_column  = ' <Columns>' + '\n';
	Contents_grd_column	+= ' <Column size="110" band="left" />' + '\n';
	for(var ii = 0; ii < il_cnt; ii++)
	{
		Contents_grd_column	+= ' <Column size="0" />' + '\n';
		Contents_grd_column	+= ' <Column size="87" />' + '\n';
		Contents_grd_column	+= ' <Column size="34"  />' + '\n';
	}
	Contents_grd_column += ' </Columns>' + '\n'; 

	// Grid rows를 작성합니다.
	Contents_grd_rows  = ' <Rows>' + '\n';
  	Contents_grd_rows += ' <Row size="48" band="head" />' + '\n';
  	Contents_grd_rows += ' <Row size="24" />'             + '\n';
	Contents_grd_rows += ' </Rows>' + '\n';
	
	// Grid head를 작성합니다.
	Contents_grd_head	 = '  <Band id="head">' + '\n';
	Contents_grd_head	+= '   <cell col="0" style="" displaytype="text" text="끼니(코너명)"  /> ' + '\n';

	var	v_col1 = -1;
	var	v_col2 = 0;
	var	v_day  = "";
	var v_wImg = "";

	for(var ii = 0; ii < il_cnt; ii++)
	{
		v_col1 	= v_col1 + 3;
		v_col2 	= v_col2 + 3;
		
		v_day	= toNumber(gfn_subStr(DS_head1.getColumn(ii, "FDAY"),4,2)) + "/" + toNumber(gfn_subStr(DS_head1.getColumn(ii, "FDAY"),6,2))
				+ "(" + DS_head1.getColumn(ii, "WE") + ")" ;
		if ( gfn_isNull(DS_head1.getColumn(ii,"WIMG")) ) {
			v_wImg = "";
		} else {
			v_wImg = "URL(&apos;theme://convertImages/" + DS_head1.getColumn(ii,"WIMG") + ".png&apos;)";
		}
		
		Contents_grd_head	+= '    <cell col="'+ v_col1 + '" style="color:' + DS_head1.getColumn(ii, "WE_COLOR") + ';" displaytype="text" text="'+v_day+'" />' + '\n';
		Contents_grd_head	+= '    <cell col="'+ v_col2 + '" style="" displaytype="image" text="'+v_wImg+'" />' + '\n';
	}	
	Contents_grd_head	+= '  </Band>' + '\n';
 
  	// Grid body를 작성합니다.
  	Contents_grd_body	= '  <Band id="body">' + '\n';
    Contents_grd_body	+= ' <cell align="center" style="font:굴림,8,bold;" display="text" text="expr:gfn_length(CGBN_NM)==0?SGBN_NM+CGBN:SGBN_NM+CGBN+&apos;(&apos;+CGBN_NM+&apos;)&apos;" suppress="1" suppressalign="middle"/>' + '\n';

	var	v_col3 = 0;
	var	v_seq  = "";
	
	for(var ii = 0; ii < il_cnt; ii++)
	{
		v_col3 = (ii * 3) + 1;
		v_seq  = gfn_subStr(DS_head1.getColumn(ii, "FDAY"),4,4);
		
		Contents_grd_body	+= '  <cell col="'+ v_col3 + '" colspan="3" displaytype="number" editautoselect="true" edittype="expr:iif(REAL_MEAL_QTY_'+v_seq+'&#32;&gt;&#32;0&#32;||&#32;ORDER_YN_'+v_seq+'&#32;==&#32;&apos;Y&apos;&#32;||&#32;CURR_DATE&#32;&gt;&#32;FDAY_'+v_seq+',&#32;&apos;none&apos;,&#32;&apos;masknumber&apos;)" mask="###,##0" editlimitbymask="both" style="align:right;" text="bind:EXPECT_MEAL_QTY_' + v_seq + '" />' + '\n';
		//Contents_grd_body	+= '  <cell col="'+ v_col3 + '" colspan="3" displaytype="number" editautoselect="true" edittype="expr:iif(REAL_MEAL_QTY_'+v_seq+'&#32;&gt;&#32;0&#32;||&#32;ORDER_YN_'+v_seq+'&#32;==&#32;&apos;Y&apos;&#32;||&#32;CURR_DATE&#32;&gt;&#32;FDAY_'+v_seq+',&#32;&apos;none&apos;,&#32;&apos;masknumber&apos;)" mask="#,##0" style="align:right;" text="bind:EXPECT_MEAL_QTY_' + v_seq + '" />' + '\n';
		//Contents_grd_body	+= '  <cell col="'+ v_col3 + '" colspan="3" displaytype="number" editautoselect="true" edittype="masknumber" mask="#,##0" style="align:right;" text="bind:EXPECT_MEAL_QTY_' + v_seq + '" />' + '\n';

		//Contents_grd_body	+= '  <cell col="'+ v_col3 + '" colspan="3" >' + '\n';
		//Contents_grd_body	+= '   <cell col="0" />' + '\n';
		//Contents_grd_body	+= '   <cell col="1" />' + '\n';
		//Contents_grd_body	+= '   <cell col="2" displaytype="number" edittype="expr:iif(REAL_MEAL_QTY_'+v_seq+'&#32;&gt;&#32;0&#32;||&#32;ORDER_YN_'+v_seq+'&#32;==&#32;&apos;Y&apos;&#32;||&#32;CURR_DATE&#32;&gt;&#32;FDAY_'+v_seq+',&#32;&apos;none&apos;,&#32;&apos;masknumber&apos;)" mask="#,##0" editautoselect="true" style="align:right;" text="bind:EXPECT_MEAL_QTY_' + v_seq + '" />' + '\n';
		//Contents_grd_body	+= '   <cell col="2" displaytype="number" edittype="masknumber" mask="#,##0" editautoselect="true" style="align:right;" text="bind:EXPECT_MEAL_QTY_' + v_seq + '" />' + '\n';
		//Contents_grd_body	+= '  </cell>' + '\n'; 
	}
	Contents_grd_body	+= '  </Band>' + '\n'; 

 	Contents_grd_lst	+= Contents_grd_column + Contents_grd_rows + Contents_grd_head + Contents_grd_body + '</Format>' + '\n' + '</Formats>';
//trace(Contents_grd_lst);
	grd_lst.formats  = Contents_grd_lst;
 	grd_lst.formatid = "default"; 
 	grd_lst.autoenter = "select";
	grd_lst.nodataimage = gv_noData;
	//grd_lst.autofittype = "col";
	//grd_lst.selecttype  = "row"; 	
}

//******************************************************************************************
// [ PART 6 ]
// component Event 정의 ( User Define function )
// --> component Event의 기요,기능,동작 등 상세내용은 MiPlatform 메뉴얼을 참조하시기 바랍니다.
//******************************************************************************************

function Button1_OnClick(obj)
{
	//DS_menu1.AddRow();
	gfn_exportExcel(grd_lst, "식단표");
	//alert(DS_menu1.row);
	
}

function grd_lst_OnMouseOver(obj:Grid, e:GridMouseEventInfo)
{
	return;
	
	//----------------------------------
	// Tooltip 설명 처리부
	//----------------------------------
	// Head 부 처리
	var	srow 	= 0.0;
	var	int_srow= 0;
	var	v_seq  	= "";

	if (e.row == -1 && e.cell > 3) {
		srow = toNumber((e.cell-1)/3);
		int_srow = parseInt(srow);
		//alert("/"+srow+"/"+int_srow+"/");
		//alert(length(DS_head1.GetColumn((int_srow-1), "rem")));
		
		if (gfn_length(DS_head1.getColumn((int_srow-1), "REM"))> 8 && int_srow == srow) {
			grd_lst.tooltiptext = "☞ 일정 : "+DS_head1.getColumn((int_srow-1), "REM")+" ";
			return;
		}
		else { grd_lst.tooltiptext = ""; }
	}
	else { grd_lst.tooltiptext = ""; }
	// Body 부 처리
	//grd_lst.ToolTipText = "nRow :"+nRow+"\nnCell :"+nCell+"\nnPosX :"+nPosX+"\nnPosY :"+nPosY;
	v_seq  = gfn_subStr(DS_head1.getColumn((e.cell-1), "FDAY"),4,4);
	//alert(v_seq);
	
	if (e.row > -1 && e.cell > 0 && gfn_length(DS_menu1.getColumn(e.row, "DUP_STA_"+v_seq))> 0) {
		if (e.clientX > 740) {
			Div_pop.position.left = e.clientX-(Div_pop.position.width);
			Div_pop.position.top  = e.clientY+30;
			// 화면에 보여질 정보를 처리한다.
			Div_pop.visible = true;
		}
		else {
			Div_pop.position.left = e.clientX+15;
			Div_pop.position.top  = e.clientY+30;
			// 화면에 보여질 정보를 처리한다.
			Div_pop.visible = true;
		}
	}
	else {
		Div_pop.visible = false;
	}
		//alert("nRow :"+nRow);
		//alert("nCell :"+nCell);
	
}

function grd_lst_OnMouseOut(obj:Grid, e:MouseEventInfo)
{
	//Div_pop.Visible = false;
}

// 컬럼 이동시 4주간 실식수 현황을 조회한다.
function grd_lst_OnCellPosChanged(obj:Grid, e:GridSelectEventInfo)
{
//trace("grd_lst_OnCellPosChanged>>>");
	if (e.cell > 0) {
		// 4주간 실식수 현황을 조회한다.
		fn_ds_view_Search(e.cell);
		grd_lst.setFocus();
	}			
}

// 레시피가 존재하면 식수인원을 zero로 수정할 수 없습니다.
function DS_menu1_CanColumnChange(obj:Dataset, e:DSColChangeEventInfo)
{
	var	v_col = "RECIPE_YN_"+gfn_subStr(e.columnid,gfn_length(e.columnid)-4,4);

	if (obj.getColumn(e.row, v_col) == "Y" && e.newvalue == 0) {
		g_Message("EE",	"레시피 정보를 삭제 후 처리하세요.");
		obj.setColumn(e.row, e.columnid, e.oldvalue);
		return false;
	}

	v_col = "ORDER_YN_"+gfn_subStr(e.columnid,gfn_length(e.columnid)-4,4);
	
	if (obj.getColumn(e.row, v_col) == "Y") {
		g_Message("EE",	"식자재가 발주되었습니다.\n\n예상식수를 삭제할수 없습니다.");
		obj.setColumn(e.row, e.columnid, e.oldvalue);
		return false;
	}
	
	return true;
}

// 주간식단목표 식재료율이 변경되면 ...
function ds_sikrateCond_oncolumnchanged(obj:Dataset, e:DSColChangeEventInfo)
{
	fn_ds_sikrateCond_oncolumnchanged(obj, e.newvalue);
}

function fn_ds_sikrateCond_oncolumnchanged(obj, nVal)
{
	//alert(length(toString(strText)));
	if (nVal > 0) {
		// 변경된 주간식단목표 식재료율을 setting 한다.
		DS_menu1.enableevent = false;
		for(var ii = 0; ii < DS_menu1.getRowCount(); ii++) {
			for(var kk = 0; kk < DS_head1.getRowCount(); kk++) {
				var set_col	= gfn_subStr(DS_head1.getColumn(kk, "FDAY"),4,4);
				DS_menu1.setColumn(ii, "GOAL_COST_RATE_"+set_col, nVal);
			}
		}
		DS_menu1.enableevent = true;
		
		// 변경된 주간식단목표 식재료율을 setting 한다. 2008-01-07 추가됨
		for(var ii = 0; ii < ds_sikrate.getRowCount(); ii++) {
			ds_sikrate.setColumn(ii, "GOAL_COST_RATE", nVal);
		}
		
	} else {
		// 주간식단목표 식재료율 setting
		//me_sikrate.Value = DS_body1.Max("GOAL_COST_RATE");                 // 변경전 2008-01-07
		var nRateVal = ds_sikrate.getMax("GOAL_COST_RATE");
		if ( nRateVal > 0 ) {
			ds_sikrateCond.setColumn(0,"SIKRATE", nRateVal);
			//ds_sikrate.setColumn(0,nRateVal);
			//fn_ds_sikrateCond_oncolumnchanged(ds_sikrateCond, nRateVal);
		} else {
			//ds_sikrate.setColumn(0,0);
		}
	}	
}

function btn_copy_OnClick(obj:Button, e:ClickEventInfo)
{
	if(g_Confirm("04","전주 예측을 복사하시겠습니까?")==false) {
		return;
	}	

	ds_input.setColumn(0, "EMP_NO", g_EmpNo);
	// ----------------------------
    fsp_clear(this);
    
    var actionName, cmdName, inData, outData, otherArg, callBackFnc;
    var sqlId, keySqlName, keyIncrement, callbackSql;
  			
	inData		= "ds_input=ds_input";
	outData		= "";
	callBackFnc	= "fn_afterSearch";
	
	sqlId 		= "fm/fmm:FMM00160E_I010";
	keySqlName	= "";
	keyIncrement= -1;
	callbackSql	= "";
	// tit_addMultiActionInfo(formObj, sqlId, keySqlName, keyIncrement, callbackSql)			
	
	fsp_addMulti(this, sqlId);
	
	http.Sync=true;
	fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc,"",true);	
	http.Sync=false;	
	// ----------------------------
	// 복사된 정보를 읽는다.
	fn_search();
}

/*
 ******************************************************************************************
 * 함  수  명   : btn_pop1_OnClick(obj)
 * 기      능   : 팝업버튼 클릭 -> 사업장 조회
 * 작  성  자   : 
 * 작성  일자   : 2007-12-03  
 ******************************************************************************************
 */
/*------------------------------------------------------------
	1. Function    : btn_Upjang_OnClick(obj)
	2. Description : 사업장 검색 팝업
	3. Arguments   : 
	4. History     : 2008. 01. 23 - 최초작성
*------------------------------------------------------------*/
function btn_Upjang_OnClick(obj:Button, e:ClickEventInfo)
{
	var sAddWhere = "";
	
	//alert("obj.id : " + obj.id + "\n" + "global.g_UserKind : " + global.g_UserKind + "\n" + "ed_Upjang.UserData : " + ed_Upjang.UserData + "\n" + "ed_Upjang.UserData : " + ed_Upjang.UserData);
	
	switch(obj.name)
	{	
		case "btn_MainUpjang":
			if (application.g_UserKind == '본부')
			{
				sAddWhere = " AND A.MAIN_UPJANG = A.UPJANG ";
				break;
			}
			else if (application.g_UserKind == '본사')
			{
				sAddWhere = " AND A.USE_YN = 'Y' AND A.MAIN_UPJANG = A.UPJANG AND A.MAIN_UPJANG = " + gfn_nvl(g_Main_Upjang);			
				break;
			}
			else if (application.g_UserKind == '사업장')
			{
				sAddWhere = " AND A.USE_YN = 'Y' AND A.MAIN_UPJANG = A.UPJANG AND A.MAIN_UPJANG = " + gfn_nvl(g_Main_Upjang);			
				break;
			}	
		
		case "btn_Upjang":
			//trace("g_UserKind==="+g_UserKind+"::::g_Main_Upjang==="+g_Main_Upjang+":::g_Upjang==="+g_Upjang);
			if (application.g_UserKind == '사업장'){
				sAddWhere = " AND A.USE_YN = 'Y' AND A.MAIN_UPJANG = " + gfn_nvl(g_Main_Upjang);		
				sAddWhere += " AND ( A.UPJANG = " + gfn_nvl(application.g_Upjang) + " OR EXISTS (SELECT 1 FROM FMS_USER_UPJANG B WHERE B.USE_YN = 'Y' AND B.UPJANG = A.UPJANG AND B.SABUN = '" + gfn_nvl(application.g_EmpNo) + "') )";	
			}
			else if (application.g_UserKind == '본사'){		
				sAddWhere = " AND A.USE_YN = 'Y' AND A.MAIN_UPJANG = " + gfn_nvl(g_Main_Upjang);	
			}
			else if (application.g_UserKind == '본부'){
				sAddWhere = " AND A.USE_YN = 'Y' " ;
			}
			
			if (gfn_length(ed_Upjang.userdata)> 0)
			{
				//sAddWhere += " AND A.MAIN_UPJANG = " + ed_Upjang.UserData;	
				//잘못된 코드 수정
				sAddWhere += " AND A.MAIN_UPJANG = " + gfn_nvl(g_Main_Upjang);
			}
			
			break;
		default:
			break;
	}
	//fm공통 팝업클릭 호출
	//ffn_btn_OnClick(obj, sAddWhere);
	 if (ffn_btn_OnClick(obj, sAddWhere)) fn_Trigger_edBtn(eval("ed_" + gfn_subStr(obj.name, 4)));
	
	if (obj == btn_Upjang)
	{
		ds_input.setColumn(0,"UPJANG",eval(gfn_replace(obj.name,"btn_","ed_")).userdata);
	}
	// 식당정보 조회
	fn_SearchSubinv();	
}

function fn_edBtn_OnKeyDown(obj:Edit, e:KeyEventInfo)
{
	ffn_ed_OnKeyDown(obj,e.keycode);
	//Del의 경우 뒷처리
	if (e.keycode == 46) fn_Trigger_edBtn(obj);
}

function fn_Trigger_edBtn(obj)
{
	switch(obj.name)
	{
		
		case "ed_Upjang":
			break;
			
		default:
			break;
	}
}

/*------------------------------------------------------------
	1. Function    : ed_Upjang_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam)
	2. Description : 검색조건 Enter Key Event
	3. Arguments   : 
	4. History     : 2008. 01. 23 - 최초작성
*------------------------------------------------------------*/
function ed_Upjang_OnKeyDown(obj:Edit, e:KeyEventInfo)
{
	ffn_ed_OnKeyDown(obj,e.keycode);
	//Del의 경우 뒷처리
	if (e.keycode == 46) fn_Trigger_edBtn(obj);
}


/*------------------------------------------------------------
	1. Function    : btn_sikdan_OnClick()
	2. Description : 식단등록 바로가기 버튼 클릭
	3. Arguments   : 
	4. History     : 2008. 04. 28 - 최초작성
*------------------------------------------------------------*/
function btn_sikdan_OnClick(obj:Button, e:ClickEventInfo)
{
    gfn_openMenuForm("FMM00200E.xfdl", "U_FMM", "", "식단 등록");
}

function btn_GiveCal_OnClick(obj:Button, e:ClickEventInfo)
{
	g_CalButton_OnClick(obj);
	
	var nCheckDate = gfn_checkDate8(me_GiveDay.value);
	if ( nCheckDate == 0 || nCheckDate == 1) {
		return;
	} else {
		fn_me_GiveDay_OnChanged(me_GiveDay.value);
		fn_search();
	}
}

function fn_me_GiveDay_OnChanged(sVal)
{
	cal_MENU_DATE.value = sVal;
	fn_week_create();
}

//날짜체크
function me_GiveDay_onkillfocus(obj:MaskEdit, e:KillFocusEventInfo)
{
	g_Date_OnKillFocus(obj);
	
	var nCheckDate = gfn_checkDate8(obj.value);
	if ( nCheckDate == 0) {
		fn_me_GiveDay_OnChanged("");
	} else if ( nCheckDate == -1) {
		fn_me_GiveDay_OnChanged("");
	} else {
		fn_me_GiveDay_OnChanged(nCheckDate);
	}	
}

// 식당식수 불러오기
function btn_call_OnClick(obj:Button, e:ClickEventInfo)
{
	// 초기화
	ds_sikck.clearData();
	fsp_addSearch(this, "fm/fms:FMS00140E_S003");
	fsp_callService(this, "", "", "", 
           "ds_list_dtl=ds_dout", "UPJANG="+gfn_nvl(ds_input.getColumn(0,"UPJANG"))+" PARENT_UPJANG=''", "fn_CallBackSiksu");

}


function fn_CallBackSiksu()
{
	var v_sgbn;
	var v_fRow;
	var v_value;

	for (i =0; i < DS_menu1.rowcount; i++) {
		v_sgbn = DS_menu1.getColumn(i,"SGBN");
		v_cgbn = DS_menu1.getColumn(i,"CGBN");
		
		if (v_cgbn == "A") v_cgbn = "001";
		if (v_cgbn == "B") v_cgbn = "002";
		if (v_cgbn == "C") v_cgbn = "003";
		if (v_cgbn == "D") v_cgbn = "004";
		if (v_cgbn == "E") v_cgbn = "005";
		if (v_cgbn == "F") v_cgbn = "006";
		if (v_cgbn == "G") v_cgbn = "007";
		if (v_cgbn == "H") v_cgbn = "008";
		if (v_cgbn == "I") v_cgbn = "009";
		
		v_fRow = ds_list_dtl.findRowExpr("CORNER == '" + v_cgbn +"' " + "&& MEAL == '" + v_sgbn +"'"  );
		v_value = ds_list_dtl.getColumn(v_fRow,"EXPECT_MEAL_QTY");

		if (v_value > 0 ) {
			for (j = 0; j < DS_menu1.getColCount(); j++) {
				if (gfn_subStr(DS_menu1.getColID(j),0,15)== "EXPECT_MEAL_QTY") {
					DS_menu1.setColumn(i,j,v_value);
				}
			}
		}
	}
	
}

function grd_lst_onkeydown(obj:Grid, e:KeyEventInfo)
{
// 	trace("e.keycode==="+e.keycode);
// 	trace("obj.getCellPos()==="+obj.getCellPos());
	if ( e.keycode == 13 ) {	//엔터
		if ( obj.getCellPos() == 7 ) {
			eval(obj.binddataset).rowposition = eval(obj.binddataset).rowposition + 1;
			obj.setCellPos(1);
		} else {
			obj.setCellPos(obj.getCellPos() + 1);
		}
	}
}

function fn_FormKeyDown(obj:Form, e:KeyEventInfo)
{
	gfn_formKeyDown(obj, e); //(obj,e.fromreferenceobject,e.keycode,e.shiftKey,e.ctrlKey,e.altKey,-1,-1);
	if ( (e.keycode == 13) && (e.fromreferenceobject == me_GiveDay) ) fn_search();
}
]]></Script>
  </Form>
</FDL>
