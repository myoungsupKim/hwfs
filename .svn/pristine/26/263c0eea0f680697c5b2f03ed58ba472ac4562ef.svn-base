<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="..\..\..\default_typedef.xml"/>
  <Form id="CloseMgnt01" classname="CloseMgnt01" inheritanceid="" position="absolute 0 0 1251 725" titletext="일마감" style="background:white;color:red;" onload="form_onload">
    <Layouts>
      <Layout>
        <Div id="div_cmnBtn" anchor="left top right" taborder="8" tabstop="false" url="cmn::CmnBtn.xfdl" text="Div00" scrollbars="none" position="absolute 0 0 1237 30"/>
        <Static id="Static22" text="매출정보" class="sta_WF_Title01" position="absolute 0 110 450 128" anchor="left top"/>
        <Static id="Static15" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 0 97 1236 110" anchor="left top"/>
        <Static id="Static16" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 0 123 1236 128" anchor="left top"/>
        <Static id="Static58" class="sta_WFSA_Labelbg" position="absolute 0 30 1236 97" anchor="left top right"/>
        <Static id="Static70" text="H10" visible="false" position="absolute 15 30 1220 40" style="background:#ff000055;align:center middle;"/>
        <Static id="Static72" text="W15" visible="false" position="absolute 0 30 15 91" style="background:#ff000055;align:center middle;"/>
        <Static id="Static71" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 710 1251 725" anchor="left bottom"/>
        <Static id="Static06" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1236 0 1251 710" anchor="top right"/>
        <Grid id="grd_salsList" taborder="6" binddataset="ds_salsList" autoenter="none" useinputpanel="false" cellsizingtype="none" position="absolute 0 128 552 710" anchor="left top bottom" formats="&lt;Formats&gt;&#10;  &lt;Format id=&quot;default&quot;&gt;&#10;    &lt;Columns&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;    &lt;/Columns&gt;&#10;    &lt;Rows&gt;&#10;      &lt;Row band=&quot;head&quot; size=&quot;24&quot;/&gt;&#10;      &lt;Row band=&quot;body&quot; size=&quot;24&quot;/&gt;&#10;    &lt;/Rows&gt;&#10;    &lt;Band id=&quot;head&quot;&gt;&#10;      &lt;Cell col=&quot;0&quot; disptype=&quot;normal&quot; text=&quot;Seq&quot;/&gt;&#10;      &lt;Cell col=&quot;1&quot; disptype=&quot;normal&quot; text=&quot;매출유형&quot;/&gt;&#10;      &lt;Cell col=&quot;2&quot; disptype=&quot;normal&quot; text=&quot;Net&quot;/&gt;&#10;      &lt;Cell col=&quot;3&quot; disptype=&quot;normal&quot; text=&quot;VAT&quot;/&gt;&#10;      &lt;Cell col=&quot;4&quot; disptype=&quot;normal&quot; text=&quot;계&quot;/&gt;&#10;    &lt;/Band&gt;&#10;    &lt;Band id=&quot;body&quot;&gt;&#10;      &lt;Cell col=&quot;0&quot; disptype=&quot;normal&quot; text=&quot;bind:Seq&quot;/&gt;&#10;      &lt;Cell col=&quot;1&quot; disptype=&quot;normal&quot; text=&quot;bind:매출유형&quot;/&gt;&#10;      &lt;Cell col=&quot;2&quot; disptype=&quot;normal&quot; text=&quot;bind:Net&quot;/&gt;&#10;      &lt;Cell col=&quot;3&quot; disptype=&quot;normal&quot; text=&quot;bind:VAT&quot;/&gt;&#10;      &lt;Cell col=&quot;4&quot; disptype=&quot;normal&quot; text=&quot;bind:계&quot;/&gt;&#10;    &lt;/Band&gt;&#10;  &lt;/Format&gt;&#10;&lt;/Formats&gt;&#10;" treeusecheckbox="false" treeuseimage="true" treeinitstatus="expand,all" autofittype="col">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="220"/>
                <Column size="100"/>
                <Column size="100"/>
                <Column size="100"/>
              </Columns>
              <Rows>
                <Row size="24" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell text="매출유형"/>
                <Cell col="1" text="Net"/>
                <Cell col="2" text="VAT"/>
                <Cell col="3" text="계"/>
              </Band>
              <Band id="body">
                <Cell displaytype="tree" edittype="tree" text="bind:salsClassNm" treelevel="bind:lvl"/>
                <Cell col="1" displaytype="number" text="bind:netAmt"/>
                <Cell col="2" displaytype="number" text="bind:vatAmt"/>
                <Cell col="3" displaytype="number" text="bind:salAmt"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Grid id="grd_paymentList" taborder="7" binddataset="ds_paymentList" autoenter="select" useinputpanel="false" cellsizingtype="col" position="absolute 562 128 1236 518" anchor="left top right" formats="&lt;Formats&gt;&#10;  &lt;Format id=&quot;default&quot;&gt;&#10;    &lt;Columns&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;    &lt;/Columns&gt;&#10;    &lt;Rows&gt;&#10;      &lt;Row band=&quot;head&quot; size=&quot;24&quot;/&gt;&#10;      &lt;Row band=&quot;body&quot; size=&quot;24&quot;/&gt;&#10;    &lt;/Rows&gt;&#10;    &lt;Band id=&quot;head&quot;&gt;&#10;      &lt;Cell col=&quot;0&quot; disptype=&quot;normal&quot; text=&quot;Seq&quot;/&gt;&#10;      &lt;Cell col=&quot;1&quot; disptype=&quot;normal&quot; text=&quot;지불유형&quot;/&gt;&#10;      &lt;Cell col=&quot;2&quot; disptype=&quot;normal&quot; text=&quot;지불구분&quot;/&gt;&#10;      &lt;Cell col=&quot;3&quot; disptype=&quot;normal&quot; text=&quot;건수&quot;/&gt;&#10;      &lt;Cell col=&quot;4&quot; disptype=&quot;normal&quot; text=&quot;금액&quot;/&gt;&#10;    &lt;/Band&gt;&#10;    &lt;Band id=&quot;body&quot;&gt;&#10;      &lt;Cell col=&quot;0&quot; disptype=&quot;normal&quot; text=&quot;bind:Seq&quot;/&gt;&#10;      &lt;Cell col=&quot;1&quot; disptype=&quot;normal&quot; text=&quot;bind:지불유형&quot;/&gt;&#10;      &lt;Cell col=&quot;2&quot; disptype=&quot;normal&quot; text=&quot;bind:지불구분&quot;/&gt;&#10;      &lt;Cell col=&quot;3&quot; disptype=&quot;normal&quot; text=&quot;bind:건수&quot;/&gt;&#10;      &lt;Cell col=&quot;4&quot; disptype=&quot;normal&quot; text=&quot;bind:금액&quot;/&gt;&#10;    &lt;/Band&gt;&#10;  &lt;/Format&gt;&#10;&lt;/Formats&gt;&#10;" treeusecheckbox="false" treeinitstatus="expand,all" treeuseimage="false" autofittype="col">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="220"/>
                <Column size="100"/>
                <Column size="160"/>
                <Column size="80"/>
                <Column size="110"/>
              </Columns>
              <Rows>
                <Row size="24" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell text="업장"/>
                <Cell col="1" text="지불유형"/>
                <Cell col="2" text="지불구분"/>
                <Cell col="3" text="건수"/>
                <Cell col="4" text="금액"/>
              </Band>
              <Band id="body">
                <Cell displaytype="tree" edittype="tree" style="align:left;" text="expr:upjangNm" editautoselect="true" suppress="0" treelevel="bind:lvl"/>
                <Cell col="1" text="bind:payCdNm"/>
                <Cell col="2" style="align:left middle;" text="bind:payTypeNm"/>
                <Cell col="3" displaytype="number" text="bind:cnt"/>
                <Cell col="4" displaytype="number" text="bind:amt"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Static id="Static53" text="w10" class="Guide01_AreaRed" visible="false" position="absolute 552 97 562 735"/>
        <MaskEdit id="edt_differAmt" taborder="11" value="0" readonly="true" mask="#,###" position="absolute 1016 106 1168 127" style="background:transparent;border:1 none #c2c2c2ff ;color:red;padding:1 5 0 0;font:gulim,9,bold;" anchor="top right"/>
        <Static id="Static28" text="발생일자" class="sta_WFSA_label" position="absolute 326 66 388 87" anchor="left top" style="align:left middle;"/>
        <Static id="Static05" text="W15" visible="false" position="absolute 1220 30 1235 76" style="background:#ff000055;align:center middle;"/>
        <Static id="Static10" text="지불정보" class="sta_WF_Title01" position="absolute 562 110 1012 128" anchor="left top"/>
        <Button id="btn_cancel" taborder="15" text="마감취소" onclick="btn_cancel_onclick" class="btn_WF_CRUD" position="absolute 786 0 851 25" anchor="left top" visible="true" style="font:Gulim,9,bold;" enable="false"/>
        <Button id="btn_receive" taborder="16" text="마감처리" onclick="btn_receive_onclick" class="btn_WF_CRUD" position="absolute 719 0 784 25" anchor="left top" visible="true" style="font:Gulim,9,bold;" enable="false"/>
        <Grid id="Grid00" taborder="17" useinputpanel="false" position="absolute 66 560 497 619" binddataset="ds_close" visible="false">
          <Formats>
            <Format id="default">
              <Columns>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
              </Columns>
              <Rows>
                <Row band="head" size="24"/>
                <Row band="body" size="24"/>
              </Rows>
              <Band id="head">
                <Cell col="0" disptype="normal" text="upjangCd"/>
                <Cell col="1" disptype="normal" text="occurDate"/>
                <Cell col="2" disptype="normal" text="sysClass"/>
                <Cell col="3" disptype="normal" text="closeYn"/>
                <Cell col="4" disptype="normal" text="rowStatus"/>
              </Band>
              <Band id="body">
                <Cell col="0" disptype="normal" text="bind:upjangCd"/>
                <Cell col="1" disptype="normal" text="bind:occurDate"/>
                <Cell col="2" disptype="normal" text="bind:sysClass"/>
                <Cell col="3" disptype="normal" text="bind:closeYn"/>
                <Cell col="4" disptype="normal" text="bind:rowStatus"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Combo id="cbo_sysClass" taborder="4" class="cmb_WF_Essential" position="absolute 83 66 293 87" anchor="left top" value="null" index="-1" onitemchanged="cbo_sysClass_onitemchanged" innerdataset="@ds_sysClass" codecolumn="code" datacolumn="codeName" displaynulltext="선택"/>
        <Static id="Static12" text="구분" class="sta_WFSA_label" position="absolute 15 66 76 87" anchor="left top" style="align:left middle;"/>
        <Static id="Static13" text="H10" visible="false" position="absolute 0 87 1205 97" style="background:#ff000055;align:center middle;"/>
        <ObjCalendar id="cal_occurDate" titletext="캘린더" taborder="5" scrollbars="none" class="cal_WF_Essential" position="absolute 395 66 490 87"/>
        <Edit id="edt_tmCd" taborder="31" readonly="true" onkeydown="edt_tmNm_onkeydown" visible="false" position="absolute 407 725 617 746" anchor="left top right" tmCd=""/>
        <Edit id="edt_ccCd" taborder="32" readonly="true" autoselect="true" visible="false" position="absolute 717 725 927 746"/>
        <Edit id="edt_upjang" taborder="33" readonly="true" onkeydown="edt_upjangnm_onkeydown" visible="false" position="absolute 1027 725 1233 746" anchor="left top right" tmCd=""/>
        <Grid id="Grid01" taborder="34" binddataset="gds_SmSearch" useinputpanel="false" autofittype="col" visible="false" position="absolute 16 747 1208 800">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="90"/>
                <Column size="90"/>
                <Column size="200"/>
                <Column size="90"/>
                <Column size="200"/>
                <Column size="90"/>
                <Column size="200"/>
                <Column size="90"/>
                <Column size="200"/>
              </Columns>
              <Rows>
                <Row size="24" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell text="empNum"/>
                <Cell col="1" text="muCd"/>
                <Cell col="2" text="muNm"/>
                <Cell col="3" text="tmCd"/>
                <Cell col="4" text="tmNm"/>
                <Cell col="5" text="ccCd"/>
                <Cell col="6" text="ccNm"/>
                <Cell col="7" text="upjang"/>
                <Cell col="8" text="upjangnm"/>
              </Band>
              <Band id="body">
                <Cell text="bind:empNum"/>
                <Cell col="1" text="bind:muCd"/>
                <Cell col="2" text="bind:muNm"/>
                <Cell col="3" text="bind:tmCd"/>
                <Cell col="4" text="bind:tmNm"/>
                <Cell col="5" text="bind:ccCd"/>
                <Cell col="6" text="bind:ccNm"/>
                <Cell col="7" text="bind:upjang"/>
                <Cell col="8" text="bind:upjangnm"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Static id="Static19" text="선수금 발생" class="sta_WF_Title01" position="absolute 562 531 1012 549" anchor="left top"/>
        <Static id="Static20" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 562 518 1236 531" anchor="left top"/>
        <Static id="Static21" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 562 544 1236 549" anchor="left top"/>
        <Grid id="grd_advanceOccur" taborder="35" binddataset="ds_advanceOccurList" autoenter="select" useinputpanel="false" cellsizingtype="col" autofittype="col" treeusecheckbox="false" treeuseimage="false" treeinitstatus="expand,all" position="absolute 562 549 1236 710" anchor="all">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="220"/>
                <Column size="80"/>
                <Column size="110"/>
              </Columns>
              <Rows>
                <Row size="24" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell text="지불유형"/>
                <Cell col="1" text="건수"/>
                <Cell col="2" text="금액"/>
              </Band>
              <Band id="body">
                <Cell displaytype="tree" edittype="tree" style="align:left;" text="bind:settleClass" editautoselect="true" suppress="0" treelevel="bind:lvl"/>
                <Cell col="1" displaytype="number" text="bind:cnt"/>
                <Cell col="2" displaytype="number" text="bind:amt"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Static id="Static00" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1 40 16 61" anchor="left top"/>
        <Static id="Static55" text="사업부" class="sta_WFSA_label" position="absolute 16 40 76 60" style="background:URL('theme://images/new/sta_WFSA_label.png') left middle;align:left middle;"/>
        <Static id="Static46" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 293 40 323 61" anchor="left top"/>
        <Static id="Static07" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 605 40 635 61" anchor="left top"/>
        <Static id="Static01" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 878 40 908 61" anchor="left top"/>
        <Static id="Static11" text="업장" class="sta_WFSA_label" position="absolute 635 40 705 60" style="background:URL('theme://images/new/sta_WFSA_label.png') left middle;align:left middle;"/>
        <TmSearchComponent id="TmSearchComponent01" titletext="팀 검색용 Component" taborder="36" text="TmSearchComponent00" position="absolute 395 40 605 61" bindDataset="ds_search" bindTmCdColumn="tmCd" bindTmNmColumn="tmNm" qoBuCd="" qoMuCd="" qoUseYn="" eventAfterTrigger="fn_tmChanged" eventBeforeTrigger="fn_tmBeforeEvent" isTeamControl="Y" class="edt_WF_Essential"/>
        <MuSearchComponent id="MuSearchComponent01" titletext="사업부 선택 Component" taborder="38" text="MuSearchComponent00" class="cmb_WF_Essential" position="absolute 83 40 293 61" bindDataset="ds_search" bindMuCdColumn="muCd" appendText="선택" onItemChangedEvent="fn_muChanged"/>
        <Static id="Static02" text="부서" class="sta_WFSA_label" position="absolute 323 39 375 60" anchor="left top"/>
        <UpjangSearchComponent id="UpjangSearchComponent00" titletext="업장 검색용 Component" taborder="39" text="UpjangSearchComponent00" position="absolute 705 40 915 61" bindDataset="ds_search" bindUpjangCodeColumn="upjangCd" bindUpjangNameColumn="upjangNm" eventBeforeTrigger="fn_upjangBeforeEvent" eventAfterTrigger="fn_upjangAfterEvent" roleSetId="StUpjang" class="edt_WF_Essential"/>
        <Button id="btn_detailPop" taborder="40" text="상세보기" onclick="btn_detailPop_onclick" class="btn_WF_CRUD" enable="true" position="absolute 1171 103 1236 123" anchor="top right" style="font:Gulim,9,bold;"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_cmnAuth" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="srcYn" type="STRING" size="256"/>
          <Column id="insYn" type="STRING" size="256"/>
          <Column id="delYn" type="STRING" size="256"/>
          <Column id="savYn" type="STRING" size="256"/>
          <Column id="prtYn" type="STRING" size="256"/>
          <Column id="exlYn" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="srcYn">1</Col>
            <Col id="insYn">0</Col>
            <Col id="delYn">0</Col>
            <Col id="savYn">0</Col>
            <Col id="prtYn">0</Col>
            <Col id="exlYn">0</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_search" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="muCd" type="STRING" size="256"/>
          <Column id="tmCd" type="STRING" size="256"/>
          <Column id="tmNm" type="STRING" size="256"/>
          <Column id="ccCd" type="STRING" size="256"/>
          <Column id="ccNm" type="STRING" size="256"/>
          <Column id="upjangCd" type="STRING" size="256"/>
          <Column id="upjangNm" type="STRING" size="256"/>
          <Column id="occurDate" type="STRING" size="256"/>
          <Column id="sysClass" type="STRING" size="256"/>
          <Column id="closeYn" type="STRING" size="256"/>
          <Column id="rowStatus" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_salsList" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" canrowposchange="ds_list_canrowposchanged" oncolumnchanged="ds_list_oncolumnchanged" onrowposchanged="ds_list_onrowposchanged">
        <ColumnInfo>
          <Column id="lvl" type="INT" size="256"/>
          <Column id="internalUseClass" type="STRING" size="256"/>
          <Column id="occurDate" type="STRING" size="256"/>
          <Column id="sysClass" type="STRING" size="256"/>
          <Column id="muCd" type="STRING" size="256"/>
          <Column id="ccCd" type="STRING" size="256"/>
          <Column id="upjangCd" type="STRING" size="256"/>
          <Column id="salsClass" type="STRING" size="256"/>
          <Column id="vatClass" type="STRING" size="256"/>
          <Column id="ddddCloseYn" type="STRING" size="256"/>
          <Column id="salQuantity" type="STRING" size="256"/>
          <Column id="uprice" type="BIGDECIMAL" size="256"/>
          <Column id="netAmt" type="BIGDECIMAL" size="256"/>
          <Column id="svcAmt" type="BIGDECIMAL" size="256"/>
          <Column id="vatAmt" type="BIGDECIMAL" size="256"/>
          <Column id="salAmt" type="BIGDECIMAL" size="256"/>
          <Column id="salsClassNm" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_paymentList" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" canrowposchange="ds_list_canrowposchanged" oncolumnchanged="ds_list_oncolumnchanged" onrowposchanged="ds_list_onrowposchanged">
        <ColumnInfo>
          <Column id="lvl" type="INT" size="256"/>
          <Column id="occurDate" type="STRING" size="256"/>
          <Column id="sysClass" type="STRING" size="256"/>
          <Column id="muCd" type="STRING" size="256"/>
          <Column id="ccCd" type="STRING" size="256"/>
          <Column id="upjangCd" type="STRING" size="256"/>
          <Column id="upjangNm" type="STRING" size="256"/>
          <Column id="ddddCloseYn" type="STRING" size="256"/>
          <Column id="payCd" type="STRING" size="256"/>
          <Column id="payCdNm" type="STRING" size="256"/>
          <Column id="payTypeCd" type="STRING" size="256"/>
          <Column id="payTypeNm" type="STRING" size="256"/>
          <Column id="cnt" type="BIGDECIMAL" size="256"/>
          <Column id="amt" type="BIGDECIMAL" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_close" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="upjangCd" type="STRING" size="256"/>
          <Column id="occurDate" type="STRING" size="256"/>
          <Column id="sysClass" type="STRING" size="256"/>
          <Column id="closeYn" type="STRING" size="256"/>
          <Column id="rowStatus" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_muCd" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="muCd" type="STRING" size="256"/>
          <Column id="muNm" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_sysClass" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="code" type="STRING" size="256"/>
          <Column id="codeName" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_advanceOccurList" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="lvl" type="INT" size="256"/>
          <Column id="settleClass" type="STRING" size="256"/>
          <Column id="cnt" type="INT" size="256"/>
          <Column id="amt" type="BIGDECIMAL" size="256"/>
          <Column id="ddddCloseYn" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_searchValid" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="muCd" type="STRING" size="256"/>
          <Column id="tmCd" type="STRING" size="256"/>
          <Column id="upjangCd" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="muCd">title:사업부,required:true</Col>
            <Col id="tmCd">title:팀,required:true</Col>
            <Col id="upjangCd">title:업장,required:true</Col>
          </Row>
        </Rows>
      </Dataset>
    </Objects>
    <Bind>
      <BindItem id="item9" compid="cbo_sysClass" propid="value" datasetid="ds_search" columnid="sysClass"/>
      <BindItem id="item1" compid="cal_occurDate" propid="text" datasetid="ds_search" columnid="occurDate"/>
      <BindItem id="item3" compid="edt_tmCd" propid="value" datasetid="ds_search" columnid="tmCd"/>
      <BindItem id="item5" compid="edt_ccCd" propid="value" datasetid="ds_search" columnid="ccCd"/>
      <BindItem id="item7" compid="edt_upjang" propid="value" datasetid="ds_search" columnid="upjangCd"/>
    </Bind>
    <InitValue/>
    <Script type="xscript4.0"><![CDATA[/*
  화 면 명 : CloseMgnt01
  파 일 명 : CloseMgnt01.xfdl
  기    능 : 일마감

    수정일    수정자                  수정내용
  ----------   -------  --------------------------------------------------
  2015.05.26   JUN   최초 생성
*/

/************************************************************************************************
 * 공통 라이브러리 INCLUDE 영역 (필수)
************************************************************************************************/
include "lib::lib_com.xjs";
include "lib::SMCommon.xjs";	//영업회계 공통 스크립트
include "U_lib::lib_conversionCom.xjs"; // AS-IS용

/************************************************************************************************
 * FORM 변수 선언 영역 (필수)
************************************************************************************************/
var fv_sToday = gfn_today();
var fv_objColInfo1;	//매출데이터셋 컬럼정보
var fv_objColInfo2; //지불데이터셋 컬럼정보
var v_ds_check	= "";
var gOccrDate	= "";
var gSysClass	= "";
var gUpjangCd	= "";
var fv_retVal	= "";
var closeGubun;
var gvReturnDate = "";

/************************************************************************************************
 * FORM EVENT 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : Form Load (필수)
 *---------------------------------------------------------------------------------------------*/
function form_onload(obj:Form, e:LoadEventInfo){

	// Form Load 시 공통 기능 처리(obj:Form, bCreateEvent:이벤트 생성 여부)
	gfn_formOnLoad(this);
	fsp_init(this);
	// 초기값 셋팅
	fn_init();
	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 초기값 셋팅
 *---------------------------------------------------------------------------------------------*/
function fn_init(){
	// 업데이트여부를 체크할 DataSet, 여러개 있을 경우 ;로 구분
	v_ds_check = "ds_salsList;ds_paymentList";

	TmSearchComponent01.applyAuthLevel(MuSearchComponent01);
	UpjangSearchComponent00.applyAuthLevel(TmSearchComponent01);

	//콤보조회
	fn_setCombo();
	
	//조회조건을 초기화한다.
	fn_clearSearch();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 화면 닫기 전 변경 유무 체크 (필수-Frame에서 창 닫힐때 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_close(){	
	// v_ds_check 사용시 변경사항 체크
	if(gfn_length(v_ds_check) != 0){	
	
		// v_ds_check 설정기준 변경사항 체크
		if(gfn_isDataChange() == true){
			if(!gfn_confirm("confirm.before.movepage")) return false;	// 변경된 데이터가 있습니다. 현재 화면을 닫겠습니까?
		}
	}
	return true;
}

/************************************************************************************************
 * 공통기능 FUNCTION 영역 (필수-공통버튼)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 조회 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 * gfn_transaction(
 * 		@param objForm         - Form Object(this)
 * 		@param strSvcID        - 트랜잭션을 구분하기 위한 ID
 * 		@param strURL          - 트랜잭션을 요청할 주소
 * 		@param strInDatasets   - 트랜잭션을 요청할 때 입력값으로 보낼 데이터셋의 ID
 * 		@param strOutDatasets  - 트랜잭션을 처리 결과를 받을 데이터셋의 ID
 * 		@param strArgument     - 트랜잭션을 위한 인자값
 * 		@param strCallbackFunc - 트랜잭션의 결과를 돌려줄 함수의 이름
 * 		@param bAsync          - 비동기 여부(true: Async, false : Sync)
 * 		@param bProgress       - Wait Cursor 표시여부 (true : 사용, false : 사용안함)
 * )
 *---------------------------------------------------------------------------------------------*/
function fn_search(){

	// 조회시 Validation Check
	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;
	// 조회시 Validation Check
	if(!fn_validCheck()) return;
	
	//마감처리/취소 조회시 프로시져 입력 파라미터 세팅
	fn_setSearchInfo();
	
    // Grid sort 표시 초기화(필수)
    gfn_clearSortMark(grd_salsList);

	//서비스 쿼리결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장
	fv_objColInfo1 = gfn_getDatasetInfo (ds_salsList);

    gfn_transaction(this
					,"search"
					,"rc/rcm/closeMgnt01/salsList.xdo"
					,"ds_search=ds_search:A"
					,"ds_salsList=ds_salsList ds_advanceOccurList=ds_advanceOccurList"
					,""
					,"fn_callBack"
					,true);
}

function fn_searchDtl(){

    // Grid sort 표시 초기화(필수)
    gfn_clearSortMark(grd_paymentList);

	//서비스 쿼리결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장
	fv_objColInfo2 = gfn_getDatasetInfo (ds_paymentList);

    gfn_transaction(this
					,"searchDtl"
					,"rc/rcm/closeMgnt01/paymentList.xdo"
					,"ds_search=ds_search:A"
					,"ds_paymentList=ds_paymentList"
					,""
					,"fn_callBack"
					,true);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 신규 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_insert(){
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 삭제 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_delete(){
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 저장 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_save(){
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 출력 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_print(){
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 도움말 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_help(){
}

/************************************************************************************************
 * TRANSACTION 및 CallBack 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 트랜잭션 콜백 함수 (필수)
 *---------------------------------------------------------------------------------------------*/
function fn_callBack(strSvcID, nErrorCode, strErrorMsg){
	// 에러시 gfn_callBack에서 메시지 제공, 화면별 특정 에러 발생시에만 사용하세요.
	if (nErrorCode < 0){
		return;
	}
	
    switch(strSvcID){

   		// 사업부Combo 조회
        case "searchMuCd" :
			fn_setSmSearchDataset("MU", false);
            break;    
            
        //매출조회
        case "search" :
			if(ds_salsList.getRowCount() == 0 && ds_advanceOccurList.getRowCount() == 0){ //서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
				gfn_loadDatasetInfo (ds_salsList, fv_objColInfo1);
				ds_paymentList.clearData();
				edt_differAmt.value = 0;
				btn_receive.enable	= false;
				btn_cancel.enable	= false;

			}else{
				btn_receive.enable	= true;
				btn_cancel.enable	= false;
				fn_searchDtl();
			}
            break;
            
        //지불조회
        case "searchDtl" :
			if(ds_paymentList.getRowCount() == 0){ //서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
				gfn_loadDatasetInfo (ds_paymentList, fv_objColInfo2);
			}
			//마감여부 & 매출 - 지불 차이 계산
			fn_setDifferAmt();
			ds_close.clearData();
            break;
            
        //마감처리
        case "closeProc" :
			
			var arrRetVal  = fv_retVal.split("|");
			
			//성공
			if(arrRetVal[0] == "TRUE"){
				gfn_alert("msg.action.close.success");	// 정상적으로 마감처리 되었습니다.
				//fn_insertMas();	// 마감 프로시져 정상처리후 사업장일마감 MAS_CLOSE_MGMT 테이블에 INSERT
				fn_saveHistory();
				fn_search();
				
			//실패
			}else{
				gfn_alert("["+arrRetVal[0]+"] "+arrRetVal[1]);
			}
            break;
            
        //마감취소
        case "closeCancel" :

			var arrRetVal  = fv_retVal.split("|");
			
			//성공
			if(arrRetVal[0] == "TRUE"){
				gfn_alert("msg.action.close.cancel");	// 정상적으로 마감취소 되었습니다.
				//fn_deleteMas(); // 마감취소 프로시져 정상처리후 사업장일마감 MAS테이블도 삭제처리
				fn_cancleHistory();
				fn_search();
				
			//실패
			}else{
				gfn_alert("["+arrRetVal[0]+"] "+arrRetVal[1]);
			}
            break;
    }
}

/************************************************************************************************
 * 사용자 FUNCTION 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 콤보/팝업조회
 *---------------------------------------------------------------------------------------------*/
function fn_setCombo(){
					
	// 조회:사업부					
	//fn_setMuCd();

	//조회:시스템구분
	//SCCombo.bind(this, "ComCode", "cbo_sysClass", null, {groupCode:"SYS_CLASS", useYn:"Y"}, SCCombo.ALL);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 조회조건 초기화
 *---------------------------------------------------------------------------------------------*/
function fn_clearSearch(){

    var nRow= ds_search.addRow();
    
    //gvReturnDate = gv_ReturnDate;
    //날짜값을 받은 경우 2016.05.11
    var arrArg = gfn_getScreenParams();
    if (gfn_isNull(arrArg)) {
		gvReturnDate = "";
    } else {
		gvReturnDate = arrArg[0];
	}
    
	//매출등록(외식)에서 날짜가 넘어온 경우 해당일자로 세팅 2016-03-24 추가
    if (gvReturnDate == "" || gfn_isNull(arrArg)) {    
		ds_search.setColumn(nRow, "occurDate",  fv_sToday);
	} else {
		ds_search.setColumn(nRow, "occurDate",  gvReturnDate);
	}
    ds_search.setColumn(nRow, "muCd",       g_Mu_Cd);
    ds_search.setColumn(nRow, "tmCd",       g_Tm_Cd);
    ds_search.setColumn(nRow, "tmNm",       g_Tm_Nm);
    //ds_search.setColumn(nRow, "ccCd",       g_Cc_Cd);
    //ds_search.setColumn(nRow, "ccNm",       g_Cc_Nm);
    ds_search.setColumn(nRow, "upjangCd",   g_Upjang);
    ds_search.setColumn(nRow, "upjangNm",   g_UpjangNm);

	//조회조건 헤더생성
	gds_SmSearch.clearData();
	gds_SmSearch.addRow();
	
	//달력 초기화
	//매출등록(외식)에서 날짜가 넘어온 경우 해당일자로 세팅 2016-03-24 추가
	if (gvReturnDate == "") {    
		cal_occurDate.fn_initMonthCal(this, fv_sToday, "fn_calendarFromCallBack", ds_search, "occurDate", "Y");   //처리일자From
	} else {
		cal_occurDate.fn_initMonthCal(this, gvReturnDate, "fn_calendarFromCallBack", ds_search, "occurDate", "Y");   //처리일자From
	}
	//사용자 버튼 위치 조정
	//role : src(조회권한), ins(입력권한), del(삭제권한), sav(저장권한), prt(출력권한), exl(엑셀권한)
	//ischange : true (공통버튼 무조건 숨김), false (공통버튼 권한에 따라 숨김)
	//SCAuth.setUserButton(this, {buttons : [{id:"btn_receive", role:"src", ischange:false},{id:"btn_cancel", role:"src", ischange:false}]});
	//SCAuth.setUserButton(this, {buttons : [{id:"btn_cancel", role:"src", ischange:false}]});
	
	gfn_setSysClassByMuCd(this, "cbo_sysClass", "ds_sysClass", MuSearchComponent01.getMuCode());
	
	ds_close.clearData();

	//미마감조회에서 이동할 경우 조회조건 세팅
	var arrArg = gfn_getScreenParams();
	if(!gfn_isNull(arrArg)) {
		ds_search.setColumn(0, "muCd",      arrArg[0]);
		ds_search.setColumn(0, "tmCd",      arrArg[1]);
		ds_search.setColumn(0, "tmNm",      arrArg[2]);
		ds_search.setColumn(0, "upjangCd",  arrArg[3]);
		ds_search.setColumn(0, "upjangNm",  arrArg[4]);
		ds_search.setColumn(0, "occurDate", arrArg[5]);
		ds_search.setColumn(0, "sysClass",  arrArg[6]);
		
		if(!gfn_isNull(cbo_sysClass.value)){
			fn_search();
		}else{
			ds_salsList.clearData();
			ds_paymentList.clearData();
			ds_advanceOccurList.clearData();
			edt_differAmt.value = 0;
		}
	}
	
	//리턴 날짜 초기화
	//gv_ReturnDate = "";
	
	SCAuth.setUserButton(this, {buttons : [{id:"btn_receive", role:"src", ischange:false},{id:"btn_cancel", role:"src", ischange:false}]});
    
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 미마감조회에서 이동할 경우 조회조건 세팅 (이미 화면이 열려 있을 경우 사용)
 *---------------------------------------------------------------------------------------------*/
function fn_getScreenParams(arrArg){
    var v_arg = arrArg;
    
    if(typeof v_arg == "undefined") return;
    
	if(!gfn_isNull(v_arg)) {
		ds_search.setColumn(0, "muCd",      arrArg[0]);
		ds_search.setColumn(0, "tmCd",      arrArg[1]);
		ds_search.setColumn(0, "tmNm",      arrArg[2]);
		ds_search.setColumn(0, "upjangCd",  arrArg[3]);
		ds_search.setColumn(0, "upjangNm",  arrArg[4]);
		ds_search.setColumn(0, "occurDate", arrArg[5]);
		ds_search.setColumn(0, "sysClass",  arrArg[6]);
		
		if(!gfn_isNull(cbo_sysClass.value)){
			fn_search();
		}else{
			ds_salsList.clearData();
			ds_paymentList.clearData();
			ds_advanceOccurList.clearData();
			edt_differAmt.value = 0;
		}
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 조회시 Validation Check
 *---------------------------------------------------------------------------------------------*/
function fn_validCheck(){
/*
	if (gfn_isNull(MuSearchComponent01.getMuCode())){
		gfn_alert("msg.noselect", "사업부");	// $1 을(를) 선택해 주십시요.
		return false;
	}

	if (gfn_isNull(TmSearchComponent01.getTmCode)){
		gfn_alert("msg.noselect", "팀");	// $1 을(를) 선택해 주십시요.
		return false;
	}
	if (gfn_isNull(edt_ccNm.value)){
		gfn_alert("msg.noselect", "CC");	// $1 을(를) 선택해 주십시요.
		edt_ccNm.setFocus();
		return false;
	}
	
	if (gfn_isNull(edt_upjangnm.value)){
		gfn_alert("msg.noselect", "업장");	// $1 을(를) 선택해 주십시요.
		edt_upjangnm.setFocus();
		return false;
	}
*/	
	if (gfn_isNull(cbo_sysClass.value)){
		gfn_alert("msg.noselect", "구분");	// $1 을(를) 선택해 주십시요.
		cbo_sysClass.setFocus();
		return false;
	}
	if (gfn_isNull(cal_occurDate.text)){
		gfn_alert("msg.noinput", "발생일자");	// $1 을(를) 입력해 주십시요.
		cal_occurDate.setFocus();
		return false;
	}
	return true;
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 마감여부 & 매출 - 지불 차이 계산
 *---------------------------------------------------------------------------------------------*/
function fn_setDifferAmt(){
	var iSalsCloseCnt	= 0;	//매출마감건수
	var iPaymCloseCnt	= 0;	//지불마감건수
	var iAdvanceCloseCnt= 0;	//선수금마감건수
	var iSalsRowCnt		= 0;	//매출총건수
	var iPaymRowCnt		= 0;	//지불총건수
	var iAdvanceRowCnt	= 0;	//선수금 발생 총건수
	var iSalsAmt		= 0;	//매출총금액
	var iPaymAmt		= 0;	//지불총금액
	var iAdvanceAmt		= 0;	//선수금 발생 총금액
	
	iSalsRowCnt	= ds_salsList.rowcount;
	iPaymRowCnt	= ds_paymentList.rowcount;
	iAdvanceRowCnt	= ds_advanceOccurList.rowcount;

	//매출마감건수 / 매출총금액
	for(var i=0; i<iSalsRowCnt; i++){
		if(ds_salsList.getColumn(i, "ddddCloseYn") == "Y") iSalsCloseCnt++;
		if(ds_salsList.getColumn(i, "lvl") == 0) iSalsAmt += parseFloat(ds_salsList.getColumn(i, "salAmt"));
	}
	
	//지불마감건수 / 지불총금액
	for(var j=0; j<iPaymRowCnt; j++){
		if(ds_paymentList.getColumn(j, "ddddCloseYn") == "Y") iPaymCloseCnt++;
		if(ds_paymentList.getColumn(j, "lvl") == 0) iPaymAmt += parseFloat(ds_paymentList.getColumn(j, "amt"));
	}

	//선수금마감건수 / 선수금 총금액
	for(var k=0; j<iAdvanceRowCnt; j++){
		if(ds_advanceOccurList.getColumn(j, "ddddCloseYn") == "Y") iAdvanceCloseCnt++;
		if(ds_advanceOccurList.getColumn(j, "lvl") == 0) iAdvanceAmt += parseFloat(ds_advanceOccurList.getColumn(j, "amt"));
	}

	//매출, 지불 데이터가 없을 경우
	if(iSalsRowCnt == 0 || iPaymRowCnt == 0){
		ds_search.setColumn(0, "closeYn", "");
		btn_receive.enable	= false;
		btn_cancel.enable	= false;

	//매출, 지불 데이터가 있을 경우
	}else{

		//마감된 데이터 -> '마감취소' 버튼 활성화
		if(iSalsCloseCnt == iSalsRowCnt && iPaymCloseCnt == iPaymRowCnt){
			ds_search.setColumn(0, "closeYn", "Y");
			btn_receive.enable	= false;
			btn_cancel.enable	= true;
			
		//마감이 안된 데이터 -> '마감처리' 버튼 활성화
		}else if(iSalsCloseCnt == 0 && iPaymCloseCnt == 0){
			ds_search.setColumn(0, "closeYn", "N");
			btn_receive.enable	= true;
			btn_cancel.enable	= false;

		//부분 마감 되었거나 데이터에 이상이 있는경우 '마감처리/취소'버튼 비활성
		}else{
			ds_search.setColumn(0, "closeYn", "");
			btn_receive.enable	= false;
			btn_cancel.enable	= false;
		}
	}

	//선수금 발생 데이터만 있을 경우
	if((iSalsRowCnt == 0 && iPaymRowCnt == 0) && iAdvanceRowCnt > 0){
	
		//선수금발생(마감)
		if(iAdvanceCloseCnt == iAdvanceRowCnt){
			ds_search.setColumn(0, "closeYn", "Y");
			btn_receive.enable	= false;
			btn_cancel.enable	= true;
			
		//선수금발생
		}else if(iAdvanceCloseCnt == 0){
			ds_search.setColumn(0, "closeYn", "N");
			btn_receive.enable	= true;
			btn_cancel.enable	= false;

		}else{
			ds_search.setColumn(0, "closeYn", "");		
			btn_receive.enable	= false;
			btn_cancel.enable	= false;
		}
	}
	edt_differAmt.value = iSalsAmt - iPaymAmt;

	//if(iSalsAmt != iPaymAmt){
	//	btn_receive.visible	= false;
	//	btn_cancel.visible	= false;
	//}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 마감처리/취소 조회시 프로시져 입력 파라미터 세팅
 *---------------------------------------------------------------------------------------------*/
function fn_setSearchInfo(){
	gOccrDate	= ds_search.getColumn(0, "occurDate");
	gSysClass	= ds_search.getColumn(0, "sysClass");
	gUpjangCd	= ds_search.getColumn(0, "upjangCd");
}

/*----------------------------------------------------------------------------------------------
 * 사업부콤보조회
 *---------------------------------------------------------------------------------------------*/
function fn_setMuCd(){
	
	//사업부 com.hwfs.sm.cmn.dao.CommonDAO.selectMuCd
    gfn_transaction(this
					,"searchMuCd"
					,"sm/cmn/common/selectMuCd.xdo"
					,""
					,"ds_muCd=ds_combo"
					,""
					,"fn_callBack"
					,true);
}

/*----------------------------------------------------------------------------------------------
 * 입력값 데이터셋 저장(BIND)
 *---------------------------------------------------------------------------------------------*/
function fn_setSmSearchDataset(arg, initYn){

	if(initYn == true){
		//사업부 변경
		if(arg == "MU"){
			edt_tmCd.value		= "";
			edt_tmNm.value		= "";
			edt_ccCd.value		= "";
			edt_ccNm.value		= "";
			edt_upjang.value	= "";
			edt_upjangnm.value	= "";

		//팀 변경	
		}else if(arg == "TM"){
			edt_ccCd.value		= "";
			edt_ccNm.value		= "";
			edt_upjang.value	= "";
			edt_upjangnm.value	= "";
			
		//CC 변경	
		}else if(arg == "CC"){
			edt_upjang.value	= "";
			edt_upjangnm.value	= "";
		}
	}
	gds_SmSearch.setColumn(0, "muCd",		cbo_muCd.value);
	gds_SmSearch.setColumn(0, "muNm",		cbo_muCd.text);
	gds_SmSearch.setColumn(0, "tmCd",		edt_tmCd.value);
	gds_SmSearch.setColumn(0, "tmNm",		edt_tmNm.value);
	gds_SmSearch.setColumn(0, "ccCd",		edt_ccCd.value);
	gds_SmSearch.setColumn(0, "ccNm",		edt_ccNm.value);
	gds_SmSearch.setColumn(0, "upjang",		edt_upjang.value);
	gds_SmSearch.setColumn(0, "upjangnm",	edt_upjangnm.value);
	gds_SmSearch.setColumn(0, "inputVal",	"");
}

/*----------------------------------------------------------------------------------------------
 * 팝업창 호출
 *---------------------------------------------------------------------------------------------*/
 function fn_openPopup(arg){
	var sUrl = "";
	
	if(arg == "TM")				sUrl = "cmn::SmTmSearchPop.xfdl";
	else if(arg == "CC")		sUrl = "cmn::SmCcSearchPop.xfdl";
	else if(arg == "UPJANG")	sUrl = "cmn::SmUpjangSearchPop.xfdl";

	if(arg == "TM"){
		gds_SmSearch.setColumn(0, "inputVal", 	gds_SmSearch.getColumn(0, "tmNm"));
	}else if(arg == "CC"){
		gds_SmSearch.setColumn(0, "inputVal", 	gds_SmSearch.getColumn(0, "ccNm"));
	}else if(arg == "UPJANG"){
		gds_SmSearch.setColumn(0, "inputVal", 	gds_SmSearch.getColumn(0, "upjangnm"));
	}
	
	// 리턴값을 배열로 받을 경우	
	var arrRtn = gfn_dialog( arg, sUrl, null, 500, 500, "", -1, -1, false, true, "-1");
	
	if (arrRtn instanceof Object){
	
		//팀
		if(arg == "TM"){
			cbo_muCd.value = arrRtn.muCd;
			edt_tmCd.value = arrRtn.tmCd;
			edt_tmNm.value = arrRtn.tmNm;

		//CC
		}else if(arg == "CC"){
			cbo_muCd.value = arrRtn.muCd;
			edt_tmCd.value = arrRtn.tmCd;
			edt_tmNm.value = arrRtn.tmNm;
			edt_ccCd.value = arrRtn.ccCd;
			edt_ccNm.value = arrRtn.ccNm;
		
		//업장
		}else if(arg == "UPJANG"){
			cbo_muCd.value		= arrRtn.muCd;
			edt_tmCd.value		= arrRtn.tmCd;
			edt_tmNm.value		= arrRtn.tmNm;
			edt_ccCd.value		= arrRtn.ccCd;
			edt_ccNm.value		= arrRtn.ccNm;
			edt_upjang.value	= arrRtn.upjang;
			edt_upjangnm.value	= arrRtn.upjangnm;
		}
		fn_setSmSearchDataset(arg, true);
	}
}

/************************************************************************************************
 * 각 COMPONENT 별 EVENT 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 사업부 변경 EVENT
 *---------------------------------------------------------------------------------------------*/
function cbo_muCd_onitemchanged(obj:Combo, e:ItemChangeEventInfo){
	fn_setSmSearchDataset("MU", true);
	gfn_setSysClassByMuCd(this, "cbo_sysClass", "ds_sysClass", MuSearchComponent01.getMuCode());
}

/*----------------------------------------------------------------------------------------------
 * 팀 팝업버튼 클릭 EVENT
 *---------------------------------------------------------------------------------------------*/
function btn_tmCd_onclick(obj:Button,  e:ClickEventInfo){
	fn_openPopup("TM");
}

/*----------------------------------------------------------------------------------------------
 * 팀 keydown EVENT
 *---------------------------------------------------------------------------------------------*/
function edt_tmNm_onkeydown(obj:Edit, e:KeyEventInfo){
	if(e.keycode == 13){		//Enter 키
		btn_tmCd_onclick();
		//if(!gfn_isNull(edt_tmNm.value)) parent.fn_search();
	}else if(e.keycode == 46){	//Del 키
		fn_setSmSearchDataset("MU", true);
	}
}

/*----------------------------------------------------------------------------------------------
 * 팀 변경 EVENT
 *---------------------------------------------------------------------------------------------*/
function edt_tmNm_ontextchanged(obj:Edit,  e:TextChangedEventInfo){
	fn_setSmSearchDataset("TM", true);
}

/*----------------------------------------------------------------------------------------------
 * CC 팝업버튼 클릭 EVENT
 *---------------------------------------------------------------------------------------------*/
function btn_ccCd_onclick(obj:Button,  e:ClickEventInfo){
	fn_openPopup("CC");
}

/*----------------------------------------------------------------------------------------------
 * CC keydown EVENT
 *---------------------------------------------------------------------------------------------*/
function edt_ccNm_onkeydown(obj:Edit, e:KeyEventInfo){
	if(e.keycode == 13){		//Enter 키
		btn_ccCd_onclick();
		//if(!gfn_isNull(edt_ccNm.value)) parent.fn_search();
	}else if(e.keycode == 46){	//Del 키
		fn_setSmSearchDataset("TM", true);
	}
}

/*----------------------------------------------------------------------------------------------
 * CC 변경 EVENT
 *---------------------------------------------------------------------------------------------*/
function edt_ccNm_ontextchanged(obj:Edit,  e:TextChangedEventInfo){
	fn_setSmSearchDataset("CC", true);
}

/*----------------------------------------------------------------------------------------------
 * 업장 팝업버튼 클릭 EVENT
 *---------------------------------------------------------------------------------------------*/
function btn_upjangCd_onclick(obj:Button,  e:ClickEventInfo){
	fn_openPopup("UPJANG");
}

/*----------------------------------------------------------------------------------------------
 * 업장 keydown EVENT
 *---------------------------------------------------------------------------------------------*/
function edt_upjangnm_onkeydown(obj:Edit, e:KeyEventInfo){
	if(e.keycode == 13){		//Enter 키
		btn_upjangCd_onclick();
		//if(!gfn_isNull(edt_upjangnm.value)) parent.fn_search();
	}else if(e.keycode == 46){	//Del 키
		fn_setSmSearchDataset("CC", true);
	}
}

/*----------------------------------------------------------------------------------------------
 * 업장 변경 EVENT
 *---------------------------------------------------------------------------------------------*/
function edt_upjangnm_ontextchanged(obj:Edit,  e:TextChangedEventInfo){
	fn_setSmSearchDataset("UPJANG", true);
}

/*----------------------------------------------------------------------------------------------
 * 발생일자 From 변경 EVENT
 *---------------------------------------------------------------------------------------------*/
function cal_occurDate_onchanged(obj:Calendar, e:ChangeEventInfo){
//	fn_search();
}

/*----------------------------------------------------------------------------------------------
 * 구분 변경 EVENT
 *---------------------------------------------------------------------------------------------*/
function cbo_sysClass_onitemchanged(obj:Combo, e:ItemChangeEventInfo){
	//if(!gfn_isNull(cbo_sysClass.value)) fn_search();
	fn_datasetAllClear();
}

/*----------------------------------------------------------------------------------------------
 * 마감처리 Click EVENT
 *---------------------------------------------------------------------------------------------*/
function btn_receive_onclick(obj:Button,  e:ClickEventInfo){

	if(ds_salsList.rowcount == 0 && ds_paymentList.rowcount == 0 && ds_advanceOccurList.rowcount == 0) return;

	//테스트
	//gfn_saveCloseProc(this, "closeProc", "ds_search");
	//return;
	
	// 마감처리시 사업부, 팀, 업장 필수 체크
	if(gfn_isNull(MuSearchComponent01.getMuCode())){
		gfn_alert("사업부는 필수 입력사항 입니다.");
		return;
	 }else if(gfn_isNull(TmSearchComponent01.getTmCode())){
		gfn_alert("팀은 필수 입력사항 입니다.");
		return;
	 }else if(gfn_isNull(UpjangSearchComponent00.getUpjangCode() )){
		gfn_alert("사업장은 필수 입력사항 입니다.");
		return;
	}
	
	if(parseFloat(edt_differAmt.value) == 0){
		if(gfn_isNull(gOccrDate) || gfn_isNull(gSysClass)){
			gfn_alert("마감처리 할 수 없습니다. 조회조건을 확인하세요.");
			return;
		}else{
			if(gfn_isNull(gUpjangCd)) {gUpjangCd = "";}
			
			ds_close.clearData();
			ds_close.addRow();
			ds_close.setColumn(0, "occurDate",	gOccrDate);
			ds_close.setColumn(0, "sysClass", 	gSysClass);
			ds_close.setColumn(0, "upjangCd",	gUpjangCd);
			ds_close.setColumn(0, "closeYn",	"N");		//마감유무
			
			if(gfn_confirm("마감처리 하시겠습니까?")){
				gfn_saveCloseProc(this, "closeProc", "ds_close");
			}
		}
	}else{
		gfn_alert("매출금액과 지불금액의 차액[ "+gfn_numFormat(parseFloat(edt_differAmt.value),1000)+" ]이 발생합니다.\n\n마감처리 할 수 없습니다.");
		return;
	}
}

/*----------------------------------------------------------------------------------------------
 * 마감취소 Click EVENT
 *---------------------------------------------------------------------------------------------*/
function btn_cancel_onclick(obj:Button,  e:ClickEventInfo){

	if(ds_salsList.rowcount == 0 && ds_paymentList.rowcount == 0 && ds_advanceOccurList.rowcount == 0) return;
	
	// 마감취소시 사업부, 팀, 업장 필수 체크
	if(gfn_isNull(MuSearchComponent01.getMuCode())){
		gfn_alert("사업부는 필수 입력사항 입니다.");
		return;
	 }else if(gfn_isNull(TmSearchComponent01.getTmCode())){
		gfn_alert("팀은 필수 입력사항 입니다.");
		return;
	 }else if(gfn_isNull(UpjangSearchComponent00.getUpjangCode() )){
		gfn_alert("사업장은 필수 입력사항 입니다.");
		return;
	}

	if(gfn_isNull(gOccrDate) || gfn_isNull(gSysClass)){
		gfn_alert("마감취소 할 수 없습니다.");
		return;
	}else{
		if(gfn_isNull(gUpjangCd)) {gUpjangCd = "";}
		
		ds_close.clearData();
		ds_close.addRow();
		ds_close.setColumn(0, "occurDate",	gOccrDate);
		ds_close.setColumn(0, "sysClass", 	gSysClass);
		ds_close.setColumn(0, "upjangCd",	gUpjangCd);
		ds_close.setColumn(0, "closeYn",	"Y");		//마감유무

		if(gfn_confirm("마감취소 하시겠습니까?")){
			gfn_saveCloseProc(this, "closeCancel", "ds_close");
		}
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 팀(부서)의 팝업을 호출하기 전에 발생되는 이벤트
 *---------------------------------------------------------------------------------------------*/
function fn_tmBeforeEvent(obj)
{
	obj.qoMuCd = MuSearchComponent01.getMuCode();	//cbo_mu.value;
	obj.qoUseYn = "Y";
	
	return true;
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 업장의 팝업을 호출하기 전에 발생되는 이벤트
 *---------------------------------------------------------------------------------------------*/
function fn_upjangBeforeEvent(obj, cls)
{
	cls.setTmCd(TmSearchComponent01.getTmCode());	//cls.setTmCd(edt_tm.getTmCode());
	
	return true;
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 사업부 변경시 부서, CC 초기화 이벤트
 *---------------------------------------------------------------------------------------------*/
function fn_muChanged(){
    ds_search.setColumn(0, "tmCd",  "");
    ds_search.setColumn(0, "tmNm",  "");
    ds_search.setColumn(0, "upjangCd",  "");
    ds_search.setColumn(0, "upjangNm",  "");
	gfn_setSysClassByMuCd(this, "cbo_sysClass", "ds_sysClass", MuSearchComponent01.getMuCode());
	fn_datasetAllClear();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 상세보기
 *---------------------------------------------------------------------------------------------*/
function btn_detailPop_onclick(obj:Button,  e:ClickEventInfo){
	if(ds_salsList.rowcount > 0 && ds_paymentList.rowcount > 0){
		var arrArg = new Array();
		arrArg[0] = ds_search.getColumn(0, "occurDate");
		arrArg[1] = ds_search.getColumn(0, "sysClass");
		arrArg[2] = ds_search.getColumn(0, "muCd");
		arrArg[3] = ds_search.getColumn(0, "tmCd");
		arrArg[4] = ds_search.getColumn(0, "upjangCd");
		
		gfn_dialog(	"CloseMgntDtlPop"
					,"X_RCM::CloseMgntDtlPop2.xfdl"
					,{arrSchVal:arrArg}	//objArgumentList
					,-1		//Width
					,-1		//Height
					,""		//Style
					,-1		//Left
					,-1		//Top
					,false	//Modeless
					,true	//ShowTitle
					,"-1"	//Align
					,true);	//Resizable
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 부서 변경시 업장 초기화 이벤트
 *---------------------------------------------------------------------------------------------*/
function fn_tmChanged(){
    ds_search.setColumn(0, "upjangCd",  "");
    ds_search.setColumn(0, "upjangNm",  "");
    fn_datasetAllClear();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 업장 변경시 업장 초기화 이벤트
 * 2015.10.16 박준석 추가
 *---------------------------------------------------------------------------------------------*/
function fn_upjangAfterEvent(){
    fn_datasetAllClear();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 마감취소 프로시져 정상처리후 사업장일마감 MAS_CLOSE_MGMT 테이블 삭제
 *---------------------------------------------------------------------------------------------*/
function fn_deleteMas(){
	//var closeGubun;
	if(MuSearchComponent01.getMuCode() != "2002" && MuSearchComponent01.getMuCode() != "2003") return;
	fsp_clear(this);
	if(MuSearchComponent01.getMuCode() == "2002"){
		if(cbo_sysClass.value == "11"){ // 급식
			closeGubun = "001";
		}else if(cbo_sysClass.value == "16"){ // 장례식
			closeGubun = "006";		
		}else if(cbo_sysClass.value == "17"){ // 특판
			closeGubun = "009";		
		}else if(cbo_sysClass.value == "19"){ // 기타매출(폐식용유)
			closeGubun = "008";
		}
	}else if(MuSearchComponent01.getMuCode() == "2003"){
		if(cbo_sysClass.value == "12"){
			closeGubun = "012"
		}else{
			return;
		}
	}
	
	fsp_addSingle(this, "ma/mag:MAG10120E_D001");
	http.Sync = true;
	fsp_callService(this, 
				"", 
				"", 
				"", 
				"",  
				" UPJANG=" + UpjangSearchComponent00.getUpjangCode()  + 
				" CLOSE_GUBUN=" +  closeGubun  + 
				" CLOSE_DATEFR=" +  cal_occurDate.fn_getValue()  + 
				" CLOSE_DATETO=" +  cal_occurDate.fn_getValue()  + 
				" CLOSE_YN=" +   "Y" , 
				"");
http.Sync = false;				
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 마감 프로시져 정상처리후 사업장일마감 MAS_CLOSE_MGMT 테이블 INSERT
 *---------------------------------------------------------------------------------------------*/
function fn_insertMas(){
	//var closeGubun;
	
	if(MuSearchComponent01.getMuCode() != "2002" && MuSearchComponent01.getMuCode() != "2003") return;
	fsp_clear(this);
	if(MuSearchComponent01.getMuCode() == "2002"){
		if(cbo_sysClass.value == "11"){ // 급식
			closeGubun = "001";
		}else if(cbo_sysClass.value == "16"){ // 장례식
			closeGubun = "006";		
		}else if(cbo_sysClass.value == "17"){ // 특판
			closeGubun = "009";		
		}else if(cbo_sysClass.value == "19"){ // 기타매출(폐식용유)
			closeGubun = "008";
		}
	}else if(MuSearchComponent01.getMuCode() == "2003"){
		if(cbo_sysClass.value == "12"){
			closeGubun = "012"
		 }else{
			return;
		 }
	}
	
	fsp_addSingle(this, "ma/mag:MAG10120E_D001");
	fsp_addSingle(this, "ma/mag:MAG10120E_I001");
	http.Sync = true;
	fsp_callService(this, 
				"", 
				"", 
				"", 
				"",  
				" UPJANG=" + UpjangSearchComponent00.getUpjangCode()  + 
				" CLOSE_GUBUN=" +  closeGubun  + 
				" CLOSE_DATEFR=" +  cal_occurDate.fn_getValue()  + 
				" CLOSE_DATETO=" +  cal_occurDate.fn_getValue()  + 
				" CLOSE_YN=" +   "Y" , 
				"");
http.Sync = false;
}

function fn_calendarFromCallBack()
{
	fn_search();
}

/*--------------------------------------------------------------
 * 설명 : 데이터셋 클리어
 * 2015.10.16 박준석 추가
 *------------------------------------------------------------*/
function fn_datasetAllClear(){
	ds_salsList.clearData();
	ds_advanceOccurList.clearData();
	ds_paymentList.clearData();
}

//===============================================================
// 설명 : 마감시 이력생성 2015.10.19 추가
//===============================================================
function fn_saveHistory(){

if(MuSearchComponent01.getMuCode() != "2002" && MuSearchComponent01.getMuCode() != "2003") return;
	fsp_clear(this);
	if(MuSearchComponent01.getMuCode() == "2002"){
		if(cbo_sysClass.value == "11"){ // 급식
			closeGubun = "001";
		}else if(cbo_sysClass.value == "16"){ // 장례식
			closeGubun = "006";		
		}else if(cbo_sysClass.value == "17"){ // 특판
			closeGubun = "009";		
		}else if(cbo_sysClass.value == "19"){ // 기타매출(폐식용유)
			closeGubun = "008";
		}
	}else if(MuSearchComponent01.getMuCode() == "2003"){
		if(cbo_sysClass.value == "12"){
			closeGubun = "012"
		 }else{
			return;
		 }
	}
	
	// 히스토리 저장
	fsp_addSingle(this, "ma/mag:MAG10120E_I004");
	http.Sync = true;
	fsp_callService(this, 
								"", 
								"", 
								"", 
								"",  
								" UPJANG=" + UpjangSearchComponent00.getUpjangCode() + 
								" CLOSE_GUBUN=" +  closeGubun  + 
								" CLOSE_DATEFR=" +  cal_occurDate.fn_getValue()  + 
								" CLOSE_DATETO=" +  cal_occurDate.fn_getValue()  + 
								" CLOSE_YN=" +   "Y" , 
								"fn_insertMas()");
http.Sync = false;								
}

//===============================================================
// 설명 : 마감취소시 이력생성 2015.10.19 추가
//===============================================================
function fn_cancleHistory(){

if(MuSearchComponent01.getMuCode() != "2002" && MuSearchComponent01.getMuCode() != "2003") return;
	fsp_clear(this);
	if(MuSearchComponent01.getMuCode() == "2002"){
		if(cbo_sysClass.value == "11"){ // 급식
			closeGubun = "001";
		}else if(cbo_sysClass.value == "16"){ // 장례식
			closeGubun = "006";		
		}else if(cbo_sysClass.value == "17"){ // 특판
			closeGubun = "009";		
		}else if(cbo_sysClass.value == "19"){ // 기타매출(폐식용유)
			closeGubun = "008";
		}
	}else	if(MuSearchComponent01.getMuCode() == "2003"){
		if(cbo_sysClass.value == "12"){
			closeGubun = "012"
		 }else{
			return;
		 }
	}

	// 히스토리 저장
	fsp_addSingle(this, "ma/mag:MAG10120E_I004");
	http.Sync = true;
	fsp_callService(this, 
								"", 
								"", 
								"", 
								"",  
								" UPJANG=" + UpjangSearchComponent00.getUpjangCode() + 
								" CLOSE_GUBUN=" +  closeGubun + 
								" CLOSE_DATEFR=" +  cal_occurDate.fn_getValue()   + 
								" CLOSE_DATETO=" + cal_occurDate.fn_getValue()   + 
								" CLOSE_YN=" +   "N" , 
								"fn_deleteMas()");
http.Sync = false;
}]]></Script>
  </Form>
</FDL>
