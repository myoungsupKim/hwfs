<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="..\..\..\default_typedef.xml"/>
  <Form id="form" classname="COMP_GUIDE_13" inheritanceid="" position="absolute 0 0 1252 725" titletext="권한변경 신청" scrollbars="autoboth" onload="form_onload">
    <Layouts>
      <Layout>
        <Static id="Static08" class="sta_WFSA_Labelbg" position="absolute 0 30 1237 71" anchor="left top right"/>
        <Grid id="grd_list" taborder="0" autoenter="select" useinputpanel="false" cellsizingtype="col" position="absolute 0 102 832 710" anchor="all" binddataset="ds_list" autofittype="none">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="64"/>
                <Column size="70"/>
                <Column size="73"/>
                <Column size="55"/>
                <Column size="55"/>
                <Column size="55"/>
                <Column size="55"/>
                <Column size="55"/>
                <Column size="55"/>
                <Column size="55"/>
                <Column size="67"/>
                <Column size="104"/>
                <Column size="159"/>
                <Column size="173"/>
                <Column size="70"/>
                <Column size="65"/>
                <Column size="71"/>
                <Column size="112"/>
              </Columns>
              <Rows>
                <Row size="24" band="head"/>
                <Row size="24" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell rowspan="2" text="상태" taborder="undefined"/>
                <Cell col="1" colspan="2" text="요청사항" taborder="undefined"/>
                <Cell col="3" colspan="7" text="요청시스템" taborder="undefined"/>
                <Cell col="10" colspan="4" text="요청자정보" taborder="undefined"/>
                <Cell col="14" colspan="4" text="결재자정보" taborder="undefined"/>
                <Cell row="1" col="1" text="요청일자"/>
                <Cell row="1" col="2" text="요청사유"/>
                <Cell row="1" col="3" text="통합영업"/>
                <Cell row="1" col="4" text="영업통계"/>
                <Cell row="1" col="5" text="식재도매"/>
                <Cell row="1" col="6" text="LIMS"/>
                <Cell row="1" col="7" text="FICS"/>
                <Cell row="1" col="8" text="SPOON"/>
                <Cell row="1" col="9" text="모바일"/>
                <Cell row="1" col="10" text="사번"/>
                <Cell row="1" col="11" text="성명"/>
                <Cell row="1" col="12" text="팀"/>
                <Cell row="1" col="13" text="업장(공급업체)"/>
                <Cell row="1" col="14" text="결재일자"/>
                <Cell row="1" col="15" text="사번"/>
                <Cell row="1" col="16" text="성명"/>
                <Cell row="1" col="17" text="결재정보"/>
              </Band>
              <Band id="body">
                <Cell text="bind:signProgressStatusNm"/>
                <Cell col="1" text="bind:chgReqDate" mask="@@@@-@@-@@"/>
                <Cell col="2" displaytype="text" text="bind:chgContents"/>
                <Cell col="3" text="expr:sysId1==&quot;1&quot;?&quot;신청&quot;:&quot;&quot;"/>
                <Cell col="4" text="expr:sysId2==&quot;1&quot;?&quot;신청&quot;:&quot;&quot;"/>
                <Cell col="5" text="expr:sysId3==&quot;1&quot;?&quot;신청&quot;:&quot;&quot;"/>
                <Cell col="6" text="expr:sysId4==&quot;1&quot;?&quot;신청&quot;:&quot;&quot;"/>
                <Cell col="7" text="expr:sysId5==&quot;1&quot;?&quot;신청&quot;:&quot;&quot;"/>
                <Cell col="8" text="expr:sysId6==&quot;1&quot;?&quot;신청&quot;:&quot;&quot;"/>
                <Cell col="9" text="expr:sysId7==&quot;1&quot;?&quot;신청&quot;:&quot;&quot;"/>
                <Cell col="10" text="bind:sabun"/>
                <Cell col="11" text="bind:nmKor"/>
                <Cell col="12" text="bind:tmNm"/>
                <Cell col="13" text="bind:upjangnm"/>
                <Cell col="14" text="bind:approvDate"/>
                <Cell col="15" text="bind:approvUser"/>
                <Cell col="16" text="bind:approvNm"/>
                <Cell col="17" text="bind:signRemark"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Static id="Static06" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1237 0 1252 710" anchor="top right"/>
        <Static id="Static71" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 710 1252 725" anchor="left bottom"/>
        <Div id="div_cmnBtn" anchor="left top right" taborder="1" url="cmn::CmnBtn.xfdl" text="Div00" scrollbars="none" position="absolute 0 0 1237 30"/>
        <Static id="Static22" text="권한 변경요청 목록" class="sta_WF_Title01" position="absolute 0 84 156 102" anchor="left top"/>
        <Static id="Static15" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 0 71 1237 84" anchor="left top"/>
        <Static id="Static16" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 0 97 1237 102" anchor="left top"/>
        <Static id="Static04" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 30 93 40" anchor="left top"/>
        <Static id="Static05" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 61 93 71" anchor="left top"/>
        <Static id="Static07" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 40 15 61" anchor="left top"/>
        <Static id="Static28" text="결재상태" class="sta_WFSA_label" position="absolute 328 40 397 61" anchor="left top"/>
        <Static id="Static11" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 386 42 396 63" anchor="left top"/>
        <Static id="Static17" text="요청일자" class="sta_WFSA_label" position="absolute 16 40 81 61" anchor="left top"/>
        <Static id="Static18" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 76 40 86 61" anchor="left top"/>
        <Static id="Static19" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 297 40 327 61" anchor="left top"/>
        <Combo id="cbo_signProgressStatus" taborder="1" position="absolute 396 40 491 61"/>
        <Static id="Static75" text="~" position="absolute 187 42 200 60"/>
        <ObjCalendar id="cal_startChgReqDate" titletext="캘린더" taborder="2" text="ObjCalendar00" scrollbars="none" position="absolute 86 40 186 61"/>
        <ObjCalendar id="cal_endChgReqDate" titletext="캘린더" taborder="3" text="ObjCalendar00" scrollbars="none" position="absolute 197 40 297 61"/>
        <Static id="Static21" text="w10" class="Guide01_AreaRed" visible="false" position="absolute 832 102 842 710"/>
        <Div id="Div00" taborder="18" text="Div00" position="absolute 842 82 1239 695" anchor="top right">
          <Layouts>
            <Layout>
              <Static id="Static27" class="sta_WFDA_Labelbg" position="absolute 0 190 395 442" anchor="default"/>
              <Static id="Static26" class="sta_WFDA_Labelbg" position="absolute 0 190 395 217" anchor="default"/>
              <Static id="Static20" class="sta_WFDA_Labelbg" position="absolute 0 164 395 191" anchor="default"/>
              <Static id="Static14" class="sta_WFDA_Labelbg" position="absolute 0 138 395 165" anchor="default"/>
              <Static id="Static13" class="sta_WFDA_Labelbg" position="absolute 0 112 395 139" anchor="default"/>
              <Static id="Static01" class="sta_WFDA_Labelbg" position="absolute 0 86 395 113" anchor="default"/>
              <Static id="Static10" class="sta_WFDA_Labelbg" position="absolute 0 20 395 87" anchor="default"/>
              <Static id="Static03" text="요청자" class="sta_WFDA_Label01" position="absolute 0 86 104 113" anchor="left top"/>
              <Static id="Static00" text="권한 변경요청" class="sta_WF_Title01" position="absolute 0 2 156 20" anchor="left top"/>
              <Static id="Static12" text="시스템" class="sta_WFDA_Label01" position="absolute 0 20 104 87" anchor="left top"/>
              <Static id="Static23" text="팀" class="sta_WFDA_Label01" position="absolute 0 112 104 139" anchor="left top"/>
              <Static id="Static24" text="업장" class="sta_WFDA_Label01" position="absolute 0 138 104 165" anchor="left top"/>
              <Static id="Static25" text="요청일자" class="sta_WFDA_Label01" position="absolute 0 164 104 191" anchor="left top"/>
              <Static id="Static30" text="요청사유/업무" class="sta_WFDA_Label01" position="absolute 0 190 104 217" anchor="left top"/>
              <Static id="Static44" text="전사 구매시스템 및 SAP, 회계시스템은 별도 권한신청 진행바랍니다.&#13;&#10;&#13;&#10;해당 프로그램은 통합영업시스템 권한신청만 해당됩니다.&#13;&#10;&#13;&#10;요청자가 검색되지 않으실 경우 [사원찾기]로 검색바랍니다." class="sta_WF_DiscPoint" position="absolute 3 445 372 554" anchor="default" onclick="Div00_Static44_onclick"/>
              <UserSearchComponent id="UserSearchComponent00" titletext="사용자 검색용 Component" taborder="8" text="UserSearchComponent00" position="absolute 106 89 298 110" bindDataset="ds_list" bindSabunColumn="sabun" bindNameColumn="nmKor" eventBeforeTrigger="" eventAfterTrigger="parent.fn_requestUserAfterEvent" qoUserGroup="" qoUseYn="Y" qoSosok="" qoSosokName="" isMultiChoice="false" anchor="default"/>
              <Button id="btn_searchPersonal" taborder="45" text="사원찾기" class="btn_WF_Function" visible="true" position="absolute 326 89 388 110" anchor="top right" onclick="btn_searchPersonal_onclick" enable="false" transparenthittest="false"/>
              <Edit id="edt_tmNm" taborder="9" readonly="true" position="absolute 106 115 392 136" anchor="default"/>
              <Edit id="edt_upjangnm" taborder="10" readonly="true" position="absolute 106 141 392 162" anchor="default"/>
              <ObjCalendar id="cal_chgRegDate" titletext="캘린더" taborder="11" text="ObjCalendar00" scrollbars="none" position="absolute 106 167 206 188" anchor="default"/>
              <Combo id="cbo_chgReasonCd" taborder="12" position="absolute 106 193 392 214" anchor="left top"/>
              <TextArea id="txt_remark" taborder="13" wordwrap="word" position="absolute 3 219 392 439" anchor="default" autoselect="true"/>
              <Div id="Div00" taborder="14" text="Div00" position="absolute 103 26 393 85">
                <Layouts>
                  <Layout>
                    <CheckBox id="chk_sysId1" taborder="0" text="통합영업" position="absolute 6 -4 75 16" anchor="default" falsevalue="0" truevalue="1"/>
                    <CheckBox id="chk_sysId2" taborder="1" text="영업통계" position="absolute 105 -4 174 16" anchor="default" falsevalue="0" truevalue="1"/>
                    <CheckBox id="chk_sysId3" taborder="2" text="식재도매" position="absolute 205 -4 274 16" anchor="default" falsevalue="0" truevalue="1"/>
                    <CheckBox id="chk_sysId4" taborder="3" text="LIMS" position="absolute 6 17 75 37" anchor="default" falsevalue="0" truevalue="1"/>
                    <CheckBox id="chk_sysId5" taborder="4" text="FICS" position="absolute 105 17 174 37" anchor="default" falsevalue="0" truevalue="1"/>
                    <CheckBox id="chk_sysId6" taborder="5" text="SPOON" position="absolute 205 17 274 37" anchor="default" falsevalue="0" truevalue="1"/>
                    <CheckBox id="chk_sysId7" taborder="6" text="모바일 " position="absolute 6 38 75 58" anchor="default" falsevalue="0" truevalue="1"/>
                  </Layout>
                </Layouts>
              </Div>
              <Button id="btn_insert" taborder="15" text="상신" onclick="fn_save" class="btn_WF_CRUD" position="absolute 350 567 395 592"/>
            </Layout>
          </Layouts>
        </Div>
      </Layout>
    </Layouts>
    <Bind>
      <BindItem id="item0" compid="cbo_signProgressStatus" propid="value" datasetid="ds_search" columnid="signProgressStatus"/>
      <BindItem id="item1" compid="Div00.cbo_chgReasonCd" propid="value" datasetid="ds_list" columnid="chgReasonCd"/>
      <BindItem id="item2" compid="Div00.txt_remark" propid="value" datasetid="ds_list" columnid="chgContents"/>
      <BindItem id="item3" compid="Div00.Div00.chk_sysId1" propid="value" datasetid="ds_list" columnid="sysId1"/>
      <BindItem id="item4" compid="Div00.Div00.chk_sysId2" propid="value" datasetid="ds_list" columnid="sysId2"/>
      <BindItem id="item5" compid="Div00.Div00.chk_sysId3" propid="value" datasetid="ds_list" columnid="sysId3"/>
      <BindItem id="item6" compid="Div00.Div00.chk_sysId4" propid="value" datasetid="ds_list" columnid="sysId4"/>
      <BindItem id="item7" compid="Div00.Div00.chk_sysId5" propid="value" datasetid="ds_list" columnid="sysId5"/>
      <BindItem id="item8" compid="Div00.Div00.chk_sysId6" propid="value" datasetid="ds_list" columnid="sysId6"/>
      <BindItem id="item9" compid="Div00.Div00.chk_sysId7" propid="value" datasetid="ds_list" columnid="sysId7"/>
      <BindItem id="item10" compid="Div00.edt_tmNm" propid="value" datasetid="ds_list" columnid="tmNm"/>
      <BindItem id="item11" compid="Div00.edt_upjangnm" propid="value" datasetid="ds_list" columnid="upjangnm"/>
    </Bind>
    <Objects>
      <Dataset id="ds_cmnAuth" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="srcYn" type="STRING" size="256"/>
          <Column id="insYn" type="STRING" size="256"/>
          <Column id="delYn" type="STRING" size="256"/>
          <Column id="savYn" type="STRING" size="256"/>
          <Column id="prtYn" type="STRING" size="256"/>
          <Column id="exlYn" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="srcYn">Y</Col>
            <Col id="insYn">Y</Col>
            <Col id="delYn">N</Col>
            <Col id="savYn">N</Col>
            <Col id="prtYn">N</Col>
            <Col id="exlYn">N</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_search" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="signProgressStatus" type="STRING" size="256"/>
          <Column id="startChgReqDate" type="STRING" size="256"/>
          <Column id="endChgReqDate" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_list" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" onrowposchanged="ds_list_onrowposchanged">
        <ColumnInfo>
          <Column id="sysId1" type="STRING" size="255"/>
          <Column id="sysId2" type="STRING" size="255"/>
          <Column id="sysId3" type="STRING" size="255"/>
          <Column id="sysId4" type="STRING" size="255"/>
          <Column id="sysId5" type="STRING" size="255"/>
          <Column id="sysId6" type="STRING" size="255"/>
          <Column id="sysId7" type="STRING" size="255"/>
          <Column id="sabun" type="STRING" size="255"/>
          <Column id="nmKor" type="STRING" size="255"/>
          <Column id="tmNm" type="STRING" size="255"/>
          <Column id="upjangnm" type="STRING" size="255"/>
          <Column id="chgReqDate" type="STRING" size="255"/>
          <Column id="chgReasonCd" type="STRING" size="255"/>
          <Column id="chgContents" type="STRING" size="255"/>
          <Column id="signProgressStatus" type="STRING" size="255"/>
          <Column id="signProgressStatusNm" type="STRING" size="255"/>
          <Column id="approvDate" type="STRING" size="255"/>
          <Column id="approvUser" type="STRING" size="255"/>
          <Column id="approvNm" type="STRING" size="255"/>
          <Column id="signRemark" type="STRING" size="255"/>
          <Column id="chgSrlnum" type="STRING" size="256"/>
          <Column id="procStatus" type="STRING" size="256"/>
          <Column id="procStatusNm" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_searchValid" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="endChgReqDate" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="endChgReqDate">title:종료일자,comparemax:startChgReqDate:시작일자</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_userExistsCnt" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="cnt" type="STRING" size="255"/>
          <Column id="sabun" type="STRING" size="255"/>
          <Column id="userid" type="STRING" size="255"/>
          <Column id="nmKor" type="STRING" size="255"/>
          <Column id="useYn" type="STRING" size="255"/>
          <Column id="userType" type="STRING" size="255"/>
          <Column id="userGroup" type="STRING" size="255"/>
          <Column id="upjang" type="STRING" size="255"/>
          <Column id="upjangnm" type="STRING" size="255"/>
          <Column id="pwdChgDate" type="STRING" size="255"/>
          <Column id="joinDate" type="STRING" size="255"/>
          <Column id="sdate" type="STRING" size="255"/>
          <Column id="edate" type="STRING" size="255"/>
          <Column id="persInfoAgreeYn" type="STRING" size="255"/>
          <Column id="persInfoProcGrade" type="STRING" size="255"/>
          <Column id="telNo1" type="STRING" size="255"/>
          <Column id="telNo2" type="STRING" size="255"/>
          <Column id="telNo3" type="STRING" size="255"/>
          <Column id="hpNo1" type="STRING" size="255"/>
          <Column id="hpNo2" type="STRING" size="255"/>
          <Column id="hpNo3" type="STRING" size="255"/>
          <Column id="faxNo1" type="STRING" size="255"/>
          <Column id="faxNo2" type="STRING" size="255"/>
          <Column id="faxNo3" type="STRING" size="255"/>
          <Column id="email" type="STRING" size="255"/>
          <Column id="ctiUseYn" type="STRING" size="255"/>
          <Column id="ctiUserId" type="STRING" size="255"/>
          <Column id="mainType" type="STRING" size="255"/>
          <Column id="systemMst" type="STRING" size="255"/>
          <Column id="boardMst" type="STRING" size="255"/>
          <Column id="tempSabunManageSabun" type="STRING" size="255"/>
          <Column id="manageAllowIp" type="STRING" size="255"/>
          <Column id="attr06" type="STRING" size="255"/>
          <Column id="simplePoYn" type="STRING" size="255"/>
          <Column id="acctStatus" type="STRING" size="255"/>
          <Column id="acctLkDd" type="STRING" size="255"/>
          <Column id="acctLkReasonNm" type="STRING" size="255"/>
          <Column id="remark" type="STRING" size="255"/>
          <Column id="pwdErrCnt" type="STRING" size="255"/>
          <Column id="emailYn" type="STRING" size="255"/>
          <Column id="custcd" type="STRING" size="255"/>
          <Column id="otcustnm" type="STRING" size="255"/>
          <Column id="custnm" type="STRING" size="255"/>
          <Column id="sysMenuYn" type="STRING" size="255"/>
          <Column id="smsYn" type="STRING" size="255"/>
          <Column id="otcustcd" type="STRING" size="255"/>
          <Column id="persInfoProcLevel" type="STRING" size="255"/>
          <Column id="personCernNum" type="STRING" size="255"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Script type="xscript4.0"><![CDATA[/*
  화 면 명 : 권한별 메뉴관리
  파 일 명 : AuthByMenuMngt.xfdl
  기    능 : Design 및 Script Template 

    수정일     수정자                  수정내용
  ----------   -------  --------------------------------------------------
  2015.01.05   김재섭   최초 생성
*/

/************************************************************************************************
 * 공통 라이브러리 INCLUDE 영역 (필수)
************************************************************************************************/
include "lib::lib_com.xjs";


/************************************************************************************************
 * FORM 변수 선언 영역 (필수)
************************************************************************************************/
var fv_attachList;	//상신 첨부 파일 목록 (json)
var fv_chgSrlnum = 0;

/************************************************************************************************
 * FORM EVENT 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : Form Load (필수)
 *---------------------------------------------------------------------------------------------*/
function form_onload(obj:Form, e:LoadEventInfo)
{	
	// Form Load 시 공통 기능 처리(obj:Form, bCreateEvent:이벤트 생성 여부)
	gfn_formOnLoad(this);
	
	// 초기값 셋팅
	fn_init();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 초기값 셋팅
 *---------------------------------------------------------------------------------------------*/
function fn_init()
{
	Div00.UserSearchComponent00.setValueClearEvent("parent.fn_searchSabunClear"); //사원을 클리어에 대한 이벤트 등록
	ds_search.addRow();
	ds_search.setColumn(0, "startChgReqDate", gfn_getYear()+"0101");
	ds_search.setColumn(0, "endChgReqDate", gfn_today());
	
	if (!SCAuth.isAuthLevel("99") && !SCAuth.isAuthLevel("999"))
	{
		ds_search.setColumn(0, "sabun", g_EmpNo);
	}

	SCCombo.bind(this, "ComCode", "cbo_signProgressStatus", null, {groupCode:"SIGN_PROGRESS_STATUS", useYn:"Y"}, SCCombo.ALL);//결재진행상태
	SCCombo.bind(this, "ComCode", "Div00.cbo_chgReasonCd", null, {groupCode:"CHG_REASON_CD", useYn:"Y", defVal:"01"});
	
	// calendar 초기화(해당Form, 값지정, 값변경시 실행할 callBack함수, dataset과 bind, 필수여부)
	cal_startChgReqDate.fn_initMonthCal(this, "", "", ds_search, "startChgReqDate");	
	cal_endChgReqDate.fn_initMonthCal(this, "", "", ds_search, "endChgReqDate");
	
	Div00.UserSearchComponent00.setForcedUserGroup("FC,리조트");
	Div00.cal_chgRegDate.fn_initMonthCal(this, "", "", ds_list, "chgReqDate", "Y");
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 화면 닫기 전 변경 유무 체크 (필수-Frame에서 창 닫힐때 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_close()
{	
	// v_ds_check 미사용시 변경사항 체크(입력 프로그램일때 변경되는 Dataset 전체 기술)
	if (gfn_dsIsUpdated(ds_list) == true) 
	{
		// 변경된 데이터가 있습니다. 현재 화면을 닫겠습니까?
        if (!gfn_confirm("confirm.before.movepage")) return false;
    }
    
	// 조회프로그램에도 Return true; 기술해 주세요!
	return true;
}


/************************************************************************************************
 * 공통기능 FUNCTION 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 조회 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_search()
{
	// v_ds_check 미사용시 변경사항 체크
	if (gfn_dsIsUpdated(ds_list) == true) 
	{
		var retValue = gfn_confirm("confirm.before.search");	// 검색을 진행하면 변경된 데이터가 사라집니다. 계속 진행 하시겠습니까?
		if (retValue == false) return;
	}

	// 조회시 Validation Check
	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;

    // Grid sort 표시 초기화(필수)
    gfn_clearSortMark(grd_list);

    var strSvcID    = "search";
    var strURL      = "sc/sca/authChngRequest/selectList.xdo";
    var strInDs     = "ds_search=ds_search:A";
    var strOutDs    = "ds_list=ds_list";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 신규 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_insert()
{	
	var nRow = ds_list.addRow();
	
	ds_list.setColumn(nRow, "sysId1", '0');
	ds_list.setColumn(nRow, "sysId2", '0');
	ds_list.setColumn(nRow, "sysId3", '0');
	ds_list.setColumn(nRow, "sysId4", '0');
	ds_list.setColumn(nRow, "sysId5", '0');
	ds_list.setColumn(nRow, "sysId6", '0');
	ds_list.setColumn(nRow, "sysId7", '0');
	ds_list.setColumn(nRow, "sabun", g_EmpNo);
	ds_list.setColumn(nRow, "nmKor", g_Name);
	ds_list.setColumn(nRow, "tmNm", g_Tm_Nm);
	ds_list.setColumn(nRow, "upjangnm", (g_UserGroup=="공급업체"?g_OtCustNm:g_UpjangNm));
	ds_list.setColumn(nRow, "chgReqDate", gfn_today());
	ds_list.setColumn(nRow, "chgReasonCd", "01");
	ds_list.setColumn(nRow, "chgContents", "필요한 권한 및 부서,업장정보를 적어주세요.");
	Div00.btn_insert.visible = true;
	Div00.enable = true;	
	Div00.btn_searchPersonal.enable = true;
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 삭제 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_delete()
{
	var nRow = ds_list.rowposition;
	
	if(ds_list.rowposition == -1) 
	{
		gfn_alert("msg.err.grid.noselect", "삭제할 row");	// 선택된 항목이 없습니다.
		return;
	}

	var rtVal = gfn_confirm("confirm.before.delete");	// 선택된 자료를 삭제 하시겠습니까?
	if (rtVal == true) 
	{	
		ds_list.deleteRow(nRow);
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 저장 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_save()
{
	// v_ds_check 미사용시 변경사항 체크
	if (gfn_dsIsUpdated(ds_list) == false) 
	{
		if (ds_list.getColumn(ds_list.rowposition, "signProgressStatus") == "NONE") {
			fn_gwDraftAction(ds_list.getColumn(ds_list.rowposition, "chgSrlnum"));
		}
		else {
			gfn_alert("msg.save.nochange");	// 변경된 내역이 없습니다.
		}
		return;
	}
	
	for (var i=0, len=ds_list.getRowCount(); i<len; i++) {
		if (ds_list.getRowType(i) == Dataset.ROWTYPE_INSERT) {
			if (ds_list.getColumn(i, "sysId1") == "0" && 
				ds_list.getColumn(i, "sysId2") == "0" && 
				ds_list.getColumn(i, "sysId3") == "0" && 
				ds_list.getColumn(i, "sysId4") == "0" && 
				ds_list.getColumn(i, "sysId5") == "0" && 
				ds_list.getColumn(i, "sysId6") == "0" && 
				ds_list.getColumn(i, "sysId7") == "0") {
				
				gfn_alert("시스템은 반드시 하나 이상을 선택해주세요.");
				return;
			}
			
			if (gfn_isNull(ds_list.getColumn(i, "sabun"))) {
				gfn_alert("요청자는 필수항목입니다.");
				return;
			}
			
			if (gfn_isNull(ds_list.getColumn(i, "chgReqDate"))) {
				gfn_alert("요청일자는 필수항목입니다.");
				return;
			}
			
			if (gfn_isNull(ds_list.getColumn(i, "chgReasonCd"))) {
				gfn_alert("요청사유는 필수항목입니다.");
				return;
			}
			
			if (gfn_isNull(ds_list.getColumn(i, "chgContents"))) {
				gfn_alert("상세업무는 필수항목입니다.");
				return;
			}
		}
	}	
	
    var strSvcID    = "save";
    var strURL      = "sc/sca/authChngRequest/saveList.xdo";
    var strInDs     = "ds_list=ds_list:U";
    var strOutDs    = "";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 출력 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_print()
{
	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 도움말 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_help()
{
	
}

/************************************************************************************************
 * TRANSACTION 및 CallBack 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 트랜잭션 콜백 함수 (필수)
 *---------------------------------------------------------------------------------------------*/
function fn_callBack(strSvcID, nErrorCode, strErrorMsg)
{
	// 에러시 gfn_callBack에서 메시지 제공, 화면별 특정 에러 발생시에만 사용하세요.
	if (nErrorCode < 0) 
	{
		return;
	}
	
    switch(strSvcID)
    {
		// 코드분류 조회
        case "search" :
            //trace(ds_list.saveXML());
            break;
        
        // 저장
        case "save" :
			fn_gwDraftAction(fv_chgSrlnum);
            break;    
		
		case "saveGwDraft" :
			fn_search();
			break;
    }
}


/************************************************************************************************
 * 사용자 FUNCTION 영역 (필수)
************************************************************************************************/
function fn_requestUserAfterEvent(o, p)
{
	ds_list.setColumn(ds_list.rowposition, "tmNm", p.tmNm);
	ds_list.setColumn(ds_list.rowposition, "upjangnm", p.upjangnm);
}

function fn_searchSabunClear(o)
{
	ds_list.setColumn(ds_list.rowposition, "sabun", "");
	ds_list.setColumn(ds_list.rowposition, "nmKor", "");
	ds_list.setColumn(ds_list.rowposition, "tmNm", "");
	ds_list.setColumn(ds_list.rowposition, "upjangnm", "");
}



/**
 * 그룹웨어 상신 버튼 클릭 시 상신 팝업을 호출한다.
 * @param obj Button
 * @param e ClickEventInfo
 * @return none
 */
function fn_gwDraftAction(chgSrlnum)
{
	ds_list.setColumn(ds_list.rowposition, "chgSrlnum", chgSrlnum);
     //그룹웨어에 전달할 파라메터 생성
    var arrParams	= SCGw.newParams ();

    //(필수) 결재문서 서비스명 - 문서양식별로 설정된 서비스명 설정
    var gwServiceId = "HWRC_FC_SCC_AUTH_CHGREQ";
    var gwTitle = "시스템 권한변경 요청";

    SCGw.setParams (arrParams, SCGw.GW_SERVICE_NAME, gwServiceId);

    //(필수) 본문 URL : (주의) .do로 호출해야 하며 GET 방식으로 파라미터를 전달 (id라는 key는 사용 불가)
    var sBodyUrl = "/sc/sca/authChngRequest/makeGwDraftContent.do?chgSrlnum=" + chgSrlnum;
    SCGw.setParams (arrParams, SCGw.GW_BODY_URL, sBodyUrl);

    //(필수) 본문 제목 – 문서양식 별로 설정된 업무명
    SCGw.setParams (arrParams, SCGw.GW_BODY_TITLE, gwTitle);

    //(필수)문서 방향 : 가로 또는 세로 방향 (GW_VERTICAL, GW_HORIZONTAL)
    SCGw.setParams (arrParams, SCGw.GW_PORTRAIT, SCGw.VERTICAL);
    
    //(선택)첨부문서 목록 : json 형태 문자열
	SCGw.setParams (arrParams, SCGw.GW_ATTACH_LIST, fv_attachList);

    //(선택)Client Id : 결재 instance id와 연관을 맺기위한 업무별 ID로 unique key를 이용, 생략하면 상신시각이 됨(최대 40 byte)
    //SCGw.setParams (arrParams, SCGw.GW_CLIENT_ID, edt_id.value);

    //그룹웨어 상신 팝업을 호출한다.
    SCGw.sendDraft (this, arrParams);
}

/**
 * 그룹웨어 상신 처리 후 반환되는 Instance Id를 처리한다. (업무 테이블에 update)
 * (중요) 이 함수는 SCGw에서 호출되므로 필히 선언되어야 한다.
 * @param instanceId
 * @return none
 */
function scgw_ondraftnotify(instanceId)
{
    var strSvcID    = "saveGwDraft";
    var strURL      = "sc/sca/authChngRequest/saveGwInstanceId.xdo";
    var strInDs     = "";
    var strOutDs    = "";
    var strArg      = "chgSrlnum=" + ds_list.getColumn(ds_list.rowposition, "chgSrlnum") + " instanceId=" + instanceId;
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}

/************************************************************************************************
 * 각 COMPONENT 별 EVENT 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : form에서 Key Down시 단축키들 지정(공통에서 자동생성, 화면에 스크립트 작성시 화면 스크립트만 실행됨)
 *---------------------------------------------------------------------------------------------*/
// function form_onkeydown(obj:Form, e:KeyEventInfo)
// {
// 	gfn_formKeyDown(obj, e);
// }

/*----------------------------------------------------------------------------------------------
 * 설명      : Grid Header Click시 정렬(공통에서 자동생성, 화면에 스크립트 작성시 화면 스크립트만 실행됨)
 *---------------------------------------------------------------------------------------------*/
// function grd_list_onheadclick(obj:Grid, e:GridClickEventInfo)
// {
// 	gfn_gridSort(obj, e);
// }

function ds_list_onrowposchanged(obj:Dataset, e:DSRowPosChangeEventInfo)
{
	if (obj.getColumn(e.newrow, "procStatus") == "00") {
		Div00.btn_insert.visible = true;
		Div00.enable = true;
		Div00.btn_searchPersonal.enable = true;
	}
	else {
		if (obj.getRowType(e.newrow) == Dataset.ROWTYPE_INSERT) {
			Div00.btn_insert.visible = true;
			Div00.enable = true;
			Div00.btn_searchPersonal.enable = true;
		}
		else {
			Div00.btn_insert.visible = false;
			Div00.enable = false;
			Div00.btn_searchPersonal.enable = false;
		}
	}
}

function btn_searchPersonal_onclick(obj:Button,  e:ClickEventInfo)
{
	var strId       = "PersonalSearch";
	var strURL      = "cmn::PersonalSearchPop.xfdl";
	var objArgument = {
		P_MU_CD : "",
		P_TM_CD : "",
		P_TM_NM : "",
		P_CC_CD : "",
		P_CC_NM : "",
		P_ALL_MU : "TRUE"
	};
	var nWidth      = -1;
	var nHeight     = -1;
	var strStyle    = "";
	var nLeft       = -1;
	var nTop        = -1;
	var isModeless  = false;
	var bShowTitle  = true;
	var strAlign    = "-1";

	// 리턴값을 배열로 받을 경우	
	var arrRtn = gfn_dialog(strId, strURL, objArgument, nWidth, nHeight, strStyle, nLeft, nTop, isModeless, bShowTitle, strAlign);
	
	if (arrRtn instanceof Object)
	{
		var strSvcID    = "userExistsUser";
		var strURL      = "sc/scu/userMngt/selectExistsUser.xdo";
		var strInDs     = "";
		var strOutDs    = "ds_userExistsCnt=ds_userExistsCnt";
		var strArg      = "sabun=" + arrRtn.sabun;
		var strCallback = "";
		var bAsync      = false;
		
		gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
		
		if (ds_userExistsCnt.getRowCount() > 0)
		{
			ds_list.setColumn(ds_list.rowposition, "upjangnm", ds_userExistsCnt.getColumn(0, "upjangnm"));
		}	
		else
		{
			ds_list.setColumn(ds_list.rowposition, "upjangnm", "");
		}
		ds_list.setColumn(ds_list.rowposition, "sabun", arrRtn.sabun);
		ds_list.setColumn(ds_list.rowposition, "nmKor", arrRtn.nmKor);
		ds_list.setColumn(ds_list.rowposition, "tmNm", arrRtn.tmNm);
	}	
}


]]></Script>
  </Form>
</FDL>
