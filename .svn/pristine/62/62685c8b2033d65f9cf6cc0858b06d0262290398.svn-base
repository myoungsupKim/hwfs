<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="..\..\..\default_typedef.xml"/>
  <Form id="SpContFact" classname="COMP_GUIDE_13" inheritanceid="" position="absolute 0 0 1252 725" titletext="특약사항" scrollbars="autoboth" onload="form_onload">
    <Layouts>
      <Layout>
        <Static id="Static06" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1237 0 1252 710" anchor="top right"/>
        <Static id="Static71" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 710 1252 725" anchor="left bottom"/>
        <Div id="div_cmnBtn" anchor="left top right" taborder="7" url="cmn::CmnBtn.xfdl" text="Div00" scrollbars="none" position="absolute 0 0 1237 30" tabstop="false"/>
        <Static id="Static29" class="sta_WFSA_Labelbg" position="absolute 0 30 1236 70" anchor="left top right"/>
        <Static id="Static45" text="W15" visible="false" position="absolute 0 30 15 71" style="background:#ff000055;align:center middle;"/>
        <Static id="Static43" text="W10" visible="false" position="absolute 14 30 277 40" style="background:#ff000055;align:center middle;"/>
        <Static id="Static44" text="W10" visible="false" position="absolute 14 61 277 71" style="background:#ff000055;align:center middle;"/>
        <Tab id="tpg" anchor="all" taborder="6" tabindex="0" scrollbars="autoboth" position="absolute 0 83 1237 710" style="showextrabutton:false;" onchanged="tpg_onchanged">
          <Tabpages>
            <Tabpage id="tpg1" style="anchor:default;" text="특약율 관리">
              <Layouts>
                <Layout>
                  <Static id="Static07" text="w10" class="Guide01_AreaRed" visible="false" position="absolute 0 15 10 571"/>
                  <Static id="Static01" text="w10" class="Guide01_AreaRed" visible="false" position="absolute 1224 15 1235 571"/>
                  <Static id="Static35" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 589 1235 599" anchor="left top"/>
                  <Grid id="grd_listGroup" taborder="1" binddataset="ds_listGroup" autoenter="select" useinputpanel="false" cellsizingtype="col" autofittype="col" nodataimage="URL('theme://images/grd_WF_NoDataImg.png')" oncellclick="grd_list00_oncellclick" position="absolute 10 31 403 589" anchor="left top bottom">
                    <Formats>
                      <Format id="default">
                        <Columns>
                          <Column size="44"/>
                          <Column size="86"/>
                          <Column size="86"/>
                          <Column size="64"/>
                          <Column size="64"/>
                          <Column size="0"/>
                          <Column size="0"/>
                          <Column size="0"/>
                          <Column size="0"/>
                          <Column size="0"/>
                          <Column size="0"/>
                        </Columns>
                        <Rows>
                          <Row size="26" band="head"/>
                          <Row size="24"/>
                        </Rows>
                        <Band id="head">
                          <Cell class="head_Excel"/>
                          <Cell col="1" edittype="text" class="grd_WF_Essential" text="중분류코드"/>
                          <Cell col="2" class="grd_WF_Essential" text="중분류명"/>
                          <Cell col="3" text="과세율"/>
                          <Cell col="4" text="면세율"/>
                          <Cell col="5" text="업장코드"/>
                          <Cell col="6" text="창고코드"/>
                          <Cell col="7" text="기준일자"/>
                          <Cell col="8" text="현금성분류"/>
                          <Cell col="9" text="사용유무"/>
                          <Cell col="10" text="레벨"/>
                        </Band>
                        <Band id="body">
                          <Cell text="expr:currow+1"/>
                          <Cell col="1" displaytype="text" edittype="none" style="align:center middle;" text="bind:clsCd3"/>
                          <Cell col="2" displaytype="text" edittype="none" style="align:left middle;" text="bind:clsNm3"/>
                          <Cell col="3" displaytype="number" edittype="masknumber" style="align:right middle;" text="bind:fmSaleRate" mask="##0" editautoselect="true"/>
                          <Cell col="4" displaytype="number" edittype="masknumber" style="align:right middle;" text="bind:fmNosaleRate" mask="##0" editautoselect="true"/>
                          <Cell col="5" text="bind:upjang"/>
                          <Cell col="6" text="bind:subinvCode"/>
                          <Cell col="7" text="bind:sdate"/>
                          <Cell col="8" text="bind:cashCode"/>
                          <Cell col="9" text="bind:useYn"/>
                          <Cell col="10" text="bind:clsLvl"/>
                        </Band>
                      </Format>
                    </Formats>
                  </Grid>
                  <Static id="Static34" text="w10" class="Guide01_AreaRed" visible="false" position="absolute 403 0 413 304"/>
                  <Static id="Static15" text="h13" class="Guide01_AreaRed" visible="false" position="absolute -1 0 249 13" anchor="left top"/>
                  <Static id="Static22" text="중분류" class="sta_WF_Title01" position="absolute 10 13 74 31" anchor="left top"/>
                  <Static id="Static16" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 10 26 404 31" anchor="left top"/>
                  <Grid id="grd_listClass" taborder="1" binddataset="ds_listClass" autoenter="select" useinputpanel="false" cellsizingtype="col" autofittype="col" nodataimage="URL('theme://images/grd_WF_NoDataImg.png')" oncellclick="grd_list00_oncellclick" position="absolute 413 31 806 589" anchor="left top bottom">
                    <Formats>
                      <Format id="default">
                        <Columns>
                          <Column size="44"/>
                          <Column size="86"/>
                          <Column size="86"/>
                          <Column size="64"/>
                          <Column size="64"/>
                          <Column size="0"/>
                          <Column size="0"/>
                          <Column size="0"/>
                          <Column size="0"/>
                          <Column size="0"/>
                          <Column size="0"/>
                        </Columns>
                        <Rows>
                          <Row size="26" band="head"/>
                          <Row size="24"/>
                        </Rows>
                        <Band id="head">
                          <Cell class="head_Excel"/>
                          <Cell col="1" edittype="text" class="grd_WF_Essential" text="소분류코드"/>
                          <Cell col="2" class="grd_WF_Essential" text="소분류명"/>
                          <Cell col="3" text="과세율"/>
                          <Cell col="4" text="면세율"/>
                          <Cell col="5" text="업장코드"/>
                          <Cell col="6" text="창고코드"/>
                          <Cell col="7" text="기준일자"/>
                          <Cell col="8" text="현금성분류"/>
                          <Cell col="9" text="사용유무"/>
                          <Cell col="10" text="레벨"/>
                        </Band>
                        <Band id="body">
                          <Cell text="expr:currow+1"/>
                          <Cell col="1" edittype="none" style="align:center middle;" text="bind:clsCd4"/>
                          <Cell col="2" displaytype="text" edittype="none" style="align:left middle;" text="bind:clsNm4"/>
                          <Cell col="3" displaytype="number" edittype="masknumber" style="align:right middle;" text="bind:fmSaleRate" mask="##0" editautoselect="true"/>
                          <Cell col="4" displaytype="number" edittype="masknumber" style="align:right middle;" text="bind:fmNosaleRate" mask="##0" editautoselect="true"/>
                          <Cell col="5" text="bind:upjang"/>
                          <Cell col="6" text="bind:subinvCode"/>
                          <Cell col="7" text="bind:sdate"/>
                          <Cell col="8" text="bind:cashCode"/>
                          <Cell col="9" text="bind:useYn"/>
                          <Cell col="10" text="bind:clsLvl"/>
                        </Band>
                      </Format>
                    </Formats>
                  </Grid>
                  <Static id="Static00" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 412 26 806 31" anchor="left top"/>
                  <Static id="Static03" text="소분류" class="sta_WF_Title01" position="absolute 413 13 659 31" anchor="left top"/>
                  <Static id="Static04" text="w10" class="Guide01_AreaRed" visible="false" position="absolute 806 0 816 304"/>
                  <Static id="Static21" text="w02" class="Guide01_AreaRed" visible="false" position="absolute 766 5 768 25" anchor="top right"/>
                  <Button id="btn_saveClass" taborder="1" text="저장" class="btn_WF_Function" position="absolute 768 6 806 26" anchor="left top" onclick="fn_saveClass"/>
                  <Button id="btn_clsUpload" taborder="1" text="엑셀부르기" class="btn_WF_Function" position="absolute 691 6 766 26" anchor="left top" onclick="fn_classUpload"/>
                  <Static id="Static05" text="h6" class="Guide01_AreaRed" visible="false" position="absolute 713 -1 806 5" anchor="left top"/>
                  <Button id="btn_grpUpload" taborder="1" text="엑셀부르기" class="btn_WF_Function" position="absolute 288 6 363 26" anchor="left top" onclick="fn_groupUpload"/>
                  <Button id="btn_saveGroup" taborder="1" text="저장" class="btn_WF_Function" position="absolute 365 6 403 26" anchor="left top" onclick="fn_saveProc"/>
                  <Static id="Static08" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 816 0 1062 13" anchor="left top"/>
                  <Button id="btn_allView" taborder="1" text="전체자재조회" class="btn_WF_Function" position="absolute 818 60 907 80" onclick="btn_allView_onclick" anchor="top right" visible="false"/>
                  <Button id="btn_itemUpload" taborder="1" text="엑셀부르기" class="btn_WF_Function" position="absolute 1033 6 1108 26" anchor="top right" onclick="fn_itemUpload"/>
                  <Button id="btn_saveItem" taborder="1" text="저장" class="btn_WF_Function" position="absolute 1149 6 1187 26" anchor="top right" onclick="fn_saveItem"/>
                  <Static id="Static10" text="자재별" class="sta_WF_Title01" position="absolute 820 13 1066 31" anchor="left top"/>
                  <Static id="Static11" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 819 26 1213 31" anchor="left top"/>
                  <Grid id="grd_listItem" taborder="1" binddataset="ds_listItem" autoenter="select" useinputpanel="false" cellsizingtype="col" autofittype="col" nodataimage="URL('theme://images/grd_WF_NoDataImg.png')" position="absolute 816 31 1224 589" anchor="all" selecttype="multirow">
                    <Formats>
                      <Format id="default">
                        <Columns>
                          <Column size="44"/>
                          <Column size="69"/>
                          <Column size="86"/>
                          <Column size="104"/>
                          <Column size="52"/>
                          <Column size="50"/>
                          <Column size="0"/>
                          <Column size="0"/>
                          <Column size="0"/>
                          <Column size="0"/>
                          <Column size="0"/>
                        </Columns>
                        <Rows>
                          <Row size="26" band="head"/>
                          <Row size="24"/>
                        </Rows>
                        <Band id="head">
                          <Cell class="head_Excel"/>
                          <Cell col="1" edittype="text" class="grd_WF_Essential" text="자재코드"/>
                          <Cell col="2" class="grd_WF_Essential" text="자재명"/>
                          <Cell col="3" text="규격"/>
                          <Cell col="4" text="과세율"/>
                          <Cell col="5" text="면세율"/>
                          <Cell col="6" text="업장코드"/>
                          <Cell col="7" text="창고코드"/>
                          <Cell col="8" text="기준일자"/>
                          <Cell col="9" text="현금성분류"/>
                          <Cell col="10" text="사용유무"/>
                          <Cell col="11" text="레벨"/>
                        </Band>
                        <Band id="body">
                          <Cell text="expr:currow+1"/>
                          <Cell col="1" edittype="none" style="align:center middle;" text="bind:itemCode"/>
                          <Cell col="2" displaytype="text" edittype="none" style="align:left middle;" text="bind:itemName"/>
                          <Cell col="3" displaytype="text" text="bind:itemSize"/>
                          <Cell col="4" displaytype="number" edittype="masknumber" style="align:right;" text="bind:fmSaleRate" mask="##0" editautoselect="true"/>
                          <Cell col="5" displaytype="number" edittype="masknumber" style="align:right;" text="bind:fmNosaleRate" mask="##0" editautoselect="true"/>
                          <Cell col="6" text="bind:upjang"/>
                          <Cell col="7" text="bind:subinvCode"/>
                          <Cell col="8" text="bind:sdate"/>
                          <Cell col="9" text="bind:cashCode"/>
                          <Cell col="10" text="bind:useYn"/>
                          <Cell col="11" text="bind:clsLvl"/>
                        </Band>
                      </Format>
                    </Formats>
                  </Grid>
                  <Static id="Static14" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 178 5 188 26" anchor="left top"/>
                  <Static id="Static17" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 215 5 225 26" anchor="left top"/>
                  <Static id="Static19" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 238 6 248 27" anchor="left top"/>
                  <Button id="btn_clsRate" taborder="1" text="적용" class="btn_WF_Function" position="absolute 248 6 286 26" anchor="left top" onclick="fn_inputRate"/>
                  <Static id="Static12" text="w02" class="Guide01_AreaRed" visible="false" position="absolute 286 6 288 26" anchor="top right"/>
                  <Static id="Static02" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 414 0 664 13" anchor="left top"/>
                  <Static id="Static06" text="특약율" class="sta_WFDA_Label03" position="absolute 126 2 240 29" anchor="left top" style="align:left middle;"/>
                  <Edit id="Edit03" taborder="2" value="%" imemode="hangul" ontextchanged="Edit00_ontextchanged" position="absolute 211 5 234 26" anchor="left top" style="align:right middle;" oneditclick="tpg_tpg1_Edit03_oneditclick"/>
                  <MaskEdit id="msk_clsRate" taborder="3" value="0" displaynulltext="0" mask="+#,##0 %" maskchar="-" position="absolute 182 5 212 26" style="align:center middle;"/>
                  <Button id="btn_addItem" taborder="4" text="추가" class="btn_WF_Function" position="absolute 1109 6 1147 26" anchor="top right" onclick="tpg_tpg1_btn_addItem_onclick"/>
                  <Button id="btn_delItem" taborder="6" text="삭제" class="btn_WF_Function" position="absolute 1189 6 1227 26" anchor="top right" onclick="tpg_tpg1_btn_delItem_onclick"/>
                </Layout>
              </Layouts>
            </Tabpage>
            <Tabpage id="tpg2" text="특약율 일괄복사">
              <Layouts>
                <Layout>
                  <Static id="Static60" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 37 -18 1272 -3" anchor="left top"/>
                  <Static id="Static07" text="w10" class="Guide01_AreaRed" visible="false" position="absolute 0 15 10 596"/>
                  <Static id="Static01" text="w10" class="Guide01_AreaRed" visible="false" position="absolute 1225 15 1235 596"/>
                  <Static id="Static35" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 10 587 1245 597" anchor="left top"/>
                  <Calendar id="cal_fromDay" taborder="1" dateformat="yyyy-MM-dd" position="absolute 3 -398 107 -377" anchor="left top" style="align:center middle;"/>
                  <Static id="Static21" class="sta_WFSA_Labelbg01" position="absolute 10 14 1225 55" anchor="left top right"/>
                  <Static id="Static15" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 10 55 460 68" anchor="left top"/>
                  <Static id="Static22" text="창고목록" class="sta_WF_Title01" position="absolute 10 68 460 86" anchor="left top"/>
                  <Static id="Static16" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 10 81 460 86" anchor="left top"/>
                  <Static id="Static12" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 342 24 372 45" anchor="left top"/>
                  <Button id="btn_saveSub" taborder="1" text="저장" class="btn_WF_Function" position="absolute 1179 24 1224 44" anchor="top right" onclick="fn_saveSub"/>
                  <Static id="Static00" text="w02" class="Guide01_AreaRed" visible="false" position="absolute 1178 24 1180 44" anchor="top right"/>
                  <Button id="btn_serachSub" taborder="1" text="조회" class="btn_WF_Function" position="absolute 1133 24 1178 44" anchor="top right" onclick="fn_searchSub"/>
                  <Grid id="grd_listSub" taborder="1" binddataset="ds_listSub" scrollbars="none" autoenter="select" useinputpanel="false" cellsizingtype="col" position="absolute 10 86 1225 587" anchor="all" onheadclick="tpg_tpg2_grd_listSubinv_onheadclick" autofittype="col">
                    <Formats>
                      <Format id="default">
                        <Columns>
                          <Column size="40"/>
                          <Column size="59"/>
                          <Column size="84"/>
                          <Column size="194"/>
                          <Column size="104"/>
                          <Column size="227"/>
                          <Column size="98"/>
                          <Column size="0"/>
                        </Columns>
                        <Rows>
                          <Row size="24" band="head"/>
                          <Row size="24"/>
                        </Rows>
                        <Band id="head">
                          <Cell style="background:#566572ff URL('theme://convertImages/new/img_WF_Excel.png') center middle;"/>
                          <Cell col="1" displaytype="checkbox" edittype="checkbox" text="0"/>
                          <Cell col="2" text="업장코드"/>
                          <Cell col="3" text="업장명"/>
                          <Cell col="4" text="창고코드"/>
                          <Cell col="5" text="창고명"/>
                          <Cell col="6" text="최근설정일자"/>
                          <Cell col="7" text="적용일자"/>
                        </Band>
                        <Band id="body">
                          <Cell expr="currow+1"/>
                          <Cell col="1" displaytype="checkbox" edittype="checkbox" text="bind:chk"/>
                          <Cell col="2" displaytype="text" style="align:center middle;" text="bind:upjang"/>
                          <Cell col="3" displaytype="text" text="bind:upjangNm"/>
                          <Cell col="4" style="align:center middle;" text="bind:subinvCode"/>
                          <Cell col="5" style="align:left middle;" text="bind:subinvName"/>
                          <Cell col="6" style="align:center middle;" text="bind:sdate"/>
                          <Cell col="7" style="align:center middle;" text="bind:adate"/>
                        </Band>
                      </Format>
                    </Formats>
                  </Grid>
                  <Static id="Static04" text="적용일자" class="sta_WFSA_label" position="absolute 372 24 436 45" anchor="left top"/>
                  <Static id="Static43" text="W10" visible="false" position="absolute 11 14 274 24" style="background:#ff000055;align:center middle;"/>
                  <Static id="Static45" text="W15" visible="false" position="absolute 10 16 25 57" style="background:#ff000055;align:center middle;"/>
                  <Static id="Static28" text="본     사" class="sta_WFSA_label" position="absolute 26 25 88 46" anchor="left top"/>
                  <Static id="Static02" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 430 23 440 44" anchor="left top"/>
                  <UpjangSearchComponent id="comp_mainUpjang" titletext="업장 검색용 Component" taborder="2" text="UpjangSearchComponent01" position="absolute 94 24 342 45" bindDataset="ds_searchSub" bindUpjangCodeColumn="schMainUpjang" bindUpjangNameColumn="schMainUpjangNm" eventBeforeTrigger="" eventAfterTrigger="" roleSetId="FmsMainUpjang" class="edt_WF_Essential"/>
                  <ObjCalendar id="cal_stdDate" titletext="캘린더" taborder="3" text="20150101" scrollbars="none" position="absolute 440 24 540 45"/>
                </Layout>
              </Layouts>
            </Tabpage>
          </Tabpages>
        </Tab>
        <Static id="Static03" text="현금성분류" class="sta_WFSA_label" position="absolute 1049 40 1133 61" anchor="left top"/>
        <Static id="Static00" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 1120 39 1130 60" anchor="left top"/>
        <Combo id="cbo_cashCode" taborder="5" position="absolute 1130 40 1231 61" anchor="left top" index="2" value="003" class="cmb_WF_Essential"/>
        <Static id="Static60" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 0 70 450 83" anchor="left top"/>
        <Static id="Static28" text="업장" class="sta_WFSA_label" position="absolute 215 40 256 61" anchor="left top"/>
        <Static id="Static11" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 248 40 258 61" anchor="left top"/>
        <Static id="Static09" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 443 40 473 61" anchor="left top"/>
        <Static id="Static04" text="기준일" class="sta_WFSA_label" position="absolute 753 40 804 61" anchor="left top"/>
        <Static id="Static07" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 798 40 808 61" anchor="left top"/>
        <Static id="Static13" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 66 115 76 136" anchor="left top"/>
        <Static id="Static58" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 505 42 515 63" anchor="left top"/>
        <Static id="Static57" text="창고" class="sta_WFSA_label" position="absolute 473 41 510 62" anchor="left top"/>
        <Combo id="cbo_subinvCode" taborder="2" position="absolute 515 40 723 61" anchor="left top" class="cmb_WF_Essential" innerdataset="@ds_subinv" codecolumn="subinvCode" datacolumn="subinvName" onitemchanged="fn_searchDate" type="search"/>
        <Static id="Static59" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 723 40 753 61" anchor="left top"/>
        <Static id="Static02" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 908 41 918 62" anchor="left top"/>
        <Combo id="cbo_sdate" taborder="4" readonly="false" position="absolute 917 40 1020 61" innerdataset="@ds_sdate" codecolumn="sdate" datacolumn="sdateDisp" onitemchanged="fn_setDate" index="0" text="기준일 선택"/>
        <Static id="Static05" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 1020 40 1050 61" anchor="left top"/>
        <UpjangSearchComponent id="comp_upjang" titletext="업장 검색용 Component" taborder="1" text="UpjangSearchComponent00" position="absolute 257 40 444 61" bindDataset="ds_search" bindUpjangCodeColumn="schUpjang" bindUpjangNameColumn="schUpjangNm" eventBeforeTrigger="fn_beforeSet" eventAfterTrigger="fn_upjangSet" roleSetId="FmsUpjang" onkeydown="comp_upjang_onkeydown" class="edt_WF_Essential"/>
        <ObjCalendar id="cal_sdate" titletext="캘린더" taborder="3" text="20150101" scrollbars="none" position="absolute 808 40 908 61"/>
        <Div id="div_excel" taborder="8" style="background:#f0f5ffff;border:1 solid #808080ff ;" visible="false" position="absolute 490 287 771 440">
          <Layouts>
            <Layout>
              <Static id="Static00" class="sta_WF_AlertMessege" position="absolute -1 0 279 150"/>
              <Static id="Static02" text="◎ 엑셀 업로드 작업 체크" class="sta_WF_MessegeTitle" position="absolute 4 0 269 28" anchor="left top"/>
              <Static id="Static01" class="sta_WF_AltMsgInformationImg" position="absolute 12 65 46 99" anchor="left top"/>
              <TextArea id="TextArea00" taborder="1" value="엑셀 업로드 자료에 대한 오류사항을 체크중입니다.                       오류가 없는 경우 저장 확인여부 메시지를 반드시 확인하십시요." wordwrap="word" class="txt_WF_Messege" position="absolute 58 45 269 127" anchor="all"/>
            </Layout>
          </Layouts>
        </Div>
        <Static id="Static12" text="w02" class="Guide01_AreaRed" visible="false" position="absolute 1148 115 1150 135" anchor="top right"/>
        <Static id="Static08" text="w02" class="Guide01_AreaRed" visible="false" position="absolute 1038 116 1040 136" anchor="top right"/>
        <Static id="sta_msg" text="전체 자재를 기준으로 특약율을 등록 시 건수가 많아 속도가 느려집니다. " class="sta_WF_DiscInfo" position="absolute 777 93 1233 113" anchor="top right"/>
        <Static id="Static01" text="본사" class="sta_WFSA_label" position="absolute 16 40 57 61" anchor="left top"/>
        <Static id="Static10" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 49 40 59 61" anchor="left top"/>
        <UpjangSearchComponent id="comp_upjangMain" titletext="업장 검색용 Component" taborder="0" onkeydown="comp_upjangMain_onkeydown" text="UpjangSearchComponent00" position="absolute 57 40 200 61" bindDataset="ds_search" bindUpjangCodeColumn="schMain" bindUpjangNameColumn="schMainNm" eventBeforeTrigger="" eventAfterTrigger="" roleSetId="FmsMainUpjang"/>
        <Static id="Static14" text="w02" class="Guide01_AreaRed" visible="false" position="absolute 1188 114 1190 134" anchor="top right"/>
      </Layout>
    </Layouts>
    <Bind>
      <BindItem id="item0" compid="tpg.tabpage3.edt_gubun00" propid="userdata" datasetid="ds_search" columnid="GUBUN"/>
      <BindItem id="item2" compid="tpg.tabpage3.edt_gubun00" propid="UserData" datasetid="ds_search" columnid="GUBUN"/>
      <BindItem id="item4" compid="cbo_subinvCode" propid="value" datasetid="ds_search" columnid="schSubinvCode"/>
      <BindItem id="item6" compid="cbo_cashCode" propid="value" datasetid="ds_search" columnid="schCashCode"/>
      <BindItem id="item1" compid="cal_sdate" propid="text" datasetid="ds_search" columnid="schSdate"/>
      <BindItem id="item3" compid="tpg.tpg2.cal_stdDate" propid="text" datasetid="ds_searchSub" columnid="schStdDate"/>
    </Bind>
    <Objects>
      <Dataset id="ds_search" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" oncolumnchanged="ds_search_oncolumnchanged">
        <ColumnInfo>
          <Column id="schMain" type="STRING" size="256"/>
          <Column id="schMainNm" type="STRING" size="256"/>
          <Column id="schUpjang" type="STRING" size="256"/>
          <Column id="schUpjangNm" type="STRING" size="256"/>
          <Column id="schSubinvCode" type="STRING" size="256"/>
          <Column id="schSdate" type="STRING" size="256"/>
          <Column id="schCashCode" type="STRING" size="256"/>
          <Column id="schClassType" type="STRING" size="256"/>
          <Column id="schRow" type="BIGDECIMAL" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_subinv" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="subinvCode" type="STRING" size="256"/>
          <Column id="subinvName" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_sdate" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" onrowposchanged="fn_setDate">
        <ColumnInfo>
          <Column id="sdate" type="STRING" size="256"/>
          <Column id="sdateDisp" type="STRING" size="256"/>
          <Column id="rowid" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="sdateDisp">기준일 선택</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_listGroup" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="rowNum" type="STRING" size="256"/>
          <Column id="clsCd3" type="STRING" size="256"/>
          <Column id="clsNm3" type="STRING" size="256"/>
          <Column id="fmSaleRate" type="STRING" size="256"/>
          <Column id="fmNosaleRate" type="STRING" size="256"/>
          <Column id="upjang" type="STRING" size="256"/>
          <Column id="subinvCode" type="STRING" size="256"/>
          <Column id="sdate" type="STRING" size="256"/>
          <Column id="cashCode" type="STRING" size="256"/>
          <Column id="useYn" type="STRING" size="256"/>
          <Column id="clsLvl" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_listClass" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="rowNum" type="STRING" size="256"/>
          <Column id="clsCd4" type="STRING" size="256"/>
          <Column id="clsNm4" type="STRING" size="256"/>
          <Column id="fmSaleRate" type="STRING" size="256"/>
          <Column id="fmNosaleRate" type="STRING" size="256"/>
          <Column id="upjang" type="STRING" size="256"/>
          <Column id="subinvCode" type="STRING" size="256"/>
          <Column id="sdate" type="STRING" size="256"/>
          <Column id="cashCode" type="STRING" size="256"/>
          <Column id="useYn" type="STRING" size="256"/>
          <Column id="clsLvl" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_listItem" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="rowNum" type="STRING" size="256"/>
          <Column id="itemCode" type="STRING" size="256"/>
          <Column id="itemName" type="STRING" size="256"/>
          <Column id="itemSize" type="STRING" size="256"/>
          <Column id="fmSaleRate" type="BIGDECIMAL" size="256"/>
          <Column id="fmNosaleRate" type="BIGDECIMAL" size="256"/>
          <Column id="upjang" type="STRING" size="256"/>
          <Column id="subinvCode" type="STRING" size="256"/>
          <Column id="sdate" type="STRING" size="256"/>
          <Column id="cashCode" type="STRING" size="256"/>
          <Column id="useYn" type="STRING" size="256"/>
          <Column id="clsLvl" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_searchValid" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="schUpjang" type="STRING" size="256"/>
          <Column id="schSubinvCode" type="STRING" size="256"/>
          <Column id="schSdate" type="STRING" size="256"/>
          <Column id="schCashCode" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="schUpjang">title:업장,required:true,focus:comp_upjang</Col>
            <Col id="schSubinvCode">title:창고,required:true,focus:cbo_subinvCode</Col>
            <Col id="schSdate">title:기준일,required:true,date;true,focus:cal_sdate</Col>
            <Col id="schCashCode">title:현금성분류,required:true,focus:cbo_cashCode</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_cashCode" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="cashCode" type="STRING" size="256"/>
          <Column id="cashName" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="cashCode">001</Col>
            <Col id="cashName">CK물류비</Col>
          </Row>
          <Row>
            <Col id="cashCode">002</Col>
            <Col id="cashName">기부금</Col>
          </Row>
          <Row>
            <Col id="cashCode">003</Col>
            <Col id="cashName">장려금</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_sdateValid" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="schUpjang" type="STRING" size="256"/>
          <Column id="schSubinvCode" type="STRING" size="256"/>
          <Column id="schCashCode" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="schUpjang">title:업장,required:true,date;true,focus:ed_upjang</Col>
            <Col id="schSubinvCode">title:창고,required:true,focus:cbo_subinvCode</Col>
            <Col id="schCashCode"/>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_searchSub" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="schMainUpjang" type="STRING" size="256"/>
          <Column id="schMainUpjangNm" type="STRING" size="256"/>
          <Column id="schStdDate" type="STRING" size="256"/>
          <Column id="schUpjang" type="STRING" size="256"/>
          <Column id="schSubinvCode" type="STRING" size="256"/>
          <Column id="schCashCode" type="STRING" size="256"/>
          <Column id="schSdate" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_listSub" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="chk" type="STRING" size="256"/>
          <Column id="subinvCode" type="STRING" size="256"/>
          <Column id="subinvName" type="STRING" size="256"/>
          <Column id="sdate" type="STRING" size="256"/>
          <Column id="adate" type="STRING" size="256"/>
          <Column id="upjang" type="STRING" size="256"/>
          <Column id="upjangNm" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_searchSubValid" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="schMainUpjang" type="STRING" size="256"/>
          <Column id="schMainUpjangNm" type="STRING" size="256"/>
          <Column id="schStdDate" type="STRING" size="256"/>
          <Column id="schCashCode" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="schMainUpjang">title:본사[특약율 일괄복사],required:true,focus:edt_mainUpjang</Col>
            <Col id="schCashCode"/>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_saveSubValid" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="schMainUpjang" type="STRING" size="256"/>
          <Column id="schMainUpjangNm" type="STRING" size="256"/>
          <Column id="schStdDate" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="schMainUpjang">title:본사,required:true,focus:tpg.tpg2.edt_mainUpjang</Col>
            <Col id="schStdDate">title:기준일,required:true,date;true,focus:tpg.tpg2.cal_stdDate</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_listGroupValid" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="rowNum" type="STRING" size="256"/>
          <Column id="clsCd3" type="STRING" size="256"/>
          <Column id="clsNm3" type="STRING" size="256"/>
          <Column id="fmSaleRate" type="STRING" size="256"/>
          <Column id="fmNosaleRate" type="STRING" size="256"/>
          <Column id="upjang" type="STRING" size="256"/>
          <Column id="subinvCode" type="STRING" size="256"/>
          <Column id="sdate" type="STRING" size="256"/>
          <Column id="cashCode" type="STRING" size="256"/>
          <Column id="useYn" type="STRING" size="256"/>
          <Column id="clsLvl" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="clsCd3">title:중분류,required:true</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_listClassValid" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="rowNum" type="STRING" size="256"/>
          <Column id="clsCd4" type="STRING" size="256"/>
          <Column id="clsNm4" type="STRING" size="256"/>
          <Column id="fmSaleRate" type="STRING" size="256"/>
          <Column id="fmNosaleRate" type="STRING" size="256"/>
          <Column id="upjang" type="STRING" size="256"/>
          <Column id="subinvCode" type="STRING" size="256"/>
          <Column id="sdate" type="STRING" size="256"/>
          <Column id="cashCode" type="STRING" size="256"/>
          <Column id="useYn" type="STRING" size="256"/>
          <Column id="clsLvl" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="clsCd4">title:소분류,required:true</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_listItemValid" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="rowNum" type="STRING" size="256"/>
          <Column id="itemCode" type="STRING" size="256"/>
          <Column id="itemName" type="STRING" size="256"/>
          <Column id="itemSize" type="STRING" size="256"/>
          <Column id="fmSaleRate" type="STRING" size="256"/>
          <Column id="fmNosaleRate" type="STRING" size="256"/>
          <Column id="upjang" type="STRING" size="256"/>
          <Column id="subinvCode" type="STRING" size="256"/>
          <Column id="sdate" type="STRING" size="256"/>
          <Column id="cashCode" type="STRING" size="256"/>
          <Column id="useYn" type="STRING" size="256"/>
          <Column id="clsLvl" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="itemCode">title:자재코드,required:true</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_listGroupCopy" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="rowNum" type="STRING" size="256"/>
          <Column id="clsCd3" type="STRING" size="256"/>
          <Column id="clsNm3" type="STRING" size="256"/>
          <Column id="fmSaleRate" type="STRING" size="256"/>
          <Column id="fmNosaleRate" type="STRING" size="256"/>
          <Column id="upjang" type="STRING" size="256"/>
          <Column id="subinvCode" type="STRING" size="256"/>
          <Column id="sdate" type="STRING" size="256"/>
          <Column id="cashCode" type="STRING" size="256"/>
          <Column id="useYn" type="STRING" size="256"/>
          <Column id="clsLvl" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_listClassCopy" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="rowNum" type="STRING" size="256"/>
          <Column id="clsCd4" type="STRING" size="256"/>
          <Column id="clsNm4" type="STRING" size="256"/>
          <Column id="fmSaleRate" type="STRING" size="256"/>
          <Column id="fmNosaleRate" type="STRING" size="256"/>
          <Column id="upjang" type="STRING" size="256"/>
          <Column id="subinvCode" type="STRING" size="256"/>
          <Column id="sdate" type="STRING" size="256"/>
          <Column id="cashCode" type="STRING" size="256"/>
          <Column id="useYn" type="STRING" size="256"/>
          <Column id="clsLvl" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_listItemCopy" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="rowNum" type="STRING" size="256"/>
          <Column id="itemCode" type="STRING" size="256"/>
          <Column id="itemName" type="STRING" size="256"/>
          <Column id="itemSize" type="STRING" size="256"/>
          <Column id="fmSaleRate" type="STRING" size="256"/>
          <Column id="fmNosaleRate" type="STRING" size="256"/>
          <Column id="upjang" type="STRING" size="256"/>
          <Column id="subinvCode" type="STRING" size="256"/>
          <Column id="sdate" type="STRING" size="256"/>
          <Column id="cashCode" type="STRING" size="256"/>
          <Column id="useYn" type="STRING" size="256"/>
          <Column id="clsLvl" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_deleteItem" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="itemCode" type="STRING" size="256"/>
          <Column id="upjang" type="STRING" size="256"/>
          <Column id="subinvCode" type="STRING" size="256"/>
          <Column id="sdate" type="STRING" size="256"/>
          <Column id="cashCode" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Script type="xscript4.0"><![CDATA[/*
  화 면 명 : SpContFact
  파 일 명 : SpContFact.xfdl
  기    능 : 식재영업 / 기준관리 / 단가관리 / 특약사항

    수정일    수정자                  수정내용
  ----------   -------  --------------------------------------------------
  2015.03.13   최성연   최초 생성
  
  1) 추가 반영사항
  - 중분류 저장 시 소분류 및 자재별도 한꺼번에 저장 하도록 처리
  - 특약율 일괄복사 탭의 창고 리스트 : 구매 테이블 연계
  2) 화면 상단 공통 버튼 
  - 조회, 닫기, 도움말 버튼만 활성화 함
*/

/************************************************************************************************
 * 공통 라이브러리 INCLUDE 영역 (필수)
************************************************************************************************/
include "lib::lib_com.xjs";


/************************************************************************************************
 * FORM 변수 선언 영역 (필수)
************************************************************************************************/
var fv_objColInfo1;				//데이터셋 컬럼정보
var fv_objColInfo2;				//데이터셋 컬럼정보
var fv_objColInfo3;				//데이터셋 컬럼정보
var fv_sToday = gfn_today();
var fv_processCnt = 0;			//처리건수
var fv_groupCode = "FM0035";	//특약사항-현금성분류(FM0035)

var fv_excelFlag1 = false;		//엑셀업로드 후 갱신여부 CHECK : 중분류
var fv_excelFlag2 = false;		//엑셀업로드 후 갱신여부 CHECK : 소분류
var fv_excelFlag3 = false;		//엑셀업로드 후 갱신여부 CHECK : 자재코드


/************************************************************************************************
 * FORM EVENT 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : Form Load (필수)
 *---------------------------------------------------------------------------------------------*/
function form_onload(obj:Form, e:LoadEventInfo)
{	
	// Form Load 시 공통 기능 처리(obj:Form, bCreateEvent:이벤트 생성 여부)
	gfn_formOnLoad(this);
	
	// 초기값 셋팅
	fn_init();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 초기값 셋팅
 *---------------------------------------------------------------------------------------------*/
function fn_init()
{
	// 업데이트여부를 체크할 DataSet, 여러개 있을 경우 ;로 구분
	v_ds_check = "ds_listGroup;ds_listClass;ds_listItem";

	// 업장 COMP 권한 해제
	comp_upjangMain.isApplyAuth = false;
	comp_upjang.isApplyAuth = false;

	//조회조건을 초기화한다.[화면 상단]
	ds_search.clearData();
	var nRow= ds_search.addRow();
	ds_search.setColumn(nRow, "schMain", "");							// 본사
	ds_search.setColumn(nRow, "schUpjang", "");							// 업장
	ds_search.setColumn(nRow, "schSubinvCode", "");						// 창고
	ds_search.setColumn(nRow, "schSdate", fv_sToday);					// 기준일자
	ds_search.setColumn(nRow, "schCashCode", "");						// 현금성분류
	ds_search.setColumn(nRow, "schClassType", "");						// 중분류(S), 소분류구분(D) 
	
	
	// 기준일자 SET
	cal_sdate.fn_initMonthCal(this, "", "", ds_search, "schSdate", "Y");	
	
	// 현금성분류	
	SCCombo.bind(this, "ComCode", "cbo_cashCode", null, {groupCode:fv_groupCode, useYn:"Y", defVal:"001"}); //현금성분류(FM0035)
	
	
	//조회조건을 초기화한다.[특약율 일괄복사] 탭
	ds_searchSub.clearData();
	nRow= ds_searchSub.addRow();
	ds_searchSub.setColumn(nRow, "schMainUpjang", "");					// 본사(142008)
	ds_searchSub.setColumn(nRow, "schMainUpjangNm", "");				// 본사명(올바른식품)
	ds_searchSub.setColumn(nRow, "schStdDate", fv_sToday);				// 적용일자

	
	// 적용일자 SET
	tpg.tpg2.cal_stdDate.fn_initMonthCal(this, "", "", ds_searchSub, "schStdDate", "Y");	
	
	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 화면 닫기 전 변경 유무 체크 (필수-Frame에서 창 닫힐때 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_close()
{	
//	// v_ds_check 미사용시 변경사항 체크(입력 프로그램일때 변경되는 Dataset 전체 기술)
// 	if (gfn_dsIsUpdated(ds_list) == true) 
// 	{
// 		// 변경된 데이터가 있습니다. 현재 화면을 닫겠습니까?
//         if (!gfn_confirm("confirm.before.movepage")) return false;
//     }
//     
//	// 조회프로그램에도 Return true; 기술해 주세요!
// 	return true;

	// v_ds_check 사용시 변경사항 체크
	if(gfn_length(v_ds_check) == 0) 
	{	
		// v_ds_check 설정기준 변경사항 체크
		if (gfn_isDataChange() == true) 
		{		
			// 변경된 데이터가 있습니다. 현재 화면을 닫겠습니까?
			if (!gfn_confirm("confirm.before.movepage")) return false;
		}
	}
    
	// 조회프로그램에도 Return true; 기술해 주세요!
	return true;
}


/************************************************************************************************
 * 공통기능 FUNCTION 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 조회 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_search()
{
	// v_ds_check 미사용시 변경사항 체크
 	//if (gfn_isDataChange(v_ds_check) == true) 
 	//{
 	//	var retValue = gfn_confirm("confirm.before.search");	// 검색을 진행하면 변경된 데이터가 사라집니다. 계속 진행 하시겠습니까?
 	//	if (retValue == false) return;
 	//}

	// 조회시 Validation Check
	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;

	// 특약율 초기화
	tpg.tpg1.msk_clsRate.value = 0;


    // Grid sort 표시 초기화(필수)
    gfn_clearSortMark(tpg.tpg1.grd_listGroup);
    gfn_clearSortMark(tpg.tpg1.grd_listClass);
    gfn_clearSortMark(tpg.tpg1.grd_listItem);
    
    // DataSet초기화
	ds_listGroup.clearData();
	ds_listClass.clearData();
	ds_listItem.clearData();
    
   	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
	fv_objColInfo1 = gfn_getDatasetInfo (ds_listGroup);
	fv_objColInfo2 = gfn_getDatasetInfo (ds_listClass);
	fv_objColInfo3 = gfn_getDatasetInfo (ds_listItem);
    
    var strSvcID    = "search";
    var strURL      = "fm/fms/spContFact/selectList.xdo";
    var strInDs     = "ds_search=ds_search:A";
    var strOutDs    = "ds_listGroup=ds_listGroup ds_listClass=ds_listClass ds_listItem=ds_listItem";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 신규 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_insert()
{	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 삭제 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_delete()
{
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 저장 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_save()
{

}

/*----------------------------------------------------------------------------------------------
 * 설명      : 출력 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_print()
{
	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 도움말 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_help()
{
	
}

/************************************************************************************************
 * TRANSACTION 및 CallBack 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 트랜잭션 콜백 함수 (필수)
 *---------------------------------------------------------------------------------------------*/
function fn_callBack(strSvcID, nErrorCode, strErrorMsg)
{
	// 에러시 gfn_callBack에서 메시지 제공, 화면별 특정 에러 발생시에만 사용하세요.
	if (nErrorCode < 0) 
	{
		return;
	}
	
    switch(strSvcID)
    {
		// 업장에 대한 창고리스트 조회
        case "searchSubinv" :
            if (ds_subinv.getRowCount() == 0) {
				//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
				gfn_loadDatasetInfo (ds_subinv, fv_objColInfo1);
            }
            //fn_subinv_init();
            break;
    
		// 특약율관리탭 조회
        case "search" :
            //trace(ds_listGroup.saveXML());
            //trace(ds_listClass.saveXML());
            //trace(ds_listItem.saveXML());
            if (ds_listGroup.getRowCount() == 0) {
				//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
				gfn_loadDatasetInfo (ds_listGroup, fv_objColInfo1);
            }
            if (ds_listClass.getRowCount() == 0) {
				//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
				gfn_loadDatasetInfo (ds_listClass, fv_objColInfo2);
            }
            if (ds_listItem.getRowCount() == 0) {
				//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
				gfn_loadDatasetInfo (ds_listItem, fv_objColInfo3);
            }
			// 엑셀업로드 FLAG SET
			fv_excelFlag1 = false;
			fv_excelFlag2 = false;
			fv_excelFlag3 = false;
            break;
        
        // 특약율관리탭 중분류 저장
        case "saveGroup" :
			gfn_alert("msg.save.success");	// 저장 되었습니다.
			// 저장 후 재조회
			fn_searchGroup();
			// 저장 후 기준일 LIST 
			fn_searchDate();
			// 엑셀업로드 FLAG SET
			fv_excelFlag1 = false;
            break;    

		// 특약율관리탭 중분류 조회
        case "searchGroup" :
            if (ds_listGroup.getRowCount() == 0) {
				//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
				gfn_loadDatasetInfo (ds_listGroup, fv_objColInfo1);
            }
			// 엑셀업로드 FLAG SET
			fv_excelFlag1 = false;
            break;

        // 특약율관리탭 소분류 저장
        case "saveClass" :
			gfn_alert("msg.save.success");	// 저장 되었습니다.
			// 저장 후 재조회
			fn_searchClass();
			// 저장 후 기준일 LIST 
			fn_searchDate();
			// 엑셀업로드 FLAG SET
			fv_excelFlag2 = false;
            break;    


		// 특약율관리탭 소분류 조회
        case "searchClass" :
            if (ds_listClass.getRowCount() == 0) {
				//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
				gfn_loadDatasetInfo (ds_listClass, fv_objColInfo2);
            }
			// 엑셀업로드 FLAG SET
			fv_excelFlag2 = false;
            break;


        // 특약율관리탭 자재별 저장
        case "saveItem" :
        
			gfn_alert("msg.save.success");	// 저장 되었습니다.
			// 저장 후 재조회
			fn_searchItem();
			// 저장 후 기준일 LIST 
			fn_searchDate();
			// 엑셀업로드 FLAG SET
			fv_excelFlag3 = false;
            break;    


        // 특약율관리탭 자재별 삭제
        case "deleteItem2" :

			gfn_alert("msg.delete.success");	// 삭제 되었습니다.
			// 삭제 후 재조회
			fn_searchItem();
			// 삭제 후 기준일 LIST 
			fn_searchDate();
			// 엑셀업로드 FLAG SET
			fv_excelFlag3 = false;
            break;


		// 특약율관리탭 자재별 조회(저장된 자료만 조회)
        case "searchItem" :
            if (ds_listItem.getRowCount() == 0) {
				//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
				gfn_loadDatasetInfo (ds_listItem, fv_objColInfo3);
            }
			// 엑셀업로드 FLAG SET
			fv_excelFlag3 = false;
            break;


		// 특약율관리탭 자재별 조회
        case "searchItem2" :
            if (ds_listItem.getRowCount() == 0) {
				//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
				gfn_loadDatasetInfo (ds_listItem, fv_objColInfo3);
            }
			// 엑셀업로드 FLAG SET
			fv_excelFlag3 = false;
            break;


		// 기준일자 조회
        case "searchDate" :
            if (ds_sdate.getRowCount() == 0) {
				//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
				gfn_loadDatasetInfo (ds_sdate, fv_objColInfo);
            }
            break;


		// 특약율일괄복사탭 조회
        case "searchSub" :
            if (ds_listSub.getRowCount() == 0) {
				//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
				gfn_loadDatasetInfo (ds_listSub, fv_objColInfo1);
            }
            break;


        // 특약율정보 COUNT 조회
        case "searchSubCnt" :
			//trace("처리건수 : " + fv_processCnt);
			// 성공 시 저장, 실패시 오류메시지
			if (fv_processCnt > 0) {
				fn_saveSubProc();	// 일괄복사 처리
			} else {
				var sMsg = "선택한 조건에 대한 특약율 정보가 존재하지 않습니다.\n\n";
				sMsg = sMsg + "-. 기준업장 : " + ds_search.getColumn(ds_search.rowposition, "schUpjangNm") + "\n";
				sMsg = sMsg + "-. 기준창고 : " + cbo_subinvCode.text + "\n";
				sMsg = sMsg + "-. 현금성분류 : " + cbo_cashCode.text + "\n";
				sMsg = sMsg + "-. 기준일자 : " + gfn_getFormat(ds_search.getColumn(ds_search.rowposition, "schSdate"), "@@@@-@@-@@");
				gfn_message("A", sMsg);
			}
            break;   

        // 특약율관리탭 일괄복사
        case "saveSub" :
			gfn_alert("msg.save.success");	// 저장 되었습니다.
			// 저장 후 재조회
			fn_searchSub();
            break;    

		// 전체 저장 : 중분류, 소분류, 자재별
		case "saveList" :
			gfn_alert("msg.save.success");	// 저장 되었습니다.
			// 저장 후 재조회
			fn_search();
            break;    
			
    }
}


/************************************************************************************************
 * 사용자 FUNCTION 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : Progress Bar 초기화
 *---------------------------------------------------------------------------------------------*/
function fn_processInit(flag)
{
	if (flag=="0") {
		div_excel.visible = true;
	} else {
		div_excel.visible = false;
	}
	this.updateWindow(); // 이 부분 추가
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 업장선택 팝업 이전 본사업장 코드 SET
 *---------------------------------------------------------------------------------------------*/
function fn_beforeSet(o, c) {
	c.setMainUpjang(comp_upjangMain.getUpjangCode());
	return true;
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 업장선택 팝업 호출 이후 창고 COMBO LIST SET
 *---------------------------------------------------------------------------------------------*/
function fn_upjangSet()
{
	var nRow= ds_search.rowposition;
	// 창고 DataSet 초기화
	ds_subinv.clearData();
	//  창고 조건 초기화
	ds_search.setColumn(nRow, "schSubinvCode", "");
	
	// 기준일자 초기화
	//ds_sdate.clearData();
	
	// 선택한 업장에 창고정보 SET
	var schUpjang = ds_search.getColumn(nRow, "schUpjang");

	if(schUpjang!="") {
		fn_searchSubinv();
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 업장에 대한 창고리스트 가져오기
 *---------------------------------------------------------------------------------------------*/
function fn_searchSubinv()
{
   	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
	fv_objColInfo1 = gfn_getDatasetInfo (ds_subinv);
    
    var strSvcID    = "searchSubinv";
    var strURL      = "fm/fms/spContFact/selectSubinv.xdo";
    var strInDs     = "ds_search=ds_search:A";
    var strOutDs    = "ds_subinv=ds_subinv";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 창고 COMBO 초기화 
 *---------------------------------------------------------------------------------------------*/
function fn_subinv_init()
{
	var defVal = "";
	// COMBO 에 첫번째 Row에 기본값을 SET
	if (ds_subinv.getRowCount() > 0) {
		defVal = ds_subinv.getColumn(0, "subinvCode");
		fn_searchDate();
	}
	cbo_subinvCode.value = defVal;
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 중분류, 소분류, 자재별 항목에 대한 과세율/면세율을 일괄 적용한다.
 *---------------------------------------------------------------------------------------------*/
function fn_inputRate()
{
	var nRowCnt1 = ds_listGroup.getRowCount();	// 중뷴류 DataSet Count
	var nRowCnt2 = ds_listClass.getRowCount();	// 소분류 DataSet Count
	var nRowCnt3 = ds_listItem.getRowCount();	// 자재 DataSet Count
	var v_clsRate = tpg.tpg1.msk_clsRate.value;		// 적용할 판매율

	if (nRowCnt1 < 1 && nRowCnt2 < 1 && nRowCnt3 < 1) return;


	// 조회시 Validation Check : 기본조건  Check
	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;


	if (v_clsRate.valueOf() == "undefined" || v_clsRate == "") v_clsRate = 0;
	
	var sMsg = "선택한 특약율을 일괄 적용합니다.\n계속 진행 하시겠습니까?";
	
	
	if (!gfn_confirm(sMsg, "", "C")) return;
	
	for (var i = 0 ; i < nRowCnt1 ; i++)
	{
		ds_listGroup.setColumn(i, "fmSaleRate", v_clsRate);		// 과세율에 적용
		ds_listGroup.setColumn(i, "fmNosaleRate", v_clsRate);	// 면세율에 적용
	}
	for (var i = 0 ; i < nRowCnt2 ; i++)
	{
		ds_listClass.setColumn(i, "fmSaleRate", v_clsRate);		// 과세율에 적용
		ds_listClass.setColumn(i, "fmNosaleRate", v_clsRate);	// 면세율에 적용
	}
	for (var i = 0 ; i < nRowCnt3 ; i++)
	{
		ds_listItem.setColumn(i, "fmSaleRate", v_clsRate);		// 과세율에 적용
		ds_listItem.setColumn(i, "fmNosaleRate", v_clsRate);	// 면세율에 적용
	}

	gfn_alert("msg.action.success");	// 처리 되었습니다.
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 중분류 목록에 대한 엑셀 업로드 
 * 주) 연동 시 SQL 항목 순서와 Dataset 순서를 동일하게 해야 함
 *---------------------------------------------------------------------------------------------*/
function fn_groupUpload()
{
// 	var nRowCnt = ds_listGroup.getRowCount();	// DataSet Count
// 	
// 	// 중분류목록 여부 CHECK
// 	if(nRowCnt < 1) 
// 	{
// 		gfn_alert("msg.err.grid.noselect", "선택한 row");	// 선택된 항목이 없습니다.
// 		return;
// 	}

	// 조회시 Validation Check : 기본조건  Check
	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;


	this.setWaitCursor(true);

	// 파일 선택
	var strFileName = gfn_excelFileDialog("LOAD", "EXCEL");

	if (strFileName.length == 0)
	{
		this.setWaitCursor(false);
		return;
	}

	/*********************************************************************************************
	** argument             : strFileName		파일명 (경로 포함)
	**                        strDsName			Import 대상 Dataset Name
	**                        nStartRow			Import 시작 행(사용된 Range 기준, 1 base)
	**						  bKeepColInfo		Dataset의 컬럼 정보를 유지할지 여부
	*********************************************************************************************/
	
	var rtn = gfn_importExcel(strFileName, "ds_listGroup", 2, true);


	if (ds_listGroup.getRowCount()>0) {
		// 엑셀업로드 FLAG SET
		fv_excelFlag1 = true;

		// 엑셀 업로드 후에 Rowtype 속성 변경
		ds_listGroup.updatecontrol = false;
		for(var i=0; i<ds_listGroup.rowcount; i++)
		{	
			ds_listGroup.setRowType(i, Dataset.ROWTYPE_INSERT);
		}
		ds_listGroup.updatecontrol = true;
		gfn_alert("msg.action.success");	// 처리 되었습니다.
	}

	this.setWaitCursor(false);
	
	//trace(ds_listGroup.saveXML());
}

/*----------------------------------------------------------------------------------------------
 * 설명      :중분류 그리드 저장 버튼 클릭 시 
 * 전체(중분류, 소분류, 자재별) 한꺼번에 저장 처리
 *---------------------------------------------------------------------------------------------*/
function fn_saveProc()
{
	var sMsg = "";
	var b_group = true;
	var b_class = true;
	var b_item = true;
	
	// 조회시 Validation Check : 저장 시 Check
	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;


	// 중분류 자료 여부 CHECK 
	var nRowCnt1 = ds_listGroup.getRowCount();	// DataSet Count
	if(nRowCnt1 == 0) 
	{
		sMsg = "중분류 정보가 없습니다.";
		gfn_alert(sMsg, "", "A");
		return;
	}
	
	 // v_ds_check 미사용시 변경사항 체크 : 엑셀업로드 시에는 CHECK X
 	if (gfn_dsIsUpdated(ds_listGroup) == false && fv_excelFlag1 == false)
 	{
		b_group = false; 	
 	}
	
	// 저장시 Validation Check : 중분류코드
	if (fv_excelFlag1==false) {	
		if (gfn_validCheck(ds_listGroup, ds_listGroupValid, true) == false) return;
	}

	// 소분류 저장 여부 CHECK
	var nRowCnt2 = ds_listClass.getRowCount();	// DataSet Count
	if(nRowCnt2 == 0) 
	{
		b_class = false;
	}
	
	// 변경내역 여부 CHECK
 	if (gfn_dsIsUpdated(ds_listClass) == false) 
 	{
		b_class = false;
 	}	
	
	// 저장시 Validation Check : 소분류코드
 	if (b_class == true && fv_excelFlag2 == false) {
		if (gfn_validCheck(ds_listClass, ds_listClassValid, true) == false) return;
	}

	// 자재별 저장 여부 CHECK
	var nRowCnt3 = ds_listItem.getRowCount();	// DataSet Count
	if(nRowCnt3 == 0) 
	{
		b_item = false;
	}
	// 변경내역 여부 CHECK
 	if (gfn_dsIsUpdated(ds_listItem) == false) 
 	{
		b_item = false;
 	}
 	//if (b_item == true) {
		// 저장시 Validation Check : 자재별 : 시간이 너무 많이 소요됨, 자재코드 필수 입력 CHECK
		//if (gfn_validCheck(ds_listItem, ds_listItemValid, true) == false) return;
	//}
	
	// 중분류, 소분류, 자재코드 변경내역 CHECK
	if (b_group == false && b_class == false && b_item == false) {
 		gfn_alert("msg.save.nochange");	// 변경된 내역이 없습니다.
 		return;
	}
	
	// 엑셀 업로드시에 기본적인 CHECK : 중분류, 소분류, 자재코드
	if (fv_excelFlag1 == true || fv_excelFlag2 == true || fv_excelFlag3 == true) {
		sMsg = "엑셀 업로드 시 자료에 대한 중복여부 및 필수입력 사항을 체크합니다.\n\n";
	    sMsg = sMsg + "계속 진행 하시겠습니까?\n\n";
		if (!gfn_confirm(sMsg, "", "C")) return;
		// Alert 창 호출
		fn_processInit("0");

		// 중분류 CHECK
		if (fv_excelFlag1 == true) {
			if( !fn_saveGroupChk() ) 
			{
				fn_processInit("1");
				return;
			} 
		}

		// 소분류 CHECK
		if (b_class==true && fv_excelFlag2 == true) {
			if( !fn_saveClassChk() ) 
			{
				fn_processInit("1");
				return;
			} 
		} 
		
		// 자재별 CHECK
		if (b_item==true && fv_excelFlag3 == true) {
			if( !fn_saveItemChk() ) 
			{
				fn_processInit("1");
				return;
			} 
		} 
		

		// Alert 창 닫기
		fn_processInit("1");
	}	

	// 전체 저장
	sMsg = "특약율을 저장합니다.\n계속 진행 하시겠습니까?\n\n";
	if (b_item==true) {
		sMsg = sMsg + " ※ 자재별 저장 시 작업시간이 오래 걸립니다.";
	}
		
	if (!gfn_confirm(sMsg, "", "C")) return;


	// 저장 시 조건(KEY)을 ds_listGroup의 KEY 값으로 복사
	var nRow= ds_search.rowposition;
	// 중분류 리스트
	for (var i = 0 ; i < nRowCnt1 ; i++)
	{
		ds_listGroup.setColumn(i, "upjang", ds_search.getColumn(nRow, "schUpjang"));		
		ds_listGroup.setColumn(i, "subinvCode", ds_search.getColumn(nRow, "schSubinvCode"));	
		ds_listGroup.setColumn(i, "sdate", ds_search.getColumn(nRow, "schSdate"));	
		ds_listGroup.setColumn(i, "cashCode", ds_search.getColumn(nRow, "schCashCode"));	
	}
	// 소분류 리스트
	for (var i = 0 ; i < nRowCnt2 ; i++)
	{
		ds_listClass.setColumn(i, "upjang", ds_search.getColumn(nRow, "schUpjang"));		
		ds_listClass.setColumn(i, "subinvCode", ds_search.getColumn(nRow, "schSubinvCode"));	
		ds_listClass.setColumn(i, "sdate", ds_search.getColumn(nRow, "schSdate"));	
		ds_listClass.setColumn(i, "cashCode", ds_search.getColumn(nRow, "schCashCode"));	
	}
	// 자재별 리스트
	for (var i = 0 ; i < nRowCnt3 ; i++)
	{
		ds_listItem.setColumn(i, "upjang", ds_search.getColumn(nRow, "schUpjang"));		
		ds_listItem.setColumn(i, "subinvCode", ds_search.getColumn(nRow, "schSubinvCode"));	
		ds_listItem.setColumn(i, "sdate", ds_search.getColumn(nRow, "schSdate"));	
		ds_listItem.setColumn(i, "cashCode", ds_search.getColumn(nRow, "schCashCode"));	
	}

	trace("b_class : " + b_class);
	trace("b_item : " + b_item);

	//return;

	// Service ID 정의
	var v_sid = "";
	var v_inDs = "";
	if (b_class==true && b_item==true)	{
		v_sid = "saveList1";
		v_inDs = "ds_listGroup=ds_listGroup:A ds_listClass=ds_listClass:A ds_listItem=ds_listItem:A";
	}
	else if (b_class==true) {
		v_sid = "saveList2";
		v_inDs = "ds_listGroup=ds_listGroup:A ds_listClass=ds_listClass:A";
	}
	else if (b_item==true) {
		v_sid = "saveList3";
		v_inDs = "ds_listGroup=ds_listGroup:A ds_listItem=ds_listItem:A";
	}
	else {
		v_sid = "saveGroup";
		v_inDs = "ds_listGroup=ds_listGroup:A";
	}

	// 저장 Transaction
    var strSvcID    = "saveList";
    var strURL      = "fm/fms/spContFact/"+v_sid+".xdo";
	var strInDs     = v_inDs;
    var strOutDs    = "";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}


/*----------------------------------------------------------------------------------------------
 * 설명      :중분류 그리드 저장 버튼 클릭 시 
 * 저장 시 변경된 Dataset 이 아닌 전체를 기준으로 저장함
 *---------------------------------------------------------------------------------------------*/
function fn_saveGroup()
{
	var nRowCnt = ds_listGroup.getRowCount();	// DataSet Count
	
	// 저장할 자료 여부 CHECK
	if(nRowCnt == 0) 
	{
		gfn_alert("msg.save.nodata", "저장할 데이터");	// 저장할 데이터가 없습니다.
		return;
	}


	// 변경내역 여부 CHECK
 	if (gfn_dsIsUpdated(ds_listGroup) == false) 
 	{
 		gfn_alert("msg.save.nochange");	// 변경된 내역이 없습니다.
 		return;
 	}

	// 조회시 Validation Check : 저장 시 Check
	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;
	
	var sMsg = "중분류에 대한 특약율을 저장합니다.\n계속 진행 하시겠습니까?";
	if (!gfn_confirm(sMsg, "", "C")) return;
	
	// 저장 시 조건(KEY)을 ds_listGroup의 KEY 값으로 복사
	var nRow= ds_search.rowposition;
	//trace(ds_search.getColumn(nRow, "schUpjang"));
	//trace(ds_search.getColumn(nRow, "schSubinvCode"));
	//trace(ds_search.getColumn(nRow, "schSdate"));

	for (var i = 0 ; i < nRowCnt ; i++)
	{
		ds_listGroup.setColumn(i, "upjang", ds_search.getColumn(nRow, "schUpjang"));		
		ds_listGroup.setColumn(i, "subinvCode", ds_search.getColumn(nRow, "schSubinvCode"));	
		ds_listGroup.setColumn(i, "sdate", ds_search.getColumn(nRow, "schSdate"));	
		ds_listGroup.setColumn(i, "cashCode", ds_search.getColumn(nRow, "schCashCode"));	
	}

	//trace(ds_listGroup.saveXML());

    var strSvcID    = "saveGroup";
    var strURL      = "fm/fms/spContFact/saveGroup.xdo";
	var strInDs     = "ds_listGroup=ds_listGroup:A";
    var strOutDs    = "";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);

}

/*----------------------------------------------------------------------------------------------
 * 설명      : 중분류 저장 후 조회 시 
 *---------------------------------------------------------------------------------------------*/
function fn_searchGroup()
{
	// 조회시 Validation Check
	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;

    // Grid sort 표시 초기화(필수)
    gfn_clearSortMark(tpg.tpg1.grd_listGroup);
    
   	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
	fv_objColInfo1 = gfn_getDatasetInfo (ds_listGroup);
    
    var strSvcID    = "searchGroup";
    var strURL      = "fm/fms/spContFact/selectGroup.xdo";
    var strInDs     = "ds_search=ds_search:A";
    var strOutDs    = "ds_listGroup=ds_listGroup";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 소분류 목록에 대한 엑셀 업로드 
 * 주) 연동 시 SQL 항목 순서와 Dataset 순서를 동일하게 해야 함
 *---------------------------------------------------------------------------------------------*/
function fn_classUpload()
{
// 	var nRowCnt = ds_listClass.getRowCount();	// DataSet Count
// 	
// 	// 소분류목록 여부 CHECK
// 	if(nRowCnt < 1) 
// 	{
// 		gfn_alert("msg.err.grid.noselect", "선택한 row");	// 선택된 항목이 없습니다.
// 		return;
// 	}

	// 조회시 Validation Check : 기본조건  Check
	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;


	this.setWaitCursor(true);

	// 파일 선택
	var strFileName = gfn_excelFileDialog("LOAD", "EXCEL");

	if (strFileName.length == 0)
	{
		this.setWaitCursor(false);
		return;
	}

	/*********************************************************************************************
	** argument             : strFileName		파일명 (경로 포함)
	**                        strDsName			Import 대상 Dataset Name
	**                        nStartRow			Import 시작 행(사용된 Range 기준, 1 base)
	**						  bKeepColInfo		Dataset의 컬럼 정보를 유지할지 여부
	*********************************************************************************************/
	
	var rtn = gfn_importExcel(strFileName, "ds_listClass", 2, true);

	if (ds_listClass.getRowCount()>0) {
		// 엑셀업로드 FLAG SET
		fv_excelFlag2 = true;
		// 엑셀 업로드 후에 Rowtype 속성 변경
		ds_listClass.updatecontrol = false;
		for(var i=0; i<ds_listClass.rowcount; i++)
		{	
			ds_listClass.setRowType(i, Dataset.ROWTYPE_INSERT);
		}
		ds_listClass.updatecontrol = true;
		gfn_alert("msg.action.success");	// 처리 되었습니다.
	}

	this.setWaitCursor(false);
	
	//trace(ds_listClass.saveXML());
}



/*----------------------------------------------------------------------------------------------
 * 설명      : 소분류 그리드 저장 버튼 클릭 시 
 * 저장 시 변경된 Dataset 이 아닌 전체를 기준으로 저장함
 *---------------------------------------------------------------------------------------------*/
function fn_saveClass()
{
	var nRowCnt = ds_listClass.getRowCount();	// DataSet Count
	
	// 저장할 자료 여부 CHECK
	if(nRowCnt == 0) 
	{
		gfn_alert("msg.save.nodata", "저장할 데이터");	// 저장할 데이터가 없습니다.
		return;
	}

	// 변경내역 여부 CHECK
 	if (gfn_dsIsUpdated(ds_listClass) == false) 
 	{
 		gfn_alert("msg.save.nochange");	// 변경된 내역이 없습니다.
 		return;
 	}

	// 조회시 Validation Check : 저장 시 Check
	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;
	
	// 저장시 Validation Check : 소분류코드
	if (fv_excelFlag2 == false) {
		if (gfn_validCheck(ds_listClass, ds_listClassValid, true) == false) return;
	}	
	
	// 엑셀 업로드 시 소분류 CHECK
	if (fv_excelFlag2 == true) {
		sMsg = "엑셀 업로드 시 중분류에 대한 중복여부 및 필수입력 사항을 체크합니다.\n\n";
	    sMsg = sMsg + "계속 진행 하시겠습니까?\n\n";
		if (!gfn_confirm(sMsg, "", "C")) return;

		fn_processInit("0");

		// 저장 시 Validation Check : 중복 CHECK	
		if( !fn_saveClassChk() ) 
		{
			fn_processInit("1");
			return;
		} 
		fn_processInit("1");
	}	
	
	
	
	var sMsg = "소분류에 대한 특약율을 저장합니다.\n계속 진행 하시겠습니까?";
	if (!gfn_confirm(sMsg, "", "C")) return;
	
	// 저장 시 조건(KEY)을 ds_listClass의 KEY 값으로 복사
	var nRow= ds_search.rowposition;
	//trace(ds_search.getColumn(nRow, "schUpjang"));
	//trace(ds_search.getColumn(nRow, "schSubinvCode"));
	//trace(ds_search.getColumn(nRow, "schSdate"));

	for (var i = 0 ; i < nRowCnt ; i++)
	{
		ds_listClass.setColumn(i, "upjang", ds_search.getColumn(nRow, "schUpjang"));		
		ds_listClass.setColumn(i, "subinvCode", ds_search.getColumn(nRow, "schSubinvCode"));	
		ds_listClass.setColumn(i, "sdate", ds_search.getColumn(nRow, "schSdate"));	
		ds_listClass.setColumn(i, "cashCode", ds_search.getColumn(nRow, "schCashCode"));	
	}

	//trace(ds_listClass.saveXML());

    var strSvcID    = "saveClass";
    var strURL      = "fm/fms/spContFact/saveClass.xdo";
	var strInDs     = "ds_listClass=ds_listClass:A";
    var strOutDs    = "";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);

}


/*----------------------------------------------------------------------------------------------
 * 설명      : 소분류 저장 후 조회 시 
 *---------------------------------------------------------------------------------------------*/
function fn_searchClass()
{
	// 조회시 Validation Check
	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;

    // Grid sort 표시 초기화(필수)
    gfn_clearSortMark(tpg.tpg1.grd_listClass);
    
   	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
	fv_objColInfo2 = gfn_getDatasetInfo (ds_listClass);
    
    var strSvcID    = "searchClass";
    var strURL      = "fm/fms/spContFact/selectClass.xdo";
    var strInDs     = "ds_search=ds_search:A";
    var strOutDs    = "ds_listClass=ds_listClass";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 자재별 목록에 대한 엑셀 업로드 
 * 주) 연동 시 SQL 항목 순서와 Dataset 순서를 동일하게 해야 함
 *---------------------------------------------------------------------------------------------*/
function fn_itemUpload()
{
// 	var nRowCnt = ds_listItem.getRowCount();	// DataSet Count
// 	
// 	// 자재별목록 여부 CHECK
// 	if(nRowCnt < 1) 
// 	{
// 		gfn_alert("msg.err.grid.noselect", "선택한 row");	// 선택된 항목이 없습니다.
// 		return;
// 	}
	// 조회시 Validation Check : 기본조건  Check
	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;

	this.setWaitCursor(true);

	// 파일 선택
	var strFileName = gfn_excelFileDialog("LOAD", "EXCEL");

	if (strFileName.length == 0)
	{
		this.setWaitCursor(false);
		return;
	}

	/*********************************************************************************************
	** argument             : strFileName		파일명 (경로 포함)
	**                        strDsName			Import 대상 Dataset Name
	**                        nStartRow			Import 시작 행(사용된 Range 기준, 1 base)
	**						  bKeepColInfo		Dataset의 컬럼 정보를 유지할지 여부
	*********************************************************************************************/
	
	var rtn = gfn_importExcel(strFileName, "ds_listItem", 2, true);

	if (ds_listItem.getRowCount()>0) {
		// 엑셀업로드 FLAG SET
		fv_excelFlag3 = true;
		// 엑셀 업로드 후에 Rowtype 속성 변경
		ds_listItem.updatecontrol = false;
		for(var i=0; i<ds_listItem.rowcount; i++)
		{	
			ds_listItem.setRowType(i, Dataset.ROWTYPE_INSERT);
		}
		ds_listItem.updatecontrol = true;
		gfn_alert("msg.action.success");	// 처리 되었습니다.
	}


	this.setWaitCursor(false);
	
	//trace(ds_listItem.saveXML());
	
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 자재별 그리드 저장 버튼 클릭 시 
 * 저장 시 변경된 Dataset 이 아닌 전체를 기준으로 저장함
 *---------------------------------------------------------------------------------------------*/
function fn_saveItem()
{
	var nRowCnt = ds_listItem.getRowCount();	// DataSet Count
	
	// 저장할 자료 여부 CHECK
	if(nRowCnt == 0) 
	{
		gfn_alert("msg.save.nodata", "저장할 데이터");	// 저장할 데이터가 없습니다.
		return;
	}

	// 변경내역 여부 CHECK
 	if (gfn_dsIsUpdated(ds_listItem) == false) 
 	{
 		gfn_alert("msg.save.nochange");	// 변경된 내역이 없습니다.
 		return;
 	}

	// 조회시 Validation Check : 저장 시 Check
	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;
	
	// 저장시 Validation Check : 자재별 : 시간이 너무 많이 소요됨, 자재코드 필수 입력 CHECK
	//if (gfn_validCheck(ds_listItem, ds_listItemValid, true) == false) return;
	
	// 엑셀 업로드 시 자재코드 CHECK
	if (fv_excelFlag3 == true) {
		sMsg = "엑셀 업로드 시 자재코드에 대한 중복여부 및 필수입력 사항을 체크합니다.\n\n";
	    sMsg = sMsg + "계속 진행 하시겠습니까?\n\n";
		if (!gfn_confirm(sMsg, "", "C")) return;

		fn_processInit("0");

		// 저장 시 Validation Check : 중복 CHECK	
		if( !fn_saveItemChk() ) 
		{
			fn_processInit("1");
			return;
		} 
		fn_processInit("1");
	}	
	
	
	
	var sMsg = "자재에 대한 특약율을 저장합니다.\n계속 진행 하시겠습니까?";
	if (!gfn_confirm(sMsg, "", "C")) return;
	
	// 저장 시 조건(KEY)을 ds_listItem의 KEY 값으로 복사
	var nRow= ds_search.rowposition;
	//trace(ds_search.getColumn(nRow, "schUpjang"));
	//trace(ds_search.getColumn(nRow, "schSubinvCode"));
	//trace(ds_search.getColumn(nRow, "schSdate"));

	for (var i = 0 ; i < nRowCnt ; i++)
	{
		if (gfn_transNullToEmpty(ds_listItem.getColumn(i, "itemCode"))=="") ds_listItem.setColumn(i, "itemCode", "");
		ds_listItem.setColumn(i, "upjang", ds_search.getColumn(nRow, "schUpjang"));		
		ds_listItem.setColumn(i, "subinvCode", ds_search.getColumn(nRow, "schSubinvCode"));	
		ds_listItem.setColumn(i, "sdate", ds_search.getColumn(nRow, "schSdate"));	
		ds_listItem.setColumn(i, "cashCode", ds_search.getColumn(nRow, "schCashCode"));	
		//ds_listItem.setColumn(i, "fmSaleRate", gfn_nvl(ds_search.getColumn(nRow, "fmSaleRate"), "0"));
		//ds_listItem.setColumn(i, "fmNosaleRate", gfn_nvl(ds_search.getColumn(nRow, "fmNosaleRate"), "0"));	
	}

    var strSvcID    = "saveItem";
    var strURL      = "fm/fms/spContFact/saveItem.xdo";
	var strInDs     = "ds_listItem=ds_listItem:A";
    var strOutDs    = "";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);

}

/*----------------------------------------------------------------------------------------------
 * 설명      : 자재별 저장 후 조회 시 
 *---------------------------------------------------------------------------------------------*/
function fn_searchItem()
{
	// 조회시 Validation Check
	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;

    // Grid sort 표시 초기화(필수)
    gfn_clearSortMark(tpg.tpg1.grd_listItem);
    
   	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
	fv_objColInfo3 = gfn_getDatasetInfo (ds_listItem);
    
    var strSvcID    = "searchItem";
    var strURL      = "fm/fms/spContFact/selectItem.xdo";
    var strInDs     = "ds_search=ds_search:A";
    var strOutDs    = "ds_listItem=ds_listItem";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}



/*----------------------------------------------------------------------------------------------
 * 설명      : 기준일자 LIST 를 불러온다 (업장, 창고) 
 *---------------------------------------------------------------------------------------------*/
function fn_searchDate()
{
	// 기준일자 조회시 Validation Check
	if (gfn_validCheck(ds_search, ds_sdateValid, true) == false) return;
	
   	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
	fv_objColInfo = gfn_getDatasetInfo (ds_sdate);

    var strSvcID    = "searchDate";
    var strURL      = "fm/fms/spContFact/selectDateList.xdo";
    var strInDs     = "ds_search=ds_search:A";
    var strOutDs    = "ds_sdate=ds_sdate";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 기준일자 LIST에서 해당 일자를 선택 시 기준일자에 SET
 *---------------------------------------------------------------------------------------------*/
function fn_setDate()
{
	var nRow = ds_search.rowposition;
	var vDate = "";
	if (cbo_sdate.index!=-1) vDate = cbo_sdate.value;
	
	if(nRow == -1) return;
	if(vDate == "") return;
	
	// 조건에 기준일자 SET
	ds_search.setColumn(ds_search.rowposition, "schSdate", vDate);	// 기준일자 SET
}


/*----------------------------------------------------------------------------------------------
 * 설명      : [특약율일괄복사] 탭 조회 버튼 클릭 시 
 *---------------------------------------------------------------------------------------------*/
function fn_searchSub()
{
	// 조회시 Validation Check : 상단 조회조건
	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;

	// 탭 조회시 Validation Check
	if (gfn_validCheck(ds_searchSub, ds_searchSubValid, true) == false) return;

	// 창고리스트 조회 시 현금성분류 조건 항목 CHECK
	var nRow= ds_search.rowposition;
	ds_searchSub.setColumn(ds_searchSub.rowposition, "schCashCode", ds_search.getColumn(nRow, "schCashCode"));			// 상단_현금성분류
	ds_searchSub.setColumn(ds_searchSub.rowposition, "schSubinvCode", ds_search.getColumn(nRow, "schSubinvCode"));		// 상단_창고

    // Grid sort 표시 초기화(필수)
    gfn_clearSortMark(tpg.tpg2.grd_listSub);
    
   	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
	fv_objColInfo1 = gfn_getDatasetInfo (ds_listSub);
    
    var strSvcID    = "searchSub";
    var strURL      = "fm/fms/spContFact/selectSub.xdo";
    var strInDs     = "ds_searchSub=ds_searchSub:A";
    var strOutDs    = "ds_listSub=ds_listSub";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : [특약율일괄복사]탭 그리드 저장 버튼 클릭 시 
 *---------------------------------------------------------------------------------------------*/
function fn_saveSub()
{
	var nRowCnt = ds_listSub.getRowCount();	// DataSet Count
	
	// 저장할 자료 여부 CHECK
	if(nRowCnt == 0) 
	{
		gfn_alert("msg.save.nodata", "저장할 데이터");	// 저장할 데이터가 없습니다.
		return;
	}

	// 선택여부 CHECK 여부
	var nChk = 0;
	for (var i = 0 ; i < nRowCnt ; i++)
	{
		if (ds_listSub.getColumn(i, "chk") == "1") nChk += 1;
	}
	if(nChk == 0)
	{
		gfn_alert("msg.err.grid.noselect", "선택된 항목");	// 선택된 항목이 없습니다.
		return;
	}

	// 저장시 상단 Validation Check : 업장, 창고, 현금성분류 필수 CHECK
	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;	
	
	// 저장 시 [탭] 본사 및 적용일자 CHECK
	if (gfn_validCheck(ds_searchSub, ds_saveSubValid, true) == false) return;
	
	
	var sMsg = "선택한 창고에 대한 특약율을 일괄 복사합니다.\n계속 진행 하시겠습니까?\n";
	    sMsg = sMsg + "-. 기준업장 : " + ds_search.getColumn(nRow, "schUpjangNm") + "\n";
	    sMsg = sMsg + "-. 기준창고 : " + cbo_subinvCode.text + "\n";
	    sMsg = sMsg + "-. 현금성분류 : " + cbo_cashCode.text + "\n";
	    sMsg = sMsg + "-. 적용일자 : " + gfn_getFormat(tpg.tpg2.cal_stdDate.text, "@@@@-@@-@@");
	if (!gfn_confirm(sMsg, "", "C")) return;
	
	// 특약율 정보 여부 CHECK를 위한 조건 dataset SET
	var nRow= ds_search.rowposition;
	ds_searchSub.setColumn(ds_searchSub.rowposition, "schUpjang", ds_search.getColumn(nRow, "schUpjang"));				// 상단_업장
	ds_searchSub.setColumn(ds_searchSub.rowposition, "schSubinvCode", ds_search.getColumn(nRow, "schSubinvCode"));		// 상단_창고
	ds_searchSub.setColumn(ds_searchSub.rowposition, "schCashCode", ds_search.getColumn(nRow, "schCashCode"));			// 상단_현금성분류
	ds_searchSub.setColumn(ds_searchSub.rowposition, "schSdate", ds_search.getColumn(nRow, "schSdate"));				// 상단_기준일자
	
	// 실행할 조건 기준으로 자료여부를 먼저 CHECK 한다
	fn_searchSubCnt();
	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : [특약율일괄복사] 탭 저장 시 DATA Exist CHECK
 *			 : 업장, 창고, 기준일자 조건으로 특약율 정보 유무 CHECK
 *---------------------------------------------------------------------------------------------*/
function fn_searchSubCnt()
{
    var strSvcID    = "searchSubCnt";
    var strURL      = "fm/fms/spContFact/selectSubCnt.xdo";
    var strInDs     = "ds_searchSub=ds_searchSub:A";
    var strOutDs    = "";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : [특약율일괄복사] 처리
 *---------------------------------------------------------------------------------------------*/
function fn_saveSubProc()
{
    var strSvcID    = "saveSub";
    var strURL      = "fm/fms/spContFact/saveSub.xdo";
	var strInDs     = "ds_searchSub=ds_searchSub:A ds_listSub=ds_listSub:U";
    var strOutDs    = "";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : Edit 관련 이벤트 실제 처리
 *---------------------------------------------------------------------------------------------*/
function fn_Trigger_edBtn(obj)
{
	switch(obj)
	{
		// 본사
		case "comp_upjangMain":
			ds_search.setColumn(ds_search.rowposition, "schUpjang", "");
			ds_search.setColumn(ds_search.rowposition, "schUpjangNm", "");
			fn_upjangSet();
			ds_sdate.clearData();
			break;
	
	
		// 업장
		case "comp_upjang":
			fn_upjangSet();
			ds_sdate.clearData();
			break;
			
		default:

			break;
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : DataSet Clear
 *---------------------------------------------------------------------------------------------*/
function fn_DatasetClear()
{
	ds_listGroup.clearData();
	ds_listClass.clearData();
	ds_listItem.clearData();
	ds_listSub.clearData();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 엑셀 업로드 시 중분류 관련 기본 CHECK
 *---------------------------------------------------------------------------------------------*/
function fn_saveGroupChk()
{
	var nRowCnt = ds_listGroup.getRowCount();	// DataSet Count
	var v_itemCode = "";
	
	// DataSet Copy
	ds_listGroupCopy.clearData();
	ds_listGroupCopy.copyData(ds_listGroup);

	this.setWaitCursor(true);

	for (var i = 0 ; i < nRowCnt ; i++)
	{
		//trace(" i : " + i);
		
		v_itemCode = gfn_transNullToEmpty(ds_listGroup.getColumn(i, "clsCd3"));
		
		// 필수입력 CHECK
		if (v_itemCode=="") {
			this.setWaitCursor(false);
			sMsg = "중분류코드는 필수입력 사항입니다.";
			gfn_alert(sMsg, "", "A");
			ds_listGroup.rowposition = i;
			return false;
		}	
		
		
		ds_listGroupCopy.filterRow(i);
		
		var iFindRowIdx = ds_listGroupCopy.findRowExpr("clsCd3 == '"+v_itemCode+"'", 0, ds_listGroupCopy.rowcount);
		
		if (iFindRowIdx != -1)
		{
			this.setWaitCursor(false);
			sMsg = "중복된 중분류코드가 존재합니다.\r\r";
			sMsg = sMsg + "- 중분류코드 : " + ds_listGroup.getColumn(i, "clsCd3");
			gfn_alert(sMsg, "", "A");
			ds_listGroup.rowposition = i;
			return false;
		}
		ds_listGroupCopy.filter("");
	}
	this.setWaitCursor(false);
	return true;
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 엑셀 업로드 시 소분류 관련 기본 CHECK
 *---------------------------------------------------------------------------------------------*/
function fn_saveClassChk()
{
	var nRowCnt = ds_listClass.getRowCount();	// DataSet Count
	var v_itemCode = "";
	
	// DataSet Copy
	ds_listClassCopy.clearData();
	ds_listClassCopy.copyData(ds_listClass);

	this.setWaitCursor(true);

	for (var i = 0 ; i < nRowCnt ; i++)
	{
		//trace(" i : " + i);
		
		v_itemCode = gfn_transNullToEmpty(ds_listClass.getColumn(i, "clsCd4"));
		
		// 필수입력 CHECK
		if (v_itemCode=="") {
			this.setWaitCursor(false);
			sMsg = "소분류코드는 필수입력 사항입니다.";
			gfn_alert(sMsg, "", "A");
			ds_listClass.rowposition = i;
			return false;
		}	
		
		
		ds_listClassCopy.filterRow(i);
		
		var iFindRowIdx = ds_listClassCopy.findRowExpr("clsCd4 == '"+v_itemCode+"'", 0, ds_listClassCopy.rowcount);
		
		if (iFindRowIdx != -1)
		{
			this.setWaitCursor(false);
			sMsg = "중복된 소분류코드가 존재합니다.\r\r";
			sMsg = sMsg + "- 소분류코드 : " + ds_listClass.getColumn(i, "clsCd4");
			gfn_alert(sMsg, "", "A");
			ds_listClass.rowposition = i;
			return false;
		}
		ds_listClassCopy.filter("");
	}
	this.setWaitCursor(false);
	return true;
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 엑셀 업로드 시 자재코드 관련 기본 CHECK
 *---------------------------------------------------------------------------------------------*/
function fn_saveItemChk()
{
	var nRowCnt = ds_listItem.getRowCount();	// DataSet Count
	var v_itemCode = "";
	
	// DataSet Copy
	ds_listItemCopy.clearData();
	ds_listItemCopy.copyData(ds_listItem);

	this.setWaitCursor(true);

	for (var i = 0 ; i < nRowCnt ; i++)
	{
		trace(" i : " + i);
		
		v_itemCode = gfn_transNullToEmpty(ds_listItem.getColumn(i, "itemCode"));
		
		// 필수입력 CHECK
		if (v_itemCode=="") {
			this.setWaitCursor(false);
			sMsg = "자재코드는 필수입력 사항입니다.";
			gfn_alert(sMsg, "", "A");
			ds_listItem.rowposition = i;
			return false;
		}	
		
		
		ds_listItemCopy.filterRow(i);
		
		var iFindRowIdx = ds_listItemCopy.findRowExpr("itemCode == '"+v_itemCode+"'", 0, ds_listItemCopy.rowcount);
		
		if (iFindRowIdx != -1)
		{
			this.setWaitCursor(false);
			sMsg = "중복된 자재코드가 존재합니다.\r\r";
			sMsg = sMsg + "- 자재코드 : " + ds_listItem.getColumn(i, "itemCode");
			gfn_alert(sMsg, "", "A");
			ds_listItem.rowposition = i;
			return false;
		}
		ds_listItemCopy.filter("");
	}
	this.setWaitCursor(false);
	return true;
}



/************************************************************************************************
 * 각 COMPONENT 별 EVENT 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : form에서 Key Down시 단축키들 지정(공통에서 자동생성, 화면에 스크립트 작성시 화면 스크립트만 실행됨)
 *---------------------------------------------------------------------------------------------*/
// function form_onkeydown(obj:Form, e:KeyEventInfo)
// {
// 	gfn_formKeyDown(obj, e);
// }

/*----------------------------------------------------------------------------------------------
 * 설명      : Grid Header Click시 이벤트
 *              
 *---------------------------------------------------------------------------------------------*/
function tpg_tpg2_grd_listSub_onheadclick(obj:Grid, e:GridClickEventInfo)
{
	//모두선택/모두해제 체크박스
	if(obj.getCellProperty("Head" ,e.cell ,"edittype") == "checkbox")
	{
		gfn_setGridCheckAll(obj,e);
	}
}

/*----------------------------------------------------------------------------------------------
// 본사 팝업 OBJ 삭제 시 사업장 정보 삭제
 *---------------------------------------------------------------------------------------------*/
function comp_upjangMain_onkeydown(obj:UpjangSearchComponent, e:KeyEventInfo)
{
	// Del의 경우 뒷처리
	if (e.keycode == 46) fn_Trigger_edBtn("comp_upjangMain");
}



/*----------------------------------------------------------------------------------------------
// 업장 팝업 OBJ 삭제 시 사업장 정보 삭제
 *---------------------------------------------------------------------------------------------*/
function comp_upjang_onkeydown(obj:UpjangSearchComponent, e:KeyEventInfo)
{
	// Del의 경우 뒷처리
	if (e.keycode == 46) fn_Trigger_edBtn("comp_upjang");
}


/*----------------------------------------------------------------------------------------------
// 조건 DataSet 변경 시 처리 이벤트
 *---------------------------------------------------------------------------------------------*/
function ds_search_oncolumnchanged(obj:Dataset, e:DSColChangeEventInfo)
{
    switch(e.columnid)
    {
		case "schUpjang" :			// 업장
			fn_DatasetClear();
			break;
			
		case "schSubinvCode" :		// 창고
			fn_DatasetClear();
			break;
			
		case "schSdate" :			// 기준일	
			fn_DatasetClear();
			break;

		case "schCashCode" :		// 현금성분류
			fn_DatasetClear();
			break;
	}	
}


/*----------------------------------------------------------------------------------------------
// 전체자재조회 버튼 이벤트
 *---------------------------------------------------------------------------------------------*/
function btn_allView_onclick(obj:Button,  e:ClickEventInfo)
{
	// 조회시 Validation Check
	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;

    // Grid sort 표시 초기화(필수)
    gfn_clearSortMark(tpg.tpg1.grd_listItem);
    
   	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
	fv_objColInfo3 = gfn_getDatasetInfo (ds_listItem);
    
    var strSvcID    = "searchItem2";
    var strURL      = "fm/fms/spContFact/selectItem2.xdo";
    var strInDs     = "ds_search=ds_search:A";
    var strOutDs    = "ds_listItem=ds_listItem";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}

/*----------------------------------------------------------------------------------------------
// 탭 클릭 이벤트
 *---------------------------------------------------------------------------------------------*/
function tpg_onchanged(obj:Tab, e:TabIndexChangeEventInfo)
{
	if (obj.tabindex==1) {
		sta_msg.visible = false;
	} else {
		sta_msg.visible = true;
	}
}

/*----------------------------------------------------------------------------------------------
// 아이템 추가 버튼 클릭 이벤트
 *---------------------------------------------------------------------------------------------*/
function tpg_tpg1_btn_addItem_onclick(obj:Button,  e:ClickEventInfo)
{
	// 조회시 Validation Check
	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;

	var arrParam = new Array();
	var dsRtn = new Dataset();

	var dsObj = gfn_dialog("GainRateItemSearchPop"				// Dialog ID
							, "X_FMS::GainRateItemSearchPop.xfdl"	// Form URL
							, {fv_Contents:arrParam}					// 배열
							, null, null, null, null, null, false, true, -1);

	if(dsObj != null)
	{
		for(var i=0; i<dsObj.rowcount; i++)
		{	
			// 자재별 목록에 추가 : 중복된 자재는 추가하지 않음, 별도 메시지 표시 X
			var iFindRowIdx = ds_listItem.findRowExpr("itemCode == '"+dsObj.getColumn(i, "itemCode")+"'", 0, ds_listItem.rowcount);
			// 검색된 행이 존재할 시에는 다음 ROW로 이동
			if (iFindRowIdx == -1)
			{
				ds_listItem.addRow();
				ds_listItem.setColumn(ds_listItem.rowposition, "rowNum", "");
				ds_listItem.setColumn(ds_listItem.rowposition, "itemCode", dsObj.getColumn(i, "itemCode"));	
				ds_listItem.setColumn(ds_listItem.rowposition, "itemName", dsObj.getColumn(i, "itemName"));	
				ds_listItem.setColumn(ds_listItem.rowposition, "itemSize", dsObj.getColumn(i, "itemSize"));	
				ds_listItem.setColumn(ds_listItem.rowposition, "fmSaleRate", 0);
				ds_listItem.setColumn(ds_listItem.rowposition, "fmNosaleRate", 0);
				ds_listItem.setColumn(ds_listItem.rowposition, "upjang", "");
				ds_listItem.setColumn(ds_listItem.rowposition, "subinvCode", "");
				ds_listItem.setColumn(ds_listItem.rowposition, "sdate", "");
				ds_listItem.setColumn(ds_listItem.rowposition, "cashCode", "");
				ds_listItem.setColumn(ds_listItem.rowposition, "useYn", "");
				ds_listItem.setColumn(ds_listItem.rowposition, "clsLvl", "");
			}
		}
		//trace(ds_listItem.saveXML());
		gfn_alert("msg.action.success");	// 처리 되었습니다.
	}
	
}

/*----------------------------------------------------------------------------------------------
// 아이템 삭제 버튼 클릭 이벤트
 *---------------------------------------------------------------------------------------------*/
function tpg_tpg1_btn_delItem_onclick(obj:Button,  e:ClickEventInfo)
{
	var nRowCnt = ds_listItem.getRowCount();	// DataSet Count
	var iCnt = 0;

	for (var i = 0 ; i < nRowCnt ; i++)
	{
 		// Dataset이 선택된 것만 적용
 		if (ds_listItem.getSelect(i))	
 		{
 			iCnt++;
 		}
	}

	if(iCnt == 0)
	{
		sMsg = "삭제할 자재 정보가 없습니다.";
		gfn_alert(sMsg, "", "A");
		return;
	}	

	// 조회조건 기준으로 CHECK
	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;


	var sMsg = "선택한 자재를 삭제합니다.\n계속 진행 하시겠습니까?";

	var rtVal = gfn_confirm(sMsg, "", "C");	// 선택된 자료를 삭제 하시겠습니까?

	iCnt = 0;
	if (rtVal == true) 
	{	
		// 삭제용 dataset Clear
		ds_deleteItem.clearData();
		
		// 삭제할 대상 dataset 생성
		for (var i = 0 ; i < nRowCnt ; i++)
		{
			// Dataset이 선택된 것만 적용
			if (ds_listItem.getSelect(i))	
			{
				// 신규추가된 ROW 해당 ROW를 삭제
				if (ds_listItem.getRowType(i) != Dataset.ROWTYPE_INSERT)
				{
					//var bSucc = ds_listItem.deleteRow(i);
					//trace("bSucc : " + bSucc);
					// 기존 자료인 경우
					iCnt++;
					ds_deleteItem.addRow();
					ds_deleteItem.setRowType(ds_deleteItem.rowposition, Dataset.ROWTYPE_DELETE);
					ds_deleteItem.setColumn(ds_deleteItem.rowposition, "upjang", ds_search.getColumn(ds_search.rowposition, "schUpjang"));			// 업장
					ds_deleteItem.setColumn(ds_deleteItem.rowposition, "subinvCode", ds_search.getColumn(ds_search.rowposition, "schSubinvCode"));	// 창고
					ds_deleteItem.setColumn(ds_deleteItem.rowposition, "sdate", ds_search.getColumn(ds_search.rowposition, "schSdate"));				// 일자
					ds_deleteItem.setColumn(ds_deleteItem.rowposition, "cashCode", ds_search.getColumn(ds_search.rowposition, "schCashCode"));		// 현금성분류
					ds_deleteItem.setColumn(ds_deleteItem.rowposition, "itemCode", ds_listItem.getColumn(i, "itemCode"));								// 자재코드
				}
			}
		}
		
		if (iCnt == 0) {	// TR 필요없으면 메시지 호출 후 종료
			var bSucc = ds_listItem.deleteSelectedRows();
			trace("bSucc : " + bSucc);
			gfn_alert("msg.delete.success");// 삭제 되었습니다.
			return;
		}
		
		// Transaction 바로 호출해서 삭제 처리 함 
		var strSvcID    = "deleteItem2";
		var strURL      = "fm/fms/spContFact/deleteItem2.xdo";
		var strInDs     = "ds_deleteItem=ds_deleteItem:A";
		var strOutDs    = "";
		var strArg      = "";
		var strCallback = "fn_callBack";
		var bAsync      = true;
		
		gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
		
	}
	
}
]]></Script>
  </Form>
</FDL>
