<?xml version="1.0" encoding="UTF-8"?>
<hqml xmlns="http://hone.hanwha.co.kr/schema/hqml"
	name="sc.app.loginDAO">
	<desc>FC POS 마스터 외부 인터페이스 HQML</desc>









	<statement name="selectTest"><![CDATA[SELECT '1' AS CHECK_NUM
  FROM DUAL]]></statement>
	<statement name="logInsert"><![CDATA[INSERT INTO APP_INTERFACE_LOG(
INSDT,
TXID,
TXDIV,
TXHEADER,
TXDATA,
TXRESULT)
VALUES(
TO_CHAR(SYSDATE,'YYYY-MM-DD HH24:MI:SS'),
<#if txId?has_content >:txId,<#else>null,</#if> 
<#if txDiv?has_content >:txDiv,<#else>null,</#if> 
<#if tHeader?has_content >:tHeader,<#else>null,</#if> 
<#if tData?has_content >:tData,<#else>null,</#if> 
<#if tResult?has_content >:tResult<#else>null</#if> 
)]]></statement>
	<statement name="selectUser"><![CDATA[
SELECT
       A.USERID
     , A.NM_KOR
     , A.ACCT_STATUS
     , A.ACCT_LK_REASON_CD
     , B.MU_CD
     , B.MU_NM
     , B.TM_CD
     , B.TM_NM
     , B.CC_CD
     , B.CC_NM
     , B.UPJANG
     , B.UPJANGNM AS UPJANG_NM
     , D.MAIN_UPJANG AS MAIN_UPJANG
     , (SELECT CC.UPJANGNM FROM ST_UPJANG CC WHERE CC.UPJANG = D.MAIN_UPJANG) AS MAIN_UPJANG_NM
     , D.CUST_TYPE AS UPJANG_GROUP
     , A.APP_USER_GROUP /* 사용자그룹(본사,식재,FS,브랜드) */
     , A.USER_TYPE      /* 사용자구분(내부,외부) */
     , NVL(A.M_RECV_YN,'N') AS M_RECV_YN      /* 마케팅수신동의여부(Y,N) */
     , CASE
            WHEN A.PASSWORD = SCC_CRYPTO.ONEWAY_ENC_FUN(:userPw)
            THEN 'Y'
            ELSE 'N'
       END AS VALID_PWD_YN                  /* 비밀번호 일치 여부 */
     , A.PWD_CHG_DATE
     ,(SELECT CASE
                  WHEN SYSDATE - TO_DATE(A.PWD_CHG_DATE) >= ENV_INFO_VALUE
                  THEN 'Y'
                  ELSE 'N'
              END AS CHG_PWD_YN
       FROM  SCC_PERS_INFO_MGMT_ENV WHERE ENV_INFO_ID='PWD_CHG_PERIOD') AS PWD_CHG_YN
     , NVL(A.PWD_ERR_CNT, 0) AS PWD_ERR_CNT
     ,(SELECT ENV_INFO_VALUE FROM SCC_PERS_INFO_MGMT_ENV WHERE ENV_INFO_ID='PWD_ERR_CNT') AS MAX_PWD_ERR_CNT
     , SCC_CRYPTO.DEC_FUN(A.HP_NO_ENC) AS HP_NO
     , SCC_CRYPTO.DEC_FUN(A.EMAIL_ENC) AS EMAIL_ADDR
FROM   SCC_USERINFO A,
       (SELECT X.UPJANG, X.UPJANGNM, Y.* FROM ST_UPJANG X, HLDC_SC_DEPT_V Y WHERE X.DEPT_ID = Y.DEPT_ID) B,
       FMS_UPJANG D,
       HLDC_ST_CUST E,
       FMP_OTHER_CUST F
WHERE  1=1
AND    A.USERID   = :userId
AND    A.USE_YN   = 'Y'
AND    A.UPJANG   = B.UPJANG(+)
AND    A.UPJANG   = D.UPJANG(+)
AND    A.CUSTCD   = E.CUSTCD(+)
AND    A.OTCUSTCD = F.OTCUSTCD(+)
        
		]]></statement>
	<statement name="updateLoginPwdErrCnt"><![CDATA[		UPDATE SCC_USERINFO
		SET    PWD_ERR_CNT = NVL(PWD_ERR_CNT, 0)+1
		  ,    UUSER = 'LOGIN'
		  ,    UDATE = SYSDATE
		WHERE  USERID = :userId]]></statement>
	<statement name="updateAccountLockForPwdErrOver"><![CDATA[		UPDATE SCC_USERINFO
		SET    ACCT_STATUS = 'LOCK'
		     , ACCT_LK_REASON_CD = 'PWD_ERR_OVER'
		     , ACCT_LK_DD  = SYSDATE
		     , UUSER = :userId
		     , UDATE = SYSDATE
		WHERE  USERID = :userId]]></statement>
	<statement name="updateLoginPwdErrCntInit"><![CDATA[		UPDATE SCC_USERINFO
		SET    PWD_ERR_CNT = 0
		  ,    UUSER = 'LOGIN'
		  ,    UDATE = SYSDATE
		WHERE  USERID = :userId]]></statement>
	<statement name="updateMrecvYn"><![CDATA[		UPDATE SCC_USERINFO
		SET    <#if mrcvYn?has_content > M_RECV_YN = :mrcvYn <#else> M_RECV_YN = null </#if>
		  ,    UUSER = :userId
		  ,    UDATE = SYSDATE
		WHERE  USERID = :userId]]></statement>
</hqml>
