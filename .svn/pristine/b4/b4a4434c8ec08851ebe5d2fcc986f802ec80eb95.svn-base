<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="..\..\..\default_typedef.xml"/>
  <Form id="MAS50030E" classname="SAMPLE01" inheritanceid="" position="absolute 0 0 1252 725" titletext="폐식용유관리(사업장)" onload="form_onload">
    <Layouts>
      <Layout>
        <Grid id="grd_list" taborder="5" binddataset="ds_list" autoenter="select" useinputpanel="false" cellsizingtype="col" position="absolute 0 160 1237 710" anchor="all" autofittype="col" formats="&lt;Formats&gt;&#10;  &lt;Format id=&quot;default&quot;&gt;&#10;    &lt;Columns&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;    &lt;/Columns&gt;&#10;    &lt;Rows&gt;&#10;      &lt;Row band=&quot;head&quot; size=&quot;24&quot;/&gt;&#10;      &lt;Row band=&quot;body&quot; size=&quot;24&quot;/&gt;&#10;    &lt;/Rows&gt;&#10;    &lt;Band id=&quot;head&quot;&gt;&#10;      &lt;Cell col=&quot;0&quot; disptype=&quot;normal&quot; text=&quot;수거일자&quot;/&gt;&#10;      &lt;Cell col=&quot;1&quot; disptype=&quot;normal&quot; text=&quot;요일&quot;/&gt;&#10;      &lt;Cell col=&quot;2&quot; disptype=&quot;normal&quot; text=&quot;사용량&quot;/&gt;&#10;      &lt;Cell col=&quot;3&quot; disptype=&quot;normal&quot; text=&quot;발생량&quot;/&gt;&#10;      &lt;Cell col=&quot;4&quot; disptype=&quot;normal&quot; text=&quot;수거량&quot;/&gt;&#10;      &lt;Cell col=&quot;5&quot; disptype=&quot;normal&quot; text=&quot;수거단위&quot;/&gt;&#10;      &lt;Cell col=&quot;6&quot; disptype=&quot;normal&quot; text=&quot;계약금액&quot;/&gt;&#10;      &lt;Cell col=&quot;7&quot; disptype=&quot;normal&quot; text=&quot;수거금액&quot;/&gt;&#10;      &lt;Cell col=&quot;8&quot; disptype=&quot;normal&quot; text=&quot;점장확인&quot;/&gt;&#10;      &lt;Cell col=&quot;9&quot; disptype=&quot;normal&quot; text=&quot;비고&quot;/&gt;&#10;    &lt;/Band&gt;&#10;    &lt;Band id=&quot;body&quot;&gt;&#10;      &lt;Cell col=&quot;0&quot; disptype=&quot;normal&quot; text=&quot;bind:수거일자&quot;/&gt;&#10;      &lt;Cell col=&quot;1&quot; disptype=&quot;normal&quot; text=&quot;bind:요일&quot;/&gt;&#10;      &lt;Cell col=&quot;2&quot; disptype=&quot;normal&quot; text=&quot;bind:사용량&quot;/&gt;&#10;      &lt;Cell col=&quot;3&quot; disptype=&quot;normal&quot; text=&quot;bind:발생량&quot;/&gt;&#10;      &lt;Cell col=&quot;4&quot; disptype=&quot;normal&quot; text=&quot;bind:수거량&quot;/&gt;&#10;      &lt;Cell col=&quot;5&quot; disptype=&quot;normal&quot; text=&quot;bind:수거단위&quot;/&gt;&#10;      &lt;Cell col=&quot;6&quot; disptype=&quot;normal&quot; text=&quot;bind:계약금액&quot;/&gt;&#10;      &lt;Cell col=&quot;7&quot; disptype=&quot;normal&quot; text=&quot;bind:수거금액&quot;/&gt;&#10;      &lt;Cell col=&quot;8&quot; disptype=&quot;normal&quot; text=&quot;bind:점장확인&quot;/&gt;&#10;      &lt;Cell col=&quot;9&quot; disptype=&quot;normal&quot; text=&quot;bind:비고&quot;/&gt;&#10;    &lt;/Band&gt;&#10;  &lt;/Format&gt;&#10;&lt;/Formats&gt;&#10;">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="40"/>
                <Column size="100"/>
                <Column size="80"/>
                <Column size="72"/>
                <Column size="150"/>
                <Column size="100"/>
                <Column size="100"/>
                <Column size="100"/>
                <Column size="100"/>
                <Column size="100"/>
                <Column size="100"/>
                <Column size="0"/>
                <Column size="56"/>
                <Column size="70"/>
                <Column size="200"/>
              </Columns>
              <Rows>
                <Row size="24" band="head"/>
                <Row size="24" band="head"/>
                <Row size="24"/>
                <Row size="24" band="summ"/>
              </Rows>
              <Band id="head">
                <Cell rowspan="2" class="head_Excel" taborder="undefined"/>
                <Cell col="1" rowspan="2" text="일자"/>
                <Cell col="2" rowspan="2" text="요일"/>
                <Cell col="3" rowspan="2" text="업체코드"/>
                <Cell col="4" rowspan="2" text="수거업체"/>
                <Cell col="5" colspan="3" text="폐식용유(통)"/>
                <Cell col="8" colspan="2" text="계약정보"/>
                <Cell col="10" rowspan="2" text="수거금액"/>
                <Cell col="11" text="점장확인"/>
                <Cell col="12" rowspan="2" text="마감&#13;&#10;여부" taborder="undefined"/>
                <Cell col="13" rowspan="2" text="매출등록&#13;&#10;여부" taborder="undefined"/>
                <Cell col="14" rowspan="2" text="비고"/>
                <Cell row="1" col="5" text="사용량"/>
                <Cell row="1" col="6" text="발생량"/>
                <Cell row="1" col="7" text="수거량"/>
                <Cell row="1" col="8" text="수거단위"/>
                <Cell row="1" col="9" text="계약금액"/>
                <Cell row="1" col="11"/>
              </Band>
              <Band id="body">
                <Cell celltype="none" style="background:EXPR(CAN_YN=='T'?'#e0fcd4ff':'#FFFFFFFF');background2:EXPR(CAN_YN=='T'?'#e0fcd4ff':'#FFFFFFFF');" expr="expr:currow+1"/>
                <Cell col="1" displaytype="date" edittype="none" style="background:EXPR(CAN_YN=='T'?'#e0fcd4ff':'#FFFFFFFF');background2:EXPR(CAN_YN=='T'?'#e0fcd4ff':'#FFFFFFFF');color:EXPR(WEEK_NAME=='토'?'blue':WEEK_NAME=='일'?'red':'default');color2:EXPR(WEEK_NAME=='토'?'blue':WEEK_NAME=='일'?'red':'default');" text="bind:REMV_DAY"/>
                <Cell col="2" style="background:EXPR(CAN_YN=='T'?'#e0fcd4ff':'#FFFFFFFF');background2:EXPR(CAN_YN=='T'?'#e0fcd4ff':'#FFFFFFFF');color:EXPR(WEEK_NAME=='토'?'blue':WEEK_NAME=='일'?'red':'default');color2:EXPR(WEEK_NAME=='토'?'blue':WEEK_NAME=='일'?'red':'default');" text="bind:WEEK_NAME"/>
                <Cell col="3" displaytype="text" style="align:center;background:EXPR(CAN_YN=='T'?'#e0fcd4ff':'#FFFFFFFF');background2:EXPR(CAN_YN=='T'?'#e0fcd4ff':'#FFFFFFFF');" text="bind:CUSTCD"/>
                <Cell col="4" style="align:left;background:EXPR(CAN_YN=='T'?'#e0fcd4ff':'#FFFFFFFF');background2:EXPR(CAN_YN=='T'?'#e0fcd4ff':'#FFFFFFFF');" text="bind:CUSTNM"/>
                <Cell col="5" displaytype="number" edittype="none" style="background:EXPR(CAN_YN=='T'?'#e0fcd4ff':'#FFFFFFFF');background2:EXPR(CAN_YN=='T'?'#e0fcd4ff':'#FFFFFFFF');" text="bind:USE_QTY" mask="#,##0.0"/>
                <Cell col="6" displaytype="number" edittype="expr:CAN_YN=='N'?'none':'masknumber'" style="background:EXPR(CAN_YN=='T'?'#e0fcd4ff':'#FFFFFFFF');background2:EXPR(CAN_YN=='T'?'#e0fcd4ff':'#FFFFFFFF');" text="bind:OCCUR_QTY" mask="#,##0.0" editautoselect="true" editautoskip="false"/>
                <Cell col="7" displaytype="number" edittype="expr:REG_YN=='Y'?'none':'masknumber'" style="background:EXPR(CAN_YN=='T'?'#e0fcd4ff':'#FFFFFFFF');background2:EXPR(CAN_YN=='T'?'#e0fcd4ff':'#FFFFFFFF');" text="bind:REMV_QTY" mask="#,##0.0" editautoselect="true" editautoskip="false"/>
                <Cell col="8" displaytype="combo" style="background:EXPR(CAN_YN=='T'?'#e0fcd4ff':'#FFFFFFFF');background2:EXPR(CAN_YN=='T'?'#e0fcd4ff':'#FFFFFFFF');" text="bind:CONTRACT_UNIT" combodataset="ds_contractUnitType" combocodecol="CODE" combodatacol="CODE_NAME"/>
                <Cell col="9" displaytype="number" style="background:EXPR(CAN_YN=='T'?'#e0fcd4ff':'#FFFFFFFF');background2:EXPR(CAN_YN=='T'?'#e0fcd4ff':'#FFFFFFFF');" text="bind:CONTRACT_AMT" mask="#,##0"/>
                <Cell col="10" displaytype="number" style="background:EXPR(CAN_YN=='T'?'#e0fcd4ff':'#FFFFFFFF');background2:EXPR(CAN_YN=='T'?'#e0fcd4ff':'#FFFFFFFF');" text="bind:REMV_AMT" mask="#,##0"/>
                <Cell col="11" style="background:EXPR(CAN_YN=='T'?'#e0fcd4ff':'#FFFFFFFF');background2:EXPR(CAN_YN=='T'?'#e0fcd4ff':'#FFFFFFFF');" text="bind:점장확인"/>
                <Cell col="12" style="align:center;background:EXPR(CAN_YN=='T'?'#e0fcd4ff':'#FFFFFFFF');background2:EXPR(CAN_YN=='T'?'#e0fcd4ff':'#FFFFFFFF');" text="bind:REG_YN"/>
                <Cell col="13" style="align:center;background:EXPR(CAN_YN=='T'?'#e0fcd4ff':'#FFFFFFFF');background2:EXPR(CAN_YN=='T'?'#e0fcd4ff':'#FFFFFFFF');" text="bind:RECEIPT_YN"/>
                <Cell col="14" displaytype="text" edittype="text" style="background:EXPR(CAN_YN=='T'?'#e0fcd4ff':'#FFFFFFFF');background2:EXPR(CAN_YN=='T'?'#e0fcd4ff':'#FFFFFFFF');" text="bind:REMARK"/>
              </Band>
              <Band id="summary">
                <Cell/>
                <Cell col="1"/>
                <Cell col="2"/>
                <Cell col="3"/>
                <Cell col="4"/>
                <Cell col="5" displaytype="number" text="expr:getSum('USE_QTY')"/>
                <Cell col="6" displaytype="number" text="expr:getSum('OCCUR_QTY')"/>
                <Cell col="7" displaytype="number" text="expr:getSum('REMV_QTY')"/>
                <Cell col="8"/>
                <Cell col="9"/>
                <Cell col="10" displaytype="number" text="expr:getSum('REMV_AMT')"/>
                <Cell col="11"/>
                <Cell col="12"/>
                <Cell col="13"/>
                <Cell col="14"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Static id="Static06" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1237 0 1252 710" anchor="top right"/>
        <Static id="Static71" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 710 1252 725" anchor="left bottom"/>
        <Div id="div_cmnBtn" anchor="left top right" taborder="7" url="cmn::CmnBtn.xfdl" text="Div00" scrollbars="none" position="absolute 0 0 1237 30"/>
        <Static id="Static08" class="sta_WFSA_Labelbg" position="absolute 0 30 1237 71" anchor="left top right"/>
        <Static id="Static28" text="사업장" class="sta_WFSA_label" position="absolute 15 40 77 61" anchor="left top"/>
        <Static id="Static04" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 30 93 40" anchor="left top"/>
        <Static id="Static05" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 61 93 71" anchor="left top"/>
        <Static id="Static07" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 40 15 61" anchor="left top"/>
        <Static id="Static11" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 62 40 72 61" anchor="left top"/>
        <Static id="Static22" text="폐식용유 관리 현황" class="sta_WF_Title01" position="absolute 0 142 450 160" anchor="left top"/>
        <Static id="Static15" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 0 71 450 84" anchor="left top"/>
        <Static id="Static16" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 0 155 450 160" anchor="left top"/>
        <Static id="Static09" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 307 40 337 61" anchor="left top"/>
        <Static id="Static00" text="일자" class="sta_WFSA_label" position="absolute 337 40 414 61" anchor="left top"/>
        <Static id="Static25" text="h05" class="Guide01_AreaRed" visible="false" position="absolute 1153 155 1237 160" anchor="top right"/>
        <Static id="Static12" text="h06" class="Guide01_AreaRed" visible="false" position="absolute 1153 129 1237 135" anchor="top right"/>
        <Static id="Static03" text="수거업체" class="sta_WFSA_label" position="absolute 637 40 714 61" anchor="left top" visible="false"/>
        <Static id="Static10" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 696 40 706 61" anchor="left top"/>
        <Edit id="edt_custNm" taborder="8" position="absolute 706 40 866 61" anchor="left top" enable="false" visible="false"/>
        <MaskEdit id="msk_regDdFrom" taborder="0" type="string" mask="####-##-##" onsetfocus="g_Date_OnFocus" onkillfocus="g_Date_OnKillFocus" oneditclick="g_Date_OnFocus" position="absolute 380 40 462 61" style="padding:1 0 0 1;align:center middle;" class="msk_WF_EssentialCal" autoselect="true"/>
        <Button id="btn_regDdFrom" taborder="1" tabstop="false" onclick="g_CalButton_OnClick" class="btn_WF_calEssential" position="absolute 461 40 482 61" userdata="msk_regDdFrom"/>
        <Static id="Static13" text="~" position="absolute 481 41 507 62" style="align:center middle;"/>
        <MaskEdit id="msk_regDdTo" taborder="2" type="string" mask="####-##-##" onsetfocus="g_Date_OnFocus" onkillfocus="g_Date_OnKillFocus" oneditclick="g_Date_OnFocus" position="absolute 505 40 587 61" style="padding:1 0 0 1;align:center middle;" class="msk_WF_EssentialCal" autoselect="true"/>
        <Button id="btn_regDdTo" taborder="3" tabstop="false" onclick="g_CalButton_OnClick" class="btn_WF_calEssential" position="absolute 586 40 607 61" userdata="msk_regDdTo"/>
        <Static id="Static14" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 371 40 381 61" anchor="left top"/>
        <Static id="Static17" text="W10" visible="false" position="absolute 482 39 490 60" style="background:#ff000055;align:center middle;"/>
        <Static id="Static18" text="W10" visible="false" position="absolute 497 39 505 60" style="background:#ff000055;align:center middle;"/>
        <Static id="Static19" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 607 40 637 61" anchor="left top"/>
        <Static id="Static49" class="sta_WFDA_Labelbg" position="absolute 93 102 1237 129" anchor="left top right"/>
        <Static id="Static01" text="누적 현황" class="sta_WF_Title01" position="absolute 0 84 450 102" anchor="left top"/>
        <Static id="Static20" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 0 97 450 102" anchor="left top"/>
        <Static id="Static26" text="사용량" class="sta_WFDA_Label01" position="absolute 0 102 150 129" anchor="left top"/>
        <Static id="Static02" text="발생량" class="sta_WFDA_Label01" position="absolute 308 102 458 129" anchor="left top"/>
        <Static id="Static33" text="수거량" class="sta_WFDA_Label01" position="absolute 616 102 766 129" anchor="left top"/>
        <Static id="Static41" text="수거금액" class="sta_WFDA_Label01" position="absolute 924 102 1074 129" anchor="left top"/>
        <Static id="Static60" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 0 129 450 142" anchor="left top"/>
        <MaskEdit id="MaskEdit01" taborder="15" readonly="true" mask="#,##0.0" position="absolute 152 105 306 126" style="padding:1 5 0 0;"/>
        <MaskEdit id="MaskEdit00" taborder="16" readonly="true" mask="#,##0.0" position="absolute 460 105 614 126" style="padding:1 5 0 0;"/>
        <MaskEdit id="MaskEdit02" taborder="17" readonly="true" mask="#,##0.0" position="absolute 768 105 922 126" style="padding:1 5 0 0;"/>
        <MaskEdit id="MaskEdit03" taborder="18" readonly="true" mask="#,##0" position="absolute 1076 105 1234 126" style="padding:1 5 0 0;"/>
        <UpjangSearchComponent id="edt_upjang" titletext="업장 검색용 Component" taborder="4" text="UpjangSearchComponent00" position="absolute 72 40 307 61" bindDataset="" bindUpjangCodeColumn="" bindUpjangNameColumn="" eventBeforeTrigger="" eventAfterTrigger="" roleSetId="ScoAuthLevel01"/>
        <Button id="btn_sendSale" taborder="20" text="매출등록" class="btn_WF_Function" position="absolute 1170 135 1237 155" anchor="top right" onclick="btn_sendSale_onclick"/>
        <Static id="Static69" text="매출 마감 후 수거량 수정은 불가합니다." class="sta_WF_DiscPoint" position="absolute 877 137 1147 152" anchor="top right"/>
        <Static id="Static21" text="과거일자의 수거량 등록은 불가합니다." class="sta_WF_DiscPoint" position="absolute 613 137 883 152" anchor="top right"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_list" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" onvaluechanged="ds_list_onvaluechanged">
        <ColumnInfo>
          <Column id="REMV_DAY" type="STRING" size="256"/>
          <Column id="WEEK_NAME" type="STRING" size="256"/>
          <Column id="CUSTCD" type="STRING" size="256"/>
          <Column id="CUSTNM" type="STRING" size="256"/>
          <Column id="USE_QTY" type="STRING" size="256"/>
          <Column id="OCCUR_QTY" type="STRING" size="256"/>
          <Column id="REMV_QTY" type="STRING" size="256"/>
          <Column id="CONTRACT_UNIT" type="STRING" size="256"/>
          <Column id="CONTRACT_AMT" type="STRING" size="256"/>
          <Column id="REG_DD" type="STRING" size="256"/>
          <Column id="REMV_AMT" type="STRING" size="256"/>
          <Column id="REMARK" type="STRING" size="256"/>
          <Column id="MU_CD" type="STRING" size="256"/>
          <Column id="CC_CD" type="STRING" size="256"/>
          <Column id="RECEIPT_NUM" type="STRING" size="256"/>
          <Column id="RECEIPT_YN" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cond">
        <ColumnInfo>
          <Column id="UPJANG" type="STRING" size="256"/>
          <Column id="CUSTCD" type="STRING" size="256"/>
          <Column id="REG_DD_FROM" type="STRING" size="256"/>
          <Column id="REG_DD_TO" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cust" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CUSTCD" type="STRING" size="256"/>
          <Column id="CUSTNM" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_contractUnitType">
        <ColumnInfo>
          <Column id="CODE" size="256" type="STRING"/>
          <Column id="CODE_NAME" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_total" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" oncolumnchanged="ds_list_oncolumnchanged">
        <ColumnInfo>
          <Column id="UPJANG" type="STRING" size="256"/>
          <Column id="USE_QTY" type="STRING" size="256"/>
          <Column id="OCCUR_QTY" type="STRING" size="256"/>
          <Column id="REMV_QTY" type="STRING" size="256"/>
          <Column id="REMV_AMT" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_sysDate" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_chkTotal" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="UPJANG" type="STRING" size="256"/>
          <Column id="USE_QTY" type="STRING" size="256"/>
          <Column id="OCCUR_QTY" type="STRING" size="256"/>
          <Column id="REMV_QTY" type="STRING" size="256"/>
          <Column id="REMV_AMT" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Bind>
      <BindItem id="item0" compid="MaskEdit01" propid="value" datasetid="ds_total" columnid="USE_QTY"/>
      <BindItem id="item1" compid="MaskEdit00" propid="value" datasetid="ds_total" columnid="OCCUR_QTY"/>
      <BindItem id="item2" compid="MaskEdit02" propid="value" datasetid="ds_total" columnid="REMV_QTY"/>
      <BindItem id="item3" compid="MaskEdit03" propid="value" datasetid="ds_total" columnid="REMV_AMT"/>
    </Bind>
    <Script type="xscript4.0"><![CDATA[/*
 ******************************************************************************************
 * 시스템구분   : IFIS/영업관리/폐식용유관리/폐식용유관리(사업장)
 * 프로그램명   : MAS50030E.xfdl
 * 기      능   : 폐식용유관리(사업장)
 * 작  성  자   : 김경은
 * 작성  일자   : 2015-02-04
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */

//=========================================================================================
// [ PART 1 ]
// Form에서 Include 할 내용을 정의
//
//=========================================================================================
include "U_lib::lib_conversionCom.xjs";

//=========================================================================================
// [ PART 2 ]
// Form에서 사용될 전역변수를 선언
//
//=========================================================================================


//=========================================================================================
// [ PART 3 ]
// Form Loading 시 작업 정의
//
//========================================================================================= 
function form_onload(obj:Form, e:LoadEventInfo)
{
	gfn_formOnLoad(obj, true);

	fsp_init(this);	
	
	fn_init();
}


//=========================================================================================
// [ PART 4 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,도움말,form닫기)
//
//=========================================================================================
/*
 ******************************************************************************************
 * 함  수  명   : fn_Search()
 * 기      능   : [조회버튼] 검색조건에 해당하는 정보를 조회
 ******************************************************************************************
 */
function fn_search()
{
	// validation 체크
	if ( gfn_isNull(edt_upjang.getUpjangCode()) )
	{
		g_Message("EE", "사업장을 입력하세요.");
		edt_upjang.setFocus();
		return true;
	}
	if ( gfn_isNull(msk_regDdFrom.value) || (gfn_length(msk_regDdFrom.value)< 8) )
	{
		g_Message("EE", "일자(From)을 정확하게 입력하세요.");
		msk_regDdFrom.setFocus();
		return true;
	}
	if ( gfn_isNull(msk_regDdTo.value) || (gfn_length(msk_regDdTo.value)< 8) )
	{
		g_Message("EE", "일자(To)을 정확하게 입력하세요.");
		msk_regDdTo.setFocus();
		return true;
	}
	if ( msk_regDdFrom.value > msk_regDdTo.value ){
		gfn_alert("시작일이 종료일 보다 이후 날짜입니다. 확인 하시기 바랍니다.");
		return;
	}	
	
	// 변경여부 확인
	if ( gfn_dsIsUpdated(ds_list) ) 
	{
		if (!g_Confirm("02", '변경된 데이타가 있습니다. 무시하고 재조회하시겠습니까?!')) return;
	}
	
	var actionName, cmdName, inData, outData, otherArg, callBackFnc, trId;	
	
	ds_cond.clearData();
	ds_list.clearData();
	
	inData			= "ds_cond=ds_cond";
	outData			= "ds_list=ds_list ds_total=ds_total";
	callBackFnc		= "fn_callBack";	
    trId            = "SELECT"; 
    
	// 파라미터셋팅
	ds_cond.addRow();
    ds_cond.setColumn(0,"UPJANG", edt_upjang.getUpjangCode());
    ds_cond.setColumn(0,"CUSTCD", edt_custNm.userdata);
    ds_cond.setColumn(0,"REG_DD_FROM", msk_regDdFrom.value);
    ds_cond.setColumn(0,"REG_DD_TO", msk_regDdTo.value);
    
	fsp_clear(this); 
    fsp_addSearch(this, "ma/mas:MAS50030E_S001");									
    fsp_addSearch(this, "ma/mas:MAS50030E_S003");									
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc,"","","",trId);
   
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_Save()
 * 기      능   : [저장버튼] 저장 버튼 클릭 시 처리되는 작업
 ******************************************************************************************
 */
function fn_save()
{
	// 수량 체크
	var nRemvQty = gfn_parseFloat(ds_total.getColumn(0, "REMV_QTY"));
	var nOccurQty = gfn_parseFloat(ds_total.getColumn(0, "OCCUR_QTY"));
	
	if (nOccurQty < nRemvQty)
	{
		g_Message("EE", "발생량이 수거량을 초과할 수 없습니다.");
		return;
	}

	// 변경여부 확인
	if ( gfn_dsIsUpdated(ds_list) == false )
	{
		g_Message("EE", "변경된 데이터가 없습니다.");
		return;
	}
	
	if ( !g_Confirm("02", "저장하시겠습니까?") ) return;
	
    // 서비스셋팅
    var actionName, cmdName, inData, outData, otherArg, callBackFnc;
    var insertSql, updateSql, deleteSql,saveFlagColumn, keySqlName, keyIncrement, callbackSql;    

    inData		= "ds_list=ds_list:U";
    outData		= "";
    callBackFnc	= "fn_callBack";
    insertSql 	= "";
    updateSql	= "ma/mas:MAS50030E_U001";
    deleteSql	= "";
    
    fsp_clear(this);
    fsp_addSave(this, insertSql, updateSql, deleteSql,saveFlagColumn, keySqlName);
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc,"","","","SAVE");
}

//=========================================================================================
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
//
//=========================================================================================

/*-----------------------------------------------------------------------------------------
 * 설명      : 화면 처음 로딩시 설정 셋팅
 *----------------------------------------------------------------------------------------*/
function fn_init()  
{
	// 일자 셋팅
	msk_regDdFrom.value = gfn_getFirstDate(gfn_today());
	msk_regDdTo.value = gfn_getLastDate(gfn_today());
	
	//공통코드조회
	//계약단위
	var objCode = fn_common_code("'MA0138'","","","","Y");
	var sCond = "GROUP_CODE == 'MA0138'";
	objCode.filter(sCond);
	CopyF(ds_contractUnitType, objCode.name);

}

/*-----------------------------------------------------------------------------------------
 * 설명      : callBack 함수
 *----------------------------------------------------------------------------------------*/
function fn_callBack(errCode, errMsg, trId)
{	
	if ( errCode != 0 )
	{
		g_Message("EE", "서비스 오류:시스템 관리자에게 문의하십시오.");
		return;
	}
	else
	{
		if ( trId == "SELECT" )
		{
		} 
		else if ( trId == "SELECT_CUST" )
		{
			edt_custNm.value = ds_cust.getColumn(0, "CUSTNM");
			edt_custNm.userdata = ds_cust.getColumn(0, "CUSTCD");
		}
		else if ( trId == "SAVE" )
		{
			fn_search();
		}
	}
}

/*-----------------------------------------------------------------------------------------
 * 설명      : 사업장의 해당 수거업체 조회 함수
 *----------------------------------------------------------------------------------------*/
function fn_searchCust()
{
	var actionName, cmdName, inData, outData, otherArg, callBackFnc, trId;	
	
	ds_cond.clearData();
	ds_cust.clearData();
	
	inData			= "";
	outData			= "ds_cust=ds_cust";
	callBackFnc		= "fn_callBack";	
    trId            = "SELECT_CUST"; 
    otherArg        = "UPJANG='"+edt_upjang.getUpjangCode()+"'";
   
	fsp_clear(this); 
    fsp_addSearch(this, "ma/mas:MAS50030E_S002");									
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc,"","","",trId);
    
}

//=========================================================================================
// [ PART 6 ]
// component Event 정의 ( User Define function )
// --> component Event의 기요,기능,동작 등 상세내용은 MiPlatform 메뉴얼을 참조하시기 바랍니다.
//=========================================================================================
/*-----------------------------------------------------------------------------------------
 * 설명      : 매출등록
 *----------------------------------------------------------------------------------------*/
function btn_sendSale_onclick(obj:Button,  e:ClickEventInfo)
{
	if(ds_list.getRowCount() == 0)
	{
		g_Message("EE", "등록할 대상이 없습니다. 조회 후 등록 바랍니다.");
		return;
	}

	// 변경여부 확인
	if ( gfn_dsIsUpdated(ds_list) == true )
	{
		g_Message("EE", "변경된 데이타가 있습니다.\n\n저장하신 후 작업하세요.");
		return;
	}

	// 수량 체크
	var nRemvQty = gfn_parseFloat(gfn_nvl(ds_total.getColumn(0, "REMV_QTY"), "0"));
	var nOccurQty = gfn_parseFloat(gfn_nvl(ds_total.getColumn(0, "OCCUR_QTY"), "0"));
	
	if (nOccurQty < nRemvQty)
	{
		g_Message("EE", "발생량이 수거량을 초과할 수 없습니다.");
		return;
	}
	
	fsp_clear(this);
	fsp_addSearch(this, "sc/scc:SCC_TODAY");        // 시스템일자
	fsp_callService(this, "", "", "", "ds_sysDate=ds_GetDate", "", "fn_callbackToday");
}

function fn_callbackToday(errCode, errMsg) 
{
	if( errCode != 0 ) {
		g_Message("EE", errMsg);
		return;
	} else {
	
		var nRow = ds_list.rowposition;
		
		if(nRow == -1) return;
		
		if(ds_list.getColumn(nRow, "REG_YN") == "Y")
		{
			g_Message("EE", "마감이 되어 매출등록이 불가합니다.");
			return;
		}
		
		if(ds_sysDate.getColumn(0, "TODAY") < ds_list.getColumn(nRow, "REMV_DAY"))
		{
			g_Message("EE", "미래일자로 매출등록이 불가합니다.");
			return;
		}
		
		if (!confirm("[ " + ds_list.getColumn(nRow, "REMV_DAY") + "] 매출을 등록 하시겠습니까?\n일마감 후 수거량 수정이 불가합니다.", "확인", "default")) return;

		var sReceiptNum = "";
		if(!gfn_isNull(ds_list.getColumn(nRow, "RECEIPT_NUM")))
		{
			sReceiptNum = ds_list.getColumn(nRow, "RECEIPT_NUM");
		}

		var args = "REMV_DAY="       + wrapQuote(ds_list.getColumn(nRow, "REMV_DAY"))
				 + " UPJANG="        + wrapQuote(ds_list.getColumn(nRow, "UPJANG"))
				 + " CUSTCD="        + wrapQuote(ds_list.getColumn(nRow, "CUSTCD"))
				 + " MU_CD="         + wrapQuote(ds_list.getColumn(nRow, "MU_CD"))
				 + " CC_CD="         + wrapQuote(ds_list.getColumn(nRow, "CC_CD"))
				 + " REMV_AMT="      + wrapQuote(ds_list.getColumn(nRow, "REMV_AMT"))
				 + " REMV_QTY="      + wrapQuote(ds_list.getColumn(nRow, "REMV_QTY"))
				 + " CONTRACT_AMT="  + wrapQuote(ds_list.getColumn(nRow, "CONTRACT_AMT"))
				 + " RECEIPT_NUM="  + wrapQuote(sReceiptNum);
				 
		jsp_transaction(
			  this                                 // 해당 스크립트를 호출하는 Form 객체
			, "MAS50030E_T001"                     // 서비스 ID
			, "U_svc::ma/mas/MAS50030E_T001.jsp"   // 서비스 URL
			, "ds_cond=ds_cond"                    // 서버로 전송할 DataSet 객체 Str
			, ""                                   // 서버로부터 전송 받을 DataSet 객체 String
			, args                                 // 서버로 전송할 기타 Argument 정보 String
			, "fn_callBackSave"                    // 서버에서 처리가 완료된 후 Callback 받을 Function 명
			, true                                 // 에러 발생 시 Callback 함수 호출 여부
			, false                                // 처리중입니다. 메시지 창 보여줄지 여부 설정하기
			, false                                // 동기식으로 설정할지 여부
		);
	}
}

function fn_callBackSave(errCode, errMsg) 
{
	if( errCode != 0 ) {
		g_Message("EE", errMsg);
		return;
	} else {
		g_Message("02", "매출 등록을 완료하였습니다.");
		fn_search();
	}
}

/*-----------------------------------------------------------------------------------------
 * 설명      : 수거량, 발생량 변경시
 *----------------------------------------------------------------------------------------*/
function ds_list_onvaluechanged(obj:Dataset,  e:DSColChangeEventInfo)
{
	if ( e.columnid == "REMV_QTY" ) 
	{
		ds_total.setColumn(0, "REMV_QTY", ds_total.getColumn(0, "REMV_QTY") + gfn_parseFloat(e.newvalue) - gfn_parseFloat(e.oldvalue))
	
		var nRemvQty = toNumber(e.newvalue);
		var nContractAmt = toNumber(obj.getColumn(e.row, "CONTRACT_AMT"));
		var nRemvAmt;
		
		nRemvAmt = Math.round(nRemvQty * nContractAmt);
		obj.setColumn(e.row, "REMV_AMT", nRemvAmt);
	}
	else if ( e.columnid == "OCCUR_QTY" )
	{
		ds_total.setColumn(0, "OCCUR_QTY", gfn_parseFloat(ds_total.getColumn(0, "OCCUR_QTY")) + gfn_parseFloat(e.newvalue) - gfn_parseFloat(e.oldvalue));
	}	
}
]]></Script>
  </Form>
</FDL>
