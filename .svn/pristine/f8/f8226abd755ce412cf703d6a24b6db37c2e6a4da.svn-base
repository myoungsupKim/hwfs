<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="../../../default_typedef.xml"/>
  <Form id="FSP00232E" onload="form_onload" titletext="재고반영취소" position="absolute 0 0 1252 725" scrollbars="none" onkeydown="frm_OnKeyDown" onclose="frm_onclose" onbeforeclose="frm_onbeforeclose">
    <Layouts>
      <Layout>
        <Grid selecttype="row" autoenter="select" binddataset="ds_stock" cellsizingtype="both" readonly="false" enable="true" id="grdStock" useinputpanel="false" onheadclick="grdStock_OnHeadClick" taborder="10" tabstop="true" usecontextmenu="true" useselcolor="true" visible="true" wheelscrollrow="1" position="absolute 0 130 1237 710" autofittype="col" anchor="all" oncelldblclick="grdStock_oncelldblclick">
          <Formats>
            <Format id="Default">
              <Columns>
                <Column size="30"/>
                <Column size="53"/>
                <Column size="76"/>
                <Column size="63"/>
                <Column size="148"/>
                <Column size="87"/>
                <Column size="56"/>
                <Column size="56"/>
                <Column size="64"/>
                <Column size="45"/>
                <Column size="80"/>
                <Column size="0"/>
                <Column size="45"/>
                <Column size="80"/>
                <Column size="45"/>
                <Column size="80"/>
                <Column size="70"/>
                <Column size="70"/>
                <Column size="70"/>
              </Columns>
              <Rows>
                <Row size="26" band="head"/>
                <Row size="24"/>
                <Row size="24" band="summ"/>
              </Rows>
              <Band id="head">
                <Cell displaytype="text" class="head_Excel"/>
                <Cell col="1" displaytype="text" style="align:center;" text="대분류"/>
                <Cell col="2" displaytype="text" style="align:center;" text="중분류"/>
                <Cell col="3" displaytype="text" style="align:center;" text="자재코드"/>
                <Cell col="4" displaytype="text" style="align:center;" text="자재명"/>
                <Cell col="5" displaytype="text" style="align:center;" text="규격"/>
                <Cell col="6" displaytype="text" style="align:center;" text="구매단위"/>
                <Cell col="7" displaytype="text" style="align:center;" text="수불단위"/>
                <Cell col="8" displaytype="text" style="align:center;" text="재고단가"/>
                <Cell col="9" displaytype="text" style="align:center;" text="재고량"/>
                <Cell col="10" displaytype="text" style="align:center;" text="재고금액"/>
                <Cell col="11" displaytype="text" style="align:center;" text="예상사용량"/>
                <Cell col="12" displaytype="text" style="align:center;" text="실사량"/>
                <Cell col="13" displaytype="text" style="align:center;" text="실사금액"/>
                <Cell col="14" displaytype="text" style="align:center;" text="사용량"/>
                <Cell col="15" displaytype="text" style="align:center;" text="사용금액"/>
                <Cell col="16" displaytype="text" style="align:center;" text="유통기한"/>
                <Cell col="17" displaytype="text" style="align:center;" text="제조일"/>
                <Cell col="18" displaytype="text" style="align:center;" text="반영일"/>
              </Band>
              <Band id="body">
                <Cell displaytype="text" style="align:center;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" expr="expr:currow+1"/>
                <Cell col="1" displaytype="text" style="align:left;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:L_CLASS_NAME" suppress="1"/>
                <Cell col="2" displaytype="text" style="align:left;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:M_CLASS_NAME" suppress="1"/>
                <Cell col="3" displaytype="text" style="align:center;background:EXPR(BG_YN=='Y'?(ITEM_CODE=='F178120'?&quot;yellow&quot;:(ITEM_CODE=='F178121'?&quot;yellow&quot;:(ITEM_CODE=='F132747'?&quot;yellow&quot;:&quot;#f26067ff&quot;))):(ITEM_CODE=='F178120'?&quot;yellow&quot;:(ITEM_CODE=='F178121'?&quot;yellow&quot;:(ITEM_CODE=='F132747'?&quot;yellow&quot;:&quot;white&quot;))));background2:EXPR(BG_YN=='Y'?(ITEM_CODE=='F178120'?&quot;yellow&quot;:(ITEM_CODE=='F178121'?&quot;yellow&quot;:(ITEM_CODE=='F132747'?&quot;yellow&quot;:&quot;#f26067ff&quot;))):(ITEM_CODE=='F178120'?&quot;yellow&quot;:(ITEM_CODE=='F178121'?&quot;yellow&quot;:(ITEM_CODE=='F132747'?&quot;yellow&quot;:&quot;white&quot;))));color:EXPR(ITEM_CODE=='F178120'?&quot;red&quot;:(ITEM_CODE=='F178121'?&quot;red&quot;:(ITEM_CODE=='F132747'?&quot;red&quot;:&quot;black&quot;)));color2:EXPR(ITEM_CODE=='F178120'?&quot;red&quot;:(ITEM_CODE=='F178121'?&quot;red&quot;:(ITEM_CODE=='F132747'?&quot;red&quot;:&quot;black&quot;)));" text="bind:ITEM_CODE"/>
                <Cell col="4" displaytype="text" style="align:left;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:ITEM_NAME"/>
                <Cell col="5" displaytype="text" style="align:left;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:ITEM_SIZE"/>
                <Cell col="6" displaytype="text" style="align:center;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:PO_UOM"/>
                <Cell col="7" displaytype="text" style="align:center;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:UOM_CODE"/>
                <Cell col="8" displaytype="number" style="align:right;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:M_STK_PRICE" expr="expr:Math.round(M_STK_PRICE)"/>
                <Cell col="9" displaytype="number" style="align:right;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:M_STK_QTY" mask="###,##0.00"/>
                <Cell col="10" displaytype="number" style="align:right;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:M_STK_AMT" mask="###,##0"/>
                <Cell col="11" displaytype="number" style="align:right;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:MENU_QTY" mask="###,##0.00"/>
                <Cell col="12" displaytype="number" style="align:right;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:M_REAL_QTY" mask="###,##0.00"/>
                <Cell col="13" displaytype="number" style="align:right;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:M_REAL_AMT" mask="###,##0"/>
                <Cell col="14" displaytype="number" style="align:right;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:M_USE_QTY" mask="###,##0.00"/>
                <Cell col="15" displaytype="number" style="align:right;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:M_USE_AMT" mask="###,##0"/>
                <Cell col="16" displaytype="date" style="align:center;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:VALUE_DATE" calendardisplaynulltype="none"/>
                <Cell col="17" displaytype="date" style="align:center;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:MAKER_DATE" calendardisplaynulltype="none"/>
                <Cell col="18" displaytype="date" style="align:center;background:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);background2:EXPR(BG_YN=='Y'?&quot;#f26067ff&quot;:&quot;white&quot;);" text="bind:CLOSE_DATE" calendardisplaynulltype="none"/>
              </Band>
              <Band id="summary">
                <Cell colspan="9" style="align:center;" text="합계"/>
                <Cell col="9" displaytype="number" style="align:right;" expr="expr:ds_stock.getSum('M_STK_QTY')" mask="###,##0.00"/>
                <Cell col="10" displaytype="number" style="align:right;" expr="expr:Math.round(ds_stock.getSum('M_STK_AMT'))" mask="###,##0"/>
                <Cell col="11" displaytype="number" style="align:right;" expr="expr:ds_stock.getSum('MENU_QTY')" mask="###,##0.00"/>
                <Cell col="12" displaytype="number" style="align:right;" expr="expr:ds_stock.getSum('M_REAL_QTY')" mask="###,##0.00"/>
                <Cell col="13" displaytype="number" style="align:right;" expr="expr:Math.round(ds_stock.getSum('M_REAL_AMT'))" mask="###,##0"/>
                <Cell col="14" displaytype="number" style="align:right;" expr="expr:ds_stock.getSum('M_USE_QTY')" mask="###,##0.00"/>
                <Cell col="15" displaytype="number" style="align:right;" expr="expr:Math.round(ds_stock.getSum('M_USE_AMT'))" mask="###,##0"/>
                <Cell col="16" colspan="3" style="align:left;">
                  <Cell displaytype="none" style="align:left;"/>
                  <Cell col="1" displaytype="none" style="align:left;"/>
                  <Cell col="2" displaytype="none" style="align:left;"/>
                </Cell>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Div id="div_cmnBtn" anchor="left top right" taborder="19" url="cmn::CmnBtn.xfdl" text="Div00" scrollbars="none" position="absolute 0 0 1237 30"/>
        <Static id="Static08" class="sta_WFSA_Labelbg" position="absolute 0 30 1237 97" anchor="left top right"/>
        <Static id="Static04" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 30 1236 40"/>
        <Static id="Static05" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 87 1236 97"/>
        <Static id="Static15" text="h6" class="Guide01_AreaRed" visible="false" position="absolute 0 97 1237 103"/>
        <Static id="st_ContractStart" text="사업장" class="sta_WFSA_label" position="absolute 425 40 472 61" anchor="left top"/>
        <Static id="Static07" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 40 15 87" anchor="left top"/>
        <Static id="Static03" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 471 40 481 61" anchor="left top"/>
        <Static id="Static09" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 639 40 669 61" anchor="left top"/>
        <Static id="Static06" text="창고" class="sta_WFSA_label" position="absolute 669 40 704 61" anchor="left top"/>
        <Static id="Static02" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 701 40 711 61" anchor="left top"/>
        <Static id="Static17" text="조사일" class="sta_WFSA_label" position="absolute 15 66 62 87" anchor="left top"/>
        <Static id="Static22" text="재고내역" class="sta_WF_Title01" position="absolute 0 112 74 130"/>
        <Static id="Static16" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 0 125 1237 130"/>
        <Static id="Static71" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 710 1252 725" anchor="left bottom"/>
        <Static id="Static27" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1237 0 1252 710" anchor="top right"/>
        <Combo codecolumn="SUBINV_CODE" datacolumn="SUBINV_NAME" id="cbo_SubInv" imemode="native" index="0" innerdataset="ds_subinv" type="filter" taborder="3" position="absolute 711 40 971 61" onitemchanged="cbo_SubInv_onitemchanged"/>
        <Button id="btn_Date" onclick="g_CalButton_OnClick" taborder="5" tabstop="false" userdata="me_Date" position="absolute 148 66 169 87" class="btn_WF_cal" text="" image=""/>
        <MaskEdit id="me_Date" mask="####-##-##" ontextchanged="me_Date_OnChanged" oneditclick="g_Date_OnFocus" onsetfocus="g_Date_OnFocus" onkillfocus="g_Date_OnKillFocus" taborder="4" type="string" userdata="btn_Date" position="absolute 70 66 149 87" class="msk_WF_Cal"/>
        <CheckBox falsevalue="N" id="chk_PoUom" taborder="7" tabstop="false" text="구매단위조회" truevalue="Y" position="absolute 299 66 389 87" value="Y"/>
        <CheckBox falsevalue="N" id="chk_Amt" taborder="6" tabstop="false" text="금액보기" truevalue="Y" value="false" position="absolute 223 66 290 87"/>
        <Button id="btn_StkCancel" onclick="btn_StkCancel_OnClick" taborder="11" tabstop="false" text="반영취소" position="absolute 1158 66 1234 87" class="btn_WF_Delete" image="" anchor="top right"/>
        <UpjangSearchComponent id="edt_upjang" titletext="업장 검색용 Component" taborder="2" text="UpjangSearchComponent00" position="absolute 481 40 639 61" bindDataset="ds_input" bindUpjangCodeColumn="UPJANG" bindUpjangNameColumn="UPJANGNM" eventBeforeTrigger="" eventAfterTrigger="fn_SubinvPopup" roleSetId=""/>
        <Static id="Static25" text="사업부" class="sta_WFSA_label" position="absolute 15 40 85 61"/>
        <MuSearchComponent id="cbo_mu" titletext="사업부 선택 Component" taborder="0" text="FS 사업부" position="absolute 70 40 185 61" bindDataset="ds_input" bindMuCdColumn="MU" appendText="" onItemChangedEvent="fn_muChange"/>
        <Static id="Static00" text="팀" class="sta_WFSA_label" position="absolute 215 40 242 61"/>
        <TmSearchComponent id="edt_tm" titletext="팀 검색용 Component" taborder="1" text="TmSearchComponent00" position="absolute 269 40 395 61" bindDataset="ds_input" bindTmCdColumn="TM" bindTmNmColumn="TMNM" qoBuCd="" qoMuCd="" qoUseYn="" eventAfterTrigger="fn_tmChange" eventBeforeTrigger=""/>
        <Static id="Static01" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 185 40 215 87" anchor="left top"/>
        <Static id="Static11" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 60 40 70 87" anchor="left top"/>
        <Static id="Static12" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 259 40 269 61" anchor="left top"/>
        <Static id="Static13" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 395 40 425 87" anchor="left top"/>
        <Static id="Static51" text="W05." visible="false" position="absolute 1 61 1237 66" style="background:#ff000055;align:center middle;"/>
        <Static id="Static18" text="반영일" class="sta_WFSA_label" position="absolute 1079 40 1126 61" anchor="left top" visible="false"/>
        <MaskEdit id="me_Apply" taborder="8" type="string" mask="####-##-##" onsetfocus="g_Date_OnFocus" onkillfocus="g_Date_OnKillFocus" oneditclick="g_Date_OnFocus" ontextchanged="me_Apply_OnChanged" class="msk_WF_Cal" position="absolute 1133 40 1212 61" userdata="btn_Apply" visible="false"/>
        <Button id="btn_Apply" taborder="9" tabstop="false" onclick="g_CalButton_OnClick" class="btn_WF_cal" position="absolute 1211 40 1232 61" userdata="me_Apply" visible="false"/>
        <Static id="Static10" text="일괄취소기간" class="sta_WFSA_label" position="absolute 823 103 909 124" anchor="top right" visible="true"/>
        <MaskEdit id="me_DateF" taborder="20" type="string" mask="####-##-##" onsetfocus="g_Date_OnFocus" onkillfocus="g_Date_OnKillFocus" oneditclick="g_Date_OnFocus" position="absolute 915 103 991 124" anchor="top right" visible="true"/>
        <Button id="btn_DateF" taborder="21" tabstop="false" onclick="g_CalButton_OnClick" class="btn_WF_cal" position="absolute 990 103 1011 124" anchor="top right" userdata="me_DateF" visible="true"/>
        <MaskEdit id="me_DateT" taborder="22" type="string" mask="####-##-##" onsetfocus="g_Date_OnFocus" onkillfocus="g_Date_OnKillFocus" oneditclick="g_Date_OnFocus" position="absolute 1013 103 1089 124" anchor="top right" visible="true"/>
        <Button id="btn_DateT" taborder="23" tabstop="false" onclick="g_CalButton_OnClick" class="btn_WF_cal" position="absolute 1088 103 1109 124" anchor="top right" userdata="me_DateT" visible="true"/>
        <Button id="btn_Cls" taborder="24" text="재고반영 일괄취소" onclick="btn_Batch_OnClick" class="btn_WF_Custom" position="absolute 1112 103 1237 125" anchor="top right"/>
        <Static id="Static0" text="실사재고 등록시점의 데이타로 현재시점의 내용과 다를 수 있습니다." class="sta_WF_DiscPoint" position="absolute 91 111 546 132" style="color:red;font:Dotum,9,bold;"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_type">
        <ColumnInfo>
          <Column id="PHYSICAL_FLAG" size="1" type="STRING"/>
          <Column id="LOSS_IN_TYPE" size="50" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_stock">
        <ColumnInfo>
          <Column id="BARCODE" size="13" type="STRING"/>
          <Column id="ITEM_CODE" size="12" type="STRING"/>
          <Column id="ITEM_NAME" size="200" type="STRING"/>
          <Column id="ITEM_SIZE" size="100" type="STRING"/>
          <Column id="L_CLASS_NAME" size="50" type="STRING"/>
          <Column id="M_CLASS_NAME" size="50" type="STRING"/>
          <Column id="M_REAL_AMT" size="22" type="BIGDECIMAL"/>
          <Column id="M_REAL_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="M_STK_AMT" size="22" type="BIGDECIMAL"/>
          <Column id="M_STK_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="M_STK_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="M_USE_AMT" size="22" type="BIGDECIMAL"/>
          <Column id="M_USE_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="MENU_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="PO_UOM" size="10" type="STRING"/>
          <Column id="U_REAL_AMT" size="22" type="BIGDECIMAL"/>
          <Column id="U_STK_AMT" size="22" type="BIGDECIMAL"/>
          <Column id="U_STK_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="U_USE_AMT" size="22" type="BIGDECIMAL"/>
          <Column id="UOM_CODE" size="10" type="STRING"/>
          <Column id="VALUE_DATE_INFO" size="100" type="STRING"/>
          <Column id="PHYSIC_DATE" size="8" type="STRING"/>
          <Column id="CLOSE_DATE" size="8" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_subinv">
        <ColumnInfo>
          <Column id="SUBINV_CODE" size="256" type="STRING"/>
          <Column id="SUBINV_NAME_DISP" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_input" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="MU" type="STRING" size="256"/>
          <Column id="TM" type="STRING" size="256"/>
          <Column id="TMNM" type="STRING" size="256"/>
          <Column id="UPJANG" type="STRING" size="256"/>
          <Column id="UPJANGNM" type="STRING" size="256"/>
          <Column id="SUBINV_CODE" type="STRING" size="256"/>
          <Column id="FR_DATE" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row/>
        </Rows>
      </Dataset>
      <Dataset id="ds_applyDate" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="APPLY_DATE_FR" type="STRING" size="256"/>
          <Column id="APPLY_DATE_TO" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_physicCnt" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_stockDate" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="PHYSIC_DATE" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_Cond" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="UPJANG" type="STRING" size="256"/>
          <Column id="CLASS" type="STRING" size="256"/>
          <Column id="SUBINV_CODE" type="STRING" size="256"/>
          <Column id="SYS_CLASS" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_common">
        <ColumnInfo>
          <Column id="code" size="256" type="STRING"/>
          <Column id="codename" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Bind>
      <BindItem id="item0" compid="me_Date" propid="value" datasetid="ds_input" columnid="FR_DATE"/>
      <BindItem id="item1" compid="cbo_SubInv" propid="value" datasetid="ds_input" columnid="SUBINV_CODE"/>
    </Bind>
    <Script type="xscript4.0"><![CDATA[include "U_lib::lib_conversionCom.xjs";

/******************************************************************************************
 * 시스템구분 : 구매관리/재고관리
 * 프로그램명 : FSP00232E.XML
 * 기ㅡㅡㅡ능 : 재고반영취소
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-07-23
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************/
//=========================================================================================
// [ PART 1 ]
// Form에서 Include 할 내용을 정의
//
//=========================================================================================

//=========================================================================================
// [ PART 2 ]
// Form에서 사용될 전역변수를 선언
//
//=========================================================================================
var v_StockClose;
var v_SubulClose, v_StockConfirm, v_ChkDate;
var sPhysic_date, sOnhandMonth, sUpjangName;
var v_ClsMsg;
var v_PO_PHYSICUPD_PRO;
var v_CloseYn = "N";
var v_DupScYn = "N";
//=========================================================================================
// [ PART 3 ]
// Form Loading 시 작업 정의
//
//=========================================================================================
function form_onload(obj:Form, e:LoadEventInfo)
{
	gfn_formOnLoad(this);

	// FSP Action 정보 생성
	fsp_init(this);

	// 화면 초기화
	fn_init();
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_init()
 * 기ㅡㅡㅡ능 : 초기화
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-07-23
 ******************************************************************************************/
function fn_init()
{
	// 그리드 텍스트 변경 : 외식사업부 - 적정재고량, 그외 - 예상사용량
	if( g_Mu_Cd == "2003" )
	{
		fn_setText("RSS")
		grdStock.setFormatColProperty(11, "size", 70);
	}
	else
	{
		fn_setText("FSP")
		grdStock.setFormatColProperty(11, "size", 0);
	}
	

	edt_tm.applyAuthLevel(cbo_mu);
	edt_upjang.applyAuthLevel(edt_tm);

    f_CurrDate = fn_CurrDateWeek();
	me_Date.value  = f_CurrDate;    // 조사일

	if(me_Date.value < "20080701")
	{
		g_Message("EE","2008년7월1일 이전 데이터는 IFIS에서 재고취소할 수 없습니다.");
		me_Date.value = "20080701";
	}

	// 금액필드 숨기기
	grdStock.setFormatColProperty(7,	"size", 0);
	grdStock.setFormatColProperty(10,	"size", 0);
	grdStock.setFormatColProperty(13,	"size", 0);
	grdStock.setFormatColProperty(15,	"size", 0);

	// 업장코드가 있을 경우 창고 조회
	if( gfn_length(gfn_trim(application.g_Upjang) ) > 0 )
	{
		fn_SubinvPopup();
	}

	// 중복 사용 방지 때문에 창 빼기 버튼은 비활성화
//	div_cmnBtn.btn_popup.enable = false;

	// 해당 권한 사용자는 중복 접속 가능함 (관리자(99), 관리자(999), BU권한자(80) )
//	if( SCAuth.isAuthLevel("99") || SCAuth.isAuthLevel("999") || SCAuth.isAuthLevel("80") )
//	{
//		v_DupScYn = "N";
//	}
//	else
//	{
//		v_DupScYn = "Y";
//	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 화면 종료 전 이벤트
 *---------------------------------------------------------------------------------------------*/
function frm_onbeforeclose(obj:Form, e:CloseEventInfo)
{
	if( v_DupScYn == "Y" )
	{
		if( v_CloseYn == "N" && gfn_isNull(gfn_trim(cbo_SubInv.value)) == false )
		{
			fn_dupScreen("D", cbo_SubInv.value);
		}
		
		return true;
	}
	else
	{
		return true;
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 화면 종료 이벤트
 *---------------------------------------------------------------------------------------------*/
function frm_onclose(obj:Form, e:CloseEventInfo)
{
	if( v_DupScYn == "Y" )
	{
		if( v_CloseYn == "N" && gfn_isNull(gfn_trim(cbo_SubInv.value)) == false )
		{
			fn_dupScreen("D", cbo_SubInv.value);
		}

		return true;
	}
	else
	{
		return true;
	}
}

//=========================================================================================
// [ PART 4 ]
// Main Process Event 정의(조회,입력,삭제,저장,출력)
//
//=========================================================================================
/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_search()
 * 기ㅡㅡㅡ능 : 조회
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-07-23
 ******************************************************************************************/
function fn_search()
{
	var phsc_flag = ds_type.getColumn(0, "PHYSICAL_FLAG");

	if( gfn_length(gfn_trim(cbo_SubInv.value) ) == 0 )
	{
		g_Message("EE","창고를 선택하세요.");
		return;
	}
	if( gfn_length(gfn_trim(me_Date.value)) == 0 )
	{
		g_Message("EE","조사일을 선택하세요.");
		return;
	}
	if( gfn_length(gfn_trim(me_Date.value)) == 0 )
	{
		g_Message("EE","조사일을 선택하세요.");
		return;
	}
	if( me_Date.value < "20080701" )
	{
		g_Message("EE","2008년7월1일 이전 데이터는 IFIS에서 재고작업할 수 없습니다.");
		me_Date.setFocus();
		return;
	}

	var v_MenuQty = "";
	if( cbo_mu.getMuCode() == "2003" )
		v_MenuQty = "RSS";
	else
		v_MenuQty = "FSP";

	ds_stock.clearData();

	v_StockClose = "";
	v_SubulClose = "";
	v_StockConfirm = "";
	v_ChkDate = "";

	var strSvcID = "FSP00232E_S001";
	var strURL   = "U_svc::" + "fs/fsp/FSP00232E_S001.jsp";
	var strInDatasets = "";
	var strOutDatasets = "ds_stock=ds_stock";
	var strArgument  = "v_SubinvCode=" + wrapQuote(cbo_SubInv.value);
		strArgument += " v_Date=" + wrapQuote(me_Date.value);
		strArgument += " v_chkPoUom=" + wrapQuote(chk_PoUom.value);
		strArgument += " v_MenuQty=" + wrapQuote(v_MenuQty);
	var strCallbackFunc = "fn_callback";

	jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, true, true, false);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 닫기 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_close()
{
	if( v_DupScYn == "Y" )
	{
		if( v_CloseYn == "N" && gfn_isNull(gfn_trim(cbo_SubInv.value)) == false )
		{
			fn_dupScreen("D", cbo_SubInv.value);
		}

		return true;
	}
	else
	{
		return true;
	}
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_print()
 * 기ㅡㅡㅡ능 : 출력
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-07-23
 ******************************************************************************************/
function fn_print()
{
	if(gfn_length(gfn_trim(cbo_SubInv.value))==0)
	{
		g_Message("EE","창고를 선택하세요.");
		return;
	}

	if(gfn_length(gfn_trim(me_Date.value))==0)
	{
		g_Message("EE","조사일을 선택하세요.");
		return;
	}

	if(ds_stock.getRowCount() == 0){
		g_Message("EE","출력할 데이터가 없습니다!\n조회를 먼저 하시기 바랍니다.");
		return;
	}

	if(ds_stock.getColumn(0,"PHYSIC_DATE") != me_Date.value)
	{
		g_Message("EE","조회된 재고조사일은 [" + ds_stock.getColumn(0,"PHYSIC_DATE") + "]로\n상단의 조사일과 틀립니다.\n\n다시 조회하신 후 출력 하시기 바랍니다.");
		return;
	}

	sPhysic_date = "";
	sOnhandMonth = "";
	sUpjangName = "";

	var sMeDate = gfn_subStr(me_Date.value, 0, 4) + "년 " + gfn_subStr(me_Date.value, 4, 2) + "월 " + gfn_subStr(me_Date.value, 6, 2) + "일";
	var strSvcID,strURL,strInDatasets,strOutDatasets,strArgument,strCallbackFunc;

	// 경로 설정
	strSvcID = "FSP00230E_S003";
	strURL   = "U_svc::" + "fs/fsp/FSP00230E_S003.jsp";

	// 데이터셋 설정
	strInDatasets = "";
	strOutDatasets = "";

	// 파라메터 설정
	strArgument  = "v_SubinvCode=" + wrapQuote(cbo_SubInv.value);
	strArgument += " v_Date=" + wrapQuote(me_Date.value);
	strArgument += " v_PhysicalFlag=" + wrapQuote("Y");

	// 콜백함수 지정
	strCallbackFunc = "";

	http.Sync = true;
	Transaction(strSvcID,strURL,strInDatasets,strOutDatasets,strArgument,strCallbackFunc);
	http.Sync = false;

	// 레포트에 전달할 파라메터 생성
	var arrParams = SCReport.newParams();

	// 레포트 url
	SCReport.setParams (arrParams, SCReport.RPT_NAME, "/IFIS/FSP00230E_재고조사표.ozr");

	// 출력 옵션 설정
	SCReport.setParams(arrParams, SCReport.RPT_TITLE, "재고조사표");

	// 레포트에 맞게 전달되는 개발자 정의 파라미터
	
	SCReport.setParams (arrParams, "PARAM1", cbo_SubInv.value);	// 창고코드
	SCReport.setParams (arrParams, "PARAM2", me_Date.value);	// 조사일
	SCReport.setParams (arrParams, "PARAM3", "");				// 수불마감월
	SCReport.setParams (arrParams, "PARAM4", sUpjangName);		// 업장(창고명)
	SCReport.setParams (arrParams, "PARAM5", sMeDate);			// 재고조사일
	SCReport.setParams (arrParams, "PARAM6", "N"); 				// 반영전:Y,반영후:N
	SCReport.setParams (arrParams, "PARAM7", chk_PoUom.value); 	// 구매단위:Y,수불단위:N

	if( cbo_mu.getMuCode() == "2003" )
		SCReport.setParams (arrParams, "PARAM8", "Y"); 	// 외식사업부:Y, 그외:N
	else
		SCReport.setParams (arrParams, "PARAM8", "N"); 	// 외식사업부:Y, 그외:N

	SCReport.setParams (arrParams, "zoom", 150);

	SCReport.viewReport (this, arrParams);
}

//=========================================================================================
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
//
//=========================================================================================
/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_callback(nErrorCode, strErrorMsg, strSvcID)
 * 기ㅡㅡㅡ능 : 콜백 처리
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-07-23
 ******************************************************************************************/
function fn_callback(nErrorCode, strErrorMsg, strSvcID)
{
	// 조회
	if( strSvcID == "FSP00232E_S001" )
	{
		if(nErrorCode!=0)
		{
			g_Message("EE","시스템오류 ! 전산 담당자에게 문의 하세요.\n" + strErrorMsg);
			ds_stock.clearData();
			return;
		}

		if(ds_stock.getCountNF() <= 0)
		{
			g_Message("EE","재고반영내역이 존재하지 않습니다!");
			return;
		}

		if(chk_PoUom.value == "Y")
		{
			grdStock.setFormatColProperty(6,"size",56);
			grdStock.setFormatColProperty(7,"size",0);
		}
		else
		{
			grdStock.setFormatColProperty(6,"size",0);
			grdStock.setFormatColProperty(7,"size",56);
		}

		if(chk_Amt.value == "Y")
		{
			grdStock.setFormatColProperty(10,"size",80);
			grdStock.setFormatColProperty(13,"size",80);
			grdStock.setFormatColProperty(15,"size",80);
		}
		else
		{
			grdStock.setFormatColProperty(10,"size",0);
			grdStock.setFormatColProperty(13,"size",0);
			grdStock.setFormatColProperty(15,"size",0);
		}

		btn_StkCancel.enable = true;
		btn_Cls.enable = true;

		// 재고마감이 이루어져 반영취소가 불가합니다.\n재고마감관리자에게 연락하세요.
		if(gfn_length(gfn_trim(v_StockClose))!= 0)
		{
			g_Message("EE",v_StockClose);
			//ds_stock.ClearData();
			btn_StkCancel.enable = false;
			return;
		}

		// 현창고는 수불마감(" + rs.getString("CLS_YYYYMM") + ")이 \n완료되어 본작업이 불가합니다!
		if(gfn_length(gfn_trim(v_SubulClose))!= 0)
		{
			g_Message("EE",v_SubulClose);
			//ds_stock.ClearData();
			btn_StkCancel.enable = false;
			return;
		}

		// 월마감 체크
		var dateFr = me_Date.value;
/*
		mfn_GetClsStatus(dateFr.substr(0, 6));

		if (ds_common.rowcount > 0)
		{
			g_Message("EE", dateFr.substr(0, 4) + "년 " + dateFr.substr(4, 2) + "월 마감이 완료되어 취소가 불가합니다.");
			btn_StkCancel.enable = false;
			return;
		}
*/
		// 월마감 체크 함수 수정 2015.12.28
		mfn_GetCcMonthClsYn("U", edt_upjang.getUpjangCode(), dateFr.substr(0, 6), "01");

		if( ds_common.getColumn(0, 0) == "Y" )
		{
			g_Message("EE", dateFr.substr(0, 4) + "년 " + dateFr.substr(4, 2) + "월 마감이 완료되어 취소가 불가합니다.(재경팀 문의)");
			btn_StkCancel.enable = false;
			return;
		}

	}

	// 반영 취소
	if( strSvcID == "FSP00232E_T001" )
	{
		if(nErrorCode != 0)
		{
			g_Message("EE", "시스템오류 ! 전산 담당자에게 문의 하세요.\n" + strErrorMsg);
			return;
		}
		else
		{
			// 재고취소일은 현재일보다 작거나 같아야 합니다.
			if( gfn_length(gfn_trim(v_StockClose)) != 0 )
			{
				g_Message("EE", v_StockClose);
				btn_StkCancel.enable = false;
			}

			// 현창고는 수불마감(" + rs.getString("CLS_YYYYMM") + ")이 \n완료되어 본작업이 불가합니다!
			if( gfn_length(gfn_trim(v_SubulClose)) != 0 )
			{
				g_Message("EE", v_SubulClose);
				btn_StkCancel.enable = false;
			}

			// 현창고는 재고 취소가 반영되어 본작업이 불가합니다!
			if( gfn_length(gfn_trim(v_StockConfirm)) != 0 )
			{
				g_Message("EE", v_StockConfirm);
				btn_StkCancel.enable = false;
				return;
			}

			// 구매 SP 호출 후 리턴 메세지 처리
			if( gfn_length(gfn_trim(v_PO_PHYSICUPD_PRO)) != 0 )
			{
				g_Message("EE", v_PO_PHYSICUPD_PRO);
				return;
			}

			g_Message("02", "재고 반영 취소를 완료하였습니다.!");
			ds_stock.clearData();
		}
	}

	// 기간 반영취소
	if( strSvcID == "FSP00232E_T002" )
	{
		// 기간 반영취소 validation msg
		if( gfn_length(gfn_trim(v_ClsMsg)) != 0 )
		{
			g_Message("EE", v_ClsMsg);
			return;		
		}
		
		// 구매 SP 호출 후 리턴 메세지 처리
		if( gfn_length(gfn_trim(v_PO_PHYSICUPD_PRO)) != 0 )
		{
			g_Message("EE", v_PO_PHYSICUPD_PRO);
			return;
		}

		ds_stock.clearData();
		g_Message("02", "일괄취소되었습니다.");
	}
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_SubinvPopup()
 * 기ㅡㅡㅡ능 : 창고 조회
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-07-23
 ******************************************************************************************/
function fn_SubinvPopup()
{
	ds_stock.clearData();
	ds_subinv.clearData();

	if( gfn_length(ds_input.getColumn(0, "UPJANG")) <= 0 ) return;

	var strPOQuery_SUBINV              = "";
	var strPOQuery_SUBINVKeyField      = "SUBINV_CODE";
	var strPOQuery_SUBINVValueField    = "SUBINV_NAME || UPJANGNM";
	var strPOQuery_SUBINVKeyFieldNM    = "창고코드";
	var strPOQuery_SUBINVValueFieldNM  = "창고명";
	var strPOQuery_SUBINVCaption       = "창고정보조회";

	strPOQuery_SUBINV += "SELECT A.SUBINV_CODE \n";
    strPOQuery_SUBINV += "     , DECODE(A.USE_YN, 'N' , '폐장' )||A.SUBINV_NAME||' ( '||REPLACE(B.UPJANGNM,'단체급식 ')||' ) ' SUBINV_NAME \n";
    strPOQuery_SUBINV += "  FROM HLDC_PO_SUBINVENTORY A \n";
    strPOQuery_SUBINV += "     , HLDC_ST_UPJANG B \n";
    strPOQuery_SUBINV += " WHERE A.UPJANG = B.UPJANG \n";
    strPOQuery_SUBINV += "   AND A.USE_YN = 'Y' \n";
    strPOQuery_SUBINV += "   AND A.SUBINV_CODE < 'S10' \n";
    strPOQuery_SUBINV += "   AND A.STOCK_FLAG = 'Y' \n";
	strPOQuery_SUBINV += "   AND B.UPJANG = " + gfn_toString(ds_input.getColumn(0, "UPJANG")) + " \n";
	strPOQuery_SUBINV += "ORDER BY CASE WHEN SUBSTR(A.SUBINV_CODE, 0, 1) = 'C' THEN 0 \n";
	strPOQuery_SUBINV += "              WHEN SUBSTR(A.SUBINV_CODE, 0, 1) = 'E' THEN 1 \n";
	strPOQuery_SUBINV += "              WHEN SUBSTR(A.SUBINV_CODE, 0, 1) = 'A' THEN 2 \n";
	strPOQuery_SUBINV += "              ELSE 4 END, A.SUBINV_CODE \n";

	fn_sql_common(
	              "C"
	             ,strPOQuery_SUBINV
	             ,""
	             ,""
	             ,""
	             ,cbo_SubInv
	             ,-1
	             ,ds_subinv
	             );

	cbo_SubInv.index = 0;
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_getApplyDate
 * 기ㅡㅡㅡ능 : 반영취소일 조회
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_getApplyDate(strDate)
{
	var strSvcID = "FSP00232E_S002";
	var strURL   = "U_svc::" + "fs/fsp/FSP00232E_S002.jsp";
	var strInDatasets = "";
	var strOutDatasets = "ds_applyDate=ds_applyDate";
	var strArgument  = "v_SubinvCode=" + wrapQuote(cbo_SubInv.value);
		strArgument += " v_Date=" + wrapQuote(me_Date.value);
		strArgument += " v_AppDate=" + wrapQuote(strDate);
	var strCallbackFunc = "";

	jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, false, false, true);

	var str_applyDate = "";
	var frDate = ds_applyDate.getColumn(0, "FR_DATE");
	var toDate = ds_applyDate.getColumn(0, "TO_DATE");

	if( frDate == toDate )
	{
		if( frDate != strDate )
		{
			str_applyDate = "재고 반영일은 " + frDate.substr(0, 4) + "년" + frDate.substr(4, 2) + "월" + frDate.substr(6, 2) + "일만 선택 가능합니다.";		
		}
	}
	else
	{
		if( strDate < frDate || strDate > toDate )
		{
			str_applyDate  = "재고 반영일은 " + frDate.substr(0, 4) + "년" + frDate.substr(4, 2) + "월" + frDate.substr(6, 2) + "일에서 ";
			str_applyDate += toDate.substr(0, 4) + "년" + toDate.substr(4, 2) + "월" + toDate.substr(6, 2) + "일까지 선택 가능합니다.";
		}
	}

	return str_applyDate;
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_setText()
 * 기ㅡㅡㅡ능 : 그리드 텍스트 변경
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_setText(sType)
{
	if( sType == "RSS" )
		grdStock.setCellProperty("head", 11, "text", "적정재고량");
	else
		grdStock.setCellProperty("head", 11, "text", "예상사용량");
}

//=========================================================================================
// [ PART 6 ]
// component Event 정의 ( User Define function )
// 
//=========================================================================================
/******************************************************************************************
 * 함ㅡ수ㅡ명 : btn_StkCancel_OnClick(obj:Button, e:ClickEventInfo)
 * 기ㅡㅡㅡ능 : 반영취소
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function btn_StkCancel_OnClick(obj:Button, e:ClickEventInfo)
{
	if( ds_stock.getCountNF() <= 0 )
	{
		g_Message("EE","저장할 데이터가 없습니다!");
		return;
	}

	if( gfn_length(gfn_trim(cbo_SubInv.value)) == 0 )
	{
		g_Message("EE","창고를 선택하세요.");
		return;
	}

	if( gfn_length(gfn_trim(me_Date.value)) == 0 )
	{
		g_Message("EE","조사일을 선택하세요.");
		return;
	}
/*
	if( gfn_length(gfn_trim(me_Apply.value)) == 0  )
	{
		g_Message("EE","반영일을 선택하세요.");
		me_Apply.setFocus();
		return;
	}
*/

	if(ds_stock.getColumn(0,"PHYSIC_DATE") != me_Date.value)
	{
		g_Message("EE","조회된 재고조사일은 [" + ds_stock.getColumn(0,"PHYSIC_DATE") + "]로\n상단의 조사일과 틀립니다.\n\n다시 조회하신 후 반영취소 하시기 바랍니다.");
		return;
	}
/*
	var applyDate = fn_getApplyDate(me_Apply.value);

	if( !gfn_isNull(applyDate) )
	{
		g_Message("EE", applyDate);
		return;
	}
*/

	// 조사일 이후의 재고실사 여부 확인
	if( !fn_getPhysicYn() )
	{
		g_Message("EE", "재고취소 미처리건이 존재합니다.\n재고조사일 이후 일자에 대한 재고취소 여부를 확인하세요.");
		return;
	}

	if(!g_Confirm("02", "재고반영을  취소하시겠습니까?!")) return;

	v_PO_PHYSICUPD_PRO = "";
	v_PO_PHYSICAPT_PRO = "";
	v_StockConfirm = "";

	var strSvcID = "FSP00232E_T001";
	var strURL   = "U_svc::" + "fs/fsp/FSP00232E_T001.jsp";
	var strInDatasets = "ds_stock=ds_stock";
	var strOutDatasets = "";
	var strArgument  = "v_SubinvCode=" + wrapQuote(cbo_SubInv.value);
		strArgument += " v_Date=" + wrapQuote(ds_stock.getColumn(0,"PHYSIC_DATE"));
//		strArgument += " v_applyDate=" + wrapQuote(me_Apply.value);
		strArgument += " v_chkPoUom=" + wrapQuote(chk_PoUom.value);
		strArgument += " v_status='N'";
		strArgument += " v_trType='C'";
	var strCallbackFunc = "fn_callback";

	jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, true, true, false);
}

function me_Date_OnChanged(obj:MaskEdit, e:TextChangedEventInfo)
{
	if(gfn_length(me_Date.value)== 8 && me_Date.value < "20080701")
	{
		g_Message("EE","2008년7월1일 이전 데이터는 IFIS에서 재고취소할 수 없습니다.");
		me_Date.value = "20080701";
	}
}

function frm_OnKeyDown(obj:Form, e:KeyEventInfo)
{
	gfn_formKeyDown(obj, e);
	
	//엔터시 조회
	if ( (e.keycode == 13) && (e.fromreferenceobject == me_Date) ) fn_search();
}
/*----------------------------------------------------------------------------------------------
 * 설명      : 사업부 콤보 변경 이벤트
 *---------------------------------------------------------------------------------------------*/
function fn_muChange(obj, event)
{
	edt_tm.setTmCode("");
	edt_upjang.setUpjangCode("");
	fn_SubinvPopup();

	if( cbo_mu.getMuCode() == "2003" )
	{	fn_setText("RSS")
		grdStock.setFormatColProperty(11, "size", 70);
	}
	else
	{
		fn_setText("FSP")
		grdStock.setFormatColProperty(11, "size", 0);
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 팀 변경 이벤트
 *---------------------------------------------------------------------------------------------*/
function fn_tmChange(obj, data)
{
	edt_upjang.setUpjangCode("");
	fn_SubinvPopup();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 재고반영 일괄취소
 *---------------------------------------------------------------------------------------------*/
function btn_Batch_OnClick(obj:Button,  e:ClickEventInfo)
{
	if( gfn_length(gfn_trim(cbo_SubInv.value)) == 0 )
	{
		g_Message("EE","창고를 선택하세요.");
		cbo_SubInv.setFocus();
		return;
	}

	var dateFr = me_DateF.value;
	var dateTo = me_DateT.value;

	if( gfn_length(dateFr) < 8 )
	{
		g_Message("EE", "시작일자를 정확하게 입력하세요.");
		me_DateF.setFocus();
		return;
	}

	if( gfn_length(dateTo) < 8 )
	{
		g_Message("EE", "종료일자를 정확하게 입력하세요.");
		me_DateT.setFocus();
		return;
	}

	if( dateTo < dateFr )
	{
		g_Message("EE", "시작일자가 종료일자보다 클 수 없습니다.");
		me_DateF.setFocus();
		return;
	}

	// 월마감 확인
	if( dateFr.substr(0, 6) == dateTo.substr(0, 6) )
	{
/*
		mfn_GetClsStatus(dateFr.substr(0, 6));

		if (ds_common.rowcount > 0)
		{
			g_Message("EE", dateFr.substr(0, 4) + "년 " + dateFr.substr(4, 2) + "월 마감이 완료되어 취소가 불가합니다.");
			return false;
		}
*/
		// 월마감 체크 함수 수정 2015.12.28
		mfn_GetCcMonthClsYn("U", edt_upjang.getUpjangCode(), dateFr.substr(0, 6), "01");

		if( ds_common.getColumn(0, 0) == "Y" )
		{
			g_Message("EE", dateFr.substr(0, 4) + "년 " + dateFr.substr(4, 2) + "월 마감이 완료되어 취소가 불가합니다.");
			return false;
		}

	}
	else
	{
/*
		mfn_GetClsStatus(dateFr.substr(0, 6));
		if (ds_common.rowcount > 0)
		{
			g_Message("EE", dateFr.substr(0, 4) + "년 " + dateFr.substr(4, 2) + "월 마감이 완료되어 취소가 불가합니다.");
			return false;
		}
		
		mfn_GetClsStatus(dateTo.substr(0, 6));
		if (ds_common.rowcount > 0)
		{
			g_Message("EE", dateTo.substr(0, 4) + "년 " + dateTo.substr(4, 2) + "월 마감이 완료되어 취소가 불가합니다.");
			return false;
		}
*/
		// 월마감 체크 함수 수정 2015.12.28
		mfn_GetCcMonthClsYn("U", edt_upjang.getUpjangCode(), dateFr.substr(0, 6), "01");

		if( ds_common.getColumn(0, 0) == "Y" )
		{
			g_Message("EE", dateFr.substr(0, 4) + "년 " + dateFr.substr(4, 2) + "월 마감이 완료되어 취소가 불가합니다.");
			return false;
		}

		// 월마감 체크 함수 수정 2015.12.28
		mfn_GetCcMonthClsYn("U", edt_upjang.getUpjangCode(), dateTo.substr(0, 6), "01");

		if( ds_common.getColumn(0, 0) == "Y" )
		{
			g_Message("EE", dateTo.substr(0, 4) + "년 " + dateTo.substr(4, 2) + "월 마감이 완료되어 취소가 불가합니다.");
			return false;
		}
	}

	var subinvNm = cbo_SubInv.text;

	if( !g_Confirm("01", subinvNm + "창고의\n해당기간 재고 반영을 일괄 취소하시겠습니까?!") )	return;

	v_PO_PHYSICUPD_PRO = "";
	v_ClsMsg = "";

	var dayCnt = gfn_getDiffDay(me_DateF.value, me_DateT.value);
	var sDate = me_DateF.value;

	// 취소일자 데이터셋 생성
	ds_stockDate.clearData();

	for( var i = 0; i <  dayCnt + 1; i++ )
	{
		if( i == 0 )
			sDate = gfn_addDate(sDate, 0);
		else
			sDate = gfn_addDate(sDate, 1);

		var nRow = ds_stockDate.insertRow(0);
		ds_stockDate.setColumn(nRow, "PHYSIC_DATE", sDate);
	}

	var strSvcID = "FSP00232E_T002";
	var strURL   = "U_svc::" + "fs/fsp/FSP00232E_T002.jsp";
	var strInDatasets  = "ds_stockDate=ds_stockDate";
	var strOutDatasets = "";
	var strArgument  = "v_SubinvCode=" + wrapQuote(cbo_SubInv.value);
		strArgument += " v_FrDate=" + wrapQuote(me_DateF.value);
		strArgument += " v_ToDate=" + wrapQuote(me_DateT.value);
	var strCallbackFunc = "fn_callback";

	jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, true, true, false);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 재고조사일 이후 일자에 대한 재고 실사여부 확인
 *---------------------------------------------------------------------------------------------*/
function fn_getPhysicYn()
{
	var rtn = true;

	var strSvcID = "FSP00232E_S003";
	var strURL   = "U_svc::" + "fs/fsp/FSP00232E_S003.jsp";
	var strInDatasets  = "";
	var strOutDatasets = "ds_physicCnt=ds_physicCnt";
	var strArgument  = "v_SubinvCode=" + wrapQuote(cbo_SubInv.value);
		strArgument += " v_Date=" + wrapQuote(ds_stock.getColumn(0,"PHYSIC_DATE"));
	var strCallbackFunc = "fn_callback";

	jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, false, false, true);

	if( ds_physicCnt.getColumn(0, "PHYSIC_CNT") > 0 )
		rtn = false;
	else
		rtn = true;

	return rtn;
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 창고 변경시 데이터 초기화
 *---------------------------------------------------------------------------------------------*/
function cbo_SubInv_onitemchanged(obj:Combo, e:ItemChangeEventInfo)
{
	ds_stock.clearData();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 창고 변경시 화면 중복사용을 체크한다.(사용 안함)
 *---------------------------------------------------------------------------------------------*/
function cbo_SubInv_OnChanged(obj:Combo, e:ItemChangeEventInfo)
{
	if( v_DupScYn == "N" )	return;

	if( !gfn_isNull(gfn_trim(e.postvalue)) )
	{
		if( fn_dupScreen("I", e.postvalue) )
		{
			if( !gfn_isNull( e.prevalue ) )
				fn_dupScreen("D", e.prevalue);
		}
		else
		{
			if( !gfn_isNull( e.prevalue ) )
				fn_dupScreen("D", e.prevalue);

				obj.index = 0;
				btn_StkCancel.enable = true;
				btn_Cls.enable = true;
		}
	}
	else
	{
		if( !gfn_isNull( e.prevalue ) )
			fn_dupScreen("D", e.prevalue);
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 창고별 화면 중복 사용을 체크한다.(사용안함)
 *---------------------------------------------------------------------------------------------*/
function fn_dupScreen(gubun, subInv_code)
{
	v_StockClose = "";

	ds_Cond.clearData();
	ds_Cond.addRow();

	ds_Cond.setColumn(0, "UPJANG", edt_upjang.getUpjangCode());		// 사업장
	ds_Cond.setColumn(0, "CLASS", gubun);							// 잠금구분 (I : 잠금, D : 해제)
	ds_Cond.setColumn(0, "SUBINV_CODE", subInv_code);				// 창고
	ds_Cond.setColumn(0, "SYS_CLASS", "20");						// 화면 구분(10 : 재고실사, 20 : 재고취소)
	
	
	var strSvcID = "dupScreen";
	var strURL   = "U_svc::" + "fs/fsp/FSP00230E_S005.jsp";
	var strInDatasets  = "ds_Cond=ds_Cond";
	var strOutDatasets = "";
	var strArgument  = "";
	var strCallbackFunc = "fn_callback";

	jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, false, false, true);

	var rtn = false;
	if( v_CloseYn == "Y" )
	{
		rtn = false;
		
		btn_StkCancel.enable = false;
		btn_Cls.enable = false;
		
		g_Message("EE", v_StockClose);
	}
	else
	{
		rtn = true;

		btn_StkCancel.enable = true;
		btn_Cls.enable = true;
	}

	return rtn;
}


//상세팝업 (품목별 전월재고, 입고 내역 조회) 20190405 김호석
function grdStock_oncelldblclick(obj:Grid, e:GridClickEventInfo)
{
	if (ds_stock.rowcount < 1) return;
	if (e.row < 0) return;
	//현지구매품목만, 현지구매쌀 추가 20191112 김호석 
	if ((ds_stock.getColumn(e.row,"ITEM_CODE") == "F178120")
	|| (ds_stock.getColumn(e.row,"ITEM_CODE") == "F178121")
	|| (ds_stock.getColumn(e.row,"ITEM_CODE") == "F132747")) {
			
		var sParam;
		sParam = {fa_chkPoUom:chk_PoUom.value, fa_chkPhysicQty:'N', fa_chkAmt:chk_Amt.value, fa_muCd:cbo_mu.getMuCode(), fa_Upjang:ds_input.getColumn(0,"UPJANG"), fa_subinvCode:ds_input.getColumn(0,"SUBINV_CODE"), fa_itemCode:ds_stock.getColumn(e.row,"ITEM_CODE"), fa_Date:ds_input.getColumn(0,"FR_DATE")};
		
		gfn_dialog("", "U_FSP::FSP00232P.xfdl",sParam);
	}
}]]></Script>
  </Form>
</FDL>
