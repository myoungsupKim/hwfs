<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.5">
  <TypeDefinition url="..\default_typedef.xml"/>
  <Form id="CmmnFrameBottom" classname="frameBottom" left="0" top="0" width="540" height="90" titletext="Bottom Frame" scrollbars="none" style="background:#ffffffff;" onload="CmmnFrameBottom_onload">
    <Layouts>
      <Layout>
        <Button id="btnHome" taborder="6" onclick="btnHome_onclick" cssclass="btn_BOTTOM_Home" left="0" top="0" width="108" height="90"/>
        <Button id="btnSetting" taborder="9" cssclass="btn_BOTTOM_Setup" left="216" top="0" width="108" height="90" onclick="btnSetting_onclick"/>
        <Button id="btnInfo" taborder="10" cssclass="btn_BOTTOM_Info" left="108" top="0" width="108" height="90" onclick="btnInfo_onclick"/>
        <Button id="btnCart" taborder="11" cssclass="btn_BOTTOM_Cart" left="324" top="0" width="108" height="90" onclick="btnCart_onclick"/>
        <Button id="btnLogout" taborder="12" cssclass="btn_BOTTOM_Logout" left="432" top="0" height="90" width="108" onclick="btnLogout_onclick"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_grd" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="msgId" type="STRING" size="256"/>
          <Column id="userId" type="STRING" size="256"/>
          <Column id="dvicId" type="STRING" size="256"/>
          <Column id="title" type="STRING" size="256"/>
          <Column id="body" type="STRING" size="256"/>
          <Column id="msg" type="STRING" size="256"/>
          <Column id="createTime" type="STRING" size="256"/>
          <Column id="totCnt" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Script type="xscript5.0"><![CDATA[//########################################################
// [프로젝트]		FC종합전산 모바일시스템 구축
// [시스템명]		공통 
// [부시스템명]	공통 - 하단프레임
// [프로그램]		CmmnFrameBottom.xfdl
// [설명]
// 		프로젝트 실행 시 하단에 띄워지는 화면
// [작성자명] 		투비소프트
// [작성일자]		2015.01.12
// -----------------[수정이력]--------------------------
// 수정일자 : 수정자 : 수정내용
// 2015.01.12 : 김광호 : 신규생성.
//########################################################
include "lib::lib_Com.xjs"
/*================================================================================
 * 1. 변수 선언
 *===============================================================================*/
this.f_sSetFlag;	// 하단 버튼 중복 클릭 안되도록 셋팅
this.fo_hisPOP = new Array(); //팝업 히스토리

/*================================================================================
 * 2. Form관련 Script
 *===============================================================================*/
 /** 
 * Form의 모든 컴포넌트가 생성되고, 모든 Object가 Load 되었을 때에 발생하는 Event
 * @param
	obj : Event가 발생한 Object
	e : Event Object
 * @return : 없음
 */
this.CmmnFrameBottom_onload = function(obj:Form, e:nexacro.LoadEventInfo)
{
	this.f_sSetFlag = "HOME";
	
	//TODO 변경 필요
	application.goButtom = this;

}


/*----------------------------------------------------------------------------------------------
 * 설명      : 로그인 재 팝업
 *---------------------------------------------------------------------------------------------*/
this.fn_reLogin = function ()
{
	var arg = new Array();
	
	application.goMain.gfn_POP_create("reLogin", "cmmn::CmmnLoginPop.xfdl", "fn_callbackPOP", this, arg, "POP", application.goMain.divBase);
	return false;	
	
}

//HOME 클릭
this.btnHome_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	if(!this.gfn_isNull(application.goMenu.ds_grd))
	{
		if(this.gfn_dsIsUpdated(application.goMenu.ds_grd)==true)
		{	
			application.goMain.gfn_Msg("confirmHome", "확인", "변경된 데이터가 있습니다.\n 화면 이동하겠습니까?!", "YN", true, this);	
		}
		else
		{
			if(this.f_sSetFlag == "HOME" && application.gv_menuId == "HOME" )
			{
				application.goMenu.fn_menuReset();			
			}
			this.f_sSetFlag = "HOME";
			application.goMain.fn_action("HOME");	
		}	
	}
	else if(!this.gfn_isNull(application.goMenu.ds_grd1))
	{
		if(this.gfn_dsIsUpdated(application.goMenu.ds_grd1)==true)
		{	
			application.goMain.gfn_Msg("confirmHome", "확인", "변경된 데이터가 있습니다.\n 화면 이동하겠습니까?!", "YN", true, this);	
		}
		else
		{
			if(this.f_sSetFlag == "HOME" && application.gv_menuId == "HOME" )
			{
				application.goMenu.fn_menuReset();			
			}
			this.f_sSetFlag = "HOME";
			application.goMain.fn_action("HOME");	
		}	
	}
	else
	{
		if(this.f_sSetFlag == "HOME" && application.gv_menuId == "HOME" )
			{
				application.goMenu.fn_menuReset();			
			}
			this.f_sSetFlag = "HOME";
			application.goMain.fn_action("HOME");		
	}		
}

// Info 버튼 클릭 시
this.btnInfo_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{	
	if(!this.gfn_isNull(application.goMenu.ds_grd))
	{
		if(this.gfn_dsIsUpdated(application.goMenu.ds_grd)==true)
		{	
			application.goMain.gfn_Msg("confirmInfo", "확인", "변경된 데이터가 있습니다.\n 화면 이동하겠습니까?!", "YN", true, this);	
		}
		else
		{
			if(this.f_sSetFlag == "INFO" && application.gv_menuId == "INFO" )
			{
				return false;
			}
			this.f_sSetFlag = "INFO";
			application.goMain.fn_action("INFO");
		}	
	}
	else if(!this.gfn_isNull(application.goMenu.ds_grd1))
	{
		if(this.gfn_dsIsUpdated(application.goMenu.ds_grd1)==true)
		{	
			application.goMain.gfn_Msg("confirmInfo", "확인", "변경된 데이터가 있습니다.\n 화면 이동하겠습니까?!", "YN", true, this);	
		}
		else
		{
			if(this.f_sSetFlag == "INFO" && application.gv_menuId == "INFO" )
			{
				return false;
			}
			this.f_sSetFlag = "INFO";
			application.goMain.fn_action("INFO");
		}	
	}
	else
	{
		if(this.f_sSetFlag == "INFO" && application.gv_menuId == "INFO" )
		{
			return false;
		}
		this.f_sSetFlag = "INFO";
		application.goMain.fn_action("INFO");
	}
 	
}

//Setting 버튼 클릭 시
this.btnSetting_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	if(!this.gfn_isNull(application.goMenu.ds_grd))
	{
		if(this.gfn_dsIsUpdated(application.goMenu.ds_grd)==true)
		{	
			application.goMain.gfn_Msg("confirmSetup", "확인", "변경된 데이터가 있습니다.\n 화면 이동하겠습니까?!", "YN", true, this);	
		}
		else
		{
			if(this.f_sSetFlag == "SETTING" && application.gv_menuId == "SETTING" )
			{
				return false;
			}
			this.f_sSetFlag = "SETTING";
			application.gv_menuId = "SETTING";
			application.goMain.fn_action("SETTING");
		}	
	}
	else if(!this.gfn_isNull(application.goMenu.ds_grd1))
	{
		if(this.gfn_dsIsUpdated(application.goMenu.ds_grd1)==true)
		{	
			application.goMain.gfn_Msg("confirmSetup", "확인", "변경된 데이터가 있습니다.\n 화면 이동하겠습니까?!", "YN", true, this);	
		}
		else
		{
			if(this.f_sSetFlag == "SETTING" && application.gv_menuId == "SETTING" )
			{
				return false;
			}
			this.f_sSetFlag = "SETTING";
			application.gv_menuId = "SETTING";
			application.goMain.fn_action("SETTING");
		}	
	}
	else
	{
		if(this.f_sSetFlag == "SETTING" && application.gv_menuId == "SETTING" )
		{
			return false;
		}
		this.f_sSetFlag = "SETTING";
		application.gv_menuId = "SETTING";
		application.goMain.fn_action("SETTING");
	}	
}

// 장바구니 버튼 클릭 시
this.btnCart_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	if(!this.gfn_isNull(application.goMenu.ds_grd))
	{
		if(this.gfn_dsIsUpdated(application.goMenu.ds_grd)==true)
		{	
			application.goMain.gfn_Msg("confirmCart", "확인", "변경된 데이터가 있습니다.\n 화면 이동하겠습니까?!", "YN", true, this);	
		}
		else
		{
			if(this.f_sSetFlag == "CART" && application.gv_menuId == "CART" )
			{
				return false;
			}			
			this.f_sSetFlag = "CART";
			application.goMain.fn_action("CART");
			
		}	
	}
	else if(!this.gfn_isNull(application.goMenu.ds_grd1))
	{
		if(this.gfn_dsIsUpdated(application.goMenu.ds_grd1)==true)
		{	
			application.goMain.gfn_Msg("confirmCart", "확인", "변경된 데이터가 있습니다.\n 화면 이동하겠습니까?!", "YN", true, this);	
		}
		else
		{
			if(this.f_sSetFlag == "CART" && application.gv_menuId == "CART" )
			{
				return false;
			}
			this.f_sSetFlag = "CART";
			application.goMain.fn_action("CART");
		}	
	}
	else
	{
		if(this.f_sSetFlag == "CART" && application.gv_menuId == "CART" )
		{
			return false;
		}
		this.f_sSetFlag = "CART";
		application.goMain.fn_action("CART");
	}	
	
}

// 로그아웃 버튼 온클릭 !!
this.btnLogout_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	if(!this.gfn_isNull(application.goMenu.ds_grd))
	{
		if(this.gfn_dsIsUpdated(application.goMenu.ds_grd)==true)
		{	
			application.goMain.gfn_Msg("confirmLogout", "확인", "변경된 데이터가 있습니다.\n 화면 이동하겠습니까?!", "YN", true, this);	
		}
		else
		{
			application.goMain.gfn_Msg("logout", "로그아웃", "로그아웃 하시겠습니까?", "YN", true, this);
		}	
	}
	else if(!this.gfn_isNull(application.goMenu.ds_grd1))
	{
		if(this.gfn_dsIsUpdated(application.goMenu.ds_grd1)==true)
		{	
			application.goMain.gfn_Msg("confirmLogout", "확인", "변경된 데이터가 있습니다.\n 화면 이동하겠습니까?!", "YN", true, this);	
		}
		else
		{
			application.goMain.gfn_Msg("logout", "로그아웃", "로그아웃 하시겠습니까?", "YN", true, this);
		}	
	}
	else
	{
		application.goMain.gfn_Msg("logout", "로그아웃", "로그아웃 하시겠습니까?", "YN", true, this);
	}
	
}

/** 
 * 팝업 callBack
 * @param  : popname - 팝업을 구분짓는 id
 rtn : 팝업이 닫히면서 전달된 값
 * @return : 없음
 */
this.fn_callbackPOP = function (popname, rtn)
{
	switch (popname)
	{
		case "reLogin":
		if(application.goMain.fo_hisPOP.length < 2)
		{
			if(!this.gfn_isNull(application.gv_progrmId))
			{
				application.goMain.fn_action("SUBMENU");
			}
		}
		break;		
	}
}

/** Message callback 함수
 * @param
	id : id
	rtn : type이 "OK" 일 때는 none
	type이 "YN" 일 때는 "Y" or "N"
 * @return : 없음
 * @note : Alert 이나 Confirm 메시지의 콜백 함수
 *         gfn_Msg(...) 함수를 사용하여 띄운 창을 닫을 때 호출된다.
 */
this.msg_callback = function (id, rtn)
{ 	
	if (id == "logout")
	{
		if (rtn == "Y") 
		{
			application.goMain.fn_action("LOGOUT");			
		}
		else
		{
			return;
		}
	}
	
	if (id == "pushPop")
	{
		
	}
	
	if (id == "confirmHome") // 홈버튼시 확인창 콜백
	{
		if(rtn == "Y"){
			if(this.f_sSetFlag == "HOME" && application.gv_menuId == "HOME" )
			{
				application.goMenu.fn_menuReset();			
			}
			this.f_sSetFlag = "HOME";
			application.goMain.fn_action("HOME");		
		}else if(rtn == "N"){
			
		}
	}
	
	if (id == "confirmInfo") // Info버튼시 확인창 콜백
	{
		if(rtn == "Y"){
			if(this.f_sSetFlag == "INFO" && application.gv_menuId == "INFO" )
			{
				return false;
			}
			this.f_sSetFlag = "INFO";
			application.goMain.fn_action("INFO");
		}else if(rtn == "N"){
			
		}
	}
	
	if (id == "confirmSetup") // Info버튼시 확인창 콜백
	{
		if(rtn == "Y"){
			if(this.f_sSetFlag == "SETTING" && application.gv_menuId == "SETTING" )
			{
				return false;
			}
			this.f_sSetFlag = "SETTING";
			application.gv_menuId = "SETTING";
			application.goMain.fn_action("SETTING");
		}else if(rtn == "N"){
			
		}
	}
	
	if (id == "confirmCart") // Info버튼시 확인창 콜백
	{
		if(rtn == "Y"){
			if(this.f_sSetFlag == "CART" && application.gv_menuId == "CART" )
			{
				return false;
			}
			this.f_sSetFlag = "CART";
			application.goMain.fn_action("CART");
		}else if(rtn == "N"){
			
		}
	}
	
	if (id == "confirmLogout") // Info버튼시 확인창 콜백
	{
		if(rtn == "Y"){
			application.goMain.gfn_Msg("logout", "로그아웃", "로그아웃 하시겠습니까?", "YN", true, this);
		}else if(rtn == "N"){
			
		}
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 수신받은 push알림건 조회
 *---------------------------------------------------------------------------------------------*/
this.fn_search = function()
{
	//검색
	var strSvcID   		 = "search";
	var strUrl     		 = "ms/cmn/mobileCommon/selectPushList.xdo";
	var strInDataset     = "";
	var strOutDataset    = "ds_grd=ds_list";
	var strArguments	 = "userId=" + nexacro.wrapQuote(application.g_userId);
		strArguments	+= " title=" + "";	
	    strArguments	+= " curPageNum=" + "1";	// TODO 현재 페이지번호 추가
	    strArguments	+= " pageRow=" + "1";	// TODO 페이지당 건수
	var strCallbackFunc	 = "fn_callBack";
	var bAsync			 = true;

	this.gfn_transaction(this, strSvcID, strUrl, strInDataset, strOutDataset, strArguments, strCallbackFunc, bAsync);
  	// connect the server 
	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 트랜잭션 콜백 함수 (필수)
 *---------------------------------------------------------------------------------------------*/
this.fn_callBack = function (strSvcID, nErrorCode, strErrorMsg)
{	
	
	// 에러시 gfn_callBack에서 메시지 제공, 화면별 특정 에러 발생시에만 사용하세요.
	if (nErrorCode < 0) 
	{
		return;
	}
	
    switch(strSvcID)
    {		
		//PUSH알림팝업
        case "search" :
			var arg = new Array();
			arg[0] = this.ds_grd.getColumn(0, "title");
			arg[1] = this.ds_grd.getColumn(0, "body");
			
			application.goMain.gfn_POP_create("pushPop", "cmmn::CmmnPushPop.xfdl", "fn_callbackPOP", this, arg, "POP", application.goMain.divBase);
			return false;
	
        break;    
    }    
    
}

]]></Script>
  </Form>
</FDL>
