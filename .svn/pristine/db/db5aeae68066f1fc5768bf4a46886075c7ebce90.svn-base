<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="../../../default_typedef.xml"/>
  <Form id="FSM00221P" onload="form_onload" titletext="레시피일괄변경" position="absolute 0 0 705 360" scrollbars="none">
    <Layouts>
      <Layout>
        <Static id="Static08" class="sta_WFDA_Labelbg" position="absolute 15 66 690 93"/>
        <Static id="Static09" position="absolute 15 150 690 345" style="background:#d2e9ffff;border:1 solid slategray ;"/>
        <Static id="Static04" class="sta_WFDA_Labelbg" position="absolute 15 92 690 119"/>
        <CheckBox id="chk0" taborder="6" tabstop="false" value="false" visible="false" position="absolute 29 162 209 180" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk1" taborder="7" tabstop="false" value="false" visible="false" position="absolute 234 162 414 180" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk2" taborder="8" tabstop="false" value="false" visible="false" position="absolute 439 162 619 180" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk3" taborder="9" tabstop="false" value="false" visible="false" position="absolute 29 190 209 208" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk4" taborder="10" tabstop="false" value="false" visible="false" position="absolute 234 190 414 208" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk5" taborder="11" tabstop="false" value="false" visible="false" position="absolute 439 190 619 208" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk6" taborder="12" tabstop="false" value="false" visible="false" position="absolute 29 218 209 236" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk7" onclick="fn_CheckboxClick" taborder="13" tabstop="false" value="false" visible="false" position="absolute 234 218 414 236"/>
        <CheckBox id="chk8" taborder="14" tabstop="false" value="false" visible="false" position="absolute 439 218 619 236" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk9" taborder="15" tabstop="false" value="false" visible="false" position="absolute 29 247 209 265" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk10" taborder="16" tabstop="false" value="false" visible="false" position="absolute 234 247 414 265" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk11" taborder="17" tabstop="false" value="false" visible="false" position="absolute 439 247 619 265" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk12" taborder="18" tabstop="false" value="false" visible="false" position="absolute 29 277 209 295" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk13" taborder="19" tabstop="false" value="false" visible="false" position="absolute 234 277 414 295" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk14" taborder="20" tabstop="false" value="false" visible="false" position="absolute 439 277 619 295" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk15" taborder="21" value="false" visible="false" position="absolute 29 307 209 325" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk16" taborder="22" value="false" visible="false" position="absolute 234 307 414 325" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk17" taborder="23" tabstop="false" value="false" visible="false" position="absolute 439 307 619 325" onclick="fn_CheckboxClick"/>
        <Button id="btn_Copy" onclick="btn_Copy_OnClick" taborder="26" tabstop="false" text="레시피 일괄 변경" position="absolute 575 124 690 146" class="btn_WF_Custom" image=""/>
        <Static id="Static02" position="absolute 15 40 690 67" class="sta_WFDA_Labelbg"/>
        <Edit id="ed_BEFORE_RECIPE" imemode="native" onkeydown="ed_BEFORE_RECIPE_OnKeyDown" readonly="true" taborder="1" tooltiptext="레시피" position="absolute 132 95 330 116" oneditclick="ed_BEFORE_RECIPE_oneditclick" class="edt_WF_Essential"/>
        <Static id="Static2" text="변경 전 레시피" position="absolute 15 92 130 119" class="sta_WFDA_Label01"/>
        <Edit id="ed_AFTER_RECIPE" imemode="native" ontextchanged="ed_AFTER_RECIPE_OnChanged" onkeydown="ed_AFTER_RECIPE_OnKeyDown" readonly="true" taborder="2" tooltiptext="레시피" position="absolute 469 95 667 116" class="edt_WF_Essential"/>
        <Static id="Static5" text="변경 후 레시피" position="absolute 352 92 467 119" class="sta_WFDA_Label01"/>
        <Button id="btn_BEFORE_RECIPE" onclick="btn_BEFORE_RECIPE_OnClick" taborder="27" tabstop="false" text="" position="absolute 329 95 350 116" class="btn_WF_popSearchEssential" image=""/>
        <Button id="btn_AFTER_RECIPE" onclick="btn_AFTER_RECIPE_OnClick" taborder="28" tabstop="false" text="" position="absolute 666 95 687 116" class="btn_WF_popSearchEssential" image=""/>
        <Edit enable="false" id="ed_CYCLE_REAL_GUBUN" taborder="33" tabstop="false" tooltiptext="구분(주기식단,실재식단)" visible="false" position="absolute 284 12 429 31" oneditclick="ed_CYCLE_REAL_GUBUN_oneditclick"/>
        <Button id="btnCORNER_ALL_CHECK" onclick="btnCORNER_ALL_CHECK_OnClick" taborder="34" tabstop="false" text="코너 전체 선택" position="absolute 459 124 574 146" class="btn_WF_Custom" image=""/>
        <Edit enable="false" id="ed_COPY_OK" imemode="none" taborder="35" tabstop="false" value="N" visible="false" position="absolute 265 12 282 33"/>
        <Edit enable="false" id="ed_AFTER_RECIPE_GUBUN" imemode="native" ontextchanged="ed_AFTER_RECIPE_OnChanged" onkeydown="ed_AFTER_RECIPE_OnKeyDown" readonly="true" taborder="36" tabstop="false" tooltiptext="레시피" visible="false" position="absolute 568 144 580 166"/>
        <Static id="Static01" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 15 0 690 10"/>
        <Static id="Static05" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 0 15 340"/>
        <Static id="Static03" text="w15" onclick="Static02_onclick" class="Guide01_AreaRed" visible="false" position="absolute 690 0 705 340"/>
        <Static id="Static21" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 345 705 360"/>
        <Button id="btn_help" taborder="37" text="도움말" onclick="common_onclick" class="btn_WF_CRUD" position2="absolute r:15 w:58 t:10 h:25" positiontype="position2"/>
        <Button id="btn_close" taborder="38" text="닫기" onclick="fn_Close" class="btn_WF_CRUD" position2="absolute r:74 w:45 t:10 h:25" positiontype="position2"/>
        <Static id="st10" text="사업장" onclick="st10_onclick" class="sta_WFDA_Label01" position="absolute 15 40 130 67"/>
        <Edit id="ed_UPJANG_NM" taborder="39" readonly="true" onkeydown="ed_UPJANG_NM_OnKeyDown" ontextchanged="ed_UPJANG_NM_OnChanged" enable="false" position="absolute 132 43 687 64" tooltiptext="사업장"/>
        <Static id="Static06" text="식당명" class="sta_WFDA_Label01" position="absolute 15 66 130 93"/>
        <Edit id="ed_HALL_NAME" taborder="40" readonly="true" onkeydown="ed_UPJANG_NM_OnKeyDown" ontextchanged="ed_UPJANG_NM_OnChanged" enable="false" position="absolute 132 69 350 90" tooltiptext="식당명"/>
        <Static id="Static3" text="시작/종료일" class="sta_WFDA_Label01" position="absolute 352 66 467 93" onclick="Static3_onclick"/>
        <Calendar id="cal_START_DATE" taborder="41" dateformat="yyyy-MM-dd" position="absolute 469 69 569 90" tooltiptext="시작일" oneditclick="cal_START_DATE_oneditclick" style="color:red;"/>
        <Calendar id="cal_END_DATE" taborder="42" dateformat="yyyy-MM-dd" position="absolute 587 69 687 90" tooltiptext="종료일" style="color:red;"/>
        <Static id="Static07" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 352 0 353 525"/>
        <Static id="Static00" text="h05" class="Guide01_AreaRed" visible="false" position="absolute 338 119 690 124"/>
        <Static id="Static19" text="h05" class="Guide01_AreaRed" visible="false" position="absolute 15 145 690 150" anchor="top right"/>
        <Static id="Static22" text="변경할 코너를 선택하세요." class="sta_WF_Title01" position="absolute 15 132 247 163" anchor="left top"/>
        <Static id="Static17" text="h06" onclick="Static03_onclick" class="Guide01_AreaRed" visible="false" position="absolute 15 119 159 132" anchor="top right"/>
        <Static id="Static10" text="변경할 레시피를 선택하세요." class="sta_WF_Title01" position="absolute 15 22 247 35" anchor="left top"/>
        <Static id="Static11" text="h05" class="Guide01_AreaRed" visible="false" position="absolute 8 35 690 40"/>
        <Static id="Static39" text="~" position="absolute 565 71 592 91" style="align:center middle;"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_upjang_hall_corner">
        <ColumnInfo>
          <Column id="CORNER" size="256" type="STRING"/>
          <Column id="CORNER_NAME" size="256" type="STRING"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="CORNER"/>
            <Col id="CORNER_NAME"/>
          </Row>
        </Rows>
      </Dataset>
    </Objects>
    <Script type="xscript4.0"><![CDATA[include "U_lib::lib_conversionCom.xjs";
/*
 ******************************************************************************************
 * 시스템구분: IFIS/식단관리/식단등록(병원)
 * 프로그램명: FSM00222P.XML
 * 기ㅡㅡㅡ능: 식단등록(병원)-레시피일괄변경
 * 작ㅡ성ㅡ자: 한화S&C 박종세
 * 작성ㅡ일자: 2008-05-13
 * ----------------------------------------------------------------------------------------
 * HISTORY    : 
 ******************************************************************************************
 */
//=========================================================================================
// [ PART 1 ]
// Form에서 Include 할 내용을 정의
//
//========================================================================================= 
//@@컨버터에서 주석처리 #include "lib::tit_comm_0001.js"
//@@컨버터에서 주석처리 #include "lib::sc_comon.js"
//@@컨버터에서 주석처리 #include "lib::fs_common.js"

//=========================================================================================
// [ PART 2 ]
// Form에서 사용될 전역변수를 선언
//
//=========================================================================================

//=========================================================================================
// [ PART 3 ]
// Form Loading 시 작업 정의
//
//=========================================================================================
function form_onload(obj:Form, e:LoadEventInfo)
{
	gfn_formOnLoad(obj, false);

	   //폼 초기화
		fn_InitForm(obj);
}

//폼 초기화
function fn_InitForm(obj)
{
	// action 정보 생성 초기화 
	fsp_init(this);		
	
	// 폼 데이터 초기화
	fn_InitData(false);
}

// 폼데이터 초기화 
function fn_InitData(blnAllClear)
{
	/* 테스트코드    
	 var fa_UPJANG="100855";
	 var fa_UPJANG_NM="동국대강남";
	 var fa_HALL_CD="00701";
	 var fa_HALL_NAME="직원식당";
	 var fa_FROM_DT="20080101";
	 var fa_TO_DT="20080107";
	 var fa_CYCLE_REAL_GUBUN="CYCLE";
   */
  
	 ed_UPJANG_NM.userdata    = fa_UPJANG;	 
	 ed_UPJANG_NM.value        = fa_UPJANG_NM;
	 ed_HALL_NAME.userdata    = fa_HALL_CD;
	 ed_HALL_NAME.value        = fa_HALL_NAME;
	 cal_START_DATE.value     = fa_FROM_DT;
	 cal_END_DATE.value       = fa_TO_DT;
	 ed_CYCLE_REAL_GUBUN.value = fa_CYCLE_REAL_GUBUN;
	 ed_BEFORE_RECIPE.value    = fa_RECIPE_NAME;
	 ed_BEFORE_RECIPE.userdata= fa_RECIPE_CD;
	 
	 //식단 구분이 주기인지 실제인지 확인한다.
	 if(fa_CYCLE_REAL_GUBUN=="REAL")
	 {
		cal_START_DATE.enable=false;
		cal_END_DATE.enable=false;
	 }
	 
	 
	 //초기화 콜백함수 호출
	 fn_After_InitData();
}

//초기화 콜백함수
function fn_After_InitData()
{
	 //데이터 조회
	 fn_search();	
}

//=========================================================================================
// [ PART 4 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,도움말,form닫기)
//
//=========================================================================================
/*------------------------------------------------------------
	1. Function ID : fn_Search()
	2. 개       요 : 업무프로세스에 따른 조회작업
	3. 기       능 : 검색버튼 입력 시 처리되는 작업
	4. 인 수 설 명:
*------------------------------------------------------------*/
function fn_search()
{
	  //필수 입력사항 체크-----------------------------------------------------------------------
	  if (!fn_Chk_SearchKey()) return false;
	
	  //조회 조건만들기-----------------------------------------------------------------------
	   var otherArg;
	   otherArg		= otherArg + " UPJANG="+wrapQuote(ed_UPJANG_NM.userdata);
	   otherArg		= otherArg + " HALL_CD="+wrapQuote(ed_HALL_NAME.userdata);
	   otherArg		= otherArg + " START_DATE="+wrapQuote(cal_START_DATE.value);
	   otherArg		= otherArg + " END_DATE="+wrapQuote(cal_END_DATE.value);
	   otherArg		= otherArg + " BLANK='N'";
	
	  // action 정보 삭제 초기화 
	  fsp_clear(this);
		
	  // 서버에서 조회할 정보 추가 
	  fsp_addSearch(this, "fs/fsc:FSC_UPJANG_HALL_CORNER_S001");

	  // 서버 호출 
	  //http.sync = true;
	  fsp_callService(this, "", "", "", "ds_upjang_hall_corner=ds_upjang_hall_corner" , otherArg, "fn_After_Search");	
	  //조회 실행-----------------------------------------------------------------------------
	  //http.sync = false;
}

// 조회 후 콜백 함수 
function fn_After_Search()
{
   // 데이터셋 플래그 클리어
   ds_upjang_hall_corner.applyChange();   
   // 코너 콤보박스 만들기
   fn_MakeCheckbox();
}


// 조회 조건 검색
function fn_Chk_SearchKey()
{
   //체크로직- 틀리면 return false;  
   //업장
   if(!mfn_Chk_Obj_MustInput(ed_UPJANG_NM)) return false;   
   //업장식당
   if(!mfn_Chk_Obj_MustInput(ed_HALL_NAME)) return false;
   //시작날짜
   if(!mfn_Chk_Obj_MustInput(cal_START_DATE)) return false;
   //종료날짜
   if(!mfn_Chk_Obj_MustInput(cal_END_DATE)) return false;
   
      
   	//시작일 종료일 확인
   if(cal_START_DATE.value>cal_END_DATE.value)
   {
	  g_Message("EE","시작일은 종료일보다 같거나 이전 날짜이어야 합니다.");
	  return false;
	  
   }
  
   return true;
}



/*------------------------------------------------------------
	1. Function ID : fn_Save()
	2. 개       요 : 업무프로세스에 따른 정보 저장작업
	3. 기       능 : 저장버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*------------------------------------------------------------*/
function fn_save()
{
 	// 데이터 유효성 검사
	 if (!fn_DataValidation()){	return false; }
			
	// action 정보 초기화 
	//tit_clearActionInfo(this);
			
	/*tit_addSaveActionInfo(this
			, "fs/fsa:FSA00050E_I001"
			, "fs/fsa:FSA00050E_U001"
			, ""
			, ""
			, ""
			, ""
			, ""
			);
				
	  */
	 // 서버 호출 후 조회 
	 //tit_callService(this, "", "", "ds_in=ds_template_obj:U", "" , "", "fn_After_Save()");
	 // 트랜잭션 종료 
}

//저장 후 콜백 함수 
function fn_After_Save()
{

}

//데이터 유효성검사
function fn_DataValidation()
{
    //체크로직- 틀리면 return false;

    //변경데이터 검사
	//if(!ds_template_obj.GetUpdate())   {alert("변경된 데이터가 없습니다."); return false;}
	
	//입력값 검사 - 컴포넌트 
	//if(!fn_DataValidation_Component()) {return false;}	
	
	//입력값 검사 - 데이터셋
	//if(!fn_DataValidation_DataSet())   {return false;}

    return true;
}

/*------------------------------------------------------------
	1. Function ID : fn_Close()
	2. 개       요 : 업무프로세스에 따른 폼 종료 
	3. 기       능 : 닫기버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*------------------------------------------------------------*/
function fn_Close()
{
	this.close(ed_COPY_OK.value);
		
}

/*------------------------------------------------------------
	1. Function ID : fn_Help()
	2. 개       요 : 업무프로세스에 따른 도움말 
	3. 기       능 : 도움말버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*------------------------------------------------------------*/
function fn_help()
{
}

//=========================================================================================
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
//
//=========================================================================================

//=========================================================================================
// [ PART 6 ]
// component Event 정의 ( User Define function )
// --> component Event의 기요,기능,동작 등 상세내용은 MiPlatform 메뉴얼을 참조하시기 바랍니다.
//=========================================================================================
function fn_MakeCheckbox()
{
	//-------------------------------------------------------
	// 공통코드 데이터셋 - FS0001 레시피 분류 ds_upjang_hall_corner
	//-------------------------------------------------------
	if(ds_upjang_hall_corner.rowcount<=0) {return false;}
	
	var rowCnt=ds_upjang_hall_corner.rowcount;
			
	for(var i=0;i<rowCnt;i++)
	{
		var chkObj = eval("chk"+i);
		chkObj.text     =  ds_upjang_hall_corner.getColumn(i, "CORNER_NAME"); //체크박스 명을 레시피명 
	    chkObj.userdata =  ds_upjang_hall_corner.getColumn(i, "CORNER");	     //체크박스 사용자데이터를 레시피코드 
	}
	
	
	//0부터시작 
	var v_temp=0;
	
	while(v_temp<rowCnt)
	{	
		var chkObj = eval("chk"+v_temp);
		chkObj.enable=true;
		chkObj.visible=true;
		v_temp++;
	}
}

//체크박스 클릭 이벤트
function fn_CheckboxClick(obj)
{
	if(obj.value)
	{
		obj.style.background.color="#FFFFBB";
	}
	else
	{
		obj.style.background.color="-1";
	}
	
}


//코너 전체 선택
function btnCORNER_ALL_CHECK_OnClick(obj:Button, e:ClickEventInfo)
{
	if(ds_upjang_hall_corner.rowcount<=0) {return false;}
	
	var rowCnt=ds_upjang_hall_corner.rowcount;
			
	for(var i=0;i<rowCnt;i++)
	{
		var chkObj = eval("chk"+i);
		if(chkObj.value==false)
		{ chkObj.value=true;
		  fn_CheckboxClick(chkObj); } //체크박스 선택
		else
		{ chkObj.value=false;
		  fn_CheckboxClick(chkObj); } //체크박스 해제
	}
}



//닫기, 도움말 버튼 클릭시 이벤트
function fn_commBtn_OnClick(obj:Button, e:ClickEventInfo)
{
    var fncName = "fn_";
    fncName += gfn_subStr(obj.name, 4);
    eval( fncName + "()");	
}


//////////////////////////////////////
///변경 전 레시피 검색
//////////////////////////////////////
function btn_BEFORE_RECIPE_OnClick(obj:Button, e:ClickEventInfo)
{
	//업장
     if(!mfn_Chk_Obj_MustInput(ed_UPJANG_NM)) return false;   
	//업장식당
     if(!mfn_Chk_Obj_MustInput(ed_HALL_NAME)) return false;
    //시작날짜
     if(!mfn_Chk_Obj_MustInput(cal_START_DATE)) return false;
    //종료날짜
     if(!mfn_Chk_Obj_MustInput(cal_END_DATE)) return false;
    //구분
     if(!mfn_Chk_Obj_MustInput(ed_CYCLE_REAL_GUBUN)) return false;
       
    var v_arg = {};
	v_arg["fa_UPJANG"]    = gfn_trim(ed_UPJANG_NM.userdata);
	v_arg["fa_UPJANG_NM"] = gfn_trim(ed_UPJANG_NM.value);
	v_arg["fa_HALL_CD"]   = gfn_trim(ed_HALL_NAME.userdata);
	v_arg["fa_HALL_NAME"] = gfn_trim(ed_HALL_NAME.value);
	v_arg["fa_FROM_DT"]   = gfn_trim(cal_START_DATE.value);
	v_arg["fa_TO_DT"]     = gfn_trim(cal_END_DATE.value);
	v_arg["fa_GUBUN"]     = gfn_trim(ed_CYCLE_REAL_GUBUN.value);	
     
     
    v_open	 	= "TitleBar=false Status=false AutoSize=false Resize=false NoMove=false";
	v_rtn 		= gfn_dialog("", "U_FSM::FSM00222P1.xfdl", v_arg);
	

	//---------------------------------------------
	// 변경전 레시피를 선택하였을 경우
	//---------------------------------------------
	if(gfn_length(v_rtn)>2)
	{
	    var selRecipe_Info = "";
		var selRecipe_CD   = "";
		var selRecipe_Name = "";
		
		selRecipe_Info     = gfn_split(v_rtn, "^");
		selRecipe_CD       = selRecipe_Info[0];
		selRecipe_Name     = selRecipe_Info[1];
		
		ed_BEFORE_RECIPE.userdata = selRecipe_CD;
		ed_BEFORE_RECIPE.value = selRecipe_Name;
	}

}

function ed_BEFORE_RECIPE_OnKeyDown(obj:Edit, e:KeyEventInfo)
{
	
	if(e.keycode == "13") {
		btn_BEFORE_RECIPE.click();
		return;
	}	
}


//////////////////////////////////////
///변경 후 레시피 검색
//////////////////////////////////////
function btn_AFTER_RECIPE_OnClick(obj:Button, e:ClickEventInfo)
{
	//업장
     if(!mfn_Chk_Obj_MustInput(ed_UPJANG_NM)) return false;   
	//업장식당
     if(!mfn_Chk_Obj_MustInput(ed_HALL_NAME)) return false;
    //시작날짜
     if(!mfn_Chk_Obj_MustInput(cal_START_DATE)) return false;
    //종료날짜
     if(!mfn_Chk_Obj_MustInput(cal_END_DATE)) return false;
    //구분
     if(!mfn_Chk_Obj_MustInput(ed_CYCLE_REAL_GUBUN)) return false;
       
    var v_arg = {};
	v_arg["fa_UPJANG"]    = gfn_trim(ed_UPJANG_NM.userdata);
	v_arg["fa_UPJANG_NM"] = gfn_trim(ed_UPJANG_NM.value);
	v_arg["fa_HALL_CD"]   = gfn_trim(ed_HALL_NAME.userdata);
	v_arg["fa_HALL_NAME"] = gfn_trim(ed_HALL_NAME.value);
	v_arg["fa_FROM_DT"]   = gfn_trim(cal_START_DATE.value);
	v_arg["fa_TO_DT"]     = gfn_trim(cal_END_DATE.value);
	v_arg["fa_GUBUN"]     = gfn_trim(ed_CYCLE_REAL_GUBUN.value);	
	v_arg["fa_SUBINV_CODE"]     = gfn_trim(fa_SUBINV_CODE);	     
     
    v_open	 	= "TitleBar=false Status=false AutoSize=false Resize=false NoMove=false";
	v_rtn 		= gfn_dialog("", "U_FSM::FSM90222P.xfdl", v_arg);
	

	//---------------------------------------------
	// 변경전 레시피를 선택하였을 경우
	//---------------------------------------------
	if(gfn_length(v_rtn)>2)
	{
		var selRecipe_Info = "";
		var selRecipe_CD   = "";
		var selRecipe_Name = "";
		
		selRecipe_Info     = gfn_split(v_rtn, "^");
		selRecipe_Gubun    = selRecipe_Info[0];
		selRecipe_CD       = selRecipe_Info[1];
		selRecipe_Name     = selRecipe_Info[2];
	
		ed_AFTER_RECIPE_GUBUN.value = selRecipe_Gubun;
		ed_AFTER_RECIPE.userdata   = selRecipe_CD;
		ed_AFTER_RECIPE.value       = selRecipe_Name;

	}
	
}




//레시피명 키다운 이벤트===> 조회
function ed_AFTER_RECIPE_OnKeyDown(obj:Edit, e:KeyEventInfo)
{
	if(e.keycode == "13") {
		btn_AFTER_RECIPE.click();
		return;
	}	
	
}



////////////////////////////////////////////////////
//// 레시피 변경하기================>> MAIN PROCESS
////////////////////////////////////////////////////
function btn_Copy_OnClick(obj:Button, e:ClickEventInfo)
{

	//변경전 레시피 선택확인
	if(gfn_length(this.ed_BEFORE_RECIPE.text)==0)
	{
		g_Message("EE", "변경전 레시피를 선택하여 주십시요.");
		return false;
	}
	 
	//변경후 레시피 선택확인
	if(gfn_length(this.ed_AFTER_RECIPE.text)==0)
	{
		g_Message("EE", "변경후 레시피를 선택하여 주십시요.");
		return false;
	}
		
    //코너리스트 선택 확인
	//선택된 코너 리스트 만들기 
	var TARGET_CORNER_LIST = "";
	var rowCnt_HALL_CORNER=ds_upjang_hall_corner.rowcount;			
	  
	for(var i=0;i<rowCnt_HALL_CORNER;i++)
	{
	  var chkObj = eval("chk"+i);
	  if (chkObj.value)
	  {
		   TARGET_CORNER_LIST+="'"+ chkObj.userdata + "',";		
	  }
	}
	
    
    //변경후 레시피 선택확인
	if(gfn_length(TARGET_CORNER_LIST)==0)
	{
		g_Message("EE", "변경할 코너를 선택하여 주십시요.");
		return false;
	}
	
	
	TARGET_CORNER_LIST = gfn_subStr(TARGET_CORNER_LIST,0,gfn_length(TARGET_CORNER_LIST)-1);
	
    //업장, 식당, 코너리스트, 시작날짜, 종료닐짜, 변경전 레시피, 변경후 레시피구분, 변경후 레시피 
	//조회 조건만들기-----------------------------------------------------------------------
	var otherArg;
	otherArg		= otherArg + " UPJANG="+wrapQuote(ed_UPJANG_NM.userdata);
	otherArg		= otherArg + " HALL_CD="+wrapQuote(ed_HALL_NAME.userdata);
	otherArg		= otherArg + " TARGET_CORNER_LIST="+wrapQuote(TARGET_CORNER_LIST);
	otherArg		= otherArg + " START_DATE="+wrapQuote(cal_START_DATE.value);
	otherArg		= otherArg + " END_DATE="+wrapQuote(cal_END_DATE.value);
	otherArg		= otherArg + " BEFORE_RECIPE_CD="+wrapQuote(ed_BEFORE_RECIPE.userdata);
	otherArg		= otherArg + " AFTER_RECIPE_GUBUN="+wrapQuote(gfn_trim(ed_AFTER_RECIPE_GUBUN.value));
	otherArg		= otherArg + " AFTER_RECIPE_CD="+wrapQuote(ed_AFTER_RECIPE.userdata);
	
	
	var sqlCmdUrl = "";
	//식단 레시피 타겟 선택.....
	//주기식단일 경우 CYCLE, 실제 식단일 경우 REAL
	
	if(ed_CYCLE_REAL_GUBUN.value=="CYCLE")
	{
	  sqlCmdUrl = "U_svc::" + "fs/fsm/FSM00222P_T001.jsp";
	}
	else
	{	
	  sqlCmdUrl = "U_svc::" + "fs/fsm/FSM00222P_T002.jsp";
	}
	
	 // action 정보 초기화 
	  fsp_clear(this);
	 // 트랜잭션 시작
	  var InDS=""; InDS="";
	  Transaction("FSM00222P_T001", sqlCmdUrl, InDS, "", otherArg, "fn_After_Save");	
	 // 트랜잭션 종료 
}

//저장 후 콜백 함수 
function fn_After_Save(strSvcID, errCode, errMsg)
{

	if (errCode != 0)
	{
		g_Message("EE", errMsg);
		return;
	}
	
	//복사를 했을 경우에만 메인창을 다시 조회한다.
	ed_COPY_OK.value="Y";
	g_Message("02","");
}
 
 ]]></Script>
  </Form>
</FDL>
