<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="../../../default_typedef.xml"/>
  <Form id="FSM00200E" onload="form_onload" titletext="행사식 등록" position="absolute 0 0 1252 725" scrollbars="none">
    <Layouts>
      <Layout>
        <Static id="sta_detail05" class="sta_WFDA_Labelbg" position="absolute 796 206 1237 233" anchor="left top right"/>
        <Static id="Static08" onclick="Static08_onclick" class="sta_WFSA_Labelbg" position="absolute 0 30 1237 71" anchor="left top right"/>
        <Static id="Static1" text="제공일" position="absolute 321 38 421 66" class="sta_WFSA_label"/>
        <Static id="Static5" text="사업장" position="absolute 15 38 115 66" class="sta_WFSA_label"/>
        <Edit autoselect="true" id="ed_upjangNm" onkeydown="ed_upjangNm_OnKeyDown" readonly="true" taborder="1" position="absolute 72 40 272 61" class="edt_WF_Essential"/>
        <Button id="btn_upjangCd" onclick="btn_upjangCd_OnClick" taborder="8" tabstop="false" text="" position="absolute 271 40 291 61" class="btn_WF_popSearchEssential" image=""/>
        <Edit lengthunit="asciii" id="ed_upjangCd" imemode="english" maxlength="6" inputtype="number" taborder="9" tabstop="false" visible="false" position="absolute 478 40 536 61"/>
        <Grid autoenter="select" binddataset="ds_list" cellmovingtype="col" cellsizingtype="both" readonly="false" enable="true" id="grd_list" useinputpanel="false" oncellclick="grd_list_OnCellClick" oncelldblclick="grd_list_OnCellDblClick" onheadclick="grd_list_OnHeadClick" onmousemove="grd_list_OnMouseOver" taborder="5" tabstop="false" usecontextmenu="true" userdata="식단구성정보" useselcolor="true" visible="true" wheelscrollrow="1" position="absolute 796 238 1238 670" selecttype="row" anchor="all" class="grd_WF_LineNone">
          <Formats>
            <Format id="Default">
              <Columns>
                <Column size="20"/>
                <Column size="35"/>
                <Column size="35"/>
                <Column size="65"/>
                <Column size="155"/>
                <Column size="53"/>
                <Column size="65"/>
                <Column size="75"/>
                <Column size="75"/>
                <Column size="75"/>
              </Columns>
              <Rows>
                <Row size="26" band="head"/>
                <Row size="24"/>
                <Row size="22" band="summ"/>
              </Rows>
              <Band id="head">
                <Cell displaytype="text" class="head_Excel"/>
                <Cell col="1" displaytype="text" text="순서" wordwrap="word"/>
                <Cell col="2" displaytype="text" text="구축" wordwrap="word"/>
                <Cell col="3" displaytype="text" text="코드" wordwrap="word"/>
                <Cell col="4" displaytype="text" text="레시피명"/>
                <Cell col="5" displaytype="text" text="원가" wordwrap="word"/>
                <Cell col="6" displaytype="text" text="조리식수" wordwrap="word"/>
                <Cell col="7" displaytype="text" text="레시피분류" wordwrap="word"/>
                <Cell col="8" displaytype="text" text="레시피유형" wordwrap="word"/>
                <Cell col="9" displaytype="text" text="조리법유형"/>
              </Band>
              <Band id="body">
                <Cell displaytype="normal" style="align:center;background:transparent URL('theme://images/new/grd_WF_ExpandImageX.png') center middle;background2:#e4e4e4ff URL('theme://images/new/grd_WF_ExpandImageX.png') center middle;selectbackground:#24a3a8ff URL('theme://images/new/grd_WF_ExpandImageX.png') center middle;"/>
                <Cell col="1" displaytype="number" edittype="text" editfilter="number" style="align:right;" text="bind:RECIPE_SEQ" editautoselect="true"/>
                <Cell col="2" displaytype="checkbox" edittype="checkbox" style="align:center;" text="bind:CHK"/>
                <Cell col="3" displaytype="text" style="align:center;" text="bind:RECIPE_CD"/>
                <Cell col="4" displaytype="text" style="align:left;" text="bind:RECIPE_NAME"/>
                <Cell col="5" displaytype="number" style="align:right;" text="bind:RECIPE_COST" mask="#,##0"/>
                <Cell col="6" displaytype="number" edittype="text" editfilter="number" style="align:right;" text="bind:EXPECT_SALE_QTY" mask="#,##0" editautoselect="true"/>
                <Cell col="7" displaytype="text" style="align:left;" text="bind:CLASS_NAME"/>
                <Cell col="8" displaytype="text" style="align:left;" text="bind:TYPE_NAME"/>
                <Cell col="9" displaytype="text" style="align:left;" text="bind:CUISINE_NAME"/>
              </Band>
              <Band id="summary">
                <Cell colspan="5" displaytype="text" style="align:center;" text="합 계"/>
                <Cell col="5" displaytype="number" style="align:right;" expr="expr:getSum(&quot;RECIPE_COST&quot;)"/>
                <Cell col="6" displaytype="text" style="align:left;"/>
                <Cell col="7" displaytype="text" style="align:left;"/>
                <Cell col="8" displaytype="text" style="align:left;"/>
                <Cell col="9" displaytype="text" style="align:left;"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Edit enable="false" id="ed_fRate" readonly="true" taborder="11" tabstop="false" position="absolute 886 209 1014 230"/>
        <Button enable="false" id="btn_recipeUpdate" onclick="btn_recipeUpdate_OnClick" taborder="12" tabstop="false" text="레시피수정" position="absolute 1161 208 1234 230" class="btn_WF_Custom" image="" anchor="top right"/>
        <MaskEdit id="med_reqDate" mask="####-##-##" ontextchanged="med_reqDate_OnChanged" oneditclick="g_Date_OnFocus" onsetfocus="g_Date_OnFocus" onkeydown="med_reqDate_OnKeyDown" onkillfocus="g_Date_OnKillFocus" taborder="2" type="string" position="absolute 375 40 454 61" class="msk_WF_Essential"/>
        <Button enable="false" id="btn_saveSeq" onclick="btn_saveSeq_OnClick" taborder="14" tabstop="false" text="저장" position="absolute 1105 208 1158 230" class="btn_WF_Custom" image="" anchor="top right"/>
        <Static id="Static01" text="예상식재료율" position="absolute 796 206 884 233" class="sta_WFDA_Label01"/>
        <Tab enable="false" id="tab_main" preload="true" taborder="4" position="absolute 0 180 786 670" showextrabutton="false" anchor="left top bottom">
          <Tabpages>
            <Tabpage id="tab0" taborder="1" text="표준식단검색" url="U_FSM::FSM00201V.xfdl" position="absolute 2 24 593 400" scrollbars="none"/>
            <Tabpage id="tab2" taborder="1" text="업장식단검색" url="U_FSM::FSM00202V.xfdl" position="absolute 2 24 593 400" scrollbars="none"/>
            <Tabpage id="tab3" taborder="1" text="레시피검색" url="U_FSM::FSM00203V.xfdl" position="absolute 2 24 593 400" scrollbars="none"/>
          </Tabpages>
        </Tab>
        <Grid autoenter="select" binddataset="ds_master" cellmovingtype="col" cellsizingtype="both" readonly="false" enable="true" id="med_fromCost" useinputpanel="false" selecttype="row" oncellclick="grd_master_OnCellClick" taborder="3" tabstop="false" usecontextmenu="true" userdata="행사식 목록" useselcolor="true" visible="true" wheelscrollrow="5" position="absolute 0 76 1237 175" autofittype="col" anchor="left top right" class="grd_WF_LineNone">
          <Formats>
            <Format id="Default">
              <Columns>
                <Column size="20"/>
                <Column size="279"/>
                <Column size="170"/>
                <Column size="130"/>
                <Column size="105"/>
                <Column size="75"/>
                <Column size="105"/>
                <Column size="60"/>
              </Columns>
              <Rows>
                <Row size="26" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell displaytype="text" class="head_Excel"/>
                <Cell col="1" displaytype="text" text="식단특성(행사명)" wordwrap="word"/>
                <Cell col="2" displaytype="text" text="식당명"/>
                <Cell col="3" displaytype="text" text="입고처" wordwrap="word"/>
                <Cell col="4" displaytype="text" text="식단가(VAT제외)" wordwrap="word"/>
                <Cell col="5" displaytype="text" text="예상인원" wordwrap="word"/>
                <Cell col="6" displaytype="text" text="목표식재료율(%)"/>
                <Cell col="7" displaytype="text" text="식단조회"/>
              </Band>
              <Band id="body">
                <Cell displaytype="text" style="align:center;" expr="expr:currow+1"/>
                <Cell col="1" displaytype="text" edittype="normal" style="align:left;" text="bind:MENU_FEATURE" editimemode="hangul" editautoselect="true"/>
                <Cell col="2" displaytype="combo" edittype="expr:setEditExpr(decode(expr_GetRowType(currow), 'insert', 'combo', 'none'))" editfilter="expr:setfilterExpr(decode(expr_GetRowType(currow), 'insert', 'combo', 'none'))" style="align:left;" text="bind:HALL_CD" combodataset="ds_hallList" combocodecol="HALL_CD" combodatacol="HALL_NAME"/>
                <Cell col="3" displaytype="combo" edittype="combo" style="align:left;" text="bind:SUBINV_CODE" combodataset="ds_SubinvCode" combocodecol="SUBINV_CODE" combodatacol="SUBINV_NAME"/>
                <Cell col="4" displaytype="number" edittype="masknumber" style="align:right;" text="bind:SALE_PRICE" mask="#,##0" editautoselect="true" editautoskip="false"/>
                <Cell col="5" displaytype="number" edittype="masknumber" style="align:right;" text="bind:EXPECT_MEAL_QTY" mask="#,##0" editautoselect="true"/>
                <Cell col="6" displaytype="number" edittype="masknumber" style="align:right;" text="bind:GOAL_COST_RATE" mask="#,##0.0" editlimit="3" editautoselect="true"/>
                <Cell col="7" displaytype="normal" edittype="none" style="align:left;background:transparent URL('theme://images/new/grd_WF_ExpandImage.png') center middle;background2:#e4e4e4ff URL('theme://images/new/grd_WF_ExpandImage.png') center middle;selectbackground:#24a3a8ff URL('theme://images/new/grd_WF_ExpandImage.png') center middle;" expandshow="hide"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Div id="div_cmnBtn" anchor="left top right" taborder="20" url="cmn::CmnBtn.xfdl" text="Div00" scrollbars="none" position="absolute 0 0 1237 30"/>
        <Static id="Static04" text="h10" onclick="Static04_onclick" class="Guide01_AreaRed" visible="false" position="absolute 0 30 1237 40"/>
        <Static id="Static11" text="글자간격기준 w10" onclick="Static11_onclick" class="Guide01_AreaRed" visible="false" position="absolute 62 40 72 61"/>
        <Static id="Static07" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 40 15 61"/>
        <Static id="Static03" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 61 1237 71"/>
        <Static id="Static09" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 291 40 321 61"/>
        <Static id="Static10" text="글자간격기준 w10" onclick="Static11_onclick" class="Guide01_AreaRed" visible="false" position="absolute 365 40 375 61"/>
        <Button id="btn_Date" taborder="22" onclick="g_CalButton_OnClick" class="btn_WF_calEssential" position="absolute 453 40 475 61" userdata="med_reqDate"/>
        <Static id="Static19" text="h05" class="Guide01_AreaRed" visible="false" position="absolute 0 71 1237 76" anchor="top right"/>
        <Static id="st_title" text="기본정보" class="sta_WF_Title01" position="absolute 344 184 672 201" visible="false"/>
        <Static id="Static14" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 175 1237 180"/>
        <Static id="Static16" text="h05" class="Guide01_AreaRed" visible="false" position="absolute 0 201 1237 206" anchor="top right"/>
        <Static id="st_mTitle" text="식단구성" class="sta_WF_Title01" position="absolute 797 188 1125 205"/>
        <Static id="Static06" text="h10" onclick="Static12_onclick" class="Guide01_AreaRed" visible="false" position="absolute 796 233 1247 238"/>
        <Static id="Static71" text="h15" onclick="Static71_onclick" class="Guide01_AreaRed" visible="false" position="absolute 0 710 1252 725" anchor="left bottom"/>
        <Div id="div_01" taborder="19" tabstop="false" text="Div0" visible="false" position="absolute 103 787 1236 869" scrollbars="none" style="background:white;" anchor="left right bottom">
          <Layouts>
            <Layout width="871" height="92">
              <Grid autofittype="none" binddataset="ds_jun" enable="true" id="grd_01" useinputpanel="false" autofitminwidth="100" onmouseleave="div_01_grd_01_OnMouseOut" taborder="1" tabstop="true" usecontextmenu="true" useselcolor="false" visible="true" wheelscrollrow="1" position="absolute 0 80 1134 162" readonly="true" selecttype="row" anchor="left right bottom">
                <Formats>
                  <Format id="Default">
                    <Columns>
                      <Column size="1135"/>
                    </Columns>
                    <Rows>
                      <Row size="24"/>
                    </Rows>
                    <Band id="body">
                      <Cell displaytype="text" style="align:left top;background:white;background2:white;" text="bind:RMK"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
            </Layout>
          </Layouts>
        </Div>
        <Static id="Static17" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 786 211 796 627"/>
        <Static id="Static20" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1237 0 1252 760"/>
        <Static id="Static68" text="원가는 입고예정일 기준 사업장 원가입니다." class="sta_WF_DiscInfo" position="absolute 955 691 1237 706" anchor="right bottom"/>
        <Static id="Static00" text="계획 식재료율" class="sta_WFDA_Label01" position="absolute 0 683 112 710" anchor="left bottom" style="background:lavender;font:Gulim,9;"/>
        <MaskEdit id="edt_planCostRate" taborder="23" mask="#,###" ontextchanged="tab_menu_tabpage1_edt_goalCostRate_ontextchanged" position="absolute 111 683 227 710" anchor="left bottom" style="color:blue;font:Gulim,9,bold;"/>
        <Static id="Static02" text="실적 식재료율" class="sta_WFDA_Label01" position="absolute 226 683 338 710" anchor="left bottom" style="background:lavender;font:Gulim,9;"/>
        <MaskEdit id="edt_resultCostRate" taborder="24" mask="#,###" ontextchanged="tab_menu_tabpage1_edt_goalCostRate_ontextchanged" position="absolute 337 683 453 710" anchor="left bottom" style="color:blue;font:Gulim,9,bold;"/>
        <Static id="Static13" text="달성율" class="sta_WFDA_Label01" position="absolute 452 683 564 710" anchor="left bottom" style="background:lavender;font:Gulim,9;"/>
        <MaskEdit id="edt_resultRate" taborder="25" mask="#,###" ontextchanged="tab_menu_tabpage1_edt_goalCostRate_ontextchanged" position="absolute 563 683 679 710" anchor="left bottom" style="color:blue;font:Gulim,9,bold;"/>
        <Static id="Static15" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 0 670 813 683"/>
        <Button id="btn_allDelete" taborder="26" tabstop="false" text="일괄삭제" class="btn_WF_Custom" enable="false" position="absolute 1037 208 1102 230" anchor="top right" onclick="btn_allDelete_onclick"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_hallList">
        <ColumnInfo>
          <Column id="HALL_CD" size="256" type="STRING"/>
          <Column id="HALL_NAME" size="256" type="STRING"/>
          <Column id="SUBINV_CODE" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_master" oncolumnchanged="ds_master_OnColumnChanged">
        <ColumnInfo>
          <Column id="HALL_CD" size="256" type="STRING"/>
          <Column id="SUBINV_CODE" size="256" type="STRING"/>
          <Column id="SUBINV_NAME" size="256" type="STRING"/>
          <Column id="MENU_FEATURE" size="256" type="STRING"/>
          <Column id="EXPECT_MEAL_QTY" size="256" type="STRING"/>
          <Column id="GOAL_COST_RATE" size="256" type="STRING"/>
          <Column id="SALE_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="MENU_CD" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cond">
        <ColumnInfo>
          <Column id="UPJANG" size="256" type="STRING"/>
          <Column id="MENU_DATE" size="256" type="STRING"/>
          <Column id="MENU_CD" size="256" type="STRING"/>
          <Column id="RECIPE_CD" size="256" type="STRING"/>
          <Column id="HALL_CD" size="256" type="STRING"/>
          <Column id="GOAL_COST_RATE" size="256" type="BIGDECIMAL"/>
          <Column id="EXPECT_SALE_QTY" size="256" type="BIGDECIMAL"/>
          <Column id="SUBINV_CODE" size="256" type="STRING"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="EXPECT_SALE_QTY"/>
            <Col id="GOAL_COST_RATE"/>
            <Col id="HALL_CD"/>
            <Col id="MENU_CD"/>
            <Col id="MENU_DATE"/>
            <Col id="RECIPE_CD"/>
            <Col id="SUBINV_CODE"/>
            <Col id="UPJANG"/>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_master_del">
        <ColumnInfo>
          <Column id="HALL_CD" size="256" type="STRING"/>
          <Column id="SUBINV_CODE" size="256" type="STRING"/>
          <Column id="SUBINV_NAME" size="256" type="STRING"/>
          <Column id="MENU_FEATURE" size="256" type="STRING"/>
          <Column id="EXPECT_MEAL_QTY" size="256" type="STRING"/>
          <Column id="GOAL_COST_RATE" size="256" type="STRING"/>
          <Column id="SALE_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="MENU_CD" size="256" type="STRING"/>
          <Column id="UPJANG" size="22" type="BIGDECIMAL"/>
          <Column id="RECIPE_CD" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_list">
        <ColumnInfo>
          <Column id="CLASS_NAME" size="100" type="STRING"/>
          <Column id="CUISINE_NAME" size="100" type="STRING"/>
          <Column id="CUISINE_TYPE" size="20" type="STRING"/>
          <Column id="EXPECT_SALE_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="MENU_CD" size="20" type="STRING"/>
          <Column id="RECIPE_CD" size="20" type="STRING"/>
          <Column id="RECIPE_CLASS" size="20" type="STRING"/>
          <Column id="RECIPE_COST" size="22" type="BIGDECIMAL"/>
          <Column id="RECIPE_NAME" size="50" type="STRING"/>
          <Column id="RECIPE_TYPE" size="20" type="STRING"/>
          <Column id="TYPE_NAME" size="100" type="STRING"/>
          <Column id="UPJANG" size="22" type="BIGDECIMAL"/>
          <Column id="SALE_PRICE" size="256" type="BIGDECIMAL"/>
          <Column id="RECIPE_SEQ" size="256" type="BIGDECIMAL"/>
          <Column id="CHK" size="256" type="STRING"/>
          <Column id="ORDER_YN" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_list_copy">
        <ColumnInfo>
          <Column id="HALL_CLASS" size="20" type="STRING"/>
          <Column id="RECIPE_CD" size="20" type="STRING"/>
          <Column id="EXPECT_SALE_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="UPJANG" size="256" type="BIGDECIMAL"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_recipe">
        <ColumnInfo>
          <Column id="RECIPE_SEQ" size="256" type="STRING"/>
          <Column id="RECIPE_NAME" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_upjangRecipe">
        <ColumnInfo>
          <Column id="RECIPE_CLASS" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_recipeType">
        <ColumnInfo>
          <Column id="CODE" size="256" type="STRING"/>
          <Column id="CODE_NAME" size="256" type="STRING"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="CODE">1</Col>
            <Col id="CODE_NAME">레시피포함</Col>
          </Row>
          <Row>
            <Col id="CODE">2</Col>
            <Col id="CODE_NAME">레시피미포함</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_jun">
        <ColumnInfo>
          <Column id="RMK" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_sik">
        <ColumnInfo>
          <Column id="RMK" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_Menu"/>
      <Dataset id="ds_Hall_class">
        <ColumnInfo>
          <Column id="SUBINV_CD" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_SubinvCode"/>
      <Dataset id="ds_ClearChk" oncolumnchanged="ds_ClearChk_OnColumnChanged">
        <ColumnInfo>
          <Column id="UPJANG" size="256" type="INT"/>
          <Column id="MENU_DATE" size="256" type="STRING"/>
          <Column id="UPJANGNM" size="256" type="STRING"/>
          <Column id="SUBINV_CODE" size="256" type="STRING"/>
          <Column id="HALL_CD" size="256" type="STRING"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="HALL_CD"/>
            <Col id="MENU_DATE"/>
            <Col id="SUBINV_CODE"/>
            <Col id="UPJANG"/>
            <Col id="UPJANGNM"/>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_assign"/>
    </Objects>
    <Bind>
      <BindItem id="item5" compid="sta_detail05" propid="text" datasetid="ds_view" columnid="D_1"/>
    </Bind>
    <Script type="xscript4.0"><![CDATA[include "U_lib::lib_conversionCom.xjs";
/*
 ******************************************************************************************
 * 시스템구분   : 메뉴관리/식단관리/행사식관리 
 * 프로그램명   : FSM00200E.XML
 * 기      능   : 행사식관리
 * 작  성  자   :  
 * 작성  일자   : 2007-12-21
 * 비      고   : 
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
//=========================================================================================
// [ PART 1 ]
// Form에서 Include 할 내용을 정의
//
//=========================================================================================
//@@컨버터에서 주석처리 #include "LIB::sc_comon.js";
//@@컨버터에서 주석처리 #include "LIB::lib_comm_0001.js";
//@@컨버터에서 주석처리 #include "LIB::tit_comm_0001.js";		// X-Framework Lib
//@@컨버터에서 주석처리 #include "LIB::sc_sql_common.js"		// 사업장팝업용 Lib
//=========================================================================================
// [ PART 2 ]
// Form에서 사용될 전역변수를 선언
//
//=========================================================================================
var v_SearchYN = "N";
var v_SetRow="";
//=========================================================================================
// [ PART 3 ]
// Form Loading 시 작업 정의
//
//=========================================================================================
function form_onload(obj:Form, e:LoadEventInfo)
{
	gfn_formOnLoad(obj, false);
	
	// 업데이트 DS
//	v_ds_check = "ds_master;ds_list";
	var gDay=gfn_today();
	if(gDay<"20080701")
	{
		gDay="20080701";
	}
	med_reqDate.value = gDay;
	ed_upjangCd.value  = g_Upjang;
	ed_upjangNm.value  = g_UpjangNm;
	ds_ClearChk.setColumn(0,"UPJANG",g_Upjang);
	ds_ClearChk.setColumn(0,"UPJANGNM",g_UpjangNm);
	fsp_init(this);
	// 레시피명 조회
    fsp_addSearch(this, "fs/fsc:FSR_RECIPE_CD_REF_S001"); // 레시피 정보 가져오기 
//    tit_addSearchActionInfo(this, "fs/fsm:FSM00200E_S007"); // 업장에 해당하는 recipe 클래스 가져오기 

	    
    fsp_callService(this, "", "", "", "ds_recipe=gds_Csqlout" 
        , "UPJANG=" + g_Upjang , "fn_afterInit", null, true);
        
	ds_cond.setColumn(0, "UPJANG", ed_upjangCd.value);        
	ds_cond.setColumn(0, "HALL_CD", ed_upjangCd.value);
	        
	// ds_ClearChk  업장변경시 데이타 클리어및 
	ds_ClearChk.setColumn(0,"UPJANG",g_Upjang);  
	
	// 관리자의 경우 전체 업장내역 조회 가능
	if( toNumber(g_AuthLevel) < 99 ) {
		ed_upjangNm.enable = false;
		btn_upjangCd.enable  = false;
	}
	
}
//=========================================================================================
// [ PART 4 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,도움말,form닫기)
//
//=========================================================================================
/*
 ******************************************************************************************
 * 함  수  명   : fn_Search()
 * 기      능   : [조회버튼] 검색조건에 해당하는 정보를 조회
 ******************************************************************************************
 */
function fn_search() {
    // 필수 입력사항 체크 
    if ( gfn_isNull(ed_upjangNm.value, "사업장", ed_upjangNm) ) {
        return;
    }
    if ( gfn_isNull(med_reqDate.value, "제공일", med_reqDate) ) {
        return;
    }
    
    gfn_clearGrid(grd_list);
    eval(grd_list.binddataset).clearData();

	tab_main.tab0.fn_T0_clear();
	tab_main.tab2.fn_T1_clear();
	tab_main.tab3.fn_T2_clear();

	var gDay=med_reqDate.value;
	if(gDay<"20080701")
	{
		g_Message("EE","2008년 7월 1일자 이전일자로 조회및 작업할수 없습니다.");
		gDay="20080701";
		med_reqDate.value="20080701"; 
		return;
	}   

	fsp_clear(this); 
	// ds_cond.setColumn(0, "SUBINV_CODE", ds_master.getColumn(ds_master.row, "SUBINV_CODE"));
    // 업장이 변경되었을 경우만 조회
    var upDs = "";
    //if ( ds_cond.getColumn(0, "UPJANG") !=  ed_upjangCd.Text) {
        fsp_addSearch(this, "fs/fsm:FSM00200E_S007"); // 업장에 해당하는 recipe 클래스 가져오기
        fsp_addSearch(this, "fs/fsm:FSM00200E_S002");	// 사업장의 식당명 조회
        fsp_addSearch(this, "fs/fsm:FSM00200E_S014");	// 사업장의 입고처 조회
        //fsp_addSearch(this, "fs/fsm:FSM00050E_S002");	// 식재료율 조회 
        //fsp_addSearch(this, "fs/fsm:FSM00050E_S001");	// 전략자재  조회 
        upDs = "ds_upjangRecipe=ds_upjangRecipe ds_hallList=ds_hallList ds_SubinvCode=ds_SubinvCode ds_jun=ds_jun ds_sik=ds_sik";
    //}

    //임시조회값 셋팅
// 		ed_upjangCd.value = 103262;
// 		med_reqDate.value = "20080701";
    //
    ds_cond.setColumn(0, "UPJANG", ed_upjangCd.value);
    ds_cond.setColumn(0, "MENU_DATE", med_reqDate.value);

    fsp_addSearch(this, "fs/fsm:FSM00200E_S003");	 // 사업장 식단 조회 

    fsp_callService(this, "", ""
            , "ds_cond=ds_cond"
            , "ds_master=ds_list " + upDs
            , "UPJANG=" + ed_upjangCd.value
            , "fn_afterSearch"
            , true);
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_Insert()
 * 기      능   : [입력버튼] 입력 시 처리되는 작업
 * 비      고	: 팝업사용
 ******************************************************************************************
 */
function fn_insert() {
	if( v_SearchYN == "Y" ) {
		if( gfn_length(ds_cond.getColumn(0, "UPJANG"))== 0 ) {
			gfn_alert(gfn_msg(SCCW00006));
			return;
		}
		// if(ds_master.SearchRow("length(trim(MENU_CD))==0")!=-1)
		// {
			// g_Message("EE","입력 중인 식단은 저장 후 조회해 주세요.");
			// return;
		// }
		var row = ds_master.addRow();
		ds_master.setColumn(row, "UPJANG", ds_cond.getColumn(0, "UPJANG"));
		ds_master.setColumn(row, "MENU_DATE", ds_cond.getColumn(0, "MENU_DATE"));
		fn_Clear("ins");
	} else {
		g_Message("EE", "조회 후 입력이 가능합니다.");
		return;
	}
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_Save()
 * 기      능   : [저장버튼] 저장 시 처리되는 작업
 ******************************************************************************************
 */
var F_IS_CLOSE = false;
function fn_save(isClose) {
    if ( isClose == null ) {
        isClose = false;
    }
    
    if ( !isClose ) {
        // 변경 사항 확인 
        if ( !gfn_isChangeDs(ds_master, st_title.text, "") ) {
            return;
        }
    }
    // 필수 입력 사항 확인 
    var dsArr = ["MENU_FEATURE", "HALL_CD","SUBINV_CODE"];
    var labelArr = ["식단특성", "식당명","입고처"];
    if ( gfn_isGridNull(med_fromCost, dsArr, labelArr) ) {
        return;
    }
    var i1=0;
    var i2=0;
    var i3=0;
    for(i=0;i<ds_master.getRowCount();i++)
    {
		i1=ds_master.getColumn(i,"SALE_PRICE");  		//식단가
		i2=ds_master.getColumn(i,"EXPECT_MEAL_QTY");	//예상인원
		i3=ds_master.getColumn(i,"GOAL_COST_RATE");		//목표식재료율
		if(i1<=0 || gfn_length(gfn_trim(i1))==0)
		{
			g_Message("EE","식단가를 0보다 큰값으로 입력하세요");
			ds_master.rowposition = i;
			med_fromCost.setCellPos(4);
			med_fromCost.setFocus();
			return;
		}
		if(i2<=0 || gfn_length(gfn_trim(i2))==0)
		{
			g_Message("EE","예상인원을 0보다 큰값으로 입력하세요");
			ds_master.rowposition = i;
			med_fromCost.setCellPos(5);
			med_fromCost.setFocus();
			return;
		}
		if(i3<=0 || gfn_length(gfn_trim(i3))==0)
		{
			g_Message("EE","목표식재료율을 0보다 큰값으로 입력하세요");
			ds_master.rowposition = i;
			med_fromCost.setCellPos(6);
			med_fromCost.setFocus();
			return;
		}
    }
  
    F_IS_CLOSE = isClose;
    var callback = "fs/fsm:FSM00200E_S003";
    if ( isClose) {
        callback = "";
    }
    
    // 그리드 초기화 
    gfn_clearGrid(med_fromCost);
//==============>
	//	FSM_GOAL_COST_RATE 식당별 주간목표 식재료율 입력

	// tit_ClearActionInfo(this);	
	// g_debug("ds_master");
	// g_debug("ds_cond");
	// return;
	// if(ds_master.GetUpdate()==true)
	// {
		// inData		= "ds_cond=ds_cond";
		// outData		= "";
		// callBackFnc	= "";
		// insertSql1 	= "";
		// updateSql1	= "";
		// deleteSql1	= "fs/fsm:FSM00030E_D002";
		// keyIncrement= -1;
		// callbackSql	= "";
		// tit_addMultiActionInfo(this,deleteSql1);
		// tit_addMultiActionInfo(this,deleteSql1);
		// http.Sync=true;
		// tit_callService(this, "", "", inData, outData, otherArg, callBackFnc);	
		// http.Sync=false;
		
		
		
		
		// tit_clearActionInfo(this); 
		// tit_addSaveActionInfo(this
			// , "fs/fsm:FSM00200E_I023"
			// , "fs/fsm:FSM00200E_U003"
			// , "fs/fsm:FSM00200E_D008"
			// , ""
			// , "", -1
			// , "" );
		// http.Sync=true;
		// tit_callService(this, "", "", "ds_assign=ds_assign:U ds_cond=ds_cond", "", "", "");			
		// http.Sync=false;
	// }
//===========>

    // tit_clearActionInfo(this); 
    // tit_addSaveActionInfo(this
        // , "fs/fsm:FSM00200E_I001"
        // , "fs/fsm:FSM00200E_U001"
        // , ""
        // , ""
        // , "fs/fsm:FSM00200E_S004", 1
        // , callback );
    // http.Sync=true;
    // tit_callService(this, "", "", "ds_list=ds_master:U ds_cond=ds_cond"
        // , "ds_master=ds_list", "", "fn_afterSave");		// 서비스 호출 
    // http.Sync=false;
    
    var arg="";
    arg	="g_EmpNo="+g_EmpNo;
	Transaction("FSM00200E_T001","U_svc::" + "fs/fsm/FSM00200E_T001.jsp","ds_master=ds_master:U ds_cond=ds_cond","",arg,"fn_call_back_save");
}
function fn_call_back_save(svcid,cd,errmsg)
{
	if(cd==-1)
	{
		g_Message("EE","서비스 오류!\n\n전산 담당자에게 문의하세요.");
		fn_afterSave(-1,"");
		return;
	}
	else
	{
		if ( !F_IS_CLOSE) {
			fn_search();
		}
		fn_afterSave(0,"");
	}
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_Delete()
 * 기      능   : [삭제버튼] 삭제 시 처리되는 작업
 ******************************************************************************************
 */
function fn_delete() {
	//trace("'" + ds_master.GetColumn(ds_master.currow, "MENU_FEATURE") + "' 식단을 삭제하시겠습니까?");
	if( g_Confirm("01", "[" + ds_master.getColumn(ds_master.rowposition, "MENU_FEATURE") + "] 식단을 삭제하시겠습니까?") ) {
		ds_master_del.clearData();
		
		for( var i = (ds_master.getRowCount()-1); i >= 0 ; i--) {
			if ( ds_master.getSelect(i) ) {
				if( GetRowType(ds_master,i)!= "insert") {
					var row = ds_master_del.addRow();
					ds_master_del.copyRow(row, ds_master, i );
				} else {
				
					// 삭제 
					ds_master.deleteRow(i);
				}    
			}
		}
		if( ds_master_del.getRowCount() > 0 ) {        
			fsp_clear(this);
			// 레시피 전체 삭제 
			fsp_addMulti(this, "fs/fsm:FSM00200E_D001");
			// 레시피 품목 삭제 
			fsp_addMulti(this, "fs/fsm:FSM00200E_D002");
			// 레시피 조리법 삭제 
			fsp_addMulti(this, "fs/fsm:FSM00200E_D003");
			// 메뉴 삭제 
			fsp_addMulti(this, "fs/fsm:FSM00200E_D004");
			
			fsp_callService(this, "", ""
				, "ds_list=ds_master_del:A"
				, ""
				, ""
				, "fn_afterDelete");
		}
	}
    /*
    ds_master_del.clearData();
    
    var isMessage = false;
    for( var i = (ds_master.rowCount()-1); i >= 0 ; i--) {
        // 실제 DB에서 삭제 
        if( isMessage == false ) {
            if ( !gfn_confirm(gfn_msg(SCCI00005, "식단내역") ) ) {
                return;
            }
            
            isMessage = true;
        }    
            
        if ( ds_master.GetSelect(i) ) {
            if( ds_master.getRowType(i) != "insert") {
                var row = ds_master_del.addRow();
                ds_master_del.copyRow(row, ds_master, i );
            } else {
            
                // 삭제 
                ds_master.DeleteRow(i);
            }    
        }
    }
    
    if( ds_master_del.rowCount() > 0 ) {        
			tit_clearActionInfo(this);
			// 레시피 전체 삭제 
			tit_addMultiActionInfo(this, "fs/fsm:FSM00200E_D001");
			// 레시피 품목 삭제 
			tit_addMultiActionInfo(this, "fs/fsm:FSM00200E_D002");
			// 레시피 조리법 삭제 
			tit_addMultiActionInfo(this, "fs/fsm:FSM00200E_D003");
			// 메뉴 삭제 
			tit_addMultiActionInfo(this, "fs/fsm:FSM00200E_D004");
			
			tit_callService(this, "", ""
				, "ds_list=ds_master_del:A"
				, ""
				, ""
				, "fn_afterDelete");
		}
    */

    
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_Print()
 * 기      능   : [출력버튼] 출력 시 처리되는 작업
 ******************************************************************************************
 */
function fn_print() {
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_Close()
 * 기      능   : [닫기버튼] 화면을 닫을때 처리되는 작업
 ******************************************************************************************
 */
function fn_Close() {
	close();
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_Help()
 * 기      능   : [도움말버튼] 도움말
 ******************************************************************************************
 */
function fn_help() {

}
/*
 ******************************************************************************************
 * 함  수  명   : fn_Excel
 * 기      능   : Excel
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function fn_Excel()
{

}
//=========================================================================================
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
//
//=========================================================================================
/*
 ******************************************************************************************
 * 함  수  명   :  fn_afterInit
 * 입      력   : errCode 	= 에러코드
				  errMsg	= 에러메세지
 * 반      환   : 없음
 * 기      능   : 초기화 callback 
 * 작  성  자   : 
 * 작성  일자   : 
 ******************************************************************************************
 */
function fn_afterInit(errCode, errMsg) {
    ds_recipe.insertRow(0);
    ds_recipe.setColumn(0, "RECIPE_SEQ", "");
    ds_recipe.setColumn(0, "RECIPE_NAME", "");
    
    GetItem(tab_main,0).cbo_recipe.value = ""; 
//fn_subinv();
    
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_afterSearch()
 * 입      력   : errCode 	= 에러코드
				  errMsg	= 에러메세지
 * 반      환   : 없음
 * 기      능   : 리스트 조회 후 callback 
 * 작  성  자   : 
 * 작성  일자   : 
 ******************************************************************************************
 */
function fn_afterSearch(errCode, errMsg)
{	    
    med_fromCost.binddataset = "";
    med_fromCost.binddataset = "ds_master";
    
    var v_mask=ds_jun.getColumn(0,"RMK");
    ds_jun.setColumn(0,"RMK",v_mask+"    ▲");
    
    gfn_showMsgGrid(med_fromCost);
    
    ds_cond.setColumn(0, "HALL_CD", ds_hallList.getColumn(0,"HALL_CD"));
    ds_cond.setColumn(0, "SUBINV_CODE", ds_hallList.getColumn(0,"SUBINV_CODE"));
	
	// 조회여부 구분자 셋팅
	v_SearchYN = "Y";

    // 첫번째에 해당하는 값으로 식단 구성 정보 조회 -> 미사용
    // 기본 정보의 식단조회 Cell Click시 식단구성 정보 조회로 변경(2008.05.09)
    /*if ( ds_master.rowcount() > 0 ) {
        fn_selectMenuList(0);
    } else {
        fn_selectMenuList(-1);
    }*/
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_afterSave()
 * 입      력   : errCode 	= 에러코드
				  errMsg	= 에러메세지
 * 반      환   : 없음
 * 기      능   : 저장 후 callback 
 * 작  성  자   : 
 * 작성  일자   : 
 ******************************************************************************************
 */
function fn_afterSave(errCode, errMsg)
{	
    if ( F_IS_CLOSE ) {
        // 화면을 닫아야 할 경우 처리 : 저장하고 닫기 
        if ( errCode == 0 ) {
            this.OnUnloadCompleted = "";
            close();
        }
    }

    // menu_cd 
    // 하위에서 복사할 때 사용할 HALL_CD 저장
    var fRow = ds_master.findRow("MENU_CD", ds_cond.getColumn(0, "MENU_CD"));
    if ( fRow >= 0 ) {
        ds_cond.setColumn(0, "HALL_CD", ds_master.getColumn(fRow, "HALL_CD"));
    } else {
        ds_cond.setColumn(0, "HALL_CD", "");
    }
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_afterDelete()
 * 입      력   : errCode 	= 에러코드
				  errMsg	= 에러메세지
 * 반      환   : 없음
 * 기      능   : 삭제 후 callback 
 * 작  성  자   : 
 * 작성  일자   : 
 ******************************************************************************************
 */
function fn_afterDelete(errCode, errMsg)
{
	if( errCode != 0 ) {
	} else {
		for ( var i = 0; i < ds_master_del.getRowCount(); i++ ) {
			var nRow = ds_master.findRow("MENU_CD", ds_master_del.getColumn(i, "MENU_CD"));
			ds_master.deleteRow( nRow );
		}
		
		var row = ds_master.findRow("MENU_CD", ds_list.getColumn(0, "MENU_CD") );
		if ( row == -1 ) {
			fn_clearDetail(true);
		}
		
		fn_search();
	}
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_afterDetailDelete()
 * 입      력   : errCode 	= 에러코드
				  errMsg	= 에러메세지
 * 반      환   : 없음
 * 기      능   : 삭제 후 callback 
 * 작  성  자   : 
 * 작성  일자   : 
 ******************************************************************************************
 */
function fn_afterDetailDelete(errCode, errMsg)
{	
    ds_list.deleteRow(ds_list.rowposition);
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_afterDetailSearch()
 * 입      력   : errCode 	= 에러코드
				  errMsg	= 에러메세지
 * 반      환   : 없음
 * 기      능   : 식단 조회 후 callback 
 * 작  성  자   : 
 * 작성  일자   : 
 ******************************************************************************************
 */
function fn_afterDetailSearch(errCode, errMsg) {
    var isum = 0;
    var isikdan = 0;
    var iRowNum = ds_master.rowposition;
    
    for ( var i = 0; i < ds_list.getRowCount(); i++ ) {
		isum = isum + (toNumber(ds_list.getColumn(i, "RECIPE_COST") * toNumber(ds_list.getColumn(i, "EXPECT_SALE_QTY"))));
    }
   
    ds_list.applyChange();
    // 예상 식재료율 계산 
    isikdan = toNumber(ds_master.getColumn(iRowNum,"SALE_PRICE")) * toNumber(ds_master.getColumn(iRowNum,"EXPECT_MEAL_QTY"));
    iRate = Math.round((isum / isikdan) * 100,1);
    iNum = iRate - ds_master.getColumn(iRowNum,"GOAL_COST_RATE");

    var tag ;
    if ( iNum < 0 ) {
		tag = "↓";
		ed_fRate.style.color = "blue";		
	} else {
		tag = "↑";	
		ed_fRate.style.color = "red";
	}

    Copy(ds_Menu,ds_list);
        
    ed_fRate.value = iRate + "% ( " + tag + "" + Math.abs(iNum) + "%P )";
}
//=========================================================================================
// [ PART 6 ]
// component Event 정의 ( User Define function )
// --> component Event의 기요,기능,동작 등 상세내용은 MiPlatform 메뉴얼을 참조하시기 바랍니다.
//=========================================================================================
/*
 ******************************************************************************************
 * 함  수  명   : fn_clearDetail
 * 입      력   : 
 * 반      환   : 없음
 * 기      능   : 상세 목록 초기화 
 * 작  성  자   : 조은영
 * 작성  일자   : 2007-11-30
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */ 
function fn_clearDetail(isClear) {
    if ( isClear ) {
        ed_fRate.value = "";
        ds_list.clearData();
    }
    
    btn_recipeUpdate.enable = !isClear;
    tab_main.enable = !isClear;
    btn_saveSeq.enable = !isClear;
    btn_allDelete.enable = !isClear;
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_selectMenuList
 * 입      력   : 
 * 반      환   : 없음
 * 기      능   : 상세 목록 조회 
 * 작  성  자   : 조은영
 * 작성  일자   : 2007-11-30
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function fn_selectMenuList(nRow) {
    // 현재 정보 다시 조회 
    if ( nRow == -2 ) {
        gfn_clearGrid(grd_list);
        fsp_clear(this);
        fsp_addSearch(this, "fs/fsm:FSM00200E_S008");
        fsp_callService(this, "", ""
            , "ds_cond=ds_cond"
            , "ds_list=ds_list"
            , ""
            , "fn_afterDetailSearch"
            , true);
          
        fn_clearDetail(false);
        return;
    }
    
    if ( nRow < 0 || GetRowType(ds_master,nRow)== "insert") {
        fn_clearDetail(true);
        return;
    }	
    
    // 조회 key 값 
    ds_cond.setColumn(0, "MENU_CD", ds_master.getColumn(nRow, "MENU_CD"));
    if ( gfn_length( ds_cond.getColumn(0, "MENU_CD") )== 0 ) {
        return;
    }
    
    // 하위에서 복사할 때 사용할 HALL_CD 저장 
    ds_cond.setColumn(0, "HALL_CD", ds_master.getColumn(nRow, "HALL_CD"));
    ds_cond.setColumn(0, "GOAL_COST_RATE", ds_master.getColumn(nRow, "GOAL_COST_RATE"));
    ds_cond.setColumn(0, "EXPECT_SALE_QTY", ds_master.getColumn(nRow, "EXPECT_MEAL_QTY"));
    ds_cond.setColumn(0, "SUBINV_CODE", ds_master.getColumn(nRow, "SUBINV_CODE"));
    
    gfn_clearGrid(grd_list);
    fsp_clear(this);
    fsp_addSearch(this, "fs/fsm:FSM00200E_S008");
    fsp_callService(this, "", ""
        , "ds_cond=ds_cond"
        , "ds_list=ds_list"
        , ""
        , "fn_afterDetailSearch"
        , true);
       
    fn_clearDetail(false);

}
/*
 ******************************************************************************************
 * 함  수  명   : btn_upjangCd_OnClick
 * 입      력   : 
 * 반      환   : 없음
 * 기      능   : 업장 조회 
 * 작  성  자   : 조은영
 * 작성  일자   : 2007-11-30
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function btn_upjangCd_OnClick(obj:Button, e:ClickEventInfo)
{
    fn_sql_common_setup(strMAQuery_Upjang, 
						strMAQuery_UpjangKeyField, 
						strMAQuery_UpjangValueField, 
						strMAQuery_UpjangKeyFieldNM, 
						strMAQuery_UpjangValueFieldNM, 
						"", 
						"",
						"",   
						strMAQuery_UpjangCaption,
						"UPJANG;UPJANGNM");
    
    var upjang = "";
    var upjangNm = "";
    
    if (gds_sql_common.getColumn(0, "ret_code") != "")  {
		upjang = gds_sql_common.getColumn(0, "ret_code");
        upjangNm = gds_sql_common.getColumn(0, "ret_name");
        ed_upjangCd.value = upjang;
        ed_upjangNm.value = upjangNm;
        ds_ClearChk.setColumn(0,"UPJANG",upjang);
        ds_ClearChk.setColumn(0,"UPJANGNM",upjangNm);
        // 조회여부 구분자 변경
        v_SearchYN = "N";
    }
}
/*
 ******************************************************************************************
 * 함  수  명   : ed_upjangNm_OnKeyDown
 * 입      력   : 
 * 반      환   : 없음
 * 기      능   : 업장 조회 
 * 작  성  자   : 조은영
 * 작성  일자   : 2007-11-30
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function ed_upjangNm_OnKeyDown(obj:Edit, e:KeyEventInfo)
{
	if( e.keycode == 13 ) {
		if( gfn_length(gfn_trim(ed_upjangCd.value))== 0 || gfn_length(gfn_trim(ed_upjangNm.value))== 0 ) {
			btn_upjangCd_OnClick(null);
		}
	} else if( e.keycode == 46 ) {
        ed_upjangCd.value = "";
        ed_upjangNm.value = "";
	}
}
/*
 ******************************************************************************************
 * 함  수  명   : ds_master_OnColumnChanged
 * 입      력   : 
 * 반      환   : 없음
 * 기      능   : 데이터 컬럼 변경 시 
 * 작  성  자   : 조은영
 * 작성  일자   :
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function ds_master_OnColumnChanged(obj:Dataset, e:DSColChangeEventInfo)
{
    switch( e.columnid ) {
        case "HALL_CD" :    // 식당명 -> 입고처 자동으로 보여주기
			//if( trim(varNewValue).length() == 0 ) {
			//	ds_master.SetColumn(nRow, "SUBINV_CODE", "");
			//} else {
			if( gfn_length(gfn_trim(e.newvalue))!= 0 ) {
				var r = ds_hallList.findRow("HALL_CD", e.newvalue);
				var v_Subinv = ds_hallList.getColumn(r, "SUBINV_CODE");
				if( gfn_length(gfn_trim(v_Subinv))!= 0 ) {
					if( gfn_subStr(v_Subinv,0,1)== "C" ) {
						ds_master.setColumn(e.row, "SUBINV_CODE", v_Subinv);
					} else {
						g_Message("EE", "선택한 식당의 창고코드가 올바르지 않습니다.\n관리자에게 문의하여 주십시요.");
						ds_master.setColumn(e.row, "HALL_CD", e.oldvalue);
						return;
					}
                }
			}
            break;
        case "SUBINV_CODE" :
			if( gfn_length(gfn_trim(ds_master.getColumn(e.row, "HALL_CD")))== 0 ) {
				g_Message("EE", "식당을 먼저 선택해 주세요.");
				break;
			} else {
				if( gfn_length(gfn_trim(e.newvalue))!= 0 ) {
					// 식당의 OUTVAT_YN가 'Y'인 경우 입고처의 OUTVAT_FLAG이 'Y'인 입고처만 선택 가능
					var v_HallIndex = ds_hallList.findRow("HALL_CD", ds_master.getColumn(e.row, "HALL_CD"));
					var v_HallOutVat = ds_hallList.getColumn(v_HallIndex, "OUTVAT_YN");
					
					var v_SubinvIndex = ds_SubinvCode.findRow("SUBINV_CODE", e.newvalue);
					var v_SubinvOutVat = ds_SubinvCode.getColumn(v_SubinvIndex, "OUTVAT_FLAG");
					
					if( v_HallOutVat != v_SubinvOutVat ) {
						g_Message("EE", "입고처를 선택할 때 과세/면세 입고처를 맞게\n선택하여 주십시요.");
						ds_master.setColumn(e.row, "SUBINV_CODE", e.oldvalue);
					}
				}
			}
			break;
        case "GOAL_COST_RATE" :
            var num = toNumber( e.newvalue);
            if ( num != 0 ) {
                var title = new Array();
                title[0] = "목표식재료율";
                if ( num < 0 ) {
                    title[1] = "0";
                    gfn_alert( gfn_msg(SCCW00009, title));
                    ds_master.setColumn(e.row, "GOAL_COST_RATE","0");
                } else if ( num > 100 ) {
                    title[1] = "100";
                    gfn_alert( gfn_msg(SCCW00010, title));
                    ds_master.setColumn(e.row, "GOAL_COST_RATE","0");
                }
            } 
            break;
        default :
			break;
    }
}
/*
 ******************************************************************************************
 * 함  수  명   : grd_list_OnCellClick
 * 입      력   : 
 * 반      환   : 없음
 * 기      능   : 그리드 선택 
 * 작  성  자   : 조은영
 * 작성  일자   :
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function grd_list_OnCellClick(obj:Grid, e:GridClickEventInfo)
{
	if ( e.cell == 0 ) {
        ds_list.rowposition = e.row;
        // 실제 DB에서 삭제 
        if ( !gfn_confirm(gfn_msg(SCCI00004, ds_list.getColumn(e.row, "RECIPE_NAME")+ " ") ) ) {
            return;
        }
        
        ds_cond.setColumn(0, "RECIPE_CD", ds_list.getColumn(e.row, "RECIPE_CD") );
        fsp_clear(this);
        // 레시피 삭제 
        fsp_addSingle(this, "fs/fsm:FSM00200E_D001");
        // 레시피 품목 삭제 
        fsp_addSingle(this, "fs/fsm:FSM00200E_D002");
        // 레시피 조리법 삭제 
        fsp_addSingle(this, "fs/fsm:FSM00200E_D003");
        // 재조회 
        fsp_addSearch(this, "fs/fsm:FSM00200E_S008");
        
        
        ds_cond.setColumn(0, "SUBINV_CODE", ds_master.getColumn(ds_master.rowposition, "SUBINV_CODE"));
        
        fsp_callService(this, "", ""
            , "ds_list=ds_cond"
            , "ds_list=ds_list"
            , "MENU_CD=" + wrapQuote( ds_cond.getColumn(0, "MENU_CD")) + " UPJANG=" + ds_cond.getColumn(0, "UPJANG")
            + " SUBINV_CODE=" + wrapQuote( ds_master.getColumn(ds_master.rowposition, "SUBINV_CODE") )
            , "fn_afterDetailSearch");
            
		ds_cond.setColumn(0, "MENU_CD", ds_master.getColumn(ds_master.rowposition, "MENU_CD"));
		// 하위에서 복사할 때 사용할 HALL_CD 저장 
		ds_cond.setColumn(0, "HALL_CD", ds_master.getColumn(ds_master.rowposition, "HALL_CD"));
		ds_cond.setColumn(0, "GOAL_COST_RATE", ds_master.getColumn(ds_master.rowposition, "GOAL_COST_RATE"));
		ds_cond.setColumn(0, "EXPECT_SALE_QTY", ds_master.getColumn(ds_master.rowposition, "EXPECT_MEAL_QTY"));        
            
	}
}
/*
 ******************************************************************************************
 * 함  수  명   : btn_saveSeq_OnClick
 * 입      력   : 
 * 반      환   : 없음
 * 기      능   : 저장 버튼 선택 
 * 작  성  자   : 조은영
 * 작성  일자   :
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function btn_saveSeq_OnClick(obj:Button, e:ClickEventInfo)
{
    // 변경 사항 확인 
    if ( !gfn_isChangeDs(ds_list, st_mTitle.text, "") ) {
        return;
    }
    
    // 구축을 선택한 자료만 
    ds_list_copy.clearData();
    for ( var i = 0; i < ds_list.getRowCount(); i++ ) {
        if ( ds_list.getColumn(i, "CHK") == "1" ) {
            var row = ds_list_copy.addRow();
            ds_list_copy.copyRow(row, ds_list, i);
            ds_list_copy.setColumn(row, "UPJANG", ds_cond.getColumn(0, "UPJANG"));
        }
    }
    
	// 그리드 초기화 
    gfn_clearGrid(grd_list);
        
    fsp_clear(this);
    fsp_addSave(this
        , ""
        , "fs/fsm:FSM00200E_U002"
        , ""
        , ""
        , ""
        , -1
        , "" );
    
    if ( ds_list_copy.getRowCount() > 0 ) {
        fsp_addSingle(this, "fs/fsm:FSM00200E_D007");  // 레시피 조리법 삭제
        fsp_addSingle(this, "fs/fsm:FSM00200E_D006");  // 레시피 자재 삭제 
        fsp_addSingle(this, "fs/fsm:FSM00200E_D005");  // 레시피 마스터 삭제  
        
        fsp_addMulti(this, "fs/fsm:FSM00200E_I013");  // 레시피 조리법 복사 
        fsp_addMulti(this, "fs/fsm:FSM00200E_I012");  // 레시피 자재 복사 
        fsp_addMulti(this, "fs/fsm:FSM00200E_I011");  // 레시피 마스터 복사 
    }
    
    fsp_addSearch(this, "fs/fsm:FSM00200E_S008"); // 재조회 
    
    fsp_callService(this, "", ""
        , "ds_list=ds_list:U ds_cond=ds_cond ds_listCopy=ds_list_copy:A"
        , "ds_list=ds_list"
        , ""
        , "fn_afterDetailSearch");		// 서비스 호출 
}
/*
 ******************************************************************************************
 * 함  수  명   : btn_recipeUpdate_OnClick
 * 입      력   : 
 * 반      환   : 없음
 * 기      능   : 레시피 수정 버튼 선택 
 * 작  성  자   : 조은영
 * 작성  일자   :
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function btn_recipeUpdate_OnClick(obj, e:ClickEventInfo)
{
	if(gfn_dsIsUpdated(ds_list)==true)
	{
		g_Message("EE","변경된 데이타가 있습니다.\n\n저장하신후 작업하세요.");
		return;
	}
	if(ds_list.getRowCount()==0)
	{
		return;
	}
	idx = ds_list.rowposition; 
	
//     var arg = 
//         "fa_UPJANG=" + wrapQuote( ds_cond.getColumn(0, "UPJANG"))
//         + " fa_HALL_CD=" + wrapQuote( ds_cond.getColumn(0, "HALL_CD"))
//         + " fa_SUBINV_CODE=" + wrapQuote( ds_cond.getColumn(0, "SUBINV_CODE"))
//         + " fa_MENU_CD=" + wrapQuote( ds_cond.getColumn(0, "MENU_CD"))
//         + " fa_MENU_DATE=" + wrapQuote( ds_cond.getColumn(0, "MENU_DATE"))
//         + " fa_RECIPE_CD=" + wrapQuote( ds_list.getColumn(idx, "RECIPE_CD"))
//         + " fa_INACT=" + wrapQuote(obj);
	var arg = {fa_UPJANG:ds_cond.getColumn(0, "UPJANG"), fa_HALL_CD:ds_cond.getColumn(0, "HALL_CD"), fa_SUBINV_CODE:ds_cond.getColumn(0, "SUBINV_CODE"), 
				fa_MENU_CD:ds_cond.getColumn(0, "MENU_CD"), fa_MENU_DATE:ds_cond.getColumn(0, "MENU_DATE"), fa_RECIPE_CD:ds_list.getColumn(idx, "RECIPE_CD"),
				fa_INACT:obj};

       
	//gfn_openPopup("U_FSM::FSM00205E.xml", true, -1, -1, arg);
	gfn_dialog("", "U_FSM::FSM00205E.xfdl", arg);
	ds_master.rowposition=v_SetRow;
	fn_selectMenuList(v_SetRow);
}
/*
 ******************************************************************************************
 * 함  수  명   : frm_OnUnloadCompleted
 * 입      력   : 
 * 반      환   : 없음
 * 기      능   : 화면 닫힐 때 처리 
 * 작  성  자   : 조은영
 * 작성  일자   :
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
function frm_OnUnloadCompleted(obj)
{   
    // 변경된것이 없다. 
    if ( !gfn_isChangeDs(ds_list, "", "", true) ) {
        return true;
    }
    
    if ( !gfn_confirm(gfn_msg(SCCI00002))) {
        return true;
    }
    
    // 저장 호출 
    fn_save(true);
    
    return false;
}
//=========================================================================================
// [ PART 7]
// Tab안의 화면이 공통으로 사용 
//=========================================================================================
/*
 ******************************************************************************************
 * 함  수  명   : cbo_recipe_OnKillFocus
 * 기      능   : 레시피 명
 * 작  성  자   : 
 * 작성  일자   : 
 ******************************************************************************************
 */
function cbo_recipe_OnKillFocus(obj)
{
    
    if ( gfn_length( obj.userdata)== 0 ) {
        return;
    }
    
	var dsObj = eval(obj.innerdataset);
	var row = dsObj.findRow("RECIPE_NAME", obj.userdata);
	
	if ( row == -1 ) {
        row = dsObj.addRow();
        dsObj.setColumn(row, "RECIPE_SEQ", obj.userdata);
        dsObj.setColumn(row, "RECIPE_NAME", obj.userdata);
        obj.value = obj.userdata;
	}
	
	obj.userdata = "";
}
/*
 ******************************************************************************************
 * 함  수  명   : cbo_recipe_OnChar
 * 기      능   : 레시피 명 보관
 * 작  성  자   : 
 * 작성  일자   : 
 ******************************************************************************************
 */
function cbo_recipe_OnChar(obj,strPreText,nChar,strPostText,LLParam,HLParam)
{
   if ( nChar == 13 ) {
//        fn_Search();
        return;
    }
    
	obj.userdata = strPostText;

}
/*
 ******************************************************************************************
 * 함  수  명   : ed_jun_OnMouseOver
 * 기      능   : 전략자재 현황 List를 조회 (visible : true)
 * 작  성  자   : 
 * 작성  일자   : 
 ******************************************************************************************
 */
function ed_jun_OnMouseOver(obj:Edit, e:MouseEventInfo)
{
	div_01.visible = true;
	ds_jun.reset();
}
/*
 ******************************************************************************************
 * 함  수  명   : div_01_OnMouseOut
 * 기      능   : 전략자재 현황 List를 조회 (visible : false)
 * 작  성  자   : 
 * 작성  일자   : 
 ******************************************************************************************
 */
function div_01_OnMouseOut(obj,objSenderObj)
{
	div_01.visible = false;
}
/*
 ******************************************************************************************
 * 함  수  명   : div_01_grd_01_OnMouseOut
 * 기      능   : 
 * 작  성  자   : 
 * 작성  일자   : 
 ******************************************************************************************
 */
function div_01_grd_01_OnMouseOut(obj:Grid, e:MouseEventInfo)
{
	div_01.visible = false;
	var v_mask=ds_jun.getColumn(0,"RMK");
	ds_jun.setColumn(0,"RMK",v_mask+"         ▲");	
}
/*
 ******************************************************************************************
 * 함  수  명   : div_01_grd_01_OnMouseOut
 * 기      능   : 
 * 작  성  자   : 
 * 작성  일자   : 
 ******************************************************************************************
 */
function btn_Date_OnClick(obj:ImageViewer, e:ClickEventInfo)
{
   	g_CalButton_OnClick(obj);
	fn_search();
}

function grd_list_OnCellDblClick(obj:Grid, e:GridClickEventInfo)
{
	btn_recipeUpdate_OnClick("GRID");
}
/*
 ******************************************************************************************
 * 함  수  명   : grd_master_OnCellClick
 * 기      능   : 기본정보의 식단조회 Cell Click Event
 * 작  성  자   : 
 * 작성  일자   : 
 ******************************************************************************************
 */
function grd_master_OnCellClick(obj:Grid, e:GridClickEventInfo)
{
	if( e.cell == 7 ) {
		if( GetRowType(ds_master,e.row)== "insert" ) {
			g_Message("EE", "입력 중인 식단은 저장 후 조회해 주세요.");
			return;
		}
		fn_CellClick_Clear();
		// 식단 구성 조회
		v_SetRow=e.row;
		fn_selectMenuList(v_SetRow);
		ds_cond.setColumn(0, "SUBINV_CODE", ds_master.getColumn(v_SetRow, "SUBINV_CODE"));
		ds_cond.setColumn(0, "MENU_DATE", ds_master.getColumn(v_SetRow, "MENU_DATE"));
		ds_cond.setColumn(0, "MENU_CD", ds_master.getColumn(v_SetRow, "MENU_CD"));
		fn_SetClass();
	}
}
/*
 ******************************************************************************************
 * 함  수  명   : med_reqDate_OnKeyDown
 * 기      능   : 제공일 검색날짜를 입력 후 엔터키 입력시 검색
 * 작  성  자   : 
 * 작성  일자   : 
 ******************************************************************************************
 */
function med_reqDate_OnKeyDown(obj:MaskEdit, e:KeyEventInfo)
{
	if( e.keycode == 13 ) {
		g_Date_OnKillFocus(obj);
		fn_search();
	}
}

function ds_ClearChk_OnColumnChanged(obj:Dataset, e:DSColChangeEventInfo)
{
	fn_Clear();
	tab_main.tab3.fn_RecipeClass_Call();
	// ds_master.ClearData();
	// ds_list.ClearData();
	//  //tab_main.tab2.fn_Upjang_Find();
	// tab_Main.tab0.fn_T0_clear();
	// tab_Main.tab2.fn_T1_clear();
	// tab_Main.tab3.fn_T2_clear();
}
function fn_Clear(str)
{
	if(str!="ins")
	{
		ds_master.clearData();
	}
	ds_list.clearData();
	//tab_main.tab2.fn_Upjang_Find();
	tab_main.tab0.fn_T0_clear();
	tab_main.tab2.fn_T1_clear();
	tab_main.tab3.fn_T2_clear();
}
function fn_CellClick_Clear()
{
	tab_main.tab0.fn_T0_clear();
	tab_main.tab2.fn_T1_clear();
	tab_main.tab3.fn_T2_clear();
}

function med_reqDate_OnChanged(obj:MaskEdit, e:TextChangedEventInfo)
{
	fn_Clear();
}

function grd_list_OnHeadClick(obj:Grid, e:GridClickEventInfo)
{
    if ( e.cell == 0 ) {
        gfn_exportExcel(obj, "Sheet1");
    } else if( e.cell == 2 ){
		if(eval(obj.binddataset).getRowCount()>0)
		{
			if(eval(obj.binddataset).findRow("CHK",1)==-1)
			{
				for(i=0;i<eval(obj.binddataset).getRowCount();i++)
				{
					eval(obj.binddataset).setColumn(i,"CHK",1);
				}
			}
			else
			{
				if(eval(obj.binddataset).findRow("CHK",0)==-1)
				{
					for(i=0;i<eval(obj.binddataset).getRowCount();i++)
					{
						eval(obj.binddataset).setColumn(i,"CHK",0);
					}				
				}
				else
				{
					for(i=0;i<eval(obj.binddataset).getRowCount();i++)
					{
						eval(obj.binddataset).setColumn(i,"CHK",1);
					}	
				}
			}
		}
    } else {
		gfn_gridSort(obj, e); //(eval(obj.binddataset), obj, e.cell);  
    }
}

function grd_list_OnMouseOver(obj:Grid, e:GridMouseEventInfo)
{
	if(e.row>-1 && e.cell==0)
	{
		grd_list.tooltiptext="삭제";
	}
	else
	{
		grd_list.tooltiptext="";
	}
}

function fn_SetClass()
{
	fsp_clear(this);
	
	var str	="UPJANG="	+	gfn_trim(ds_master.getColumn(ds_master.rowposition,"UPJANG"))
			+" HALL_CD="+	gfn_trim(ds_master.getColumn(ds_master.rowposition,"HALL_CD"));
	
	fsp_addSearch(this,"fs/fsm:FSM00060E_S003");   
	http.Sync=true;
	fsp_callService(this,"","",
					"",
					"ds_Hall_class=ds_Hall_class",
					str,
					"",
					"",
					true);
	http.Sync=false;	

	if(gfn_length(gfn_trim(ds_Hall_class.getColumn(0,"RECIPE_CLASS")))>0)
	{
		tab_main.tab3.cbo_RecipeClass.value=gfn_trim(ds_Hall_class.getColumn(0,"RECIPE_CLASS"));
	}
	else
	{
		tab_main.tab3.cbo_RecipeClass.index = 0;		
	}
}

function btn_allDelete_onclick(obj:Button,  e:ClickEventInfo)
{
	// 삭제 가능여부 체크 ( 1. 예상식수 등록여부, 2. 주문 여부 )
	var vCond = "ORDER_YN=='Y'";
	var nRow = ds_list.findRowExpr(vCond);
	
	if (ds_list.getColumn(nRow, "ORDER_YN") == "Y") 
	{
		g_Message("EE",	"식자재가 발주되었습니다.\n\n메뉴를 삭제할수 없습니다.");
		return;
	}

	// 확인메시지
	var sMenuCd = ds_list.getColumn(0, "MENU_CD");
	var msg = "메뉴를 일괄 삭제하시겠습니까?\n\n[ " + sMenuCd + " ]";
	
	if (g_Confirm("04",	msg) == true) {
		// 삭제처리
		var actionName, cmdName, inData, outData, otherArg, callBackFnc;
		
		inData			= "";
		outData			= "";
		otherArg		= "UPJANG=" + wrapQuote(ds_cond.getColumn(0, "UPJANG")) + " MENU_CD=" + wrapQuote(sMenuCd);
		callBackFnc		= "";
		
		fsp_clear(this); 
		fsp_addSearch(this, "fs/fsm:FSM00052E_D001");									
		http.Sync = true;
		fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);		// 서비스 호출 
		http.Sync = false;
		
		fn_selectMenuList(v_SetRow);
	}		
}]]></Script>
  </Form>
</FDL>
