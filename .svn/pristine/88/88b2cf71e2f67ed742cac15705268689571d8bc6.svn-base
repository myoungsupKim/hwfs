<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="../../../default_typedef.xml"/>
  <Form id="FMS00120E" onkeydown="fn_form_OnKeyDown" onload="form_onload" titletext="사업장 정보관리(사업장)" position="absolute 0 0 996 593" scrollbars="none">
    <Layouts>
      <Layout>
        <Static id="Static08" class="sta_WFSA_Labelbg" position="absolute 0 30 981 71" anchor="left top right"/>
        <Static id="Static06" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 981 0 996 593" anchor="top right"/>
        <Button id="btn_Upjang" taborder="3" onclick="fn_edBtn_OnClick" class="btn_WF_popSearchEssential" position="absolute 210 40 231 61"/>
        <Edit id="ed_Upjang" taborder="4" readonly="true" onkeydown="fn_edBtn_OnKeyDown" class="edt_WF_Essential" position="absolute 71 40 211 61"/>
        <Static id="st_Upjang" text="사업장" class="sta_WFSA_label" position="absolute 15 40 77 61" userdata="strQuery_FMUpjang"/>
        <Div id="div_cmnBtn" anchor="left top right" taborder="5" url="cmn::CmnBtn.xfdl" text="Div0" scrollbars="none" class="absolute 0 0 981 30" position="absolute 0 0 981 30"/>
        <Grid id="tv_list" taborder="6" binddataset="ds_main" useinputpanel="false" treeusecheckbox="false" treeinitstatus="expand,all" oncellclick="tv_list_oncellclick" position="absolute 0 76 346 578" anchor="left top bottom" scrollbars="none">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="346"/>
              </Columns>
              <Rows>
                <Row size="24"/>
              </Rows>
              <Band id="body">
                <Cell displaytype="tree" edittype="tree" text="bind:UPJANGNM_DISP" treelevel="bind:M_LEVEL"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Static id="Static71" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 578 981 593" anchor="left bottom"/>
        <Button id="btn_Copy" taborder="7" text="불러오기" onclick="btn_Copy_OnClick" class="btn_WF_Custom" enable="false" visible="false" position="absolute 916 76 981 97" anchor="top right"/>
        <Static id="Static00" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 504 97 975 102" anchor="left bottom"/>
        <Static id="Static21" text="w10" class="Guide01_AreaRed" visible="false" position="absolute 340 72 350 505"/>
        <Tab id="tab_list" anchor="all" taborder="8" preload="true" tabindex="0" position="absolute 350 76 981 578">
          <Tabpages>
            <Tabpage id="tab1" text="기본관리" url="U_FMS::FMS00111E.xfdl" scrollbars="autoboth"/>
            <Tabpage id="tab2" text="설정관리" url="U_FMS::FMS00112E.xfdl" scrollbars="autoboth"/>
          </Tabpages>
        </Tab>
        <MPFileDialog id="fileDialog" taborder="9" visible="false" position="absolute 848 76 872 100" FileName="" FileNameList="" FilePath="" UserData="" MultiSelect="false" Filter="ALL File(*.*)|*.*" FilterIndex="0" AppendExtDefault="false" Type="Open" FileSize=""/>
        <MPFileDialog id="FileDialogSave" taborder="10" onclick="fileDialog1_onclick" visible="false" position="absolute 884 76 908 100" FileName="" FileNameList="" FilePath="" UserData="" MultiSelect="false" Filter="ALL File(*.*)|*.*" FilterIndex="0" AppendExtDefault="false" Type="Open" FileSize=""/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_CustType">
        <ColumnInfo>
          <Column id="CODE" size="256" type="STRING"/>
          <Column id="code_name" size="256" type="STRING"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="CODE"/>
            <Col id="code_name">전체</Col>
          </Row>
          <Row>
            <Col id="CODE">캐터링</Col>
            <Col id="code_name">캐터링</Col>
          </Row>
          <Row>
            <Col id="CODE">가맹점</Col>
            <Col id="code_name">가맹점</Col>
          </Row>
          <Row>
            <Col id="CODE">일반</Col>
            <Col id="code_name">일반</Col>
          </Row>
          <Row>
            <Col id="CODE">외식</Col>
            <Col id="code_name">외식</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_input">
        <ColumnInfo>
          <Column id="MAIN_UPJANG" size="256" type="STRING"/>
          <Column id="MAIN_UPJANG_NM" size="256" type="STRING"/>
          <Column id="UPJANG" size="256" type="STRING"/>
          <Column id="UPJANG_NM" size="256" type="STRING"/>
          <Column id="CUST_TYPE" size="256" type="STRING"/>
          <Column id="UJ_UPJANG" size="256" type="STRING"/>
          <Column id="UJ_UPJANG_NM" size="256" type="STRING"/>
          <Column id="FILEURL" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="CUST_TYPE"/>
            <Col id="MAIN_UPJANG"/>
            <Col id="MAIN_UPJANG_NM"/>
            <Col id="UJ_UPJANG"/>
            <Col id="UJ_UPJANG_NM"/>
            <Col id="UPJANG"/>
            <Col id="UPJANG_NM"/>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_main" oncolumnchanged="ds_main_OnColumnChanged" onrowposchanged="ds_main_OnRowPosChanged">
        <ColumnInfo>
          <Column id="ACNTCD" size="30" prop="default" type="STRING"/>
          <Column id="ADDR" size="300" prop="default" type="STRING"/>
          <Column id="ATTR01" size="300" prop="default" type="STRING"/>
          <Column id="ATTR02" size="300" prop="default" type="STRING"/>
          <Column id="ATTR03" size="300" prop="default" type="STRING"/>
          <Column id="ATTR04" size="300" prop="default" type="STRING"/>
          <Column id="ATTR05" size="300" prop="default" type="STRING"/>
          <Column id="ATTR06" size="300" prop="default" type="STRING"/>
          <Column id="ATTR07" size="300" prop="default" type="STRING"/>
          <Column id="ATTR08" size="300" prop="default" type="STRING"/>
          <Column id="ATTR09" size="300" prop="default" type="STRING"/>
          <Column id="ATTR10" size="300" prop="default" type="STRING"/>
          <Column id="BANK_CD" size="6" prop="default" type="STRING"/>
          <Column id="BANK_DRNM" size="50" prop="default" type="STRING"/>
          <Column id="BIZ_CAT" size="50" prop="default" type="STRING"/>
          <Column id="BIZ_NUM" size="10" prop="default" type="STRING"/>
          <Column id="BIZ_TYPE" size="50" prop="default" type="STRING"/>
          <Column id="CAPITAL" size="22" prop="default" type="INT"/>
          <Column id="CDATE" size="7" prop="default" type="DATE"/>
          <Column id="CENTER_FLAG" size="1" prop="default" type="STRING"/>
          <Column id="CLASS1_CNT" size="22" prop="default" type="INT"/>
          <Column id="CLASS2_CNT" size="22" prop="default" type="INT"/>
          <Column id="CLASS3_CNT" size="22" prop="default" type="INT"/>
          <Column id="CLASS4_CNT" size="22" prop="default" type="INT"/>
          <Column id="CLASS5_CNT" size="22" prop="default" type="INT"/>
          <Column id="CLASS6_CNT" size="22" prop="default" type="INT"/>
          <Column id="CLASS_CNT" size="22" prop="default" type="INT"/>
          <Column id="CONSUM_OP_RATE_YN" size="1" prop="default" type="STRING"/>
          <Column id="CONSUM_SM_RATE_YN" size="1" prop="default" type="STRING"/>
          <Column id="CONT_SALES_SABUN" size="9" prop="default" type="STRING"/>
          <Column id="CONT_SALES_SABUN_NM" size="20" prop="default" type="STRING"/>
          <Column id="CONTRACT_EDATE" size="8" prop="default" type="STRING"/>
          <Column id="CONTRACT_TERM" size="50" prop="default" type="STRING"/>
          <Column id="CREDIT_AMOUNT" size="22" prop="default" type="INT"/>
          <Column id="CREDIT_AMOUNT_CONTROL_YN" size="1" prop="default" type="STRING"/>
          <Column id="CREDIT_CONTROL_YN" size="1" prop="default" type="STRING"/>
          <Column id="CREDIT_END" size="8" prop="default" type="STRING"/>
          <Column id="CREDIT_EXT_AMOUNT" size="22" prop="default" type="INT"/>
          <Column id="CREDIT_EXT_DAYS" size="22" prop="default" type="INT"/>
          <Column id="CREDIT_GRADE" size="50" prop="default" type="STRING"/>
          <Column id="CREDIT_OVER_AMOUNT" size="22" prop="default" type="INT"/>
          <Column id="CREDIT_START" size="8" prop="default" type="STRING"/>
          <Column id="CREDIT_TURN_CONTROL_YN" size="1" prop="default" type="STRING"/>
          <Column id="CREDIT_TURN_DAYS" size="22" prop="default" type="INT"/>
          <Column id="CREDIT_TYPE" size="13" prop="default" type="STRING"/>
          <Column id="CREDIT_UDATE" size="7" prop="default" type="DATE"/>
          <Column id="CREDIT_UUSER" size="9" prop="default" type="STRING"/>
          <Column id="CS_SABUN" size="9" prop="default" type="STRING"/>
          <Column id="CS_SABUN_NM" size="20" prop="default" type="STRING"/>
          <Column id="CS_TEL_NO" size="20" prop="default" type="STRING"/>
          <Column id="CUSER" size="9" prop="default" type="STRING"/>
          <Column id="CUST_ADDR" size="100" prop="default" type="STRING"/>
          <Column id="CUST_NAME" size="50" prop="default" type="STRING"/>
          <Column id="CUST_TYPE" size="50" prop="default" type="STRING"/>
          <Column id="D_DAYS" size="22" prop="default" type="INT"/>
          <Column id="D_OVER_DAYS" size="22" prop="default" type="INT"/>
          <Column id="D_TIMES" size="22" prop="default" type="INT"/>
          <Column id="DEPT_ID" size="22" prop="default" type="INT"/>
          <Column id="DEPT_ID_NM" size="50" prop="default" type="STRING"/>
          <Column id="EMPLOYEE_CNT" size="22" prop="default" type="INT"/>
          <Column id="FINANCIAL_STATUS" size="50" prop="default" type="STRING"/>
          <Column id="FREE_CNT" size="22" prop="default" type="INT"/>
          <Column id="FST_REG_DATE" size="8" prop="default" type="STRING"/>
          <Column id="GUAR_INSUR_INFO" size="300" prop="default" type="STRING"/>
          <Column id="HEAD_CREDIT_YN" size="1" prop="default" type="STRING"/>
          <Column id="LST_DEAL_DATE" size="8" prop="default" type="STRING"/>
          <Column id="M_LEVEL" size="1" prop="default" type="STRING"/>
          <Column id="MAIL_NUM" size="7" prop="default" type="STRING"/>
          <Column id="MAIN_UPJANG" size="22" prop="default" type="INT"/>
          <Column id="MAIN_UPJANG_NM" size="50" prop="default" type="STRING"/>
          <Column id="MORTGAGE_INFO" size="300" prop="default" type="STRING"/>
          <Column id="OP_RATE_YN" size="1" prop="default" type="STRING"/>
          <Column id="OTCUST_OP_RATE_YN" size="1" prop="default" type="STRING"/>
          <Column id="OTCUST_PRICE_UPJANG" size="22" prop="default" type="INT"/>
          <Column id="OTCUST_PRICE_UPJANG_NM" size="50" prop="default" type="STRING"/>
          <Column id="OTCUST_SM_RATE_YN" size="1" prop="default" type="STRING"/>
          <Column id="OTCUST_UPJANG_TYPE" size="8" prop="default" type="STRING"/>
          <Column id="PART_EMAIL" size="20" prop="default" type="STRING"/>
          <Column id="PART_FAX_NO" size="20" prop="default" type="STRING"/>
          <Column id="PART_HP_NO" size="20" prop="default" type="STRING"/>
          <Column id="PART_NAME" size="20" prop="default" type="STRING"/>
          <Column id="PART_SALES_SABUN" size="9" prop="default" type="STRING"/>
          <Column id="PART_SALES_SABUN_NM" size="20" prop="default" type="STRING"/>
          <Column id="PART_SALES_TEL_NO" size="20" prop="default" type="STRING"/>
          <Column id="PART_TEL_NO" size="20" prop="default" type="STRING"/>
          <Column id="PWD_CHG_CYCLE" size="22" prop="default" type="INT"/>
          <Column id="PWD_CHG_YN" size="1" prop="default" type="STRING"/>
          <Column id="QTY_CONTROL_YN" size="1" prop="default" type="STRING"/>
          <Column id="RCV_EXP_DATE" size="8" prop="default" type="STRING"/>
          <Column id="RCV_TYPE" size="50" prop="default" type="STRING"/>
          <Column id="REMARK" size="300" prop="default" type="STRING"/>
          <Column id="SALE_RATE" size="22" prop="default" type="INT"/>
          <Column id="SIGN1" size="50" prop="default" type="STRING"/>
          <Column id="SIGN2" size="50" prop="default" type="STRING"/>
          <Column id="SIGN3" size="50" prop="default" type="STRING"/>
          <Column id="SIGN4" size="50" prop="default" type="STRING"/>
          <Column id="SM_RATE_YN" size="1" prop="default" type="STRING"/>
          <Column id="SPECIAL_FACT" size="300" prop="default" type="STRING"/>
          <Column id="SUPPLY_END" size="8" prop="default" type="STRING"/>
          <Column id="TOT_CNT" size="22" prop="default" type="INT"/>
          <Column id="UDATE" size="7" prop="default" type="DATE"/>
          <Column id="UPJANG" size="22" prop="default" type="INT"/>
          <Column id="UPJANG_TYPE" size="6" prop="default" type="STRING"/>
          <Column id="UPJANGNM_DISP" size="100" prop="default" type="STRING"/>
          <Column id="USE_YN" size="1" prop="default" type="STRING"/>
          <Column id="UUSER" size="9" prop="default" type="STRING"/>
          <Column id="ZIP_CD" size="7" prop="default" type="STRING"/>
          <Column id="DELIVERY_DETAIL" size="256" prop="default" type="STRING"/>
          <Column id="ADDR_GUBUN" size="256" prop="default" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_useyn">
        <ColumnInfo>
          <Column id="CODE" size="256" type="STRING"/>
          <Column id="code_name" size="256" type="STRING"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="CODE">Y</Col>
            <Col id="code_name">사용</Col>
          </Row>
          <Row>
            <Col id="CODE">N</Col>
            <Col id="code_name">미사용</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_PWD_CHG">
        <ColumnInfo>
          <Column id="CODE" size="256" type="STRING"/>
          <Column id="code_name" size="256" type="STRING"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="CODE">0</Col>
            <Col id="code_name">설정안함</Col>
          </Row>
          <Row>
            <Col id="CODE">15</Col>
            <Col id="code_name">15일</Col>
          </Row>
          <Row>
            <Col id="CODE">30</Col>
            <Col id="code_name">30일</Col>
          </Row>
          <Row>
            <Col id="CODE">60</Col>
            <Col id="code_name">60일</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_ADDR">
        <ColumnInfo>
          <Column id="CD" size="256" prop="default" type="STRING"/>
          <Column id="CDNM" size="256" prop="default" type="STRING"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="CD">P</Col>
            <Col id="CDNM">지번주소</Col>
          </Row>
          <Row>
            <Col id="CD">N</Col>
            <Col id="CDNM">도로명주소</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_cust" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" onvaluechanged="ds_cust_onvaluechanged">
        <ColumnInfo>
          <Column id="UPJANG" type="STRING" size="256"/>
          <Column id="UPJANG_NO" type="STRING" size="256"/>
          <Column id="GUBUN" type="STRING" size="256"/>
          <Column id="CUST_NAME" type="STRING" size="256"/>
          <Column id="CUST_TEL_NO" type="STRING" size="256"/>
          <Column id="CUST_HP_NO" type="STRING" size="256"/>
          <Column id="CUST_FAX_NO" type="STRING" size="256"/>
          <Column id="CUST_EMAIL" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_OtcustType">
        <ColumnInfo>
          <Column id="CODE" size="256" type="STRING"/>
          <Column id="code_name" size="256" type="STRING"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="CODE">대표업장</Col>
            <Col id="code_name">대표 사업장</Col>
          </Row>
          <Row>
            <Col id="CODE">대상업장</Col>
            <Col id="code_name">대상 사업장</Col>
          </Row>
        </Rows>
      </Dataset>
    </Objects>
    <Bind/>
    <Script type="xscript4.0"><![CDATA[include "U_lib::lib_conversionCom.xjs";
/*
 ******************************************************************************************
 * 시스템구분   : 기준정보/사업장관리/사업장 정보관리(사업장관리자용)
 * 프로그램명   : FMS00120E.XML
 * 기      능   : 사업장 정보관리
 * 작  성  자   : 박지영
 * 작성  일자   : 2007-11-26
 * 비      고   : 
 *		- ds_input		: [input DS] 조회조건 파라미터 DS
 *		- ds_CustType	: [코드 DS] 시스템구분 DS (공통코드 : '고객구분')
 *		- ds_useyn		: [코드 DS] 사용구분 DS
 *		- ds_PWD_CHG	: [코드 DS] 비밀번호주기 DS
 *		- ds_main		: [Main DS] 사업장 DS
 * 수 정 일 자  : 2015-05-06.
				   [고도화]_고객정보 그리드 처리 및 쿼리 수정_김태윤.
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
//=========================================================================================
// [ PART 1 ]
// Form에서 Include 할 내용을 정의
//
//=========================================================================================
//@@컨버터에서 주석처리 #include "lib::sc_comon.js"				// 시스템 공통
//@@컨버터에서 주석처리 #include "LIB::lib_comm_0001.js"		//JAVA 코딩시
//@@컨버터에서 주석처리 #include "LIB::tit_comm_0001.js"		// X-Framework Lib
//@@컨버터에서 주석처리 #include "lib::sc_sql_common.js"		// 공통팝업
//@@컨버터에서 주석처리 #include "lib::fm_common.js"			// FM공통
//=========================================================================================
// [ PART 2 ]
// Form에서 사용될 전역변수를 선언
//
//=========================================================================================
var fstrCustinfo;						// 신규입력시 선택된 사업장정보
var fstrUserGroupIn	= "리조트";			// 유저그룹=본부관리자(폼셋팅시 사용)
var fstrSaveUpjang;
var serverSaveDir = "FMM_UPJANG_IMG";			// 파일패스
var serverSaveUrl;								// 파일패스URL
var vUPJANG;									// 사업장Code
//=========================================================================================
// [ PART 3 ]
// Form Loading 시 작업 정의
//
//=========================================================================================
function form_onload(obj:Form, e:LoadEventInfo)
{
	gfn_formOnLoad(obj, false);
	
	// 사용자정보셋팅(파라미터셋팅)
	ed_Upjang.userdata = application.g_Upjang;
	ed_Upjang.value	   = application.g_UpjangNm;
	
	// X-Framework : Action 정보 생성 
	fsp_init(this);
	
	// 초기값 셋팅
	//serverSaveUrl = tit_getServerDir(serverSaveDir);	//As-Is
	serverSaveUrl = fsp_getServerDir(serverSaveDir);
	ds_input.setColumn(0,"FILEURL",serverSaveUrl);
	
	ed_Upjang.setFocus();
	
	if (gfn_length(ed_Upjang.userdata)>0)
	{
		fn_search();			// 자동조회
	}
}
//=========================================================================================
// [ PART 4 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,도움말,form닫기)
//
//=========================================================================================
/*
 ******************************************************************************************
 * 함  수  명   : fn_Search()
 * 기      능   : [조회버튼] 검색조건에 해당하는 정보를 조회
 ******************************************************************************************
 */
function fn_search()
{
	// 조회조건체크
	if (gfn_length(ed_Upjang.userdata)==0)
	{
		g_Message("EE","본사를 선택하세요.");
		ed_Upjang.setFocus();
		return;
	}
	
	// 초기화
	ds_main.clearData();
	ds_cust.clearData();
	
	// 파라미터셋팅
	//ds_input.setColumn(0,"MAIN_UPJANG",ed_Upjang.userdata);	 // 메인 사업장
	ds_input.setColumn(0,"UJ_UPJANG",ed_Upjang.userdata);	 // 사업장
	
	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	
	inData			= "ds_input=ds_input";
	outData			= "ds_main=ds_main ds_cust=ds_cust";
	callBackFnc		= "fn_afterSearch";
	
	//
	var nRow;
	nRow = ds_main.rowposition;
	otherArg		=  "UJ_UPJANG="	+ ed_Upjang.userdata;
	otherArg		+= " FILEURL="	+ serverSaveUrl;
	otherArg    	+= " p_MaskAuth=" + wrapQuote(SCAuth.getMaskAuth(this)); //wrapQuote(SCAuth.getMaskAuth(this)); // 테스트를 위해 '1'로 설정!!!
	
	fsp_clear(this); 
    fsp_addSearch(this, "fm/fms:FMS00100E_S002");									// 조회
    fsp_addSearch(this, "fm/fms:FMS00100E_S004");									// 고객정보 조회 
    
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);		// 서비스 호출 
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_Insert()
 * 기      능   : [입력버튼] 입력 시 처리되는 작업
 * 비      고	: 팝업사용
 ******************************************************************************************
 */
function fn_insert()
{
	/*
	var nRow;
	
	// 입력체크(1건만 입력가능)
	if(ds_main.GetUpdate()==true)
	{
		if(!g_Confirm("02","변경된 데이터가 있습니다.\n새로운 자료를 입력하시겠습니까?\n(기존에 입력한 자료는 사라집니다.)"))
		{
			return;
		}
	}
	
	fstrCustinfo="";
	
	// 팝업
	fstrCustinfo = gfn_dialog("", "U_FMS::FMS00100P.xml","");
	
	if (length(fstrCustinfo)=0)
	{
		return;
	}
	
	ds_main.ClearData();
	
	nRow = ds_main.addRow();
	
	// 초기값 셋팅
	fn_CustInfoSetting();																// 팝업값셋팅
	ds_main.setColumn(nRow, "UPJANGNM_DISP", ds_main.GetColumn(nRow,"CUST_NAME"));		// 사업장명(고객용)
	ds_main.setColumn(nRow, "CUST_TYPE", rdo_CUST_TYPE.Value);							// 고객구분
	ds_main.setColumn(nRow, "USE_YN", "Y");												// 사용여부
	ds_main.setColumn(nRow, "PWD_CHG_YN", "");											// 비밀번호주기
	
	ds_main.setColumn(nRow, "CONSUM_OP_RATE_YN", "N");				// 소모품운영단가 작업
	ds_main.setColumn(nRow, "OTCUST_OP_RATE_YN", "N");				// 타거래처운영단가작업
	ds_main.setColumn(nRow, "CONSUM_SM_RATE_YN", "N");				// 소모품 제출단가 조정
	ds_main.setColumn(nRow, "OTCUST_SM_RATE_YN", "N");				// 타거래처 제출단가 작업
    ds_main.setColumn(nRow, "CUSER", g_EmpNo);
    ds_main.setColumn(nRow, "UUSER", g_EmpNo);
    
    btn_Copy.Enable = true;
    tab_list.tab1.ed_UPJANG.Enable = true;
    
    Tab_list.TabIndex =0;
    Tab_list.tab1.ed_UPJANG.SetFocus();
    */
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_Save()
 * 기      능   : [저장버튼] 저장 시 처리되는 작업
 ******************************************************************************************
 */
function fn_save()
{
	// 변경여부 확인
	if(gfn_dsIsUpdated(ds_main)==false && gfn_dsIsUpdated(ds_cust)==false)
	{
		g_Message("EE","변경된 데이터가 없습니다.");
		return;
	}
	
	if(!fn_SaveCheck())
	{
		return;
	}
	//alert("===>"+ds_main.getColumn(ds_main.rowposition,"UPJANG"));
	fstrSaveUpjang = ds_main.getColumn(ds_main.rowposition,"UPJANG");
	
    // 서비스셋팅
    var actionName, cmdName, inData, outData, otherArg, callBackFnc;
    var insertSql, updateSql, deleteSql,saveFlagColumn, keySqlName, keyIncrement, callbackSql;
    
    inData		= "ds_main=ds_main:U ds_input=ds_input ds_cust=ds_cust:U ";
    outData		= "ds_main=ds_main ds_cust=ds_cust ";
    callBackFnc	= "fn_afterSave";
    
    fsp_clear(this);
    fsp_addSave(this, insertSql, "fm/fms:FMS00100E_U001", deleteSql,saveFlagColumn, keySqlName, -1, "fm/fms:FMS00100E_S001");
    // 고객정보
    fsp_addSave(this, "fm/fms:FMS00100E_I002", "fm/fms:FMS00100E_U002", "fm/fms:FMS00100E_D002", saveFlagColumn, keySqlName, keyIncrement, callbackSql);
    fsp_addSave(this, "", "fm/fms:FMS00100E_U004", "", saveFlagColumn, keySqlName, keyIncrement, callbackSql);
    fsp_addSave(this, "", "fm/fms:FMS00100E_U005", "", saveFlagColumn, keySqlName, keyIncrement, callbackSql);
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);		// 서비스 호출 
   
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_Delete()
 * 기      능   : [삭제버튼] 삭제 시 처리되는 작업
 ******************************************************************************************
 */
function fn_delete()
{
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_Print()
 * 기      능   : [출력버튼] 출력 시 처리되는 작업
 ******************************************************************************************
 */
function fn_print()
{
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_Close()
 * 기      능   : [닫기버튼] 화면을 닫을때 처리되는 작업
 ******************************************************************************************
 */
function fn_Close()
{
	this.close();
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_Help()
 * 기      능   : [도움말버튼] 도움말
 ******************************************************************************************
 */
function fn_help()
{
	// tit_addSearchActionInfo(this, "fm/fms:SCC_MENU_SELECT");
	// tit_callService(this, "", "", "ds_cond=ds_cond", "ds_Menu=ds_list", "", "");	
}
//=========================================================================================
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
//
//=========================================================================================
/*
 ******************************************************************************************
 * 함  수  명   : fn_SaveCheck()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 저상시 필수입력 체크
 * 작  성  자   : 박지영
 * 작성  일자   : 2007-11-20  
 ******************************************************************************************
 */
function fn_SaveCheck()
{
	var nFRow,nRow,strValue,btp,strmsg;
	
	nRow = ds_main.rowposition;
	
	// 필수 입력 사항 확인 
	// 사업장코드
	nFRow = ds_main.findRowExpr("gfn_length(gfn_trim(UPJANG))==0");
	if( nFRow !=-1 )
	{
		ds_main.rowposition = nFRow;
		g_Message("EE","사업장코드를 입력해주십시오.");
		tab_list.tabindex = 0;
		tab_list.tab1.ed_UPJANG.setFocus();
		return;
	}

	// 고객구분
	/*
	nFRow = ds_main.findRowExpr("gfn_length(gfn_trim(CUST_TYPE))==0");
	if( nFRow !=-1 )
	{
		ds_main.rowposition = nFRow;
		g_Message("EE","고객구분을 입력해주십시오.");
		tab_list.tabindex = 0;
		tab_list.tab1.cbo_CUST_TYPE.setFocus();
		return;
	}
	*/
	// 코드구분
	nFRow = ds_main.findRowExpr("gfn_length(gfn_trim(UPJANG_TYPE))==0");
	if( nFRow !=-1 )
	{
		ds_main.rowposition = nFRow;
		g_Message("EE","코드구분을 입력해주십시오.");
		tab_list.tabindex = 0;
		tab_list.tab1.rdo_UPJANG_TYPE.setFocus();
		return;
	}
	
	/*
	// 사업장명
	nFRow = ds_main.SearchRow("length(trim(CUST_NAME))==0");
	if( nFRow !=-1 )
	{
		ds_main.row = nFRow;
		g_Message("EE","사업장명을 입력해주십시오.");
		tab_list.TabIndex = 0;
		tab_list.tab1.ed_CUST_NAME.SetFocus();
		return;
	}
	*/
	
	// 본사그룹
	nFRow = ds_main.findRowExpr("gfn_length(gfn_trim(MAIN_UPJANG))==0");
	if( nFRow !=-1 )
	{
		ds_main.rowposition = nFRow;
		g_Message("EE","본사그룹을 입력해주십시오.");
		tab_list.tabindex = 0;
		tab_list.tab1.ed_UPJANG.setFocus();
		return;
	}
	
	/*
	// 사업자번호
	nFRow = ds_main.SearchRow("length(trim(BIZ_NUM))==0");
	if( nFRow !=-1 )
	{
		ds_main.row = nFRow;
		g_Message("EE","사업자번호를 입력해주십시오.");
		tab_list.TabIndex = 0;
		tab_list.tab1.med_BIZ_NUM.SetFocus();
		return;
	}
	*/
	
	// 영업사원
	/*
	nFRow = ds_main.findRowExpr("gfn_length(gfn_trim(PART_SALES_SABUN))==0");
	if( nFRow !=-1 )
	{
		ds_main.rowposition = nFRow;
		g_Message("EE","영업사원을 입력해주십시오.");
		tab_list.tabindex = 0;
		tab_list.tab1.ed_PART_SALES_SABUN_NM.setFocus();
		return;
	}

	// 영업사원 연락처
	nFRow = ds_main.findRowExpr("gfn_length(gfn_trim(PART_SALES_TEL_NO))==0");
	if( nFRow !=-1 )
	{
		ds_main.rowposition = nFRow;
		g_Message("EE","영업사원 연락처를 입력해주십시오.");
		tab_list.tabindex = 0;
		tab_list.tab1.ed_PART_SALES_TEL_NO.setFocus();
		return;
	}
	
	// C/S사원
	nFRow = ds_main.findRowExpr("gfn_length(gfn_trim(CS_SABUN))==0");
	if( nFRow !=-1 )
	{
		ds_main.rowposition = nFRow;
		g_Message("EE","C/S사원을 입력해주십시오.");
		tab_list.tabindex = 0;
		tab_list.tab1.ed_CS_SABUN_NM.setFocus();
		return;
	}
	
	// C/S사원 연락처
	nFRow = ds_main.findRowExpr("gfn_length(gfn_trim(CS_TEL_NO))==0");
	if( nFRow !=-1 )
	{
		ds_main.rowposition = nFRow;
		g_Message("EE","C/S사원 연락처를 입력해주십시오.");
		tab_list.tabindex = 0;
		tab_list.tab1.ed_CS_TEL_NO.setFocus();
		return;
	}
	*/
	// 사용여부
	nFRow = ds_main.findRowExpr("gfn_length(gfn_trim(USE_YN))==0");
	if( nFRow !=-1 )
	{
		ds_main.rowposition = nFRow;
		g_Message("EE","사용여부를 입력해주십시오.");
		tab_list.tabindex = 0;
		tab_list.tab1.cbo_USE_YN.setFocus();
		return;
	}
	
	// 결제라인설정 체크
	// 결제자1
	if (gfn_length(ds_main.getColumn(nRow,"SIGN2"))> 0 || gfn_length(ds_main.getColumn(nRow,"SIGN3"))> 0 || gfn_length(ds_main.getColumn(nRow,"SIGN4"))> 0)
	{
		if (gfn_length(ds_main.getColumn(nRow,"SIGN1"))== 0)
		{
			g_Message("EE", "결제자1을 입력해주십시오.");
			tab_list.tabindex = 1;
			tab_list.tab2.ed_SIGN1.setFocus();
			return false;
		}
	}
	// 결제자2
	if (gfn_length(ds_main.getColumn(nRow,"SIGN3"))> 0 || gfn_length(ds_main.getColumn(nRow,"SIGN4"))> 0)
	{
		if (gfn_length(ds_main.getColumn(nRow,"SIGN2"))== 0)
		{
			g_Message("EE", "결제자2를 입력해주십시오.");
			tab_list.tabindex = 1;
			tab_list.tab2.ed_SIGN2.setFocus();
			return false;
		}
	}
	// 결제자3
	if (gfn_length(ds_main.getColumn(nRow,"SIGN4"))> 0)
	{
		if (gfn_length(ds_main.getColumn(nRow,"SIGN3"))== 0)
		{
			g_Message("EE", "결제자3을 입력해주십시오.");
			tab_list.tabindex = 1;
			tab_list.tab2.ed_SIGN3.setFocus();
			return false;
		}
	}
    
    // 여신정보 체크
    // 관리기준이 관리안함인 경우는 체크안함. 여신일,여신액,여신일+여신액인 경우 각 항목의 값이 0이상 인지를 체크
    btp = false;
    strValue = ds_main.getColumn(nRow,"CREDIT_TYPE");

    if (strValue!="관리안함")
    {
		if (strValue!="여신일")
		{
			if (toNumber(ds_main.getColumn(nRow,"CREDIT_AMOUNT"))<=0)
			{
				btp = true;
			}
		}
		
		if (strValue!="여신액")
		{
			if (toNumber(ds_main.getColumn(nRow,"CREDIT_TURN_DAYS"))<=0)
			{
				btp = true;
			}
		}
		/*
		if (btp)
		{
			strmsg = "설정 및 채권/여신정보를 등록하지 않으셨습니다.\n";
		}
		*/
    }
    
    // 저장확인
	if(!g_Confirm("02",gfn_nvl(strmsg,"")+"그대로 저장하시겠습니까?"))
	{
		return false;
	}
    
    return true;
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_FormSetting()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 조회 후 화면셋팅
 * 작  성  자   : 박지영
 * 작성  일자   : 2007-11-20  
 ******************************************************************************************
 */
function fn_FormSetting()
{
	var nRow,strValue,btp1,btp2;
	
	nRow = ds_main.rowposition;
	
	// insert인 경우만 true
	if (GetRowType(ds_main,nRow)!="insert")
	{
		tab_list.tab1.ed_UPJANG.enable = false;
		btn_Copy.enable = false;
	}
	
	// 대상업장인 경우만 선택팝업 가능
	strValue = ds_main.getColumn(nRow,"OTCUST_UPJANG_TYPE");
	if (strValue == "대상업장")
	{
		tab_list.tab2.btn_pop6.visible = true;
	}
	else
	{
		tab_list.tab2.btn_pop6.visible = false;
	}
	
	// 사업자번호 형식지정
	strValue = ds_main.getColumn(nRow,"BIZ_NUM");
	if(gfn_length(strValue)==10)
	{
		tab_list.tab1.med_BIZ_NUM.mask = "@@@-@@-@@@@@";
	}
	else if(gfn_length(tab_list.tab1.med_BIZ_NUM.value)==13)
	{
		tab_list.tab1.med_BIZ_NUM.mask = "@@@@@@-@@@@@@@";
	}
	else
	{
		tab_list.tab1.med_BIZ_NUM.mask = "";
	}
	
	// 본사/사업장에 따른 화면셋팅
	strValue = ds_main.getColumn(nRow,"M_LEVEL");
	if(strValue=="0")
	{
		tab_list.tab1.div_mainupjang.visible = true;		// 추가정보
		tab_list.tab1.div_upjang.visible = false;			// 추가정보
		//tab_list.tab2.btn_Batch.Visible = true;				// 일괄적용
		
		// 사용권한(본부관리자/그외)
		if (g_UserGroup == fstrUserGroupIn)	// 본부관리자
		{
			tab_list.tab1.cbo_USE_YN.enable 			= true;			// 사용여부
			tab_list.tab1.ed_CONTRACT_TERM.enable		= true;			// 계약기간
			tab_list.tab1.btn_CONTRACT_TERM.enable		= true;			// 계약기간
			tab_list.tab1.cal_CONTRACT_EDATE.enable		= true;			// 계약종료일
			tab_list.tab1.btn_CONTRACT_EDATE.enable		= true;			// 계약종료일
		}
		else
		{
			tab_list.tab1.cbo_USE_YN.enable 			= false;		// 사용여부
			tab_list.tab1.ed_CONTRACT_TERM.enable		= false;		// 계약기간
			tab_list.tab1.btn_CONTRACT_TERM.enable		= false;		// 계약기간
			tab_list.tab1.cal_CONTRACT_EDATE.enable		= false;		// 계약종료일
			tab_list.tab1.btn_CONTRACT_EDATE.enable		= false;		// 계약종료일
		}
	}
	else
	{
		tab_list.tab1.div_mainupjang.visible = false;		// 추가정보
		tab_list.tab1.div_upjang.visible = true;			// 추가정보
		tab_list.tab1.cbo_USE_YN.enable = true;				// 사용여부
		//tab_list.tab2.btn_Batch.Visible = false;			// 일괄적용
	}
	
	// 본사인 경우만 이미지 업로드 다운로드
	strValue = ds_main.getColumn(nRow,"UPJANG_TYPE");
	if (strValue == "본사")
	{
		btp1 = true;
		btp2 = false;
	}
	else
	{
		btp1 = false;
		btp2 = true;
	}
	
	tab_list.tab1.img_photo.visible 		= btp1;
	tab_list.tab1.btn_UploadImg.visible 	= btp1;
	tab_list.tab1.btn_DeleteImg.visible 	= btp1;	
	tab_list.tab1.st_bk1.visible 			= btp1;
	tab_list.tab1.Static7.visible			= btp1;
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_CustInfoSetting()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 입력시 사업장정보를 셋팅
 * 작  성  자   : 박지영
 * 작성  일자   : 2007-11-20  
 * 비      고	: 
	- 팝업리턴 값
 		[0] strReturn = 		ds_list.GetColumn(nRow,"CUST_CD");					// 사업자등록번호
		[1] strReturn += "; " + ds_list.GetColumn(nRow,"CUST_NAME");				// 사업장명
		[2] strReturn += "; " + ds_list.GetColumn(nRow,"HILVL_CUST_CD"); 			// 사업자등록번호-본사
		[3] strReturn += "; " + ds_list.GetColumn(nRow,"HILVL_CUST_NAME"); 			// 본사명
		[4] strReturn += "; " + ds_list.GetColumn(nRow,"MAIL_NUM"); 				// 소재지 우편번호
		[5] strReturn += "; " + ds_list.GetColumn(nRow,"ADDR"); 					// 소재지
		[6] strReturn += "; " + ds_list.GetColumn(nRow,"BIZ_TYPE"); 				// 업종
		[7] strReturn += "; " + ds_list.GetColumn(nRow,"BIZ_CAT"); 					// 업태		
		[8] strReturn += "; " + ds_list.GetColumn(nRow,"UPJANG_TYPE"); 				// 업태종류(본사/사업장)
		[9] strReturn += "; " + ds_list.GetColumn(nRow,"HILVL_UPJANG"); 			// 본사 업종코드
		[10] strReturn += "; " + ds_list.GetColumn(nRow,"BIZ_NUM"); 				// 사업자번호
		[11] strReturn += "; " + ds_list.GetColumn(nRow,"UPJANG"); 					// 업장코드
 ******************************************************************************************
 */
function fn_CustInfoSetting()
{
	var nRow;
	
	nRow	= ds_main.rowposition;
	
	strResult	= gfn_split(fstrCustinfo, ";");
	
	ds_main.setColumn(nRow, "CUSTCD", gfn_trim(strResult[0]));			// 사업자번호
	ds_main.setColumn(nRow, "CUST_NAME", gfn_trim(strResult[1]));		// 사업장명
	ds_main.setColumn(nRow, "MAIL_NUM", gfn_trim(strResult[4]));		// 소재지 우편번호
	ds_main.setColumn(nRow, "CUST_ADDR", gfn_trim(strResult[5]));		// 소재지
	ds_main.setColumn(nRow, "BIZ_TYPE", gfn_trim(strResult[6]));		// 업종
	ds_main.setColumn(nRow, "BIZ_CAT", gfn_trim(strResult[7]));			// 업태
	ds_main.setColumn(nRow, "UPJANG_TYPE", gfn_trim(strResult[8]));		// 업태종류(본사/사업장)
	ds_main.setColumn(nRow, "BIZ_NUM", gfn_trim(strResult[10]));		// 사업자번호
	ds_main.setColumn(nRow, "UPJANG", gfn_trim(strResult[11]));			// 업장코드
	
	if (gfn_length(gfn_trim(strResult[9]))>0)
	{
		ds_main.setColumn(nRow, "MAIN_UPJANG", gfn_trim(strResult[9]));			// 본사 업종코드
		ds_main.setColumn(nRow, "MAIN_UPJANG_NM", gfn_trim(strResult[3]));		// 본사명
	}
	
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_afterSearch()
 * 입      력   : errCode 	= 에러코드
				  errMsg	= 에러메세지
 * 반      환   : 없음
 * 기      능   : 사업장 조회 후 실행 함수
 * 작  성  자   : 박지영
 * 작성  일자   : 2007-11-20  
 ******************************************************************************************
 */
function fn_afterSearch(errCode, errMsg)
{
	if(errCode!=0)
	{
		g_Message("EE","서비스 오류:시스템 관리자에게 문의하십시오");
		return;
	}
	else
	{
		fn_FormSetting();
	}
	//개인정보보호 접근로그를 쌓는다. 조회조건과 조회건수
	SCPersInfo.accessReadLog(this, ds_input.saveXML(), ds_main.getRowCount());
	//SCPersInfo.accessReadLog(this, ds_input.saveXML(), ds_cust.getRowCount());
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_afterSave()
 * 입      력   : errCode 	= 에러코드
				  errMsg	= 에러메세지
 * 반      환   : 없음
 * 기      능   : 저장
 * 작  성  자   : 박지영
 * 작성  일자   : 2008-01-16 
 ******************************************************************************************
 */
function fn_afterSave(errCode, errMsg)
{
	if(errCode==0)
	{
		g_Message("02","사업장 정보가 저장되었습니다.");
		var nFRow = ds_main.findRow("UPJANG",fstrSaveUpjang);

		if (nFRow >= 0)
		{
			ds_main.rowposition = nFRow;
			fn_SerchSub(fstrSaveUpjang);
		}
	}
	//개인정보보호 접근로그를 쌓는다. 처리한 개인정보칼럼을 나열한다. 
	SCPersInfo.accessWriteLog(this, "CUST_ADDR_INFO, ADDR_INFO, PART_NAME, CUST_TEL_NO, CUST_HP_NO, CUST_EMAIL, PART_SALES_SABUN_NM, PART_SALES_TEL_NO, CS_SABUN_NM, CS_TEL_NO");
	//SCPersInfo.accessWriteLog(this, "med_BIZ_NUM, ed_PART_SALES_SABUN_NM, ed_PART_SALES_TEL_NO, ed_CS_SABUN_NM, ed_CS_TEL_NO, ed_DRNAME, ed_ADDR2");
}
//=========================================================================================
// [ PART 6 ]
// component Event 정의 ( User Define function )
// --> component Event의 기요,기능,동작 등 상세내용은 MiPlatform 메뉴얼을 참조하시기 바랍니다.
//=========================================================================================
/*
 ******************************************************************************************
 * 함  수  명   : ds_main_OnRowPosChanged(obj,nOldRow,nRow)
 * 기      능   : 행변경시 폼셋팅
 * 작  성  자   : 박지영
 * 작성  일자   : 2007-11-20  
 ******************************************************************************************
 */
function ds_main_OnRowPosChanged(obj:Dataset, e:DSRowPosChangeEventInfo)
{
	fn_FormSetting();

	
	var v_path="FMS_UPJANG_STAMP";	
	
	if (gfn_length(gfn_trim(ds_main.getColumn(e.newrow,"STAMP_IMG")))== 0) {
		tab_list.tab2.img_photo.image = "";		
	}
	else
	{
		tab_list.tab2.img_photo.image = fsp_getServerDir(v_path, ds_main.getColumn(e.newrow,"STAMP_IMG"));				
	}
}

 /******************************************************************************************
 * 함  수  명   : grd_List_OnHeadClick(obj,nCell,nX,nY,nPivotIndex)
 * 기      능   : 그리드헤드 더블클릭시 Sort
 * 작  성  자   : 박지영
 * 작성  일자   : 2007-11-20  
 ******************************************************************************************
 */
function grd_List_OnHeadClick(obj,nCell,nX,nY,nPivotIndex)
{
	gfn_gridSort(obj, e); //(eval(obj.Binddataset), obj, nCell);
}

 /******************************************************************************************
 * 함  수  명   : ds_main_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
 * 기      능   : 데이타 변경시 셋팅작업
 * 작  성  자   : 박지영
 * 작성  일자   : 2007-11-20  
 ******************************************************************************************
 */
function ds_main_OnColumnChanged(obj:Dataset, e:DSColChangeEventInfo)
{
	
	// 코드구분이 본사인 경우 본사/본사그룹 자동셋팅
	if (e.columnid=="UPJANG_TYPE" && e.newvalue=="본사")
	{
		ds_main.setColumn(e.row,"MAIN_UPJANG",ds_main.getColumn(e.row,"UPJANG"));
		ds_main.setColumn(e.row,"MAIN_UPJANG_NM",ds_main.getColumn(e.row,"CUST_NAME"));
	}
	
	// 타거래처단가업장이 대표업장인 경우 타거래단가업장코드 셋팅
	if (e.columnid=="OTCUST_UPJANG_TYPE" && e.newvalue=="대표업장")
	{
		ds_main.setColumn(e.row,"OTCUST_PRICE_UPJANG",ds_main.getColumn(e.row,"UPJANG"));
		ds_main.setColumn(e.row,"OTCUST_PRICE_UPJANG_NM",ds_main.getColumn(e.row,"CUST_NAME"));
	}
	
	// 재직인원변경시 총인원 셋팅
	if (e.columnid=="CLASS1_CNT" || e.columnid=="CLASS2_CNT" || e.columnid=="CLASS3_CNT")
	{
		var nCnt = toNumber(ds_main.getColumn(e.row,"CLASS1_CNT")) + toNumber(ds_main.getColumn(e.row,"CLASS2_CNT")) + toNumber(ds_main.getColumn(e.row,"CLASS3_CNT"));
		ds_main.setColumn(e.row,"TOT_CNT",nCnt);
	}
	
	// 본사의 비밀번호 변경주기 변경시 하위 비밀번호 변경주기 셋팅
	if (e.columnid=="PWD_CHG_CYCLE")
	{
		if (ds_main.getColumn(e.row,"M_LEVEL") == "0")
		{
			ds_main.enableevent = false;
			for (i=1;i<ds_main.rowcount;i++)
			{
				ds_main.setColumn(i,"PWD_CHG_CYCLE",ds_main.getColumn(0,"PWD_CHG_CYCLE"));
			}
			ds_main.enableevent = true;
		}
	}
	
	fn_FormSetting();
}

/*
 ******************************************************************************************
 * 함  수  명   : btn_pop1_OnClick(obj)
 * 기      능   : 팝업버튼 클릭 -> 사업장 조회
 * 작  성  자   : 박지영
 * 작성  일자   : 2007-12-05  
 ******************************************************************************************
 */
function fn_edBtn_OnClick(obj:Button, e:ClickEventInfo)
{
	var sAddWhere = "";
	
	switch(obj.name)
	{	
		case "btn_Upjang":
			if (application.g_UserKind == '사업장'){
				sAddWhere = " AND A.USE_YN = 'Y' AND A.MAIN_UPJANG = " + g_Main_Upjang;			
				sAddWhere += " AND ( A.UPJANG = " + application.g_Upjang + " OR EXISTS (SELECT 1 FROM FMS_USER_UPJANG B WHERE B.USE_YN = 'Y' AND B.UPJANG = A.UPJANG AND B.SABUN = '" + application.g_EmpNo + "') )";													
				break;
			}
			else if (application.g_UserKind == '본사'){		
				sAddWhere = " AND A.USE_YN = 'Y' AND A.MAIN_UPJANG = " + g_Main_Upjang;							
				break;
			}
			
			if (application.g_UserKind == '본부'){
				sAddWhere = " AND A.USE_YN = 'Y' " ;
				break;
			}
		
		default:
			break;
	}
	//fm공통 팝업클릭 호출
	if (ffn_btn_OnClick(obj, sAddWhere)) fn_Trigger_edBtn(eval("ed_" + gfn_subStr(obj.name, 4)));
	
}

function fn_edBtn_OnKeyDown(obj:Edit, e:KeyEventInfo)
{	
	ffn_ed_OnKeyDown(obj,e.keycode);	
}

function fn_Trigger_edBtn(obj)
{
	switch(obj)
	{
		case ed_Upjang:
			if (! ffn_ChkNull(obj.userdata))
			{
				fn_search();
			}
			break;
	
		default:
			break;
	}		
}

/*
 ******************************************************************************************
 * 함  수  명   : ed_pop_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam)
 * 기      능   : 업장엔터시팝업
 * 작  성  자   : 박지영
 * 작성  일자   : 2007-12-18  
 ******************************************************************************************
 */
function ed_pop_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam)
{
	if (nChar == 13)
	{
		var objme = eval(obj.userdata);
		objme.click();
	}
}

/*
 업장별 고객정보 조회.
*/
/*
function tv_list_oncellclick(obj:Grid, e:GridClickEventInfo)
{
	var nUPJANG;
	
	if (e.cell == 3)		// 본사명 클릭 
	{
		nUPJANG = ds_main.getColumn(e.row,"MAIN_UPJANG");
	}
	else				// 그외 다른셀 클릭
	{
		nUPJANG = ds_main.getColumn(e.row,"UPJANG");
	}
	
	fn_SerchSub(nUPJANG);
}
*/
/*
 ******************************************************************************************
 * 함  수  명   : fn_SerchSub(nUPJANG)
 * 입      력   : nUPJANG = 조회할 업장코드
 * 반      환   : 없음
 * 기      능   : 사업장 상세정보 조회
 * 작  성  자   : 박지영
 * 작성  일자   : 2007-11-20  
 * 수  정  자   : 김태윤
 * 수정  일자   : 2015-05-07  
 ******************************************************************************************
 */
function fn_SerchSub(nUPJANG)
{
	vUPJANG = nUPJANG;
	// 조회조건체크
	
	// 초기화
	ds_cust.clearData();
	
	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	
	//inData			= "ds_input=ds_input";
	outData			= "ds_cust=ds_cust";
	callBackFnc		= "fn_afterSearch";
	
	otherArg		=  "UJ_UPJANG="	+ nUPJANG;
	otherArg		+= " FILEURL="	+ serverSaveUrl;
	otherArg    	+= " p_MaskAuth=" + wrapQuote(SCAuth.getMaskAuth(this)); //wrapQuote(SCAuth.getMaskAuth(this)); // 테스트를 위해 '1'로 설정!!!
	
		
	// 파라미터셋팅
	ds_input.setColumn(0,"UJ_UPJANG",nUPJANG);						// 사업장코드
	
	fsp_clear(this); 
	fsp_addSearch(this, "fm/fms:FMS00100E_S002");
    fsp_addSearch(this, "fm/fms:FMS00100E_S004");
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);		// 서비스 호출 
    
}]]></Script>
  </Form>
</FDL>
