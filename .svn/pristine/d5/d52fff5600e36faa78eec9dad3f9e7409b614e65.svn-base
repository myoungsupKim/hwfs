<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>	
	<title>조이너스 시스템 WEBPBX 샘플</title>
	<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=EUC-KR">
<style>
	TD {font:normal 9pt Gulim;}
	BUTTON {font:normal 9pt Gulim;height:28px;}
</style>
</head>
<script language="JavaScript">
//서버 접속
function connect() {
	var obj = document.getElementById("WebPBX");
	if (obj != null) {
		var f = document.frm;
		if (f != null) {			
			//obj.AppServer		= "172.25.5.186";					//애플리케이션 서버 주소 - 
			obj.AppServer		= f.appip.value;// "218.48.215.182";					//애플리케이션 서버 주소 - 
			obj.Port = f.port.value;											 //로컬서버와 통신하는 포트
			obj.AutoCallAfter	= true;									//콜통화후 자동 후처리(true:자동처리, false:미처리)
			obj.PBXServer = f.serverip.value;						//PBXServer IP 설정 - 172.25.6.91
			obj.DoLogon(f.username.value, f.passwd.value);	//서버에 연결(콜아이디 , 콜비밀번호)
			obj.Group = f.group.value;								//그룹설정(외식:2000, 급식:3000)
			alert(obj.IsDebug);
			var obj = document.getElementById("btnConnect");
			if (obj != null) obj.disabled = true;
			var obj = document.getElementById("btnDisconnect");
			if (obj != null) obj.disabled = false;
			var obj = document.getElementById("btnDoTransfer");
			if (obj != null) obj.disabled = true;
			var obj = document.getElementById("btnDoAnswer");
			if (obj != null) obj.disabled = true;
			var obj = document.getElementById("btnDoHangup");
			if (obj != null) obj.disabled = true;
			var obj = document.getElementById("btnDoDone");
			if (obj != null) obj.disabled = true;
			var obj = document.getElementById("btnDoObAfter");
			if (obj != null) obj.disabled = true;
			var obj = document.getElementById("btnDoRest");
			if (obj != null) obj.disabled = false;
			var obj = document.getElementById("btnDoEdu");
			if (obj != null) obj.disabled = false;
			var obj = document.getElementById("btnDoMeal");
			if (obj != null) obj.disabled = false;
			var obj = document.getElementById("btnDoMeet");
			if (obj != null) obj.disabled = false;
			var obj = document.getElementById("btnDoEtc");
			if (obj != null) obj.disabled = false;			
		}
	}
}

//서버 연결 종료
function disconnect() {
	var obj = document.getElementById("WebPBX");
	if (obj != null) {
		obj.DoLogout();	//서버접속 종료
		var obj = document.getElementById("btnConnect");
		if (obj != null) obj.disabled = false;
		var obj = document.getElementById("btnDisconnect");
		if (obj != null) obj.disabled = true;
		var obj = document.getElementById("btnDoDial");
		if (obj != null) obj.disabled = true;
		var obj = document.getElementById("btnDoHold");
		if (obj != null) obj.disabled = true;
		var obj = document.getElementById("btnDoTransfer");
		if (obj != null) obj.disabled = true;
		var obj = document.getElementById("btnDoAnswer");
		if (obj != null) obj.disabled = true;
		var obj = document.getElementById("btnDoHangup");
		if (obj != null) obj.disabled = true;
		var obj = document.getElementById("btnDoDone");
		if (obj != null) obj.disabled = true;
		var obj = document.getElementById("btnDoObAfter");
		if (obj != null) obj.disabled = true;
		var obj = document.getElementById("btnDoRest");
		if (obj != null) obj.disabled = true;
		var obj = document.getElementById("btnDoEdu");
		if (obj != null) obj.disabled = true;
		var obj = document.getElementById("btnDoMeal");
		if (obj != null) obj.disabled = true;
		var obj = document.getElementById("btnDoMeet");
		if (obj != null) obj.disabled = true;
		var obj = document.getElementById("btnDoEtc");
		if (obj != null) obj.disabled = true;
	}
}

//전화 걸기
function DoDial() {
	var obj = document.getElementById("WebPBX");
	if (obj != null) {
		var f = document.frm;
		if (f != null) {
			obj.DialNum = f.tel.value;
			obj.DoDial();	//전화걸기
			//아래와 같은 방법으로도 가능
			//obj.Dial(f.tel.value);
		}
	}
}

//통화
function DoAnswer() {
	var obj = document.getElementById("WebPBX");
	if (obj != null) {
		obj.DoAnswer();
	}
}

//홀딩
function DoHold() {
	var obj = document.getElementById("WebPBX");
	if (obj != null) obj.DoHold();
}

//당겨받기
function DoPickup() {
	var obj = document.getElementById("WebPBX");
	if (obj != null) obj.DoPickup("");
}

//통화 종료
function DoHangup() {
	var obj = document.getElementById("WebPBX");
	if (obj != null) {
		obj.DoHangup();
	}
}

//전화돌려주기
function DoTransfer() {
	var obj = document.getElementById("WebPBX");
	if (obj != null) {
		var f = document.frm;
		if (f != null) {
			obj.DoTransfer(f.trans.value);
		}
	}
}

//인바운드 콜 후처리 종료
function DoDone() {
	var obj = document.getElementById("WebPBX");           
	if (obj != null) {
		obj.DoDone();
	}
}

//아웃바운드 콜 후처리 종료
function DoObAfter() {
	var obj = document.getElementById("WebPBX");           
	if (obj != null) {
		obj.DoObAfter();
	}
}

//휴식 처리
function DoRest() {
	var obj = document.getElementById("WebPBX");           
	if (obj != null) {
		obj.DoRest();
	}
}

//교육 처리
function DoEdu() {
	var obj = document.getElementById("WebPBX");           
	if (obj != null) {
		obj.DoEdu();
	}
}

//식사 처리
function DoMeal() {
	var obj = document.getElementById("WebPBX");           
	if (obj != null) {
		obj.DoMeal();
	}
}

//회의 처리
function DoMeet() {
	var obj = document.getElementById("WebPBX");           
	if (obj != null) {
		obj.DoMeet();
	}
}

//기타 처리
function DoEtc() {
	var obj = document.getElementById("WebPBX");           
	if (obj != null) {
		obj.DoEtc();
	}
}

//수신거부해제 - 만능 : 무조건해제
function DoAct() {
	var obj = document.getElementById("WebPBX");           
	if (obj != null) obj.DoAct();
}

//현재 상태 가져오기
function DoStatus() {
	var obj = document.getElementById("WebPBX");           
	if (obj != null) {
		var o = document.getElementById("lblStatus");
		if (o != null) o.innerHTML = obj.Status;
	}
}

//로그지우기
function DoClear() {
	var obj = document.getElementById("log");           
	if (obj != null) obj.innerHTML = "";
}

//로그저장하기
function DoLog(value) {
	var obj = document.getElementById("WebPBX");           
	if (obj != null) obj.IsDebug = value;
}
</script>
<body>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr valign="top">
	<td width="310">
		<table border="1" bordercolorlight="#ffffff" bordercolordark="#000000" cellpadding="0" cellspacing="0" width="530">
		<form action="" name="frm" id="frm" onsubmit="return false;">
		<tr>
			<td width="130" height="25" align="right"><b>그룹번호</b></td>
			<td width="400"><input type="text" name="group" value="2000"></td>
		</tr>
		<tr>
			<td height="25" align="right"><b>앱서버IP</b></td>
			<td><input type="text" name="appip" value="218.48.215.182"></td>
		</tr>
		<tr>
			<td height="25" align="right"><b>포트</b></td>
			<td><input type="text" name="port" value="8043"></td>
		</tr>
		<tr>
			<td height="25" align="right"><b>로그기록</b></td>
			<td><input type="checkbox" name="IsLog" value="1" onclick="DoLog(this.checked)">로그기록하기</td>
		</tr>
		<tr>
			<td height="25" align="right"><b>콜아이디</b></td>
			<td><input type="text" name="username" value=""></td>
		</tr>
		<tr>
			<td height="25" align="right"><b>비밀번호</b></td>
			<td><input type="text" name="passwd" value=""></td>
		</tr>
		<tr>
			<td height="25" align="right"><b>서버IP</b></td>
			<td><input type="text" name="serverip" value="172.25.6.91"></td>
		</tr>
		<tr>
			<td height="25" align="right"><b>전화걸기</b></td>
			<td><input type="text" name="tel" value="">
		</td>
		<tr>
			<td height="25" align="right"><b>돌려주기</b></td>
			<td><input type="text" name="trans" value="">
		</td>
		<tr>
			<td height="25" align="right"><b>현재상태</b></td>
			<td><div id="lblStatus"></div></td>
		</tr>
		<tr>
			<td height="25" align="right"><b>녹취파일 결과</b></td>
			<td><div id="lblFileName"></div></td>
		</tr>
		<tr>
			<td height="25" align="right"><b>콜종료시 값</b></td>
			<td><div id="lblCallEnd"></div></td>
		</tr>
		</form>
		<tr>
			<td height="25" align="right"><b>서버관련 버튼</b></td>
			<td>
				<button id="btnConnect" onclick="connect();">서버접속</button>
				<button id="btnDisconnect" disabled onclick="disconnect();">서버접속종료</button>
				<button id="btnStatus" onclick="DoStatus();">현재상태</button>
				<button id="btnClear" onclick="DoClear();">로그지우기</button>
				<button id="btnGetLog" onclick="GetLog();">로그기록읽기</button>
				<button id="btnSaveLog" onclick="SaveLog();">로그저장하기</button>
			</td>
		</tr>
		<tr>
			<td height="30" align="right"><b>통화관련 버튼</b></td>
			<td>
				<button id="btnDoDial" disabled onclick="DoDial();">전화걸기</button>
				<button id="btnDoAnswer" disabled onclick="DoAnswer();">통화</button>
				<button id="btnDoAnswer" onclick="DoPickup();">당겨받기</button>
				<button id="btnDoTransfer" disabled onclick="DoTransfer();">전화돌려주기</button>
				<button id="btnDoHold" disabled onclick="DoHold();">홀드</button>
				<button id="btnDoHangup" disabled onclick="DoHangup();">통화종료</button>
			</td>
		</tr>
		<tr>
			<td height="30" align="right"><b>후처리 버튼</b></td>
			<td>
				<button id="btnDoDone" disabled onclick="DoDone();">인바운드후처리완료</button>
				<button id="btnDoObAfter" disabled onclick="DoObAfter();">아웃바운드후처리완료</button>
			</td>
		</tr>
		<tr>
			<td height="30" align="right"><b>전화수신거부 관련</b></td>
			<td>
				<button id="btnDoRest" disabled onclick="DoRest();">상담원휴식</button>
				<button id="btnDoEdu" disabled onclick="DoEdu();">상담원교육</button>
				<button id="btnDoMeal" disabled onclick="DoMeal();">상담원식사</button>
				<button id="btnDoMeet" disabled onclick="DoMeet();">상담원회의</button>
				<button id="btnDoEtc" disabled onclick="DoEtc();">기타</button>
				//
				<button id="btnDoAct" onclick="DoAct();">수신거부풀기</button>
			</td>
		</tr>
		<tr>
			<td height="100" colspan="2" align="right">
				<b>이벤트</b>
				<div id="Msg"></div>
			</td>
		</tr>
		</table>
	</td>
	<td>
		<div align="center"><b>로그기록</b></div>
		<div id="log" style="font:normal 8pt Gulim;"></div>
	</td>
</tr>
</table>
<object 
	ID="WebPBX"
	classid="CLSID:299A7F9F-9B16-4DAB-8C7F-679CF82185D3"
	width=600
	height=250>

</object>
<!--
	서버에 연결시 결과 이벤트
	result : 결과값(int)
	msg : 결과내용(string)
	WebPBX 모듈 속성 활용
		WebPBX.IsConnected 속성 : (true:연결성공, false:연결실패)
-->
<script for="WebPBX" event="OnSessionResult(result, msg)" language="javascript">
	var obj = document.getElementById("log");
	if (obj != null) obj.innerHTML = "OnSessionResult 이벤트 발생<br>" + msg + "<br>" + obj.innerHTML;
	var obj = document.getElementById("WebPBX");           
	if (obj != null) {
		var o = document.getElementById("btnConnect");
		if (o != null) o.disabled = obj.IsConnected;
		var o = document.getElementById("btnDisconnect");
		if (o != null) o.disabled = !obj.IsConnected;
		//서버 접속시에 전화걸기 버튼 활성화
		var o = document.getElementById("btnDoDial");
		if (o != null) o.disabled = !obj.IsConnected;
	}
	//if (result == 12292) isconnected = true;
	//else isconnected = false;
</script>

<!--
	전화 인입시 발생되는 이벤트
	call_idx : 콜인덱스
	caller_session_id : 발신 세션 아이디
	callee_session_id : 수신 세션 아이디
	caller : 발신번호
	callee : 수신번호
-->
<script for="WebPBX" event="OnCallIncoming(call_idx, caller_session_id, callee_session_id, caller, callee, caller_channel, callee_channel, start_time, status)" language="javascript">
	var obj = document.getElementById("log");
	if (obj != null) {
		var o = document.getElementById("btnDoAnswer");
		if (o != null) o.disabled = false;
		var o = document.getElementById("btnDoHangup");
		if (o != null) o.disabled = false;
		obj.innerHTML = "OnCallIncoming 이벤트 발생<br>" + caller + "에게 전화가 왔습니다." + "<br>" + obj.innerHTML;
	}
	//document.write(result);
</script>

<!--
	전화 링이 울리울릴때 발생되는 이벤트
	call_idx : 콜인덱스
	caller_session_id : 발신 세션 아이디
	callee_session_id : 수신 세션 아이디
	caller : 발신번호
	callee : 수신번호
-->
<script for="WebPBX" event="OnCallRinging(call_idx, caller_session_id, callee_session_id, caller, callee, caller_channel, callee_channel, service)" language="javascript">
	var obj = document.getElementById("log");
	if (obj != null) {
		var o = document.getElementById("btnDoAnswer");
		if (o != null) o.disabled = false;
		var o = document.getElementById("btnDoHangup");
		if (o != null) o.disabled = false;
		obj.innerHTML = "OnCallRinging 이벤트 발생<br>" + caller + "에게 전화가 왔습니다." + "<br>" + obj.innerHTML;
	}
	//document.write(result);
</script>

<!-- 
	전화 걸때 발생되는 이벤트
	call_idx : 콜인덱스
	caller_session_id : 발신 세션 아이디
	callee_session_id : 수신 세션 아이디
	caller : 발신번호
	callee : 수신번호	
 -->
<script for="WebPBX" event="OnCallDialing(call_idx, caller_session_id, callee_session_id, caller, callee, caller_channel, start_time, status)" language="javascript">
	var obj = document.getElementById("log");
	if (obj != null) {
		var o = document.getElementById("btnDoHangup");
		if (o != null) o.disabled = false;
		obj.innerHTML = "OnCallDialing 이벤트 발생<br>" + callee + "에게 전화를 걸고 있습니다." + "<br>" + obj.innerHTML;
		var obj = document.getElementById("btnDoHangup");
		if (obj != null) obj.disabled = false;
	}
	//document.write(result);
</script>

<!--
	전화 통화중일때 발생되는 이벤트
	call_idx : 콜인덱스
	caller_session_id : 발신 세션 아이디
	callee_session_id : 수신 세션 아이디
	caller : 발신번호
	callee : 수신번호
-->
<script for="WebPBX" event="OnCallAnswer(call_idx, caller_session_id, callee_session_id, caller, callee, caller_channel, callee_channel, answer_time)" language="javascript">
	var obj = document.getElementById("log");
	if (obj != null) {
		var o = document.getElementById("btnDoHangup");
		if (o != null) o.disabled = false;
		//통화중일경우 전화돌려주기 버튼 활성화
		var o = document.getElementById("btnDoTransfer");
		if (o != null) o.disabled = false;
		//통화중일경우 전화홀딩 버튼 활성화
		var o = document.getElementById("btnDoHold");
		if (o != null) o.disabled = false;
		obj.innerHTML = "OnCallAnswer 이벤트 발생<br>" + "통화중입니다." + "<br>" + obj.innerHTML;
	}
</script>

<!--
-->
<script for="WebPBX" event="OnCallRecorded(call_idx, caller_session_id, callee_session_id, caller, callee, caller_channel, callee_channel, end_time, call_duration, file_path, record_duration)" language="javascript">
	var obj = document.getElementById("log");
	if (obj != null) {
		obj.innerHTML = "OnCallRecorded 이벤트 발생<br>" + obj.innerHTML;		
	}
	var obj = document.getElementById("lblFileName");
	if (obj != null) {		
		obj.innerHTML = "" + "녹취파일 : " + file_path;
	}
</script>

<!--
	전화 종료시 발생되는 이벤트
	call_idx : 콜인덱스
	caller_session_id : 발신 세션 아이디
	callee_session_id : 수신 세션 아이디
	caller : 발신번호
	callee : 수신번호
-->
<script for="WebPBX" event="OnCallDisconnect(call_idx, caller_session_id, callee_session_id, caller, callee, caller_channel, callee_channel, end_time, call_duration, callee_only_disconnected, status)" language="javascript">
	callidx = 0;
	var obj = document.getElementById("log");
	if (obj != null) {
		//통화 종료경우 통화 버튼 비활성화
		var o = document.getElementById("btnDoAnswer");
		if (o != null) o.disabled = true;
		//통화 종료경우 전화끊기 버튼 비활성화
		var o = document.getElementById("btnDoHangup");
		if (o != null) o.disabled = true;
		//통화 종료경우 전화돌려주기 버튼 비활성화
		var o = document.getElementById("btnDoTransfer");
		if (o != null) o.disabled = true;		
		//통화종료일경우 전화홀딩 버튼 비활성화
		var o = document.getElementById("btnDoHold");
		if (o != null) o.disabled = true;
		
		obj.innerHTML = "OnCallDiconnect 이벤트 발생<br>" + "통화가 종료되었습니다." + "<br>" + obj.innerHTML;
		
		var o  = document.getElementById("lblCallEnd");
		if (o != null) o.innerHTML = "caller : " + caller + " / callee : " + callee;
	}
</script>

<!--
	콜상담원 상태 변경시의 변경 이벤트
	status : 현재상태(INBOUND, OUTBOUND, REST, EDU, MEAL, MEET, ETC)
	INBOUND : 인바운드
	OUTBOUND : 아웃바운드
	REST : 휴식
	EDU : 교육
	MEAL : 식사
	MEET : 회의
	ETC : 기타
	value : 상태값(true:활성화, false:비활성화)
-->
<script for="WebPBX" event="OnCallStatus(status, value)" language="javascript">
	//휴식처리 버튼 아이디 배열
	var arr = ["btnDoRest", "btnDoEdu", "btnDoMeal", "btnDoMeet", "btnDoEtc"];
	//lblStatus
	var obj = document.getElementById("lblStatus");
	if (obj != null) obj.innerHTML = status + ":" + value;
	var obj = document.getElementById("log");
	if (obj != null) {
		if (status == "INBOUND") {			
			var o = document.getElementById("btnDoDone");
			if (o != null) o.disabled = !value;
			obj.innerHTML = "OnCallStatus이벤트 발생<br>" + "인바운드 : " + value + "<br>" + obj.innerHTML;
			var o = document.getElementById("btnDoObAfter");
			if (o != null) {
				//인바운드 후처리일시 아웃바운드 후처리 비활성화
				//o.disabled = false;
			}
		}
		else if (status == "OUTBOUND") {
			var o = document.getElementById("btnDoObAfter");
			if (o != null) o.disabled = !value;
			obj.innerHTML = "OnCallStatus이벤트 발생<br>" + "아웃바운드 : " + value + "<br>" + obj.innerHTML;
			var o = document.getElementById("btnDoDone");
			if (o != null) {
				//아웃바운드 후처리일시 인바운드 후처리 비활성화
				//if (!value) o.disabled = false;
				//else o.disabled = true;
			}
		}
		else if (status == "REST") {
			//나머지 휴식처리 비활성화
			for (var i=0; i<arr.length; i++) {
				var o = document.getElementById(arr[i]);
				if (o != null) o.disabled = value;
			}
			//휴식 처리 활성화
			var o = document.getElementById("btnDoRest");
			if (o != null) o.disabled = false;
			if (value) obj.innerHTML ="OnCallStatus이벤트 발생<br>" +  "휴식중" + "<br>" + obj.innerHTML;
			else obj.innerHTML = "OnCallStatus이벤트 발생<br>" + "휴식해제" + "<br>" + obj.innerHTML;
		}
		else if (status == "EDU") {
			//나머지 휴식처리 비활성화
			for (var i=0; i<arr.length; i++) {
				var o = document.getElementById(arr[i]);
				if (o != null) o.disabled = value;
			}
			//교육 처리 활성화
			var o = document.getElementById("btnDoEdu");
			if (o != null) o.disabled = false;
			if (value) obj.innerHTML = "OnCallStatus이벤트 발생<br>" + "교육중" + "<br>" + obj.innerHTML;
			else obj.innerHTML = "OnCallStatus이벤트 발생<br>" + "교육해제" + "<br>" + obj.innerHTML;
		}
		else if (status == "MEAL") {
			//나머지 휴식처리 비활성화
			for (var i=0; i<arr.length; i++) {
				var o = document.getElementById(arr[i]);
				if (o != null) o.disabled = value;
			}
			//식사 처리 활성화
			var o = document.getElementById("btnDoMeal");
			if (o != null) o.disabled = false;
			if (value) obj.innerHTML = "OnCallStatus이벤트 발생<br>" + "식사중" + "<br>" + obj.innerHTML;
			else obj.innerHTML = "OnCallStatus이벤트 발생<br>" + "식사해제" + "<br>" + obj.innerHTML;
		}
		else if (status == "MEET") {
			//나머지 휴식처리 비활성화
			for (var i=0; i<arr.length; i++) {
				var o = document.getElementById(arr[i]);
				if (o != null) o.disabled = value;
			}
			//회의 처리 활성화
			var o = document.getElementById("btnDoMeet");
			if (o != null) o.disabled = false;
			if (value) obj.innerHTML ="OnCallStatus이벤트 발생<br>" +  "회의중" + "<br>" + obj.innerHTML;
			else obj.innerHTML = "OnCallStatus이벤트 발생<br>" + "회의해제" + "<br>" + obj.innerHTML;
		}
		else if (status == "ETC") {
			//나머지 휴식처리 비활성화
			for (var i=0; i<arr.length; i++) {
				var o = document.getElementById(arr[i]);
				if (o != null) o.disabled = value;
			}
			//기타 처리 활성화
			var o = document.getElementById("btnDoEtc");
			if (o != null) o.disabled = false;
			if (value) obj.innerHTML = "OnCallStatus이벤트 발생<br>" + "기타" + "<br>" + obj.innerHTML;
			else obj.innerHTML = "OnCallStatus이벤트 발생<br>" + "기타해제" + "<br>" + obj.innerHTML;
		}
	}
</script>


</body>
</html>
