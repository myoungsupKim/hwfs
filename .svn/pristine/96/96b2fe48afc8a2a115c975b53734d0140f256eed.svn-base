<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="..\..\..\default_typedef.xml"/>
  <Form id="FSM90050E" classname="SAMPLE01" inheritanceid="" position="absolute 0 0 1252 725" titletext="주기식단등록(병원주기식)" onload="form_onload">
    <Layouts>
      <Layout>
        <Grid id="grd_menuList" taborder="4" binddataset="ds_menuList" autoenter="select" useinputpanel="false" selecttype="cell" autofittype="none" position="absolute 0 108 1237 686" anchor="all" style="border:1 solid #53606cff,1 solid #c3c3c3ff,1 solid #c3c3c3ff,1 solid #c3c3c3ff;" onrbuttondown="grd_menuList_onrbuttondown" onkeydown="grd_menuList_onkeydown" oncelldblclick="grd_menuList_oncelldblclick" onheadclick="grd_menuList_onheadclick">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="95" band="left"/>
                <Column size="50" band="left"/>
                <Column size="60" band="left"/>
                <Column size="130"/>
                <Column size="45"/>
                <Column size="130"/>
                <Column size="45"/>
                <Column size="130"/>
                <Column size="45"/>
                <Column size="130"/>
                <Column size="45"/>
                <Column size="130"/>
                <Column size="45"/>
                <Column size="130"/>
                <Column size="45"/>
                <Column size="130"/>
                <Column size="45"/>
                <Column size="130"/>
                <Column size="45"/>
              </Columns>
              <Rows>
                <Row size="24" band="head"/>
                <Row size="17"/>
              </Rows>
              <Band id="head">
                <Cell text="코너" taborder="undefined"/>
                <Cell col="1" text="끼니" taborder="undefined"/>
                <Cell col="2" text="구성" taborder="undefined"/>
                <Cell col="3" colspan="2" text="1 일차" taborder="undefined"/>
                <Cell col="5" colspan="2" text="2 일차" taborder="undefined"/>
                <Cell col="7" colspan="2" text="3 일차" taborder="undefined"/>
                <Cell col="9" colspan="2" text="4 일차" taborder="undefined"/>
                <Cell col="11" colspan="2" text="5 일차" taborder="undefined"/>
                <Cell col="13" colspan="2" text="6 일차" taborder="undefined"/>
                <Cell col="15" colspan="2" text="7 일차" taborder="undefined"/>
                <Cell col="17" colspan="2" text="8 일차" taborder="undefined"/>
              </Band>
              <Band id="body">
                <Cell style="line: ;background:whitesmoke;background2:whitesmoke;" text="bind:CORNER_NAME" suppress="1" suppressalign="middle"/>
                <Cell col="1" style="background:#fffdecff;background2:#fffdecff;" text="bind:MEAL_NAME" suppress="2" suppressalign="middle"/>
                <Cell col="2" style="background2: ;" text="bind:MAJOR_DISH_INFO_NAME"/>
                <Cell col="3"/>
                <Cell col="4"/>
                <Cell col="5"/>
                <Cell col="6"/>
                <Cell col="7"/>
                <Cell col="8"/>
                <Cell col="9"/>
                <Cell col="10"/>
                <Cell col="11"/>
                <Cell col="12"/>
                <Cell col="13"/>
                <Cell col="14"/>
                <Cell col="15"/>
                <Cell col="16"/>
                <Cell col="17"/>
                <Cell col="18"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Static id="Static06" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1237 0 1252 710" anchor="top right"/>
        <Static id="Static71" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 710 1252 725" anchor="left bottom"/>
        <Div id="div_cmnBtn" anchor="left top right" taborder="7" url="cmn::CmnBtn.xfdl" text="Div00" scrollbars="none" position="absolute 0 0 1237 30"/>
        <Static id="Static08" class="sta_WFSA_Labelbg" position="absolute 0 30 1237 71" anchor="left top right"/>
        <Static id="Static04" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 30 1237 40" anchor="left top"/>
        <Static id="Static05" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 61 1237 71" anchor="left top"/>
        <Static id="Static07" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 40 15 61" anchor="left top"/>
        <Static id="Static03" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 60 40 70 61" anchor="left top"/>
        <Static id="Static10" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 316 40 346 61" anchor="left top"/>
        <Static id="Static14" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 391 40 401 61" anchor="left top"/>
        <Static id="Static15" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 773 40 803 61" anchor="left top"/>
        <Static id="Static23" text="주기식단등록월" class="sta_WFSA_label" position="absolute 803 41 911 62" anchor="left top"/>
        <Static id="Static24" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 900 40 910 61" anchor="left top"/>
        <Static id="Static01" text="사업장" class="sta_WFSA_label" position="absolute 15 41 75 62" anchor="left top"/>
        <UpjangSearchComponent id="edt_upjang" titletext="업장 검색용 Component" taborder="0" text="UpjangSearchComponent00" position="absolute 70 40 316 61" bindDataset="ds_cond" bindUpjangCodeColumn="UPJANG" bindUpjangNameColumn="UPJANGNM" eventBeforeTrigger="" eventAfterTrigger="fn_hallSearch" roleSetId="ScoAuthLevel01" class="edt_WF_Essential"/>
        <Static id="Static00" text="식당명" class="sta_WFSA_label" position="absolute 346 41 406 62" anchor="left top"/>
        <Combo id="cbo_hall" taborder="1" position="absolute 401 40 573 61" index="-1" innerdataset="@ds_cboHall" codecolumn="HALL_CD" datacolumn="HALL_NAME" onitemchanged="cbo_hall_onitemchanged"/>
        <Static id="Static13" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 573 40 603 61" anchor="left top"/>
        <Static id="Static16" text="코너" class="sta_WFSA_label" position="absolute 603 41 663 62" anchor="left top"/>
        <Static id="Static17" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 634 40 644 61" anchor="left top"/>
        <Combo id="cbo_corner" taborder="2" position="absolute 644 40 773 61" innerdataset="@ds_cboCorner" codecolumn="CORNER" datacolumn="CORNER_NAME"/>
        <Static id="Static25" text="식재료율 목표/실적" class="sta_WFDA_Label01" position="absolute 0 76 145 103" anchor="left top" style="background:#e1e6f6ff;font:Gulim,9;"/>
        <Static id="Static26" text="식단주기" class="sta_WFDA_Label01" position="absolute 300 76 373 103" anchor="left top"/>
        <Static id="Static02" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 0 71 1237 76"/>
        <Edit id="edt_menuCycle" taborder="29" position="absolute 372 76 448 103" style="background:white;padding:0 0 0 0;align:center middle;" anchor="left top" enable="false"/>
        <Static id="Static38" class="sta_WFDA_Labelbg" position="absolute 144 76 301 103" anchor="default"/>
        <MaskEdit id="edt_goalCostRate" taborder="24" mask="#,###.#" position="absolute 147 79 213 100" anchor="left top" style="color:blue;font:Gulim,9,bold;" ontextchanged="edt_goalCostRate_ontextchanged" tooltiptext="식단목표 식재료율" enable="false" readonly="true"/>
        <Static id="Static39" text="%" position="absolute 210 80 237 100" style="align:center middle;"/>
        <Static id="Static09" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 991 40 1021 61" anchor="left top"/>
        <ObjCalMonth id="cal_menuMonth" titletext="월력" taborder="3" scrollbars="none" position="absolute 910 40 991 61"/>
        <Static id="Static18" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 0 103 1237 108"/>
        <Button id="btn_recipeChange" taborder="40" text="레시피일괄변경" class="btn_WF_Function" position="absolute 848 83 945 103" anchor="top right" onclick="btn_recipeChange_onclick"/>
        <Button id="btn_cornerCopy" taborder="41" text="코너일괄복사" class="btn_WF_Function" position="absolute 947 83 1036 103" anchor="top right" onclick="btn_cornerCopy_onclick"/>
        <Button id="btn_menuCopy" taborder="42" text="식단복사" class="btn_WF_Function" position="absolute 1038 83 1103 103" anchor="top right" onclick="btn_menuCopy_onclick"/>
        <Button id="btn_menuEval" taborder="43" text="식단평가" class="btn_WF_Function" position="absolute 1105 83 1170 103" anchor="top right" onclick="btn_menuEval_onclick"/>
        <Button id="btn_nutAnalysis" taborder="44" text="영양분석" class="btn_WF_Function" position="absolute 1172 83 1237 103" anchor="top right" onclick="btn_nutAnalysis_onclick"/>
        <Button id="btn_excel" taborder="45" text="Excel" class="btn_WF_Function" position="absolute 781 83 846 103" anchor="top right" onclick="btn_excel_onclick"/>
        <PopupDiv id="div_recipeCopy" visible="false" position="absolute 904 152 1218 375" style="background:lavender;border:2 solid #515d6fff ;" taborder="5">
          <Layouts>
            <Layout>
              <Static id="Static25" text="[ 클립보드 ] 레시피 복사" class="sta_WFDA_Label01" position="absolute 2 2 308 37" anchor="left top" style="background:#fffdecff;font:Gulim,9,bold;"/>
              <Static id="Static26" text="메뉴날짜" class="sta_WFDA_Label01" position="absolute 2 36 102 63" anchor="left top"/>
              <Static id="Static00" text="식당명" class="sta_WFDA_Label01" position="absolute 2 62 102 89" anchor="left top"/>
              <Static id="Static02" text="코너명" class="sta_WFDA_Label01" position="absolute 2 88 102 115" anchor="left top"/>
              <Static id="Static01" text="끼니명" class="sta_WFDA_Label01" position="absolute 2 114 102 141" anchor="left top"/>
              <Static id="Static03" text="레시피코드" class="sta_WFDA_Label01" position="absolute 2 140 102 167" anchor="left top"/>
              <Static id="Static04" text="레시피명" class="sta_WFDA_Label01" position="absolute 2 166 102 193" anchor="left top"/>
              <Static id="Static68" text="Control+C 키를 누르면 보입니다." class="sta_WF_DiscInfo" position="absolute 4 198 242 213" anchor="default"/>
              <Edit id="edt_recipeCd" taborder="5" enable="false" position="absolute 101 140 308 167" anchor="default" style="background:white;padding:0 0 0 0;align:center middle; :disabled {padding:0 0 0 10;align:left;}"/>
              <Edit id="edt_recipeName" taborder="6" enable="false" position="absolute 101 166 308 193" anchor="default" style="background:white;padding:0 0 0 0;align:center middle; :disabled {padding:0 0 0 10;align:left;}"/>
              <MaskEdit id="edt_menuDate" taborder="7" readonly="false" type="string" mask="####-##-##" position="absolute 101 36 308 63" anchor="top right" style="background:white;align:left middle;" class="msk_WF_Cal" enable="false"/>
              <Edit id="edt_cornerName" taborder="2" enable="false" position="absolute 101 88 308 115" anchor="default" style="background:white;padding:0 0 0 0;align:center middle; :disabled {padding:0 0 0 10;align:left;}"/>
              <Edit id="edt_hallName" taborder="3" enable="false" position="absolute 101 62 308 89" anchor="default" style="background:white;padding:0 0 0 0;align:center middle; :disabled {padding:0 0 0 10;align:left;}"/>
              <Edit id="edt_mealName" taborder="4" enable="false" position="absolute 101 114 308 141" anchor="default" style="background:white;padding:0 0 0 0;align:center middle; :disabled {padding:0 0 0 10;align:left;}"/>
            </Layout>
          </Layouts>
        </PopupDiv>
        <PopupDiv id="div_menuCopy" style="background:lavender;border:2 solid #515d6fff ;" visible="false" position="absolute 904 392 1218 565" taborder="6">
          <Layouts>
            <Layout>
              <Static id="Static25" text="[ 클립보드 ] 식단 복사" class="sta_WFDA_Label01" position="absolute 2 2 308 37" anchor="left top" style="background:#fffdecff;font:Gulim,9,bold;"/>
              <Static id="Static26" text="메뉴날짜" class="sta_WFDA_Label01" position="absolute 2 36 102 63" anchor="left top"/>
              <Static id="Static00" text="식당명" class="sta_WFDA_Label01" position="absolute 2 62 102 89" anchor="left top"/>
              <Static id="Static02" text="코너명" class="sta_WFDA_Label01" position="absolute 2 88 102 115" anchor="left top"/>
              <Static id="Static01" text="끼니명" class="sta_WFDA_Label01" position="absolute 2 114 102 141" anchor="left top"/>
              <Static id="Static68" text="마우스 오른쪽 버튼을 클릭하시면 보입니다." class="sta_WF_DiscInfo" position="absolute 4 146 298 161" anchor="default"/>
              <MaskEdit id="edt_menuDate" taborder="10" type="string" mask="####-##-##" class="msk_WF_Cal" enable="false" position="absolute 101 36 308 63" anchor="top right" style="background:white;align:left middle;"/>
              <Edit id="edt_cornerName" taborder="11" enable="false" position="absolute 101 88 308 115" style="background:white;padding:0 0 0 0;align:center middle; :disabled {padding:0 0 0 10;align:left;}" anchor="default"/>
              <Edit id="edt_hallName" taborder="12" enable="false" position="absolute 101 62 308 89" style="background:white;padding:0 0 0 0;align:center middle; :disabled {padding:0 0 0 10;align:left;}" anchor="default"/>
              <Edit id="edt_mealName" taborder="13" enable="false" position="absolute 101 114 308 141" style="background:white;padding:0 0 0 0;align:center middle; :disabled {padding:0 0 0 10;align:left;}" anchor="default"/>
            </Layout>
          </Layouts>
        </PopupDiv>
        <Static id="Static68" text="레시피 복사 : 복사(Control + C), 붙여넣기(Control + V)" class="sta_WF_DiscInfo" position="absolute 0 696 493 711" anchor="left bottom"/>
        <Static id="Static19" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 0 686 1237 696"/>
        <Static id="Static20" text="식단 복사 및 붙여넣기 : 마우스 오른쪽 버튼" class="sta_WF_DiscInfo" position="absolute 392 696 885 711" anchor="left bottom"/>
        <Button id="btn_costAnalysis" taborder="46" text="원가분석" class="btn_WF_Function" position="absolute 232 79 297 99" anchor="left top" onclick="btn_costAnalysis_onclick"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_cboHall" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="HALL_CD" type="STRING" size="256"/>
          <Column id="HALL_NAME" type="STRING" size="256"/>
          <Column id="MENU_CYCLE" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cond" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="UPJANG" type="STRING" size="256"/>
          <Column id="UPJANGNM" type="STRING" size="256"/>
          <Column id="HALL_CD" type="STRING" size="256"/>
          <Column id="HALL_NM" type="STRING" size="256"/>
          <Column id="MENU_DATE" type="STRING" size="256"/>
          <Column id="START_DATE" type="STRING" size="256"/>
          <Column id="END_DATE" type="STRING" size="256"/>
          <Column id="EMP_NO" type="STRING" size="256"/>
          <Column id="CORNER" type="STRING" size="256"/>
          <Column id="MEAL" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_headList" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_bodyList" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="MENU_CD" type="STRING" size="256"/>
          <Column id="MENU_DATE" type="STRING" size="256"/>
          <Column id="UPJANG" type="STRING" size="256"/>
          <Column id="HALL_CD" type="STRING" size="256"/>
          <Column id="MEAL" type="STRING" size="256"/>
          <Column id="MEAL_NAME" type="STRING" size="256"/>
          <Column id="CORNER" type="STRING" size="256"/>
          <Column id="CORNER_NAME" type="STRING" size="256"/>
          <Column id="MAJOR_DISH_INFO" type="STRING" size="256"/>
          <Column id="MAJOR_DISH_INFO_NAME" type="STRING" size="256"/>
          <Column id="RECIPE_CD" type="STRING" size="256"/>
          <Column id="RECIPE_NAME" type="STRING" size="256"/>
          <Column id="RECIPE_COST_PRICE" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_menuList" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CORNER_NAME" type="STRING" size="256"/>
          <Column id="MEAL_NAME" type="STRING" size="256"/>
          <Column id="MAJOR_DISH_INFO_NAME" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_menuCycle" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_cboCorner" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CORNER" type="STRING" size="256"/>
          <Column id="CORNER_NAME" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_goalCostRate" oncolumnchanged="ds_GOAL_COST_RATE_OnColumnChanged">
        <ColumnInfo>
          <Column id="MENU_DATE" size="10" type="STRING"/>
          <Column id="UPJANG" size="22" type="BIGDECIMAL"/>
          <Column id="HALL_CD" size="20" type="STRING"/>
          <Column id="GOAL_COST_RATE" size="22" type="BIGDECIMAL"/>
          <Column id="FLAG" size="1" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_menuCostList" keystring="G:MENU_DATE+CORNER_NAME">
        <ColumnInfo>
          <Column id="MENU_DATE" size="8" type="STRING"/>
          <Column id="UPJANG" size="22" type="BIGDECIMAL"/>
          <Column id="CORNER" size="20" type="STRING"/>
          <Column id="CORNER_NAME" size="20" type="STRING"/>
          <Column id="MEAL" size="20" type="STRING"/>
          <Column id="MEAL_NAME" size="20" type="STRING"/>
          <Column id="EXPECT_MEAL_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="MENU_COST_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="TOT_MENU_COST_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="SALE_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="TOT_SALE_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="TOT_COST_RATE" size="22" type="BIGDECIMAL"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_condValid" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="UPJANG" type="STRING" size="256"/>
          <Column id="UPJANGNM" type="STRING" size="256"/>
          <Column id="HALL_CD" type="STRING" size="256"/>
          <Column id="HALL_NM" type="STRING" size="256"/>
          <Column id="MENU_DATE" type="STRING" size="256"/>
          <Column id="START_DATE" type="STRING" size="256"/>
          <Column id="END_DATE" type="STRING" size="256"/>
          <Column id="EMP_NO" type="STRING" size="256"/>
          <Column id="CORNER" type="STRING" size="256"/>
          <Column id="MEAL" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="UPJANG">title:업장,required:true</Col>
            <Col id="HALL_CD">title:식당,required:true</Col>
            <Col id="START_DATE">title:주기식단등록월,required:true</Col>
            <Col id="END_DATE">title:주기식단등록월,required:true</Col>
          </Row>
        </Rows>
      </Dataset>
    </Objects>
    <Bind>
      <BindItem id="item1" compid="cbo_corner" propid="value" datasetid="ds_cond" columnid="CORNER"/>
      <BindItem id="item6" compid="div_recipeCopy.edt_menuDate" propid="value" datasetid="ds_guidReqMst" columnid="APPOINT_DD"/>
      <BindItem id="item0" compid="cbo_hall" propid="value" datasetid="ds_cond" columnid="HALL_CD"/>
    </Bind>
    <Script type="xscript4.0"><![CDATA[include "U_lib::lib_conversionCom.xjs";

/******************************************************************************************
 * 시스템구분 : 메뉴관리/식단관리
 * 프로그램명 : FSM90050E.XML
 * 기ㅡㅡㅡ능 : 주기식단등록(병원식)
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************/

//=========================================================================================
// [ PART 1 ]
// Form에서 Include 할 내용을 정의
//
//=========================================================================================

//=========================================================================================
// [ PART 2 ]
// Form에서 사용될 전역변수를 선언
//
//=========================================================================================

//=========================================================================================
// [ PART 3 ]
// Form Loading 시 작업 정의
//
//=========================================================================================
function form_onload(obj:Form, e:LoadEventInfo)
{
	gfn_formOnLoad(this);

	// X-Framework : Action 정보 생성
	fsp_init(this);
	
	// 초기화
	fn_init();
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_init()
 * 기ㅡㅡㅡ능 : 초기화
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_init()
{
	// 조회조건 초기화
	ds_cond.clearData();
	ds_cond.addRow();

	// 메인사업장 셋팅
	ds_cond.setColumn(0, "UPJANG",   g_Upjang);
	ds_cond.setColumn(0, "UPJANGNM", g_UpjangNm);

	// 공통코드 조회
	var v_fil_cond;
	var v_ds = fn_common_code("'FS0025'","","","non","Y");

	// FS0025 : 식단주기
	v_fil_cond = "GROUP_CODE == 'FS0025'";
	v_ds.filter(v_fil_cond);
	CopyF(ds_menuCycle, v_ds.name);
	
	// 주기식단등록월 초기화
	cal_menuMonth.fn_initMonthCal(this, gfn_getYearMonth(gfn_today()), '', ds_cond, 'MENU_DATE');
	
	// 식당정보 조회
	fn_hallSearch();
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_initData()
 * 기ㅡㅡㅡ능 : 화면 초기화
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_initData() {

	// 그리드 데이터 초기화
	ds_menuList.clearData();
	ds_bodyList.clearData();
	ds_headList.clearData();
	
	// Text 초기화
	edt_goalCostRate.value = "";
	edt_menuCycle.value = "";
	
	// 클립보드 초기화
	div_recipeCopy.edt_menuDate.value      = "";
	div_recipeCopy.edt_hallName.value      = "";
	div_recipeCopy.edt_hallName.userdata   = "";
	div_recipeCopy.edt_cornerName.value    = "";
	div_recipeCopy.edt_cornerName.userdata = "";
	div_recipeCopy.edt_mealName.value      = "";
	div_recipeCopy.edt_mealName.userdata   = "";
	div_recipeCopy.edt_recipeCd.value      = "";
	div_recipeCopy.edt_recipeName.value    = "";
	    	
	div_menuCopy.edt_menuDate.value      = "";
	div_menuCopy.edt_hallName.value      = "";
	div_menuCopy.edt_hallName.userdata   = "";
	div_menuCopy.edt_cornerName.value    = "";
	div_menuCopy.edt_cornerName.userdata = "";
	div_menuCopy.edt_mealName.value      = "";
	div_menuCopy.edt_mealName.userdata   = "";
}

//=========================================================================================
// [ PART 4 ]
// Main Process Event 정의(조회,입력,삭제,저장,출력)
//
//=========================================================================================
/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_search()
 * 기ㅡㅡㅡ능 : 조회
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_search()
{
// 	ds_cond.setColumn(0, "UPJANG", "100856");
// 	ds_cond.setColumn(0, "HALL_CD", "00701");
// 	ds_cond.setColumn(0, "START_DATE", "20130101");
// 	ds_cond.setColumn(0, "END_DATE", "20130107");

	// 유효성 검사
	if (gfn_validCheck(ds_cond, ds_condValid, true) == false) return;

	// 주기식단일 값 세팅
	fn_setPeriod(ds_cboHall.getColumn(ds_cboHall.findRow("HALL_CD", cbo_hall.value), "MENU_CYCLE"));
	
	fsp_clear(this);
	fsp_addSearch(this, "fs/fsm:FSM90030E_S001");  // 헤더 정보
	fsp_addSearch(this, "fs/fsm:FSM00221E_S001");  // 기간식단 정보
	fsp_addSearch(this, "fs/fsm:FSM00223E_S002");  // 식재료율 정보

	fsp_callService(this, "", "", "ds_in=ds_cond", "ds_headList=DS_head ds_bodyList=ds_FSH_CYCLE ds_goalCostRate=ds_GOAL_COST_RATE" , "", "fn_callbackSearch");	
}

function fn_callbackSearch(errCode, errMsg) 
{
	if(errCode!=0)
	{
		g_Message("EE", "서비스 오류:시스템 관리자에게 문의하십시오!");
		return;
	}

	// 목표 식재료율 세팅
	edt_goalCostRate.value = ds_goalCostRate.getColumn(0, "GOAL_COST_RATE");
	ds_goalCostRate.applyChange(); 	// FLAG Clear
	
	// 그리드 데이터 세팅
	fn_setMenuGridData(grd_menuList, ds_menuList, ds_headList, ds_bodyList);
}

//=========================================================================================
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
//
//=========================================================================================
/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_setHeader(tabPage, menuObj, headObj)
 * 기ㅡㅡㅡ능 : 헤더 데이터 세팅
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_setHeader(grdObj, dsHeadObj) 
{
	// 그리드 초기화
	for (var i=grdObj.getFormatColCount() - 1; i > 2; i--)
	{
		grdObj.deleteContentsCol('body', i, false);
	}
	
	var nCol;
	for(var i=0; i < dsHeadObj.getRowCount(); i++)
	{
		nCol = grdObj.appendContentsCol();
		grdObj.setFormatColProperty(nCol, "size", 130);
		
		nCol = grdObj.appendContentsCol();
		grdObj.setFormatColProperty(nCol, "size", 45);
		grdObj.mergeContentsCell("head", 0, nCol - 1, 0, nCol, i + 4, false);
		grdObj.setCellProperty("head", i + 3, "text", (i + 1) + " 일차");
	}
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_setMealQtyGridData(grdObj, dsGrdObj, dsHeadObj, dsBodyObj, grdType)
 * 기ㅡㅡㅡ능 : 식수예측 그리드 데이터 세팅
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_setMenuGridData(grdObj, dsGrdObj, dsHeadObj, dsBodyObj)
{
	dsGrdObj.enableevent = false;
	
	// 헤더 세팅
	fn_setHeader(grdObj, dsHeadObj);

	dsGrdObj.clear();
	dsGrdObj.addColumn("KEY"                 , "STRING");
	dsGrdObj.addColumn("MEAL"                , "STRING");
	dsGrdObj.addColumn("MEAL_NAME"           , "STRING");
	dsGrdObj.addColumn("CORNER"              , "STRING");
	dsGrdObj.addColumn("CORNER_NAME"         , "STRING");
	dsGrdObj.addColumn("MAJOR_DISH_INFO"     , "STRING");
	dsGrdObj.addColumn("MAJOR_DISH_INFO_NAME", "STRING");
	for(var i=0; i<dsHeadObj.getRowCount(); i++)
	{
		dsGrdObj.addColumn("MENU_DATE"         + dsHeadObj.getColumn(i, "FDAY"), "STRING");
		dsGrdObj.addColumn("RECIPE_CD"         + dsHeadObj.getColumn(i, "FDAY"), "STRING");
		dsGrdObj.addColumn("RECIPE_NAME"       + dsHeadObj.getColumn(i, "FDAY"), "STRING");
		dsGrdObj.addColumn("RECIPE_COST_PRICE" + dsHeadObj.getColumn(i, "FDAY"), "STRING");
		dsGrdObj.addColumn("EXPECT_MEAL_QTY"   + dsHeadObj.getColumn(i, "FDAY"), "STRING");
		dsGrdObj.addColumn("IS_ZERO"           + dsHeadObj.getColumn(i, "FDAY"), "STRING");
	}

	// 컬럼 데이터 세팅
	var sKey = "";
	var nRow = 0;
	var nSdWon = 0;  // 소계처리용 변수	
	var nSumStartRow = 0;
	for(var i=0; i<dsBodyObj.getRowCount(); i++)
	{
		// 코너코드 + 끼니코드 + 구성요소
		sKey = dsBodyObj.getColumn(i, "CORNER") + dsBodyObj.getColumn(i, "MEAL") + dsBodyObj.getColumn(i, "MAJOR_DISH_INFO");
		nRow = dsGrdObj.findRow("KEY", sKey);
		// 키가 존재하지 않을 경우 행 추가 후 세팅
		if(nRow == -1)
		{
			nRow = dsGrdObj.addRow();
			
			dsGrdObj.setColumn(nRow, "KEY"                  , sKey);			
			dsGrdObj.setColumn(nRow, "MEAL"                 , dsBodyObj.getColumn(i, "MEAL"));			       // 끼니코드
			dsGrdObj.setColumn(nRow, "MEAL_NAME"            , dsBodyObj.getColumn(i, "MEAL_NAME"));		       // 끼니명
			dsGrdObj.setColumn(nRow, "CORNER"               , dsBodyObj.getColumn(i, "CORNER"));               // 코너코드
			dsGrdObj.setColumn(nRow, "CORNER_NAME"          , dsBodyObj.getColumn(i, "CORNER_NAME"));          // 코너명
			dsGrdObj.setColumn(nRow, "MAJOR_DISH_INFO"      , dsBodyObj.getColumn(i, "MAJOR_DISH_INFO"));      // 구성요소코드
			dsGrdObj.setColumn(nRow, "MAJOR_DISH_INFO_NAME" , dsBodyObj.getColumn(i, "MAJOR_DISH_INFO_NAME")); // 구성요소명
		}
		dsGrdObj.setColumn(nRow, "MENU_DATE"         + dsBodyObj.getColumn(i, "MENU_DATE"), dsBodyObj.getColumn(i, "MENU_DATE"));         // 제공일
		dsGrdObj.setColumn(nRow, "RECIPE_CD"         + dsBodyObj.getColumn(i, "MENU_DATE"), dsBodyObj.getColumn(i, "RECIPE_CD"));         // 레시피코드
		dsGrdObj.setColumn(nRow, "RECIPE_NAME"       + dsBodyObj.getColumn(i, "MENU_DATE"), dsBodyObj.getColumn(i, "RECIPE_NAME"));       // 레시피명
		dsGrdObj.setColumn(nRow, "RECIPE_COST_PRICE" + dsBodyObj.getColumn(i, "MENU_DATE"), dsBodyObj.getColumn(i, "RECIPE_COST_PRICE")); // 원가
		dsGrdObj.setColumn(nRow, "EXPECT_MEAL_QTY"   + dsBodyObj.getColumn(i, "MENU_DATE"), dsBodyObj.getColumn(i, "EXPECT_MEAL_QTY"));   // 예상식수
		
		// 소계처리
		if(i > 0 && dsBodyObj.getColumn(i, "CORNER") + dsBodyObj.getColumn(i, "MEAL") != dsBodyObj.getColumn(i + 1, "CORNER") + dsBodyObj.getColumn(i + 1, "MEAL"))
		{
			nRow = dsGrdObj.addRow();
			dsGrdObj.setColumn(nRow, "CORNER_NAME"         , dsBodyObj.getColumn(i, "CORNER_NAME"));          // 코너명
			dsGrdObj.setColumn(nRow, "MEAL_NAME"           , dsBodyObj.getColumn(i, "MEAL_NAME"));
			dsGrdObj.setColumn(nRow, "MAJOR_DISH_INFO_NAME", "식단원가");
			
			for(var j=0; j<dsHeadObj.getRowCount(); j++)
			{
				nSdWon = dsGrdObj.getSum("RECIPE_COST_PRICE" + dsHeadObj.getColumn(j, "FDAY"), nSumStartRow, nRow);
				dsGrdObj.setColumn(nRow, "RECIPE_COST_PRICE" + dsHeadObj.getColumn(j, "FDAY"), Put_comma(nSdWon, 0));   // 소계
				
				nSdWon = dsGrdObj.getMax("EXPECT_MEAL_QTY" + dsHeadObj.getColumn(j, "FDAY"), nSumStartRow, nRow);
				dsGrdObj.setColumn(nRow, "RECIPE_NAME"     + dsHeadObj.getColumn(j, "FDAY"), "예상식수 : " + nSdWon);   // 예상식수
				
				if(gfn_isNull(nSdWon) || nSdWon <= 0)
				{
					dsGrdObj.setColumn(nRow, "IS_ZERO" + dsHeadObj.getColumn(j, "FDAY"), "Y");   // 예상식수 등록여부
				}
			}
			nSumStartRow = nRow + 1;			
		}
	}

	var sProp1 = "0 none #c3c3c3ff, 1 solid #c3c3c3ff, 0 none #c3c3c3ff,  0 none #c3c3c3ff";   // body line
	var sProp2 = "0 none #c3c3c3ff, 0 none #c3c3c3ff,  0 none #c3c3c3ff,  0 none #c3c3c3ff";   // body line (오른쪽라인 없는 Style)
	var sProp3 = "0 none #c3c3c3ff, 1 solid #c3c3c3ff, 1 solid #c3c3c3ff, 0 none #c3c3c3ff";   // 소계 line
	var sProp4 = "0 none #c3c3c3ff, 0 none #c3c3c3ff,  1 solid #c3c3c3ff, 0 none #c3c3c3ff";   // 소계 line (오른쪽라인 없는 Style)
	
	// 그리드에 데이터 바인딩 처리 및 속성정의
	var hIdx = 0;
	for (var i=3; i < grdObj.getFormatColCount(); i++)
	{
		// 레시피 바인딩
		grdObj.setCellProperty("body", i, "text", "bind:RECIPE_NAME" + dsHeadObj.getColumn(hIdx, "FDAY"));
		grdObj.setCellProperty("body", i, "align", "left");
		grdObj.setCellProperty("body", i, "padding", "0 0 0 5");
		grdObj.setCellProperty("body", i, "background", "EXPR(MAJOR_DISH_INFO_NAME!='식단원가'?'#ffffff':IS_ZERO" + dsHeadObj.getColumn(hIdx, "FDAY") + "=='Y'?'lightpink':'#fffdecff')");
		grdObj.setCellProperty("body", i, "background2", "EXPR(MAJOR_DISH_INFO_NAME!='식단원가'?'#ffffff':IS_ZERO" + dsHeadObj.getColumn(hIdx, "FDAY") + "=='Y'?'lightpink':'#fffdecff')");
		grdObj.setCellProperty("body", i, "line", "EXPR(MAJOR_DISH_INFO_NAME=='식단원가'?'" + sProp4 + "':'" + sProp2 + "')");
		
		// 원가 바인딩
		grdObj.setCellProperty("body", i + 1, "text", "bind:RECIPE_COST_PRICE" + dsHeadObj.getColumn(hIdx, "FDAY"));
		grdObj.setCellProperty("body", i + 1, "align", "right");
		grdObj.setCellProperty("body", i + 1, "padding", "0 5 0 0");
		grdObj.setCellProperty("body", i + 1, "background", "EXPR(MAJOR_DISH_INFO_NAME=='식단원가'?'#fffdecff':'whitesmoke')");
		grdObj.setCellProperty("body", i + 1, "background2", "EXPR(MAJOR_DISH_INFO_NAME=='식단원가'?'#fffdecff':'whitesmoke')");
		grdObj.setCellProperty("body", i + 1, "line", "EXPR(MAJOR_DISH_INFO_NAME=='식단원가'?'" + sProp3 + "':'" + sProp1 + "')");

		i ++;
		hIdx ++;
	}

	grdObj.setCellProperty("body", 2, "background", "EXPR(MAJOR_DISH_INFO_NAME=='식단원가'?'#fffdecff':'#e1e6f6ff')");
	grdObj.setCellProperty("body", 2, "background2", "EXPR(MAJOR_DISH_INFO_NAME=='식단원가'?'#fffdecff':'#e1e6f6ff')");
	grdObj.setCellProperty("body", 2, "line", "EXPR(MAJOR_DISH_INFO_NAME=='식단원가'?'1 solid #c3c3c3ff':'" + sProp1 + "')");
	
	// 표준식단 그리드의 끼니 컬럼 bold 처리
	grdObj.setCellProperty("body", 0, "font", "굴림,9,bold");
	grdObj.setCellProperty("body", 1, "font", "굴림,9,bold");
	
	dsGrdObj.rowposition = -1;
	dsGrdObj.enableevent = true;
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_hallSearch()
 * 기ㅡㅡㅡ능 : 식당정보 조회
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_hallSearch()
{
	// 업장이 선택되어 있을 경우에만 조회한다.
	if(gfn_isNull(ds_cond.getColumn(0, "UPJANG"))) return;

	// 기존 데이터 초기화
	fn_initData();

	fsp_clear(this); 
	fsp_addSearch(this, "fs/fsc:FSA_HALL_MST_S001");
	fsp_callService(this, "", "", "", "ds_cboHall=gds_Csqlout", "UPJANG=" + wrapQuote(ds_cond.getColumn(0, "UPJANG")), "fn_callbackHallSearch");
}

function fn_callbackHallSearch(errCode, errMsg) 
{
	if(errCode!=0)
	{
		g_Message("EE", "서비스 오류:시스템 관리자에게 문의하십시오!");
		return;
	}
	
	// 식단주기가 설정되어 있는 식당만 조회 
	ds_cboHall.filter("gfn_length(MENU_CYCLE) > 0");
	cbo_hall.index = 0;

	// 식단주기 값 세팅
	edt_menuCycle.value = ds_menuCycle.getColumn(ds_menuCycle.findRow("CODE", ds_cboHall.getColumn(0, "MENU_CYCLE")), "CODE_NAME");
	
	// 주기식단 기간 세팅
	fn_setPeriod(ds_cboHall.getColumn(0, "MENU_CYCLE"));
		
	// 코너 조회
	fn_cornerSearch();
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_cornerSearch()
 * 기ㅡㅡㅡ능 : 코너정보 조회
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_cornerSearch()
{
	var otherArg = "";
	otherArg = "UPJANG=" + wrapQuote(ds_cond.getColumn(0, "UPJANG"));
	otherArg = otherArg + " HALL_CD=" + wrapQuote(gfn_trim(cbo_hall.value));
	otherArg = otherArg + " BLANK='Y'";
	
	fsp_clear(this); 
    fsp_addSearch(this, "fs/fsc:FSC_UPJANG_HALL_CORNER_S001");
    fsp_callService(this, "", "", "", "ds_cboCorner=ds_upjang_hall_corner", otherArg, "fn_callbackCornerSearch");
}

function fn_callbackCornerSearch(errCode, errMsg) 
{
	if(errCode!=0)
	{
		g_Message("EE", "서비스 오류:시스템 관리자에게 문의하십시오!");
		return;
	}
	
	// 초기값 셋팅
	cbo_corner.index = 0;
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_goalCostRateSearch()
 * 기ㅡㅡㅡ능 : 식단목표 식재료율 조회
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_goalCostRateSearch()
{
	fsp_clear(this);
	fsp_addSearch(this, "fs/fsm:FSM00223E_S002");
	fsp_callService(this, "", "", "ds_in=ds_cond", "ds_goalCostRate=ds_GOAL_COST_RATE" , "", "fn_callbackGoalCostRateSearch");	
}

function fn_callbackGoalCostRateSearch(errCode, errMsg) 
{
	if(errCode!=0)
	{
		g_Message("EE", "서비스 오류:시스템 관리자에게 문의하십시오!");
		return;
	}
	
	edt_goalCostRate.value = ds_goalCostRate.getColumn(0,"GOAL_COST_RATE");
	ds_goalCostRate.applyChange(); // FLAG 값 초기화
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_setPeriod(menuDate, menuCycle)
 * 기ㅡㅡㅡ능 : 주기식단에 맞추어 식수예측 화면 데이터 가져오기
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_setPeriod(sMenuCycle)
{
	var sMenuDate;		// 제공일
	var sMenuSdate;		// 주기시작일
	var sMenuEdate;		// 주기종료일
	var nCycleValue;	// 주기날짜

	switch (sMenuCycle)
	{
		case "001": //--> 07 일		
			 nCycleValue = 7;
			 break;
		case "002": //--> 10 일
			 nCycleValue = 10;
			 break;
		case "003": //--> 14 일
			 nCycleValue = 14;
			 break;
		case "004": //--> 15 일
			 nCycleValue = 15;
			 break;
		case "005": //--> 한달
			 nCycleValue = 31;
			 break;
		default:
			 break;
	}

	// 시작일
	sMenuSdate = gfn_getFirstDate(ds_cond.getColumn(0, "MENU_DATE"));
	
	// 종료일
	if(sMenuCycle == "005")
	{
		sMenuEdate = gfn_getLastDate(sMenuSdate);
	}
	else
	{
		sMenuEdate = gfn_addDate(sMenuSdate, nCycleValue - 1);
	}
	
	ds_cond.setColumn(0, "START_DATE", sMenuSdate);
	ds_cond.setColumn(0, "END_DATE", sMenuEdate);
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : function fn_getOrgValue(nRow, sDate, sColId)
 * 기ㅡㅡㅡ능 : 그리드의 원본 데이터셋에서 매칭되는 값을 구한다.
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_getOrgValue(nRow, sDate, sColId)
{	
	if (gfn_isNull(sDate)) {return;}

	var sCorner = ds_menuList.getColumn(nRow, "CORNER");
	var sMeal = ds_menuList.getColumn(nRow, "MEAL");
	var sMajorDishInfo = ds_menuList.getColumn(nRow, "MAJOR_DISH_INFO");

	var nFindRow = ds_bodyList.findRowExpr("MENU_DATE=='" + sDate + "' && CORNER=='" + sCorner + "' && MEAL=='" + sMeal + "' && MAJOR_DISH_INFO=='" + sMajorDishInfo + "'");
	if (nFindRow > -1) {
		return gfn_trim(ds_bodyList.getColumn(nFindRow, sColId));
	} else {
		return "";
	}
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : fn_setOrgValue(nRow, sDate, sColId, sValue)
 * 기ㅡㅡㅡ능 : 그리드의 원본 데이터셋에서 매칭되는 값을 세팅한다.
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function fn_setOrgValue(nRow, sDate, sColId, sValue)
{	
	if (gfn_isNull(sDate)) {return;}

	var sCorner = ds_menuList.getColumn(nRow, "CORNER");
	var sMeal = ds_menuList.getColumn(nRow, "MEAL");
	var sMajorDishInfo = ds_menuList.getColumn(nRow, "MAJOR_DISH_INFO");

	var nFindRow = ds_bodyList.findRowExpr("MENU_DATE=='" + sDate + "' && CORNER=='" + sCorner + "' && MEAL=='" + sMeal + "' && MAJOR_DISH_INFO=='" + sMajorDishInfo + "'");
	if (nFindRow > -1) {
		return ds_bodyList.setColumn(nFindRow, sColId, sValue);
	} else {
		return "";
	}
}

//=========================================================================================
// [ PART 6 ]
// component Event 정의 ( User Define function )
// 
//=========================================================================================
/******************************************************************************************
 * 함ㅡ수ㅡ명 : cbo_hall_onitemchanged(obj:Combo, e:ItemChangeEventInfo)
 * 기ㅡㅡㅡ능 : 식당 변경시 식단주기값 세팅 및 코너조회
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function cbo_hall_onitemchanged(obj:Combo, e:ItemChangeEventInfo)
{
	// 식당변경시 데이터 초기화
	fn_initData();

	// 식단주기 값 세팅
	var sMenuCycle = ds_cboHall.getColumn(ds_cboHall.findRow("HALL_CD", e.postvalue), "MENU_CYCLE");
	edt_menuCycle.value = ds_menuCycle.getColumn(ds_menuCycle.findRow("CODE", sMenuCycle), "CODE_NAME");
	
	// 주기식단일 값 세팅
	fn_setPeriod(sMenuCycle);
	
	// 코너 조회
	fn_cornerSearch();
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : btn_excel_onclick(obj:Button,  e:ClickEventInfo)
 * 기ㅡㅡㅡ능 : 엑셀 내려받기
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function btn_excel_onclick(obj:Button,  e:ClickEventInfo)
{
	if (ds_menuList.getRowCount() == 0) {
		g_Message("EE",	"출력할 주기식단정보가 없습니다.");
		return;
	}

	gfn_exportExcel(grd_menuList, "주기식단","","","","","cellline");		
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : grd_menuList_oncelldblclick(obj:Grid, e:GridClickEventInfo)
 * 기ㅡㅡㅡ능 : 메뉴 더블클릭시 레시피 등록화면 팝업
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function grd_menuList_oncelldblclick(obj:Grid, e:GridClickEventInfo)
{
	var nCell = obj.getCellPos();
	if (nCell < 2) return false;

	var fa_UPJANG      = gfn_trim(ds_cond.getColumn(0, "UPJANG"));
	var fa_HALL_CD     = gfn_trim(ds_cond.getColumn(0, "HALL_CD"));
	var fa_FROM_DT     = gfn_trim(ds_cond.getColumn(0, "START_DATE"));
	var fa_TO_DT       = gfn_trim(ds_cond.getColumn(0, "END_DATE"));
	var fa_CORNER      = gfn_trim(ds_menuList.getColumn(e.row, "CORNER"));
	var fa_MEAL        = gfn_trim(ds_menuList.getColumn(e.row, "MEAL"));
	var fa_MENU_DATE   = obj.getCellProperty("body", nCell, "text").replace("bind:RECIPE_NAME","");
	var fa_SUBINV_CODE = ds_cboHall.getColumn(0, "SUBINV_CODE");

	// 사용하지 못하는 식단일 경우 불가처리
	if(gfn_length(fa_CORNER) == 0)
	{
		gfn_alert("해당 식단은 코너, 끼니가 설정되지 않은 식단입니다.\n\n식단기본정보설정 메뉴에서 식단정보를 등록해 주세요.");
		return false;	
	}
	
	// 식수인원이 0인 식단일 경우 불가처리
	if(toNumber(fn_getOrgValue(e.row, fa_MENU_DATE, "EXPECT_MEAL_QTY")) <= 0)
	{
		g_Message("EE","해당 식단의 예상식수 인원이 0 입니다.\n\n식수예측(병원용) 메뉴에서 예상식수를 입력해 주세요.");
		return false;	
	}
	
    var v_arg = {};
	v_arg["fa_UPJANG"]      = fa_UPJANG;
	v_arg["fa_HALL_CD"]     = fa_HALL_CD;
	v_arg["fa_HALL_CLASS"]  = ds_cboHall.lookup("HALL_CD", ds_cond.getColumn(0, "HALL_CD"), "HALL_CLASS");
	v_arg["fa_FROM_DT"]     = fa_FROM_DT;
	v_arg["fa_TO_DT"]       = fa_TO_DT;
	v_arg["fa_CORNER"]      = fa_CORNER;
	v_arg["fa_MEAL"]        = fa_MEAL;
	v_arg["fa_MENU_DATE"]   = fa_MENU_DATE;
	v_arg["fa_SUBINV_CODE"] = fa_SUBINV_CODE;	
	v_arg["fa_CALL_PGM"]    = "H";	
	
	gfn_dialog("", "U_FSM::FSM90052P.xfdl", v_arg);

	//등록이 완료되면 다시 조회한다.
	fn_search();	
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : grd_menuList_onkeydown(obj:Grid, e:KeyEventInfo)
 * 기ㅡㅡㅡ능 : 레시피 복사하기/붙여넣기/삭제
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
var nDeleteRow = -1
var sDeleteDate = "";
function grd_menuList_onkeydown(obj:Grid, e:KeyEventInfo)
{
	var nRow = ds_menuList.rowposition;
	if(nRow < 0) return;
	
	// 복사하기 : Ctrl + C 키
	if ( e.keycode == 67 && e.ctrlKey && ToUpperCase(GetType(e.fromreferenceobject))== "GRID" )
	{
		var nCell = grd_menuList.getCellPos();
		var sDate;
		if (nCell > 2) {		
			sDate = grd_menuList.getCellProperty("body", nCell, "text").replace("bind:RECIPE_NAME","");
		}
		
		// 레시피 코드 확인
		if(gfn_length(fn_getOrgValue(nRow, sDate, "RECIPE_CD")) == 0)
		{
			return false;
		}
		
	    div_recipeCopy.edt_menuDate.value      = sDate;
	    div_recipeCopy.edt_hallName.value      = cbo_hall.text;
	    div_recipeCopy.edt_hallName.userdata   = cbo_hall.value;
	    div_recipeCopy.edt_cornerName.value    = fn_getOrgValue(nRow, sDate, "CORNER_NAME");
	    div_recipeCopy.edt_cornerName.userdata = fn_getOrgValue(nRow, sDate, "CORNER");
	    div_recipeCopy.edt_mealName.value      = fn_getOrgValue(nRow, sDate, "MEAL_NAME");
	    div_recipeCopy.edt_mealName.userdata   = fn_getOrgValue(nRow, sDate, "MEAL");
	    div_recipeCopy.edt_recipeCd.value      = fn_getOrgValue(nRow, sDate, "RECIPE_CD");
	    div_recipeCopy.edt_recipeName.value    = fn_getOrgValue(nRow, sDate, "RECIPE_NAME");
		
	    var objRect = grd_menuList.getCellRect(nRow, nCell);
	    var nLeft = system.clientToScreenX(grd_menuList, objRect.left);
		var nTop = system.clientToScreenY(grd_menuList, objRect.top);
	    
	    div_recipeCopy.visible = true;
	    div_recipeCopy.trackPopup(nLeft + 130, nTop);
	}
	
	// 붙여넣기 : Ctrl + V 키
	if ( e.keycode == 86 && e.ctrlKey && ToUpperCase(GetType(e.fromreferenceobject))== "GRID" )
	{
		var nCell = grd_menuList.getCellPos();
		var tDate;
		if (nCell > 2) {		
			tDate = grd_menuList.getCellProperty("body", nCell, "text").replace("bind:RECIPE_NAME","");
		}
	
		// 사용하지 못하는 식단일 경우 불가처리
		if(gfn_length(ds_menuList.getColumn(nRow, "CORNER")) == 0)
		{
			gfn_alert("해당 식단은 설정되지 않은 식단입니다.\n\n설정된 식단에만 붙여넣기 할 수 있습니다.");
			return false;	
		}
		
		// 식수인원이 0인 식단일 경우 불가처리
		if(toNumber(fn_getOrgValue(nRow, tDate, "EXPECT_MEAL_QTY")) <= 0)
		{
			g_Message("EE","해당 식단의 예상식수 인원이 0 입니다.\n\n설정된 식단에만 붙여넣기 할 수 있습니다.");
			return false;	
		}

		// 붙여넣기 조건 검색-붙여넣기 데이터가 없을 경우 불가처리
 		if(gfn_length(div_recipeCopy.edt_recipeCd.value) == 0)
		{
			return false;
		}
 	
 		// 붙여넣기 대상이 있을 경우 
 	    if(gfn_length(fn_getOrgValue(nRow, tDate, "RECIPE_CD")) > 0)
 	    {
			gfn_alert("해당 식단에 등록된 레시피가 있습니다.\n\n등록된 레시피를 삭제한 후 붙여넣기 하여 주십시요.");
			return false;
		}

		// 공통정보
 	 	var cUpjang     = edt_upjang.getUpjangCode();
 	 	var cHallCd     = div_recipeCopy.edt_hallName.userdata;

		// 원본정보
 	 	var sDate       = div_recipeCopy.edt_menuDate.value;		
 	 	var sCorner     = div_recipeCopy.edt_cornerName.userdata;
 	 	var sMeal       = div_recipeCopy.edt_mealName.userdata;
 	 	var sRecipeCd   = div_recipeCopy.edt_recipeCd.value;
 	 	var sRecipeName = div_recipeCopy.edt_recipeName.value;
 	 	
 	 	// 대상정보
 	 	var tCorner        = fn_getOrgValue(nRow, tDate, "CORNER");
 	 	var tMeal          = fn_getOrgValue(nRow, tDate, "MEAL");
 	 	var tMajorDishInfo = fn_getOrgValue(nRow, tDate, "MAJOR_DISH_INFO");
 	 	
		// 해당 식단에 등록된 레시피가 있을 때
		var fndIndex = ds_bodyList.findRowExpr("MENU_DATE=='" + tDate
		                                  + "'&&UPJANG=='"    + cUpjang
		                                  + "'&&HALL_CD=='"   + cHallCd
		                                  + "'&&CORNER=='"    + tCorner
		                                  + "'&&MEAL=='"      + tMeal
		                                  + "'&&RECIPE_CD=='" + sRecipeCd + "'");

		if(fndIndex >= 0) 
		{ 
			gfn_alert("해당 식단에 동일하게 등록된 레시피가 있습니다.\n\n등록된 레시피를 삭제한 후 붙여넣기 하여 주십시요.");
			return false;
		}
		
		// 원본 데이터에 레시피 정보 세팅
		fn_setOrgValue(nRow, tDate, "RECIPE_CD", sRecipeCd);
		fn_setOrgValue(nRow, tDate, "RECIPE_NAME", sRecipeName);
		
		// 그리드에 레시피명 붙여넣기
		ds_menuList.setColumn(nRow, "RECIPE_NAME" + tDate, sRecipeName);
		 
		fsp_clear(this);
		var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	
		actionName		= "FSM00221E_T001";
		cmdName			= "U_svc::" + "fs/fsm/FSM00221E_T001.jsp";
		inData			= "";
		outData			= "";
		callBackFnc		= "fn_callbackRecipeCopy";
	
		otherArg		= "UPJANG="+wrapQuote(cUpjang);
		otherArg		= otherArg + " SOURCE_MENU_DATE="+wrapQuote(sDate);  
        otherArg		= otherArg + " SOURCE_HALL_CD="+wrapQuote(cHallCd);
		otherArg		= otherArg + " SOURCE_CORNER="+wrapQuote(sCorner);
		otherArg		= otherArg + " SOURCE_MEAL="+wrapQuote(sMeal);
        otherArg		= otherArg + " SOURCE_RECIPE_CD="+wrapQuote(sRecipeCd);
         
    	otherArg		= otherArg + " TARGET_MENU_DATE="+wrapQuote(tDate);
        otherArg		= otherArg + " TARGET_HALL_CD="+wrapQuote(cHallCd);
		otherArg		= otherArg + " TARGET_CORNER="+wrapQuote(tCorner);
		otherArg		= otherArg + " TARGET_MEAL="+wrapQuote(tMeal);
		otherArg		= otherArg + " TARGET_MAJOR_DISH_INFO="+wrapQuote(tMajorDishInfo);

		jsp_transaction(this, actionName, cmdName, inData, outData, otherArg, callBackFnc, true, false, false);		
	}
	
    // DEL 키코드는 46번이다.
	if(e.keycode == "46")
	{ 
		var nCell = obj.getCellPos();
		var sDate;
		if (nCell > 2) {		
			sDate = obj.getCellProperty("body", nCell, "text").replace("bind:RECIPE_NAME","");
		}

		// 레시피 코드 확인
		if(gfn_length(fn_getOrgValue(nRow, sDate, "RECIPE_CD")) == 0)
		{
			return false;
		}
				
		var sHallCd      = cbo_hall.value;
		var sCorner      = fn_getOrgValue(nRow, sDate, "CORNER");
		var sMeal        = fn_getOrgValue(nRow, sDate, "MEAL");
		var sRecipeCd    = fn_getOrgValue(nRow, sDate, "RECIPE_CD");
		var sRecipeName  = fn_getOrgValue(nRow, sDate, "RECIPE_NAME");
				
		// 삭제 확인
		if(!g_Confirm("01", "선택하신 레시피:["+ sRecipeName +"] 을(를)\n삭제 하시겠습니까?"))
		{
			return false;
		}
		
		fsp_clear(this);
		var actionName, cmdName, inData, outData, otherArg, callBackFnc;
		
		actionName		= "FSM00221E_T002";
		cmdName			= "U_svc::" + "fs/fsm/FSM00221E_T002.jsp";
		inData			= "";
		outData			= "";
		callBackFnc		= "fn_callbackRecipeDelete";

		otherArg		= "UPJANG="+wrapQuote(ds_cond.getColumn(0,"UPJANG"));
		otherArg		= otherArg + " MENU_DATE=" + wrapQuote(sDate);  
		otherArg		= otherArg + " HALL_CD="   + wrapQuote(sHallCd);
		otherArg		= otherArg + " CORNER="    + wrapQuote(sCorner);
		otherArg		= otherArg + " MEAL="      + wrapQuote(sMeal);
		otherArg		= otherArg + " RECIPE_CD=" + wrapQuote(sRecipeCd);

		// 삭제 키값을 저장해 놓는다. (삭제 완료 후 그리드에서 삭제하기 위함)
		this.nDeleteRow = nRow;
		this.sDeleteDate = sDate;

		jsp_transaction(this, actionName, cmdName, inData, outData, otherArg, callBackFnc, true, false, false);
	}
}

function fn_callbackRecipeDelete(errCode, errMsg) 
{
	if(errCode!=0)
	{
		g_Message("EE", "서비스 오류:시스템 관리자에게 문의하십시오!");
		return;
	}

	fn_setOrgValue(nDeleteRow, sDeleteDate, "RECIPE_CD", "");
	fn_setOrgValue(nDeleteRow, sDeleteDate, "RECIPE_NAME", "");
	fn_setOrgValue(nDeleteRow, sDeleteDate, "RECIPE_COST_PRICE", "");
	ds_menuList.setColumn(nDeleteRow, "RECIPE_CD" + sDeleteDate, "");
	ds_menuList.setColumn(nDeleteRow, "RECIPE_NAME" + sDeleteDate, "");
	ds_menuList.setColumn(nDeleteRow, "RECIPE_COST_PRICE" + sDeleteDate, 0);
	nDeleteRow = -1
	sDeleteDate = "";
}

function fn_callbackRecipeCopy(errCode, errMsg) 
{
	if(errCode!=0)
	{
		g_Message("EE", "서비스 오류:시스템 관리자에게 문의하십시오!");
		return;
	}
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : grd_menuList_onrbuttondown(obj:Grid, e:GridMouseEventInfo)
 * 기ㅡㅡㅡ능 : 식단 복사하기/붙여넣기
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function grd_menuList_onrbuttondown(obj:Grid, e:GridMouseEventInfo)
{
	var nRow = ds_menuList.rowposition;
	if(nRow < 0) return;
	
	// 복사하기 : 식단복사 클립보드에 정보가 없을 경우
	if(gfn_length(div_menuCopy.edt_menuDate.value) <= 0)
	{
		if(e.cell == -1) return;
	
		var nCell = grd_menuList.getCellPos();
		var sDate;
		if (nCell > 2) 
		{		
			sDate = grd_menuList.getCellProperty("body", nCell, "text").replace("bind:RECIPE_NAME","");
		} 
		else
		{
			return;
		}

		// 사용하지 못하는 식단일 경우 불가처리
		if(gfn_length(ds_menuList.getColumn(nRow, "CORNER")) == 0)
		{
			return false;	
		}
		
		// 식수인원이 0인 식단일 경우 불가처리
		if(toNumber(fn_getOrgValue(nRow, sDate, "EXPECT_MEAL_QTY")) <= 0)
		{
			return false;	
		}
	
	    var v_rtn = g_Confirm("01","[빠른식단복사] 제공일: " + gfn_subStr(sDate,4,2)+ "월 " + gfn_subStr(sDate,6,2)+ "일" + G_fn_DayToWeek2(sDate) + "\n" + cbo_hall.text + " / 코너:" + fn_getOrgValue(nRow, sDate, "CORNER_NAME") + " / 끼니:"+ fn_getOrgValue(nRow, sDate, "MEAL_NAME") +"\n\n현재 선택하신 식단을 복사하시겠습니까?");
				
		//식단을 복사한다면
		if(v_rtn==true)
		{			 
			div_menuCopy.edt_menuDate.value      = sDate;
			div_menuCopy.edt_hallName.value      = cbo_hall.text;
			div_menuCopy.edt_hallName.userdata   = cbo_hall.value;
			div_menuCopy.edt_cornerName.value    = fn_getOrgValue(nRow, sDate, "CORNER_NAME");
			div_menuCopy.edt_cornerName.userdata = fn_getOrgValue(nRow, sDate, "CORNER");
			div_menuCopy.edt_mealName.value      = fn_getOrgValue(nRow, sDate, "MEAL_NAME");
			div_menuCopy.edt_mealName.userdata   = fn_getOrgValue(nRow, sDate, "MEAL");
			
			var objRect = grd_menuList.getCellRect(nRow, nCell);
			var nLeft = system.clientToScreenX(grd_menuList, objRect.left);
			var nTop = system.clientToScreenY(grd_menuList, objRect.top);
			
			div_menuCopy.visible = true;
			div_menuCopy.trackPopup(nLeft + 130, nTop);
		}
	}
	else
	{
		var nCell = grd_menuList.getCellPos();
		var tDate;
		if (nCell > 2) {		
			tDate = grd_menuList.getCellProperty("body", nCell, "text").replace("bind:RECIPE_NAME","");
		}
	
		// 공통정보
 	 	var cUpjang     = edt_upjang.getUpjangCode();
 	 	var cHallCd     = div_menuCopy.edt_hallName.userdata;

		// 원본정보
 	 	var sDate       = div_menuCopy.edt_menuDate.value;		
 	 	var sCorner     = div_menuCopy.edt_cornerName.userdata;
 	 	var sMeal       = div_menuCopy.edt_mealName.userdata;
 	 	
 	 	// 대상정보
 	 	var tCorner        = fn_getOrgValue(nRow, tDate, "CORNER");
 	 	var tMeal          = fn_getOrgValue(nRow, tDate, "MEAL");
 	 	var tMajorDishInfo = fn_getOrgValue(nRow, tDate, "MAJOR_DISH_INFO");
 	 	
		// 사용하지 못하는 식단일 경우 불가처리
		if(gfn_length(ds_menuList.getColumn(nRow, "CORNER")) == 0)
		{
			g_Message("EE","해당 식단은 설정되지 않은 식단입니다.\n\n설정된 식단에만 붙여넣기 할 수 있습니다.");
			return false;	
		}
		
		// 식수인원이 0인 식단일 경우 불가처리
		if(toNumber(fn_getOrgValue(nRow, tDate, "EXPECT_MEAL_QTY")) <= 0)
		{
			g_Message("EE","해당 식단의 예상식수 인원이 0 입니다.\n\n설정된 식단에만 붙여넣기 할 수 있습니다.");
			return false;	
		}
 	 	
		//복사원본 복사대상 체크
		if(sDate == tDate && sCorner == tCorner && sMeal == tMeal)
		{ 
			g_Message("EE", "복사원본 식단과 복사대상 식단이 같습니다.\n\n다른 식단을 선택하여 주십시요.");
			return false;
		}
		
		var v_rtn = g_Confirm("01","[빠른식단붙여넣기]를 하시겠습니까?\n\n※주의:발주자재, 실식단이 등록된 식단은 복사되지 않으며 식단을 복사하면 기존식단은 삭제됩니다.");
		
		// 붙여넣기 취소시 클립보드 초기화
		if(v_rtn == false) 
		{
			div_menuCopy.edt_menuDate.value      = "";
			div_menuCopy.edt_hallName.value      = "";
			div_menuCopy.edt_hallName.userdata   = "";
			div_menuCopy.edt_cornerName.value    = "";
			div_menuCopy.edt_cornerName.userdata = "";
			div_menuCopy.edt_mealName.value      = "";
			div_menuCopy.edt_mealName.userdata   = "";
			
			g_Message("01","작업을 취소하고 복사 데이터를 Clear 합니다.\n\n복사를 다시하시려면 원하는 식단을 선택한 후\n마우스 오른쪽버튼을 클릭하십시요!!"); 
			return;
		}
		
		fsp_clear(this);
		var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	
		actionName		= "FSM00222E_T003";
		cmdName			= "U_svc::" + "fs/fsm/FSM00222E_T003.jsp";
		inData			= "";
		outData			= "";
		callBackFnc		= "fn_callbackMenuCopy";
	
		var otherArg= "GUBUN=" + wrapQuote("CYCLE");
		otherArg		= otherArg + " SOURCE_UPJANG="+wrapQuote(cUpjang);  
		otherArg		= otherArg + " SOURCE_MENU_DATE="+wrapQuote(sDate);  
        otherArg		= otherArg + " SOURCE_HALL_CD="+wrapQuote(cHallCd);
		otherArg		= otherArg + " SOURCE_CORNER="+wrapQuote(sCorner);
		otherArg		= otherArg + " SOURCE_MEAL="+wrapQuote(sMeal);
        
        otherArg		= otherArg + " TARGET_UPJANG="+wrapQuote(cUpjang);  
    	otherArg		= otherArg + " TARGET_MENU_DATE="+wrapQuote(tDate);
        otherArg		= otherArg + " TARGET_HALL_CD="+wrapQuote(cHallCd);
		otherArg		= otherArg + " TARGET_CORNER="+wrapQuote(tCorner);
		otherArg		= otherArg + " TARGET_MEAL="+wrapQuote(tMeal);

		jsp_transaction(this, actionName, cmdName, inData, outData, otherArg, callBackFnc, true, false, false);		
	}	
}

function fn_callbackMenuCopy(errCode, errMsg) 
{
	if(errCode!=0)
	{
		g_Message("EE", "서비스 오류:시스템 관리자에게 문의하십시오!");
		return;
	}
	
	fn_search();
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : btn_recipeChange_onclick(obj:Button,  e:ClickEventInfo)
 * 기ㅡㅡㅡ능 : 레시피 일괄변경
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function btn_recipeChange_onclick(obj:Button,  e:ClickEventInfo)
{
	// 유효성 검사
	if (gfn_validCheck(ds_cond, ds_condValid, true) == false) return;

	// 현재 선택된 레시피 정보
	var nRow = ds_menuList.rowposition;	
	var nCell = grd_menuList.getCellPos();	
	var sDate = "";
	if (nCell > 2) {		
		sDate = grd_menuList.getCellProperty("body", nCell, "text").replace("bind:RECIPE_NAME","");
	} 
	
    var fa_RECIPE_CD   = fn_getOrgValue(nRow, sDate, "RECIPE_CD");    
	var fa_RECIPE_NAME = fn_getOrgValue(nRow, sDate, "RECIPE_NAME");    
	
	if(gfn_length(fa_RECIPE_CD) == 0)
    {
		fa_RECIPE_CD   = "";
		fa_RECIPE_NAME = "";
    }

    var v_arg = {};
	v_arg["fa_UPJANG"]           = gfn_trim(ds_cond.getColumn(0, "UPJANG"));
	v_arg["fa_UPJANG_NM"]        = gfn_trim(ds_cond.getColumn(0, "UPJANGNM"));
	v_arg["fa_HALL_CD"]          = gfn_trim(ds_cond.getColumn(0, "HALL_CD"));
	v_arg["fa_HALL_NAME"]        = gfn_trim(cbo_hall.text);
	v_arg["fa_FROM_DT"]          = gfn_trim(ds_cond.getColumn(0, "START_DATE"));
	v_arg["fa_TO_DT"]            = gfn_trim(ds_cond.getColumn(0, "END_DATE"));
	v_arg["fa_CYCLE_REAL_GUBUN"] = gfn_trim("CYCLE");
	v_arg["fa_RECIPE_CD"]        = gfn_trim(fa_RECIPE_CD);
	v_arg["fa_RECIPE_NAME"]      = gfn_trim(fa_RECIPE_NAME);

	v_rtn = gfn_dialog("", "U_FSM::FSM00222P.xfdl", v_arg);
 
 	// 변경된 데이터가 있을경우 재조회
	if(v_rtn == "Y")
	{
		fn_search();
	}		
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : btn_cornerCopy_onclick(obj:Button,  e:ClickEventInfo)
 * 기ㅡㅡㅡ능 : 코너 일괄복사
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function btn_cornerCopy_onclick(obj:Button,  e:ClickEventInfo)
{
	// 유효성 검사
	if (gfn_validCheck(ds_cond, ds_condValid, true) == false) return;

    var v_arg = {};
	v_arg["fa_UPJANG"]           = gfn_trim(ds_cond.getColumn(0, "UPJANG"));
	v_arg["fa_UPJANG_NM"]        = gfn_trim(ds_cond.getColumn(0, "UPJANGNM"));
	v_arg["fa_HALL_CD"]          = gfn_trim(ds_cond.getColumn(0, "HALL_CD"));
	v_arg["fa_HALL_NAME"]        = gfn_trim(cbo_hall.text);
	v_arg["fa_FROM_DT"]          = gfn_trim(ds_cond.getColumn(0, "START_DATE"));
	v_arg["fa_TO_DT"]            = gfn_trim(ds_cond.getColumn(0, "END_DATE"));

	var v_rtn = gfn_dialog("", "U_FSM::FSM00221P.xfdl", v_arg);
 
 	// 변경된 데이터가 있을경우 재조회
	if(v_rtn == "Y")
	{
		fn_search();
	}
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : btn_menuCopy_onclick(obj:Button,  e:ClickEventInfo)
 * 기ㅡㅡㅡ능 : 식단 복사
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function btn_menuCopy_onclick(obj:Button,  e:ClickEventInfo)
{
	// 유효성 검사
	if (gfn_validCheck(ds_cond, ds_condValid, true) == false) return;

    var v_arg = {};
	v_arg["fa_UPJANG"]           = gfn_trim(ds_cond.getColumn(0, "UPJANG"));
	v_arg["fa_UPJANG_NM"]        = gfn_trim(ds_cond.getColumn(0, "UPJANGNM"));
	v_arg["fa_HALL_CD"]          = gfn_trim(ds_cond.getColumn(0, "HALL_CD"));
	v_arg["fa_HALL_NAME"]        = gfn_trim(cbo_hall.text);
	v_arg["fa_MENU_TYPE"]        = "CYCLE";

	gfn_dialog("", "U_FSM::FSM00224P.xfdl", v_arg);	
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : btn_menuEval_onclick(obj:Button,  e:ClickEventInfo)
 * 기ㅡㅡㅡ능 : 식단 평가
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function btn_menuEval_onclick(obj:Button,  e:ClickEventInfo)
{
	// 유효성 검사
	if (gfn_validCheck(ds_cond, ds_condValid, true) == false) return;

    var v_arg = {};
	v_arg["fa_UPJANG"]           = gfn_trim(ds_cond.getColumn(0, "UPJANG"));
	v_arg["fa_HALL_CD"]          = gfn_trim(ds_cond.getColumn(0, "HALL_CD"));
	v_arg["fa_FROM_DT"]          = gfn_trim(ds_cond.getColumn(0, "START_DATE"));
	v_arg["fa_TO_DT"]            = gfn_trim(ds_cond.getColumn(0, "END_DATE"));

	gfn_dialog("", "U_FSM::FSM00225V.xfdl", v_arg);	
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : btn_nutAnalysis_onclick(obj:Button,  e:ClickEventInfo)
 * 기ㅡㅡㅡ능 : 영양 분석
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function btn_nutAnalysis_onclick(obj:Button,  e:ClickEventInfo)
{
	// 유효성 검사
	if (gfn_validCheck(ds_cond, ds_condValid, true) == false) return;

    var v_arg = {};
	v_arg["fa_UPJANG"]           = gfn_trim(ds_cond.getColumn(0, "UPJANG"));
	v_arg["fa_HALL_CD"]          = gfn_trim(ds_cond.getColumn(0, "HALL_CD"));
	v_arg["fa_FROM_DT"]          = gfn_trim(ds_cond.getColumn(0, "START_DATE"));
	v_arg["fa_TO_DT"]            = gfn_trim(ds_cond.getColumn(0, "END_DATE"));

	gfn_dialog("", "U_FSM::FSM00226V.xfdl", v_arg);
}

/******************************************************************************************
 * 함ㅡ수ㅡ명 : btn_costAnalysis_onclick(obj:Button,  e:ClickEventInfo)
 * 기ㅡㅡㅡ능 : 원가 분석
 * 작ㅡ성ㅡ자 : 김민수
 * 작성ㅡ일자 : 2015-04-29
 ******************************************************************************************/
function btn_costAnalysis_onclick(obj:Button,  e:ClickEventInfo)
{
	// 유효성 검사
	if (gfn_validCheck(ds_cond, ds_condValid, true) == false) return;

    var v_arg = {};
	v_arg["fa_UPJANG"]           = gfn_trim(ds_cond.getColumn(0, "UPJANG"));
	v_arg["fa_HALL_CD"]          = gfn_trim(ds_cond.getColumn(0, "HALL_CD"));
	v_arg["fa_CORNER"]           = gfn_trim(ds_cond.getColumn(0, "CORNER"));
	v_arg["fa_FROM_DT"]          = gfn_trim(ds_cond.getColumn(0, "START_DATE"));
	v_arg["fa_TO_DT"]            = gfn_trim(ds_cond.getColumn(0, "END_DATE"));

	gfn_dialog("", "U_FSM::FSM90051P.xfdl", v_arg);	
}

function grd_menuList_onheadclick(obj:Grid, e:GridClickEventInfo)
{
	return false;
}
]]></Script>
  </Form>
</FDL>
