<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="../../../default_typedef.xml"/>
  <Form id="form" onkeydown="fn_form_OnKeyDown" onload="form_onload" titletext="업장표준및표준레시피조회" position="absolute 0 0 1237 221" scrollbars="none">
    <Layouts>
      <Layout>
        <Grid scrollbars="alwaysvert" binddataset="ds_upjang_recipe_mst" readonly="false" enable="true" id="grd_UPJANG_RECIPE_MST" useinputpanel="false" oncelldblclick="grd_UPJANG_RECIPE_MST_OnCellDblClick" onheadclick="grd_List_OnHeadClick" taborder="11" tabstop="false" usecontextmenu="true" useselcolor="true" visible="true" wheelscrollrow="1" position="absolute 622 98 1237 221" selecttype="row" autofittype="col" anchor="left top right">
          <Formats>
            <Format id="Default">
              <Columns>
                <Column size="100"/>
                <Column size="194"/>
                <Column size="100"/>
                <Column size="100"/>
                <Column size="100"/>
              </Columns>
              <Rows>
                <Row size="26" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell displaytype="text" text="레시피코드"/>
                <Cell col="1" displaytype="text" text="레  시  피  명"/>
                <Cell col="2" displaytype="text" text="원가"/>
                <Cell col="3" displaytype="text" text="레시피분류"/>
                <Cell col="4" text="조리법유형"/>
              </Band>
              <Band id="body">
                <Cell displaytype="text" edittype="normal" style="align: ;" text="bind:RECIPE_CD"/>
                <Cell col="1" displaytype="text" style="align:left;" text="bind:RECIPE_NAME"/>
                <Cell col="2" displaytype="number" style="align:right;" text="bind:RECIPE_COST" mask="#,##0"/>
                <Cell col="3" displaytype="text" style="align:left;" text="bind:RECIPE_CLASS_NAME"/>
                <Cell col="4" style="align:left;" text="bind:CUISINE_NAME"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Grid scrollbars="alwaysvert" binddataset="ds_std_recipe_mst" readonly="false" enable="true" id="grd_STD_RECIPE_MST" useinputpanel="false" oncelldblclick="grd_STD_RECIPE_MST_OnCellDblClick" onheadclick="grd_List_OnHeadClick" taborder="10" tabstop="false" usecontextmenu="true" useselcolor="true" visible="true" wheelscrollrow="1" position="absolute 0 98 615 221" selecttype="row" autofittype="col">
          <Formats>
            <Format id="Default">
              <Columns>
                <Column size="100"/>
                <Column size="194"/>
                <Column size="100"/>
                <Column size="100"/>
                <Column size="100"/>
              </Columns>
              <Rows>
                <Row size="26" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell displaytype="text" text="레시피코드"/>
                <Cell col="1" displaytype="text" text="레   시   피   명"/>
                <Cell col="2" displaytype="text" text="원가"/>
                <Cell col="3" displaytype="text" text="레시피분류"/>
                <Cell col="4" text="조리법유형"/>
              </Band>
              <Band id="body">
                <Cell displaytype="text" edittype="normal" style="align: ;" text="bind:RECIPE_CD"/>
                <Cell col="1" displaytype="text" style="align:left;" text="bind:RECIPE_NAME"/>
                <Cell col="2" displaytype="number" style="align:right;" text="bind:RECIPE_COST" mask="#,##0"/>
                <Cell col="3" displaytype="text" style="align:left;" text="bind:RECIPE_CLASS_NAME"/>
                <Cell col="4" style="align:left;" text="bind:CUISINE_NAME"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Static id="Static29" class="sta_WFSA_Labelbg" position="absolute 0 0 1237 67" anchor="left top right"/>
        <Static id="Static22" text="표준레시피" class="sta_WF_Title01" position="absolute 0 80 450 98"/>
        <Static id="Static15" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 0 67 450 80"/>
        <Static id="Static16" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 0 93 450 98"/>
        <Static id="Static34" text="W10" visible="false" position="absolute 93 10 103 31" style="background:#ff000055;align:center middle;"/>
        <Static id="Static35" text="W30" visible="false" position="absolute 254 10 284 57" style="background:#ff000055;align:center middle;"/>
        <Static id="Static43" text="W10" visible="false" position="absolute 15 0 278 10" style="background:#ff000055;align:center middle;"/>
        <Static id="Static44" text="W10" visible="false" position="absolute 14 57 277 67" style="background:#ff000055;align:center middle;"/>
        <Static id="Static45" text="W15" visible="false" position="absolute 0 0 15 67" style="background:#ff000055;align:center middle;"/>
        <Static id="Static51" text="W05." visible="false" position="absolute 15 31 248 36" style="background:#ff000055;align:center middle;"/>
        <Static id="Static50" text="W10" visible="false" position="absolute 93 36 103 57" style="background:#ff000055;align:center middle;"/>
        <Static id="Static02" text="업장표준레시피" class="sta_WF_Title01" position="absolute 622 80 1072 98"/>
        <Static id="Static08" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 622 67 1072 80"/>
        <Static id="Static10" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 622 93 1072 98"/>
        <Static id="Static01" text="사  업  장" position="absolute 17 10 97 31" class="sta_WFSA_label"/>
        <Static id="Static5" text="식  당  군" position="absolute 285 10 365 36" class="sta_WFSA_label"/>
        <Static id="Static6" text="레시피분류" position="absolute 554 10 634 31" class="sta_WFSA_label"/>
        <Static id="Static7" text="레시피유형" position="absolute 17 36 97 57" class="sta_WFSA_label"/>
        <Static id="sta_WFSA_label" text="조리법유형" position="absolute 285 36 365 57" class="sta_WFSA_label"/>
        <Static id="Static9" text="레 시 피 명" position="absolute 554 36 634 57" class="sta_WFSA_label"/>
        <Edit autoselect="true" id="ed_UPJANG" imemode="native" onkeydown="ed_Upjang_OnKeyDown" readonly="true" taborder="0" tooltiptext="사업장" position="absolute 103 10 235 31"/>
        <Button id="btn_Upjang" onclick="btn_Upjang_OnClick" taborder="1" tabstop="false" text="" position="absolute 234 10 255 31" class="btn_WF_popSearch" image=""/>
        <Combo codecolumn="HALL_CLASS" datacolumn="HALL_CLASS_NAME" displayrowcount="10" id="cbo_UP_HALL_CLASS" innerdataset="ds_cbo_up_hall_class" onitemchanged="cbo_UP_HALL_CLASS_OnChanged" taborder="2" tooltiptext="식당군" position="absolute 370 10 522 31"/>
        <Combo codecolumn="RECIPE_CLASS" datacolumn="RECIPE_CLASS_NAME" displayrowcount="10" id="cbo_upjang_recipe_class" innerdataset="ds_upjang_recipe_class" taborder="3" tooltiptext="레시피분류(업장)" position="absolute 643 10 795 31"/>
        <Combo codecolumn="CODE" datacolumn="CODE_NAME" displayrowcount="10" id="cbo_recipe_type" innerdataset="ds_recipe_type" onitemchanged="cbo_recipe_type_OnChanged" taborder="4" tooltiptext="레시피유형" position="absolute 103 36 255 57"/>
        <Combo codecolumn="CODE" datacolumn="CODE_NAME" displayrowcount="10" id="cbo_cuisine_type" innerdataset="ds_cuisine_type" taborder="5" tooltiptext="조리법유형" position="absolute 370 36 522 57"/>
        <Edit id="ed_RECIPE" imemode="native" onkeydown="ed_RECIPE_OnKeyDown" taborder="6" tooltiptext="레시피명" position="absolute 643 36 795 57"/>
        <CheckBox id="chk_STD_RECIPE" taborder="12" tabstop="false" text="표준레시피조회" value="false" position="absolute 824 10 944 31"/>
        <CheckBox id="chk_UPJANG_RECIPE" taborder="7" tabstop="false" text="업장표준레시피" position="absolute 824 36 944 57" value="true"/>
        <Button id="btn_Hide_Search" onclick="btn_Hide_Search_OnClick" taborder="8" tabstop="false" text="조회조건숨기기" position="absolute 1116 10 1227 31" class="btn_WF_Custom" image="" anchor="top right"/>
        <Button id="btn_Search_New_Recipe" onclick="btn_Search_Std_Recipe_OnClick" taborder="9" tabstop="false" text="신규레시피조회" position="absolute 1117 36 1228 57" class="btn_WF_Custom" image="" anchor="top right"/>
        <Static id="Static11" text="W10" visible="false" position="absolute 360 10 370 31" style="background:#ff000055;align:center middle;"/>
        <Static id="Static12" text="W30" visible="false" position="absolute 522 10 552 57" style="background:#ff000055;align:center middle;"/>
        <Static id="Static13" text="W10" visible="false" position="absolute 360 36 370 57" style="background:#ff000055;align:center middle;"/>
        <Static id="Static14" text="W10" visible="false" position="absolute 633 36 643 57" style="background:#ff000055;align:center middle;"/>
        <Static id="Static17" text="W10" visible="false" position="absolute 633 10 643 31" style="background:#ff000055;align:center middle;"/>
        <Static id="Static18" text="W30" visible="false" position="absolute 794 10 824 57" style="background:#ff000055;align:center middle;"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_cuisine_type"/>
      <Dataset id="ds_recipe_type"/>
      <Dataset id="ds_upjang_recipe_mst">
        <ColumnInfo>
          <Column id="UPJANG" size="22" type="BIGDECIMAL"/>
          <Column id="HALL_CLASS" size="20" type="STRING"/>
          <Column id="RECIPE_CD" size="20" type="STRING"/>
          <Column id="RECIPE_NAME" size="50" type="STRING"/>
          <Column id="RECIPE_CLASS" size="256" type="STRING"/>
          <Column id="RECIPE_CLASS_NAME" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cbo_up_hall_class"/>
      <Dataset id="ds_upjang_recipe_class">
        <ColumnInfo>
          <Column id="RECIPE_CLASS" size="256" type="STRING"/>
          <Column id="RECIPE_CLASS_NAME" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_std_recipe_mst">
        <ColumnInfo>
          <Column id="UPJANG" size="22" type="BIGDECIMAL"/>
          <Column id="HALL_CLASS" size="20" type="STRING"/>
          <Column id="RECIPE_CD" size="20" type="STRING"/>
          <Column id="RECIPE_NAME" size="50" type="STRING"/>
          <Column id="COPY_ALL" size="22" type="BIGDECIMAL"/>
          <Column id="COPY_ITEM" size="22" type="BIGDECIMAL"/>
          <Column id="CHG_DATA" size="1" type="STRING"/>
          <Column id="SELECTED" size="1" type="STRING"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Script type="xscript4.0"><![CDATA[/*
 ******************************************************************************************
 * 시스템구분: IFIS/레시피관리/업장표준레시피관리
 * 프로그램명: FSR00021V.XML
 * 기ㅡㅡㅡ능: 업장표준레시피관리-업장표준및표준레시피조회
 * 작ㅡ성ㅡ자: 한화S&C 박종세
 * 작성ㅡ일자: 2008-05-13
 * ----------------------------------------------------------------------------------------
 * HISTORY  :
 ******************************************************************************************
 */
//=========================================================================================
// [ PART 1 ]
// Form에서 Include 할 내용을 정의
//
//========================================================================================= 
include "U_lib::lib_conversionCom.xjs";
//@@컨버터에서 주석처리 #include "lib::sc_comon.js"
//@@컨버터에서 주석처리 #include "lib::tit_comm_0001.js"
//@@컨버터에서 주석처리 #include "lib::lib_comm_0001.js"
//@@컨버터에서 주석처리 #include "lib::sc_sql_common.js"
//@@컨버터에서 주석처리 #include "lib::fs_common.js"

//=========================================================================================
// [ PART 2 ]
// Form에서 사용될 전역변수를 선언
//
//=========================================================================================

//=========================================================================================
// [ PART 3 ]
// Form Loading 시 작업 정의
//
//=========================================================================================
function form_onload(obj:Form, e:LoadEventInfo)
{
	gfn_formOnLoad(obj, false);
	
	   //폼 초기화
		fn_InitForm(obj);
}

//폼 초기화
function fn_InitForm(obj)
{
	//----------업장권한설정---------------------------
	fn_SetAuth("","","ed_UPJANG", "btn_Upjang");
/*	
	//////////////////////////////////////////////////////
	/// 사업장 권한일 경우 해당 사업장 고정값 
	/// 2008.05.16
	/////////////////////////////////////////////////////
   	if(ToNumber(g_AuthLevel) < 99)
	{
		ed_UPJANG.Enable = false;
		btn_Upjang.Enable = false;
	}
*/

	// action 정보 생성 초기화 
	fsp_init(this);		
	
	// 폼 데이터 초기화
	fn_InitData(false);
}

// 폼데이터 초기화 
function fn_InitData(blnAllClear)
{
	//----------------------------------------------
	// 공통코드 DataSet create 
	//----------------------------------------------
	var v_ds;
	var v_fil_cond;
	
	v_ds = fn_common_code("'FS0002','FS0003'","","","blk","Y");


	//FS0002 : RECIPE_TYPE
	v_fil_cond = "GROUP_CODE == 'FS0002'";
	v_ds.filter(v_fil_cond);
	CopyF(ds_recipe_type,v_ds.name);	

	//FS0003 : CUISINE_TYPE
	v_fil_cond = "GROUP_CODE == 'FS0003'";
	v_ds.filter(v_fil_cond);
	CopyF(ds_cuisine_type,v_ds.name);	
	
	//업장에 따른 식당군 생성
    fn_Make_UPJANG_HALL_CLASS();
	
}

//초기화 콜백함수
function fn_After_InitData()
{
	ds_upjang_recipe_class.insertRow(0);
	cbo_UP_HALL_CLASS.index=0;
}

//업장 식장군 콤보 박스 생성
function fn_Make_UPJANG_HALL_CLASS()
{
	// action 정보 초기화 
	fsp_clear(this);
 
    var strUPJANG="";
	if(gfn_length(ed_UPJANG.userdata) > 0)
	{
		// 업장별 식당군 가져오기 
		fsp_addSearch(this, "fs/fsc:FSC_UPJANG_HALL_CLASS_S001");
				
		// 업장별 레시피 가져오기 
		fsp_addSearch(this, "fs/fsc:FSC_UPJANG_RECIPE_S001");
		
		strUPJANG="UPJANG="+  wrapQuote(gfn_nvl(ed_UPJANG.userdata));
		//식당군 *BLANK='A' --전체 *USE_YN='Y' 사용하는 식당만  *HALL_CD='' 해당식당의 식당군 
 		// 서버 호출 
		fsp_callService(this, "", "", "", "ds_cbo_up_hall_class=ds_UP_HALL_CLASS ds_upjang_recipe_class=ds_out", "BLANK='N' USE_YN='Y' "+ strUPJANG , "fn_After_InitData");
 
    } 
    else
    {  
        ds_cbo_up_hall_class.clearData();
        cbo_UP_HALL_CLASS.index=-1;
    }
 }

//=========================================================================================
// [ PART 4 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,도움말,form닫기)
//
//=========================================================================================

/*------------------------------------------------------------
	1. Function ID : fn_Search_Upjang_Recipe()
	2. 개       요 : 업무프로세스에 따른 조회작업
	3. 기       능 : 검색버튼 입력 시 처리되는 작업
	4. 인 수 설 명:
*------------------------------------------------------------*/
function fn_Search_Upjang_Recipe()
{
	//필수 입력사항 체크-----------------------------------------------------------------------
	if (!fn_Chk_SearchKey_Upjang_Recipe()) return false;

	//조회 조건만들기-----------------------------------------------------------------------
	// 조회 임시 데이터셋 생성
	//create("Dataset", "ds_where032");
	var dsObj;
	if ( form.isValidObject("ds_where032") ) {
		dsObj = eval("ds_where032");
	} else {
		dsObj = new Dataset();
		dsObj.name = "ds_where032";
		this.addChild(dsObj.name, dsObj);
	}
	dsObj.clear();

	//dsObj = eval("ds_where032");
	dsObj.addColumn("RECIPE_CLASS", "STRING", 100);
	dsObj.addColumn("RECIPE_TYPE", "STRING", 100);
	dsObj.addColumn("CUISINE_TYPE", "STRING", 100);
	dsObj.addColumn("RECIPE_NAME",   "STRING", 100);

	dsObj.addRow();
	dsObj.setColumn(0,"RECIPE_CLASS", gfn_nvl(cbo_upjang_recipe_class.value));
	dsObj.setColumn(0,"RECIPE_TYPE",  gfn_nvl(cbo_recipe_type.value));
	dsObj.setColumn(0,"CUISINE_TYPE", gfn_nvl(cbo_cuisine_type.value));
	dsObj.setColumn(0,"RECIPE_NAME", gfn_nvl(ed_RECIPE.value));


	// action 정보 삭제 초기화 
	fsp_clear(this);

	// 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "fs/fsr:FSR00032V_S001");

	// 서버 호출 
	//http.sync = true;
	fsp_callService(this, "", "", "ds_in=ds_where032", "ds_upjang_recipe_mst=ds_upjang_recipe_list" , "UPJANG="+ wrapQuote(ed_UPJANG.userdata) + " HALL_CLASS="+ wrapQuote(cbo_UP_HALL_CLASS.value), "fn_After_Search_Upjang_Recipe");	
	//조회 실행-----------------------------------------------------------------------------
	//http.sync = false;
}

// 조회 후 콜백 함수 
function fn_After_Search_Upjang_Recipe()
{
    //임시조건 데이터셋 삭제
	Destroy("ds_where032");
   // 데이터셋 플래그 클리어
	ds_upjang_recipe_mst.applyChange();
}

// 조회 조건 검색
function fn_Chk_SearchKey_Upjang_Recipe()
{
   //필수 입력사항 체크-----------------------------------------------------------------------
   //업장
   if (!mfn_Chk_Obj_MustInput(ed_UPJANG)) return false;
   //식당군
   if (!mfn_Chk_Obj_MustInput(cbo_UP_HALL_CLASS)) return false;
   //체크로직- 틀리면 return false;    
   return true;
}


/*------------------------------------------------------------
	1. Function ID : fn_Search_UpjangRecipe()
	2. 개       요 : 업무프로세스에 따른 조회작업
	3. 기       능 : 검색버튼 입력 시 처리되는 작업
	4. 인 수 설 명:
*------------------------------------------------------------*/
function fn_Search_Std_Recipe(strNewOption)
{
	//필수 입력사항 체크-----------------------------------------------------------------------
	if (!fn_Chk_SearchKey_Std_Recipe()) return false;

	//조회 조건만들기-----------------------------------------------------------------------
	// 조회 임시 데이터셋 생성
	var dsObj;
	if ( form.isValidObject("ds_where031") ) {
		dsObj = eval("ds_where031");
	} else {
		dsObj = new Dataset();
		dsObj.name = "ds_where031";
		this.addChild(dsObj.name, dsObj);
	}
	dsObj.clear();

	//create("Dataset", "ds_where031");
	//dsObj = eval("ds_where031");
	dsObj.addColumn("UPJANG"      , "STRING", 100);
	dsObj.addColumn("RECIPE_CLASS", "STRING", 100);
	dsObj.addColumn("RECIPE_TYPE",  "STRING", 100);
	dsObj.addColumn("CUISINE_TYPE", "STRING", 100);
	dsObj.addColumn("RECIPE_NAME",  "STRING", 100);

	dsObj.addRow();
	dsObj.setColumn(0,"UPJANG"      , ed_UPJANG.userdata);
	dsObj.setColumn(0,"RECIPE_CLASS", cbo_upjang_recipe_class.value);
	dsObj.setColumn(0,"RECIPE_TYPE" , cbo_recipe_type.value);
	dsObj.setColumn(0,"CUISINE_TYPE", cbo_cuisine_type.value);
	dsObj.setColumn(0,"RECIPE_NAME" , ed_RECIPE.value);

	// 신규레시피 조회옵션
	if(strNewOption=="NEW_RECIPE")
	{
	dsObj.addColumn("NEW_RECIPE", "STRING", 100);
	dsObj.setColumn(0,"NEW_RECIPE", "Y");
	}

	// action 정보 삭제 초기화 
	fsp_clear(this);

	// 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "fs/fsr:FSR00031V_S001");

	// 서버 호출 
	//http.sync = true;
	fsp_callService(this, "", "", "ds_in=ds_where031", "ds_std_recipe_mst=ds_std_recipe_list" , "", "fn_After_Search_Std_Recipe");	
	//조회 실행-----------------------------------------------------------------------------
	//http.sync = false;
}

// 조회 후 콜백 함수 
function fn_After_Search_Std_Recipe()
{
    //임시조건 데이터셋 삭제
	Destroy("ds_where031");
    // 데이터셋 플래그 클리어
	ds_std_recipe_mst.applyChange();
}

// 조회 조건 검색
function fn_Chk_SearchKey_Std_Recipe()
{
   //필수 입력사항 체크-----------------------------------------------------------------------
   //레시피분류--->>> 필수에서 제외 
   // if (!mfn_Chk_Obj_MustInput(cbo_upjang_recipe_class)) return false;
  
   //체크로직- 틀리면 return false;    
   return true;
}


///////////////////////
//신규레시피 조회 버튼
////////////////////////
function btn_Search_Std_Recipe_OnClick(obj:Button, e:ClickEventInfo)
{
	if (!(chk_UPJANG_RECIPE.value))
	{
		g_Message("EE","업장레시피 검색옵션을 체크하신 후 조회하세요.");
		return false;	
	}
	
	if (chk_UPJANG_RECIPE.value)
	{
		fn_Search_Upjang_Recipe();
	}
	
    //자동으로 체크하게 하다.
	chk_STD_RECIPE.value=true;
			
	if(chk_STD_RECIPE.value)
	{
		fn_Search_Std_Recipe("NEW_RECIPE");
	}
}




/*------------------------------------------------------------
	1. Function ID : fn_search()
	2. 개       요 : 업무프로세스에 따른 조회작업
	3. 기       능 : 검색버튼 입력 시 처리되는 작업
	4. 인 수 설 명:
*------------------------------------------------------------*/
function fn_search()
{
	if (!(chk_UPJANG_RECIPE.value))
	{
		g_Message("EE","업장레시피 검색옵션을 체크하신 후 조회하세요.");
		return false;	
	}
	
	this.parent.divFSR00023E.ds_recipe_item.clearData();
	this.parent.divFSR00023E.ds_recipe_cuisine.clearData();
	this.parent.divFSR00023E.ds_recipe_phf.clearData();
	
	if(chk_STD_RECIPE.value)
	{
		fn_Search_Std_Recipe("");
	}

	if (chk_UPJANG_RECIPE.value)
	{
		fn_Search_Upjang_Recipe();
	}
	
}




/*------------------------------------------------------------
	1. Function ID : fn_Insert()
	2. 개       요 : 업무프로세스에 따른 입력작업
	3. 기       능 : 입력버튼 입력 시 처리되는 작업
	4. 인 수 설 명:
*------------------------------------------------------------*/
function fn_insert()
{
   //데이터셋 로우 추가
   //ds_template_obj.AddRow();				   

   //신규추가시 기본값 설정
   //fn_SetDefaultNewRow();
}

// 신규추가시 기본값 설정
function fn_SetDefaultNewRow()
{   
}



/*------------------------------------------------------------
	1. Function ID : fn_Delete()
	2. 개       요 : 업무프로세스에 따른 정보 삭제작업
	3. 기       능 : 삭제버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*------------------------------------------------------------*/
function fn_delete()
{
    // 삭제 확인메세지 호출
	//if (!fn_Call_DeleteMsg()){ return false; }							
	
    // 데이터셋이 Insert일 경우는 DeleteRow만 실행한다. 
    //if(fn_chk_rowtypeInsert_deleteRow(ds_template_obj)){return false;}

	// TO DO 식당마스터를 삭제하기전에  지울수 있는지 확인한다.				
	//if(!fn_chk_canDeleteRow(ds_template_obj)){return false;}				
	
	// 데이터셋 삭제
	//ds_template_obj.DeleteRow(ds_template_obj.row);
				
	// 트랜잭션 시작 
	//tit_clearActionInfo(this);
				
	//삭제
	//tit_addSaveActionInfo(this, "", "","fs/fsa:FSA00050E_D003", "", "", "", "");
					
	// 서버 호출 
	//tit_callService(this, "", "", "ds_in=ds_template_obj:U", "", "", "fn_After_Delete()");
	// 트랜잭션 종료 
	
	//}
}

//삭제 후 콜백 함수 
function fn_After_Delete()
{

}

//삭제 가능여부 체크
function fn_chk_canDeleteRow(ds_template_obj)
{
	//체크로직- 틀리면 return false;
	return true;
}



/*------------------------------------------------------------
	1. Function ID : fn_Save()
	2. 개       요 : 업무프로세스에 따른 정보 저장작업
	3. 기       능 : 저장버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*------------------------------------------------------------*/
function fn_save()
{
 	// 데이터 유효성 검사
	 if (!fn_DataValidation()){	return false; }
			
	// action 정보 초기화 
	//tit_clearActionInfo(this);
			
	/*tit_addSaveActionInfo(this
			, "fs/fsa:FSA00050E_I001"
			, "fs/fsa:FSA00050E_U001"
			, ""
			, ""
			, ""
			, ""
			, ""
			);
				
	  */
	 // 서버 호출 후 조회 
	 //tit_callService(this, "", "", "ds_in=ds_template_obj:U", "" , "", "fn_After_Save()");
	 // 트랜잭션 종료 
}

//저장 후 콜백 함수 
function fn_After_Save()
{

}

//데이터 유효성검사
function fn_DataValidation()
{
    //체크로직- 틀리면 return false;

    //변경데이터 검사
	//if(!ds_template_obj.GetUpdate())   {alert("변경된 데이터가 없습니다."); return false;}
	
	//입력값 검사 - 컴포넌트 
	//if(!fn_DataValidation_Component()) {return false;}	
	
	//입력값 검사 - 데이터셋
	//if(!fn_DataValidation_DataSet())   {return false;}

    return true;
}

function fn_DataValidation_Component()
{
	//체크로직 - 틀리면 return false;
	return true;
}

function fn_DataValidation_DataSet()
{
	//체크로직 - 틀리면 return false;
	return true;
}
        


/*------------------------------------------------------------
	1. Function ID : fn_Print()
	2. 개       요 : 업무프로세스에 따른 인쇄 처리
	3. 기       능 : 인쇄버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*------------------------------------------------------------*/
function fn_print()
{
}

/*------------------------------------------------------------
	1. Function ID : fn_close()
	2. 개       요 : 업무프로세스에 따른 폼 종료 
	3. 기       능 : 닫기버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*------------------------------------------------------------*/
function fn_close()
{
	return true;
}

/*------------------------------------------------------------
	1. Function ID : fn_Help()
	2. 개       요 : 업무프로세스에 따른 도움말 
	3. 기       능 : 도움말버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*------------------------------------------------------------*/
function fn_help()
{
}

//=========================================================================================
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
//
//=========================================================================================

//=========================================================================================
// [ PART 6 ]
// component Event 정의 ( User Define function )
// --> component Event의 기요,기능,동작 등 상세내용은 MiPlatform 메뉴얼을 참조하시기 바랍니다.
//=========================================================================================
//레시피 타입 변경일 경우 조리법 유형 변경
function cbo_recipe_type_OnChanged(obj:Combo, e:ItemChangeEventInfo)
{
   // 조리법 데이터셋 필터
	ds_cuisine_type.filter("SET1=="+wrapQuote(e.postvalue) + "||gfn_nvl(SET1)==''");
}


//--------------------------------------------------------------------------------------------
//---업장레시피 리스트 함수 모음----------------------------------
//--------------------------------------------------------------------------------------------

//------------------------------------------------------------------------------------------
// 업장 선택 
function ed_Upjang_OnKeyDown(obj:Edit, e:KeyEventInfo)
{
	if(e.keycode == 13) fn_UpjangPopup();
}


function btn_Upjang_OnClick(obj:Button, e:ClickEventInfo)
{
	fn_UpjangPopup();
}


//업장 팝업 호출
function fn_UpjangPopup()
{
    fn_sql_common_setup( fn_MakeUpjangSQL()
                        ,strQuery_UpjangKeyField
                        ,strQuery_UpjangValueField
                        ,strQuery_UpjangKeyFieldNM
                        ,strQuery_UpjangValueFieldNM
                        ,""
                        ,""
                        ,""
                        ,strQuery_UpjangCaption
                        ,strQuery_UpjangAllField
                        );
	
	ed_UPJANG.value = gds_sql_common.getColumn(0, "ret_name");
    ed_UPJANG.userdata = gds_sql_common.getColumn(0, "ret_code");	
	
	fn_Make_UPJANG_HALL_CLASS();
}




//////////////////////////////////////////////////////////////////////////////////////
//// 조회 --> FSR00023E 호출
//////////////////////////////////////////////////////////////////////////////////////


//업장표준레시피 조회
function grd_UPJANG_RECIPE_MST_OnCellDblClick(obj:Grid, e:GridClickEventInfo)
{
	
	//FSR00023E 전달값 셋팅
	this.parent.divFSR00023E.st_RECIPE_CD.text= ds_upjang_recipe_mst.getColumn(e.row, "RECIPE_CD");
	this.parent.divFSR00023E.st_RECIPE_NAME.text=ds_upjang_recipe_mst.getColumn(e.row, "RECIPE_NAME");
	this.parent.divFSR00023E.ed_UPJANG.userdata=ed_UPJANG.userdata;
	this.parent.divFSR00023E.ed_HALL_CLASS.value=cbo_UP_HALL_CLASS.value;
		
	
   //필수 입력값 체크로직- 틀리면 return false;    
   //업장 
   if (!mfn_Chk_Obj_MustInput(ed_UPJANG)) return false;
   //식당군
   if (!mfn_Chk_Obj_MustInput(cbo_UP_HALL_CLASS)) return false;
    
 	
	//업장표준레시피 조회 --> 
	//업장표준레시피 마스터 조회 --> 자재, 조리법, 조리공정 조회
	this.parent.divFSR00023E.fn_Search_Upjang_Recipe();
	
	
	/////////////////////////////////////////////////////////////
	//// 플래그 셋팅 --> 업장레시피 수정이다. MODE=UPJANG_UPDATE
	/////////////////////////////////////////////////////////////
	this.parent.divFSR00023E.ed_MODE.value="UPJANG_UPDATE";
	
	
	// 식당군이 005 --> 카페테리아일 경우에는 예상판매수량, 판매가격이 수정가능하다.
	if(cbo_UP_HALL_CLASS.value=="005")
    {
		this.parent.divFSR00023E.ed_EXPECT_SALE_QTY.enable=true;
		this.parent.divFSR00023E.ed_SALE_PRICE.enable=true;
	}
	else
	{
	    this.parent.divFSR00023E.ed_EXPECT_SALE_QTY.enable=false;
		this.parent.divFSR00023E.ed_SALE_PRICE.enable=false;
	}
}


//표준레시피 조회
function grd_STD_RECIPE_MST_OnCellDblClick(obj:Grid, e:GridClickEventInfo)
{

	//-----------------------------
	//' 조회조건
	//'----------------------------
	
	var strRECIPE_CD   =  ds_std_recipe_mst.getColumn(e.row, "RECIPE_CD");
	var strRECIPE_NAME =  ds_std_recipe_mst.getColumn(e.row, "RECIPE_NAME");
	
	//레시피정보를 FSR00023E에 SETINNNG 한다. --->>> 업장표준 마스터를 조회하므로 업장, 식당군을 Setting한다.
	this.parent.divFSR00023E.st_RECIPE_CD.text= strRECIPE_CD;
	this.parent.divFSR00023E.st_RECIPE_NAME.text=strRECIPE_NAME;
	this.parent.divFSR00023E.ed_UPJANG.userdata=ed_UPJANG.userdata;
	this.parent.divFSR00023E.ed_HALL_CLASS.value=cbo_UP_HALL_CLASS.value;
	
	
	var searchRow = -1;
	//ds_upjang_recipe_class.SearchRow("UPJANG='"100885'&&RECIPE_CLASS='"001");
	searchRow = ds_upjang_recipe_mst.findRowExpr("RECIPE_CD=='"+strRECIPE_CD+"'"); 
		
	//업장레시피 식당군에 해당하는 레시피가 있을때(Update 모드)
	if(searchRow <> -1)
	{	
		 //경고메세지를 보여준다.
		 if (!g_Confirm("01", "이미 업장표준레시피로 구축되어 있습니다.\n선택하신 표준레시피로 업데이트 하시겠습니까?\n================================================\n※저장버튼을 클릭하지 않을 경우 업장표준레시피로 저장되지 않습니다."))
			{ 		//레시피정보를 FSR00023E에 SETINNNG 한다.-데이터 초기화. 
					//기존 데이터를 그대로 나둔다.
				//this.parent.divFSR00023E.st_RECIPE_CD.text= "";
				//this.parent.divFSR00023E.st_RECIPE_NAME.text="";
				return false; 
			}
	
		//1.마스터는 업장표준레시피를 조회한다.
		//1.업장표준레시피 마스터 조회
		//this.parent.divFSR00023E.fn_Search_UPJANG_RECIPE_MST();
		//-------------->>>>
		//-------------->>>>
		// 표준레시피를 더블클릭하면 무조건 표준레시피를 조회한다.
		this.parent.divFSR00023E.fn_Search_STD_Recipe_Mst();


		/////////////////////////////////////////////////////////////
		//// 플래그 셋팅 -->  표준레시피로 업장레시피로 수정이다. MODE=STD_UPDATE
		/////////////////////////////////////////////////////////////
		this.parent.divFSR00023E.ed_MODE.value="STD_UPDATE";
	}
	//업장레시피식당군에 해당하는 레시피가 없을때 (Insert 모드)
	else
	{
		//1.마스터는 표준레시피를 조회한다.
		//1.표준레시피 마스터 조회
		this.parent.divFSR00023E.fn_Search_STD_Recipe_Mst();
		
		/////////////////////////////////////////////////////////////
		//// 플래그 셋팅 --> 표준레시피 업장레시피로 입력이다. MODE=STD_INSERT
		/////////////////////////////////////////////////////////////
		this.parent.divFSR00023E.ed_MODE.value="STD_INSERT";
	}

	
	// 식당군이 005 --> 카페테리아일 경우에는 예상판매수량, 판매가격이 수정가능하다.
	if(cbo_UP_HALL_CLASS.value=="005")
    {
    	this.parent.divFSR00023E.ed_EXPECT_SALE_QTY.enable=true;
		this.parent.divFSR00023E.ed_SALE_PRICE.enable=true;
	}
	else
	{
	    this.parent.divFSR00023E.ed_EXPECT_SALE_QTY.enable=false;
		this.parent.divFSR00023E.ed_SALE_PRICE.enable=false;
	}
	
	//2.자재
	this.parent.divFSR00023E.fn_Search_STD_Recipe_Item();	
	//3.조리법
	this.parent.divFSR00023E.fn_Search_STD_Recipe_Cuisine();	
	//4.PHP
	this.parent.divFSR00023E.fn_Search_STD_Recipe_Phf();	

}



//조회조건 숨기기 이벤트
function btn_Hide_Search_OnClick(obj:Button, e:ClickEventInfo)
{
 	this.parent.divFSR00023E.position.top=this.parent.divFSR00021V.position.top;
	//this.parent.divFSR00023E.position.height=this.parent.divFSR00023E.position.height + this.parent.divFSR00021V.position.height;
    this.parent.divFSR00021V.position.height=0;
}


//식당군이 바뀔경우 기존에 조회되었던 업장레시피 리스트는 삭제 된다.
function cbo_UP_HALL_CLASS_OnChanged(obj:Combo, e:ItemChangeEventInfo)
{
	ds_upjang_recipe_mst.clearData();
	ds_std_recipe_mst.clearData();
}




	/*
 ******************************************************************************************
 * 함  수  명   : grd_List_OnHeadClick(obj,nCell,nX,nY,nPivotIndex)
 * 기      능   : 그리드헤드 더블클릭시 Sort
 * 작  성  자   : 공통함수
 * 작성  일자   : 2008-01-09  
 ******************************************************************************************
 */
function grd_List_OnHeadClick(obj:Grid, e:GridClickEventInfo)
{
	gfn_gridSort(obj, e); //(eval(obj.binddataset), obj, e.cell);
}



//레시피명이 있을 경우 엔터키를 넣으면 조회한다.
function ed_RECIPE_OnKeyDown(obj:Edit, e:KeyEventInfo)
{
	if(e.keycode == 13) fn_search();
}
]]></Script>
  </Form>
</FDL>
