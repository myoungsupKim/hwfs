<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="../../../default_typedef.xml"/>
  <Form id="FSR00151E" onload="form_onload" titletext="HMR용 표준레시피관리 DIV" position="absolute 0 0 1237 776" scrollbars="none">
    <Layouts>
      <Layout>
        <Static id="Static20" position="absolute 254 78 1227 105" class="sta_WFDA_Labelbg" anchor="left top right"/>
        <Static id="Static00" class="sta_WFDA_Labelbg" position="absolute 254 0 1227 27" anchor="left top right"/>
        <Static id="Static02" class="sta_WFDA_Labelbg" position="absolute 254 26 1227 53" anchor="left top right"/>
        <Static id="Static07" class="sta_WFDA_Labelbg" position="absolute 254 52 1227 79" anchor="left top right"/>
        <ImageViewer stretch="fit" id="img_Recipe" onloaderror="img_Recipe_OnLoadError" taborder="22" text="이미지가 없습니다." position="absolute 0 0 125 97"/>
        <Grid autoenter="select" binddataset="ds_ItemList" readonly="false" enable="true" id="grd_ItemList" useinputpanel="false" oncellclick="grd_ItemList_OnCellClick" onkeydown="grd_ItemList_OnKeyDown" onmousemove="grd_ItemList_OnMouseOver" taborder="15" tabstop="true" usecontextmenu="true" useselcolor="true" visible="true" wheelscrollrow="1" position="absolute 0 154 1227 390" selecttype="row" anchor="left top right" autofittype="col" onheadclick="grd_ItemList_onheadclick">
          <Formats>
            <Format id="Default">
              <Columns>
                <Column size="30"/>
                <Column size="24"/>
                <Column size="80"/>
                <Column size="26"/>
                <Column size="298"/>
                <Column size="80"/>
                <Column size="60"/>
                <Column size="70"/>
                <Column size="60"/>
                <Column size="60"/>
                <Column size="60"/>
                <Column size="60"/>
                <Column size="300"/>
              </Columns>
              <Rows>
                <Row size="26" band="head"/>
                <Row size="24"/>
                <Row size="24" band="summ"/>
              </Rows>
              <Band id="head">
                <Cell displaytype="text" class="head_Excel"/>
                <Cell col="1" colspan="3" displaytype="text" text="자재코드"/>
                <Cell col="4" displaytype="text" text="자재명"/>
                <Cell col="5" displaytype="text" text="규격"/>
                <Cell col="6" displaytype="text" text="단위"/>
                <Cell col="7" displaytype="text" text="자재특성"/>
                <Cell col="8" displaytype="text" text="단가"/>
                <Cell col="9" displaytype="text" text="환산단위"/>
                <Cell col="10" displaytype="text" text="소요량(g)"/>
                <Cell col="11" displaytype="text" text="원가"/>
                <Cell col="12" displaytype="text" text="비  고"/>
              </Band>
              <Band id="body">
                <Cell displaytype="text" style="align:center;" expr="expr:currow+1"/>
                <Cell col="1" displaytype="image" style="align:center;" text="URL('theme://images/new/grd_WF_ExpandImageX.png')"/>
                <Cell col="2" displaytype="text" style="align:left;background:EXPR(decode(RESTRICT_YN,'Y','#ffaa9cff',''));background2:EXPR(decode(RESTRICT_YN,'Y','#ffaa9cff',''));" text="bind:ITEM_CODE"/>
                <Cell col="3" displaytype="image" style="align:center;cursor:hand;" text="URL('theme://Images\new\grd_WF_ExpandImage.png')"/>
                <Cell col="4" displaytype="text" style="align:left;background:EXPR(decode(RESTRICT_YN,'Y','#ffaa9cff',''));background2:EXPR(decode(RESTRICT_YN,'Y','#ffaa9cff',''));" text="bind:ITEM_NAME"/>
                <Cell col="5" displaytype="text" style="align:left;" text="bind:ITEM_SIZE"/>
                <Cell col="6" displaytype="text" style="align:left;" text="bind:PO_UOM"/>
                <Cell col="7" displaytype="text" style="align:left;" text="bind:FEATURE_NAME"/>
                <Cell col="8" displaytype="number" style="align:right;" text="bind:MARGIN_PRICE"/>
                <Cell col="9" displaytype="text" style="align:right;" text="bind:KG_CONVERT_RATE"/>
                <Cell col="10" displaytype="number" edittype="text" editfilter="number" style="align:right;" text="bind:NEED_QTY"/>
                <Cell col="11" displaytype="number" style="align:right;" text="bind:PERSON_PRICE"/>
                <Cell col="12" edittype="normal" style="align:left;" text="bind:REMARK" editimemode="hangul"/>
              </Band>
              <Band id="summary">
                <Cell colspan="10" displaytype="text" style="align:center;" text="합계"/>
                <Cell col="10" displaytype="number" style="align:right;" expr="expr:getSum('NEED_QTY')"/>
                <Cell col="11" displaytype="number" style="align:right;" expr="expr:getSum('PERSON_PRICE')"/>
                <Cell col="12" style="align:right;"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Div id="div_Footer" scrollbars="autoboth" taborder="21" text="Div0" url="U_FSR::FSR00152E.xfdl" position="absolute 0 421 1227 776" anchor="left top right"/>
        <Button id="btn_RecipeElement" onclick="btn_RecipeElement_OnClick" taborder="16" position="absolute 0 395 112 416" class="btn_WF_Custom" image="" text="레시피영양성분"/>
        <Button id="btn_Ratio" onclick="btn_Ratio_OnClick" taborder="17" position="absolute 114 395 249 416" class="btn_WF_Custom" image="" text="레시피비율일괄변경"/>
        <MPFileDialog id="FileDialogSave" taborder="67" Type="Save" position="absolute 1292 32 1316 56"/>
        <MPFile id="file" taborder="70" position="absolute 1292 60 1316 84"/>
        <MPFileDialog Filter="Image Files(*.jpg,*.gif,*.bmp)|*.jpg;*.gif;*.bmp|" id="FileDialog" taborder="69" position="absolute 1264 32 1288 56"/>
        <Radio codecolumn="CD" datacolumn="NM" id="rdo_Detail" index="0" innerdataset="ds_SubRadio" taborder="14" position="absolute 120 133 370 154" onitemchanged="rdo_Detail_onitemchanged" columncount="2" rowcount="1"/>
        <Static id="Static03" text="기&#10;본&#10;정&#10;보" position="absolute 130 0 160 79" class="sta_WFDA_Label03"/>
        <Static id="Static04" text="레시피코드/명" position="absolute 159 0 255 27" class="sta_WFDA_Label01"/>
        <Static id="Static06" text="레 시 피 분 류" position="absolute 159 26 255 53" class="sta_WFDA_Label01"/>
        <Static id="Static8" text="판  매   단  위" position="absolute 159 52 255 79" class="sta_WFDA_Label01"/>
        <Edit id="ed_RecipeName" ontextchange="ed_RecipeName_OnCharChanged" taborder="1" position="absolute 329 3 556 24"/>
        <Edit id="ed_RecipeCd" readonly="true" taborder="0" position="absolute 257 3 327 24" class="edt_WF_Essential"/>
        <Combo codecolumn="CODE" datacolumn="CODE_NAME" displayrowcount="10" id="cbo_RecipeType" index="0" innerdataset="ds_RecipeType" taborder="4" position="absolute 558 29 682 50" class="cmb_WF_Essential"/>
        <Combo codecolumn="CODE" datacolumn="CODE_NAME" displayrowcount="10" enable="false" id="cbo_RecipeClass" index="0" innerdataset="ds_RecipeClass" taborder="3" position="absolute 257 29 466 50"/>
        <Combo codecolumn="CODE" datacolumn="CODE_NAME" displayrowcount="10" id="cbo_SaleUom" index="0" innerdataset="ds_SaleUom" taborder="6" position="absolute 257 55 466 76" class="cmb_WF_Essential"/>
        <Combo codecolumn="CODE" datacolumn="CODE_NAME" displayrowcount="10" id="cbo_ValidTime" index="0" innerdataset="ds_ValidTime" taborder="5" position="absolute 777 29 882 50" class="cmb_WF_Essential"/>
        <MaskEdit id="me_WongaPer" mask="#,##0.0" readonly="true" taborder="9" value="MaskEdit01" position="absolute 945 55 1000 76"/>
        <MaskEdit id="me_SalePrice" mask="###,##0" taborder="7" position="absolute 558 55 682 76" class="msk_WF_Essential"/>
        <MaskEdit id="me_WongaPrice" mask="###,##0" readonly="true" taborder="8" position="absolute 777 55 881 76"/>
        <Static id="Static6" text="%" position="absolute 1002 55 1018 76"/>
        <Static id="Static11" text="레시피유형" position="absolute 468 26 556 53" class="sta_WFDA_Label01"/>
        <Static id="Static35" text="유 효 시 간" position="absolute 684 26 774 53" class="sta_WFDA_Label01"/>
        <Static id="Static14" text="판   매   가" position="absolute 468 52 556 79" class="sta_WFDA_Label01"/>
        <Static id="Static36" text="개&#10;발&#10;정&#10;보" position="absolute 1014 0 1044 79" class="sta_WFDA_Label03"/>
        <Static id="Static37" text="개  발  자" position="absolute 1043 0 1123 27" class="sta_WFDA_Label01"/>
        <Static id="Static39" text="최초개발일" position="absolute 1043 26 1123 53" class="sta_WFDA_Label01"/>
        <Static id="Static40" text="최종수정일" position="absolute 1043 52 1123 79" class="sta_WFDA_Label01"/>
        <Edit id="ed_SabunName" readonly="true" taborder="11" position="absolute 1124 3 1204 24"/>
        <Button id="btn_CustPop" onclick="btn_CustPop_OnClick" taborder="23" text="" position="absolute 1203 3 1224 24" class="btn_WF_popSearch" image=""/>
        <MaskEdit id="me_Cdate" mask="@@@@-@@-@@" readonly="true" taborder="12" type="string" position="absolute 1124 29 1224 50" style="align:center middle;"/>
        <Static id="Static17" text="원가율" position="absolute 883 52 943 79" class="sta_WFDA_Label01"/>
        <Static id="Static18" text="원가" position="absolute 684 52 774 79" class="sta_WFDA_Label01"/>
        <Static id="Static19" text="상품특징" position="absolute 130 78 255 105" class="sta_WFDA_Label03"/>
        <Edit id="ed_GoodsFeature" taborder="10" position="absolute 257 81 1225 102"/>
        <MaskEdit id="me_Udate" mask="@@@@-@@-@@" readonly="true" taborder="13" type="string" position="absolute 1124 55 1224 76" style="align:center middle;"/>
        <Edit id="ed_Ratio" maxlength="3" inputtype="number" taborder="18" visible="false" position="absolute 253 395 312 416" style="align:right;"/>
        <Static id="st_Ratio" text="%" visible="false" position="absolute 312 395 328 416"/>
        <Button id="btn_RecipePop" onclick="btn_RecipePop_OnClick" taborder="2" text="중복체크" position="absolute 566 3 642 24" class="btn_WF_Custom" image="" tabstop="false"/>
        <Button id="btn_AddItem" onclick="btn_AddItem_OnClick" taborder="20" text="자재추가" position="absolute 1152 395 1227 416" class="btn_WF_Custom" image="" anchor="top right"/>
        <Button id="btn_Calc" onclick="btn_Calc_OnClick" taborder="19" text="조정" visible="false" position="absolute 336 395 388 416" class="btn_WF_Custom" image=""/>
        <Button id="btn_ImgDelete" taborder="71" text="삭제" onclick="btn_ImgDelete_OnClick" class="btn_WF_Delete" position="absolute 10 102 62 123"/>
        <Button id="btn_ImgInsert" taborder="72" text="첨부" onclick="btn_ImgInsert_OnClick" class="btn_WF_Append" position="absolute 64 102 116 123"/>
        <Static id="Static15" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 0 123 450 136" anchor="left top"/>
        <Static id="sta_WF_Title01" text="재료구성" class="sta_WF_Title01" position="absolute 0 136 90 154"/>
        <Static id="Static16" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 0 149 450 154"/>
        <Static id="Static09" text="w10" class="Guide01_AreaRed" visible="false" position="absolute 1227 15 1237 596"/>
        <Static id="Static10" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 0 390 1208 395"/>
        <Static id="Static01" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 0 416 1208 421"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_SubRadio">
        <ColumnInfo>
          <Column id="CD" size="256" type="STRING"/>
          <Column id="NM" size="256" type="STRING"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="CD">0</Col>
            <Col id="NM">조리과정</Col>
          </Row>
          <Row>
            <Col id="CD">1</Col>
            <Col id="NM">위생 및 조리포인트</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_ItemList" oncolumnchanged="ds_ItemList_OnColumnChanged"/>
      <Dataset id="ds_ValidTime"/>
      <Dataset id="ds_SaleUom"/>
      <Dataset id="ds_RecipeClass"/>
      <Dataset id="ds_RecipeType"/>
      <Dataset id="ds_RecipeInfo"/>
      <Dataset id="ds_Special"/>
      <Dataset id="ds_CookMethod"/>
      <Dataset id="ds_RecipeValid"/>
      <Dataset id="ds_TempRecipePhoto"/>
      <Dataset id="ds_TempCookMethodPhoto"/>
    </Objects>
    <Bind>
      <BindItem id="ed_RecipeName_value" compid="ed_RecipeName" propid="value" datasetid="ds_RecipeInfo" columnid="RECIPE_NAME"/>
      <BindItem id="ed_RecipeCd_value" compid="ed_RecipeCd" propid="value" datasetid="ds_RecipeInfo" columnid="RECIPE_CD"/>
      <BindItem id="cbo_RecipeType_value" compid="cbo_RecipeType" propid="value" datasetid="ds_RecipeInfo" columnid="RECIPE_TYPE"/>
      <BindItem id="cbo_RecipeClass_value" compid="cbo_RecipeClass" propid="value" datasetid="ds_RecipeInfo" columnid="RECIPE_CLASS"/>
      <BindItem id="cbo_SaleUom_value" compid="cbo_SaleUom" propid="value" datasetid="ds_RecipeInfo" columnid="SALE_UOM"/>
      <BindItem id="cbo_ValidTime_value" compid="cbo_ValidTime" propid="value" datasetid="ds_RecipeInfo" columnid="VALID_TIME"/>
      <BindItem id="me_WongaPer_value" compid="me_WongaPer" propid="value" datasetid="ds_RecipeInfo" columnid="WONGA_PER"/>
      <BindItem id="me_SalePrice_value" compid="me_SalePrice" propid="value" datasetid="ds_RecipeInfo" columnid="SALE_PRICE"/>
      <BindItem id="me_WongaPrice_value" compid="me_WongaPrice" propid="value" datasetid="ds_RecipeInfo" columnid="WONGA_PRICE"/>
      <BindItem id="ed_SabunName_value" compid="ed_SabunName" propid="value" datasetid="ds_RecipeInfo" columnid="SABUN_NAME"/>
      <BindItem id="me_Cdate_value" compid="me_Cdate" propid="value" datasetid="ds_RecipeInfo" columnid="CDATE"/>
      <BindItem id="ed_GoodsFeature_value" compid="ed_GoodsFeature" propid="value" datasetid="ds_RecipeInfo" columnid="GOODS_FEATURE"/>
      <BindItem id="me_Udate_value" compid="me_Udate" propid="value" datasetid="ds_RecipeInfo" columnid="UDATE"/>
    </Bind>
    <Script type="xscript4.0"><![CDATA[/*
 ******************************************************************************************
 * 시스템구분   : 메뉴관리 > 레시피관리 > HMR용 레시피관리
 * 프로그램명   : FSR00151E.XML
 * 기      능   : HRM용 레시피관리
 * 작  성  자   : 손창덕
 * 작성  일자   : 2008-01-14
 * 비      고   : 
 *		- ds_SubRadio				: [Radio DS] 조리과정 / 조리포인트 구분
 *		- ds_ItemList				: [Grid DS] 자재 리스트
 *		- ds_ValidTime				: [Combo DS] 유효시간
 *		- ds_SaleUom				: [Combo DS] 판매단위
 *		- ds_RecipeClass			: [Combo DS] 레시피분류
 *		- ds_RecipeType				: [Combo DS] 레시피유형
 *		- ds_RecipeInfo				: [Main DS] 레시피 상세정보
 *		- ds_Special				: [Grid DS] 위생 및 조리포인트 리스트
 *		- ds_CookMethod				: [Grid DS] 조리과정 리스트
 *		- ds_RecipeValid			: [Check DS] 레시피 중복체크
 *		- ds_CuisineType			: [Combo DS] 조리법유형
 *		- ds_TempRecipePhoto		: [Temp DS] 레시피 사진 삭제용
 *		- ds_TempCookMethodPhoto	: [Temp DS] 조리과정 사진 삭제용
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
//=========================================================================================
// [ PART 1 ]
// Form에서 Include 할 내용을 정의
//
//=========================================================================================
include "U_lib::lib_conversionCom.xjs";
//@@컨버터에서 주석처리 #include "LIB::sc_comon.js";			// 시스템공통 함수
//@@컨버터에서 주석처리 #include "LIB::lib_comm_0001.js";
//@@컨버터에서 주석처리 #include "LIB::tit_comm_0001.js";		// X-Framework Lib
//=========================================================================================
// [ PART 2 ]
// Form에서 사용될 전역변수를 선언
//
//=========================================================================================
var f_GUBUN = ""; // "NEW" = 신규, "MOD" = 수정
var f_CHK   = "N";
var f_RECIPE_CD_BAK = "";
//=========================================================================================
// [ PART 3 ]
// Form Loading 시 작업 정의
//
//=========================================================================================
function form_onload(obj:Form, e:LoadEventInfo)
{
	gfn_formOnLoad(obj, false);

	// X-Framework : Action 정보 생성 
	fsp_init(this);
	
	// 최초 로딩시 Image Display Text
	//img_Recipe.Text = "이미지가 없습니다.";
	
	// 레시피분류, 레시피유형 ComboBox Setting
	fn_SetRecipeCombo();
	
	// 유효시간 ComboBox Setting
	fsp_clear(this);
	ds_ValidTime.clearData();
	fsp_addSearch(this,"fs/fsr:FSR00150E_S005");
	fsp_callService(this,"","","","ds_ValidTime=ds_ValidTime","","fn_CallBackCode","",true);
	
	// 판매단위 ComboBox Setting
	fsp_clear(this);
	ds_SaleUom.clearData();
	fsp_addSearch(this,"fs/fsr:FSR00150E_S006");
	fsp_callService(this,"","","","ds_SaleUom=ds_SaleUom","","fn_CallBackCode","",true);
}
//=========================================================================================
// [ PART 4 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,도움말,form닫기)
//
//=========================================================================================
/*
 ******************************************************************************************
 * 함  수  명   : fn_Search(strCode, strRecipeCd, strRecipeName)
 * 기      능   : [조회버튼] 검색조건에 해당하는 정보를 조회
 ******************************************************************************************
 */
function fn_search(strCode, strRecipeCd, strRecipeName)
{
	// 작업구분 셋팅 = "MOD" : 수정, "NEW" : 신규
	f_GUBUN = strCode;
	
	// 신규일 경우 바인드 되어 있는 레시피코드를 지워줘야 하기 때문에
	// 임시로 변수에 담고 사용하자.
	f_RECIPE_CD_BAK = strRecipeCd;
	
	// 레시피 상세 조회
	fn_SearchRecipeInfo(strRecipeCd);
	
	// 레시피 자재 조회
	fn_SearchItemList(strRecipeCd);
	
	// 레시피 분류가 HMR이 아닐 경우 수정 불가토록 처리 ==> HMR이 아닌경우의 수정 되는 경우가 없음(2008.05.02) -- 수정 요청사항
	/*if( f_GUBUN == "MOD" && ds_MainRecipeList.GetColumn(ds_MainRecipeList.currow, "RECIPE_CLASS") != "H" ) {
		fn_FrmLock(false);
	} else {
		fn_FrmLock(true);
	}*/
	
	fn_FrmLock(true);
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_Insert()
 * 기      능   : [등록버튼] 등록 버튼 클릭 시 처리되는 작업
 ******************************************************************************************
 */
function fn_insert()
{
	http.Sync = true;
	fn_search("NEW", null, null);
	http.Sync = false;
	
	ds_RecipeInfo.clearData();	// 레시피 상세정보 DataSet
	ds_ItemList.clearData();	// 자재리스트 DataSet
	ds_CookMethod.clearData();	// 조리법 DataSet
	ds_Special.clearData();		// 위생 및 조리포인트 DataSet
	
	ds_RecipeInfo.addRow();
	ds_RecipeInfo.setColumn(0, "RECIPE_CLASS", "H");	// 레시피분류 Setting
	ds_RecipeInfo.setColumn(0, "RECIPE_TYPE",  "0");	// 레시피유형 Setting
	ds_RecipeInfo.setColumn(0, "VALID_TIME",   "0");	// 유효시간 Setting
	ds_RecipeInfo.setColumn(0, "SALE_UOM",     "0");	// 판매단위 Setting
	
	// Focus Setting
	ed_RecipeName.setFocus();
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_save()
 * 기      능   : [저장버튼] 저장 버튼 클릭 시 처리되는 작업
 ******************************************************************************************
 */
function fn_save()
{
	if( gfn_dsIsUpdated(ds_RecipeInfo)|| gfn_dsIsUpdated(ds_ItemList)|| gfn_dsIsUpdated(ds_CookMethod)|| gfn_dsIsUpdated(ds_Special)) {
		// 필수입력 체크 -- ds_RecipeInfo
		if( gfn_length(gfn_trim(ed_RecipeName.value))== 0 ) {
			g_Message("EE", "레시피명을 입력하세요.");
			ed_RecipeName.setFocus();
			return;
		} else {
			if( f_GUBUN == "NEW" && f_CHK == "N" ) {
				g_Message("EE", "저장 전 레시피 중복체크를 하세요.");
				return;
			}
		}
		if( cbo_RecipeClass.value != "H" ) {
			g_Message("EE", "레시피분류가 HMR이 아닙니다.\n관리자에게 문의하여 주십시요.");
			cbo_RecipeClass.setFocus();
			return;
		}
		if( cbo_RecipeType.value == '0' ) {
			g_Message("EE", "레시피유형을 선택하세요.");
			cbo_RecipeType.setFocus();
			return;
		}
		if( cbo_ValidTime.value == '0' ) {
			g_Message("EE", "유효시간을 선택하세요.");
			cbo_ValidTime.setFocus();
			return;
		}
		if( cbo_SaleUom.value == '0' ) {
			g_Message("EE", "판매단위를 선택하세요.");
			cbo_SaleUom.setFocus();
			return;
		}
		if( gfn_length(gfn_trim(me_SalePrice.value))== 0 ) {
			g_Message("EE", "판매가를 입력하세요.");
			me_SalePrice.setFocus();
			return;
		}
		
		// 필수입력 체크 -- ds_ItemList
		if( ds_ItemList.getRowCount() < 1 ) {
			g_Message("EE", "적어도 1개 이상의 자재를 입력하셔야 합니다.");
			return;
		}
		
		// 필수입력 체크 -- ds_CookMethod
		var v_ResultRow1 = ds_CookMethod.findRowExpr("gfn_length(gfn_trim(CUISINE_DESC))== 0 ");
		if( v_ResultRow1 != -1 ) {
			if( rdo_Detail.value == "1" ) {
				rdo_Detail.value = "0";
				div_Footer.url="U_FSR::FSR00152E.xfdl";
			}
			g_Message("EE", "조리과정을 입력하세요.");
			ds_CookMethod.rowposition = v_ResultRow1;
			return;
		}
		
		// 필수입력 체크 -- ds_Special
		var v_ResultRow2 = ds_Special.findRowExpr("gfn_length(gfn_trim(SPECIAL_DESC))== 0 ");
		if( v_ResultRow2 != -1 ) {
			if( rdo_Detail.value == "0" ) {
				rdo_Detail.value = "1";
				div_Footer.url="U_FSR::FSR00153E.xfdl";
			}
			g_Message("EE", "위생 및 조리포인트를 입력하세요.");
			ds_Special.rowposition = v_ResultRow2;
			return;
		}
		
		if( f_GUBUN == "NEW" ) {
			fsp_clear(this);
			var inDataSet  = "ds_RecipeInfo=ds_RecipeInfo:A ds_ItemList=ds_ItemList:A ds_CookMethod=ds_CookMethod:A ds_Special=ds_Special:A";
			var outDataSet = "ds_RecipeInfo=ds_RecipeInfo";	// 신규 HMR레시피의 경우 레시피코드를 받아오기 위해 OUT DATASET Setting
			fsp_callService(this, "FSR00150E_ACT", "insertRecipe", inDataSet, outDataSet, "RECIPE_NAME="+ed_RecipeName.value+" RECIPE_CLASS=H", "fn_CallBackSave", "", true);
		} else { // update
			// Service Setting
			var actionName, cmdName, inData, outData, otherArg, callBackFnc, keyIncrement, callbackSql, saveFlagColumn;
			var insertSql1, updateSql1, deleteSql1, keySqlName1;
			var insertSql2, updateSql2, deleteSql2, keySqlName2;
			var insertSql3, updateSql3, deleteSql3, keySqlName3;
			var insertSql4, updateSql4, deleteSql4, keySqlName4;
			
			inData		 = "ds_RecipeInfo=ds_RecipeInfo:U ds_ItemList=ds_ItemList:U ds_CookMethod=ds_CookMethod:U ds_Special=ds_Special:U";
			outData		 = "";
			callBackFnc	 = "fn_CallBackSave";
			
			insertSql1 	 = "fs/fsr:FSR00150E_I001";
			insertSql2 	 = "fs/fsr:FSR00150E_I002";
			insertSql3 	 = "fs/fsr:FSR00150E_I003";
			insertSql4 	 = "fs/fsr:FSR00150E_I004";
			
			updateSql1   = "fs/fsr:FSR00150E_U001";
			updateSql2   = "fs/fsr:FSR00150E_U002";
			updateSql3   = "fs/fsr:FSR00150E_U003";
			updateSql4   = "fs/fsr:FSR00150E_U004";
			
			deleteSql1   = "fs/fsr:FSR00150E_D001";
			deleteSql2   = "fs/fsr:FSR00150E_D002";
			deleteSql3   = "fs/fsr:FSR00150E_D003";
			deleteSql4   = "fs/fsr:FSR00150E_D004";
			
			keySqlName1  = "";
			keySqlName2  = "fs/fsr:FSR00150E_S011";
			keySqlName3  = "fs/fsr:FSR00150E_S012";
			keySqlName4  = "fs/fsr:FSR00150E_S013";
			callbackSql	 = "";
			
			fsp_clear(this);
			fsp_addSave(this, insertSql1, updateSql1, deleteSql1, saveFlagColumn, keySqlName1, -1, callbackSql);
			fsp_addSave(this, insertSql2, updateSql2, deleteSql2, saveFlagColumn, keySqlName2, 1,  callbackSql);
			fsp_addSave(this, insertSql3, updateSql3, deleteSql3, saveFlagColumn, keySqlName3, 1,  callbackSql);
			fsp_addSave(this, insertSql4, updateSql4, deleteSql4, saveFlagColumn, keySqlName4, 1,  callbackSql);
			fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);
		}
	} else {
		g_Message("EE", "변경된 내역이 없습니다.");
	}
}
/* 
 ******************************************************************************************
 * 함  수  명   : fn_Delete()
 * 기      능   : [삭제버튼] 삭제 시 처리되는 작업
 ******************************************************************************************
 */
function fn_delete(nRow)
{
	if( ds_RecipeInfo.getRowCount() == 0 ) {
		g_Message("EE", "삭제하실 HMR 레시피를 선택해 주세요.");
		return;
	}
	if( f_GUBUN == "NEW" ) {
		ds_RecipeInfo.clearData();
		ds_ItemList.clearData();
		ds_CookMethod.clearData();
		ds_Special.clearData();
	} else {
		if( ds_RecipeInfo.getColumn(0, "RECIPE_CLASS") != "H" ) {
			g_Message("EE", "HMR 레시피만 삭제가 가능합니다.");
			return;
		}
		if( g_Confirm("01", "선택하신 HMR 레시피를 삭제 하시겠습니까?") ) {
			Copy(ds_TempRecipePhoto,"ds_RecipeInfo");
			Copy(ds_TempCookMethodPhoto,"ds_CookMethod");
		
			fsp_clear(this);
			// Input / Output DataSet Setting
			var inDataSet  = "ds_RecipeInfo=ds_RecipeInfo ds_ItemList=ds_ItemList ds_CookMethod=ds_CookMethod ds_Special=ds_Special";
			fsp_callService(this, "FSR00150E_ACT", "deleteRecipe", inDataSet, "", "", "fn_CallBackDelete", "", true);
		}
	}
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_Print()
 * 기      능   : [출력버튼] 출력 시 처리되는 작업
 ******************************************************************************************
 */
function fn_print()
{
	if( ds_RecipeInfo.getRowCount() <= 0 ) {
		g_Message("EE", "HMR 레시피를 상세정보 조회 후 출력이 가능합니다.");
		return;
	}
	
	if( f_GUBUN == "NEW" ) {
		g_Message("EE", "HMR 레시피로 저장 후 출력이 가능합니다.");
		return;
	}
	
	strParam = "IFIS/oz.asp?title=HMR레시피출력물";							// Page Title
	strParam += "&url=IFIS/FSR00150E_HMR레시피출력물.ozr";					// OZ Report File Name
	strParam += "&cnt=2";														// Parameters Count
	strParam += "&p1=" + ds_RecipeInfo.getColumn(0, "RECIPE_CD");				// RECIPE_CODE
	strParam += "&p2=" + fsp_getServerDir("FSR_STD_RECIPE_CUISINE", "") + "/";	// 조리과정 사진 경로
	strParam += "&zoom=150";													// 화면 출력 크기
	
	strReturn = gfn_dialog("", "U_SCC::SCCOZREPORT1.xfdl",{fstrParam:strParam});
}
//=========================================================================================
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
//
//=========================================================================================
/*
 ******************************************************************************************
 * 함  수  명   : fn_CallBackCode(errCode, errMsg)
 * 입      력   : errCode 	= 에러코드
				  errMsg	= 에러메세지
 * 반      환   : 없음
 * 기      능   : ComboBox 데이터 조회 후 콜백함수
 * 작  성  자   : 손창덕
 * 작성  일자   : 2008-01-14
 ******************************************************************************************
 */
function fn_CallBackCode(errCode, errMsg)
{
	if( errCode != 0 ) {
		return;
	} else {
	}
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_SearchRecipeInfo(strRecipeCd)
 * 입      력   : strRecipeCd - 레시피코드
 * 반      환   : 없음
 * 기      능   : MainRecipeList에서 선택된 레시피의 상세정보를 조회
 * 작  성  자   : 손창덕
 * 작성  일자   : 2008-01-14
 ******************************************************************************************
 */
function fn_SearchRecipeInfo(strRecipeCd)
{
	// Result DataSet Clear
	ds_RecipeInfo.clearData();
	
	// DataSet & callBack함수 정의 
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	inData			= "";
	outData			= "ds_RecipeInfo=ds_RecipeInfo";
	otherArg		= "RECIPE_CD="+strRecipeCd;
	callBackFnc		= "fn_CallBackSearchRecipeInfo";
	
	fsp_clear(this);
	fsp_addSearch(this, "fs/fsr:FSR00150E_S007");
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_CallBackSearchRecipeInfo(errCode, errMsg)
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : Recipe 상세정보 조회 후 콜백 함수
 * 작  성  자   : 손창덕
 * 작성  일자   : 2008-01-14
 ******************************************************************************************
 */
function fn_CallBackSearchRecipeInfo(errCode, errMsg)
{
	if( errCode != 0 ) {
		return;
	} else {
		if( f_GUBUN == "NEW" ) {
			// 레시피 코드 삭제, 레시피 명 입력 가능하게 처리
			ds_RecipeInfo.setColumn(0, "RECIPE_CD", "");
			ed_RecipeName.readonly = false;
			btn_RecipePop.visible  = true;
			
			// 레시피분류를 무조건 HMR로 고정, 레시피유형은 미선택으로
			ds_RecipeInfo.setColumn(0, "RECIPE_CLASS", "H");
			ds_RecipeInfo.setColumn(0, "RECIPE_TYPE",  "0");
			
			img_Recipe.image = "";
			img_Recipe.text = "이미지가 없습니다.";
		} else {
			// 레시피 코드/명 입력 불가 처리
			ed_RecipeCd.readonly   = true;
			ed_RecipeName.readonly = true;
			
			var v_path = "FSR_STD_RECIPE_MST";
			ed_RecipeName.readonly = true;
			btn_RecipePop.visible  = false;
				
			if( gfn_length(gfn_trim(ds_RecipeInfo.getColumn(0,"SPHOTO_PATH")))== 0 || gfn_trim(ds_RecipeInfo.getColumn(0,"SPHOTO_PATH"))== null ) {
				img_Recipe.image = "";
				img_Recipe.text = "이미지가 없습니다.";
			} else {
				if( gfn_length(gfn_trim(fsp_getServerDir(v_path,ds_RecipeInfo.getColumn(0,"SPHOTO_PATH"))))== 0 || gfn_trim(fsp_getServerDir(v_path,ds_RecipeInfo.getColumn(0,"SPHOTO_PATH")))== null ) {
					img_Recipe.image = "";
					img_Recipe.text = "이미지가 없습니다.";
				} else {
					img_Recipe.text = "";
					img_Recipe.image = fsp_getServerDir(v_path,ds_RecipeInfo.getColumn(0,"SPHOTO_PATH"));
				}
			}
		}
	}
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_SearchItemList(strRecipeCd)
 * 입      력   : strRecipeCd - 레시피코드
 * 반      환   : 없음
 * 기      능   : MainRecipeList에서 선택된 레시피의 자재정보를 조회
 * 작  성  자   : 손창덕
 * 작성  일자   : 2008-01-14
 ******************************************************************************************
 */
function fn_SearchItemList(strRecipeCd)
{
	// Result DataSet Clear
	ds_ItemList.clearData();
	
	// DataSet & callBack함수 정의 
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	inData			= "";
	outData			= "ds_ItemList=ds_ItemList";
	otherArg		= "RECIPE_CD="+strRecipeCd;
	callBackFnc		= "fn_CallBackSearchItemList";
	
	fsp_clear(this);
	fsp_addSearch(this, "fs/fsr:FSR00150E_S008");
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_CallBackSearchItemList(errCode, errMsg)
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : Recipe 상세정보 조회 후 콜백 함수
 * 작  성  자   : 손창덕
 * 작성  일자   : 2008-01-14
 ******************************************************************************************
 */
function fn_CallBackSearchItemList(errCode, errMsg)
{
	if( errCode != 0 ) {
		return;
	} else {
		fsp_clear(this);
		ds_CookMethod.clearData();
		fsp_addSearch(this,"fs/fsr:FSR00150E_S009");
		fsp_callService(this,"","","","ds_CookMethod=ds_CookMethod","RECIPE_CD="+f_RECIPE_CD_BAK,"fn_CallBackSearch","",true);
		
		fsp_clear(this);
		ds_Special.clearData();
		fsp_addSearch(this,"fs/fsr:FSR00150E_S010");
		fsp_callService(this,"","","","ds_Special=ds_Special","RECIPE_CD="+f_RECIPE_CD_BAK,"fn_CallBackSearch","",true);
	}
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_CallBackSave(errCode, errMsg)
 * 입      력   : errCode 	= 에러코드
				  errMsg	= 에러메세지
 * 반      환   : 없음
 * 기      능   : 레시피 저장 후 콜백 함수
 * 작  성  자   : 손창덕
 * 작성  일자   : 2008-01-16
 ******************************************************************************************
 */
function fn_CallBackSave(errCode, errMsg)
{
	if( errCode != 0 ) {
		return;
	} else {
		g_Message("02", "HMR 레시피가 정상적으로 저장 되었습니다.");
		// 2008.05.21 이명희
		// 요청으로 인해 신규 입력 후 바로 사진 업로드 및 수정이 가능하게 재조회 하여
		// 작업구분자를 MOD로 바꿔줌
		// 2008.05.21 이명희 요청으로 수정 후 원가율이 재계산된 값을 보여주기 위해 재조회
		fn_search("MOD", ds_RecipeInfo.getColumn(0, "RECIPE_CD"), ds_RecipeInfo.getColumn(0, "RECIPE_NAME"));
	}
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_CallBackSearch(errCode, errMsg)
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 조리과정, 위생 및 조리포인트 조회 후 콜백 함수
 * 작  성  자   : 손창덕
 * 작성  일자   : 2008-01-14
 ******************************************************************************************
 */
function fn_CallBackSearch(errCode, errMsg)
{
	if( errCode != 0 ) {
		return;
	} else {
		// 조리과정의 사진이 있을경우 첫번째 사진 보여주기
		if( rdo_Detail.index == 0 && ds_CookMethod.getRowCount() > 0 ) {
			div_Footer.fn_grd_CookMethod_OnCellClick(div_Footer.grd_CookMethod, 0, 0);
		}
	}
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_CallBackDelete(errCode, errMsg)
 * 입      력   : errCode 	= 에러코드
				  errMsg	= 에러메세지
 * 반      환   : 없음
 * 기      능   : 레시피 삭제 후 콜백 함수
 * 작  성  자   : 손창덕
 * 작성  일자   : 2008-01-17
 ******************************************************************************************
 */
function fn_CallBackDelete(errCode, errMsg)
{
	if( errCode != 0 ) {
		return;
	} else {
		// 1.레시피 사진 삭제
		fn_DeleteRecipePhoto(ds_TempRecipePhoto);
		
		// 2.조리과정 사진 삭제
		fn_DeleteMethodPhoto(ds_TempCookMethodPhoto);
		
		// 알림창
		g_Message("02", "HMR 레시피가 정상적으로 삭제 되었습니다.");
		
		// 표준레시피 리스트 재조회
		parent.fn_search();
	}
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_CallBackValid(errCode, errMsg)
 * 입      력   : errCode 	= 에러코드
				  errMsg	= 에러메세지
 * 반      환   : 없음
 * 기      능   : 레시피 중복체크 후 콜백 함수
 * 작  성  자   : 손창덕
 * 작성  일자   : 2008-01-16
 ******************************************************************************************
 */
function fn_CallBackValid(errCode, errMsg)
{
	if( errCode != 0 ) {
		return;
	} else {
		if( ds_RecipeValid.getRowCount() > 0 ) {
			g_Message("EE", "동일한 레시피 존재합니다.\n다른 레시피명을 사용해 주세요.");
			ed_RecipeName.value = "";
			ed_RecipeName.setFocus();
			return;
		} else {
			g_Message("EE", "등록가능합니다.");
			f_CHK = "Y";
			btn_RecipePop.visible = false;
			return;
		}
	}
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_DeleteRecipePhoto(obj)
 * 입      력   : obj = 레시피 정보 DataSet
 * 반      환   : 없음
 * 기      능   : 레시피 사진 삭제
 * 작  성  자   : 손창덕
 * 작성  일자   : 2008-01-17
 ******************************************************************************************
 */
function fn_DeleteRecipePhoto(obj) {
	// 사진경로
	var v_path = "FSR_STD_RECIPE_MST";
	var v_photo_path = "";
	var v_sphoto_path = "";
	
	if( obj.getRowCount() == 1 ) {
		v_photo_path  = obj.getColumn(0, "PHOTO_PATH" );
		v_sphoto_path = obj.getColumn(0, "SPHOTO_PATH");
		// 사진이 존재할 경우 삭제
		if( gfn_length(gfn_trim(v_sphoto_path))!= 0 && gfn_length(gfn_trim(v_photo_path))!= 0 ) {
			var v_rtn = fsp_fileDelete(v_path, v_sphoto_path, true);
			if( v_rtn ) {
				obj.setColumn(0, "SPHOTO_PATH", "");
				obj.setColumn(0, "PHOTO_PATH",  "");
				img_Recipe.image = "";
				fn_save();
			} else {
				return false;
			}
		}
	}
	return true;
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_DeleteMethodPhoto(obj)
 * 입      력   : obj = 조리과정 DataSet
 * 반      환   : 없음
 * 기      능   : 조리과정 사진 삭제
 * 작  성  자   : 손창덕
 * 작성  일자   : 2008-01-17
 ******************************************************************************************
 */
function fn_DeleteMethodPhoto(obj) {
	// 사진경로
	var v_path = "FSR_STD_RECIPE_CUISINE";
	var v_photo_path = "";
	var v_sphoto_path = "";
	var v_total_cnt = obj.getRowCount();
	
	if( v_total_cnt > 0 ) {
		for( var i=0; i<v_total_cnt; i++ ) {
			v_photo_path  = obj.getColumn(0, "PHOTO_PATH" );
			v_sphoto_path = obj.getColumn(0, "SPHOTO_PATH");
			// 사진이 존재할 경우 삭제
			if( gfn_length(gfn_trim(v_sphoto_path))!= 0 && gfn_length(gfn_trim(v_photo_path))!= 0 ) {
				var v_rtn = fsp_fileDelete(v_path, v_sphoto_path, true);
				if( v_rtn ) {
					obj.setColumn(i, "SPHOTO_PATH", "");
					obj.setColumn(i, "PHOTO_PATH",  "");
				} else {
					return false;
				}
			}
		}
	}
	return true;
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_FrmLock(arg)
 * 입      력   : arg = Enable(True/False)
 * 반      환   : 없음
 * 기      능   : 화면 Lock/UnLock
 * 작  성  자   : 손창덕
 * 작성  일자   : 2008-01-18
 ******************************************************************************************
 */
function fn_FrmLock(arg) {
	btn_CustPop.enable     = arg;		// 사용자 검색 버튼
	//cbo_RecipeClass.Enable = arg;		// 레시피분류 콤보박스 ==> 무조건 HMR로 고정되어야 함
	cbo_RecipeType.enable  = arg;		// 레시피유형 콤보박스
	cbo_ValidTime.enable   = arg;		// 유효시간 콤보박스
	cbo_SaleUom.enable     = arg;		// 판매단위 콤보박스
	me_SalePrice.enable    = arg;		// 판매가
	ed_GoodsFeature.enable = arg;		// 상품 특징
	btn_ImgDelete.enable   = arg;		// 레시피 사진 삭제
	btn_ImgInsert.enable   = arg;		// 레시피 사진 첨부
	grd_ItemList.readonly  = !arg;		// 재료구성 그리드
	btn_Ratio.enable       = arg;		// 레시피비율 일괄변경 버튼
	
	if( rdo_Detail.index == 0 ) {		// div_Footer
		div_Footer.grd_CookMethod.readonly = !arg;
		div_Footer.btn_SubDelete.enable    = arg;
		div_Footer.btn_ImgDelete.enable    = arg;
		div_Footer.btn_ImgInsert.enable    = arg;
	} else {
		div_Footer.grd_Special.readonly = !arg;
		div_Footer.btn_SubDelete.enable = arg;
	}
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_SetRecipeCombo()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : HMR용 레시피분류, 레시피유형 콤보 데이터 가져오기
 * 작  성  자   : 손창덕
 * 작성  일자   : 2008-05-02
 ******************************************************************************************
 */
function fn_SetRecipeCombo()
{
	// 레시피분류 ComboBox Setting
	fsp_clear(this);
	ds_RecipeClass.clearData();
	fsp_addSearch(this,"fs/fsr:FSR00150E_S001");
	fsp_callService(this,"","","","ds_RecipeClass=ds_RecipeClass","SET1='H'","fn_CallBackRecipeClassCode","",true);
	
	// 레시피유형 ComboBox Setting
	fsp_clear(this);
	ds_RecipeType.clearData();
	fsp_addSearch(this,"fs/fsr:FSR00150E_S002");
	fsp_callService(this,"","","","ds_RecipeType=ds_RecipeType","SET1='Y'","fn_CallBackRecipeTypeCode","",true);
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_CallBackRecipeClassCode(errCode, errMsg)
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : HMR용 레시피분류 조회 후 콜백 함수
 * 작  성  자   : 손창덕
 * 작성  일자   : 2008-05-02
 ******************************************************************************************
 */
function fn_CallBackRecipeClassCode(errCode, errMsg)
{
	if( errCode != 0 ) {
		return;
	} else {
		ds_RecipeClass.deleteRow(0);
	}
}
/*
 ******************************************************************************************
 * 함  수  명   : fn_CallBackRecipeTypeCode(errCode, errMsg)
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : HMR용 레시피유형 조회 후 콜백 함수
 * 작  성  자   : 손창덕
 * 작성  일자   : 2008-05-02
 ******************************************************************************************
 */
function fn_CallBackRecipeTypeCode(errCode, errMsg)
{
	if( errCode != 0 ) {
		return;
	} else {
		ds_RecipeType.setColumn(0, "CODE_NAME", "- 선택 -");
	}
}
//=========================================================================================
// [ PART 6 ]
// component Event 정의 ( User Define function )
// --> component Event의 기요,기능,동작 등 상세내용은 MiPlatform 메뉴얼을 참조하시기 바랍니다.
//=========================================================================================
/******************************************************************************************
 * 함  수  명   : btn_CustPop_OnClick(obj)
 * 기      능   : 사원조회 팝업
 * 작  성  자   : 손창덕
 * 작성  일자   : 2008-01-15
 ******************************************************************************************
 */
function btn_CustPop_OnClick(obj:Button, e:ClickEventInfo)
{
	if( ds_RecipeInfo.getRowCount() !=0 ) {
		var v_rtn=gfn_dialog("", "U_SCC::SCC00043P.xfdl","");
		var v_result=gfn_split(v_rtn,";");// 0 사번 1 성명 2 영문명 3 주민번호
		if( gfn_length(gfn_trim(v_rtn))== 0 || gfn_trim(v_rtn)== null ) {
			return;
		}
		ds_RecipeInfo.setColumn(0, "SABUN",      v_result[0]);
		ds_RecipeInfo.setColumn(0, "SABUN_NAME", v_result[1]);
	}
}
/******************************************************************************************
 * 함  수  명   : grd_ItemList_OnCellClick(obj,nRow,nCell,nX,nY,nPivotIndex)
 * 기      능   : 자재 삭제 / 자재 추가
 * 작  성  자   : 손창덕
 * 작성  일자   : 2008-01-15
 ******************************************************************************************
 */
function grd_ItemList_OnCellClick(obj:Grid, e:GridClickEventInfo)
{
	fn_grd_ItemList_OnCellClick(obj, e.row, e.cell);
}

function fn_grd_ItemList_OnCellClick(obj:Grid, nRow, nCell)
{
	var ActionVal = "";
	var v_rtn     = "";
	var v_result  = "";
	
	switch(nCell) {
		case 1:
			ds_ItemList.deleteRow(nRow);
			break;
		case 3:
			if( GetRowType(ds_ItemList,nRow)== "insert" ) {
				v_rtn=gfn_dialog("", "U_FSR::FSR00014P.xfdl",{fstrPriceGbn:''});
				if( gfn_length(gfn_trim(v_rtn))!= 0 || gfn_trim(v_rtn)!= null ) {
					// 0 자재코드 ,1 자재명, 2 규격, 3 단위 ,4 금지, 5 100g에너지, 6 폐기율, 7 g당단가, 8 자재특성 9 1인소요량, 10 단가, 11 비고
					v_result=gfn_split(v_rtn,";");
					if( ds_ItemList.findRow("ITEM_CODE",v_result[0]) != -1 ) {
						g_Message("EE", "이미 등록된 자재입니다.");
						break;
					}
					
					ds_ItemList.setColumn(nRow, "ITEM_CODE",    gfn_trim(v_result[0]));
					ds_ItemList.setColumn(nRow, "ITEM_NAME",    gfn_trim(v_result[1]));
					ds_ItemList.setColumn(nRow, "ITEM_SIZE",    gfn_trim(v_result[2]));
					ds_ItemList.setColumn(nRow, "PO_UOM",       gfn_trim(v_result[3]));
					ds_ItemList.setColumn(nRow, "GRAM_PRICE",   gfn_trim(v_result[7]));
					ds_ItemList.setColumn(nRow, "FEATURE_NAME", gfn_trim(v_result[8]));
					ds_ItemList.setColumn(nRow, "NEED_QTY",     gfn_trim(v_result[9]));
					ds_ItemList.setColumn(nRow, "MARGIN_PRICE", gfn_trim(v_result[10]));
					//ds_ItemList.SetColumn(nRow, "REMARK",       v_result[11]);
				}
			}
			break;
		default:
			break;
	}
}
/******************************************************************************************
 * 함  수  명   : grd_ItemList_OnKeyDown(obj,nChar,bShift,bCtrl,bAlt,nLLParam,nHLParam)
 * 기      능   : 자재 리스트에서 입력 입력으로 신규 자재 추가모드로 전환
 * 작  성  자   : 손창덕
 * 작성  일자   : 2008-01-15
 ******************************************************************************************
 */
function grd_ItemList_OnKeyDown(obj:Grid, e:KeyEventInfo)
{
	if( e.keycode==13 && ds_RecipeInfo.getRowCount() !=0 ) {
		if( ds_ItemList.findRowExpr("gfn_length(gfn_trim(ITEM_CODE))==0 || gfn_trim(ITEM_CODE)==null") != -1 ) {
			return;
		}
		ds_ItemList.addRow();
		ds_ItemList.setColumn(ds_ItemList.rowposition,"RECIPE_CD", ds_RecipeInfo.getColumn(0,"RECIPE_CD"));
	}
}
/******************************************************************************************
 * 함  수  명   : ds_ItemList_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
 * 기      능   : 자재 리스트에서 1인 소요량 입력시 원가 계산
 * 작  성  자   : 손창덕
 * 작성  일자   : 2008-01-15
 ******************************************************************************************
 */
function ds_ItemList_OnColumnChanged(obj:Dataset, e:DSColChangeEventInfo)
{
	// 1인 소요량 입력시 원가 계산 : 원가 = g당 원가 * 1인 소요량
	if( e.columnid == "NEED_QTY" ) {
		ds_ItemList.setColumn(e.row, "PERSON_PRICE", Math.round(ds_ItemList.getColumn(e.row, "GRAM_PRICE") * ds_ItemList.getColumn(e.row, "NEED_QTY"), 0));
	}
}
/******************************************************************************************
 * 함  수  명   : btn_RecipeElement_OnClick(obj)
 * 기      능   : 레시피영양성분 팝업 호출
 * 작  성  자   : 손창덕
 * 작성  일자   : 2008-01-15
 ******************************************************************************************
 */
function btn_RecipeElement_OnClick(obj:Button, e:ClickEventInfo)
{
	if( ds_RecipeInfo.getRowCount() != 0 ) {
		var v_arg = {gbn:"0",IN_RECIPE_CD:ds_RecipeInfo.getColumn(0,"RECIPE_CD")};
		gfn_dialog("", "U_FSR::FSR00012P.xfdl",v_arg);
	}
}
/******************************************************************************************
 * 함  수  명   : rdo_Detail_onitemchanged(obj,strCode,strText,nOldIndex,nNewIndex)
 * 기      능   : 조리과정 / 위생 및 조리포인트 DIV
 * 작  성  자   : 손창덕
 * 작성  일자   : 2008-01-15
 ******************************************************************************************
 */
function rdo_Detail_onitemchanged(obj:Radio, e:ItemChangeEventInfo)
{
	fn_rdo_Detail_onitemchanged(obj,e.postvalue,e.posttext,e.preindex,e.postindex);
}

function fn_rdo_Detail_onitemchanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	switch(nNewIndex)
	{
		case 0:
			div_Footer.url = "U_FSR::FSR00152E.xfdl";
			break;
		case 1:
			div_Footer.url = "U_FSR::FSR00153E.xfdl";
			break;
		default:
			break;
	}	
}
/******************************************************************************************
 * 함  수  명   : btn_ImgInsert_OnClick(obj)
 * 기      능   : 이미지 첨부
 * 작  성  자   : 손창덕
 * 작성  일자   : 2008-01-15
 ******************************************************************************************
 */
 /******************************************************
 *  서버로 파일 전송 처리 
 * @param  httpfileObj  http file 처리 객체  
 * @param  serverSaveDir  서버에 저장할 디렉토리 별명 
 * @param  localFilePath 로컬 경로 
 * @param  localFileName 로컬 파일명 
 * @param  sendFileName  서버에 전송하고 싶은 이름 
 * @param  fileProcType  서버에서 기존 파일을 처리하는 타입 정의  
           D - deleteFileName에 기술된 파일명이 존재할 경우만 파일 삭제 ( 기본 값 )
           A - 전송하는 파일명으로 해당 파일이 존재할 경우 삭제 후 저장 
               ( 파일명은 서버에 정의된 되로 타임을 추가해야 할 경우 추가한다. )
               또한, deleteFileName이 존재할 경우 함께 삭제한다. 
           U - 전송하는 파일명으로 해당 파일이 존재할 경우 삭제 후 저장 
               ( 파일명은 무조건 Client를 기준으로 저장한다. )
               또한, deleteFileName이 존재할 경우 함께 삭제한다. 
           N - 전송하는 파일명으로 해당 파일이 존재할 경우 저장하지 않는다. 
               ( 파일명은 무조건 Client를 기준으로 저장한다. )
               또한, deleteFileName이 존재할 경우 함께 삭제한다. 
 * @param  deleteFileName 서버에서 삭제해야 하는 파일 명
           isDelete가 true이면서 해당 파일명이 기술되어 있지 않을 경우 
           기존 파일을 삭제한다. 
 * @return  서버에 저장된 파일 정보 Array 
            0 - 성공 : S / 실패 : E 
            1 - 서버에 저장된 실제 경로 
            2 - 서버에 저장된 실제 파일명 
            3 - 서버에 저장된 파일 사이즈 
******************************************************/
function btn_ImgInsert_OnClick(obj:Button, e:ClickEventInfo)
{
	if( f_GUBUN == "NEW" ) {
		g_Message("EE", "신규 HMR레시피를 저장 후 사진을 첨부 하세요.");
	} else {
		if( ds_RecipeInfo.getRowCount() == 0 ) {
			return;
		}
		if( gfn_dsIsUpdated(ds_RecipeInfo)|| gfn_dsIsUpdated(ds_ItemList)|| gfn_dsIsUpdated(ds_CookMethod)|| gfn_dsIsUpdated(ds_Special)) {
			g_Message("EE", "변경된 내역이 있습니다.\n저장 후 사진을 첨부하시기 바랍니다.");
			return;
		}
		if( gfn_length(gfn_trim(ds_RecipeInfo.getColumn(0,"SPHOTO_PATH")))> 0 ) {
			g_Message("EE","이미지 정보를 삭제 하고 첨부하세요.");
			return;
		}
		if( FileDialog.Open() == false ) {
			return;
		}
		var v_filename = FileDialog.FileName;
		var v_filepath = FileDialog.FilePath;
		if( gfn_length(gfn_trim(v_filename))== 0 || gfn_trim(v_filename)== null ) {
			return;
		}
		var v_point_index = gfn_indexOf(v_filename,".");
		var v_ext = gfn_subStr(v_filename,v_point_index);
		var v_path = "FSR_STD_RECIPE_MST";
		var v_savenm = ds_RecipeInfo.getColumn(0,"RECIPE_CD")+v_ext;
		
		// 파일 서버로 전송 
		var arr = fsp_fileWrite(HttpFile, v_path, v_filepath, v_filename, v_savenm, "U");

		// 처리 결과 확인하기 
		if( arr[0] == "E" ) {
			g_Message("EE", "파일 업로드에 실패 하였습니다.");
			return;
		} else {
			ds_RecipeInfo.setColumn(0, "PHOTO_PATH",  v_filename);
			ds_RecipeInfo.setColumn(0, "SPHOTO_PATH", arr[2]    );
			fn_save();
			/******************************************************
			 *  서버에서 실제 이미지 경로 가져오기 
			 * @param  serverSaveDir  서버에 저장할 디렉토리 별명 
			 * @param  fileName  보여줄 파일명 ( 옵션 )
			 * @return  서버 전제 url 경로
			 ******************************************************/
			 img_Recipe.text = "";
			 img_Recipe.image = fsp_getServerDir(v_path,arr[2]);
		}
	}
}
/******************************************************************************************
 * 함  수  명   : btn_ImgDelete_OnClick(obj)
 * 기      능   : 이미지 삭제
 * 작  성  자   : 손창덕
 * 작성  일자   : 2008-01-15
 ******************************************************************************************
 */
 /******************************************************
 *  서버로 파일 삭제 처리 
 * @param  serverSaveDir  서버에 저장할 디렉토리 별명 
 * @param  serverFileName 서버의 파일명 
 * @param  isNeedRtn 처리 결과 (TRUE : 삭제 결과 확인시  FALSE:확인불필요
 * @return  필요시 처리 성공 여부 : true / 그외 false 
 ******************************************************/
function btn_ImgDelete_OnClick(obj:Button, e:ClickEventInfo)
{
	if( gfn_dsIsUpdated(ds_RecipeInfo)|| gfn_dsIsUpdated(ds_ItemList)|| gfn_dsIsUpdated(ds_CookMethod)|| gfn_dsIsUpdated(ds_Special)) {
		g_Message("EE", "변경된 내역이 있습니다.\n저장 후 사진을 삭제하시기 바랍니다.");
		return;
	}
	/* 레시피 사진 삭제 */
	fn_DeleteRecipePhoto(ds_RecipeInfo);
	
	/*if( fn_DeleteRecipePhoto(ds_RecipeInfo) ) {
		g_Message("01", "레시피 사진이 정상적으로 삭제 되었습니다.");
	} else {
		g_Message("EE", "레시피 사진이 삭제 중 오류가 발생하였습니다.");
	}*/
}
/******************************************************************************************
 * 함  수  명   : img_Recipe_OnLoadError(obj,nErrorCode,strErrorMsg)
 * 기      능   : 이미지 로드 실패
 * 작  성  자   : 손창덕
 * 작성  일자   : 2008-01-15
 ******************************************************************************************
 */
/* 지원하지 않는 이벤트입니다.*/
function img_Recipe_OnLoadError(obj,nErrorCode,strErrorMsg)
{
	img_Recipe.text="이미지 로드에\n\n실패했습니다.";
}
/******************************************************************************************
 * 함  수  명   : btn_RecipePop_OnClick(obj)
 * 기      능   : 레시피 중복체크
 * 작  성  자   : 손창덕
 * 작성  일자   : 2008-01-15
 ******************************************************************************************
 */
function btn_RecipePop_OnClick(obj:Button, e:ClickEventInfo)
{
	if( cbo_RecipeClass.value != "H" ) {
		g_Message("EE", "레시피분류가 HMR일 경우만 중복체크가 가능합니다.");
		cbo_RecipeClass.setFocus();
		return;
	}
	if( gfn_length(gfn_trim(ed_RecipeName.value))== 0 ) {
		g_Message("EE", "레시피명을 입력 후 중복체크를 하세요.");
		ed_RecipeName.setFocus();
		return;
	}
	
	fsp_clear(this);
	ds_RecipeValid.clearData();
	fsp_callService(this, "FSR00150E_ACT", "chkRecipeDuplication", "", "ds_RecipeValid=ds_RecipeValid", "RECIPE_NAME="+ed_RecipeName.value+" RECIPE_CLASS=H", "fn_CallBackValid", "", true);
}
/******************************************************************************************
 * 함  수  명   : ed_RecipeName_OnCharChanged(obj,strPreText,strPostText)
 * 기      능   : 레시피명 변경시 중복체크 활성화
 * 작  성  자   : 손창덕
 * 작성  일자   : 2008-01-15
 ******************************************************************************************
 */
function ed_RecipeName_OnCharChanged(obj:Edit, e:TextChangeEventInfo)
{
	f_CHK = "N";
	btn_RecipePop.visible = true;
}
/******************************************************************************************
 * 함  수  명   : btn_Ratio_OnClick(obj)
 * 기      능   : 레시피비율 일괄 변경
 * 작  성  자   : 손창덕
 * 작성  일자   : 2008-01-17
 ******************************************************************************************
 */
function btn_Ratio_OnClick(obj:Button, e:ClickEventInfo)
{
	if( ds_RecipeInfo.getRowCount() == 1 && ds_ItemList.getRowCount() > 0 ) {
		var v_NeedQty = 0;
		if( ed_Ratio.visible ) {
			ed_Ratio.visible = false;
			st_Ratio.visible = false;
			btn_Calc.visible = false;
			ed_Ratio.value = "";
		} else {
			ed_Ratio.visible = true;
			st_Ratio.visible = true;
			btn_Calc.visible = true;
			ed_Ratio.setFocus();
		}
	}
}
/******************************************************************************************
 * 함  수  명   : btn_AddItem_OnClick(obj)
 * 기      능   : 자재 추가 버튼 클릭 이벤트
 * 작  성  자   : 손창덕
 * 작성  일자   : 2008-04-30
 ******************************************************************************************
 */
function btn_AddItem_OnClick(obj:Button, e:ClickEventInfo)
{
	if( ds_RecipeInfo.getRowCount() !=0 ) {
		if( ds_ItemList.findRowExpr("gfn_length(gfn_trim(ITEM_CODE))==0 || gfn_trim(ITEM_CODE)==null") != -1 ) {
			return;
		}
		var nRow = ds_ItemList.addRow();
		ds_ItemList.setColumn(nRow, "RECIPE_CD", ds_RecipeInfo.getColumn(0,"RECIPE_CD"));
		// 자재 1 Row 생성시 자동 팝업 호출
		fn_grd_ItemList_OnCellClick(grd_ItemList, nRow, 3);
	}
}
/******************************************************************************************
 * 함  수  명   : btn_Calc_OnClick(obj)
 * 기      능   : 레시피비율일괄변경 반영
 * 작  성  자   : 손창덕
 * 작성  일자   : 2008-04-30
 ******************************************************************************************
 */
function btn_Calc_OnClick(obj:Button, e:ClickEventInfo)
{
	if( gfn_length(gfn_trim(ed_Ratio.value))!= 0 ) {
		for( var i=0; i<ds_ItemList.getRowCount(); i++ ) {
			v_NeedQty = Math.round((toNumber(ds_ItemList.getColumn(i, "NEED_QTY")) * toNumber(ed_Ratio.value))/100,2);
			ds_ItemList.setColumn(i, "NEED_QTY", v_NeedQty);
		}
	}
	ed_Ratio.value = "";
}
/******************************************************************************************
 * 함  수  명   : grd_ItemList_OnMouseOver(obj,nPosX,nPosY,nRow,nCell,nPivotIndex)
 * 기      능   : 금지자재의 경우 툴팁 보여주기
 * 작  성  자   : 손창덕
 * 작성  일자   : 2008-05-19
 ******************************************************************************************
 */
function grd_ItemList_OnMouseOver(obj:Grid, e:GridMouseEventInfo)
{
	if( e.row >= 0 ) {
		if( ds_ItemList.getColumn(e.row,"RESTRICT_YN") == "Y" ) {
			grd_ItemList.tooltiptext = " - 금지기간 : " + ds_ItemList.getColumn(e.row,"RESTRICT_START")+"~"+ds_ItemList.getColumn(e.row,"RESTRICT_END")+" \n - 금지사유 : "+ds_ItemList.getColumn(e.row,"RESTRICT_REASON") + " ";
		} else {
			grd_ItemList.tooltiptext="";
		}
	} else {
		grd_ItemList.tooltiptext="";
	}
}

function grd_ItemList_onheadclick(obj:Grid, e:GridClickEventInfo)
{
	switch(e.cell)
	{
		case 0:
			gfn_exportExcel(grd_List, "sheet1");
			break;
		default:
			gfn_gridSort(obj, e); //(eval(obj.binddataset), obj, e.cell);
			break;
	}
}
]]></Script>
  </Form>
</FDL>
