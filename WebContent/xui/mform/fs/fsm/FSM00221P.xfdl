<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="../../../default_typedef.xml"/>
  <Form id="form" onload="form_onload" titletext="코너일괄복사" position="absolute 0 0 796 339" scrollbars="none">
    <Layouts>
      <Layout>
        <Static id="Static09" position="absolute 230 98 781 329" style="background:#d2e9ffff;border:1 solid slategray ;"/>
        <Static id="Static04" class="sta_WFDA_Labelbg" position="absolute 15 40 781 67"/>
        <Grid scrollbars="alwaysvert" binddataset="ds_upjang_hall_corner" enable="true" fillareatype="allrow" id="grd_upjang_corner" useinputpanel="false" taborder="8" tabstop="true" usecontextmenu="true" useselcolor="true" visible="true" wheelscrollrow="1" position="absolute 15 98 220 329" readonly="true" selecttype="row" autofittype="col">
          <Formats>
            <Format id="Default">
              <Columns>
                <Column size="183"/>
              </Columns>
              <Rows>
                <Row size="22" band="head"/>
                <Row size="20"/>
              </Rows>
              <Band id="head">
                <Cell col="0" displaytype="text" text="코너명"/>
              </Band>
              <Band id="body">
                <Cell col="0" text="bind:CORNER_NAME" displaytype="text" style="align:left;"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Button id="btnCORNER_ALL_CHECK" onclick="btnCORNER_ALL_CHECK_OnClick" taborder="34" text="코너 전체 선택" position="absolute 617 71 716 93" class="btn_WF_Custom" image=""/>
        <Button id="btn_Copy" onclick="btn_Copy_OnClick" taborder="35" text="복사실행" position="absolute 718 71 781 93" class="btn_WF_Custom" image=""/>
        <Static id="st10" text="사업장" position="absolute 15 40 80 67" class="sta_WFDA_Label01" onclick="st10_onclick"/>
        <Edit enable="false" id="ed_UPJANG_NM" ontextchanged="ed_UPJANG_NM_OnChanged" onkeydown="ed_UPJANG_NM_OnKeyDown" readonly="true" taborder="36" tooltiptext="사업장" position="absolute 82 43 243 64"/>
        <Static id="Static2" text="식당명" position="absolute 245 40 310 67" class="sta_WFDA_Label01"/>
        <Calendar id="cal_START_DATE" taborder="40" tooltiptext="시작일" position="absolute 564 43 664 64" dateformat="yyyy-MM-dd" type="normal"/>
        <Calendar id="cal_END_DATE" taborder="41" tooltiptext="종료일" position="absolute 678 43 778 64" dateformat="yyyy-MM-dd" type="normal"/>
        <Static id="Static3" text="시작/종료일" position="absolute 471 40 562 67" class="sta_WFDA_Label01"/>
        <CheckBox id="chk0" taborder="23" value="false" visible="false" position="absolute 244 110 413 132" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk1" taborder="24" value="false" visible="false" position="absolute 420 110 589 132" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk2" taborder="25" value="false" visible="false" position="absolute 596 110 765 132" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk3" taborder="26" value="false" visible="false" position="absolute 244 141 413 163" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk4" taborder="27" value="false" visible="false" position="absolute 420 141 589 163" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk5" taborder="28" value="false" visible="false" position="absolute 596 141 765 163" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk6" taborder="29" value="false" visible="false" position="absolute 244 172 413 194" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk7" taborder="30" value="false" visible="false" position="absolute 420 172 589 194" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk8" taborder="31" value="false" visible="false" position="absolute 596 172 765 194" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk9" taborder="32" value="false" visible="false" position="absolute 244 203 413 225" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk10" taborder="33" value="false" visible="false" position="absolute 420 203 589 225" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk11" taborder="34" value="false" visible="false" position="absolute 596 203 765 225" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk12" taborder="35" value="false" visible="false" position="absolute 244 234 413 256" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk13" taborder="36" value="false" visible="false" position="absolute 420 234 589 256" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk14" taborder="36" value="false" visible="false" position="absolute 596 234 765 256" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk15" taborder="37" value="false" visible="false" position="absolute 244 265 413 287" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk16" taborder="38" value="false" visible="false" position="absolute 420 265 589 287" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk17" taborder="39" value="false" visible="false" position="absolute 596 265 765 287" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk18" taborder="40" value="false" visible="false" position="absolute 244 296 413 318" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk19" taborder="41" value="false" visible="false" position="absolute 420 296 589 318" onclick="fn_CheckboxClick"/>
        <CheckBox id="chk20" taborder="42" value="false" visible="false" position="absolute 596 296 765 318" onclick="fn_CheckboxClick"/>
        <Edit enable="false" id="ed_HALL_NAME" ontextchanged="ed_UPJANG_NM_OnChanged" onkeydown="ed_UPJANG_NM_OnKeyDown" readonly="true" taborder="43" tooltiptext="사업장" position="absolute 312 43 469 64"/>
        <CheckBox id="chk_OVER_WRITE" onclick="chk_OVER_WRITE_OnClick" taborder="44" text="대상 덮어쓰기" value="false" position="absolute 513 72 626 93" truevalue="1" falsevalue="0"/>
        <Edit enable="false" id="ed_COPY_OK" imemode="none" taborder="45" value="N" visible="false" position="absolute 470 71 487 92"/>
        <Static id="Static01" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 15 0 781 10"/>
        <Static id="Static05" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 0 15 329"/>
        <Button id="btn_close" taborder="47" text="닫기" onclick="fn_close" class="btn_WF_CRUD" anchor="default" position="absolute 677 10 722 35" positiontype="position"/>
        <Static id="Static02" text="w15" onclick="Static02_onclick" class="Guide01_AreaRed" visible="false" position="absolute 781 0 796 329"/>
        <Static id="Static21" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 329 796 339"/>
        <Static id="Static06" text="h05" class="Guide01_AreaRed" visible="false" position="absolute 15 35 781 40"/>
        <Button id="btn_help" taborder="48" text="도움말" onclick="common_onclick" class="btn_WF_CRUD" position2="absolute r:15 w:58 t:10 h:25" positiontype="position2"/>
        <Static id="Static22" text="복사 원본 코너 선택" onclick="Static22_onclick" class="sta_WF_Title01" position="absolute 15 80 247 111" anchor="left top"/>
        <Static id="Static16" text="h06" onclick="Static03_onclick" class="Guide01_AreaRed" visible="false" position="absolute 638 67 782 73" anchor="top right"/>
        <Static id="Static19" text="h05" class="Guide01_AreaRed" visible="false" position="absolute 15 93 781 98" anchor="top right"/>
        <Static id="Static17" text="h06" onclick="Static03_onclick" class="Guide01_AreaRed" visible="false" position="absolute 15 67 159 80" anchor="top right"/>
        <Static id="Static20" text="글자간격기준 w10" onclick="Static11_onclick" class="Guide01_AreaRed" visible="false" position="absolute 220 67 230 329"/>
        <Static id="Static23" text="복사 대상 코너 선택" onclick="Static22_onclick" class="sta_WF_Title01" position="absolute 230 80 462 95" anchor="left top"/>
        <Static id="Static39" text="~" position="absolute 658 44 685 64" style="align:center middle;"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_upjang_hall_corner">
        <ColumnInfo>
          <Column id="CORNER" size="256" type="STRING"/>
          <Column id="CORNER_NAME" size="256" type="STRING"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="CORNER"/>
            <Col id="CORNER_NAME"/>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_where">
        <ColumnInfo>
          <Column id="UPJANG" size="256" type="STRING"/>
          <Column id="HALL_CD" size="256" type="STRING"/>
          <Column id="START_DATE" size="256" type="STRING"/>
          <Column id="END_DATE" size="256" type="STRING"/>
          <Column id="CORNER" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Script type="xscript4.0"><![CDATA[include "U_lib::lib_conversionCom.xjs";
/*
 ******************************************************************************************
 * 시스템구분: IFIS/식단관리/식단등록(병원)
 * 프로그램명: FSM00221P.XML
 * 기ㅡㅡㅡ능: 식단등록(병원)-코너일괄복사
 * 작ㅡ성ㅡ자: 한화S&C 박종세
 * 작성ㅡ일자: 2008-05-13
 * ----------------------------------------------------------------------------------------
 * HISTORY    : 
 ******************************************************************************************
 */
//=========================================================================================
// [ PART 1 ]
// Form에서 Include 할 내용을 정의
//
//========================================================================================= 
//@@컨버터에서 주석처리 #include "lib::tit_comm_0001.js"
//@@컨버터에서 주석처리 #include "lib::sc_comon.js"
//@@컨버터에서 주석처리 #include "lib::fs_common.js"

//=========================================================================================
// [ PART 2 ]
// Form에서 사용될 전역변수를 선언
//
//=========================================================================================
/*
	<코너리스트 가져오기>
	UPJANG,	UPJANG_NM, HALL_CD, HALL_NAME, FROM_DT, TO_DT
	업장,   업장이름,   식당,    식당이름,   시작일 , 종료일

*/
// var fa_UPJANG="";
// var fa_UPJANG_NM="";
// var fa_HALL_CD="";
// var fa_HALL_NAME="";
// var fa_FROM_DT="";
// var fa_TO_DT="";

//=========================================================================================
// [ PART 3 ]
// Form Loading 시 작업 정의
//
//=========================================================================================
function form_onload(obj:Form, e:LoadEventInfo)
{
	gfn_formOnLoad(obj, false);

	   //폼 초기화
		fn_InitForm(obj);
}

//폼 초기화
function fn_InitForm(obj)
{
	// action 정보 생성 초기화 
	fsp_init(this);		
	
	// 폼 데이터 초기화
	fn_InitData(false);
}

// 폼데이터 초기화 
function fn_InitData(blnAllClear)
{
	/* 테스트코드   
	 var fa_UPJANG="100855";
	 var fa_UPJANG_NM="동국대강남";
	 var fa_HALL_CD="00701";
	 var fa_HALL_NAME="직원식당";
	 var fa_FROM_DT="20080101";
	 var fa_TO_DT="20080107";
   */
  
	 ed_UPJANG_NM.userdata  = fa_UPJANG;	 
	 ed_UPJANG_NM.value      = fa_UPJANG_NM;
	 ed_HALL_NAME.userdata  = fa_HALL_CD;
	 ed_HALL_NAME.value      = fa_HALL_NAME;
	 cal_START_DATE.value   = fa_FROM_DT;
	 cal_END_DATE.value     = fa_TO_DT;
	 
	 //초기화 콜백함수 호출
	 fn_After_InitData();
	 
}

//초기화 콜백함수
function fn_After_InitData()
{
	 //데이터 조회
	 fn_search();	
}

//=========================================================================================
// [ PART 4 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,도움말,form닫기)
//
//=========================================================================================
/*------------------------------------------------------------
	1. Function ID : fn_Search()
	2. 개       요 : 업무프로세스에 따른 조회작업
	3. 기       능 : 검색버튼 입력 시 처리되는 작업
	4. 인 수 설 명:
*------------------------------------------------------------*/
function fn_search()
{
	  //필수 입력사항 체크-----------------------------------------------------------------------
	  if (!fn_Chk_SearchKey()) return false;
	
	  //조회 조건만들기-----------------------------------------------------------------------
	   var otherArg;
	   otherArg		= otherArg + " UPJANG="+wrapQuote(ed_UPJANG_NM.userdata);
	   otherArg		= otherArg + " HALL_CD="+wrapQuote(ed_HALL_NAME.userdata);
	   otherArg		= otherArg + " START_DATE="+wrapQuote(cal_START_DATE.value);
	   otherArg		= otherArg + " END_DATE="+wrapQuote(cal_END_DATE.value);
	
	  // action 정보 삭제 초기화 
	  fsp_clear(this);
		
	  // 서버에서 조회할 정보 추가 
	  fsp_addSearch(this, "fs/fsc:FSC_UPJANG_HALL_CORNER_S001");

	  // 서버 호출 
	  //http.sync = true;
	  fsp_callService(this, "", "", "", "ds_upjang_hall_corner=ds_upjang_hall_corner" , otherArg, "fn_After_Search");	
	  //조회 실행-----------------------------------------------------------------------------
	  //http.sync = false;
}

// 조회 후 콜백 함수 
function fn_After_Search(errCode, errMsg)
{
   if (errCode != 0)
	{
		g_Message("EE", errMsg);
		return;
	}
	
   // 데이터셋 플래그 클리어
   ds_upjang_hall_corner.applyChange();
   
   // 코너 콤보박스 만들기
   fn_MakeCheckbox();
}

// 조회 조건 검색
function fn_Chk_SearchKey()
{
   //체크로직- 틀리면 return false;  
   //업장
   if(!mfn_Chk_Obj_MustInput(ed_UPJANG_NM)) return false;   
   //업장식당
   if(!mfn_Chk_Obj_MustInput(ed_HALL_NAME)) return false;
   //시작날짜
   if(!mfn_Chk_Obj_MustInput(cal_START_DATE)) return false;
   //종료날짜
   if(!mfn_Chk_Obj_MustInput(cal_END_DATE)) return false;
   
   return true;
}



/*------------------------------------------------------------
	1. Function ID : fn_Save()
	2. 개       요 : 업무프로세스에 따른 정보 저장작업
	3. 기       능 : 저장버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*------------------------------------------------------------*/
function fn_save()
{
 	// 데이터 유효성 검사
	 if (!fn_DataValidation()){	return false; }
	
	  //선택된 코너 리스트 만들기 
	  var TARGET_CORNER_LIST = "";
	  var rowCnt_HALL_CORNER=ds_upjang_hall_corner.rowcount;			

	  //현재 선택된 복사 원본 코너
      var SOURCE_CORNER = ds_upjang_hall_corner.getColumn(ds_upjang_hall_corner.rowposition,"CORNER");
  	  
	  for(var i=0;i<rowCnt_HALL_CORNER;i++)
	  {
		 var chkObj = eval("chk"+i);
		 if (chkObj.value)
		 {
		    //선택된 값과 복사원본 코너가 같다면 JUMP 
			if(SOURCE_CORNER==chkObj.userdata){continue;}
			
		 	TARGET_CORNER_LIST+=chkObj.userdata + ",";		
		 }
	  }
	  
	 
	 //-------------------------------------------------------
	 //--- 코너가 선택되었는지 확인합니다.
	 //------------------------------------------------------
	 if(gfn_length(TARGET_CORNER_LIST)==0)
	 { 
	    gfn_alert("[필수선택] 변경하시려는 ::코너::를 선택해야 합니다.");
	    return false;
	 }
	 
	 //-------------------------------------------------------
	 //--- 코너 복사를 실행할 지 확인합니다.
	 //------------------------------------------------------
	var vRtn=g_Confirm("04","코너 복사를 실행하시겠습니까?\n원본코너["+SOURCE_CORNER+"] 대상코너["+TARGET_CORNER_LIST+"]");
    if(vRtn==false) {return false;}
	  
	  
	  //조회 조건만들기-----------------------------------------------------------------------
	   var otherArg;
	   otherArg		= otherArg + " UPJANG="+wrapQuote(ed_UPJANG_NM.userdata);
	   otherArg		= otherArg + " HALL_CD="+wrapQuote(ed_HALL_NAME.userdata);
	   otherArg		= otherArg + " SOURCE_CORNER="+wrapQuote(SOURCE_CORNER);
	   otherArg		= otherArg + " TARGET_CORNER_LIST="+wrapQuote(TARGET_CORNER_LIST);
	   otherArg		= otherArg + " START_DATE="+wrapQuote(cal_START_DATE.value);
	   otherArg		= otherArg + " END_DATE="+wrapQuote(cal_END_DATE.value);
	   otherArg		= otherArg + " OVER_WRITE="+wrapQuote(chk_OVER_WRITE.value);
	  
  
   	 // action 정보 초기화 
	  fsp_clear(this);
	 // 트랜잭션 시작
	  var InDS=""; InDS="";
	  Transaction("FSM00221P_T001","U_svc::" + "fs/fsm/FSM00221P_T001.jsp", InDS, "", otherArg, "fn_After_Save");	
	 // 트랜잭션 종료 
}

//저장 후 콜백 함수 
function fn_After_Save(strSvcID, errCode, errMsg)
{

	if (errCode != 0)
	{
		g_Message("EE", errMsg);
		return;
	}
	
	//복사를 했을 경우에만 메인창을 다시 조회한다.
	ed_COPY_OK.value="Y";
	g_Message("02","");
}

//데이터 유효성검사
function fn_DataValidation()
{
   //체크로직- 틀리면 return false;  
   //업장
   if(!mfn_Chk_Obj_MustInput(ed_UPJANG_NM)) return false;   
   //업장식당
   if(!mfn_Chk_Obj_MustInput(ed_HALL_NAME)) return false;
   //시작날짜
   if(!mfn_Chk_Obj_MustInput(cal_START_DATE)) return false;
   //종료날짜
   if(!mfn_Chk_Obj_MustInput(cal_END_DATE)) return false;
  
   return true;;
}


/*------------------------------------------------------------
	1. Function ID : fn_Close()
	2. 개       요 : 업무프로세스에 따른 폼 종료 
	3. 기       능 : 닫기버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*------------------------------------------------------------*/
function fn_close()
{
	this.close(ed_COPY_OK.value);
}

//=========================================================================================
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
//
//=========================================================================================

//=========================================================================================
// [ PART 6 ]
// component Event 정의 ( User Define function )
// --> component Event의 기요,기능,동작 등 상세내용은 MiPlatform 메뉴얼을 참조하시기 바랍니다.
//=========================================================================================
function fn_MakeCheckbox()
{
	//-------------------------------------------------------
	// 공통코드 데이터셋 - FS0001 레시피 분류 ds_upjang_hall_corner
	//-------------------------------------------------------
	if(ds_upjang_hall_corner.rowcount<=0) {return false;}
	
	var rowCnt=ds_upjang_hall_corner.rowcount;
			
	for(var i=0;i<rowCnt;i++)
	{
		var chkObj = eval("chk"+i);
		chkObj.text     =  ds_upjang_hall_corner.getColumn(i, "CORNER_NAME"); //체크박스 명을 레시피명 
	    chkObj.userdata =  ds_upjang_hall_corner.getColumn(i, "CORNER");	     //체크박스 사용자데이터를 레시피코드 
	}
	
	
	//0부터시작 
	var v_temp=0;
	
	while(v_temp<rowCnt)
	{	
		var chkObj = eval("chk"+v_temp);
		chkObj.enable=true;
		chkObj.visible=true;
		v_temp++;
	}
}

//체크박스 클릭 이벤트
function fn_CheckboxClick(obj)
{
	if(obj.value)
	{
		obj.style.background.color="#FFFFBB";
	}
	else
	{
		obj.style.background.color="-1";
	}
	
}


//코너 전체 선택
var chkFlag = 0;
function btnCORNER_ALL_CHECK_OnClick(obj:Button, e:ClickEventInfo)
{
	if(ds_upjang_hall_corner.rowcount<=0) {return false;}
	
	var rowCnt=ds_upjang_hall_corner.rowcount;

	if(chkFlag == 0) 
	{
		for(var i=0;i<rowCnt;i++)
		{
			var chkObj = eval("chk"+i);
			chkObj.value = true;
			fn_CheckboxClick(chkObj); 
		}
		chkFlag = 1;
	}
	else
	{
		for(var i=0;i<rowCnt;i++)
		{
			var chkObj = eval("chk"+i);
			chkObj.value = false;
			fn_CheckboxClick(chkObj); 
		}
		chkFlag = 0;
	}
}


//코너 복사 실행
function btn_Copy_OnClick(obj:Button, e:ClickEventInfo)
{
	fn_save();
}


//닫기, 도움말 버튼 클릭시 이벤트
function fn_commBtn_OnClick(obj:Button, e:ClickEventInfo)
{
    var fncName = "fn_";
    fncName += gfn_subStr(obj.name, 4);
    eval( fncName + "()");	
}


//대상 덮어쓰기 옵션 선택시....
function chk_OVER_WRITE_OnClick(obj:CheckBox, e:ClickEventInfo)
{
	//체크박스 워닝(경고) 표시 공통함수...... 
	mfn_chk_display_warning(obj, obj.isChecked(), "1", "대상을 덮어쓰기를 선택하시면\n기존데이터는 삭제됩니다.");
}

 ]]></Script>
  </Form>
</FDL>
