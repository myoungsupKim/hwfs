<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="../../../default_typedef.xml"/>
  <Form id="form" onload="form_onload" titletext="일식단주기식식단복사" position="absolute 0 0 710 449" scrollbars="none">
    <Layouts>
      <Layout>
        <Static id="sta_detail04" onclick="sta_detail05_onclick" class="sta_WFDA_Labelbg" position="absolute 10 279 700 408"/>
        <Static id="sta_detail01" onclick="sta_detail05_onclick" class="sta_WFDA_Labelbg" position="absolute 10 128 700 155"/>
        <MaskEdit id="me_Month2" mask="####-##" onsetfocus="g_Date_OnFocus" onkillfocus="g_Month_OnKillFocus" taborder="23" tabstop="false" tooltiptext="주기식단등록월" type="string" position="absolute 165 131 239 152" style="align:center middle;" canchange="me_Month2_OnCharChanged" oneditclick="me_Month2_oneditclick"/>
        <Button id="btn_MONTH2" taborder="24" tabstop="false" userdata="me_Month2" position="absolute 238 131 258 152" class="btn_WF_popSearch" text="" image="" onclick="btn_MONTH2_onclick"/>
        <Static id="Static16" text="주기식단정보" position="absolute 292 128 423 155" class="sta_WFDA_Label01"/>
        <Static id="Static13" text="주기식단월" position="absolute 10 128 163 155" class="sta_WFDA_Label01"/>
        <Edit enable="false" id="ed_MENU_CYCLE2" taborder="27" tabstop="false" tooltiptext="주기식단월" position="absolute 425 131 473 152" style="align:center;"/>
        <Edit enable="false" id="ed_MENU_CYCLE_NAME2" readonly="true" taborder="28" tabstop="false" position="absolute 475 131 521 152" style="align:center;"/>
        <Combo codecolumn="CODE" datacolumn="CODE_NAME" id="cbo_START_DATE" imemode="none" innerdataset="ds_DAY1" onitemchanged="cbo_START_DATE_OnChanged" taborder="29" tooltiptext="복사대상주기시작일차" position="absolute 522 131 602 152"/>
        <Combo codecolumn="CODE" datacolumn="CODE_NAME" enable="false" id="cbo_END_DATE" innerdataset="ds_DAY2" taborder="30" tooltiptext="복사대상주기종료일차" position="absolute 620 131 691 152"/>
        <Static id="Static21" text="☞ 주기식단을 등록하려면 해당 월에 식수인원 예측이 되어 있어야 합니다." position="absolute 24 319 636 335" style="color:red;"/>
        <Static id="Static18" text="※ 주의사항 ※" position="absolute 24 297 116 317" style="color:red;font:Gulim,9,bold;"/>
        <Static id="Static2" text="☞ 일식단[실재식단]의 선택일수가 주기식 일자 보다 큰 경우 처음날을 기준으로 주기일수에 맞게 복사됩니다." position="absolute 24 339 636 355" style="color:red;"/>
        <Calendar enable="false" id="cal_TARGET_START_DATE" taborder="37" tabstop="false" tooltiptext="복사대상 시작일" visible="false" position="absolute 520 101 606 123" dateformat="yyyy-MM-dd" type="normal"/>
        <Calendar enable="false" id="cal_TARGET_END_DATE" taborder="36" tabstop="false" tooltiptext="복사대상 종료일" visible="false" position="absolute 611 101 697 123" dateformat="yyyy-MM-dd" type="normal" oneditclick="cal_TARGET_END_DATE_oneditclick"/>
        <Static id="Static20" text="☞ 주기식단이 등록되어 있을 경우 식단복사를 하면 기존 식단은 삭제되며 복사된 식단으로 덮어씁니다." position="absolute 24 362 636 378" style="color:red;"/>
        <Static id="Static7" text="~" position="absolute 606 139 615 144"/>
        <Static id="sta_detail05" onclick="sta_detail05_onclick" class="sta_WFDA_Labelbg" position="absolute 10 10 700 37"/>
        <Static id="sta_detail00" onclick="sta_detail05_onclick" class="sta_WFDA_Labelbg" position="absolute 10 69 700 96"/>
        <Calendar id="cal_SOURCE_START_DATE" taborder="38" tabstop="false" dateformat="yyyy-MM-dd" onchanged="cal_SOURCE_START_DATE_OnChanged" oneditclick="cal_SOURCE_START_DATE_oneditclick" position="absolute 165 72 260 93" tooltiptext="복사원본 시작일"/>
        <Calendar id="cal_SOURCE_END_DATE" taborder="39" tabstop="false" dateformat="yyyy-MM-dd" onchanged="cal_SOURCE_END_DATE_OnChanged" position="absolute 262 72 357 93" tooltiptext="복사원본 종료일"/>
        <Static id="Static15" text="복사원본 시작일/종료일" class="sta_WFDA_Label01" position="absolute 10 69 163 96"/>
        <Edit id="ed_SOURCE_DAYS" taborder="40" enable="false" visible="true" position="absolute 359 72 398 93" style="align:center;"/>
        <Static id="Static4" text="식당명" class="sta_WFDA_Label01" position="absolute 356 10 494 37"/>
        <Combo id="cbo_upjang_hall" taborder="41" innerdataset="ds_upjang_hall" codecolumn="HALL_CD" datacolumn="HALL_NAME" onitemchanged="cbo_upjang_hall_OnChanged" position="absolute 496 13 674 34" tooltiptext="식당명"/>
        <Edit id="ed_UPJANG_NM" taborder="42" readonly="true" onkeydown="ed_UPJANG_NM_OnKeyDown" ontextchanged="ed_UPJANG_NM_OnChanged" enable="false" position="absolute 150 13 306 34" tooltiptext="사업장"/>
        <Button id="btn_UPJANG" taborder="43" tabstop="false" onclick="btn_UPJANG_OnClick" class="btn_WF_popSearch" enable="false" position="absolute 305 13 327 34"/>
        <Static id="st10" text="사 업 장" class="sta_WFDA_Label01" position="absolute 10 10 148 37"/>
        <Static id="Static01" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 0 856 10"/>
        <Static id="Static24" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 8 37 864 50"/>
        <Static id="Static31" text="복사원본 일식단" onclick="Static22_onclick" class="sta_WF_Title01" position="absolute 10 50 338 81" anchor="left top"/>
        <Static id="Static25" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 10 96 866 109"/>
        <Static id="Static23" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 8 64 864 69"/>
        <Static id="Static05" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 0 10 525"/>
        <Static id="Static03" text="w15" onclick="Static02_onclick" class="Guide01_AreaRed" visible="false" position="absolute 700 0 710 525"/>
        <Static id="Static07" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 439 856 449"/>
        <Calendar id="cal_TARGET_END_DATE00" taborder="44" tabstop="false" dateformat="yyyy-MM-dd" oneditclick="cal_TARGET_END_DATE_oneditclick" enable="false" position="absolute 254 99 338 120" tooltiptext="복사대상 종료일" visible="false"/>
        <Static id="Static22" text="복사대상 주기식단" onclick="Static22_onclick" class="sta_WF_Title01" position="absolute 10 109 338 140" anchor="left top"/>
        <Static id="sta_detail02" onclick="sta_detail05_onclick" class="sta_WFDA_Labelbg" position="absolute 10 178 700 205"/>
        <Static id="Static10" text="코 너" class="sta_WFDA_Label01" position="absolute 247 178 325 205"/>
        <Combo id="cbo_upjang_hall_corner" taborder="45" tabstop="false" innerdataset="ds_upjang_hall_corner" codecolumn="CORNER" datacolumn="CORNER_NAME" onitemchanged="cbo_upjang_hall_corner_OnChanged" position="absolute 327 181 471 202"/>
        <Static id="Static0" text="끼 니" class="sta_WFDA_Label01" position="absolute 480 178 558 205"/>
        <Combo id="cbo_upjang_hall_meal" taborder="46" tabstop="false" innerdataset="ds_upjang_hall_meal" codecolumn="MEAL" datacolumn="MEAL_NAME" onitemchanged="cbo_upjang_hall_meal_OnChanged" position="absolute 559 181 655 202"/>
        <Static id="Static1" text="식단전체" class="sta_WFDA_Label01" position="absolute 10 178 88 205"/>
        <CheckBox id="chk_ALL" taborder="47" tabstop="false" text="식단전체를 복사합니다." value="true" onclick="chk_ALL_OnClick" position="absolute 95 182 242 203" truevalue="1" falsevalue="0"/>
        <Static id="sta_detail06" onclick="sta_detail05_onclick" class="sta_WFDA_Labelbg" position="absolute 10 237 700 264"/>
        <Static id="Static06" text=" ▶ 복사를 실행하시기 전 주의사항을 읽어주세요." class="sta_WFDA_Label01" position="absolute 10 237 700 264" style="font:Gulim,9,bold;"/>
        <Button id="btn_MENU_COPY" onclick="btn_MENU_COPY_OnClick" taborder="1" tabstop="false" text="일식단▶주기식단 식단복사 실행" position="absolute 517 239 700 262" class="btn_WF_Custom" image=""/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_input_V4">
        <ColumnInfo>
          <Column id="UPJANG" size="256" type="STRING"/>
          <Column id="UPJANG_NM" size="256" type="STRING"/>
          <Column id="HALL_CD" size="256" type="STRING"/>
          <Column id="HALL_NAME" size="256" type="STRING"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="HALL_CD"/>
            <Col id="HALL_NAME"/>
            <Col id="UPJANG"/>
            <Col id="UPJANG_NM"/>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_upjang_hall_V4"/>
      <Dataset id="ds_upjang_hall_corner_V4">
        <ColumnInfo>
          <Column id="CORNER" size="256" type="STRING"/>
          <Column id="CORNER_NAME" size="256" type="STRING"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="CORNER"/>
            <Col id="CORNER_NAME"/>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_upjang_hall_meal_V4">
        <ColumnInfo>
          <Column id="MEAL" size="256" type="STRING"/>
          <Column id="MEAL_NAME" size="256" type="STRING"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="MEAL"/>
            <Col id="MEAL_NAME"/>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_DAY1">
        <ColumnInfo>
          <Column id="CODE" size="256" type="STRING"/>
          <Column id="CODE_NAME" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_DAY2">
        <ColumnInfo>
          <Column id="CODE" size="256" type="STRING"/>
          <Column id="CODE_NAME" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Bind>
      <BindItem id="item5" compid="sta_detail05" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item0" compid="sta_detail00" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="cbo_upjang_hall_value" compid="cbo_upjang_hall" propid="value" datasetid="ds_input" columnid="HALL_CD"/>
      <BindItem id="ed_UPJANG_NM_value" compid="ed_UPJANG_NM" propid="value" datasetid="ds_input" columnid="UPJANG_NM"/>
      <BindItem id="item4" compid="sta_detail04" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item1" compid="sta_detail01" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item2" compid="sta_detail02" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item6" compid="sta_detail06" propid="text" datasetid="ds_view" columnid="D_1"/>
    </Bind>
    <Script type="xscript4.0"><![CDATA[include "U_lib::lib_conversionCom.xjs";
/*
 ******************************************************************************************
 * 시스템구분: IFIS/식단관리/식단등록(병원)
 * 프로그램명: FSM00221E.XML
 * 기ㅡㅡㅡ능: 식단등록(병원)-일식단주기식식단복사
 * 작ㅡ성ㅡ자: 한화S&C 박종세
 * 작성ㅡ일자: 2008-05-13
 * ----------------------------------------------------------------------------------------
 * HISTORY    : 
 ******************************************************************************************
 */
 
//=========================================================================================
// [ PART 1 ]
// Form에서 Include 할 내용을 정의
//
//========================================================================================= 
//@@컨버터에서 주석처리 #include "lib::tit_comm_0001.js"
//@@컨버터에서 주석처리 #include "LIB::lib_comm_0001.js"
//@@컨버터에서 주석처리 #include "lib::sc_comon.js"
//@@컨버터에서 주석처리 #include "lib::sc_sql_common.js"		// 사업장팝업용 Lib
//@@컨버터에서 주석처리 #include "lib::fs_common.js"

//=========================================================================================
// [ PART 2 ]
// Form에서 사용될 전역변수를 선언
//
//=========================================================================================
//=========================================================================================
// [ PART 3 ]
// Form Loading 시 작업 정의
//
//=========================================================================================
function form_onload(obj:Form, e:LoadEventInfo)
{
	gfn_formOnLoad(obj, false);

	   //폼 초기화
		fn_InitForm(obj);
}

//폼 초기화
function fn_InitForm(obj)
{
	// action 정보 생성 초기화 
	fsp_init(this);			
	// 폼 데이터 초기화
	fn_InitData(false);
}

// 폼데이터 초기화 
function fn_InitData(blnAllClear)
{
	cbo_upjang_hall_corner.index = 0;
	cbo_upjang_hall_meal.index = 0;
}

//초기화 콜백함수
function fn_After_InitData()
{	
}

//=========================================================================================
// [ PART 4 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,도움말,form닫기)
//
//=========================================================================================

/*------------------------------------------------------------
	1. Function ID : fn_Close()
	2. 개       요 : 업무프로세스에 따른 폼 종료 
	3. 기       능 : 닫기버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*------------------------------------------------------------*/
function fn_Close()
{
	this.close();
}

/*------------------------------------------------------------
	1. Function ID : fn_Help()
	2. 개       요 : 업무프로세스에 따른 도움말 
	3. 기       능 : 도움말버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*------------------------------------------------------------*/
function fn_help()
{
}

//=========================================================================================
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
//
//=========================================================================================

//=========================================================================================
// [ PART 6 ]
// component Event 정의 ( User Define function )
// --> component Event의 기요,기능,동작 등 상세내용은 MiPlatform 메뉴얼을 참조하시기 바랍니다.
//=========================================================================================

/*
 ******************************************************************************************
 * 함  수  명   : btn_UPJANG_OnClick(obj)
 * 기      능   : 팝업버튼 클릭 -> 사업장 조회
 * 작  성  자   : 박종세
 * 작성  일자   : 2007-01-16  
 ******************************************************************************************
 */
function btn_UPJANG_OnClick(obj:Button, e:ClickEventInfo)
{	
	fn_sql_common_setup(strMAQuery_Upjang, 
						strMAQuery_UpjangKeyField, 
						strMAQuery_UpjangValueField, 
						strMAQuery_UpjangKeyFieldNM, 
						strMAQuery_UpjangValueFieldNM, 
						"", 
						"",
						"",   // 팀 비교
						strMAQuery_UpjangCaption);
		
    if (gds_sql_common.getColumn(0, "ret_code") != "")
    {
		ds_input.setColumn(0,"UPJANG",gds_sql_common.getColumn(0, "ret_code"));
		ds_input.setColumn(0,"UPJANG_NM",gds_sql_common.getColumn(0, "ret_name"));

		//업장 식당조회
		fn_Upjang_HallSearch();
		//업장식당으로 Focus
		cbo_upjang_hall.setFocus();
    }
    else
    {
    	ds_input.setColumn(0,"UPJANG","");
		ds_input.setColumn(0,"UPJANG_NM","");
		ds_upjang_hall.filter("");
    }
}
function ed_UPJANG_NM_OnKeyDown(obj:Edit, e:KeyEventInfo)
{
	if(e.keycode == "13") {
		btn_UPJANG.click();
		return;
	}
	
}
function ed_UPJANG_NM_OnChanged(obj:Edit, e:TextChangedEventInfo)
{
	fn_Upjang_HallSearch();
}

/*
 ******************************************************************************************
 * 함  수  명   : fn_Upjang_HallSearch()
 * 입      력   : 
 * 반      환   : 없음
 * 기      능   : 식당 정보를 콤보에 연결
 * 작  성  자   : 박종세
 * 작성  일자   : 2007-12-20 
 ******************************************************************************************
 */
function fn_Upjang_HallSearch()
{
	// 식당 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	
	inData			= "";
	outData			= "ds_upjang_hall=gds_Csqlout";
	callBackFnc		= "fn_Upjang_HallSearch_After";
	otherArg		= "UPJANG="+wrapQuote(ds_input.getColumn(0,"UPJANG"));

	fsp_clear(this); 
    fsp_addSearch(this, "fs/fsc:FSA_HALL_MST_S001");								// 조회 
	http.Sync = true;
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);		// 서비스 호출 
	http.Sync = false;
}

// 식당조회 후 
function fn_Upjang_HallSearch_After(errCode, errMsg)
{
    
	if(errCode!=0)
	{	g_Message("EE",	"서비스 오류:시스템 관리자에게 문의하십시오");
		return;
	}
	
	
	////////////////////////////////////////////	
	//메뉴사이클이 지정된 식당만 조회한다.
	ds_upjang_hall.filter("gfn_length(MENU_CYCLE)>0");
	/////////////////////////////////////////////
	// 초기값 셋팅
	cbo_upjang_hall.index = 0;
	
	//코너 값 셋팅
	fn_Upjang_Hall_CornerSearch();
}


////////////////////식당 변경시 이벤트///////////////////////
function cbo_upjang_hall_OnChanged(obj:Combo, e:ItemChangeEventInfo)
{	
	//식당의 코너 값 셋팅
	fn_Upjang_Hall_CornerSearch();
	
	//식당의 주기를 다시 가져온다.
	parent.parent.opener.ed_MENU_CYCLE.value = ds_upjang_hall.getColumn(e.postindex,"MENU_CYCLE");
		
	//메뉴사이클로 시작일 종료일 셋팅
	parent.parent.opener.fn_MENU_CYCLE_to_DAYS(parent.parent.opener.ed_MENU_CYCLE.value);	
}




/*
 ******************************************************************************************
 * 함  수  명   : fn_Upjang_Hall_CornerSearch()
 * 기      능   : 업장의 코너 조회
 * 작  성  자   : 박종세
 * 작성  일자   : 2007-12-20 
 ******************************************************************************************
 */

//코너 정의
function fn_Upjang_Hall_CornerSearch()
{
	// 식당 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	
	inData			= "";
	outData			= "ds_upjang_hall_corner=ds_upjang_hall_corner";
	callBackFnc		= "";
	otherArg		= "UPJANG="+wrapQuote(gfn_trim(ds_input.getColumn(0,"UPJANG")));
	otherArg		= otherArg + " HALL_CD="+wrapQuote(gfn_trim(cbo_upjang_hall.value));
	otherArg		= otherArg + " BLANK='A'";
	
	fsp_clear(this); 
    fsp_addSearch(this, "fs/fsc:FSC_UPJANG_HALL_CORNER_S001");								// 조회 
	http.Sync = true;
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);		// 서비스 호출 
	http.Sync = false;
	
	// 초기값 셋팅
	cbo_upjang_hall_corner.index = 0;
		
	//끼니셋팅
	fn_Upjang_Hall_MealSearch();
}


///////////////////////코너변경할때//////////////////////////
function cbo_upjang_hall_corner_OnChanged(obj:Combo, e:ItemChangeEventInfo)
{
    //전체선택일때
    if(gfn_length(e.postvalue)!=0)
    {chk_ALL.value=0;}
    else
    {
     //끼니가 전체이면 전체선택으로 변경
     if(gfn_length(cbo_upjang_hall_meal.value)==0)
       {chk_ALL.value=1;}
	}
	
	
	//////////////////////////////
	//복사대상 코너값 셋팅
	//////////////////////////////
	//cbo_upjang_hall_corner2.index=e.postindex;
	
	
	
    //식당의 끼니값 셋팅
	fn_Upjang_Hall_MealSearch();
	
}


//끼니 정의
function fn_Upjang_Hall_MealSearch()
{
	// 식당 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	
	inData			= "";
	outData			= "ds_upjang_hall_meal=ds_upjang_hall_meal";
	callBackFnc		= "";
	otherArg		= "UPJANG="+wrapQuote(ds_input.getColumn(0,"UPJANG"));
	otherArg		= otherArg + " HALL_CD="+wrapQuote(gfn_trim(cbo_upjang_hall.value));
	otherArg		= otherArg + " CORNER="+wrapQuote(gfn_trim(cbo_upjang_hall_corner.value));
	otherArg		= otherArg + " BLANK='A'";
	
	fsp_clear(this); 
    fsp_addSearch(this, "fs/fsc:FSC_UPJANG_HALL_MEAL_S001");						// 조회 
	http.Sync = true;
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);		// 서비스 호출 
	http.Sync = false;
	
	// 끼니 초기값 셋팅 ==>> 복사대상도 마찬가지로 설정.
	cbo_upjang_hall_meal.index  = 0;
	//cbo_upjang_hall_meal2.index = 0;
	
}

//끼니변경시
function cbo_upjang_hall_meal_OnChanged(obj:Combo, e:ItemChangeEventInfo)
{
	//전체선택일때
    if(gfn_length(e.postvalue)<>0)
    {chk_ALL.value=0;}
    else
    {
     //끼니가 전체이면 전체선택으로 변경
     if(gfn_length(cbo_upjang_hall_corner.value)==0){chk_ALL.value=1;}
	}
	
	//////////////////////////////
	//복사대상 끼니값 셋팅
	//////////////////////////////
	//cbo_upjang_hall_meal2.index=e.postindex;
}



///////////////////////////
//전체 ===> 체크버튼 체크시
///////////////////////////
function chk_ALL_OnClick(obj:CheckBox, e:ClickEventInfo)
{
	if(obj.isChecked()==1)
	{
		cbo_upjang_hall_corner.value="";
		cbo_upjang_hall_meal.value="";
		
	}
}

///////////////////////////
//건너뛰기===> 체크버튼 체크시
///////////////////////////
function chk_SKIP_OnClick(obj,strValue)
{
	//체크박스 워닝(경고) 표시 공통함수(체크오브젝트, 현재값, 경고값, 경고메세지)
	mfn_chk_display_warning(obj, strValue, "0", "체크를 하지 않으면 \n실제 식단이 등록되어있을 경우\n실제 식단을 삭제하고 덮어씁니다.");
}




//////////////////////////////
//////////////////////////////
//식단을 복사합니다.
/////////////////////////////

function btn_MENU_COPY_OnClick(obj:Button, e:ClickEventInfo)
{
    
	if(!fn_Chk_Copy()){return false;}
	
	
	
	var v_rtn;
	v_rtn = g_Confirm("02", " *복사원본 시작/종료일:" + cal_SOURCE_START_DATE.value +"~"+ cal_SOURCE_END_DATE.value + "\n"
		                  + " *코너:" + ds_upjang_hall_corner.getColumn(cbo_upjang_hall_corner.index,"CORNER_NAME") 
		                  + " *끼니:" + ds_upjang_hall_meal.getColumn(cbo_upjang_hall_meal.index,"MEAL_NAME") 
		                  + "\n\n실재식단을 주식식단으로 복사하시겠습니까?");
	
	if(!v_rtn){return false;}
	
	
	
	otherArg		= "UPJANG="+wrapQuote(ds_input.getColumn(0,"UPJANG"));
	otherArg		= otherArg + " HALL_CD="+wrapQuote(gfn_trim(cbo_upjang_hall.value));
	otherArg		= otherArg + " SOURCE_CORNER="+wrapQuote(gfn_trim(cbo_upjang_hall_corner.value));
	otherArg		= otherArg + " SOURCE_MEAL="+wrapQuote(gfn_trim(cbo_upjang_hall_meal.value));
	otherArg		= otherArg + " SOURCE_START_DATE="+wrapQuote(gfn_trim(cal_SOURCE_START_DATE.value));
    
    
    //타겟 시작일 종료일 구하기
    cal_TARGET_START_DATE.value = me_Month2.value + iif(gfn_length(cbo_START_DATE.value)>1,cbo_START_DATE.value,gfn_lPad(cbo_START_DATE.value,"0",2));
    cal_TARGET_END_DATE.value = me_Month2.value + iif(gfn_length(cbo_END_DATE.value)>1,cbo_END_DATE.value,gfn_lPad(cbo_END_DATE.value,"0",2));
  
    //날짜 차이값 구하기 ==>> 소소의 날짜 차이값도 타켓과 동일하게 가져간다.
    var v_SOURCE_DAYS = G_fn_CalcDay(gfn_trim(cal_TARGET_START_DATE.value), gfn_trim(cal_TARGET_END_DATE.value))+1;
    otherArg		= otherArg + " SOURCE_DAYS="+wrapQuote(v_SOURCE_DAYS);
		
	otherArg		= otherArg + " TARGET_START_DATE="+wrapQuote(gfn_trim(cal_TARGET_START_DATE.value));
	otherArg		= otherArg + " TARGET_END_DATE="+wrapQuote(gfn_trim(cal_TARGET_END_DATE.value));

	var v_TARGET_DAYS = G_fn_CalcDay(gfn_trim(cal_TARGET_START_DATE.value), gfn_trim(cal_TARGET_END_DATE.value))+1;
	var v_TARGET_SOURCE_NUM =Math.ceil(v_TARGET_DAYS / v_SOURCE_DAYS);  //올림.
	
	otherArg		= otherArg + " TARGET_SOURCE_NUM="+wrapQuote(v_TARGET_SOURCE_NUM);
	//무조건 삭제하고 입력한다.---> 이지선과장 요구사항.
	otherArg		= otherArg + " SKIP_YN="+wrapQuote("0");
	

	// action 정보 초기화 
	fsp_clear(this);
	
	var actionName, cmdName, inData, outData, callBackFnc;

	actionName		= "FSM00224V4_T001";
	cmdName			= "U_svc::" + "fs/fsm/FSM00224V4_T001.jsp";
	inData			= "";
	outData			= "";
	callBackFnc		= "fn_After_Copy";
	
	jsp_transaction(this, actionName, cmdName ,inData ,outData, otherArg, callBackFnc, true, false, false);
	// 트랜잭션 종료     	
	 
}

//저장 후 콜백 함수 
function fn_After_Copy(errCode, errMsg)
{
	if (errCode != 0)
	{
		g_Message("EE", errMsg);
		return;
	}
	//복사를 했을 경우에만 메인창을 다시 조회한다.
	g_Message("02","복사작업을 성공적으로 수행했습니다." + "\n※주의:식수예측이 되어있지 않을 경우\n복사되지 않습니다.");
}




// 조회 조건 검색
function fn_Chk_Copy()
{
   //체크로직- 틀리면 return false;    
   
   //업장
   if(!mfn_Chk_Obj_MustInput(ed_UPJANG_NM)) return false;   
   
   //업장식당
   if(!mfn_Chk_Obj_MustInput(cbo_upjang_hall)) return false;
  
   //업장식당
   if(!mfn_Chk_Obj_MustInput(ed_MENU_CYCLE2)) return false;
     
   //복사대상시작날짜
   if(!mfn_Chk_Obj_MustInput(cal_SOURCE_START_DATE)) return false;

   //복사대상종료날짜
   if(!mfn_Chk_Obj_MustInput(cal_SOURCE_END_DATE)) return false;

   //복사대상시작날짜
   if(!mfn_Chk_Obj_MustInput(cbo_START_DATE)) return false;

	//복사대상종료날짜
   if(!mfn_Chk_Obj_MustInput(cbo_END_DATE)) return false;


	//시작일 종료일 확인
   if(cal_SOURCE_START_DATE.value>cal_SOURCE_END_DATE.value)
   {
	  g_Message("EE","시작일은 종료일보다 같거나 이전 날짜이어야 합니다.");
	  return false;
	  
   }
   
   return true;
}







/***************************************************************'
// 복사대상 컴포넌트들의 이벤트 
*****************************************************************/


//주기월 클릭버튼 
function me_Month2_OnClick(retDate)
{
	//var retDate = gfn_dialog("", "U_SCC::SCC_CALMONTH.xfdl","fa_Date="+wrapQuote(me_Month2.value), -1,-1,"Title=false Status=false AutoSize=true Resize=false");
	me_Month2.value= retDate;
	
	//날짜 다시 계산하기
	fn_MENU_CYCLE_to_DAYS2(ds_upjang_hall.getColumn(cbo_upjang_hall.index,"MENU_CYCLE"));
}

//주기월 선택버튼
function btn_MONTH2_OnClick(obj:Button, e:ClickEventInfo)
{
	me_Month2_OnClick(obj,"","","");
}

 
function me_Month2_oneditclick(obj:MaskEdit,  e:EditClickEventInfo)
{
	g_CalButton_OnClick(btn_MONTH2, e);
	
	me_Month2_OnClick(me_Month2.value);
}

function btn_MONTH2_onclick(obj:Button,  e:ClickEventInfo)
{
	g_CalButton_OnClick(btn_MONTH2, e);
	
	me_Month2_OnClick(me_Month2.value);
}

//주기월이 변경되었을 경우
function me_Month2_OnCharChanged(obj:MaskEdit, e)
{
	 fn_MENU_CYCLE_to_DAYS2(this.ed_MENU_CYCLE.text);
}


///////////////////////////////////////////////////
////// 주기 계산하기 
//////////////////////////////////////////////////
function fn_MENU_CYCLE_to_DAYS2(MENU_CYCLE)
{
	 //시작일은 매달 첫번째 날 1일을 기준으로 한다.   
	ed_MENU_CYCLE2.value   = MENU_CYCLE;
	cal_TARGET_START_DATE.value = gfn_subStr(this.me_Month2.value,0,6)+"01";
	cal_TARGET_END_DATE.value   = cal_TARGET_START_DATE.value;
	
	var END_DATE=0;
	
	switch (MENU_CYCLE)
	{
		case "001": //--> 07 일		
		 	 END_DATE=7;
	         //종료일은 주기식단의 종료일로 설정한다.
		   cal_TARGET_END_DATE.value	  = gfn_addDate(cal_TARGET_END_DATE.value, 6);
		   ed_MENU_CYCLE_NAME2.value="07일";
		 	 break;

		case "002": //--> 10 일		
		 	 END_DATE=10;
	         //종료일은 주기식단의 종료일로 설정한다.
		    cal_TARGET_END_DATE.value	  = gfn_addDate(cal_TARGET_END_DATE.value, 9);
		    ed_MENU_CYCLE_NAME2.value="10일";
			break;


		case "003": //--> 14 일
			 END_DATE=14;
	         //종료일은 주기식단의 종료일로 설정한다.
		   cal_TARGET_END_DATE.value	  = gfn_addDate(cal_TARGET_END_DATE.value, 13);
		   ed_MENU_CYCLE_NAME2.value="14일";
		 	 break;

		case "004": //--> 15 일
		 	 END_DATE=15;
	         //종료일은 주기식단의 종료일로 설정한다.
		   cal_TARGET_END_DATE.value	  = gfn_addDate(cal_TARGET_END_DATE.value, 14);
		   ed_MENU_CYCLE_NAME2.value="15일";
		    break;

		case "005": //--> 한달
			 END_DATE=31;
	         //종료일은 주기식단의 종료일로 설정한다.
		   cal_TARGET_END_DATE.value	  = gfn_addDate(cal_TARGET_END_DATE.value, 30);	   			 	 
		   ed_MENU_CYCLE_NAME2.value="한달";	
		 	 break;
		default :
			 break;
	}
		
	//종료일과 해당월의 마지막 날을 비교합니다.		 	 
	if(cal_TARGET_END_DATE.value> getLastDay(gfn_subStr(this.me_Month2.value,0,6)))
	{
		cal_TARGET_END_DATE.value = getLastDay(gfn_subStr(this.me_Month2.value,0,6));
	}	
	
	
	// ds_DAY1과  ds_DAY2데이터를 만든 후 콤보박스에 맵핑.
	fn_Make_ds_DAY1_DAY2(END_DATE);
		 	 
}


function fn_Make_ds_DAY1_DAY2(END_DATE)
{
	var i=0;
	
	ds_DAY1.clearData();
	ds_DAY2.clearData();
	
	for(i=0;i<END_DATE;i++)
	{
	
		ds_DAY1.addRow();
		ds_DAY1.setColumn(i,"CODE",i+1);
		ds_DAY1.setColumn(i,"CODE_NAME",i+1 + "일차");
	
	}
	
	Copy(ds_DAY2,ds_DAY1);
	
	
	//인덱스 만들기
	this.cbo_START_DATE.index = 0;
	//fn_AutoSelect_END_DATE
	fn_AutoSelect_END_DATE();
	
}






///////////////////////코너변경할때//////////////////////////
function cbo_upjang_hall_corner2_OnChanged(obj:Combo, e:ItemChangeEventInfo)
{
    //전체선택일때
    if(gfn_length(e.postvalue)<>0)
    {chk_ALL2.value=0;}
    else
    {
     //끼니가 전체이면 전체선택으로 변경
     if(gfn_length(cbo_upjang_hall_meal2.value)==0)
       {chk_ALL2.value=1;}
	}
	
	
	//////////////////////////////
	//복사원본 코너값 셋팅
	//////////////////////////////
	cbo_upjang_hall_corner.index=e.postindex;
	
	
    //식당의 끼니값 셋팅
	fn_Upjang_Hall_MealSearch();
	
}



//끼니변경시
function cbo_upjang_hall_meal2_OnChanged(obj:Combo, e:ItemChangeEventInfo)
{
	//전체선택일때
    if(gfn_length(e.postvalue)<>0)
    {chk_ALL2.value=0;}
    else
    {
     //끼니가 전체이면 전체선택으로 변경
     if(gfn_length(cbo_upjang_hall_corner2.value)==0){chk_ALL2.value=1;}
	}
	
	
	//////////////////////////////
	//복사원본 끼니값 셋팅
	//////////////////////////////
	cbo_upjang_hall_meal.index=e.postindex;
	
}



/////날짜 변경시 날짜 차이 계산
function cal_SOURCE_START_DATE_OnChanged(obj:Calendar, e:ChangeEventInfo)
{
	fn_source_change();
}

function cal_SOURCE_END_DATE_OnChanged(obj:Calendar, e:ChangeEventInfo)
{
	fn_source_change();
}

function fn_source_change()
{
	var sStDate = gfn_trim(cal_SOURCE_START_DATE.value);
	var sEdDate = gfn_trim(cal_SOURCE_END_DATE.value);
	
	if (parseInt(sStDate) < parseInt(sEdDate)) {
		ed_SOURCE_DAYS.value = G_fn_CalcDay(sStDate, sEdDate);
	} else {
		ed_SOURCE_DAYS.value = G_fn_CalcDay(sEdDate, sStDate) * -1;
	}	
	
	fn_AutoSelect_END_DATE();
}


function cbo_START_DATE_OnChanged(obj:Combo, e:ItemChangeEventInfo)
{
	fn_AutoSelect_END_DATE();
}

//원본의 날짜가 변결될때 복사본의 날짜를 자동으로 변경
function fn_AutoSelect_END_DATE()
{
	//cbo_END_DATE.index=cbo_START_DATE.index + ed_SOURCE_DAYS.Text;
	
	var tempIndex = cbo_START_DATE.index + parseInt(ed_SOURCE_DAYS.value);
	if(tempIndex>ds_DAY1.rowcount)
	{tempIndex=ds_DAY1.rowcount-1;}
	
	/* ResetIndex은 지원되지 않는 속성입니다.*/ //cbo_END_DATE.ResetIndex = true;
	cbo_END_DATE.index=tempIndex;

}




//마지막날을 구하는 함수
function getLastDay(yyyymm)
{
   var tDay = gfn_addMonth(yyyymm+"01",1);
   return gfn_addDate(tDay,-1);
}  
]]></Script>
  </Form>
</FDL>
