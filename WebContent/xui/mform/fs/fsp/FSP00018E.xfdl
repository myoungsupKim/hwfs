<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="..\..\..\default_typedef.xml"/>
  <Form id="FSP00018E" classname="FSP00015E" inheritanceid="" position="absolute 0 0 1252 725" titletext="판촉상품마감(관리자용)" onload="form_onload" onkeydown="frm_OnKeyDown">
    <Layouts>
      <Layout>
        <Div id="div_cmnBtn" anchor="left top right" taborder="7" url="cmn::CmnBtn.xfdl" text="Div00" scrollbars="none" position="absolute 0 0 1237 30"/>
        <Static id="Static27" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1237 0 1252 710" anchor="top right"/>
        <Static id="Static71" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 710 1252 725" anchor="left bottom"/>
        <Static id="Static00" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1222 40 1237 61" anchor="left top"/>
        <Static id="Static04" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 30 1237 40"/>
        <Static id="Static08" class="sta_WFSA_Labelbg" position="absolute 0 29 1237 97" anchor="left top right"/>
        <Static id="Static05" text="h5" class="Guide01_AreaRed" visible="false" position="absolute 0 61 1237 66"/>
        <Static id="Static07" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 40 15 87" anchor="left top"/>
        <Static id="Static01" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 30 1237 40"/>
        <Static id="Static25" text="시즌" class="sta_WFSA_label" position="absolute 15 40 50 61"/>
        <Combo id="cbo_season" taborder="0" innerdataset="@ds_season" codecolumn="SID" datacolumn="STITLE" position="absolute 70 40 190 61"/>
        <Static id="Static12" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 60 40 70 87" anchor="left top"/>
        <Static id="Static13" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 190 40 220 87" anchor="left top"/>
        <Static id="Static02" text="주문일자" class="sta_WFSA_label" position="absolute 220 40 280 61"/>
        <MaskEdit id="msk_startDate" taborder="1" type="string" mask="####-##-##" autoselect="true" onsetfocus="g_Date_OnFocus" onkillfocus="g_Date_OnKillFocus" oneditclick="g_Date_OnFocus" class="msk_WF_Cal" position="absolute 289 40 359 61"/>
        <Button id="btn_startDate" taborder="2" tabstop="false" onclick="g_CalButton_OnClick" class="btn_WF_cal" position="absolute 358 40 379 61" userdata="msk_startDate"/>
        <Static id="Static03" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 279 40 289 87" anchor="left top"/>
        <Static id="st_1" text="~" position="absolute 382 43 390 59"/>
        <MaskEdit id="msk_endDate" taborder="3" type="string" mask="####-##-##" autoselect="true" onsetfocus="g_Date_OnFocus" onkillfocus="g_Date_OnKillFocus" oneditclick="g_Date_OnFocus" class="msk_WF_Cal" position="absolute 394 40 464 61"/>
        <Button id="btn_endDate" taborder="4" tabstop="false" onclick="g_CalButton_OnClick" class="btn_WF_cal" position="absolute 463 40 484 61" userdata="msk_endDate"/>
        <Static id="Static06" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 484 40 514 61" anchor="left top"/>
        <Static id="Static09" text="마감작업" class="sta_WFSA_label" position="absolute 514 40 574 61"/>
        <Static id="Static10" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 571 40 581 61" anchor="left top"/>
        <Combo id="cbo_status" taborder="5" position="absolute 581 40 671 61" index="-1" innerdataset="@ds_status" codecolumn="CODE" datacolumn="NAME" onitemchanged="cbo_status_onitemchanged"/>
        <Static id="Static11" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 671 40 702 61" anchor="left top"/>
        <Static id="Static14" text="영수증번호" class="sta_WFSA_label" position="absolute 701 40 774 61"/>
        <Static id="Static15" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 772 40 782 61" anchor="left top"/>
        <Edit id="edt_billNo" taborder="6" position="absolute 782 40 987 61" onkeydown="edt_billNo_onkeydown"/>
        <Grid id="grd_list" taborder="8" useinputpanel="false" position="absolute 0 129 1237 426" cellmovingtype="col" cellsizingtype="col" binddataset="ds_list" autoenter="select" anchor="left top right" oncelldblclick="grd_list_oncelldblclick" onexpandup="grd_list_onexpandup">
          <Formats>
            <Format id="format_1">
              <Columns>
                <Column size="30" band="left"/>
                <Column size="30"/>
                <Column size="70"/>
                <Column size="110"/>
                <Column size="150"/>
                <Column size="120"/>
                <Column size="100"/>
                <Column size="100"/>
                <Column size="180"/>
                <Column size="110"/>
                <Column size="70"/>
                <Column size="50"/>
                <Column size="120"/>
                <Column size="50"/>
                <Column size="60"/>
                <Column size="60"/>
                <Column size="85"/>
                <Column size="85"/>
                <Column size="85"/>
                <Column size="50"/>
                <Column size="80"/>
                <Column size="100"/>
                <Column size="100"/>
                <Column size="100"/>
              </Columns>
              <Rows>
                <Row size="0" band="head"/>
                <Row size="24" band="head"/>
                <Row size="24"/>
                <Row size="24" band="summ"/>
              </Rows>
              <Band id="head">
                <Cell rowspan="2" displaytype="checkbox" edittype="checkbox" taborder="undefined"/>
                <Cell col="1" rowspan="2" class="head_Excel" taborder="undefined"/>
                <Cell col="2" colspan="7" text="주문정보" taborder="undefined"/>
                <Cell col="9" colspan="5" text="지불정보" taborder="undefined"/>
                <Cell col="14" rowspan="2" text="과/면세" taborder="undefined"/>
                <Cell col="15" colspan="4" text="주 문 금 액" taborder="undefined"/>
                <Cell col="19" rowspan="2" text="마감" taborder="undefined"/>
                <Cell col="20" rowspan="2" text="정산일" taborder="undefined"/>
                <Cell col="21" rowspan="2" text="영수증번호" taborder="undefined"/>
                <Cell col="22" rowspan="2" text="승인번호" taborder="undefined"/>
                <Cell col="23" rowspan="2" text="가맹점번호" taborder="undefined"/>
                <Cell row="1" col="2" text="사업부"/>
                <Cell row="1" col="3" text="팀"/>
                <Cell row="1" col="4" text="사업장"/>
                <Cell row="1" col="5" text="주문일시"/>
                <Cell row="1" col="6" text="주문자"/>
                <Cell row="1" col="7" text="신청자"/>
                <Cell row="1" col="8" text="소속"/>
                <Cell row="1" col="9" text="방식"/>
                <Cell row="1" col="10" text="카드구분"/>
                <Cell row="1" col="11" text="카드"/>
                <Cell row="1" col="12" text="카드번호"/>
                <Cell row="1" col="13" text="할부"/>
                <Cell row="1" col="15" text="수량"/>
                <Cell row="1" col="16" text="판매금액"/>
                <Cell row="1" col="17" text="할인금액"/>
                <Cell row="1" col="18" text="지불금액"/>
              </Band>
              <Band id="body">
                <Cell displaytype="checkbox" edittype="checkbox" style="background2: ;" text="bind:CHK"/>
                <Cell col="1" expr="expr:currow+1"/>
                <Cell col="2" style="align:left;" text="bind:MU_NM"/>
                <Cell col="3" style="align:left;" text="bind:TM_NM"/>
                <Cell col="4" style="align:left;" text="bind:UPJANGNM"/>
                <Cell col="5" displaytype="date" text="bind:SP_DATE2" mask="yyyy-MM-dd hh:mm:ss" calendardisplaynulltype="none"/>
                <Cell col="6" style="align:left;" text="bind:PR_SABUNNM"/>
                <Cell col="7" style="align:left;" text="bind:RQ_SABUNNM"/>
                <Cell col="8" style="align:left;" text="bind:RQ_SABUN_CC_NM"/>
                <Cell col="9" displaytype="combo" text="bind:PAY_METHOD" combodataset="ds_pay" combocodecol="CODE" combodatacol="CODE_NAME"/>
                <Cell col="10" text="bind:CARD_CLASS"/>
                <Cell col="11" text="bind:CARD_COMP"/>
                <Cell col="12" text="bind:CARD_NUM" mask="expr:CARD_NUM==null?'':'####-####-####-####'" maskchar=" "/>
                <Cell col="13" displaytype="combo" text="bind:INST_PERIOD" combodataset="ds_inst" combocodecol="CODE" combodatacol="CODE_NAME"/>
                <Cell col="14" text="bind:TAX_CODE"/>
                <Cell col="15" displaytype="number" text="bind:PR_QTY"/>
                <Cell col="16" displaytype="number" text="bind:SALE_AMOUNT" mask="#,##0"/>
                <Cell col="17" displaytype="number" text="bind:DC_AMOUNT" mask="#,##0"/>
                <Cell col="18" displaytype="number" style="font:Gulim,9, bold;" text="bind:TOT_AMOUNT" mask="#,##0"/>
                <Cell col="19" text="bind:LINE_STATUS"/>
                <Cell col="20" displaytype="date" text="bind:PAY_TIME" calendardisplaynulltype="none"/>
                <Cell col="21" edittype="expr:LINE_STATUS=='주문'?&quot;normal&quot;:&quot;none&quot;" style="align:left;background:EXPR(LINE_STATUS=='주문'?&quot;lightyellow&quot;:&quot;&quot;);background2:EXPR(LINE_STATUS=='주문'?&quot;lightyellow&quot;:&quot;&quot;);" text="bind:BILL_NO" editlimit="50" editautoselect="true" editlengthunit="ascii"/>
                <Cell col="22" edittype="expr:LINE_STATUS=='주문'&amp;&amp;CARD_NUM&lt;&gt;null?&quot;normal&quot;:&quot;none&quot;" style="align:left;background:EXPR(LINE_STATUS=='주문'&amp;&amp;CARD_NUM&lt;&gt;null?&quot;lightyellow&quot;:&quot;&quot;);background2:EXPR(LINE_STATUS=='주문'&amp;&amp;CARD_NUM&lt;&gt;null?&quot;lightyellow&quot;:&quot;&quot;);" text="bind:APPRV_NUM" editlimit="50" editautoselect="true" editlengthunit="ascii"/>
                <Cell col="23" edittype="expr:LINE_STATUS=='주문'&amp;&amp;CARD_NUM&lt;&gt;null?&quot;expand&quot;:&quot;none&quot;" style="align:left;background:EXPR(LINE_STATUS=='주문'&amp;&amp;CARD_NUM&lt;&gt;null?&quot;lightyellow&quot;:&quot;&quot;);background2:EXPR(LINE_STATUS=='주문'&amp;&amp;CARD_NUM&lt;&gt;null?&quot;lightyellow&quot;:&quot;&quot;);" text="bind:FRNC_STOR_NUM" editlimit="50" editautoselect="true" editlengthunit="ascii" expandshow="expr:LINE_STATUS=='주문'&amp;&amp;CARD_NUM&lt;&gt;null?&quot;show&quot;:&quot;hide&quot;" expandsize="20"/>
              </Band>
              <Band id="summary">
                <Cell/>
                <Cell col="1" colspan="5" style="align:center;" text="합  계" taborder="undefined"/>
                <Cell col="6"/>
                <Cell col="7"/>
                <Cell col="8"/>
                <Cell col="9"/>
                <Cell col="10"/>
                <Cell col="11"/>
                <Cell col="12"/>
                <Cell col="13"/>
                <Cell col="14"/>
                <Cell col="15" displaytype="number" expr="expr:getSum(&quot;PR_QTY&quot;)"/>
                <Cell col="16" displaytype="number" expr="expr:getSum(&quot;SALE_AMOUNT&quot;)" mask="#,##0"/>
                <Cell col="17" displaytype="number" expr="expr:getSum(&quot;DC_AMOUNT&quot;)" mask="#,##0"/>
                <Cell col="18" displaytype="number" expr="expr:getSum(&quot;TOT_AMOUNT&quot;)" mask="#,##0"/>
                <Cell col="19"/>
                <Cell col="20"/>
                <Cell col="21"/>
                <Cell col="22"/>
                <Cell col="23"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Static id="Static16" text="h6" class="Guide01_AreaRed" visible="false" position="absolute 0 97 1237 103"/>
        <Tab id="tab" taborder="9" tabindex="0" scrollbars="autoboth" position="absolute 0 434 1237 710" style="showextrabutton:false;" anchor="all" onchanged="tab_onchanged">
          <Tabpages>
            <Tabpage id="tabpage1" text="주문내역">
              <Layouts>
                <Layout>
                  <Grid id="grd_list" taborder="0" useinputpanel="false" position="absolute 10 10 1225 238" anchor="all" binddataset="ds_list_detail" cellmovingtype="col" cellsizingtype="col" autoenter="select">
                    <Formats>
                      <Format id="format_1">
                        <Columns>
                          <Column size="30"/>
                          <Column size="75"/>
                          <Column size="137"/>
                          <Column size="40"/>
                          <Column size="40"/>
                          <Column size="80"/>
                          <Column size="60"/>
                          <Column size="80"/>
                          <Column size="80"/>
                          <Column size="100"/>
                          <Column size="80"/>
                          <Column size="65"/>
                          <Column size="80"/>
                          <Column size="75"/>
                          <Column size="110"/>
                          <Column size="40"/>
                          <Column size="60"/>
                          <Column size="40"/>
                          <Column size="120"/>
                          <Column size="30"/>
                          <Column size="30"/>
                          <Column size="60"/>
                          <Column size="300"/>
                          <Column size="120"/>
                          <Column size="120"/>
                          <Column size="200"/>
                          <Column size="80"/>
                          <Column size="200"/>
                          <Column size="75"/>
                          <Column size="90"/>
                          <Column size="110"/>
                          <Column size="60"/>
                          <Column size="60"/>
                          <Column size="60"/>
                          <Column size="50"/>
                          <Column size="60"/>
                          <Column size="60"/>
                          <Column size="120"/>
                          <Column size="120"/>
                          <Column size="60"/>
                        </Columns>
                        <Rows>
                          <Row size="24" band="head"/>
                          <Row size="24" band="head"/>
                          <Row size="24"/>
                          <Row size="24" band="summ"/>
                        </Rows>
                        <Band id="head">
                          <Cell rowspan="2" class="head_Excel" taborder="undefined"/>
                          <Cell col="1" rowspan="2" text="상품코드" taborder="undefined"/>
                          <Cell col="2" rowspan="2" text="상품명" taborder="undefined"/>
                          <Cell col="3" colspan="2" text="카드유효기간" taborder="undefined"/>
                          <Cell col="5" colspan="6" text="주 문 정 보" taborder="undefined"/>
                          <Cell col="11" colspan="2" text="신청자" taborder="undefined"/>
                          <Cell col="13" text="보내는 이" taborder="undefined"/>
                          <Cell col="14" colspan="7" text="지불정보" taborder="undefined"/>
                          <Cell col="21" colspan="4" text="받는이" taborder="undefined"/>
                          <Cell col="25" colspan="6" text="결제자 상세정보" taborder="undefined"/>
                          <Cell col="31" rowspan="2" text="명함동봉" taborder="undefined"/>
                          <Cell col="32" rowspan="2" text="해피콜" taborder="undefined"/>
                          <Cell col="33" colspan="7" text="마감정보" taborder="undefined"/>
                          <Cell row="1" col="3" text="MM"/>
                          <Cell row="1" col="4" text="YY"/>
                          <Cell row="1" col="5" text="상품가"/>
                          <Cell row="1" col="6" text="수량"/>
                          <Cell row="1" col="7" text="판매금액"/>
                          <Cell row="1" col="8" text="할인금액"/>
                          <Cell row="1" col="9" text="관리자할인금액"/>
                          <Cell row="1" col="10" text="지불금액"/>
                          <Cell row="1" col="11" text="판매구분"/>
                          <Cell row="1" col="12" text="신청자사번"/>
                          <Cell row="1" col="13" text="이름" taborder="undefined"/>
                          <Cell row="1" col="14" text="방식"/>
                          <Cell row="1" col="15" text="할부"/>
                          <Cell row="1" col="16" text="카드구분"/>
                          <Cell row="1" col="17" text="카드"/>
                          <Cell row="1" col="18" text="카드번호"/>
                          <Cell row="1" col="19" text="MM"/>
                          <Cell row="1" col="20" text="YY"/>
                          <Cell row="1" col="21" text="이름"/>
                          <Cell row="1" col="22" text="주소"/>
                          <Cell row="1" col="23" text="연락처"/>
                          <Cell row="1" col="24" text="휴대전화"/>
                          <Cell row="1" col="25" text="거래처"/>
                          <Cell row="1" col="26" text="사업자번호"/>
                          <Cell row="1" col="27" text="주소"/>
                          <Cell row="1" col="28" text="담당자명"/>
                          <Cell row="1" col="29" text="연락처"/>
                          <Cell row="1" col="30" text="이메일"/>
                          <Cell row="1" col="33" text="주문번호"/>
                          <Cell row="1" col="34" text="마감"/>
                          <Cell row="1" col="35" text="배송구분"/>
                          <Cell row="1" col="36" text="택배사"/>
                          <Cell row="1" col="37" text="송장번호"/>
                          <Cell row="1" col="38" text="정산영수증No"/>
                          <Cell row="1" col="39" text="재고량"/>
                        </Band>
                        <Band id="body">
                          <Cell expr="expr:currow+1"/>
                          <Cell col="1" text="bind:ITEM_CODE"/>
                          <Cell col="2" style="align:left;" text="bind:ITEM_NAME"/>
                          <Cell col="3" text="bind:VALID_THRU_MM"/>
                          <Cell col="4" text="bind:VALID_THRU_YY"/>
                          <Cell col="5" displaytype="number" text="bind:SALE_PRICE"/>
                          <Cell col="6" displaytype="number" editfilter="number" text="bind:PR_QTY" editautoselect="true"/>
                          <Cell col="7" displaytype="number" text="bind:SALE_AMOUNT"/>
                          <Cell col="8" displaytype="number" text="bind:DC_AMOUNT"/>
                          <Cell col="9" displaytype="number" text="bind:ADM_DC_AMOUNT"/>
                          <Cell col="10" displaytype="number" text="bind:TOT_AMOUNT"/>
                          <Cell col="11" text="bind:SALE_TYPE"/>
                          <Cell col="12" text="bind:RQ_SABUN"/>
                          <Cell col="13" text="bind:SEND_NAME"/>
                          <Cell col="14" displaytype="combo" text="bind:PAY_METHOD" combodataset="ds_pay" combocodecol="CODE" combodatacol="CODE_NAME"/>
                          <Cell col="15" text="bind:INST_PERIOD"/>
                          <Cell col="16" displaytype="combo" text="bind:CARD_CLASS" combodataset="ds_cardClass" combocodecol="CODE" combodatacol="NAME"/>
                          <Cell col="17" text="bind:CARD_COMP"/>
                          <Cell col="18" text="bind:CARD_NUM" mask="expr:CARD_NUM==null?'':'####-####-####-####'" maskchar="_"/>
                          <Cell col="19" text="bind:VALID_THRU_MM"/>
                          <Cell col="20" text="bind:VALID_THRU_YY"/>
                          <Cell col="21" edittype="expr:gfn_isNull(INVOICE_NUM) ? 'normal' : 'none'" text="bind:RECE_NAME"/>
                          <Cell col="22" displaytype="text" edittype="expr:gfn_isNull(INVOICE_NUM) ? 'normal' : 'none'" text="bind:RECE_ADDR"/>
                          <Cell col="23" displaytype="text" edittype="expr:gfn_isNull(INVOICE_NUM) ? 'normal' : 'none'" text="bind:RECE_TEL"/>
                          <Cell col="24" displaytype="text" edittype="expr:gfn_isNull(INVOICE_NUM) ? 'normal' : 'none'" text="bind:RECE_HP"/>
                          <Cell col="25" style="align:left;" text="bind:AR_CUSTNM"/>
                          <Cell col="26" style="align:center;" text="bind:AR_SAUPNO" mask="###-##-#####"/>
                          <Cell col="27" style="align:left;" text="bind:AR_ADDR"/>
                          <Cell col="28" text="bind:AR_NAME"/>
                          <Cell col="29" style="align:left;" text="bind:AR_TEL"/>
                          <Cell col="30" style="align:left;" text="bind:AR_EMAIL"/>
                          <Cell col="31" text="bind:CONTENT"/>
                          <Cell col="32" text="bind:CALL_YN"/>
                          <Cell col="33" style="align:right;color:EXPR(iif(LINE_STATUS=='마감',&quot;red&quot;,&quot;default&quot;));color2:EXPR(iif(LINE_STATUS=='마감',&quot;red&quot;,&quot;default&quot;));" text="bind:SP_ID"/>
                          <Cell col="34" style="align: ;color:EXPR(iif(LINE_STATUS=='마감',&quot;red&quot;,&quot;default&quot;));color2:EXPR(iif(LINE_STATUS=='마감',&quot;red&quot;,&quot;default&quot;));" text="bind:LINE_STATUS"/>
                          <Cell col="35" text="bind:DELI_TYPE"/>
                          <Cell col="36" text="bind:DELI_COMP"/>
                          <Cell col="37" style="align:left;" text="bind:INVOICE_NUM"/>
                          <Cell col="38" style="align:left;" text="bind:BILL_NO"/>
                          <Cell col="39" displaytype="number" text="bind:STOCK_QTY"/>
                        </Band>
                        <Band id="summary">
                          <Cell/>
                          <Cell col="1" style="align:center;" text="합  계"/>
                          <Cell col="2"/>
                          <Cell col="3"/>
                          <Cell col="4"/>
                          <Cell col="5"/>
                          <Cell col="6" displaytype="number" expr="expr:getSum(&quot;PR_QTY&quot;)"/>
                          <Cell col="7" displaytype="number" expr="expr:getSum(&quot;SALE_AMOUNT&quot;)"/>
                          <Cell col="8" displaytype="number" expr="expr:getSum(&quot;DC_AMOUNT&quot;)"/>
                          <Cell col="9" displaytype="number" expr="expr:getSum(&quot;DC_AMOUNT&quot;)"/>
                          <Cell col="10" displaytype="number" expr="expr:getSum(&quot;TOT_AMOUNT&quot;)"/>
                          <Cell col="11"/>
                          <Cell col="12"/>
                          <Cell col="13"/>
                          <Cell col="14"/>
                          <Cell col="15"/>
                          <Cell col="16"/>
                          <Cell col="17"/>
                          <Cell col="18"/>
                          <Cell col="19"/>
                          <Cell col="20"/>
                          <Cell col="21"/>
                          <Cell col="22"/>
                          <Cell col="23"/>
                          <Cell col="24"/>
                          <Cell col="25"/>
                          <Cell col="26"/>
                          <Cell col="27"/>
                          <Cell col="28"/>
                          <Cell col="29"/>
                          <Cell col="30"/>
                          <Cell col="31"/>
                          <Cell col="32"/>
                          <Cell col="33"/>
                          <Cell col="34"/>
                          <Cell col="35"/>
                          <Cell col="36"/>
                          <Cell col="37"/>
                          <Cell col="38"/>
                          <Cell col="39"/>
                        </Band>
                      </Format>
                    </Formats>
                  </Grid>
                  <Static id="Static00" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 10 0 1225 10"/>
                  <Static id="Static61" text="w10" class="Guide01_AreaRed" visible="false" position="absolute 1225 0 1235 248"/>
                  <Static id="Static59" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 10 238 1225 248"/>
                  <Static id="Static58" text="w10" class="Guide01_AreaRed" visible="false" position="absolute 0 0 10 248"/>
                </Layout>
              </Layouts>
            </Tabpage>
            <Tabpage id="tabpage2" text="결제자 구매내역">
              <Layouts>
                <Layout>
                  <Grid id="grd_list" taborder="0" useinputpanel="false" position="absolute 10 11 1223 238" autofittype="col" cellmovingtype="col" cellsizingtype="col" binddataset="ds_list_detail2" anchor="all">
                    <Formats>
                      <Format id="default">
                        <Columns>
                          <Column size="30"/>
                          <Column size="120"/>
                          <Column size="200"/>
                          <Column size="150"/>
                          <Column size="100"/>
                          <Column size="200"/>
                          <Column size="100"/>
                        </Columns>
                        <Rows>
                          <Row size="24" band="head"/>
                          <Row size="24"/>
                          <Row size="24" band="summ"/>
                        </Rows>
                        <Band id="head">
                          <Cell class="head_Excel"/>
                          <Cell col="1" text="사업자번호"/>
                          <Cell col="2" text="사업자번호상호"/>
                          <Cell col="3" text="담당자명"/>
                          <Cell col="4" text="상품코드"/>
                          <Cell col="5" text="상품명"/>
                          <Cell col="6" text="지불금액"/>
                        </Band>
                        <Band id="body">
                          <Cell expr="expr:currow+1"/>
                          <Cell col="1" style="align:left;" text="bind:AR_SAUPNO"/>
                          <Cell col="2" style="align:left;" text="bind:AR_SAUPNONM"/>
                          <Cell col="3" style="align:left;" text="bind:AR_NAME"/>
                          <Cell col="4" text="bind:ITEM_CODE"/>
                          <Cell col="5" style="align:left;" text="bind:ITEM_NAME"/>
                          <Cell col="6" displaytype="number" text="bind:TOT_AMOUNT"/>
                        </Band>
                        <Band id="summary">
                          <Cell/>
                          <Cell col="1" style="align:center;" text="합  계"/>
                          <Cell col="2"/>
                          <Cell col="3"/>
                          <Cell col="4"/>
                          <Cell col="5"/>
                          <Cell col="6" displaytype="number" expr="expr:getSum(&quot;TOT_AMOUNT&quot;)"/>
                        </Band>
                      </Format>
                    </Formats>
                  </Grid>
                </Layout>
              </Layouts>
            </Tabpage>
          </Tabpages>
        </Tab>
        <Button id="btn_cancel" taborder="10" tabstop="false" text="주문취소" onclick="fn_cancel" class="btn_WF_Custom" position="absolute 1082 434 1143 455" anchor="top right" visible="false"/>
        <Button id="btn_ordChange" taborder="11" tabstop="false" text="주문변경" onclick="fn_ordChange" class="btn_WF_Custom" position="absolute 1017 434 1078 455" anchor="top right" visible="false"/>
        <Button id="btn_qtySave" taborder="12" tabstop="false" text="확정" onclick="fn_detailSave" class="btn_WF_Custom" position="absolute 972 434 1013 455" anchor="top right" visible="false"/>
        <Button id="btn_afForward" taborder="13" tabstop="false" text="매출 차기이월" onclick="fn_afForward" class="btn_WF_Custom" visible="false" position="absolute 1147 103 1237 124" anchor="top right"/>
        <Static id="Static22" text="마감내역" class="sta_WF_Title01" position="absolute 0 111 74 125"/>
        <Static id="Static17" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 0 124 1237 129"/>
        <UpjangSearchComponent id="edt_upjang" titletext="업장 검색용 Component" taborder="14" text="UpjangSearchComponent00" position="absolute 581 66 741 87" bindDataset="ds_input" bindUpjangCodeColumn="UPJANG" bindUpjangNameColumn="UPJANGNM" eventBeforeTrigger="" eventAfterTrigger="" roleSetId=""/>
        <Static id="st_ContractStart" text="사업장" class="sta_WFSA_label" position="absolute 514 66 561 87" anchor="left top"/>
        <Static id="Static24" text="사업부" class="sta_WFSA_label" position="absolute 15 66 64 87"/>
        <MuSearchComponent id="cbo_mu" titletext="사업부 선택 Component" taborder="15" text="FS 사업부" position="absolute 70 66 190 87" bindDataset="ds_input" bindMuCdColumn="MU" appendText="" onItemChangedEvent="fn_muChange"/>
        <Static id="Static18" text="팀" class="sta_WFSA_label" position="absolute 220 66 247 87"/>
        <TmSearchComponent id="edt_tm" titletext="팀 검색용 Component" taborder="16" text="TmSearchComponent00" position="absolute 289 66 451 87" bindDataset="ds_input" bindTmCdColumn="TM" bindTmNmColumn="TMNM" qoBuCd="" qoMuCd="" qoUseYn="" eventAfterTrigger="fn_tmChange" eventBeforeTrigger=""/>
        <Static id="Static19" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 87 1236 97"/>
        <Static id="Static20" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 484 66 514 87" anchor="left top"/>
        <Static id="Static21" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 571 66 581 87" anchor="left top"/>
        <Button id="btn_bfForward" taborder="17" tabstop="false" text="매출 전기이월" onclick="fn_bfForward" class="btn_WF_Custom" visible="false" position="absolute 1053 103 1143 124" anchor="top right"/>
        <CheckBox id="chk_sp" taborder="18" text="귀속부서" position="absolute 782 66 861 87" truevalue="Y" falsevalue="N" onchanged="chk_sp_onchanged"/>
        <Button id="btn_saveReceive" taborder="19" tabstop="false" text="고객정보 저장" class="btn_WF_Custom" visible="true" position="absolute 1147 434 1237 455" anchor="top right" onclick="btn_saveReceive_onclick"/>
      </Layout>
    </Layouts>
    <Bind>
      <BindItem id="item0" compid="msk_startDate" propid="value" datasetid="ds_date" columnid="START_DATE"/>
      <BindItem id="item1" compid="msk_endDate" propid="value" datasetid="ds_date" columnid="END_DATAE"/>
    </Bind>
    <Objects>
      <Dataset id="ds_cond" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="SEASON_NUM" type="STRING" size="256"/>
          <Column id="START_DATE" type="STRING" size="256"/>
          <Column id="END_DATE" type="STRING" size="256"/>
          <Column id="STATUS" type="STRING" size="256"/>
          <Column id="BILL_NO" type="STRING" size="256"/>
          <Column id="MU" type="STRING" size="256"/>
          <Column id="TM" type="STRING" size="256"/>
          <Column id="TMNM" type="STRING" size="256"/>
          <Column id="UPJANG" type="STRING" size="256"/>
          <Column id="UPJANGNM" type="STRING" size="256"/>
          <Column id="SP_CHK" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_list" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" oncolumnchanged="ds_list_oncolumnchanged">
        <ColumnInfo>
          <Column id="CHK" type="STRING" size="1"/>
          <Column id="SP_DATE" type="STRING" size="8"/>
          <Column id="SP_DATE2" type="STRING" size="16"/>
          <Column id="PR_SABUN" type="STRING" size="9"/>
          <Column id="PR_SABUNNM" type="STRING" size="71"/>
          <Column id="RQ_SABUN" type="STRING" size="9"/>
          <Column id="RQ_SABUNNM" type="STRING" size="71"/>
          <Column id="RQ_SABUN_CC_NM" type="STRING" size="201"/>
          <Column id="PAY_METHOD" type="STRING" size="50"/>
          <Column id="CARD_COMP" type="STRING" size="50"/>
          <Column id="CARD_NUM" type="STRING" size="4000"/>
          <Column id="INST_PERIOD" type="STRING" size="20"/>
          <Column id="TAX_CODE" type="STRING" size="2"/>
          <Column id="TAX_CODE_GBN" type="STRING" size="1"/>
          <Column id="BILL_NO" type="STRING" size="50"/>
          <Column id="CANCEL_BILL_NO" type="STRING" size="50"/>
          <Column id="PR_QTY" type="BIGDECIMAL" size="39"/>
          <Column id="SALE_AMOUNT" type="BIGDECIMAL" size="39"/>
          <Column id="DC_AMOUNT" type="BIGDECIMAL" size="39"/>
          <Column id="TOT_AMOUNT" type="BIGDECIMAL" size="39"/>
          <Column id="SEASON_NUM" type="BIGDECIMAL" size="39"/>
          <Column id="LINE_STATUS" type="STRING" size="50"/>
          <Column id="CARD_MM" type="STRING" size="2"/>
          <Column id="CARD_YY" type="STRING" size="2"/>
          <Column id="UPJANGNM" type="STRING" size="50"/>
          <Column id="CARD_CLASS" type="STRING" size="18"/>
          <Column id="CARD_CLASS_GBN" type="STRING" size="1"/>
          <Column id="APPRV_NUM" type="STRING" size="20"/>
          <Column id="FRNC_STOR_NUM" type="STRING" size="50"/>
          <Column id="CARD_YYMM" type="STRING" size="4"/>
        </ColumnInfo>
        <Column id="CHK" type="STRING" size="1"/>
        <Column id="SP_DATE" type="STRING" size="8"/>
        <Column id="PR_SABUN" type="STRING" size="9"/>
        <Column id="PR_SABUNNM" type="STRING" size="71"/>
        <Column id="RQ_SABUN" type="STRING" size="9"/>
        <Column id="RQ_SABUNNM" type="STRING" size="71"/>
        <Column id="RQ_SABUN_CC_NM" type="STRING" size="201"/>
        <Column id="PAY_METHOD" type="STRING" size="50"/>
        <Column id="CARD_COMP" type="STRING" size="50"/>
        <Column id="CARD_NUM" type="STRING" size="4000"/>
        <Column id="INST_PERIOD" type="STRING" size="20"/>
        <Column id="TAX_CODE" type="STRING" size="2"/>
        <Column id="BILL_NO" type="STRING" size="50"/>
        <Column id="CANCEL_BILL_NO" type="STRING" size="50"/>
        <Column id="PR_QTY" type="BIGDECIMAL" size="39"/>
        <Column id="SALE_AMOUNT" type="BIGDECIMAL" size="39"/>
        <Column id="DC_AMOUNT" type="BIGDECIMAL" size="39"/>
        <Column id="TOT_AMOUNT" type="BIGDECIMAL" size="39"/>
        <Column id="SEASON_NUM" type="BIGDECIMAL" size="39"/>
        <Column id="AR_SAUPNO" type="STRING" size="13"/>
        <Column id="LINE_STATUS" type="STRING" size="50"/>
        <Column id="CARD_MM" type="STRING" size="2"/>
        <Column id="CARD_YY" type="STRING" size="2"/>
      </Dataset>
      <Dataset id="ds_pay" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_inst" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_card" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_cond_detail" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="START_DATE" type="STRING" size="256"/>
          <Column id="PR_SABUN" type="STRING" size="256"/>
          <Column id="PAY_METHOD" type="STRING" size="256"/>
          <Column id="CARD_NUM" type="STRING" size="256"/>
          <Column id="INST_PERIOD" type="STRING" size="256"/>
          <Column id="TAX_CODE" type="STRING" size="256"/>
          <Column id="LINE_STATUS" type="STRING" size="256"/>
          <Column id="BILL_NO" type="STRING" size="256"/>
          <Column id="CANCEL_BILL_NO" type="STRING" size="256"/>
          <Column id="STATUS" type="STRING" size="256"/>
          <Column id="RQ_SABUN" type="STRING" size="256"/>
          <Column id="CARD_COMP" type="STRING" size="256"/>
          <Column id="SEASON_NUM" type="STRING" size="256"/>
          <Column id="CARD_CLASS" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_sale" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_common" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_list_detail" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" oncolumnchanged="ds_list_detail_oncolumnchanged">
        <ColumnInfo>
          <Column id="SP_ID" type="BIGDECIMAL" size="39"/>
          <Column id="SEASON_NUM" type="BIGDECIMAL" size="39"/>
          <Column id="ITEM_CODE" type="STRING" size="12"/>
          <Column id="ITEM_NAME" type="STRING" size="601"/>
          <Column id="ITEM_SIZE" type="STRING" size="1000"/>
          <Column id="TAX_CODE" type="STRING" size="2"/>
          <Column id="SALE_PRICE" type="BIGDECIMAL" size="22"/>
          <Column id="PR_QTY" type="BIGDECIMAL" size="14"/>
          <Column id="ORG_PR_QTY" type="BIGDECIMAL" size="14"/>
          <Column id="SALE_AMOUNT" type="BIGDECIMAL" size="21"/>
          <Column id="ORG_SALE_AMOUNT" type="BIGDECIMAL" size="21"/>
          <Column id="TOT_DC_AMOUNT" type="BIGDECIMAL" size="39"/>
          <Column id="DC_AMOUNT" type="BIGDECIMAL" size="21"/>
          <Column id="ADM_DC_AMOUNT" type="BIGDECIMAL" size="21"/>
          <Column id="TOT_AMOUNT" type="BIGDECIMAL" size="39"/>
          <Column id="ORG_TOT_AMOUNT" type="BIGDECIMAL" size="39"/>
          <Column id="SALE_TYPE" type="STRING" size="50"/>
          <Column id="IMAGE_PATH" type="STRING" size="756"/>
          <Column id="CONTENT" type="STRING" size="300"/>
          <Column id="LINE_STATUS" type="STRING" size="50"/>
          <Column id="PR_SABUN" type="STRING" size="9"/>
          <Column id="RQ_SABUN" type="STRING" size="9"/>
          <Column id="RQ_SABUNNM" type="STRING" size="254"/>
          <Column id="RQ_TEL" type="STRING" size="4000"/>
          <Column id="SEND_NAME" type="STRING" size="100"/>
          <Column id="SEND_TEL" type="STRING" size="4000"/>
          <Column id="SEND_ADDR" type="STRING" size="4000"/>
          <Column id="RECE_NAME" type="STRING" size="100"/>
          <Column id="RECE_TEL" type="STRING" size="4000"/>
          <Column id="RECE_HP" type="STRING" size="4000"/>
          <Column id="RECE_ADDR" type="STRING" size="4000"/>
          <Column id="AR_SAUPNO" type="STRING" size="13"/>
          <Column id="AR_ADDR" type="STRING" size="4000"/>
          <Column id="AR_NAME" type="STRING" size="100"/>
          <Column id="AR_TEL" type="STRING" size="4000"/>
          <Column id="AR_EMAIL" type="STRING" size="4000"/>
          <Column id="AR_SAUPNONM" type="STRING" size="512"/>
          <Column id="PAY_METHOD" type="STRING" size="50"/>
          <Column id="INST_PERIOD" type="STRING" size="20"/>
          <Column id="CARD_CLASS" type="STRING" size="18"/>
          <Column id="CARD_COMP" type="STRING" size="50"/>
          <Column id="CARD_NUM" type="STRING" size="4000"/>
          <Column id="VALID_THRU_MM" type="STRING" size="2"/>
          <Column id="VALID_THRU_YY" type="STRING" size="2"/>
          <Column id="DELI_TYPE" type="STRING" size="18"/>
          <Column id="DELI_COMP" type="STRING" size="18"/>
          <Column id="INVOICE_NUM" type="STRING" size="50"/>
          <Column id="BILL_NO" type="STRING" size="50"/>
          <Column id="MAX_ORD_QTY" type="BIGDECIMAL" size="14"/>
          <Column id="STOCK_QTY" type="BIGDECIMAL" size="39"/>
          <Column id="DELI_FREE_AMT" type="BIGDECIMAL" size="21"/>
          <Column id="QTY_DC_STD" type="BIGDECIMAL" size="14"/>
          <Column id="QTY_DC_RATE" type="BIGDECIMAL" size="14"/>
          <Column id="AMT_DC_STD" type="BIGDECIMAL" size="21"/>
          <Column id="AMT_DC_RATE" type="BIGDECIMAL" size="14"/>
          <Column id="EDIT_YN" type="STRING" size="1"/>
          <Column id="UPJANG" type="BIGDECIMAL" size="39"/>
          <Column id="UPJANGNM" type="STRING" size="108"/>
          <Column id="PAY_TIME" type="DATETIME" size="7"/>
          <Column id="RECEIPT_NUM" type="STRING" size="50"/>
          <Column id="FRNC_STOR_NUM" type="STRING" size="50"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_list_detail2" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="AR_SAUPNO" type="STRING" size="13"/>
          <Column id="AR_SAUPNONM" type="STRING" size="512"/>
          <Column id="AR_NAME" type="STRING" size="100"/>
          <Column id="ITEM_CODE" type="STRING" size="12"/>
          <Column id="ITEM_NAME" type="STRING" size="601"/>
          <Column id="TOT_AMOUNT" type="BIGDECIMAL" size="39"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_MM" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_YY" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_special_auth" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_season" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_saveList" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_status" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="256"/>
          <Column id="NAME" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="CODE">'주문'</Col>
            <Col id="NAME">정산대상</Col>
          </Row>
          <Row>
            <Col id="CODE">'정산','배송'</Col>
            <Col id="NAME">정산완료</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_date" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" oncolumnchanged="ds_date_oncolumnchanged">
        <ColumnInfo>
          <Column id="START_DATE" type="STRING" size="256"/>
          <Column id="END_DATAE" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row/>
        </Rows>
      </Dataset>
      <Dataset id="ds_test" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_cardClass" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="256"/>
          <Column id="NAME" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="CODE">신용</Col>
            <Col id="NAME">신용</Col>
          </Row>
          <Row>
            <Col id="CODE">체크</Col>
            <Col id="NAME">체크</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_deleteList" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_order" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="SP_ID" type="BIGDECIMAL" size="39"/>
          <Column id="SEASON_NUM" type="BIGDECIMAL" size="39"/>
          <Column id="ITEM_CODE" type="STRING" size="12"/>
          <Column id="ITEM_NAME" type="STRING" size="601"/>
          <Column id="SALE_PRICE" type="BIGDECIMAL" size="22"/>
          <Column id="PR_QTY" type="BIGDECIMAL" size="14"/>
          <Column id="ORG_PR_QTY" type="BIGDECIMAL" size="14"/>
          <Column id="SALE_AMOUNT" type="BIGDECIMAL" size="21"/>
          <Column id="DC_AMOUNT" type="BIGDECIMAL" size="21"/>
          <Column id="TOT_AMOUNT" type="BIGDECIMAL" size="39"/>
          <Column id="ORG_TOT_AMOUNT" type="BIGDECIMAL" size="39"/>
          <Column id="SALE_TYPE" type="STRING" size="50"/>
          <Column id="LINE_STATUS" type="STRING" size="50"/>
          <Column id="PAY_METHOD" type="STRING" size="50"/>
          <Column id="INST_PERIOD" type="STRING" size="20"/>
          <Column id="CARD_CLASS" type="STRING" size="18"/>
          <Column id="CARD_COMP" type="STRING" size="50"/>
          <Column id="CARD_NUM" type="STRING" size="4000"/>
          <Column id="VALID_THRU_MM" type="STRING" size="2"/>
          <Column id="VALID_THRU_YY" type="STRING" size="2"/>
          <Column id="STOCK_QTY" type="BIGDECIMAL" size="39"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_input" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="MU" type="STRING" size="256"/>
          <Column id="TM" type="STRING" size="256"/>
          <Column id="TMNM" type="STRING" size="256"/>
          <Column id="UPJANG" type="STRING" size="256"/>
          <Column id="UPJANGNM" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row/>
        </Rows>
      </Dataset>
    </Objects>
    <Script type="xscript4.0"><![CDATA[/*
 ******************************************************************************************
 * 시스템구분	: 구매관리>신청관리>판촉상품주문
 * 프로그램명	: FSP00010E.xfdl
 * 기      능	: 판촉상품주문
 * 작  성  자	: 백승현
 * 작성  일자	: 2015-07-06
 * 비      고	:
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */

/************************************************************************************************
 * 공통 라이브러리 INCLUDE 영역 (필수)
 ************************************************************************************************/
include "U_lib::lib_conversionCom.xjs";

/************************************************************************************************
 * FORM 변수 선언 영역 (필수)
 ************************************************************************************************/
 var v_auth1 = "N";	// 판촉 관리자
 var v_auth2 = "N"	// 판촉 정산자
 var v_row = 0;
 var v_col = 17;
 var v_spClose;
 /************************************************************************************************
 * FORM EVENT 영역 (필수)
 ************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : Form Load (필수)
 *---------------------------------------------------------------------------------------------*/
function form_onload(obj:Form, e:LoadEventInfo)
{
	// Form Load 시 공통 기능 처리(obj:Form, bCreateEvent:이벤트 생성 여부)
	gfn_formOnLoad(this);

	// FSP Action 정보 생성
	fsp_init(this);

	// 화면 초기화
	fn_init();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 화면 초기화
 *---------------------------------------------------------------------------------------------*/
function fn_init()
{
	// 업데이트 DS
	v_ds_check = "ds_list;ds_list_detail";

	// 팀, 사업장 설정
	edt_tm.applyAuthLevel(cbo_mu);
	edt_upjang.applyAuthLevel(edt_tm);

	// 공통코드
	var v_fil_cond;
	var v_ds = fn_common_code("'022', '023', '024', '028'", "", "", "non", "Y");

	// 결제수단
	v_fil_cond = "GROUP_CODE == '022'";
	v_ds.filter(v_fil_cond);
	CopyF(ds_pay, v_ds.name);	

	// 할부기간
	v_fil_cond = "GROUP_CODE == '023'";
	v_ds.filter(v_fil_cond);
	CopyF(ds_inst, v_ds.name);	

	// 카드사
	v_fil_cond = "GROUP_CODE == '024'";
	v_ds.filter(v_fil_cond);
	CopyF(ds_card, v_ds.name);	

	// 특판판매구분
	v_fil_cond = "GROUP_CODE == '028'";
	v_ds.filter(v_fil_cond);
	CopyF(ds_sale, v_ds.name);

	// 시즌
	fn_getSeasonList();
	cbo_season.index = 0;

	// 주문일자
	msk_startDate.value = fn_CurrDateWeek();
	msk_endDate.value = msk_startDate.value;

	// 마감작업
	cbo_status.value = "'주문'";

	msk_startDate.setFocus();
 
	// 판촉 정산자
	if( SCAuth.isUserRole("특판02") )
	{
		v_auth1 = "N";
		v_auth2 = "Y";
	}

	// 판촉 관리자
	if( SCAuth.isUserRole("특판03") )
	{
		v_auth1 = "Y";
		v_auth2 = "N";
	}

	// 귀속부서
	chk_sp.value = "N";
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 화면 공통 단축키 이벤트
 *---------------------------------------------------------------------------------------------*/
function frm_OnKeyDown(obj:Form, e:KeyEventInfo)
{
	gfn_formKeyDown(obj, e);

	if( e.keycode == 13 && e.fromreferenceobject == msk_endDate )
		fn_search();
}

/************************************************************************************************
 * 공통기능 FUNCTION 영역 (필수)
 ************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 조회 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_search()
{
	if( fn_chkManNull() )	return;

	ds_cond.clearData();
	ds_list.clearData();
	ds_list_detail.clearData();
	ds_list_detail2.clearData();

	var nRow = ds_cond.addRow();
	ds_cond.setColumn(nRow, "START_DATE", msk_startDate.value);
	ds_cond.setColumn(nRow, "END_DATE", msk_endDate.value);
	ds_cond.setColumn(nRow, "STATUS", cbo_status.value);
	ds_cond.setColumn(nRow, "BILL_NO", edt_billNo.text);
	ds_cond.setColumn(nRow, "SEASON_NUM", cbo_season.value);
	ds_cond.setColumn(nRow, "MU", cbo_mu.getMuCode());
	ds_cond.setColumn(nRow, "TM", edt_tm.getTmCode());
	ds_cond.setColumn(nRow, "UPJANG", edt_upjang.getUpjangCode());
	ds_cond.setColumn(nRow, "SP_CHK", chk_sp.value);

	// 취소대상일때 마감(STATUS) 컬럼 숨기기
 	grd_list.setFormatColProperty(v_col, "size", 0);
 
 	if( cbo_status.value == "'주문'" )
 	{
 		grd_list.setFormatColProperty(v_col, "size", 50);
 	}

	var strSvcID = "SEARCH";
	var strURL   = "U_svc::" + "fs/fsp/FSP00015E_T001.jsp";
	var strInDatasets  = "ds_cond=ds_cond";
	var strOutDatasets = "ds_list=ds_list";
	var strArgument   = "sType='QryLstAdm'";
		strArgument  += " ";

	var strCallbackFunc = "fn_callback";

	jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, true, true, false);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 입력 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_insert()
{

}

/*----------------------------------------------------------------------------------------------
 * 설명      : 저장 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_save()
{
	var sRtn = fn_chkData();

	if( sRtn != null )
	{
		g_Message("EE", sRtn);
		return;
	}

	if( !g_Confirm("02", '정산작업을 하시겠습니까?!') )	return;

	// 초기화
	ds_cond.clearData();
	v_spClose = "";

	var nRow = ds_cond.addRow();
	ds_cond.setColumn(nRow, "START_DATE", msk_startDate.value);
	ds_cond.setColumn(nRow, "SEASON_NUM", cbo_season.value);
	ds_cond.setColumn(nRow, "END_DATE", msk_endDate.value );
	ds_cond.setColumn(nRow, "STATUS", cbo_status.value);
	ds_cond.setColumn(nRow, "UPJANG", edt_upjang.getUpjangCode());

	ds_saveList.copyData(ds_list);
	ds_saveList.clearData();

	for( var i = 0; i < ds_list.rowcount; i++ )
	{
		if( ds_list.getColumn(i, "CHK") == 0 )	continue;

		var nRow = ds_saveList.addRow();
		ds_saveList.copyRow(nRow, ds_list, i);
	}

	var strSvcID = "SAVE";
	var strURL   = "U_svc::" + "fs/fsp/FSP00015E_T002.jsp";
	var strInDatasets  = "ds_cond=ds_cond ds_list=ds_saveList";
	var strOutDatasets = "";
	var strArgument = "sType='Close'";
	var strCallbackFunc = "fn_callback";

	jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, true, true, false);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 삭제 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_delete()
{

}

/*----------------------------------------------------------------------------------------------
 * 설명      : 출력 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_print()
{

}

/*----------------------------------------------------------------------------------------------
 * 설명      : 엑셀 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_Excel()
{
	return;
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 닫기 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_Close()
{
	this.close();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 도움말 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_help()
{

}

/************************************************************************************************
 * TRANSACTION 및 CallBack 영역 (필수)
 ************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 트랜잭션 콜백 함수
 *---------------------------------------------------------------------------------------------*/
function fn_callback(nErrorCode, strErrorMsg, strSvcID)
{
	if( nErrorCode != 0 )
	{
		g_Message("EE", fn_alertMsg("002"));
		return;
	}
	
	switch( strSvcID )
	{
		case "SEARCH":
			fn_qtyBtnCtl();

			if( ds_list.rowcount < 1 )
			{
				g_Message("EE", cbo_status.text + " 조회대상이 없습니다.");
				msk_startDate.setFocus();
			}
			break;

 		case "SAVE":
			if( !gfn_isNull(v_spClose) )
			{
				g_Message("EE", v_spClose);
				return;
			}
 		
 			g_Message("02", "정산작업" + fn_alertMsg("000"));
 			fn_search();
  			break;

 		case "CHANGE":
			if( !gfn_isNull(v_spClose) )
			{
				g_Message("EE", v_spClose);
				return;
			}

 			g_Message("02", "주문내역이 변경됐습니다.");
			fn_afterSearch();
 			break;
 
		case "AFTER_SEARCH":
			ds_list.rowposition = v_row;
			fn_afterDetail();
			break;

		case "FORWARD":
			if( !gfn_isNull(v_spClose) )
			{
				g_Message("EE", v_spClose);
				return;
			}

			g_Message("02", "선택한 상품의 매출이 이월됐습니다.");
			break;

		case "DETAIL":
				if( ds_list_detail.rowcount > 0 )
				{
					fn_qtyBtnCtl();
				}
			break;
			
		case "updateReceive" :
			g_Message("02", "고객발주정보가 수정되었습니다.");
			fn_search_detail1();
			fn_search_detail2();
			break;
 	}
}

/************************************************************************************************
 * 사용자 FUNCTION 영역 (필수)
 ************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 시즌 목록 조회
 *---------------------------------------------------------------------------------------------*/
function fn_getSeasonList()
{
	var strSvcID		= "FSP00005E_T004";
	var strURL			= "U_svc::" + "fs/fsp/FSP00005E_T004.jsp";
	var strInDatasets   = "";
	var strOutDatasets	= "ds_season=ds_season";
	var strArgument     = "";
	var strCallbackFunc	= "";

	jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, false, false, true);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 시즌 정보 조회
 *---------------------------------------------------------------------------------------------*/
function fn_getSeasonInfo()
{
	var strSvcID		= "FSP00005E_T006";
	var strURL			= "U_svc::" + "fs/fsp/FSP00005E_T006.jsp";
	var strInDatasets	= "";
	var strOutDatasets	= "ds_season=ds_season";
	var strArgument		= "sSeasonNum='"+cb_Season.value+"'";
	var strCallbackFunc	= "";

	jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, false, false, true);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 조회 필수입력 체크
 *---------------------------------------------------------------------------------------------*/
function fn_chkManNull()
{
	if( ffn_ChkNull(msk_startDate.value) || gfn_length(msk_startDate.value) < 8 )
	{
		g_Message("EE", "주문일자를 정확하게 입력하세요.");
		msk_startDate.setFocus();
		return true;
	}

	if ( ffn_ChkNull(msk_endDate.value) || gfn_length(msk_endDate.value) < 8 )
	{
		g_Message("EE", "주문일자를 정확하게 입력하세요.");
		msk_endDate.setFocus();
		return true;
	}

	return false;
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 저장 필수입력 체크
 *---------------------------------------------------------------------------------------------*/
function fn_chkData()
{
	if( ds_list.findRow("CHK", 1) < 0 )
	{
		return "정산할 항목을 선택하세요!";
	}

	if( v_auth1 == "N" && v_auth2 == "N" )
	{
		return "정산 권한이 없습니다";
	}

	for( var i = 0; i < ds_list.rowcount; i++ )
	{
		if( ds_list.getColumn(i, "CHK") == 0 )	continue;

		if( ds_list.getColumn(i, "LINE_STATUS") != "주문")
		{
			ds_list.rowposition = i;
			return "정산 대상이 아닙니다.!";
		}

		if( ffn_ChkNull(ds_list.getColumn(i, "BILL_NO")) )
		{
			ds_list.rowposition = i;
			return "영수증번호가 등록되지 않았습니다!";
		}

		if( ffn_ChkNull(ds_list.getColumn(i, "UPJANGNM")) )
		{
			ds_list.rowposition = i;
			return "신청자의 사업장이 없습니다!";
		}

		if( !ffn_ChkNull(ds_list.getColumn(i, "CARD_NUM")) )
		{
			if( ffn_ChkNull(ds_list.getColumn(i, "APPRV_NUM")) )
			{
				ds_list.rowposition = i;
				return "승인번호가 없습니다!";
			}
			
			if( ffn_ChkNull(ds_list.getColumn(i, "FRNC_STOR_NUM")) )
			{
				ds_list.rowposition = i;
				return "가맹점 번호가 없습니다!";
			}
		}
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 화면에 나타나는 메시지 코드및 텍스트 리턴
 *---------------------------------------------------------------------------------------------*/
function fn_alertMsg(msgCd)
{
	var v_Msg="";
	switch( msgCd )
	{
		case "000":
			v_Msg= "이(가) 저장되었습니다.";
			break;
		case "001":
			v_Msg= "버튼이 정의 되어 있지않습니다.";
			break;
		case "002":
			v_Msg="서비스 오류:시스템 관리자에게 문의하십시오";
			break;
		case "003":
			v_Msg="필수항목은 반드시 선택하시기 바랍니다.";
			break;
		case "004":
			v_Msg="작업대상 본사를 선택하세요.";
			break;
		case "005":
			v_Msg="을(를) 입력하세요";
			break;
		case "006":
			v_Msg="삭제할 데이터가 없습니다.";
			break;
		case "007":
			v_Msg="변경된 데이터가 없습니다.";
			break;
		case "008":
			v_Msg="시스템ID가 없습니다.";
			break;

		default:
			break;
	}

	return v_Msg;
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 수량변경 저장, 수량변경, 주문취소 버튼 컨트롤 이벤트
 *---------------------------------------------------------------------------------------------*/
function fn_qtyBtnCtl()
{
	// 매출이월 버튼 제어
	if( cbo_status.value == "'정산','배송'" && v_auth1 == "Y" )
	{
		btn_afForward.visible   = true;
		btn_bfForward.visible   = true;
	}
	else
	{
		btn_afForward.visible   = false;
		btn_bfForward.visible   = false;
	}

	// 확정, 주문변경, 주문취소 버튼 제어
	if( ds_list_detail.rowcount > 0 && v_auth1 == "Y" )
	{
		if( cbo_status.value == "'정산','배송'" && tab.tabindex == 0 )
		{
			btn_qtySave.visible	  = true;
			btn_ordChange.visible = true;
			btn_cancel.visible	  = true;
		}
		else
		{
			btn_qtySave.visible	  = false;
			btn_ordChange.visible = false;
			btn_cancel.visible	  = false;
		}
	}
	else
	{
		btn_qtySave.visible   = false;
		btn_ordChange.visible = false;
		btn_cancel.visible    = false;
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 할인액 계산
 *---------------------------------------------------------------------------------------------*/
function fn_Calcul(obj, nRow, strColumnID, varOldValue, varNewValue)
{
	var nAmt = 0;
	var nAmt2 = 0;

	// 수량할인
	if( numFormat(obj.getColumn(nRow, "QTY_DC_STD"), 1) <> "0.0" )
	{
		if( Math.abs(toNumber(obj.getColumn(nRow, "PR_QTY"))) >=  toNumber(obj.getColumn(nRow, "QTY_DC_STD")) )
			nAmt = Math.ceil(Math.abs(toNumber(obj.getColumn(nRow, "SALE_AMOUNT"))) * toNumber(obj.getColumn(nRow, "QTY_DC_RATE")) / 100);	
	}


	// 금액할인
	if( numFormat(obj.getColumn(nRow, "AMT_DC_STD"), 1) <> "0.0" )
	{
		if( Math.abs(toNumber(obj.getColumn(nRow, "SALE_AMOUNT"))) >=  toNumber(obj.getColumn(nRow, "AMT_DC_STD")) )
			nAmt2 = Math.ceil(Math.abs(toNumber(obj.getColumn(nRow, "SALE_AMOUNT"))) * toNumber(obj.getColumn(nRow, "AMT_DC_RATE")) / 100);	
	}

	obj.setColumn(nRow, "DC_AMOUNT", greatest(nAmt, nAmt2) * fn_Sign(obj.getColumn(nRow, "PR_QTY")));
}

function fn_afterSearch()
{
	ds_cond.clearData();
	ds_list.clearData();
	ds_list_detail.clearData();
	ds_list_detail2.clearData();

	var nRow = ds_cond.addRow();
	ds_cond.setColumn(nRow, "START_DATE", msk_startDate.value);
	ds_cond.setColumn(nRow, "END_DATE", msk_endDate.value);
	ds_cond.setColumn(nRow, "STATUS", cbo_status.value);
	ds_cond.setColumn(nRow, "BILL_NO", edt_billNo.text);
	ds_cond.setColumn(nRow, "SEASON_NUM", cbo_season.value);
	ds_cond.setColumn(nRow, "UPJANG", edt_upjang.getUpjangCode());

	// 취소대상일때 마감(STATUS) 컬럼 숨기기
 	grd_list.setFormatColProperty(17, "size", 0);
 
 	if( cbo_status.value == "'주문'" )
 	{
 		grd_list.setFormatColProperty(17, "size", 50);
 	}

	var strSvcID = "AFTER_SEARCH";
	var strURL   = "U_svc::" + "fs/fsp/FSP00015E_T001.jsp";
	var strInDatasets  = "ds_cond=ds_cond";
	var strOutDatasets = "ds_list=ds_list";
	var strArgument  = "sType='QryLstAdm'";
	// 팀, 사업장을 선택안했을 경우 
	if( gfn_isNull(edt_tm.getTmCode()) || gfn_isNull(edt_upjang.getUpjangCode()) )
	{
		strArgument += " v_auth1=" + wrapQuote("Y");
		strArgument += " v_auth2=" + wrapQuote("N");
	}
	else
	{
		strArgument += " v_auth1=" + wrapQuote("N");
		strArgument += " v_auth2=" + wrapQuote("Y");	
	}
	var strCallbackFunc = "fn_callback";

	jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, true, true, false);
}

function fn_afterDetail()
{
    // 초기화
    ds_cond_detail.clearData();
	ds_list_detail.clearData();
	ds_list_detail2.clearData();
	ds_saveList.clearData();
	ds_deleteList.clearData();

	var nRow = ds_cond_detail.addRow();
	ds_cond_detail.setColumn(nRow, "START_DATE", ds_list.getColumn(v_row, "SP_DATE"));
	ds_cond_detail.setColumn(nRow, "SEASON_NUM", ds_list.getColumn(v_row, "SEASON_NUM"));
	ds_cond_detail.setColumn(nRow, "PR_SABUN", ds_list.getColumn(v_row, "PR_SABUN"));
	ds_cond_detail.setColumn(nRow, "RQ_SABUN", ds_list.getColumn(v_row, "RQ_SABUN"));
	ds_cond_detail.setColumn(nRow, "PAY_METHOD", ds_list.getColumn(v_row, "PAY_METHOD"));
	ds_cond_detail.setColumn(nRow, "CARD_CLASS", ds_list.getColumn(v_row, "CARD_CLASS"));
	ds_cond_detail.setColumn(nRow, "CARD_COMP", ds_list.getColumn(v_row, "CARD_COMP"));
	ds_cond_detail.setColumn(nRow, "CARD_NUM", ds_list.getColumn(v_row, "CARD_NUM"));
	ds_cond_detail.setColumn(nRow, "INST_PERIOD", ds_list.getColumn(v_row, "INST_PERIOD"));
	ds_cond_detail.setColumn(nRow, "TAX_CODE", ds_list.getColumn(v_row, "TAX_CODE"));
	ds_cond_detail.setColumn(nRow, "BILL_NO", ds_list.getColumn(v_row, "BILL_NO"));
	ds_cond_detail.setColumn(nRow, "LINE_STATUS", ds_list.getColumn(v_row, "LINE_STATUS"));
	ds_cond_detail.setColumn(nRow, "STATUS", cbo_status.value);

	fn_search_detail1();
	fn_search_detail2();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 사업부 콤보 변경 이벤트
 *---------------------------------------------------------------------------------------------*/
function fn_muChange(obj, event)
{
	edt_tm.setTmCode("");
	edt_upjang.setUpjangCode("");
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 팀 변경 이벤트
 *---------------------------------------------------------------------------------------------*/
function fn_tmChange(obj, data)
{
	edt_upjang.setUpjangCode("");
}


/************************************************************************************************
 * 각 COMPONENT 별 EVENT 영역 (필수)
 ************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 주문내역, 결제자 상세내역 조회
 *---------------------------------------------------------------------------------------------*/
function grd_list_oncelldblclick(obj:Grid, e:GridClickEventInfo)
{
	if( ds_list.rowcount == 0 )	return;

    // 초기화
    ds_cond_detail.clearData();
	ds_list_detail.clearData();
	ds_list_detail2.clearData();
	ds_saveList.clearData();
	ds_deleteList.clearData();

	var nRow = ds_cond_detail.addRow();
	ds_cond_detail.setColumn(nRow, "START_DATE", ds_list.getColumn(e.row, "SP_DATE"));
	ds_cond_detail.setColumn(nRow, "SEASON_NUM", ds_list.getColumn(e.row, "SEASON_NUM"));
	ds_cond_detail.setColumn(nRow, "PR_SABUN", ds_list.getColumn(e.row, "PR_SABUN"));
	ds_cond_detail.setColumn(nRow, "RQ_SABUN", ds_list.getColumn(e.row, "RQ_SABUN"));
	ds_cond_detail.setColumn(nRow, "PAY_METHOD", ds_list.getColumn(e.row, "PAY_METHOD"));
	ds_cond_detail.setColumn(nRow, "CARD_CLASS", ds_list.getColumn(e.row, "CARD_CLASS"));
	ds_cond_detail.setColumn(nRow, "CARD_COMP", ds_list.getColumn(e.row, "CARD_COMP"));
	ds_cond_detail.setColumn(nRow, "CARD_NUM", ds_list.getColumn(e.row, "CARD_NUM"));
	ds_cond_detail.setColumn(nRow, "INST_PERIOD", ds_list.getColumn(e.row, "INST_PERIOD"));
	ds_cond_detail.setColumn(nRow, "TAX_CODE", ds_list.getColumn(e.row, "TAX_CODE"));
	ds_cond_detail.setColumn(nRow, "BILL_NO", ds_list.getColumn(e.row, "BILL_NO"));
	ds_cond_detail.setColumn(nRow, "LINE_STATUS", ds_list.getColumn(e.row, "LINE_STATUS"));
	ds_cond_detail.setColumn(nRow, "STATUS", cbo_status.value);

	fn_search_detail1();
	fn_search_detail2();
}

function fn_search_detail1()
{
	var strSvcID = "DETAIL";
	var strURL   = "U_svc::" + "fs/fsp/FSP00015E_T001.jsp";
	var strInDatasets  = "ds_cond=ds_cond_detail";
	var strOutDatasets = "ds_list_detail=ds_list";
	var strArgument = "sType='QryItm'";
	var strCallbackFunc = "fn_callback";

	jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, true, true, false);
}

function fn_search_detail2()
{
	var strSvcID = "DETAIL";
	var strURL   = "U_svc::" + "fs/fsp/FSP00015E_T001.jsp";
	var strInDatasets  = "ds_cond=ds_cond_detail";
	var strOutDatasets = "ds_list_detail2=ds_list";
	var strArgument = "sType='QryItm2'";
	var strCallbackFunc = "";

	jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, true, true, false);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 주문일자 변경시 그리드 클리어
 *---------------------------------------------------------------------------------------------*/
function ds_date_oncolumnchanged(obj:Dataset, e:DSColChangeEventInfo)
{
	if( e.newvalue != e.oldvalue )
	{
		ds_list.clearData();
		ds_list_detail.clearData();
		ds_list_detail2.clearData();
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 마감작업 콤보값 변경시 마감내역 재조회
 *---------------------------------------------------------------------------------------------*/
function cbo_status_onitemchanged(obj:Combo, e:ItemChangeEventInfo)
{
	fn_search();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 마감내역 데이터 변경시 체크
 *---------------------------------------------------------------------------------------------*/
function ds_list_oncolumnchanged(obj:Dataset, e:DSColChangeEventInfo)
{
	if( e.columnid != "CHK" )
		obj.setColumn(e.row, "CHK", 1);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 탭페이지 변경에 따른 버튼 컨트롤
 *---------------------------------------------------------------------------------------------*/
function tab_onchanged(obj:Tab, e:TabIndexChangeEventInfo)
{
	fn_qtyBtnCtl();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 주문변경
 *---------------------------------------------------------------------------------------------*/
function fn_ordChange(obj:Button,  e:ClickEventInfo)
{
	if( ds_list_detail.rowposition < 0 || ds_list_detail.rowcount == 0 )
	{
		g_Message("EE", "주문변경 대상이 없습니다.");
		return;
	}

	var nRow = ds_list_detail.rowposition;

	if( ds_list_detail.getColumn(nRow, "LINE_STATUS") != "정산" )
	{
		g_Message("EE", "주문변경 대상이 아닙니다.");
		return;
	}
	else
	{ 
		if( ds_list_detail.getColumn(nRow, "EDIT_YN") == "N" )
			if( !g_Confirm("02", '정산이 완료된 상품입니다.\n주문변경 하시겠습니까?') )	return;

		// tab.tabpage1.grd_list.setCellPos(6);
		// tab.tabpage1.grd_list.showEditor(true);

		var nAdmDcAmt = 0;
		if( !gfn_isNull(ds_list_detail.getColumn(ds_list_detail.rowposition, "ADM_DC_AMOUNT")) )
			nAdmDcAmt = ds_list_detail.getColumn(ds_list_detail.rowposition, "ADM_DC_AMOUNT");


		// 팝업 호출
		var args = {  v_spId:ds_list_detail.getColumn(ds_list_detail.rowposition, "SP_ID")
					, v_seasonNum:ds_list_detail.getColumn(ds_list_detail.rowposition, "SEASON_NUM")
					, v_admDcAmt:nAdmDcAmt
					, v_dsObj:ds_order
				};
		gfn_dialog("", "U_FSP::FSP00015P1.xfdl", args);

		if( ds_order.rowcount > 0 )
		{
			// 변경된 데이터가 있는지 체크하고 변경된 데이터가 없으면 EDIT_YN을 'N'으로 바꿔준다.
			var bCheck = false;
			for( var i = 0; i < ds_order.colcount; i++ )
			{
				if( ds_list_detail.getColumn(ds_list_detail.rowposition, "EDIT_YN") == "Y" )	break;

				var colNm = ds_order.getColID(i);

				if( ds_list_detail.getColumn(ds_list_detail.rowposition, colNm) != ds_order.getColumn(0, colNm) )
				{
					bCheck = true;
					break;
				}
				else
				{
					bCheck = false;
				}
			}

			if( !bCheck )	return;

			var nRow = ds_list_detail.findRow("SP_ID", ds_order.getColumn(0, "SP_ID"));

			ds_list_detail.setColumn(nRow, "PR_QTY", 		ds_order.getColumn(0, "PR_QTY"));
			ds_list_detail.setColumn(nRow, "ADM_DC_AMOUNT",	ds_order.getColumn(0, "ADM_DC_AMOUNT"));
			ds_list_detail.setColumn(nRow, "SALE_TYPE",		ds_order.getColumn(0, "SALE_TYPE"));
			ds_list_detail.setColumn(nRow, "PAY_METHOD",	ds_order.getColumn(0, "PAY_METHOD"));
			ds_list_detail.setColumn(nRow, "INST_PERIOD",	ds_order.getColumn(0, "INST_PERIOD"));
			ds_list_detail.setColumn(nRow, "CARD_CLASS",	ds_order.getColumn(0, "CARD_CLASS"));
			ds_list_detail.setColumn(nRow, "CARD_COMP", 	ds_order.getColumn(0, "CARD_COMP"));
			ds_list_detail.setColumn(nRow, "CARD_NUM", 		ds_order.getColumn(0, "CARD_NUM"));
			ds_list_detail.setColumn(nRow, "VALID_THRU_MM", ds_order.getColumn(0, "VALID_THRU_MM"));
			ds_list_detail.setColumn(nRow, "VALID_THRU_YY", ds_order.getColumn(0, "VALID_THRU_YY"));

			if( ds_order.getColumn(0, "PAY_METHOD") == "2" )
				ds_list_detail.setColumn(nRow, "CARD_YYMM",		ds_order.getColumn(0, "VALID_THRU_YY") + ds_order.getColumn(0, "VALID_THRU_MM"));
			else
				ds_list_detail.setColumn(nRow, "CARD_YYMM",		"");

			ds_list_detail.setColumn(nRow, "AR_CUSTCD",		ds_order.getColumn(0, "AR_CUSTCD"));
			ds_list_detail.setColumn(nRow, "AR_CUSTNM",		ds_order.getColumn(0, "AR_CUSTNM"));
			ds_list_detail.setColumn(nRow, "AR_SAUPNO",		ds_order.getColumn(0, "AR_SAUPNO"));
			ds_list_detail.setColumn(nRow, "AR_ADDR",		ds_order.getColumn(0, "AR_ADDR"));
			ds_list_detail.setColumn(nRow, "AR_NAME",		ds_order.getColumn(0, "AR_NAME"));
			ds_list_detail.setColumn(nRow, "AR_TEL",		ds_order.getColumn(0, "AR_TEL"));
			ds_list_detail.setColumn(nRow, "AR_EMAIL",		ds_order.getColumn(0, "AR_EMAIL"));
			ds_list_detail.setColumn(nRow, "APPRV_NUM",		ds_order.getColumn(0, "APPRV_NUM"));
			ds_list_detail.setColumn(nRow, "FRNC_STOR_NUM",	ds_order.getColumn(0, "FRNC_STOR_NUM"));
			ds_list_detail.setColumn(nRow, "EDIT_YN",		"Y");
		}
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 주문취소
 *---------------------------------------------------------------------------------------------*/
function fn_cancel(obj:Button,  e:ClickEventInfo)
{
	if( ds_list_detail.rowposition < 0 || ds_list_detail.rowcount == 0 )
	{
		g_Message("EE", "주문취소 대상이 없습니다.");
		return;
	}

	if( ds_list_detail.getColumn(ds_list_detail.rowposition, "LINE_STATUS") != "정산" )
	{
		g_Message("EE", "[" + ds_list_detail.getColumn(ds_list_detail.rowposition, "ITEM_NAME") + "] 상품은 주문취소 대상이 아닙니다.");
		return;
	}

	if( !g_Confirm("02", "[" + ds_list_detail.getColumn(ds_list_detail.rowposition, "ITEM_NAME") + "] 상품을 주문취소 하시겠습니까?!") )	return;	

	// 확정시 DB에서 삭제함.
	ds_list_detail.deleteRow(ds_list_detail.rowposition);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 확정
 *---------------------------------------------------------------------------------------------*/
function fn_detailSave(obj:Button,  e:ClickEventInfo)
{
	// 데이터셋 변경여부 확인
	if( !gfn_dsIsUpdated(ds_list_detail) )
	{
		g_Message("EE", fn_alertMsg("007"));
		return;
	}

	// 삭제된 데이터가 없고 변경된 수량이 없으면 리턴
	if( ds_list_detail.getDeletedRowCount() == 0 && ds_list_detail.findRow("EDIT_YN", "Y") < 0 )
	{
		g_Message("EE", fn_alertMsg("007"));
		return;
	}

	// 변경된 수량이 0인지 체크
	for( var i = 0; i < ds_list_detail.rowcount; i++ )
	{
		if( ds_list_detail.getColumn(i, "PR_QTY") == 0 )
		{
			g_Message("EE", "변경된 수량이 0 입니다.\n 수량을 확인하세요.");
			tab.tabpage1.grd_list.setCellPos(6);
			tab.tabpage1.grd_list.showEditor(true);
			return;
		}	
	}

	v_spClose = "";

	if( !g_Confirm("02", '확정 하시겠습니까?') )	return;

	v_row = ds_list.rowposition;

	var strSvcID = "CHANGE";
	var strURL   = "U_svc::" + "fs/fsp/FSP00015E_T003.jsp";
	var strInDatasets  = "ds_cond=ds_cond ds_list=ds_list_detail:U";
	var strOutDatasets = "";
	var strArgument = "sType='Change'";
	var strCallbackFunc = "fn_callback";

	jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, true, true, false);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 금액계산
 *---------------------------------------------------------------------------------------------*/
function ds_list_detail_oncolumnchanged(obj:Dataset, e:DSColChangeEventInfo)
{
	var nAmt;

	// 금액계산
	if( e.columnid == "PR_QTY" )
	{
		// 총 판매금액
		nAmt = Math.round(toNumber(obj.getColumn(e.row, "SALE_PRICE")) * toNumber(obj.getColumn(e.row, "PR_QTY")));
		obj.setColumn(e.row, "SALE_AMOUNT", nAmt);

		// 배송료, 할인`액 계산
		fn_Calcul(obj, e.row, e.columnid, e.oldvalue, e.newvalue);

		// 총 매출금액
		nAmt = toNumber(obj.getColumn(e.row, "SALE_AMOUNT")) - toNumber(obj.getColumn(e.row, "DC_AMOUNT")) - toNumber(obj.getColumn(e.row, "ADM_DC_AMOUNT"));
		obj.setColumn(e.row, "TOT_AMOUNT", nAmt);
	}

	if( e.columnid == "ADM_DC_AMOUNT" )
	{
		// 총 매출금액
		nAmt = toNumber(obj.getColumn(e.row, "SALE_AMOUNT")) - toNumber(obj.getColumn(e.row, "DC_AMOUNT")) - toNumber(obj.getColumn(e.row, "ADM_DC_AMOUNT"));
		obj.setColumn(e.row, "TOT_AMOUNT", nAmt);
	}
}

function edt_billNo_onkeydown(obj:Edit, e:KeyEventInfo)
{
	if( e.keycode == 13 )	fn_search();
}

function grd_list_onexpandup(obj:Grid, e:GridMouseEventInfo)
{
	var frncStorNum = "";
		// 팝업 호출
	var args = {  v_rqSabun:ds_list.getColumn(ds_list.rowposition, "PR_SABUN") 
				, v_frncStorNum:frncStorNum
				, v_scrn:"18E"
			};
	var rtn = gfn_dialog("", "U_FSP::FSP00015P2.xfdl", args);

	// 가맹점 번호
	if( !gfn_isNull(rtn) )
	{
		ds_list.setColumn(e.row, "FRNC_STOR_NUM", rtn);
	}
	else
	{
		ds_list.setColumn(e.row, "FRNC_STOR_NUM", "");
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 매출 차기이월
 *---------------------------------------------------------------------------------------------*/
function fn_afForward(obj:Button,  e:ClickEventInfo)
{
	// 매출월 확인
	if( ds_list.findRow("CHK", 1) < 0 )
	{
		g_Message("EE", "항목을 선택하세요.");
		return;
	}

	if( !g_Confirm("02", "매출 차기 이월을 하시겠습니까?") )	return;
	// 초기화
	ds_cond.clearData();
	v_spClose = "";

	var nRow = ds_cond.addRow();
	ds_cond.setColumn(nRow, "START_DATE", msk_startDate.value);
	ds_cond.setColumn(nRow, "SEASON_NUM", cbo_season.value);
	ds_cond.setColumn(nRow, "END_DATE", msk_endDate.value );
	ds_cond.setColumn(nRow, "STATUS", cbo_status.value);
	ds_cond.setColumn(nRow, "UPJANG", edt_upjang.getUpjangCode());

	ds_saveList.copyData(ds_list);
	ds_saveList.clearData();

	for( var i = 0; i < ds_list.rowcount; i++ )
	{
		if( ds_list.getColumn(i, "CHK") == 0 )	continue;

		var nRow = ds_saveList.addRow();
		ds_saveList.copyRow(nRow, ds_list, i);
	}

	var strSvcID = "FORWARD";
	var strURL   = "U_svc::" + "fs/fsp/FSP00015E_T004.jsp";
	var strInDatasets  = "ds_cond=ds_cond ds_list=ds_saveList";
	var strOutDatasets = "";
	var strArgument = "sType='Forward'";
	var strCallbackFunc = "fn_callback";

	jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, true, true, false);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 매출 전기이월
 *---------------------------------------------------------------------------------------------*/
function fn_bfForward(obj:Button,  e:ClickEventInfo)
{
	// 매출월 확인
	if( ds_list.findRow("CHK", 1) < 0 )
	{
		g_Message("EE", "항목을 선택하세요.");
		return;
	}

	if( !g_Confirm("02", "매출 전기 이월을 하시겠습니까?") )	return;
	// 초기화
	ds_cond.clearData();
	v_spClose = "";

	var nRow = ds_cond.addRow();
	ds_cond.setColumn(nRow, "START_DATE", msk_startDate.value);
	ds_cond.setColumn(nRow, "SEASON_NUM", cbo_season.value);
	ds_cond.setColumn(nRow, "END_DATE", msk_endDate.value );
	ds_cond.setColumn(nRow, "STATUS", cbo_status.value);
	ds_cond.setColumn(nRow, "UPJANG", edt_upjang.getUpjangCode());

	ds_saveList.copyData(ds_list);
	ds_saveList.clearData();

	for( var i = 0; i < ds_list.rowcount; i++ )
	{
		if( ds_list.getColumn(i, "CHK") == 0 )	continue;

		var nRow = ds_saveList.addRow();
		ds_saveList.copyRow(nRow, ds_list, i);
	}

	var strSvcID = "FORWARD";
	var strURL   = "U_svc::" + "fs/fsp/FSP00015E_T005.jsp";
	var strInDatasets  = "ds_cond=ds_cond ds_list=ds_saveList";
	var strOutDatasets = "";
	var strArgument = "sType='Forward'";
	var strCallbackFunc = "fn_callback";

	jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, true, true, false);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 귀속부서 체크 이벤트
 *---------------------------------------------------------------------------------------------*/
function chk_sp_onchanged(obj:CheckBox, e:CheckBoxChangeEventInfo)
{
	// 귀속부서를 체크하면 사업부, 팀, 사업장을 초기화 한다.
	if( e.postvalue == "Y" )
	{
		cbo_mu.setMuCode("");
		edt_tm.setTmCode("");
		edt_upjang.setUpjangCode("");
		cbo_mu.enable = false;
		edt_tm.enable = false;
		edt_upjang.enable = false;
	}
	else
	{
		cbo_mu.enable = true;
		edt_tm.enable = true;
		edt_upjang.enable = true;
	}
}

function btn_saveReceive_onclick(obj:Button,  e:ClickEventInfo) {
	fn_saveReceive();
}

function fn_saveReceive() {
	
	if ( ds_list_detail.rowcount == 0 || !gfn_dsIsUpdated(ds_list_detail) ) {
		g_Message("EE", "저장할 데이터가 없습니다.");
		return;
	}

	var strSvcID = "updateReceive";
	var strURL   = "U_svc::fs/fsp/FSP00015E_T006.jsp";
	var strInDatasets  = "ds_list_detail=ds_list_detail:U";
	var strOutDatasets = "";
	var strArgument = "sType='Receive'";
	var strCallbackFunc = "fn_callback";

	jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, true, true, false);
}
]]></Script>
  </Form>
</FDL>
