<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="../../../default_typedef.xml"/>
  <Form id="FMS00112E" onload="form_onload" titletext="사업장 정보관리(본사)-설정관리" position="absolute 0 0 631 535" scrollbars="none">
    <Layouts>
      <Layout>
        <Static id="sta_detail05" class="sta_WFDA_Labelbg" position="absolute 469 89 622 116" anchor="default"/>
        <Static id="Static3" text="결  재  자  4" position="absolute 469 89 622 116" class="sta_WFDA_Label01" style="align:center middle;" anchor="default"/>
        <Static id="sta_detail04" class="sta_WFDA_Labelbg" position="absolute 153 31 622 58" anchor="default"/>
        <Static id="sta_detail01" class="sta_WFDA_Labelbg" position="absolute 163 115 317 142"/>
        <Static id="sta_detail02" class="sta_WFDA_Labelbg" position="absolute 316 115 470 142"/>
        <Static id="sta_detail03" class="sta_WFDA_Labelbg" position="absolute 469 115 622 142" anchor="default"/>
        <Static id="sta_detail00" class="sta_WFDA_Labelbg" position="absolute 10 115 164 142"/>
        <Static id="Static0" text="결  재  자  1" position="absolute 10 89 164 116" class="sta_WFDA_Label01" style="align:center middle;"/>
        <Static id="Static1" text="결  재  자  2" position="absolute 163 89 317 116" class="sta_WFDA_Label01" style="align:center middle;"/>
        <Static id="Static2" text="결  재  자  3" position="absolute 316 89 470 116" class="sta_WFDA_Label01" style="align:center middle;"/>
        <Edit id="ed_SIGN4" taborder="11" position="absolute 472 118 619 139"/>
        <Edit id="ed_SIGN3" taborder="10" position="absolute 319 118 467 139"/>
        <Edit id="ed_SIGN2" taborder="9" position="absolute 166 118 314 139"/>
        <Edit id="ed_SIGN1" taborder="8" position="absolute 13 118 161 139"/>
        <Static id="Static7" text="공급업체 단가업장" position="absolute 10 31 154 58" class="sta_WFDA_Label01"/>
        <Radio codecolumn="CODE" columncount="2" datacolumn="code_name" id="rdo_OTCUST_UPJANG_TYPE" index="-1" innerdataset="ds_OtcustType" taborder="1" position="absolute 444 35 616 53" anchor="default">
          <Dataset id="innerdataset">
            <ColumnInfo>
              <Column id="codecolumn" size="256"/>
              <Column id="datacolumn" size="256"/>
            </ColumnInfo>
            <Rows>
              <Row>
                <Col id="codecolumn">1</Col>
                <Col id="datacolumn">대표업장</Col>
              </Row>
              <Row>
                <Col id="codecolumn">2</Col>
                <Col id="datacolumn">대상업장</Col>
              </Row>
            </Rows>
          </Dataset>
        </Radio>
        <Edit id="ed_OTCUST_PRICE_UPJANG_NM" onkeydown="ed_pop_OnKeyDown" readonly="true" taborder="2" userdata="btn_pop6" position="absolute 157 34 330 55"/>
        <Static id="Static6" text="공급업체 및 단가작업 설정" position="absolute 10 13 195 31" class="sta_WF_Title01"/>
        <Static id="Static8" text="결재라인 설정" position="absolute 10 71 120 89" class="sta_WF_Title01"/>
        <Static id="Static38" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 0 0 505 13" anchor="left top"/>
        <Static id="Static41" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 17 26 467 31" anchor="left top"/>
        <Static id="Static07" text="w10" class="Guide01_AreaRed" visible="false" position="absolute 0 40 10 535"/>
        <Static id="Static40" text="w10" class="Guide01_AreaRed" visible="false" position="absolute 638 10 648 535"/>
        <Static id="Static39" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 20 525 595 535" anchor="left top"/>
        <Static id="Static26" text="h06" class="Guide01_AreaRed" visible="false" position="absolute 526 0 610 6" anchor="top right"/>
        <Static id="Static05" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 3 58 508 71" anchor="left top"/>
        <Static id="Static09" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 20 84 470 89" anchor="left top"/>
        <Button id="btn_pop6" taborder="12" onclick="btn_pop6_OnClick" class="btn_WF_popSearch" visible="false" position="absolute 329 34 349 55"/>
        <Static id="sta_detail06" class="sta_WFDA_Labelbg" position="absolute 311 173 623 200" anchor="default"/>
        <Static id="sta_detail07" class="sta_WFDA_Labelbg" position="absolute 311 199 623 226" anchor="default"/>
        <Static id="sta_detail08" class="sta_WFDA_Labelbg" position="absolute 311 225 623 274" anchor="default"/>
        <Static id="st_bk1" class="sta_WFDA_AddBg" position="absolute 10 173 183 370"/>
        <ImageViewer id="img_photo" taborder="13" stretch="fit" class="img_WF_NoImage" position="absolute 14 176 179 341" onclick="img_photo_OnClick"/>
        <Static id="st_text" text="* 이미지 사이즈 : 163 * 165 &#10;&#10; (이미지는 확장자를 .jpg 파일로 저장 해 주시기 바랍니다. &#10;  추가/삭제 후 반드시 저장 버튼을 눌러 부시기 바랍니다.)" class="sta_WF_DiscPointN" position="absolute 192 312 552 370"/>
        <Static id="Static73" text="사업자번호" class="sta_WFDA_Label01" position="absolute 192 173 312 200"/>
        <Static id="Static54" text="대  표  자" class="sta_WFDA_Label01" position="absolute 192 199 312 226"/>
        <Edit id="ed_DRNAME" taborder="14" position="absolute 314 202 620 223"/>
        <Static id="Static56" text="현  주  소" class="sta_WFDA_Label01" position="absolute 192 225 312 274"/>
        <Edit id="ed_SAUPNO" taborder="16" position="absolute 314 176 620 197"/>
        <Static id="Static04" text="인장" position="absolute 19 344 46 357"/>
        <Static id="Static10" text="이미지" position="absolute 19 358 60 371"/>
        <Button id="btn_UploadImg" taborder="17" text="첨부" onclick="btn_UploadImg_OnClick" class="btn_WF_P" position="absolute 95 344 136 365" defaultbutton="false" image=""/>
        <Button id="btn_DeleteImg" taborder="18" text="삭제" onclick="btn_DeleteImg_OnClick" class="btn_WF_P" position="absolute 138 344 179 365" image=""/>
        <Static id="Static12" text="거래명세서 설정" class="sta_WF_Title01" position="absolute 10 155 128 173"/>
        <Static id="Static13" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 16 142 591 155" anchor="left top"/>
        <Static id="Static15" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 26 168 476 173" anchor="left top"/>
        <Static id="Static18" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 19 370 594 383" anchor="left top"/>
        <AddrSearchComponent id="comp_addr2" titletext="주소검색 Component" taborder="19" text="AddrSearchComponent00" class="edt_WF" position="absolute 314 228 620 271" bindDataset="ds_main" isAutoDatasetRowChangedEvent="true" bindAddrColumn="ADDR2_INFO" eventBeforeTrigger="" eventAfterTrigger="" bindAddrKeyColumn="ADDR2_KEY" isReadOnly="false"/>
      </Layout>
    </Layouts>
    <Bind>
      <BindItem id="ed_SIGN4_value" compid="ed_SIGN4" propid="value" datasetid="ds_main" columnid="SIGN4"/>
      <BindItem id="ed_SIGN3_value" compid="ed_SIGN3" propid="value" datasetid="ds_main" columnid="SIGN3"/>
      <BindItem id="ed_SIGN2_value" compid="ed_SIGN2" propid="value" datasetid="ds_main" columnid="SIGN2"/>
      <BindItem id="ed_SIGN1_value" compid="ed_SIGN1" propid="value" datasetid="ds_main" columnid="SIGN1"/>
      <BindItem id="rdo_OTCUST_UPJANG_TYPE_value" compid="rdo_OTCUST_UPJANG_TYPE" propid="value" datasetid="ds_main" columnid="OTCUST_UPJANG_TYPE"/>
      <BindItem id="ed_OTCUST_PRICE_UPJANG_NM_value" compid="ed_OTCUST_PRICE_UPJANG_NM" propid="value" datasetid="ds_main" columnid="OTCUST_PRICE_UPJANG_NM"/>
      <BindItem id="item1" compid="sta_detail01" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item2" compid="sta_detail02" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item3" compid="sta_detail03" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item0" compid="sta_detail00" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item4" compid="sta_detail04" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item5" compid="sta_detail05" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item6" compid="sta_detail06" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item7" compid="sta_detail07" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="item8" compid="sta_detail08" propid="text" datasetid="ds_view" columnid="D_1"/>
      <BindItem id="ed_DRNAME_value" compid="ed_DRNAME" propid="value" datasetid="ds_main" columnid="DRNAME"/>
      <BindItem id="ed_SAUPNO_value" compid="ed_SAUPNO" propid="value" datasetid="ds_main" columnid="SAUPNO"/>
    </Bind>
    <Script type="xscript4.0"><![CDATA[include "U_lib::lib_conversionCom.xjs";
/*
 ******************************************************************************************
 * 시스템구분   : 기준정보/사업장관리/사업장 정보관리(본사)-설정관리
 * 프로그램명   : FMS00112E.XML
 * 기      능   : 사업장 정보관리(본사)
 * 작  성  자   : 박지영
 * 작성  일자   : 2007-11-26
 * 비      고   : 
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
//=========================================================================================
// [ PART 6 ]
// component Event 정의 ( User Define function )
// --> component Event의 기요,기능,동작 등 상세내용은 MiPlatform 메뉴얼을 참조하시기 바랍니다.
//=========================================================================================

/*
 ******************************************************************************************
 * 함  수  명   : ed_pop_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam)
 * 기      능   : 업장엔터시팝업
 * 작  성  자   : 박지영
 * 작성  일자   : 2007-12-18  
 ******************************************************************************************
 */
function ed_pop_OnKeyDown(obj:Edit, e:KeyEventInfo)
{
	var strValue = ds_main.getColumn(ds_main.rowposition,"OTCUST_UPJANG_TYPE");
	if (strValue == "대상업장")
	{
		/*if (e.keycode == 13 )
		{
			var objme = eval(obj.userdata);
			objme.click();
		}*/
	}
}

/*
 ******************************************************************************************
 * 함  수  명   : btn_pop6_OnClick(obj)
 * 기      능   : 타거래처 단가업장 팝업이미지 클릭
 * 작  성  자   : 박지영
 * 작성  일자   : 2007-11-20  
 ******************************************************************************************
 */
function btn_pop6_OnClick(obj:Button, e:ClickEventInfo)
{
	var strReturn,strResult,nRow,strMainUpjang;
	
	nRow = ds_main.rowposition;
	//trace(ds_main.getColumn(nRow,"MAIN_UPJANG"));
	strMainUpjang 	= ds_main.getColumn(nRow,"MAIN_UPJANG");
	strUpjang		= ds_main.getColumn(nRow,"UPJANG");
	
	if (strMainUpjang<=0)
	{
		g_Message("EE", "본사그룹을 입력해주십시오.");
		tab_list.tabindex = 0;
		tab_list.tab1.ed_MAIN_UPJANG.setFocus();
		return;
	}
	
	// 팝업
	var arg ={strUpjang:strUpjang,strMainUpjang:strMainUpjang};
	strReturn = gfn_dialog("", "U_FMS::FMS00102P.xfdl",arg);
	
	if (gfn_length(strReturn)==0)
	{
		ds_main.setColumn(nRow, "OTCUST_PRICE_UPJANG", "");			// 단가업장
		ds_main.setColumn(nRow, "OTCUST_PRICE_UPJANG_NM", "");		// 단가업장명
		return;
	}
	
	strResult	= gfn_split(strReturn, ";");
	
	// 초기값 셋팅
	ds_main.setColumn(nRow, "OTCUST_PRICE_UPJANG", gfn_trim(strResult[0]));			// 단가업장
	ds_main.setColumn(nRow, "OTCUST_PRICE_UPJANG_NM", gfn_trim(strResult[1]));		// 단가업장명
	//rdo_OTCUST_OP_RATE_YN.SetFocus();
}

/*
 ******************************************************************************************
 * 함  수  명   : btn_UploadImg_OnClick(obj)
 * 기      능   : 파일추가
 * 작  성  자   : 노규완
 * 작성  일자   : 2008-08-27
 ******************************************************************************************
 */
function btn_UploadImg_OnClick(obj:Button, e:ClickEventInfo)
{	

//*******************************************************************************
// 조회 된 데이터가 하나도 없을 경우. return;	
	if(ds_main.getRowCount()==0)
	{
		return;
	} 
// 이미지를 저장 하기 위해서는 반드시 매출처 코드가 존재 해야 합니다.	
	if(gfn_length(gfn_trim(ds_main.getColumn(ds_main.rowposition,"UPJANG")))== 0)
	{
		g_Message("EE","이미지를 저장 하기 위해서는 반드시 매출처 코드가 존재 해야 합니다.");
		return;
	}
//	기존 등록 된 도장 이미지가 있을 경우 삭제 후 등록 하도록 한다.
	//if(gfn_length(gfn_trim(ds_main.getColumn(0,"STAMP_IMG")))>0)
	if(gfn_length(gfn_trim(ds_main.getColumn(ds_main.rowposition,"STAMP_IMG")))>0)
	{
		g_Message("EE","기존 도장 이미지를 삭제 하고 첨부하세요.");
		return;
	}	
	
// FileDialog 가 Open 상태가 false 이면 return; 시킨다.	
	if(fileDialog.Open()==false)
	{
		//g_Message("EE","FileDialog 가 False 입니다.");
		return;
	}

	var v_filename=fileDialog.FileName;
	var v_filepath=fileDialog.FilePath;	
	
// 파일명이 없거나 null 일때 return;	
	if(gfn_length(gfn_trim(v_filename))==0 || gfn_trim(v_filename)==null)
	{
		return;
	}
	
	var v_point_index=gfn_indexOf(v_filename,".");
	var v_ext=gfn_subStr(v_filename,v_point_index);

	var v_path="";
	var v_savenm="";
	
	v_path="FMS_UPJANG_STAMP";	
	v_savenm=ds_main.getColumn(ds_main.rowposition,"UPJANG")+v_ext;	

	// 파일 서버로 전송

	var arr = fsp_fileWrite(HttpFile, v_path, v_filepath, v_filename,v_savenm,"U");

	// 처리 결과 확인하기 
    if( arr[0] == "E" ) {
		gfn_alert(fn_AlertMsg("018"));
		return;
    }
	else
	{
//		ds_main.SetColumn(ds_main.row,"STAMP_IMG",v_filename);
//		ds_main.setColumn(ds_main.rowposition,"STAMP_IMG",v_savenm);	//As-Is
		ds_main.setColumn(ds_main.rowposition,"STAMP_IMG",arr[2]);	//To-Be
				
		/******************************************************
		 *  서버에서 실제 이미지 경로 가져오기 
		 * @param  serverSaveDir  서버에 저장할 디렉토리 별명 
		 * @param  fileName  보여줄 파일명 ( 옵션 )
		 * @return  서버 전제 url 경로
		 ******************************************************/
		 img_photo.text=""; 		 
		 img_photo.image=fsp_getServerDir(v_path,arr[2]);
		 //trace(fsp_getServerDir(v_path,arr[2]));		 
		 
		 img_photo.image=fsp_getServerDir(v_path,ds_main.getColumn(ds_main.rowposition,"STAMP_IMG"));		 
	}
		
}

function btn_DeleteImg_OnClick(obj:Button, e:ClickEventInfo)
{
	var v_path="";
	v_path="FMS_UPJANG_STAMP";	

	if(gfn_length(gfn_trim(ds_main.getColumn(ds_main.rowposition,"UPJANG")))>0)
	{
		if (! g_Confirm("03","등록된 업장인장 이미지를 식제하시겠습니까?!")) return;

		var v_rtn=fsp_fileDelete(v_path, ds_main.getColumn(ds_main.rowposition,"STAMP_IMG"),true);
		//alert("v_rtn==>"+v_rtn);
		
		//if(v_rtn == "true"){			
			ds_main.setColumn(ds_main.rowposition,"STAMP_IMG","");
			tab_list.tab2.img_photo.image="";
		/*
		}else{			
			if(gfn_trim(ds_main.getColumn(ds_main.rowposition,"STAMP_IMG")) == gfn_length(gfn_trim(null))==0)
			{			   
				return;
			}
			else
			{
				//gfn_alert(fn_AlertMsg("017"));	//fn_AlertMsg함수 존재하지않음			
			}
			return;
		}
		*/
	}		
}

/*
 ******************************************************************************************
 * 함  수  명   : common_imgphoto_OnClick(obj,nX,nY)
 * 기      능   : 이미지클릭
 * 작  성  자   : 노규완
 * 작성  일자   : 2008-08-27
 ******************************************************************************************
 */
function img_photo_OnClick(obj,nX,nY)
{
	if (gfn_length(obj.image)> 0)
	{
		gfn_dialog("", "U_SCC::SCC91000P.xfdl",{fa_Image:obj.image});
		//ExecBrowser(obj.ImageID);
	}	
}]]></Script>
  </Form>
</FDL>
