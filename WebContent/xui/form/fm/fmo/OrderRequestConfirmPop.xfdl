<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="..\..\..\default_typedef.xml"/>
  <Form id="OrderRequestConfirmPop" classname="COMP_GUIDE_13" inheritanceid="" position="absolute 0 0 1268 679" titletext="주문조정" scrollbars="autovert" onload="form_onload" onsize="OrderRequestConfirmPop_onsize">
    <Layouts>
      <Layout>
        <Static id="Static06" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1253 0 1268 487" anchor="top right"/>
        <Static id="Static71" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 664 1064 679" anchor="left bottom"/>
        <Static id="Static18" text="주문조정정보" class="sta_WF_Title01" position="absolute 15 120 450 138" anchor="left top"/>
        <Static id="Static19" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 0 107 450 120"/>
        <Static id="Static20" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 0 133 450 138" anchor="left top"/>
        <Grid id="grd_list" taborder="12" binddataset="ds_list" autoenter="select" useinputpanel="false" cellsizingtype="col" position="absolute 15 138 1252 640" anchor="all" autofitbandtype="allband" autofittype="none" selecttype="multirow">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="47"/>
                <Column size="47"/>
                <Column size="94"/>
                <Column size="84"/>
                <Column size="158"/>
                <Column size="163"/>
                <Column size="55"/>
                <Column size="53"/>
                <Column size="82"/>
                <Column size="54"/>
                <Column size="54"/>
                <Column size="82"/>
                <Column size="91"/>
                <Column size="69"/>
                <Column size="156"/>
                <Column size="155"/>
                <Column size="70"/>
                <Column size="200"/>
              </Columns>
              <Rows>
                <Row size="26" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell displaytype="normal" edittype="none" style="background:#566572ff URL('theme://convertImages/new/img_WF_Excel.png') center middle;" class="head_Excel"/>
                <Cell col="1" displaytype="text" edittype="none" text="선택"/>
                <Cell col="2" text="신청번호"/>
                <Cell col="3" text="자재코드"/>
                <Cell col="4" text="자재명"/>
                <Cell col="5" text="규격"/>
                <Cell col="6" text="단위"/>
                <Cell col="7" text="과세"/>
                <Cell col="8" text="입고일자"/>
                <Cell col="9" text="신청량"/>
                <Cell col="10" text="결의량"/>
                <Cell col="11" text="판매단가"/>
                <Cell col="12" text="판매금액"/>
                <Cell col="13" text="센터"/>
                <Cell col="14" text="사업장"/>
                <Cell col="15" text="업체"/>
                <Cell col="16" text="구매상태"/>
                <Cell col="17" text="비고"/>
              </Band>
              <Band id="body">
                <Cell style="background:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');background2:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');" expr="currow+1"/>
                <Cell col="1" displaytype="checkbox" edittype="checkbox" style="background:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');background2:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');" text="bind:chk"/>
                <Cell col="2" displaytype="text" style="align:center middle;background:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');background2:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');" text="bind:prNum"/>
                <Cell col="3" displaytype="text" style="align:center middle;background:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');background2:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');" text="bind:itemCode"/>
                <Cell col="4" displaytype="text" style="background:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');background2:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');" text="bind:itemName"/>
                <Cell col="5" style="align:left middle;background:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');background2:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');" text="bind:itemSize"/>
                <Cell col="6" style="align:center middle;background:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');background2:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');" text="bind:itemUnit"/>
                <Cell col="7" style="align:center middle;background:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');background2:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');" text="expr:iif(taxCode == '100','과세','면세')"/>
                <Cell col="8" displaytype="date" style="align:center;background:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');background2:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');" text="bind:needDate"/>
                <Cell col="9" displaytype="number" edittype="none" style="background:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');background2:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');" text="bind:prQty" mask="#,##0.#0" editautoselect="true"/>
                <Cell col="10" displaytype="number" edittype="none" style="background:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');background2:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');" text="bind:poQty" mask="#,##0.#0" editautoselect="true"/>
                <Cell col="11" displaytype="number" style="background:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');background2:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');" text="bind:salePrice" mask="#,##0.#0"/>
                <Cell col="12" displaytype="number" style="background:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');background2:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');" text="expr:salePrice*poQty" mask="#,##0.#0"/>
                <Cell col="13" displaytype="text" text="bind:centerName"/>
                <Cell col="14" displaytype="text" style="align:left middle;background:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');background2:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');" text="bind:upjangnm"/>
                <Cell col="15" style="align:left middle;background:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');background2:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');" text="bind:custNm"/>
                <Cell col="16" style="align:center middle;background:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');background2:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');" text="bind:poLineStatusNm"/>
                <Cell col="17" displaytype="text" edittype="normal" style="background:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');background2:EXPR(valUnsCnt=='UK'?'darkgray':valStpCnt=='TK'?'darkgray':poNoStatus=='Y'?'gold':'');" text="bind:prRemark"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Static id="Static08" class="sta_WFSA_Labelbg" position="absolute 15 40 1252 107" anchor="left top right"/>
        <Static id="Static04" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 40 93 50" anchor="left top"/>
        <Static id="Static07" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 10 15 61" anchor="left top"/>
        <Static id="Static15" text="입고일자" class="sta_WFSA_label" position="absolute 31 50 93 71" anchor="left top"/>
        <Static id="Static00" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 92 50 102 71" anchor="left top"/>
        <Static id="Static09" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 302 40 332 80" anchor="left top"/>
        <Static id="Static28" text="센터" class="sta_WFSA_label" position="absolute 31 76 66 97" anchor="left top"/>
        <Static id="Static10" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 399 51 409 72" anchor="left top"/>
        <Static id="Static01" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 260 75 290 96" anchor="left top"/>
        <Static id="Static03" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 397 40 490 50" anchor="left top"/>
        <Static id="Static11" text="업체" class="sta_WFSA_label" position="absolute 646 76 683 97" anchor="left top"/>
        <Static id="Static12" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 689 75 699 96" anchor="left top"/>
        <Static id="Static13" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 881 74 911 95" anchor="left top"/>
        <Static id="Static14" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 858 41 951 51" anchor="left top"/>
        <Static id="Static16" text="h05" class="Guide01_AreaRed" visible="false" position="absolute 1166 133 1250 138" anchor="top right"/>
        <Static id="Static17" text="h06" class="Guide01_AreaRed" visible="false" position="absolute 1166 107 1250 113" anchor="top right"/>
        <Static id="Static26" text="w02" class="Guide01_AreaRed" visible="false" position="absolute 1248 113 1250 133" anchor="top right"/>
        <Static id="Static21" text="사업장" class="sta_WFSA_label" position="absolute 349 76 411 97" anchor="left top"/>
        <Static id="Static22" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 399 75 409 96" anchor="left top"/>
        <Static id="Static24" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 627 40 720 50" anchor="left top"/>
        <Static id="Static23" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 615 75 645 96" anchor="left top"/>
        <ObjCalendar id="cal_fromDate" titletext="캘린더" taborder="0" text="20150101" scrollbars="none" position="absolute 102 50 202 71"/>
        <Static id="Static02" text="~" position="absolute 203 53 219 72" style="align:center middle;"/>
        <ObjCalendar id="cal_toDate" titletext="캘린더" taborder="1" text="20150101" scrollbars="none" position="absolute 217 50 317 71"/>
        <Combo id="cbo_centerCode" taborder="5" innerdataset="ds_center" codecolumn="centerCode" datacolumn="centerName" class="cmb_WF_Essential" position="absolute 830 12 988 33" anchor="left top" visible="false"/>
        <UpjangSearchComponent id="comp_upjang" titletext="업장 검색용 Component" taborder="6" text="UpjangSearchComponent00" position="absolute 409 76 614 97" bindDataset="ds_search" bindUpjangCodeColumn="schUpjang" bindUpjangNameColumn="schUpjangNm" eventBeforeTrigger="" eventAfterTrigger="" roleSetId="FmsUpjang"/>
        <Static id="Static25" text="h10" class="Guide01_AreaRed" visible="false" position="absolute -1 96 92 106" anchor="left top"/>
        <Static id="Static27" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 14 75 29 96" anchor="left top"/>
        <Static id="Static30" text="신청번호" class="sta_WFSA_label" position="absolute 646 52 708 73" anchor="left top" visible="true"/>
        <Edit id="edt_prNum" taborder="3" readonly="false" onkeydown="edt_upjang_onkeydown" position="absolute 717 51 857 72" style=":disabled {cursor:arrowwait;}" userdata="" visible="true"/>
        <Static id="Static33" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 92 75 102 96" anchor="left top"/>
        <Static id="Static34" text="선발주" class="sta_WFSA_label" position="absolute 349 50 411 71" anchor="left top"/>
        <Combo id="cbo_preOrder" taborder="2" codecolumn="codecolumn" datacolumn="datacolumn" index="0" position="absolute 409 50 492 71" anchor="left top" text="전체">
          <Dataset id="innerdataset">
            <ColumnInfo>
              <Column id="codecolumn" size="256"/>
              <Column id="datacolumn" size="256"/>
            </ColumnInfo>
            <Rows>
              <Row>
                <Col id="codecolumn"/>
                <Col id="datacolumn">전체</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1</Col>
                <Col id="datacolumn">D-1</Col>
              </Row>
              <Row>
                <Col id="codecolumn">2</Col>
                <Col id="datacolumn">D-2</Col>
              </Row>
              <Row>
                <Col id="codecolumn">3</Col>
                <Col id="datacolumn">D-3</Col>
              </Row>
              <Row>
                <Col id="codecolumn">4</Col>
                <Col id="datacolumn">D-4</Col>
              </Row>
              <Row>
                <Col id="codecolumn">5</Col>
                <Col id="datacolumn">D-5</Col>
              </Row>
              <Row>
                <Col id="codecolumn">6</Col>
                <Col id="datacolumn">D-6</Col>
              </Row>
              <Row>
                <Col id="codecolumn">7</Col>
                <Col id="datacolumn">D-7</Col>
              </Row>
              <Row>
                <Col id="codecolumn">8</Col>
                <Col id="datacolumn">D-8</Col>
              </Row>
              <Row>
                <Col id="codecolumn">9</Col>
                <Col id="datacolumn">D-9</Col>
              </Row>
            </Rows>
          </Dataset>
        </Combo>
        <Static id="Static82" text="W05." visible="false" position="absolute 14 71 1014 76" anchor="left top" style="background:#ff000055;align:center middle;"/>
        <Static id="Static05" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 0 1050 10"/>
        <Static id="sta_title" text="주문조정" class="sta_WF_Title" position="absolute 15 16 341 40"/>
        <Static id="Static29" text="아이콘기준 h08" class="Guide01_AreaRed" visible="false" position="absolute 15 32 215 40"/>
        <Button id="btn_search" taborder="13" text="조회" class="btn_WF_CRUD" position="absolute 1017 10 1062 35" anchor="top right" onclick="fn_search"/>
        <Button id="btn_save" taborder="14" text="결의" class="btn_WF_CRUD" position="absolute 1064 10 1109 35" anchor="top right" onclick="fn_save"/>
        <Button id="btn_return" taborder="15" text="반려" onclick="btn_return_onclick" class="btn_WF_CRUD" position="absolute 1111 10 1156 35" anchor="top right"/>
        <Button id="btn_close" taborder="16" text="닫기" class="btn_WF_CRUD" position="absolute 1205 10 1250 35" anchor="top right" onclick="fn_close"/>
        <Static id="Static35" text="W102" visible="false" position="absolute 1156 10 1158 35" anchor="top right" style="background:#ff000055;align:center middle;"/>
        <Static id="Static36" text="W102" visible="false" position="absolute 1109 9 1111 34" anchor="top right" style="background:#ff000055;align:center middle;"/>
        <Static id="Static37" text="W102" visible="false" position="absolute 1062 8 1064 33" anchor="top right" style="background:#ff000055;align:center middle;"/>
        <Button id="btn_update" taborder="17" text="저장" class="btn_WF_CRUD" position="absolute 1158 10 1203 35" anchor="top right" onclick="btn_update_onclick" visible="true"/>
        <Static id="st_Credit" text="발주가능금액" class="sta_WFDA_Label01" visible="false" position="absolute 316 12 408 33"/>
        <Edit id="ed_credit" taborder="18" tabstop="false" autoselect="true" enable="false" visible="false" position="absolute 418 12 528 33" style="align:right; :disabled {background:#ffffffff;color:red;}"/>
        <Static id="st_Bond" text="채권잔액" class="sta_WFDA_Label01" visible="false" position="absolute 538 12 633 33" style="align:center middle;"/>
        <Edit id="ed_bond" taborder="19" tabstop="false" autoselect="true" enable="false" visible="false" position="absolute 643 12 753 33" style="align:right; :disabled {background:#ffffffff;color:red;}"/>
        <Edit id="edt_cust" taborder="7" readonly="true" onkeydown="edt_cust_onkeydown" position="absolute 717 76 854 98" style=":disabled {cursor:arrowwait;}" userdata=""/>
        <Button id="btn_cust" taborder="8" tabstop="false" onclick="btn_cust_onclick" class="btn_WF_popSearch" position="absolute 853 76 874 98"/>
        <Static id="Static38" text="구매 0단가 주문" class="sta_WF_DiscInfo" position="absolute 19 645 148 663" anchor="default" style="color:limegreen;" visible="true"/>
        <Static id="st_po01" class="sta_WFDA_Label01" position="absolute 143 643 234 664" anchor="default" style="background:gold;color:ivory;align:center middle;font:Gulim,9,bold;" visible="true" text="결의불가능"/>
        <Button id="btn_SELECT" taborder="20" text="선택" class="btn_WF_CRUD" visible="true" position="absolute 1180 111 1248 136" anchor="top right" onclick="btn_SELECT_onclick"/>
        <Static id="Static39" text="1,000건씩 선택 " position="absolute 1065 112 1170 134" anchor="left top" class="sta_WFSA_label"/>
        <CheckBox id="chk1" taborder="9" text="구매단가 0" position="absolute 911 76 1009 96" anchor="left top" onclick="chk_onclick" tooltiptext="체크시 구매단가 0인 주문만 보입니다."/>
        <Static id="Static31" text="구매 수발주 제한" class="sta_WF_DiscInfo" visible="true" position="absolute 243 646 372 664" anchor="default"/>
        <Static id="st_po" text="결의불가능" class="sta_WFDA_Label01" visible="true" position="absolute 372 644 463 665" anchor="default" style="background:darkgray;color:white;align:center middle;font:Gulim,9,bold;"/>
        <CheckBox id="chk2" taborder="10" text="불용자재" position="absolute 1000 76 1098 96" anchor="left top" tooltiptext="체크시 불용자재 주문만 보입니다." onclick="chk_onclick"/>
        <CheckBox id="chk3" taborder="11" text="중지자재" onclick="chk_onclick" position="absolute 1083 76 1181 96" anchor="left top" tooltiptext="체크시 중지자재 주문만 보입니다." tooltiptype="default"/>
        <Static id="Static32" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 0 15 665"/>
        <Static id="Static40" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 881 50 911 71" anchor="left top"/>
        <Static id="Static41" text="비고" class="sta_WFSA_label" position="absolute 912 52 949 73" anchor="left top"/>
        <Static id="Static42" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 955 50 965 71" anchor="left top"/>
        <Edit id="edt_prRemark" taborder="4" position="absolute 965 51 1152 72" style=":disabled {cursor:arrowwait;}" userdata=""/>
        <Div id="div_sub_return" taborder="21" style="background:#f2eee5ff;border:1 solid #808080ff ;" visible="false" position="absolute 1323 40 1764 124">
          <Layouts>
            <Layout>
              <Static id="Static11" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 89 15 99 36" anchor="left top"/>
              <Static id="Static48" text="반려사유" class="sta_WFSA_label01" position="absolute 16 49 78 70" anchor="left top"/>
              <Static id="Static49" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 89 48 99 69" anchor="left top"/>
              <Edit id="edt_return_remark" taborder="21" position="absolute 99 48 421 69" anchor="left top"/>
              <Button id="btn_needDateSave" taborder="22" text="저장" onclick="fn_return" class="btn_WF_Function" position="absolute 334 15 379 35" anchor="top right"/>
              <Button id="btn_Close" taborder="23" text="취소" onclick="div_sub_return_btn_Close_onclick" class="btn_WF_Function" position="absolute 381 15 426 35" anchor="top right"/>
              <Static id="Static25" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 -2 15 83" anchor="top right"/>
              <Static id="Static00" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 426 -2 441 83" anchor="top right"/>
              <Static id="Static71" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 69 441 84" anchor="left bottom"/>
              <Static id="Static01" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 0 441 15" anchor="left bottom"/>
              <Static id="Static02" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 8 35 449 48" anchor="left bottom"/>
            </Layout>
          </Layouts>
        </Div>
        <Edit id="edt_centerCode" taborder="22" readonly="true" class="edt_WF_Essential" position="absolute 102 76 278 97"/>
        <Button id="btn_centerCode" taborder="23" tabstop="false" onclick="btn_centerCode_onclick" class="btn_WF_popSearch" position="absolute 277 76 298 97"/>
      </Layout>
    </Layouts>
    <Bind>
      <BindItem id="item6" compid="cal_fromDate" propid="text" datasetid="ds_search" columnid="schDate1"/>
      <BindItem id="item7" compid="cal_toDate" propid="text" datasetid="ds_search" columnid="schDate2"/>
      <BindItem id="item4" compid="cbo_centerCode" propid="value" datasetid="ds_search" columnid="schCenter"/>
      <BindItem id="item2" compid="edt_prNum" propid="userdata" datasetid="ds_search" columnid="GUBUN"/>
      <BindItem id="item5" compid="edt_prNum" propid="UserData" datasetid="ds_search" columnid="GUBUN"/>
      <BindItem id="item8" compid="edt_prNum" propid="value" datasetid="ds_search" columnid="schPrNum"/>
      <BindItem id="item0" compid="cbo_preOrder" propid="value" datasetid="ds_search" columnid="schOrder"/>
      <BindItem id="item1" compid="edt_cust" propid="userdata" datasetid="ds_search" columnid="schCust"/>
      <BindItem id="item3" compid="edt_cust" propid="UserData" datasetid="ds_search" columnid="GUBUN"/>
      <BindItem id="item9" compid="edt_prRemark" propid="userdata" datasetid="ds_search" columnid="GUBUN"/>
      <BindItem id="item10" compid="edt_prRemark" propid="UserData" datasetid="ds_search" columnid="GUBUN"/>
      <BindItem id="item11" compid="edt_prRemark" propid="value" datasetid="ds_search" columnid="schPrRemark"/>
    </Bind>
    <Objects>
      <Dataset id="ds_list" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" cancolumnchange="ds_list_cancolumnchange">
        <ColumnInfo>
          <Column id="itemCode" type="STRING" size="256"/>
          <Column id="itemName" type="STRING" size="256"/>
          <Column id="itemSize" type="STRING" size="256"/>
          <Column id="itemUnit" type="STRING" size="256"/>
          <Column id="taxCode" type="STRING" size="256"/>
          <Column id="prRemark" type="STRING" size="256"/>
          <Column id="needDate" type="STRING" size="256"/>
          <Column id="salePrice" type="STRING" size="256"/>
          <Column id="prQty" type="STRING" size="256"/>
          <Column id="poQty" type="STRING" size="256"/>
          <Column id="amt" type="STRING" size="256"/>
          <Column id="insDeptNm" type="STRING" size="256"/>
          <Column id="lineStatus" type="STRING" size="256"/>
          <Column id="lineStatusNm" type="STRING" size="256"/>
          <Column id="prId" type="STRING" size="256"/>
          <Column id="prDate" type="STRING" size="256"/>
          <Column id="poType" type="STRING" size="256"/>
          <Column id="subinvName" type="STRING" size="256"/>
          <Column id="custNm" type="STRING" size="256"/>
          <Column id="minOrdQty" type="STRING" size="256"/>
          <Column id="maxOrdQty" type="STRING" size="256"/>
          <Column id="multiplierQty" type="STRING" size="256"/>
          <Column id="pointFlag" type="STRING" size="256"/>
          <Column id="dDays" type="STRING" size="256"/>
          <Column id="dTimes" type="STRING" size="256"/>
          <Column id="prNum" type="STRING" size="256"/>
          <Column id="upjangnm" type="STRING" size="256"/>
          <Column id="chk" type="STRING" size="256"/>
          <Column id="centerCode" type="STRING" size="256"/>
          <Column id="centerName" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_center" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="centerCode" type="STRING" size="256"/>
          <Column id="centerName" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_search" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" oncolumnchanged="ds_search_oncolumnchanged">
        <ColumnInfo>
          <Column id="schGubun" type="STRING" size="256"/>
          <Column id="schDate1" type="STRING" size="256"/>
          <Column id="schDate2" type="STRING" size="256"/>
          <Column id="schType" type="STRING" size="256"/>
          <Column id="schTypeNm" type="STRING" size="256"/>
          <Column id="schSabun" type="STRING" size="256"/>
          <Column id="schUpjangNm" type="STRING" size="256"/>
          <Column id="schUpjang" type="STRING" size="256"/>
          <Column id="schChk1" type="STRING" size="256"/>
          <Column id="schPrNum" type="STRING" size="256"/>
          <Column id="schPrDate" type="STRING" size="256"/>
          <Column id="schNeedDate" type="STRING" size="256"/>
          <Column id="schFlag" type="STRING" size="256"/>
          <Column id="schCenter" type="STRING" size="256"/>
          <Column id="schCust" type="STRING" size="256"/>
          <Column id="schCustNm" type="STRING" size="256"/>
          <Column id="schOrder" type="STRING" size="256"/>
          <Column id="schSave" type="STRING" size="256"/>
          <Column id="schReturn" type="STRING" size="256"/>
          <Column id="poDeptId" type="STRING" size="256"/>
          <Column id="loginSabun" type="STRING" size="256"/>
          <Column id="loginUserid" type="STRING" size="256"/>
          <Column id="loginPersMask" type="STRING" size="256"/>
          <Column id="schPoType" type="STRING" size="256"/>
          <Column id="schPrRemark" type="STRING" size="256"/>
          <Column id="schCode" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmnAuth" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="srcYn" type="STRING" size="256"/>
          <Column id="insYn" type="STRING" size="256"/>
          <Column id="delYn" type="STRING" size="256"/>
          <Column id="savYn" type="STRING" size="256"/>
          <Column id="prtYn" type="STRING" size="256"/>
          <Column id="exlYn" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="srcYn">1</Col>
            <Col id="insYn">0</Col>
            <Col id="delYn">0</Col>
            <Col id="savYn">1</Col>
            <Col id="prtYn">0</Col>
            <Col id="exlYn">0</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_creInfo" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="creditTurnDays" type="STRING" size="256"/>
          <Column id="creditTurnDaysTot" type="STRING" size="256"/>
          <Column id="creditAmount" type="STRING" size="256"/>
          <Column id="creditAmountTot" type="STRING" size="256"/>
          <Column id="creditOverAmount" type="STRING" size="256"/>
          <Column id="rmnAmt" type="STRING" size="256"/>
          <Column id="preAmt" type="STRING" size="256"/>
          <Column id="trAmt" type="STRING" size="256"/>
          <Column id="poAmt" type="STRING" size="256"/>
          <Column id="prAmt" type="STRING" size="256"/>
          <Column id="bondAmt" type="STRING" size="256"/>
          <Column id="creditRmnAmt" type="STRING" size="256"/>
          <Column id="creditAvailAmt" type="STRING" size="256"/>
          <Column id="lBillDate" type="STRING" size="256"/>
          <Column id="lBillDateDisp" type="STRING" size="256"/>
          <Column id="lastTurnCnt" type="STRING" size="256"/>
          <Column id="creditTurnControlYn" type="STRING" size="256"/>
          <Column id="creditAmountControlYn" type="STRING" size="256"/>
          <Column id="creditControlYn" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_searchValid">
        <ColumnInfo>
          <Column id="schDate1" type="STRING" size="256"/>
          <Column id="schDate2" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="schDate1">title:시작일,required:true,date;true,comparemin:schDate2:종료일</Col>
            <Col id="schDate2">title:종료일,required:true,date;true,comparemax:schDate1:시작일</Col>
          </Row>
        </Rows>
      </Dataset>
    </Objects>
    <Script type="xscript4.0"><![CDATA[/*
  화 면 명 : Template
  파 일 명 : Template.xfdl
  기    능 : Design 및 Script Template 

    수정일    수정자                  수정내용
  ----------   -------  --------------------------------------------------
  2014.11.01   김윤기   최초 생성
  2016.01.11   최성연   센터코드 다중 선택
*/

/************************************************************************************************
 * 공통 라이브러리 INCLUDE 영역 (필수)
************************************************************************************************/
include "lib::lib_com.xjs";
include "U_lib::lib_conversionCom.xjs";

/************************************************************************************************
 * FORM 변수 선언 영역 (필수)
************************************************************************************************/
var fv_sToday = gfn_today();

var fv_errorFlag;				//에러발생 여부(Y/N)
var fv_errorMsg;				//에러발생 메시지
var Txtselect = true;

/************************************************************************************************
 * FORM EVENT 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : Form Load (필수)
 *---------------------------------------------------------------------------------------------*/
function form_onload(obj:Form, e:LoadEventInfo)
{	
	// Form Load 시 공통 기능 처리(obj:Form, bCreateEvent:이벤트 생성 여부)
	gfn_formOnLoad(this);
	application.httptimeout = 0;
	// 초기값 셋팅
	fn_init();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 초기값 셋팅
 *---------------------------------------------------------------------------------------------*/
function fn_init()
{
	// 업데이트여부를 체크할 DataSet, 여러개 있을 경우 ;로 구분
	v_ds_check = "ds_list";
	ds_search.addRow();
	fn_searchCenter();
	cal_fromDate.fn_initMonthCal(this, arrSchVal[0], "", ds_search, "schDate1", "Y");	
	cal_toDate.fn_initMonthCal(this, arrSchVal[1], "", ds_search, "schDate2", "Y");	
	ds_search.setColumn(0,"schPrNum", arrSchVal[4]);
	ds_search.setColumn(0,"schGubun", arrSchVal[4]);
	ds_search.setColumn(0,"schPoType", arrSchVal[3]);
	ds_search.setColumn(0,"schOrder", "");
	// 센터 다중선택 처리 : 2016-01-11
	ds_search.setColumn(0,"schCode", arrSchVal[2]);
	edt_centerCode.value = arrSchVal[5];
	edt_centerCode.userdata = arrSchVal[2];
	//
	if(!gfn_isNull(arrSchVal[4])){
		fn_search();
	}
	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 화면 닫기 전 변경 유무 체크 (필수-Frame에서 창 닫힐때 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_close(retResult)
{	
// 	// v_ds_check 사용시 변경사항 체크
// 	if(gfn_length(v_ds_check) == 0) 
// 	{	
// 		// v_ds_check 설정기준 변경사항 체크
// 		if (gfn_isDataChange() == true) 
// 		{		
// 			// 변경된 데이터가 있습니다. 현재 화면을 닫겠습니까?
// 			if (!gfn_confirm("confirm.before.movepage")) return false;
// 		}
// 	}
// 	// 조회프로그램에도 Return true; 기술해 주세요!
// 	return true;
     var retVal = new Array();
     retVal[0] = retResult;
     close(retVal);
}


/************************************************************************************************
 * 공통기능 FUNCTION 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 조회 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_search()
{
    gfn_clearSortMark(grd_list);
	
	ds_search.setColumn(ds_search.rowposition, "schGubun" , ds_search.getColumn(ds_search.rowposition, "schPrNum"));

	// 조회시 Validation Check
	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;
	
    var strSvcID    = "search";
    var strURL      = "/fm/fmo/orderRequestConfirmPop/selectList.xdo";
    var strInDs     = "ds_search=ds_search:A";
    var strOutDs    = "ds_list=ds_list";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 신규 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_insert()
{	
	var nRow = ds_list.addRow();	
	
	ds_list.setColumn(nRow, "GUBUN", 'AD');
	ds_list.setColumn(nRow, "INPUT_USER", gfn_getUserId());
	
	// Grid 입력 cell 지정
	grd_list.setFocus();
	grd_list.setCellPos(1);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 삭제 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_delete()
{
	var nRow = ds_list.rowposition;
	
	if(ds_list.rowposition == -1) 
	{
		gfn_alert("msg.err.grid.noselect", "삭제할 row");	// 선택된 항목이 없습니다.
		return;
	}

	var rtVal = gfn_confirm("confirm.before.delete");	// 선택된 자료를 삭제 하시겠습니까?
	if (rtVal == true) 
	{	
		ds_list.deleteRow(nRow);
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 저장 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_save()
{
	if(ds_list.getRowCount() == 0){
		gfn_alert("결의할 데이터가 없습니다.");
		return;
	}
	if(ds_list.findRow("chk" , 1) == -1){
		gfn_alert("결의할 항목을 선택해 주세요.");
		return;
	}
	if(fn_datasetStatus(ds_list)){
		gfn_alert("결의할 항목을 선택해 주세요.");
		return;
	}
	
	ds_list.filter("chk == 1");
 	var sRowCnt =  ds_list.getRowCount();
 	ds_list.filter("");
 	if(sRowCnt > 1000){
		gfn_alert("주문건수가 너무 많습니다.\n\n 1,000건 씩 처리가 가능합니다.");
		return;
 	}
 	
 	ds_list.filter("chk == 1 && poNoStatus == 'Y'");
 	var sRowNoStatus =  ds_list.getRowCount();
 	ds_list.filter("");
 	if(sRowNoStatus > 0){
		gfn_alert("구매단가 0인주문건이 존재합니다.\n확인 후 결의해 주세요.");
		return;
 	}
 	
 	ds_list.filter("chk == 1 && valUnsCnt=='UK'");
 	var sRowvalUnsCnt =  ds_list.getRowCount();
 	ds_list.filter("");
 	if(sRowvalUnsCnt > 0){
		gfn_alert("불용자재 주문건이 존재합니다.\n확인 후 결의해 주세요.");
		return;
 	}
 	
 	ds_list.filter("chk == 1 && valStpCnt=='TK'");
 	var sRowvalStpCnt =  ds_list.getRowCount();
 	ds_list.filter("");
 	if(sRowvalStpCnt > 0){
		gfn_alert("중지자재 주문건이 존재합니다.\n확인 후 결의해 주세요.");
		return;
 	}
 	
	var schSave = "";
	for(var i=0; i < ds_list.getRowCount();i++){
		if(ds_list.getColumn(i,"chk") == 1){
			schSave += ","+ds_list.getColumn(i,"prId");
		}
	}
	
	ds_list.setColumn(0,"save",schSave.substr(1,schSave.length));
	
	if(gfn_confirm("결의 하시겠습니까?")){
		
		var strSvcID    = "save";
		var strURL      = "/fm/fmo/orderRequestConfirmPop/saveList.xdo";
		var strInDs     = "ds_list=ds_list:U";
		var strOutDs    = "";
		var strArg      = "";
		var strCallback = "fn_callBack";
		var bAsync      = true;
		
		gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 출력 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_print()
{
	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 도움말 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_help()
{
	
}

/************************************************************************************************
 * TRANSACTION 및 CallBack 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 트랜잭션 콜백 함수 (필수)
 *---------------------------------------------------------------------------------------------*/
function fn_callBack(strSvcID, nErrorCode, strErrorMsg)
{
	// 에러시 gfn_callBack에서 메시지 제공, 화면별 특정 에러 발생시에만 사용하세요.
	if (nErrorCode < 0) 
	{
		return;
	}
	
    switch(strSvcID)
    {
		// 코드분류 조회
        case "search" :
			if(ds_list.getRowCount() > 0){
				Static18.text = "주문조정정보 : " + ds_list.getRowCount()+"건";
			}else{
				Static18.text = "주문조정정보";
			}
            break;
	
		// 코드분류 조회
        case "searchCenter" :
            fn_center_init();
            break;
            
         case "returnList" :
			if(fv_errorFlag == 'Y'){				//에러발생 여부(Y/N)
				gfn_alert(fv_errorMsg);				//에러발생 메시지
				fv_errorFlag = "";
			}else{         
				div_sub_return.edt_return_remark.value = "";
				div_sub_return.visible = false;
				gfn_alert("반려 하였습니다.");	// 저장 되었습니다.
				fn_search();
			}
            break;        
        // 저장
        case "save" :
			gfn_alert("결의 하였습니다.");	// 저장 되었습니다.
			fn_search();
			opener.fn_search();
			//fn_close("OK");					
            break;    
		case "searchCreInfoSave" :						
            if (ds_creInfo.getRowCount() == 0) {
				//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
				gfn_loadDatasetInfo (ds_creInfo, fv_objColInfo);
            }
            // 여신정보 SET
            fn_setCrdInfoSave();
            break;              
		case "subSave" :
			if(fv_errorFlag == 'Y'){				//에러발생 여부(Y/N)
				gfn_alert(fv_errorMsg);				//에러발생 메시지
				fv_errorFlag = "";
			}else{
				gfn_alert("msg.save.success");	// 저장 되었습니다.
			}
			break;
    }
}


/************************************************************************************************
 * 사용자 FUNCTION 영역 (필수)
************************************************************************************************/

/*----------------------------------------------------------------------------------------------
 * 설명      : 협력업체 검색 팝업 이벤트
 *---------------------------------------------------------------------------------------------*/
function fn_edBtn_OnClick(obj:Button,  e:ClickEventInfo)
{

	// 팝업창을 호출한다	
	var strId       = "SaleCustSearch";
	var strURL      = "X_FMS::SalePriceCustSearchPop.xfdl";
	var objArgument = {
		P_DATASET : ds_search
	};
	
	var nWidth      = 513;
	var nHeight     = 495;
	var strStyle    = "";
	var nLeft       = -1;
	var nTop        = -1;
	var isModeless  = false;
	var bShowTitle  = true;
	var strAlign    = "-1";
	
	// 리턴값을 배열로 받을 경우	
	var arrRtn = gfn_dialog(strId, strURL, objArgument, nWidth, nHeight, strStyle, nLeft, nTop, isModeless, bShowTitle, strAlign);
	
	if (arrRtn instanceof Object)
	{
		edt_cust.value    = arrRtn["custNm"];
		edt_cust.userdata = arrRtn["custCd"];
		ds_search.setColumn(0,"schCustCd",arrRtn["custCd"]);
		obj.userdata       = arrRtn["custNm"];
	}
}
/*----------------------------------------------------------------------------------------------
 * 설명      : 체크된 데이터만 저장 하게 끔 변경.
 *---------------------------------------------------------------------------------------------*/
function fn_datasetStatus(obj){
	if(ds_list.getRowCount() == 0)return true;
	for(var i=0; i < ds_list.getRowCount() ; i ++){
		if(ds_list.getColumn(i,"chk") == 1){
			ds_list.setRowType(i,"U");
			ds_list.setColumn(i,"poDeptId",g_Deptid);
		}else{
			ds_list.setRowType(i,"normal");
		}
	}
	return false;
}
/*----------------------------------------------------------------------------------------------
 * 설명      : 센터정보 조회
 *---------------------------------------------------------------------------------------------*/
function fn_searchCenter()
{
    var strSvcID    = "searchCenter";
    var strURL      = "fm/fms/upriceContractUpjangSet/selectCenter.xdo";
    var strInDs     = "";
    var strOutDs    = "ds_center=ds_center";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}
/*----------------------------------------------------------------------------------------------
 * 설명      : 센터 COMBO 초기화 
 *---------------------------------------------------------------------------------------------*/
function fn_center_init()
{
	var defVal = arrSchVal[2];

	ds_center.filter("centerCode != '*'");

	cbo_centerCode.value = defVal;
	ds_search.setColumn(0,"schCenter", cbo_centerCode.value);
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 여신정보 조회 (저장용)
 * fn_getCrdInfo 동일
 *---------------------------------------------------------------------------------------------*/
function fn_getCrdInfoSave()
{
   	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
	fv_objColInfo = gfn_getDatasetInfo (ds_creInfo);
	var prIds = "";
	for(var i = 0;i < ds_list.getRowCount();i++){
		if(ds_list.getColumn(i,"chk") == 1){
			prIds = prIds +","+ds_list.getColumn(i,"prId");
		}
	}

    ds_search.setColumn(ds_search.rowposition, "schPrIds", prIds.substr(1,prIds.length));//체크한 주문.

    // 여신정보 조회
    var strSvcID    = "searchCreInfoSave";
    var strURL      = "fm/fmo/orderRequest/selectCreInfo.xdo";
    var strInDs     = "ds_search=ds_search:A";
    var strOutDs    = "ds_creInfo=ds_creInfo";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}
/*----------------------------------------------------------------------------------------------
 * 설명      : 여신정보를 조회한다 (저장용)
 * fn_setCrdInfo 동일
 *---------------------------------------------------------------------------------------------*/
function fn_setCrdInfoSave()
{
	//여신 표시
	if (ds_creInfo.getRowCount() > 0) {
		if (ds_creInfo.getColumn(ds_creInfo.rowposition,"creditAmountControlYn") == "Y") {
			ed_credit.value = gfn_numFormat(ds_creInfo.getColumn(ds_creInfo.rowposition,"creditRmnAmt"))+ " 원";
			ed_bond.value = gfn_numFormat(ds_creInfo.getColumn(ds_creInfo.rowposition,"bondAmt"))+ " 원";
		} else {
			ed_credit.value = "무 제 한";
		}
	} else {
		var sMsg = "업장여신정보를 확인할 수 없습니다.\n\n";
		sMsg = sMsg + "관리자에게 문의하세요.";
		gfn_alert(sMsg, "", "A");
		return;
	}

	// 여신한도관련 CHECK :  저장 호출
	fn_crdCheck();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 여신한도 관련 CHECK
 *---------------------------------------------------------------------------------------------*/
function fn_crdCheck()
{
	var sMsg = "";
	
	if (ds_creInfo.rowcount > 0)
	{
		//여신금액
		if (ds_creInfo.getColumn(0,"creditAmountControlYn") == "Y")
		{
			var nAmt = 0;
			for (i = 0; i < ds_sub.getRowCount(); i++)
				nAmt += Math.round(ds_sub.getColumn(i,"amt"),1.1,1);
				
				//alert("주문금액 : " + nAmt);
				//alert("주문가능금액 : " + toNumber(ds_creInfo.getColumn(0,"creditAvailAmt")));
			if (nAmt > toNumber(ds_creInfo.getColumn(0,"creditAvailAmt")))
			{
				sMsg = "주문가능한 여신한도를 초과하여 주문이 불가합니다.\n\n";
				sMsg = sMsg + " - 여신한도 : " + gfn_numFormat(ds_creInfo.getColumn(0,"creditAvailAmt")) + "\n";
				sMsg = sMsg + " - 주문금액(합계) : " + gfn_numFormat(nAmt) + "\n";
				gfn_alert(sMsg, "", "A");
				return;
			}
		}
		//여신회전일
		if (ds_creInfo.getColumn(0,"creditTurnControlYn") == "Y")
		{
			if (toNumber(ds_creInfo.getColumn(0,"lastTurnCnt")) >= 0)
			{
				if (toNumber(ds_creInfo.getColumn(0,"lastTurnCnt")) > toNumber(ds_creInfo.getColumn(0,"creditTurnDaysTot")))
				{
					sMsg = gfn_getFormat(ds_creInfo.getColumn(0,"lBillDate"), "@@@@-@@-@@")  + "에 매출채권이 존재하여 주문이 불가합니다.";
					gfn_alert(sMsg, "", "A");
					return;
				}
			}
		}
	}
	
	// 정상적인 Save 호출
	fn_SubSave();
}
function fn_SubSave()
{
    var strSvcID    = "subSave";
    var strURL      = "fm/fmo/orderRequestConfirmPop/updateList.xdo";
    var strInDs     = "ds_list=ds_list:U";
    var strOutDs    = "";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}

function fn_update()
{
	//if(!fn_itemCheck())return;	// old
	fn_SubSave();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 자재별 저장 관련 CHECK
 *---------------------------------------------------------------------------------------------*/
function fn_itemCheck()
{
	var nRowCnt = ds_list.getRowCount();	// DataSet Count
	var v_itemCode = "";
	var sMsg = "";
	
	for (var i = 0 ; i < nRowCnt ; i++)
	{
		
		// 통제가 없는 자재는 제외
		if ( gfn_nvl(ds_list.getColumn(i,"dDays"), "0")== "0" ) continue;

		// D-DAY, D_TIME CHECK
		if (ds_list.getColumn(i,"poType") == "07" && fn_getDayStatus(ds_list.getColumn(i,"dDays"), ds_list.getColumn(i,"dTimes"), ds_list.getColumn(i,"needDate")) == "0")
		{
			ds_list.rowposition = i;
			sMsg = "[" + ds_list.getColumn(i,"itemName") + "] 자재는 마감시간(D-Days)을 초과하여 주문이 불가합니다.";
			gfn_alert(sMsg, "", "A");
			return false;
		}
		// 동일한 상품에 대한 최대발주량 CHECK
		if ((ds_list.getColumn(i,"maxOrdQty") > 0) && ( ds_list.getCaseSum("itemCode=='"+ds_list.getColumn(i,"itemCode")+"'&& (lineStatus <> '005' && lineStatus <> '003') && DOCU_SOURCE <> '01 BO'","PR_QTY") > ds_list.getColumn(i,"maxOrdQty")))  
		{   
       	    ds_list.rowposition = i;
			sMsg = "[" + ds_list.getColumn(i,"itemName") + "] 자재는 최대 결의량" + ds_list.getColumn(i,"maxOrdQty") + ")를 초과하여 주문이 불가합니다.";
			gfn_alert(sMsg, "", "A");
			return false;
		}		
	}	

	return true;
}
/*----------------------------------------------------------------------------------------------
 * 설명      : 상품별 D-DAY CHECK FUNCTION
 *---------------------------------------------------------------------------------------------*/
function fn_getDayStatus(nDdays, nDtimes , sNeedDate)
{
	fsp_init(this);			// 고도화관련 Frame 관련 SET

	fn_CurrDateWeek();
	
	if (gfn_length(nDtimes)==2) nDtimes = nDtimes + "00";
	
	//무통제면 패스...
	if (gfn_nvl(nDdays, "0")== "0" ) return "2";
	//디데이체크
	if (gfn_addDate(gds_currdate.getColumn(0,"YMD"),nDdays) > sNeedDate )
		return "0";
	else if ( gfn_addDate(gds_currdate.getColumn(0,"YMD"),nDdays) == sNeedDate )
	{
		//디타임체크
		if ( gfn_subStr(gds_currdate.getColumn(0, "YMD_TM"),8,4)> nDtimes )
			return "0";
		else if ( G_fn_GapTime(0, gfn_subStr(gds_currdate.getColumn(0, "YMD_TM"),8,4), nDtimes, "") <= "0030" )
			return "1";
		else
			return "2";
	}
	else
		return "2";
}
/************************************************************************************************
 * 각 COMPONENT 별 EVENT 영역 (필수)
************************************************************************************************/
function btn_return_onclick(obj:Button,  e:ClickEventInfo)
{
	if(ds_list.findRow("chk" , 1) == -1){
		gfn_alert("반려할 항목을 선택해 주세요.");
		return;
	}
	if(fn_datasetStatus(ds_list)){
		gfn_alert("반려할 항목을 선택해 주세요.");
		return;
	}
	
	div_sub_return.position.left = btn_return.position.right - 441;
	div_sub_return.position.width = 441;
	div_sub_return.visible = !div_sub_return.visible;
}

function fn_return(){
		
 	var schReturn = "";
 	
 	if(gfn_isNull(div_sub_return.edt_return_remark.text)){
		gfn_alert("반려사유는 필수 입니다.");
		return;
 	}
 	for (var i = 0 ; i < ds_list.getRowCount() ; i++){
		if(ds_list.getColumn(i,"chk") ==  1 ){
			ds_list.setColumn(i,"remark",div_sub_return.edt_return_remark.text);
		}
 	}
 	
 	
 	ds_list.filter("chk == 1");
 	var sRowCnt =  ds_list.getRowCount();
 	ds_list.filter("");
 	if(sRowCnt > 900){
		gfn_alert("주문건수가 너무 많습니다.\n\n1,000건 이하로 처리해 주세요.");
		return;
 	}

 	
 	if(!gfn_confirm("선택된 항목을 반려 처리 하시겠습니까?"))return;
   	
    var strSvcID    = "returnList";
    var strURL      = "fm/fmo/orderRequestConfirmPop/returnList.xdo";
    var strInDs     = "ds_list=ds_list:U";
    var strOutDs    = "";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 조건 DataSet 변경 이벤트
 *---------------------------------------------------------------------------------------------*/
function ds_search_oncolumnchanged(obj:Dataset, e:DSColChangeEventInfo)
{
	if(e.columnid != "schSave" && e.columnid != "schReturn" ){
		ds_list.clearData();
	}
}

function btn_update_onclick(obj:Button,  e:ClickEventInfo)
{
	if(ds_list.getRowCount() == 0){
		gfn_alert("저장 할 데이터가 없습니다.");
		return;
	}
	if (gfn_dsIsUpdated(ds_list) == false)
 	{
 		gfn_alert("msg.save.nochange");	// 변경된 내역이 없습니다.
 		return;
 	}
 	//fn_getCrdInfoSave();
 	
 	fn_update();
}

function OrderRequestConfirmPop_onkeydown(obj:Form, e:KeyEventInfo)
{
	if(e.keycode == 36){
		st_Credit.visible = !st_Credit.visible;
		ed_credit.visible = !ed_credit.visible;
		st_Bond.visible = !st_Bond.visible;
		ed_bond.visible = !ed_bond.visible;
	}
}

function ds_list_cancolumnchange(obj:Dataset, e:DSColChangeEventInfo)
{
	// 발주량 0 CHECK
	// - 불가
	if(e.columnid == "poQty"){
		sMsg = "주문수량이 0입니다.";
		
		// 신청수량 < 발주수량 CHECK	
		//  2015-07-17 신청수량 보다 높게 발주 할 수 있음. ( 2015-07-20 ) 다시 막음 . 구매에서 불가.
		if ( (toNumber(obj.getColumn(e.row,"prQty")) < toNumber(e.newvalue)) )
		{
			sMsg = "신청수량을 초과하여 발주할 수 없습니다.";
			gfn_alert(sMsg, "", "A");
			return false;
		}
		
		/*
		//최소발주량 체크
		if ( (toNumber(obj.getColumn(e.row,"minOrdQty")) > 0) && (toNumber(obj.getColumn(e.row,"minOrdQty")) > toNumber(e.newvalue)) )
		{
			sMsg = "해당 자재는 최소결의량이 " + obj.getColumn(e.row,"minOrdQty") + " 입니다.";
			gfn_alert(sMsg, "", "A");
			return false;
		}
		*/
		//최대발주량 체크
		if ( (toNumber(obj.getColumn(e.row,"maxOrdQty")) > 0) && (toNumber(obj.getColumn(e.row,"maxOrdQty")) < toNumber(e.newvalue)) )
		{
			sMsg = "해당 자재는 최대결의량이 " + obj.getColumn(e.row,"maxOrdQty") + " 입니다.";
			gfn_alert(sMsg, "", "A");
			return false;
		}
		//소숫점발주여부
		/*	2015-10-02
		if ( (obj.getColumn(e.row,"pointFlag") != "Y") && (Math.ceil(toNumber(e.newvalue)) != toNumber(e.newvalue)) )
		{
			sMsg = "해당 자재는 소숫점 결의가 불가합니다.";
			gfn_alert(sMsg, "", "A");
			return false;
		}
		*/
		//발주승수량	2015-09-21 제거
		/*
		if ( (toNumber(obj.getColumn(e.row,"multiplierQty")) > 0) && ((Math.round(toNumber(e.newvalue) * 1000) % Math.round(toNumber(obj.getColumn(e.row,"multiplierQty")) * 1000)) <> 0) )
		{
			sMsg = "해당 자재는 결의승수량이 " + obj.getColumn(e.row,"multiplierQty") + " 입니다.";
			gfn_alert(sMsg, "", "A");
			return false;
		}
		*/
	}
}

function div_sub_return_btn_Close_onclick(obj:Button,  e:ClickEventInfo)
{
	div_sub_return.edt_return_remark.value = "";
	div_sub_return.visible = false;
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 업체 팝업.
 *---------------------------------------------------------------------------------------------*/
function btn_cust_onclick(obj:Button,  e:ClickEventInfo)
{
	// 팝업창을 호출한다	
	var strId       = "SaleCustSearch";
	var strURL      = "X_FMS::SalePriceCustSearchPop.xfdl";
	var objArgument = {
		P_DATASET : ds_search
	};
	
	var nWidth      = 513;
	var nHeight     = 495;
	var strStyle    = "";
	var nLeft       = -1;
	var nTop        = -1;
	var isModeless  = false;
	var bShowTitle  = true;
	var strAlign    = "-1";
	
	// 리턴값을 배열로 받을 경우	
	var arrRtn = gfn_dialog(strId, strURL, objArgument, nWidth, nHeight, strStyle, nLeft, nTop, isModeless, bShowTitle, strAlign);
	
	if (arrRtn instanceof Object)
	{
		edt_cust.value    = arrRtn["custNm"];
		edt_cust.userdata = arrRtn["custCd"];
		obj.userdata       = arrRtn["custNm"];
		ds_search.setColumn(ds_search.rowposition,"schCust",arrRtn["custCd"]);
	}
}
 

function edt_cust_onkeydown(obj:Edit, e:KeyEventInfo)
{
			// Del 키
	if(e.keycode == 46) 
	{		
		edt_cust.value="";
		edt_cust.userdata="";
		ds_search.setColumn(ds_search.rowposition, "schCust",	"");
	}
}

function btn_SELECT_onclick(obj:Button,  e:ClickEventInfo)
{
	var error = "N";
	if(ds_list.getRowCount() > 1000){
		for(var i = 0 ; i < 1000;i++){
			if(Txtselect){
				ds_list.setColumn(i,"chk", 1);
				if(error == "N" && ds_list.getColumn(i,"poNoStatus") == "Y"){
					error = "Y";
				}
			}else{
				ds_list.setColumn(i,"chk", 0);
			}
		}
	}else{
		for(var i = 0 ; i < ds_list.getRowCount();i++){
			if(Txtselect){
				ds_list.setColumn(i,"chk", 1);
			}else{
				ds_list.setColumn(i,"chk", 0);
			}
		}
	}
	
	if(Txtselect == false){
		btn_SELECT.text = "선택";
		Txtselect = true;
	}else{
		btn_SELECT.text = "선택취소";
		Txtselect = false;
	}

	if(error == "Y"){
		alert("구매단가 0인 주문이 존재 합니다.\n확인 후 결의해 주세요.");
	}
}

/*

		구매 단가 0 인 자재 필터 
		불용 자재 필터 (VAL_UNS_CNT)  2015-11-06 전은정
		중지 자재 필터 (VAL_STP_CNT)  2015-11-06 전은정

*/
function chk_onclick(obj:CheckBox,  e:ClickEventInfo)
{
	var filter = "";
	
	//구매단가0
	if(chk1.value == true){
		if(gfn_length(filter) > 0) filter += " || ";
		filter += "poNoStatus=='Y'";
	}
		
	//불용자재
	if(chk2.value == true){
		if(gfn_length(filter) > 0) filter += " || ";
		filter += "valUnsCnt=='UK'";
	}
	
	//중지자재
	if(chk3.value == true){
		if(gfn_length(filter) > 0) filter += " || ";
		filter += "valStpCnt=='TK'";
	}
	trace(filter);		
	ds_list.filter(filter);
	Static18.text = "주문조정정보 : " + ds_list.getRowCount()+"건";
}



function OrderRequestConfirmPop_onsize(obj:Form, e:SizeEventInfo)
{
	Static38.position.top = e.cy - 30;
	Static38.position.height = 21;
	st_po01.position.top = e.cy- 30;
	st_po01.position.height = 21;
	Static31.position.top = e.cy- 30;
	Static31.position.height = 21;
	st_po.position.top = e.cy- 30;
	st_po.position.height = 21;
}

function btn_centerCode_onclick(obj:Button,  e:ClickEventInfo)
{
	fn_centerCodePop();
}

function fn_centerCodePop()
{
	// 팝업창을 호출한다	
	var strId       = "CenterCodePop";
	var strURL      = "X_FMO::CenterCodePop.xfdl";
	var objArgument = {
		P_DATASET : ds_search
	};
	
	var nWidth      = 281;
	var nHeight     = 330;
	var strStyle    = "";
	var nLeft       = -1;
	var nTop        = -1;
	var isModeless  = false;
	var bShowTitle  = true;
	var strAlign    = "-1";
	
	// 리턴값을 배열로 받을 경우	
	var arrRtn = gfn_dialog(strId, strURL, objArgument, nWidth, nHeight, strStyle, nLeft, nTop, isModeless, bShowTitle, strAlign);
	
	if (arrRtn instanceof Object)
	{
		// 리턴값 처리
		edt_centerCode.value    = arrRtn["centerName"];
		edt_centerCode.userdata = arrRtn["centerCode"];
		
		// ds_search SET
		ds_search.setColumn(0, "schCode", arrRtn["centerCode"]);
	}


}

]]></Script>
  </Form>
</FDL>
