<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="..\..\..\default_typedef.xml"/>
  <Form id="DayCloseMngt" classname="COMP_GUIDE_13" inheritanceid="" position="absolute 0 0 1252 725" titletext="식재일마감관리" scrollbars="autoboth" onload="form_onload">
    <Layouts>
      <Layout>
        <Static id="Static08" class="sta_WFSA_Labelbg" position="absolute 0 30 1237 71" anchor="left top right"/>
        <Static id="Static06" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1237 0 1252 710" anchor="top right"/>
        <Static id="Static71" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 710 1252 725" anchor="left bottom"/>
        <Div id="div_cmnBtn" anchor="left top right" taborder="4" url="cmn::CmnBtn.xfdl" text="Div00" scrollbars="none" position="absolute 0 0 1237 30"/>
        <Static id="Static22" text="매출목록" class="sta_WF_Title01" position="absolute 0 83 450 100" anchor="left top"/>
        <Static id="Static15" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 0 71 450 83" anchor="left top"/>
        <Static id="Static16" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 0 96 450 100" anchor="left top"/>
        <Static id="Static04" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 30 93 40" anchor="left top"/>
        <Static id="Static05" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 61 93 71" anchor="left top"/>
        <Static id="Static07" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 40 15 61" anchor="left top"/>
        <Static id="Static11" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 77 40 87 61" anchor="left top"/>
        <Static id="Static18" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 93 61 186 71" anchor="left top"/>
        <Static id="Static19" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 186 61 279 71" anchor="left top"/>
        <Static id="Static01" text="사업장" class="sta_WFSA_label" position="absolute 320 40 370 61" anchor="left top"/>
        <Static id="Static03" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 368 40 378 61" anchor="left top"/>
        <Grid id="grd_list" taborder="5" binddataset="ds_list" autoenter="select" useinputpanel="false" cellsizingtype="col" autofittype="col" nodataimage="URL('theme://images/grd_WF_NoDataImg.png')" oncellclick="grd_list_oncellclick" position="absolute 0 100 1237 388" anchor="left top right" autosizemergetype="rowmerge" oncelldblclick="grd_list_oncelldblclick" onheadclick="grd_list_onheadclick">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="44"/>
                <Column size="40"/>
                <Column size="40"/>
                <Column size="84"/>
                <Column size="44"/>
                <Column size="63"/>
                <Column size="173"/>
                <Column size="74"/>
                <Column size="174"/>
                <Column size="85"/>
                <Column size="167"/>
                <Column size="88"/>
                <Column size="87"/>
                <Column size="89"/>
                <Column size="75"/>
                <Column size="74"/>
                <Column size="69"/>
                <Column size="121"/>
              </Columns>
              <Rows>
                <Row size="24" band="head"/>
                <Row size="24" band="head"/>
                <Row size="20"/>
                <Row size="24" band="summ"/>
              </Rows>
              <Band id="head">
                <Cell class="head_Excel"/>
                <Cell col="1" text="마감"/>
                <Cell col="2" text="취소"/>
                <Cell col="3" rowspan="2" text="매출일자" taborder="undefined"/>
                <Cell col="4" text="매출"/>
                <Cell col="5" colspan="2" text="채권기준" taborder="undefined"/>
                <Cell col="7" colspan="2" text="매출기준" taborder="undefined"/>
                <Cell col="9" rowspan="2" text="창고코드" taborder="undefined"/>
                <Cell col="10" rowspan="2" text="창고명" taborder="undefined"/>
                <Cell col="11" colspan="3" text="매출금액" taborder="undefined"/>
                <Cell col="14" text="매출집계"/>
                <Cell col="15" text="영업회계"/>
                <Cell col="16" rowspan="2" text="생성자" taborder="undefined"/>
                <Cell col="17" rowspan="2" text="생성일시" taborder="undefined"/>
                <Cell row="1"/>
                <Cell row="1" col="1" displaytype="checkbox" edittype="checkbox"/>
                <Cell row="1" col="2" displaytype="checkbox" edittype="checkbox"/>
                <Cell row="1" col="4" text="구분"/>
                <Cell row="1" col="5" text="업장코드"/>
                <Cell row="1" col="6" text="업장명"/>
                <Cell row="1" col="7" text="업장코드"/>
                <Cell row="1" col="8" text="업장명"/>
                <Cell row="1" col="11" text="공급가"/>
                <Cell row="1" col="12" text="부가세"/>
                <Cell row="1" col="13" text="합계"/>
                <Cell row="1" col="14" text="전송여부"/>
                <Cell row="1" col="15" text="마감여부"/>
              </Band>
              <Band id="body">
                <Cell text="expr:currow+1"/>
                <Cell col="1" displaytype="expr:iif(transYn == 'Y' , &quot;none&quot; , &quot;checkbox&quot;)" edittype="expr:iif(transYn == 'Y' , &quot;none&quot; , &quot;checkbox&quot;)" text="bind:chk1"/>
                <Cell col="2" displaytype="expr:transYn=='Y'?'checkbox':'none'" edittype="expr:transYn=='Y'?'checkbox':'none'" text="bind:chk2"/>
                <Cell col="3" displaytype="text" edittype="none" style="align:center middle;" text="bind:saleDate" mask="####-##-##"/>
                <Cell col="4" displaytype="text" style="align:center middle;color:EXPR(modifySalsYn=='Y'?'red':'');color2:EXPR(modifySalsYn=='Y'?'red':'');" text="expr:modifySalsYn=='Y'?'조정':'정상'"/>
                <Cell col="5" displaytype="text" style="align:center middle;" text="bind:upjang2"/>
                <Cell col="6" displaytype="text" edittype="none" style="align:left middle;" text="bind:upjangNm2"/>
                <Cell col="7" displaytype="text" style="align:center middle;" text="bind:upjang"/>
                <Cell col="8" displaytype="text" text="bind:upjangNm"/>
                <Cell col="9" displaytype="text" style="align:center middle;" text="bind:subinvCode"/>
                <Cell col="10" displaytype="text" style="align:left middle;" text="bind:subinvName"/>
                <Cell col="11" displaytype="number" style="align:right middle;" text="bind:netAmt"/>
                <Cell col="12" displaytype="number" style="align:right middle;" text="bind:vatAmt"/>
                <Cell col="13" displaytype="number" style="align:right middle;" text="bind:salAmt"/>
                <Cell col="14" displaytype="text" style="align:center middle;" text="bind:transYn" expr="expr:transYn=='Y'?'Y':''"/>
                <Cell col="15" displaytype="text" style="align:center middle;" text="bind:closeYn" expr="expr:closeYn=='Y'?'Y':''"/>
                <Cell col="16" style="align:center middle;" text="bind:inputUser"/>
                <Cell col="17" style="align:left middle;" text="bind:inputDate"/>
              </Band>
              <Band id="summary">
                <Cell/>
                <Cell col="1"/>
                <Cell col="2"/>
                <Cell col="3"/>
                <Cell col="4"/>
                <Cell col="5"/>
                <Cell col="6"/>
                <Cell col="7"/>
                <Cell col="8"/>
                <Cell col="9"/>
                <Cell col="10"/>
                <Cell col="11" displaytype="number" text="expr:getSum('netAmt')"/>
                <Cell col="12" displaytype="number" text="expr:getSum('vatAmt')"/>
                <Cell col="13" displaytype="number" text="expr:getSum('salAmt')"/>
                <Cell col="14"/>
                <Cell col="15"/>
                <Cell col="16"/>
                <Cell col="17"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Static id="Static09" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 0 396 450 408" anchor="left top"/>
        <Static id="Static14" text="매출상세목록" class="sta_WF_Title01" position="absolute 0 408 450 425" anchor="left top"/>
        <Static id="Static17" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 0 421 450 425" anchor="left top"/>
        <Grid id="grd_listSub" taborder="6" binddataset="ds_listSub" autoenter="select" useinputpanel="false" cellsizingtype="col" autofittype="col" nodataimage="URL('theme://images/grd_WF_NoDataImg.png')" oncellclick="grd_list00_oncellclick" position="absolute 0 425 1237 710" anchor="all">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="44" band="left"/>
                <Column size="73" band="left"/>
                <Column size="69" band="left"/>
                <Column size="121"/>
                <Column size="159"/>
                <Column size="72"/>
                <Column size="86"/>
                <Column size="196"/>
                <Column size="70"/>
                <Column size="46"/>
                <Column size="65"/>
                <Column size="66"/>
                <Column size="65"/>
                <Column size="60"/>
                <Column size="75"/>
              </Columns>
              <Rows>
                <Row size="24" band="head"/>
                <Row size="20"/>
                <Row size="24" band="summ"/>
              </Rows>
              <Band id="head">
                <Cell class="head_Excel"/>
                <Cell col="1" edittype="none" text="매출일자"/>
                <Cell col="2" text="업장코드"/>
                <Cell col="3" text="업장명"/>
                <Cell col="4" text="창고명"/>
                <Cell col="5" text="자재코드"/>
                <Cell col="6" text="자재명"/>
                <Cell col="7" text="규격"/>
                <Cell col="8" text="원산지"/>
                <Cell col="9" text="단위"/>
                <Cell col="10" text="판매수량"/>
                <Cell col="11" text="판매단가"/>
                <Cell col="12" text="판매금액"/>
                <Cell col="13" text="부가세"/>
                <Cell col="14" text="과세구분"/>
              </Band>
              <Band id="body">
                <Cell text="expr:currow+1"/>
                <Cell col="1" displaytype="text" edittype="none" style="align:center middle;" text="bind:transDate" mask="####-##-##"/>
                <Cell col="2" displaytype="text" edittype="none" style="align:center middle;" text="bind:transUpjang"/>
                <Cell col="3" displaytype="text" style="align:left middle;" text="bind:upjangNm"/>
                <Cell col="4" displaytype="text" text="bind:subinvName"/>
                <Cell col="5" style="align:center middle;" text="bind:itemCode"/>
                <Cell col="6" style="align:left middle;" text="bind:itemName"/>
                <Cell col="7" style="align:left middle;" text="bind:itemSize"/>
                <Cell col="8" style="align:left middle;"/>
                <Cell col="9" displaytype="number" style="align:center middle;" text="bind:transUom"/>
                <Cell col="10" style="align:right middle;" text="bind:transQty"/>
                <Cell col="11" style="align:right middle';" text="bind:salePrice"/>
                <Cell col="12" style="align:right middle;" text="bind:saleAmount"/>
                <Cell col="13" style="align:right middle';" text="bind:saleVat"/>
                <Cell col="14" displaytype="combo" edittype="none" style="align:center middle;" text="bind:taxCode" combodataset="ds_vatClass" combocodecol="code" combodatacol="codeName"/>
              </Band>
              <Band id="summary">
                <Cell/>
                <Cell col="1"/>
                <Cell col="2"/>
                <Cell col="3"/>
                <Cell col="4"/>
                <Cell col="5"/>
                <Cell col="6"/>
                <Cell col="7"/>
                <Cell col="8"/>
                <Cell col="9"/>
                <Cell col="10"/>
                <Cell col="11"/>
                <Cell col="12" displaytype="number" style="align:right middle;" text="expr:getSum('saleAmount')"/>
                <Cell col="13" displaytype="number" text="expr:getSum('saleVat')"/>
                <Cell col="14"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Static id="Static20" text="w02" class="Guide01_AreaRed" visible="false" position="absolute 1138 75 1140 95" anchor="top right"/>
        <Button id="btn_cncl" taborder="7" text="마감취소" class="btn_WF_Function" position="absolute 1166 77 1237 97" anchor="top right" onclick="btn_cncl_onclick" visible="false"/>
        <Button id="btn_Closing" taborder="8" text="마감처리" class="btn_WF_Function" position="absolute 1093 77 1164 97" anchor="top right" onclick="btn_Closing_onclick"/>
        <Static id="Static29" text="h06" class="Guide01_AreaRed" visible="false" position="absolute 941 71 1237 77" anchor="top right"/>
        <Static id="Static60" text="w02" class="Guide01_AreaRed" visible="false" position="absolute 1164 77 1166 97" anchor="top right"/>
        <Static id="Static10" text="회계일자" class="sta_WFSA_label" position="absolute 16 39 90 60" anchor="left top"/>
        <Static id="Static12" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 289 40 319 61" anchor="left top"/>
        <Static id="Static00" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 537 40 567 61" anchor="left top"/>
        <UpjangSearchComponent id="comp_upjang" titletext="업장 검색용 Component" taborder="2" text="UpjangSearchComponent03" position="absolute 377 40 543 61" bindDataset="ds_search" bindUpjangCodeColumn="schUpjang" bindUpjangNameColumn="schUpjangNm" eventBeforeTrigger="" eventAfterTrigger="fn_upjangAfter" roleSetId="FmsUpjang" onkeydown="comp_upjang_onkeydown"/>
        <ObjCalendar id="cal_saleDate" titletext="캘린더" taborder="0" text="20150101" scrollbars="none" position="absolute 86 40 181 61" onkeydown="cal_saleDate_onkeydown"/>
        <Button id="btn_remagam" taborder="9" text="재집계" class="btn_WF_Function" position="absolute 1020 77 1091 97" anchor="top right" onclick="btn_remagam_onclick"/>
        <Button id="btn_slaCncl" taborder="10" text="업장회계마감취소" class="btn_WF_Function" position="absolute 1356 215 1469 235" anchor="top right" onclick="btn_slaCncl_onclick" visible="false"/>
        <Static id="notice" text="매출업장 기준 영업회계 마감취소 :" class="sta_WF_DiscInfo" position="absolute 1119 218 1352 236" anchor="top right" visible="false"/>
        <CheckBox id="chk1" taborder="3" text="하위업장 포함 조회(사업장 조건 선택 시)" onclick="chk_onclick" position="absolute 567 41 821 61" anchor="left top" tooltiptext="체크시 하위사업장 포함하여 조회됩니다."/>
        <Button id="btn_closeCheck" taborder="11" text="미마감업장확인" class="btn_WF_Function" position="absolute 917 77 1018 97" anchor="top right" onclick="btn_closeCheck_onclick" visible="true"/>
        <Button id="btn_cncl00" taborder="12" text="마감취소" class="btn_WF_Function" position="absolute 1166 77 1237 97" anchor="top right" onclick="btn_cncl00_onclick"/>
        <ObjCalendar id="cal_saleDateTo" titletext="캘린더" taborder="1" onkeydown="cal_saleDate_onkeydown" text="20150101" scrollbars="none" position="absolute 194 40 289 61"/>
        <Static id="Static02" text="~" position="absolute 183 45 196 57"/>
        <CheckBox id="chk_closingAll" taborder="13" text="하위업장 일괄마감(최초마감시)" onclick="chk_onclick" position="absolute 838 41 1092 61" anchor="left top" tooltiptext="체크시 하위사업장 포함하여 조회됩니다." enable="false" falsevalue="0" truevalue="1"/>
        <Static id="Static13" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 808 40 838 61" anchor="left top"/>
        <Splitter id="sp_line" type="vertical" position="absolute 0 388 1237 396" anchor="left top right" onmove="sp_line_onmove">
          <Formats>
            <Format id="default">
              <SplitterItems id="items">
                <SplitterItem id="item00" position="leftortop" bindtype="resize" componentid="grd_list"/>
                <SplitterItem id="item02" position="rightorbottom" bindtype="resize" componentid="div_center"/>
              </SplitterItems>
            </Format>
          </Formats>
        </Splitter>
      </Layout>
    </Layouts>
    <Bind>
      <BindItem id="item0" compid="chk_closingAll" propid="value" datasetid="ds_search" columnid="closingAll"/>
    </Bind>
    <Objects>
      <Dataset id="ds_list" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" onrowposchanged="ds_list_onrowposchanged" oncolumnchanged="ds_list_oncolumnchanged">
        <ColumnInfo>
          <Column id="chk1" type="STRING" size="256"/>
          <Column id="chk2" type="STRING" size="256"/>
          <Column id="saleDate" type="STRING" size="8"/>
          <Column id="upjang2" type="BIGDECIMAL" size="22"/>
          <Column id="upjangNm2" type="BIGDECIMAL" size="22"/>
          <Column id="upjang" type="BIGDECIMAL" size="22"/>
          <Column id="upjangNm" type="BIGDECIMAL" size="22"/>
          <Column id="subinvCode" type="STRING" size="8"/>
          <Column id="subinvName" type="STRING" size="8"/>
          <Column id="receiptNum" type="STRING" size="18"/>
          <Column id="modifySalsYn" type="STRING" size="18"/>
          <Column id="netAmt" type="BIGDECIMAL" size="22"/>
          <Column id="vatAmt" type="BIGDECIMAL" size="22"/>
          <Column id="salAmt" type="BIGDECIMAL" size="22"/>
          <Column id="transYn" type="STRING" size="1"/>
          <Column id="closeYn" type="STRING" size="1"/>
          <Column id="inputUser" type="STRING" size="256"/>
          <Column id="inputDate" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_search" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" oncolumnchanged="ds_search_oncolumnchanged">
        <ColumnInfo>
          <Column id="schUpjang" type="STRING" size="256"/>
          <Column id="schUpjangNm" type="STRING" size="256"/>
          <Column id="schSaleDate" type="STRING" size="256"/>
          <Column id="schSaleDateTo" type="STRING" size="256"/>
          <Column id="subUpjang" type="INT" size="256"/>
          <Column id="subinvCode" type="STRING" size="256"/>
          <Column id="subVatClass" type="STRING" size="256"/>
          <Column id="receiptNum" type="STRING" size="256"/>
          <Column id="schChk" type="STRING" size="256"/>
          <Column id="sabun" type="STRING" size="256"/>
          <Column id="dateList" type="STRING" size="256"/>
          <Column id="closingAll" type="STRING" size="256"/>
          <Column id="newGubun" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_listSub" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="transId" type="STRING" size="255"/>
          <Column id="transDate" type="STRING" size="255"/>
          <Column id="sourceType" type="STRING" size="255"/>
          <Column id="transType" type="STRING" size="255"/>
          <Column id="transQty" type="BIGDECIMAL" size="255"/>
          <Column id="sourceId" type="STRING" size="255"/>
          <Column id="transMuCd" type="STRING" size="255"/>
          <Column id="transDeptId" type="STRING" size="255"/>
          <Column id="transUpjang" type="STRING" size="255"/>
          <Column id="upjangNm" type="STRING" size="255"/>
          <Column id="subinvCode" type="STRING" size="255"/>
          <Column id="subinvName" type="STRING" size="255"/>
          <Column id="acctcd" type="STRING" size="255"/>
          <Column id="itemCode" type="STRING" size="255"/>
          <Column id="itemName" type="STRING" size="255"/>
          <Column id="itemSize" type="STRING" size="255"/>
          <Column id="taxCode" type="STRING" size="255"/>
          <Column id="transUom" type="STRING" size="255"/>
          <Column id="salePrice" type="BIGDECIMAL" size="255"/>
          <Column id="saleAmount" type="BIGDECIMAL" size="255"/>
          <Column id="saleVat" type="BIGDECIMAL" size="255"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_vatClass" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="groupCode" type="STRING" size="50"/>
          <Column id="code" type="STRING" size="50"/>
          <Column id="codeName" type="STRING" size="500"/>
          <Column id="contents" type="STRING" size="300"/>
          <Column id="sortSeq" type="BIGDECIMAL" size="22"/>
          <Column id="systemYn" type="STRING" size="1"/>
          <Column id="posYn" type="STRING" size="1"/>
          <Column id="set1" type="STRING" size="100"/>
          <Column id="set2" type="STRING" size="100"/>
          <Column id="set3" type="STRING" size="100"/>
          <Column id="set4" type="STRING" size="100"/>
          <Column id="set5" type="STRING" size="100"/>
          <Column id="remark" type="STRING" size="300"/>
          <Column id="useYn" type="STRING" size="1"/>
          <Column id="attr01" type="STRING" size="300"/>
          <Column id="attr02" type="STRING" size="300"/>
          <Column id="attr03" type="STRING" size="300"/>
          <Column id="attr04" type="STRING" size="300"/>
          <Column id="attr05" type="STRING" size="300"/>
          <Column id="attr06" type="STRING" size="300"/>
          <Column id="attr07" type="STRING" size="300"/>
          <Column id="attr08" type="STRING" size="300"/>
          <Column id="attr09" type="STRING" size="300"/>
          <Column id="attr10" type="STRING" size="300"/>
          <Column id="cuser" type="STRING" size="20"/>
          <Column id="cdate" type="DATETIME" size="7"/>
          <Column id="uuser" type="STRING" size="20"/>
          <Column id="udate" type="DATETIME" size="7"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmnAuth" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="srcYn" type="STRING" size="256"/>
          <Column id="insYn" type="STRING" size="256"/>
          <Column id="delYn" type="STRING" size="256"/>
          <Column id="savYn" type="STRING" size="256"/>
          <Column id="prtYn" type="STRING" size="256"/>
          <Column id="exlYn" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="srcYn">1</Col>
            <Col id="insYn">0</Col>
            <Col id="delYn">0</Col>
            <Col id="savYn">0</Col>
            <Col id="prtYn">0</Col>
            <Col id="exlYn">0</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_Yn" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="code" type="STRING" size="256"/>
          <Column id="name" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="code">0</Col>
            <Col id="name">아니오</Col>
          </Row>
          <Row>
            <Col id="code">1</Col>
            <Col id="name">예</Col>
          </Row>
          <Row>
            <Col id="code">N</Col>
            <Col id="name">아니오</Col>
          </Row>
          <Row>
            <Col id="code">Y</Col>
            <Col id="name">예</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_searchValid" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="schUpjang" type="STRING" size="256"/>
          <Column id="schUpjangNm" type="STRING" size="256"/>
          <Column id="schSaleDate" type="STRING" size="256"/>
          <Column id="subUpjang" type="STRING" size="256"/>
          <Column id="subinvCode" type="STRING" size="256"/>
          <Column id="subVatClass" type="STRING" size="256"/>
          <Column id="receiptNum" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="schSaleDate">title:회계일자,required:true,date;true,focus:cal_saleDate</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_searchValid2" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="schUpjang" type="STRING" size="256"/>
          <Column id="schUpjangNm" type="STRING" size="256"/>
          <Column id="schSaleDate" type="STRING" size="256"/>
          <Column id="subUpjang" type="STRING" size="256"/>
          <Column id="subinvCode" type="STRING" size="256"/>
          <Column id="subVatClass" type="STRING" size="256"/>
          <Column id="receiptNum" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="schUpjang">title:사업장,required:true</Col>
            <Col id="schSaleDate">title:회계일자,required:true,date;true,focus:cal_saleDate</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_allYn" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="code" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_searchSub" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="schSaleDate" type="STRING" size="256"/>
          <Column id="subUpjang" type="INT" size="256"/>
          <Column id="subinvCode" type="STRING" size="256"/>
          <Column id="subVatClass" type="STRING" size="256"/>
          <Column id="receiptNum" type="STRING" size="256"/>
          <Column id="newGubun" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <InitValue>
      <CheckBox id="chk_closingAll" value="0"/>
    </InitValue>
    <Script type="xscript4.0"><![CDATA[/*
  화 면 명 : DayCloseMngt
  파 일 명 : DayCloseMngt.xfdl
  기    능 : 일마감관리

    수정일    수정자                  수정내용
  ----------   -------  --------------------------------------------------
  2015.06.08   손형민   최초 생성
  2017.03.29	kihoon	[CH201703_00751] 미마감내역 조회 팝업 프로그램 개발
  2017.03.30	kihoon	[CH201703_00784] 팝업 resizble 추가
*/


/************************************************************************************************
 * 공통 라이브러리 INCLUDE 영역 (필수)
************************************************************************************************/
include "lib::lib_com.xjs";
include "U_lib::lib_conversionCom.xjs";

/************************************************************************************************
 * FORM 변수 선언 영역 (필수)
************************************************************************************************/
var selGubun = "";


/************************************************************************************************
 * FORM EVENT 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : Form Load (필수)
 *---------------------------------------------------------------------------------------------*/
function form_onload(obj:Form, e:LoadEventInfo)
{	
	// Form Load 시 공통 기능 처리(obj:Form, bCreateEvent:이벤트 생성 여부)
	gfn_formOnLoad(this);
	
	// 초기값 셋팅
	fn_init();

	//2020.02.21 김명섭 조회분기처리 구분값 설정
	var rtnParam = gfn_getScreenParams();
	
	if(rtnParam[0] == "NEW")
	{
		selGubun = "Y";
	}
	else
	{
		selGubun = "N";
	}
	ds_search.setColumn(0,"newGubun",selGubun);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 초기값 셋팅
 *---------------------------------------------------------------------------------------------*/
function fn_init()
{
	// 업데이트여부를 체크할 DataSet, 여러개 있을 경우 ;로 구분
	v_ds_check = "ds_list";
	ds_search.addRow();
	
	cal_saleDate.fn_initMonthCal(this, gfn_today(), "", ds_search, "schSaleDate", "Y");	
	cal_saleDateTo.fn_initMonthCal(this, gfn_today(), "", ds_search, "schSaleDateTo", "Y");	
	
	// 하위사업장 포함조회
	chk1.value = 1;
	ds_search.setColumn(0,"schChk", "1");
	
	fn_comCode("ds_vatClass","SC0002");//
     //전체 일마감 처리 권한 체크 20170323 요청자:이혜은과장
	allClose();
}


/************************************************************************************************
 * 공통기능 FUNCTION 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 조회 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_search()
{
	// 조회시 Validation Check
	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;
	ds_list.clearData();

    // Grid sort 표시 초기화(필수)
    gfn_clearSortMark(grd_list);
    
   	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
	fv_objColInfo = gfn_getDatasetInfo(ds_list);
    
    var strSvcID    = "search";
    var strURL      = "fm/fmf/dayCloseMngt/selectList.xdo";
    var strInDs     = "ds_search=ds_search:A";
    var strOutDs    = "ds_list=ds_list";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 신규문서를 등록하기 위한 팝업화면을 호출한다. 
 *---------------------------------------------------------------------------------------------*/
function fn_insert()
{	

}

/*----------------------------------------------------------------------------------------------
 * 설명      : 삭제 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_delete()
{
	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 저장 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_save()
{
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 출력 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_print()
{
	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 도움말 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_help()
{
	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 화면 닫기 전 변경 유무 체크 (필수-Frame에서 창 닫힐때 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_close()
{	
	// v_ds_check 사용시 변경사항 체크
	if(gfn_length(v_ds_check) == 0) 
	{	
		// v_ds_check 설정기준 변경사항 체크
		if (gfn_isDataChange() == true) 
		{		
			// 변경된 데이터가 있습니다. 현재 화면을 닫겠습니까?
			if (!gfn_confirm("confirm.before.movepage")) return false;
		}
	}
    
	// 조회프로그램에도 Return true; 기술해 주세요!
	return true;
}


/************************************************************************************************
 * TRANSACTION 및 CallBack 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 트랜잭션 콜백 함수 (필수)
 *---------------------------------------------------------------------------------------------*/
function fn_callBack(strSvcID, nErrorCode, strErrorMsg)
{
	// 에러시 gfn_callBack에서 메시지 제공, 화면별 특정 에러 발생시에만 사용하세요.
	if (nErrorCode < 0) 
	{
		fn_search();
		return;
	}
	
	var arrHeadChk = [15, 16];	// 마감,취소
	for ( var i=0; i<=arrHeadChk.length; i++ ) {
		if ( grd_list.getCellProperty("head", arrHeadChk[i], "text") == "1" ) {
			grd_list.setCellProperty("head", arrHeadChk[i], "text", "0");
		}
	}
	
    switch(strSvcID)
    {
        case "search" :
// 			ds_listSub.clearData();
//            if(ds_list.getRowCount() > 0){
// 				ds_search.setColumn(0,"subUpjang" , ds_list.getColumn(ds_list.rowpositionm,"upjang"));
// 				ds_search.setColumn(0,"subinvCode" , ds_list.getColumn(ds_list.rowpositionm,"subinvCode"));
// 				fn_searchSub();
//            }
            break;
        case "searchSub" :
           
            break;        
        case "closing" :
           application.httptimeout = temp;
			gfn_alert("msg.action.success");
           fn_search();
            break;                    
         
		case "remagam" :
			gfn_alert("msg.action.success");
           fn_search();
            break;                                
            
		case "cncl" :
			gfn_alert("msg.action.success");
           fn_search();
            break;                                

		case "slcCncl" :
			gfn_alert("msg.action.success");
           fn_search();
            break;                                
    }
}


/************************************************************************************************
 * 사용자 FUNCTION 영역 (필수)
************************************************************************************************/
function fn_comCode(dataset,type){
    gfn_transaction(this
					,"salsType"
					,"sm/cmn/common/selectComCode.xdo"
					,""
					,dataset+"=ds_combo"
					,"groupCode="+wrapQuote(type)
					,"fn_callBack"
					,false);
}
/*----------------------------------------------------------------------------------------------
 * 설명      : 하위 그리드 검색
 *---------------------------------------------------------------------------------------------*/
function fn_searchSub(flag)
{
// v_ds_check 미사용시 변경사항 체크
//  	if (gfn_dsIsUpdated(ds_list) == true) 
//  	{
//  		var retValue = gfn_confirm("confirm.before.search");	// 검색을 진행하면 변경된 데이터가 사라집니다. 계속 진행 하시겠습니까?
//  		if (retValue == false) return;
//  	}

	// 조회시 Validation Check
//	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;


    // Grid sort 표시 초기화(필수)
    gfn_clearSortMark(grd_list);
    
   	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
	fv_objColInfo = gfn_getDatasetInfo (ds_list);    
	
    var strSvcID    = "searchSub";
    var strURL = "";
    if (flag=="Y")
		strURL      = "fm/fmf/dayCloseMngt/selectSubList2.xdo";
	else
		strURL      = "fm/fmf/dayCloseMngt/selectSubList.xdo";
    var strInDs     = "ds_search=ds_searchSub";
    var strOutDs    = "ds_listSub=ds_listSub";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}


/************************************************************************************************
 * 각 COMPONENT 별 EVENT 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 마감처리 버튼 클릭시 마감 프로시저 실행.
 *---------------------------------------------------------------------------------------------*/
 var temp = application.httptimeout;
function btn_Closing_onclick(obj:Button,  e:ClickEventInfo)
{	
	if(ds_list.getRowCount() > 0 && ds_list.findRow("chk1", 1) == -1)
	{
		gfn_alert("마감처리할 건을 선택해 주세요.");
		return;
	}
	  
    //전제 일마감 권한 관리 추가(공통코드에 있는 사용자만 전체 처리 가능)  20170323 요청자:이혜은 과장
    if (numFormat(comp_upjang.getUpjangCode()) == "0")
    {     
 	    if(ds_allYn.getColumn("0", "code") != "1")
 	    {
 		    gfn_alert("전체 사업장 마감 권한이 없습니다.\n\n사업장을 선택하여 주십시오.");
 		    return;
 	    }
 	    
 	    //전체사업장 마감은 하루만 가능
 	    if(cal_saleDate.text != cal_saleDateTo.text && ds_list.findRow("chk1", 1) == -1)
 	    {
 		    gfn_alert("전체 사업장 마감은 기간 설정이 불가능합니다.\n\n회계일자를 같은날로 설정하거나, 사업장을 선택하여 주십시오.");
 		    return;
 	    }
        
        if (gfn_confirm("전체 사업장 마감을 처리하시겠습니까?"))
        {
			// Grid sort 표시 초기화(필수)
			gfn_clearSortMark(grd_list);
			
			//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
			fv_objColInfo = gfn_getDatasetInfo(ds_list);			

			ds_search.setColumn(0, "dateList", ds_search.getColumn(0, "schSaleDate"));
			ds_search.setColumn(0, "schUpjang", "");
			ds_search.setColumn(0, "closingAll", chk_closingAll.value);
		    //전체마감시 시간 소요로 타임아웃 해제 20171107
			application.httptimeout = 0;		
			var strSvcID    = "closing";
			var strURL      = "fm/fmf/dayCloseMngt/closing.xdo";
			var strInDs     = "ds_list=ds_list:A ds_search=ds_search:A";
			var strOutDs    = "";
			var strArg      = "";
			var strCallback = "fn_callBack";
			var bAsync      = true;
			
			gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);        
        }
        
    }
    else
    {
        if(gfn_confirm("confirm.before.action")){
			// Grid sort 표시 초기화(필수)
			gfn_clearSortMark(grd_list);
			
			//회계일자 From To 사이의 날짜를 묶어보내고, java단에서 parsing하여 처리
			var strDateList = "";
				
			for(i = 0; i <= gfn_getDiffDay(cal_saleDate.text, cal_saleDateTo.text); i++){
				strDateList += gfn_addDate(cal_saleDate.text, i) + ",";
			}		
			
			ds_search.setColumn(0, "dateList", strDateList);	
			ds_search.setColumn(0, "closingAll", chk_closingAll.value);
			
			//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
			fv_objColInfo = gfn_getDatasetInfo (ds_list);		

			var strSvcID    = "closing";
			var strURL      = "fm/fmf/dayCloseMngt/closing.xdo";
			var strInDs     = "ds_list=ds_list:A ds_search=ds_search:A";
			var strOutDs    = "";
			var strArg      = "";
			var strCallback = "fn_callBack";
			var bAsync      = true;
			
			gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);     
		}
    }
}
/*----------------------------------------------------------------------------------------------
 * 설명      : 검색 조건(매출일자,사업장) 변경
 *---------------------------------------------------------------------------------------------*/
function ds_search_oncolumnchanged(obj:Dataset, e:DSColChangeEventInfo)
{
	if(e.columnid == "schUpjang" || e.columnid == "schSaleDate"){
		//fn_search();
		ds_list.clearData();
	}
}
/*----------------------------------------------------------------------------------------------
 * 설명      : 매출일자 엔터키 다운 시 검색.
 *---------------------------------------------------------------------------------------------*/
function cal_saleDate_onkeydown(obj:ObjCalendar, e:KeyEventInfo)
{
	if(e.keycode == 13){	
		//fn_search();
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 매출목록 Dataset row 변경 시 이벤트 처리
 *---------------------------------------------------------------------------------------------*/
function ds_list_onrowposchanged(obj:Dataset, e:DSRowPosChangeEventInfo)
{
	ds_listSub.clearData();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 상위 그리드 더블 클릭시 하위 그리드 조회
 *---------------------------------------------------------------------------------------------*/
function grd_list_oncelldblclick(obj:Grid, e:GridClickEventInfo)
{
	if(e.row != -1){
		ds_searchSub.clearData();
		ds_searchSub.addRow();
		ds_searchSub.setColumn(0,"subUpjang" , ds_list.getColumn(e.row, "upjang"));
		ds_searchSub.setColumn(0,"subinvCode" , ds_list.getColumn(e.row, "subinvCode"));
		ds_searchSub.setColumn(0,"receiptNum" , ds_list.getColumn(e.row, "receiptNum"));
		ds_searchSub.setColumn(0,"schSaleDate" , ds_list.getColumn(e.row, "saleDate"));

		//2020.02.21 김명섭 조회분기처리 구분값 설정
		ds_searchSub.setColumn(0,"newGubun",selGubun);

		if (ds_list.getColumn(e.row, "modifySalsYn") == "Y")
			fn_searchSub("Y");		// 조정분
		else
			fn_searchSub("N");		// 정상분
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 상위 그리드 헤더 클릭시 이벤트 처리
 *---------------------------------------------------------------------------------------------*/
function grd_list_onheadclick(obj:Grid, e:GridClickEventInfo)
{
	var nCell = e.cell;   
    var nSubCnt = obj.getSubCellCount("head", nCell);
    var vl_chk;
    
	//모두선택/모두해제 체크박스
	if(obj.getCellProperty("Head", nCell, "edittype") == "checkbox")
	{
		var strVal; 
		
        // Head셋팅
        strVal = obj.getCellProperty("head", nCell, "text");
        
        if (gfn_isNull(strVal)) strVal = "0";

        if (strVal == "0") 
        {
            obj.setCellProperty("head", nCell, "text", '1');
            vl_chk = "1";
        } 
        else 
        {
            obj.setCellProperty("head", nCell, "text", '0');
            vl_chk = "0";
        }

		var strChkVal;
		var strTransYn;
		
		if (nCell == 15)
		{
			strChkVal = "chk1";
			strTransYn = "N";
		}
		else if (nCell == 16) 
		{
			strChkVal = "chk2";
			strTransYn = "Y";
		}
			
		// Body셋팅
		ds_list.enableevent = false;
		grd_list.enableredraw = false;
		for(var i = 0; i < ds_list.rowcount; i++) 
		{
			if(ds_list.getColumn(i, "transYn") == strTransYn)
			{
				ds_list.setColumn(i, strChkVal, vl_chk);
			}
		}
		grd_list.enableredraw = true;
		ds_list.enableevent = true;
	
	} else if ( e.cell == 26 ) {	
		fn_gridSort(obj, e);	// 마감여부 정렬(cuz; gfn_gridSort() error);
	} else {
		gfn_gridSort(obj, e);
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 마감취소 버튼 클릭.
 *---------------------------------------------------------------------------------------------*/
function btn_cncl_onclick(obj:Button,  e:ClickEventInfo)
{
	if(ds_list.findRow("chk2" , "1") == -1){
		gfn_alert("마감취소 처리 할 건이 없습니다.");
		return;
	}
	
	
   //전제 일마감 권한 관리 추가(공통코드에 있는 사용자만 전체 처리 가능)  20170323 요청자:이혜은 과장
    if (numFormat(comp_upjang.getUpjangCode() ) == "0")
    {     
 	    if(ds_allYn.getColumn("0","code") != "1") 
 	    {
 		    gfn_alert("전체 사업장 마감 취소 권한이 없습니다. " +String.fromCharCode(13)+String.fromCharCode(13)+ "사업장을 선택하여 주십시요.");
 		    return;
 	    }
        
        if (gfn_confirm("전체 사업장 마감을 취소하시겠습니까? ")){
        
		    // Grid sort 표시 초기화(필수)
	    	gfn_clearSortMark(grd_list);
		
		    //서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
			fv_objColInfo = gfn_getDatasetInfo (ds_list);
			

			var strSvcID    = "cncl";
			var strURL      = "fm/fmf/dayCloseMngt/cncl.xdo";
			var strInDs     = "ds_list=ds_list:A ds_search=ds_search:A";
			var strOutDs    = "";
			var strArg      = "";
			var strCallback = "fn_callBack";
			var bAsync      = true;
			
			gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
        }
        
    }
    else
    {	
    	if(gfn_confirm("마감취소 처리 하시겠습니까?"))
    	{			
			// Grid sort 표시 초기화(필수)
			gfn_clearSortMark(grd_list);
			
			//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
			fv_objColInfo = gfn_getDatasetInfo (ds_list);
			

			var strSvcID    = "cncl";
			var strURL      = "fm/fmf/dayCloseMngt/cncl.xdo";
			var strInDs     = "ds_list=ds_list:A ds_search=ds_search:A";
			var strOutDs    = "";
			var strArg      = "";
			var strCallback = "fn_callBack";
			var bAsync      = true;
			
			gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
	    }
    }	
		
	
	
// 	
// 	if(gfn_confirm("마감취소 처리 하시겠습니까?")){
// 		
// 		// Grid sort 표시 초기화(필수)
// 		gfn_clearSortMark(grd_list);
// 		
// 		//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
// 		fv_objColInfo = gfn_getDatasetInfo (ds_list);
// 		
// 
// 		var strSvcID    = "cncl";
// 		var strURL      = "fm/fmf/dayCloseMngt/cncl.xdo";
// 		var strInDs     = "ds_list=ds_list:A ds_search=ds_search:A";
// 		var strOutDs    = "";
// 		var strArg      = "";
// 		var strCallback = "fn_callBack";
// 		var bAsync      = true;
// 		
// 		gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
// 	}
}

//재집계 버튼 클릭
//체크한 항목 모두 재집계되도록 수정(20171101 유선미)
function btn_remagam_onclick(obj:Button, e:ClickEventInfo)
{
	if(ds_list.getRowCount() == 0)
	{
		gfn_alert("조회된 데이터가 없습니다.");
		fn_search();
		return;
	}
	
	if(ds_list.getRowCount() > 0 && ds_list.findRow("chk1", 1) == -1)
	{
		gfn_alert("선택된 항목이 없습니다.");
		return;
	}
	
	//전제 일마감 권한 관리 추가(공통코드에 있는 사용자만 전체 처리 가능)  20170323 요청자:이혜은 과장
    if (numFormat(comp_upjang.getUpjangCode()) == "0" && ds_allYn.getColumn("0", "code") != "1")
    {     
		gfn_alert("전체 사업장 재집계 권한이 없습니다.\n\n사업장을 선택하여 주십시오.");
		return;
    }

	if(gfn_confirm("선택한 항목을 재집계 하시겠습니까?"))
	{	
		// Grid sort 표시 초기화(필수)
		gfn_clearSortMark(grd_list);

		//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
		fv_objColInfo = gfn_getDatasetInfo (ds_list);			

		var strSvcID    = "remagam";
		var strURL      = "fm/fmf/dayCloseMngt/remagam.xdo";
		var strInDs     = "ds_list=ds_list:A ds_search=ds_search:A";
		var strOutDs    = "";
		var strArg      = "";
		var strCallback = "fn_callBack";
		var bAsync      = true;
		
		gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 영업회계 마감취소 버튼 클릭 - 부분취소 기능 반영
 *---------------------------------------------------------------------------------------------*/
function btn_slaCncl_onclick(obj:Button,  e:ClickEventInfo)
{
	var nRowCnt = ds_list.getRowCount();	// DataSet Count
	var nRow = ds_list.rowposition;
	var sMsg = "";

	// 필수입력 CHECK : 회계일자, 사업장
	if (gfn_validCheck(ds_search, ds_searchValid2, true) == false) return;

	// 조회 건수 CHECK
	if(nRowCnt == 0) 
	{
		sMsg = "사업장 마감정보가 존재하지 않습니다.";
		gfn_alert(sMsg, "", "A");
		return;
	}
	
	// 마감여부 CHECK
	if(nRow == -1) 
	{
		sMsg = "마감취소할 대상을 선택하십시오.";
		gfn_alert(sMsg, "", "A");
		return;
	}
	
	if (ds_list.getColumn(nRow, "closeYn") != "Y") {
		sMsg = "영업회계 마감처리된 자료만 취소 가능합니다.";
		gfn_alert(sMsg, "", "A");
		return;
	}
		
 	sMsg = "영업회계 마감을 취소합니다.\n계속 진행 하시겠습니까?\n\n";
  	sMsg = sMsg + " - 업장 : (" + ds_search.getColumn(0, "schUpjang") + ")" + ds_search.getColumn(0, "schUpjangNm") + "\n";
  	sMsg = sMsg + " - 일자 : " + gfn_getFormat(ds_search.getColumn(0, "schSaleDate"),"@@@@-@@-@@") + "\n";
  	  	
  	if (!gfn_confirm(sMsg, "", "C")) return;
  	
  	// Grid sort 표시 초기화(필수)
  	gfn_clearSortMark(grd_list);
  	
  	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
 	fv_objColInfo = gfn_getDatasetInfo (ds_list);  	
  
  	var strSvcID    = "slcCncl";
  	var strURL      = "fm/fmf/dayCloseMngt/slaCncl.xdo";
  	var strInDs     = "ds_list=ds_list:A ds_search=ds_search:A";
  	var strOutDs    = "";
  	var strArg      = "";
  	var strCallback = "fn_callBack";
  	var bAsync      = true;
  	
  	gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}

function chk_onclick(obj:CheckBox,  e:ClickEventInfo)
{
	if(chk1.value == true)
		ds_search.setColumn(0,"schChk", "1");
	else	
		ds_search.setColumn(0,"schChk", "");
	// 리스트 초기화
	ds_list.clearData();
}

//전제 일마감 권한 관리 추가(공통코드에 있는 사용자만 전체 처리 가능)  20170323 요청자:이혜은 과장
function allClose()
{

    ds_search.setColumn("0","sabun",g_EmpNo);
    //ds_allYn.addRow();
    
  	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
	fv_objColInfo = gfn_getDatasetInfo (ds_list);


     var strSvcID    = "selectAllClose";
     var strURL      = "fm/fmf/dayCloseMngt/selectAllClose.xdo";
     var strInDs     = "ds_search=ds_search:A";
     var strOutDs    = "ds_allYn=ds_allYn";
     var strArg      = "";
     var strCallback = "fn_callBack";
     var bAsync      = true;

     gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);

}

function btn_closeCheck_onclick(obj:Button,  e:ClickEventInfo) {
	// 팝업창을 호출한다	
	var strId       = "DayCloseMngtCheckPop";
	var strURL      = "X_FMF::DayCloseMngtCheckPop.xfdl";
	var objArgument = {
		P_DATASET : null
	};
	
	var nWidth      = 1280;
	var nHeight     = 600;
	var strStyle    = "";
	var nLeft       = -1;
	var nTop        = -1;
	var isModeless  = true;
	var bShowTitle  = true;
	var strAlign    = "-1";
	var resible		= true;
	
	// 리턴값을 배열로 받을 경우	
	var arrRtn = gfn_dialog(strId, strURL, objArgument, nWidth, nHeight, strStyle, nLeft, nTop, isModeless, bShowTitle, strAlign, resible);
}



function fn_gridSort(obj:Grid, e:GridClickEventInfo)
{
	//trace("gfn_gridSort : " + obj.name);
	// 그리드 멀티소트 초기화
	obj.dsMultiSort = "";

    var bindDs = eval(obj.binddataset);
    if (bindDs.rowcount == 0) return false;
		
    var CONST_SORT_MARK = "";

    var strHeadText  = obj.getCellProperty("body", e.col,"text");
    strHeadText = gfn_nvl(strHeadText);
    
    // 엑셀 아이콘시에 엑셀 다운로드
    var strHeadClass = obj.getCellProperty("head", e.col,"class");
    if(strHeadClass == "head_Excel")
    {
		gfn_exportExcel(obj);
		return;
    }
    
    var BodyColId = (strHeadText).toString().split(":");    // e.col : 바인드된 컬럼.
    if (BodyColId[0] != "bind") 
    {
        return false;
    }

    // 체크박스일때 check All
    var strEditType = obj.getCellProperty("head", e.cell,"displaytype");
    
    if(strEditType == "checkbox")
    {
		gfn_setGridCheckAll(obj, e);
		//항상 첫번째 행을 선택하도록 한다.
		bindDs.selectRow(0);
		return;
    }

    for (var i = 0; i < obj.getCellCount("head"); i++) 
    {
        if(obj.getCellText(-1, i) == "undefined") continue;
        
        var strHeadText = obj.getCellText(-1, i);
        
        if(i == e.cell) 
        {
            if (strHeadText.substr(strHeadText.length - 1) == CONST_ASC_MARK) {
                obj.setCellProperty( "head", i, "text", strHeadText.substr(0, strHeadText.length - 2) + " " + CONST_DESC_MARK);
                bindDs.keystring = "S:-" + BodyColId[1];
            } else if (strHeadText.substr(strHeadText.length - 1) == CONST_DESC_MARK) {
                obj.setCellProperty( "head", i, "text", strHeadText.substr(0, strHeadText.length - 2));
                bindDs.keystring = bindDs.keystring.default;
            } else {
                obj.setCellProperty( "head", i, "text", strHeadText + " " + CONST_ASC_MARK);
                bindDs.keystring = "S:+" + BodyColId[1];
            }
        } else {    // 정렬표시 삭제
            if (strHeadText.substr(strHeadText.length - 1) == CONST_ASC_MARK || strHeadText.substr(strHeadText.length - 1) == CONST_DESC_MARK) {
                obj.setCellProperty( "head", i, "text", strHeadText.substr(0, strHeadText.length - 2));
            }
        }
    }
    
	//항상 첫번째 행을 선택하도록 한다.
    bindDs.selectRow(0);
}

/////////////////////test
function btn_cncl00_onclick(obj:Button,  e:ClickEventInfo)
{
	var nRow = ds_list.rowposition;
	var sMsg = "";

	// 필수입력 CHECK : 회계일자, 사업장
	if (gfn_validCheck(ds_search, ds_searchValid, true) == false) return;

	if(ds_list.getRowCount() == 0) 
	{
		sMsg = "사업장 마감정보가 존재하지 않습니다.";
		gfn_alert(sMsg, "", "A");
		return;
	}
	
	if(ds_list.getRowCount() > 0 && ds_list.findRow("chk2", 1) == -1){
		gfn_alert("선택된 항목이 없습니다.");
		return;
	}
	
	//전제 일마감 권한 관리 추가(공통코드에 있는 사용자만 전체 처리 가능)  20170323 요청자:이혜은 과장
    if (gfn_isNull(comp_upjang.getUpjangCode()))
    {     
 	    if(ds_allYn.getColumn("0", "code") != "1") 
 	    {
 		    gfn_alert("전체 사업장 마감 취소 권한이 없습니다.\n사업장을 선택하여 주십시요.");
 		    return;
 	    }
 	    else
 	    {
			sMsg = "전체 사업장 마감을 취소하시겠습니까?"
 	    }
 	}
 	else
 	{
		sMsg = "마감을 취소합니다.\n계속 진행 하시겠습니까?\n\n";
	//	sMsg += " - 업장 : (" + ds_search.getColumn(0, "schUpjang") + ")" + ds_search.getColumn(0, "schUpjangNm") + "\n";
	//	sMsg += " - 일자 : " + gfn_getFormat(ds_search.getColumn(0, "schSaleDate"),"@@@@-@@-@@");
 	}	
  	  	
  	if (!gfn_confirm(sMsg, "", "C")) return;
  	
  	// Grid sort 표시 초기화(필수)
  	gfn_clearSortMark(grd_list);
  	
  	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
 	fv_objColInfo = gfn_getDatasetInfo (ds_list);  	
  
  	var strSvcID    = "slcCncl";
  	var strURL      = "fm/fmf/dayCloseMngt/slaCncl.xdo";
  	var strInDs     = "ds_list=ds_list:A ds_search=ds_search:A";
  	var strOutDs    = "";
  	var strArg      = "";
  	var strCallback = "fn_callBack";
  	var bAsync      = true;
  	
  	gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}

//사업장 변경 후 발생하는 이벤트(20171102 유선미)
function fn_upjangAfter()
{
	//사업장을 선택한 경우에만 [하위업장 일괄마감] 체크박스 활성화
	chk_closingAll.enable = !gfn_isNull(comp_upjang.getUpjangCode());
	ds_search.setColumn(0, "closingAll", 0);	
}

//매출목록 값 변경 후 발생
function ds_list_oncolumnchanged(obj:Dataset, e:DSColChangeEventInfo)
{
	switch(e.columnid)
	{
		//마감 체크박스
		case "chk1" :
			//매출일자, 매출업장이 같으면 다른 창고들도 모두 체크, 체크해제(20171110 유선미)
			for(var i = 0; i < obj.getRowCount(); i++)
			{
				var curSaleDate = obj.getColumn(e.row, "saleDate");
				var curUpjang 	= obj.getColumn(e.row, "upjang");
				var expr 		= "saleDate == '" + curSaleDate + "' && upjang == '" + curUpjang + "' && chk1 != " + e.newvalue;				
				var nFindRow 	= obj.findRowExpr(expr);
				
				if(nFindRow > -1)
				{
					obj.setColumn(nFindRow, e.columnid, e.newvalue);
				}
				else
				{
					break;
				}
			}
			
			break;
			
		//취소 체크박스
		case "chk2" :
			//매출일자, 매출업장이 같으면 다른 창고들도 모두 체크, 체크해제(20171110 유선미)
			for(var i = 0; i < obj.getRowCount(); i++)
			{
				var curSaleDate = obj.getColumn(e.row, "saleDate");
				var curUpjang 	= obj.getColumn(e.row, "upjang");
				var expr 		= "saleDate == '" + curSaleDate + "' && upjang == '" + curUpjang + "' && chk2 != " + e.newvalue;				
				var nFindRow 	= obj.findRowExpr(expr);
				
				if(nFindRow > -1)
				{
					obj.setColumn(nFindRow, e.columnid, e.newvalue);
				}
				else
				{
					break;
				}
			}
			
			break;
	}
}

//사업장 key down
function comp_upjang_onkeydown(obj:UpjangSearchComponent, e:KeyEventInfo)
{
	if(e.keycode == 13) obj.btn_search.click();
}

//splitter(20171117 유선미)
function sp_line_onmove(obj:Splitter, e:MoveEventInfo)
{
	Static14.position.top = e.y + 22;
	Static14.position.height = 18;
	grd_listSub.position.top = e.y + 38;
}
]]></Script>
  </Form>
</FDL>
