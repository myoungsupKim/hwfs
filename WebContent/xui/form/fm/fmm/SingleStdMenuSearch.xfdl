<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="..\..\..\default_typedef.xml"/>
  <Form id="SingleStdMenuSearch" onkeydown="frm_OnKeyDown" onload="form_onload" titletext="개별표준식단조회" position="absolute 0 0 1252 725" scrollbars="none">
    <Layouts>
      <Layout>
        <Static id="sta_detail05" class="sta_WFDA_Labelbg" position="absolute 0 292 1237 319" onclick="sta_detail05_onclick"/>
        <Static id="Static00" text="식 단 코 드" position="absolute 0 292 85 319" class="sta_WFDA_Label01" onclick="Static00_onclick"/>
        <Static id="Static08" class="sta_WFSA_Labelbg" position="absolute 0 30 1237 71" anchor="left top right"/>
        <Grid autoenter="select" binddataset="ds_list" cellsizingtype="both" readonly="false" enable="true" id="grd_list" useinputpanel="false" oncellclick="grd_list_OnCellClick" oncelldblclick="grd_list_OnCellDblClick" onheadclick="grd_list_OnHeadClick" onmousemove="grd_list_OnMouseOver" taborder="6" tabstop="true" tooltiptype="hover" usecontextmenu="true" useselcolor="true" visible="true" wheelscrollrow="1" position="absolute 0 86 1237 287" selecttype="row" autofittype="col">
          <Formats>
            <Format id="Default">
              <Columns>
                <Column size="30" band="left"/>
                <Column size="89"/>
                <Column size="75"/>
                <Column size="120"/>
                <Column size="83"/>
                <Column size="522"/>
                <Column size="34"/>
              </Columns>
              <Rows>
                <Row size="26" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell displaytype="image" class="head_Excel"/>
                <Cell col="1" displaytype="text" text="식단코드"/>
                <Cell col="2" displaytype="text" text="분류"/>
                <Cell col="3" displaytype="text" text="식단명"/>
                <Cell col="4" displaytype="text" text="식단원가"/>
                <Cell col="5" displaytype="text" text="레시피구성"/>
                <Cell col="6" displaytype="text" text="사진"/>
              </Band>
              <Band id="body">
                <Cell displaytype="text" style="align:center;" expr="expr:currow+1"/>
                <Cell col="1" displaytype="text" style="align:left;" text="bind:SINGLE_MENU_CD"/>
                <Cell col="2" displaytype="combo" style="align:left;" text="bind:MENU_CLASS" combodataset="ds_MENU_CLASS" combocodecol="CODE" combodatacol="CODE_NAME"/>
                <Cell col="3" displaytype="text" style="align:left;" text="bind:MENU_NAME"/>
                <Cell col="4" displaytype="number" style="align: ;" text="bind:MENU_COST"/>
                <Cell col="5" displaytype="text" style="align:left;" text="bind:RECIPE_INFO"/>
                <Cell col="6" displaytype="expr:iif(gfn_length(SPHOTO_PATH_1)+gfn_length(SPHOTO_PATH_2)&gt; 0,'button','normal')" style="backgroundimage:EXPR(iif(gfn_length(SPHOTO_PATH_1)+gfn_length(SPHOTO_PATH_2)&gt; 0,'btn_Popup1'));cursor:expr:iif(length(SPHOTO_PATH_1) +length(SPHOTO_PATH_2) &gt; 0,'hand','arrow');align:left;"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Button enable="false" id="btn_pop1" onclick="btn_pop_common_OnClick" taborder="10" text="레시피정보" position="absolute 0 332 100 354" class="btn_WF_CRUD" image=""/>
        <Button enable="false" id="btn_pop2" onclick="btn_pop_common_OnClick" taborder="11" text="자재영양성분" visible="false" position="absolute 203 332 303 354" class="btn_WF_CRUD"/>
        <Button enable="false" id="btn_pop3" onclick="btn_pop_common_OnClick" taborder="12" text="식단영양성분" position="absolute 102 332 201 354" class="btn_WF_CRUD"/>
        <Button enable="false" id="btn_pop4" onclick="btn_pop_common_OnClick" taborder="13" text="식단사진정보" position="absolute 857 332 956 354" class="btn_WF_CRUD" image=""/>
        <Button enable="false" id="btn_pop5" onclick="btn_pop5_OnClick" taborder="14" text="식단복사" position="absolute 958 332 1033 354" class="btn_WF_CRUD" image=""/>
        <Button enable="false" id="btn_pop6" onclick="btn_pop6_OnClick" taborder="15" text="레시피 추가" position="absolute 1035 332 1135 354" class="btn_WF_CRUD" image=""/>
        <Button enable="false" id="btn_Del_Recipe" onclick="btn_Del_Recipe_OnClick" taborder="25" text="레시피 삭제" position="absolute 1137 332 1237 354" class="btn_WF_CRUD" image=""/>
        <Grid autoenter="select" binddataset="ds_Detail2" cellsizingtype="both" readonly="false" enable="true" id="grd_Detail" useinputpanel="false" onheadclick="grd_list_OnHeadClick" onmousemove="grd_Detail_OnMouseOver" taborder="9" tabstop="true" tooltiptype="hover" usecontextmenu="true" useselcolor="true" visible="true" wheelscrollrow="1" position="absolute 0 359 1237 710" selecttype="row" autofittype="col">
          <Formats>
            <Format id="Default">
              <Columns>
                <Column size="30"/>
                <Column size="31"/>
                <Column size="53"/>
                <Column size="90"/>
                <Column size="87"/>
                <Column size="135"/>
                <Column size="70"/>
                <Column size="40"/>
                <Column size="55"/>
                <Column size="55"/>
                <Column size="68"/>
                <Column size="78"/>
                <Column size="52"/>
                <Column size="50"/>
                <Column size="60"/>
              </Columns>
              <Rows>
                <Row size="48" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell displaytype="text" class="head_Excel"/>
                <Cell col="1" displaytype="text" text="순서" wordwrap="word"/>
                <Cell col="2" displaytype="text" text="레시피 코드" wordwrap="word"/>
                <Cell col="3" displaytype="text" text="레시피명"/>
                <Cell col="4" displaytype="text" text="자재코드"/>
                <Cell col="5" displaytype="text" text="자재명" wordwrap="word"/>
                <Cell col="6" displaytype="text" text="규격" wordwrap="word"/>
                <Cell col="7" displaytype="text" text="구매 단위" wordwrap="word"/>
                <Cell col="8" displaytype="text" text="자재 특성" wordwrap="word"/>
                <Cell col="9" displaytype="text" text="구매단가" wordwrap="word"/>
                <Cell col="10" displaytype="text" text="표준 1인량 (g)" wordwrap="word"/>
                <Cell col="11" displaytype="text" text="1인량 비율조정(%)" wordwrap="word"/>
                <Cell col="12" displaytype="text" text="조정&#10;1인량(g)"/>
                <Cell col="13" displaytype="text" text="1인당 원가" wordwrap="word"/>
                <Cell col="14" displaytype="text" text="구성요소" wordwrap="word"/>
              </Band>
              <Band id="body">
                <Cell displaytype="text" style="align:center;" expr="expr:currow+1"/>
                <Cell col="1" displaytype="number" edittype="text" editfilter="number" style="align:center;" text="bind:RECIPE_SEQ" suppress="1"/>
                <Cell col="2" displaytype="text" style="align:left;" text="bind:RECIPE_CD" suppress="2"/>
                <Cell col="3" displaytype="text" style="align:left;" text="bind:RECIPE_NAME" suppress="3"/>
                <Cell col="4" displaytype="text" style="background:EXPR(iif(RESTRICT_YN=='1','#ffaa9cff',iif(MARGIN_PRICE==0 &amp;&amp; ITEM_CODE!=g_WaterCode,'#ffe49cff','')));background2:EXPR(iif(RESTRICT_YN=='1','#ffaa9cff',iif(MARGIN_PRICE==0 &amp;&amp; ITEM_CODE!=g_WaterCode,'#ffe49cff','#F6FCFC')));align:left;" text="bind:ITEM_CODE"/>
                <Cell col="5" displaytype="text" style="background:EXPR(iif(RESTRICT_YN=='1','#ffaa9cff',iif(MARGIN_PRICE==0 &amp;&amp; ITEM_CODE!=g_WaterCode,'#ffe49cff','')));background2:EXPR(iif(RESTRICT_YN=='1','#ffaa9cff',iif(MARGIN_PRICE==0 &amp;&amp; ITEM_CODE!=g_WaterCode,'#ffe49cff','#F6FCFC')));align:left;" text="bind:ITEM_NAME"/>
                <Cell col="6" displaytype="text" style="align:left;" text="bind:ITEM_SIZE"/>
                <Cell col="7" displaytype="text" style="align:left;" text="bind:PO_UOM"/>
                <Cell col="8" displaytype="text" style="align:left;" text="bind:ITEM_SPEC"/>
                <Cell col="9" displaytype="number" style="align: ;" text="bind:MARGIN_PRICE"/>
                <Cell col="10" displaytype="number" style="align: ;" text="bind:NEED_QTY"/>
                <Cell col="11" displaytype="number" edittype="text" editfilter="number" style="align: ;" text="bind:ITEM_RATE" suppress="4"/>
                <Cell col="12" displaytype="number" style="align: ;" text="bind:NEED_QTY_RATE"/>
                <Cell col="13" displaytype="number" style="align: ;" text="bind:UNIT_COST"/>
                <Cell col="14" displaytype="combo" edittype="combo" style="align:left;" text="bind:DISH_INFO" suppress="5" combodataset="ds_DISH_INFO" combocodecol="CODE" combodatacol="CODE_NAME"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Static id="Static02" text="개별식단분류" position="absolute 16 39 112 65" class="sta_WFSA_label"/>
        <Static id="Static12" text="식단명" position="absolute 264 39 360 65" class="sta_WFSA_label"/>
        <Static id="Static13" text="식단원가" position="absolute 473 39 569 65" class="sta_WFSA_label"/>
        <Static id="Static14" text="레시피명" position="absolute 739 39 835 65" class="sta_WFSA_label" onclick="Static14_onclick"/>
        <Combo codecolumn="CODE" datacolumn="CODE_NAME" id="cbo_S_MENU_CLASS" index="0" innerdataset="ds_MENU_CLASS" type="NOTFILTERED" taborder="1" position="absolute 109 40 234 61" class="cmb_WF_Essential"/>
        <Edit id="ed_S_MENU_NAME" taborder="2" position="absolute 318 40 443 61"/>
        <MaskEdit id="med_F_MENU_COST" taborder="3" position="absolute 542 40 617 61"/>
        <Static id="Static4" text="~" position="absolute 622 40 631 62"/>
        <MaskEdit id="med_T_MENU_COST" taborder="4" position="absolute 634 40 709 61"/>
        <Combo codecolumn="RECIPE_NAME" datacolumn="RECIPE_NAME" id="cbo_RECIPE_NAME" index="0" innerdataset="ds_RECIPE_List" onchar="cbo_OnChar" onkillfocus="cbo_OnKillFocus" type="filter" taborder="5" position="absolute 806 40 939 61"/>
        <Static id="Static0" text="개별식단분류" position="absolute 199 292 284 319" class="sta_WFDA_Label01"/>
        <Static id="Static1" text="식  단  명" position="absolute 411 292 496 319" class="sta_WFDA_Label01" onclick="Static1_onclick"/>
        <Static id="Static2" text="식 단 원 가" position="absolute 787 292 872 319" class="sta_WFDA_Label01"/>
        <Edit enable="false" id="ed_SINGLE_MENU_CD" readonly="true" taborder="7" position="absolute 87 295 197 316"/>
        <Combo codecolumn="CODE" datacolumn="CODE_NAME" id="cbo_MENU_CLASS" index="0" innerdataset="ds_MENU_CLASS" type="NOTFILTERED" taborder="8" position="absolute 286 295 409 316" class="cmb_WF_Essential"/>
        <Edit id="ed_MENU_NAME" imemode="none" taborder="20" position="absolute 498 295 785 316" class="edt_WF_Essential"/>
        <MaskEdit id="med_MENU_COST" taborder="21" position="absolute 874 295 971 316"/>
        <Static id="Static3" text="원가는 표준단가(경인센터 평균단가)입니다." position="absolute 305 339 551 361" onclick="Static3_onclick" class="sta_WF_DiscInfo"/>
        <Div id="div_cmnBtn" anchor="left top right" taborder="42" url="cmn::CmnBtn.xfdl" text="Div00" scrollbars="none" position="absolute 0 0 1237 30"/>
        <Static id="Static15" text="h06" onclick="Static03_onclick" class="Guide01_AreaRed" visible="false" position="absolute 0 71 144 86" anchor="top right"/>
        <Static id="Static17" text="w15" onclick="Static06_onclick" class="Guide01_AreaRed" visible="false" position="absolute 1237 0 1252 710" anchor="top right"/>
        <Static id="Static71" text="h15" onclick="Static71_onclick" class="Guide01_AreaRed" visible="false" position="absolute 0 710 1252 725" anchor="left bottom"/>
        <Static id="Static23" text="W15" visible="false" position="absolute 1 40 16 61" style="background:#ff000055;align:center middle;"/>
        <Static id="Static18" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 100 40 110 61"/>
        <Static id="Static20" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 234 40 264 61"/>
        <Static id="Static21" text="W10" visible="false" position="absolute 0 30 1237 40" style="background:#ff000055;align:center middle;"/>
        <Static id="Static05" text="W10" visible="false" position="absolute 0 61 1237 71" style="background:#ff000055;align:center middle;"/>
        <Static id="Static24" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 308 40 318 61"/>
        <Static id="Static25" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 443 40 473 61"/>
        <Static id="Static26" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 532 40 542 61"/>
        <Static id="Static27" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 709 40 739 61"/>
        <Static id="Static28" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 796 40 806 61"/>
        <Static id="Static03" onclick="Static03_onclick" class="Guide01_AreaRed" visible="false" position="absolute 0 319 1237 326"/>
        <Static id="Static09" onclick="Static03_onclick" class="Guide01_AreaRed" visible="false" position="absolute 0 286 1237 293"/>
        <Static id="Static30" text="h06" onclick="Static03_onclick" class="Guide01_AreaRed" visible="false" position="absolute 1093 326 1237 332" anchor="top right"/>
        <Static id="Static31" text="h05" class="Guide01_AreaRed" visible="false" position="absolute 1093 354 1237 359" anchor="top right"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_list">
        <ColumnInfo>
          <Column id="MENU_CLASS" size="20" type="STRING"/>
          <Column id="MENU_COST" size="22" type="BIGDECIMAL"/>
          <Column id="MENU_NAME" size="50" type="STRING"/>
          <Column id="PHOTO_PATH_1" size="200" type="STRING"/>
          <Column id="PHOTO_PATH_2" size="200" type="STRING"/>
          <Column id="PHOTO_TITLE_1" size="200" type="STRING"/>
          <Column id="PHOTO_TITLE_2" size="200" type="STRING"/>
          <Column id="PHOTO_URL_1" size="4000" type="STRING"/>
          <Column id="PHOTO_URL_2" size="4000" type="STRING"/>
          <Column id="RECIPE_INFO" size="4000" type="STRING"/>
          <Column id="SINGLE_MENU_CD" size="20" type="STRING"/>
          <Column id="SPHOTO_PATH_1" size="200" type="STRING"/>
          <Column id="SPHOTO_PATH_2" size="200" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_input">
        <ColumnInfo>
          <Column id="MENU_CLASS" size="256" type="STRING"/>
          <Column id="MENU_NAME" size="256" type="STRING"/>
          <Column id="RECIPE_NAME" size="256" type="STRING"/>
          <Column id="SINGLE_MENU_CD" size="256" type="STRING"/>
          <Column id="FILEURL" size="256" type="STRING"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="FILEURL"/>
            <Col id="MENU_CLASS"/>
            <Col id="MENU_NAME"/>
            <Col id="RECIPE_NAME"/>
            <Col id="SINGLE_MENU_CD"/>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_MENU_CLASS">
        <ColumnInfo>
          <Column id="CODE" size="256" type="STRING"/>
          <Column id="code_name" size="256" type="STRING"/>
          <Column id="SET1" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_RECIPE_List"/>
      <Dataset id="ds_Detail1">
        <ColumnInfo>
          <Column id="DISH_INFO" size="20" type="STRING"/>
          <Column id="RECIPE_CD" size="20" type="STRING"/>
          <Column id="SINGLE_MENU_CD" size="20" type="STRING"/>
          <Column id="RECIPE_SEQ" size="256" type="INT"/>
          <Column id="RECIPE_NAME" size="256" type="STRING"/>
          <Column id="ITEM_RATE" size="256" type="INT"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_Detail2" oncolumnchanged="ds_Detail2_OnColumnChanged" onrowposchanged="ds_OnRowPosChanged">
        <ColumnInfo>
          <Column id="CUISINE_TYPE" size="20" type="STRING"/>
          <Column id="CUT_SPEC" size="20" type="STRING"/>
          <Column id="DISH_INFO" size="20" type="STRING"/>
          <Column id="DISUSE_RATE" size="22" type="BIGDECIMAL"/>
          <Column id="EDIBLE_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="ITEM_CODE" size="12" type="STRING"/>
          <Column id="ITEM_COST" size="22" type="BIGDECIMAL"/>
          <Column id="ITEM_NAME" size="200" type="STRING"/>
          <Column id="ITEM_RATE" size="22" type="BIGDECIMAL"/>
          <Column id="ITEM_SIZE" size="100" type="STRING"/>
          <Column id="ITEM_SPEC" size="100" type="STRING"/>
          <Column id="MARGIN_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="NEED_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="NEED_QTY_RATE" size="22" type="BIGDECIMAL"/>
          <Column id="PO_UOM" size="10" type="STRING"/>
          <Column id="RECIPE_CD" size="20" type="STRING"/>
          <Column id="RECIPE_NAME" size="50" type="STRING"/>
          <Column id="RECIPE_SEQ" size="22" type="BIGDECIMAL"/>
          <Column id="RESTRICT_PERIOD" size="21" type="STRING"/>
          <Column id="RESTRICT_REASON" size="200" type="STRING"/>
          <Column id="RESTRICT_YN" size="1" type="STRING"/>
          <Column id="SINGLE_MENU_CD" size="20" type="STRING"/>
          <Column id="UNIT_COST" size="22" type="BIGDECIMAL"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_DISH_INFO">
        <ColumnInfo>
          <Column id="CODE" size="256" type="STRING"/>
          <Column id="code_name" size="256" type="STRING"/>
          <Column id="SET1" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_Master" onrowposchanged="ds_OnRowPosChanged">
        <ColumnInfo>
          <Column id="MENU_CLASS" size="20" type="STRING"/>
          <Column id="MENU_COST" size="22" type="BIGDECIMAL"/>
          <Column id="MENU_NAME" size="50" type="STRING"/>
          <Column id="PHOTO_PATH_1" size="200" type="STRING"/>
          <Column id="PHOTO_PATH_2" size="200" type="STRING"/>
          <Column id="PHOTO_TITLE_1" size="200" type="STRING"/>
          <Column id="PHOTO_TITLE_2" size="200" type="STRING"/>
          <Column id="PHOTO_URL_1" size="4000" type="STRING"/>
          <Column id="PHOTO_URL_2" size="4000" type="STRING"/>
          <Column id="RECIPE_INFO" size="4000" type="STRING"/>
          <Column id="SINGLE_MENU_CD" size="20" type="STRING"/>
          <Column id="SPHOTO_PATH_1" size="200" type="STRING"/>
          <Column id="SPHOTO_PATH_2" size="200" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_Copy1"/>
      <Dataset id="ds_Copy2"/>
      <Dataset id="ds_in">
        <ColumnInfo>
          <Column id="SINGLE_MENU_CD" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Bind>
      <BindItem id="cbo_S_MENU_CLASS_value" compid="cbo_S_MENU_CLASS" propid="value" datasetid="ds_input" columnid="MENU_CLASS"/>
      <BindItem id="ed_S_MENU_NAME_value" compid="ed_S_MENU_NAME" propid="value" datasetid="ds_input" columnid="MENU_NAME"/>
      <BindItem id="cbo_RECIPE_NAME_value" compid="cbo_RECIPE_NAME" propid="value" datasetid="ds_input" columnid="RECIPE_NAME"/>
      <BindItem id="ed_SINGLE_MENU_CD_value" compid="ed_SINGLE_MENU_CD" propid="value" datasetid="ds_Master" columnid="SINGLE_MENU_CD"/>
      <BindItem id="cbo_MENU_CLASS_value" compid="cbo_MENU_CLASS" propid="value" datasetid="ds_Master" columnid="MENU_CLASS"/>
      <BindItem id="ed_MENU_NAME_value" compid="ed_MENU_NAME" propid="value" datasetid="ds_Master" columnid="MENU_NAME"/>
      <BindItem id="med_MENU_COST_value" compid="med_MENU_COST" propid="value" datasetid="ds_Master" columnid="MENU_COST"/>
      <BindItem id="item5" compid="sta_detail05" propid="text" datasetid="ds_view" columnid="D_1"/>
    </Bind>
    <Script type="xscript4.0"><![CDATA[include "U_lib::lib_conversionCom.xjs";
/*
 ******************************************************************************************
 * 시스템구분   : 메뉴관리/식단관리/개별표준식조회
 * 프로그램명   : FSM00010V.XML
 * 기      능   : 개별표준식단조회
 * 작  성  자   : 노규완
 * 작성  일자   : 2009-05-06
 * 비      고   :
 *		- ds_input				: [input DS] 조회조건 파라미터 DS
 *		- ds_MENU_CLASS			: [코드 DS] 개별식단분류 DS
 *		- ds_RECIPE_List		: [코드 DS] 레시피명 DS
 *		- ds_DISH_INFO			: [코드 DS] 구성요소 DS
 *		- ds_list				: [List DS] 식단리스트 DS
 *		- ds_Master				: [Main DS] 식단 DS
 *		- ds_Detail1			: [Main DS] 레시피 DS
 *		- ds_Detail2			: [Main DS] 자재 DS
 *		- ds_Copy1				: [기타 DS] 레시피 복사용 DS
 *		- ds_Copy2				: [기타 DS] 자재 복사용 DS
 *		- ds_in					: [기타 DS] 신규입력시 식단코드
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
//=========================================================================================
// [ PART 1 ]
// Form에서 Include 할 내용을 정의
//
//=========================================================================================
//@@컨버터에서 주석처리 #include "lib::sc_comon.js"
//@@컨버터에서 주석처리 #include "LIB::lib_comm_0001.js"
//@@컨버터에서 주석처리 #include "lib::tit_comm_0001.js"		// X-Framework Lib
//@@컨버터에서 주석처리 #include "LIB::fm_common.js"			// 사업장팝업용 Lib
//=========================================================================================
// [ PART 2 ]
// Form에서 사용될 전역변수를 선언
//
//=========================================================================================
var serverSaveDir = "FSM_SINGLE_MENU_MST";		// 파일패스
var serverSaveUrl;								// 파일패스URL
//=========================================================================================
// [ PART 3 ]
// Form Loading 시 작업 정의
//
//=========================================================================================
function form_onload(obj:Form, e:LoadEventInfo)
{
	gfn_formOnLoad(obj, false);

	// 업데이트 DS
	v_ds_check = "ds_Master;ds_Detail1;ds_Detail2";	
	// X-Framework : Action 정보 생성 
	fsp_init(this);	
	//공통코드조회
	var v_fil_cond;
	var v_ds = fn_common_code("'FS0028','FS0032'","","","all","Y");
	// 개별식단분류(ds_MENU_CLASS, GROUP_CODE : 'FS0028')
	v_fil_cond = "GROUP_CODE == 'FS0028'";
	v_ds.filter(v_fil_cond);
	CopyF(ds_MENU_CLASS,v_ds.name);	
	// 구성요소(ds_DISH_INFO, GROUP_CODE : 'FS0028')
	v_fil_cond = "GROUP_CODE == 'FS0032'";
	v_ds.filter(v_fil_cond);
	CopyF(ds_DISH_INFO,v_ds.name);
	ds_DISH_INFO.setColumn(0,"CODE_NAME","");	
	// 레시피명 조회
	fsp_clear(this);
    fsp_addSearch(this, "fs/fsc:FSR_RECIPE_CD_REF_S001");
    fsp_callService(this, "", "", "", "ds_RECIPE_List=gds_Csqlout", "", "");    
	// 초기값 셋팅
	serverSaveUrl = tit_getServerDir(serverSaveDir);
	ds_input.setColumn(0,"FILEURL",serverSaveUrl);								// 일자	
	cbo_S_MENU_CLASS.index = 0;
}
function frm_OnKeyDown(obj:Form, e:KeyEventInfo)
{
	gfn_formKeyDown(obj, e); //(obj,e.fromreferenceobject,e.keycode,e.shiftKey,e.ctrlKey,e.altKey,-1,-1);
}
//=========================================================================================
// [ PART 4 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,도움말,form닫기)
//
//=========================================================================================
/*
 ******************************************************************************************
 * 함  수  명   : fn_Search()
 * 기      능   : [조회버튼] 검색조건에 해당하는 정보를 조회
 ******************************************************************************************
 */
function fn_search()
{
	// 조회조건체크
	if (gfn_length(ds_input.getColumn(0,"MENU_CLASS"))==0)
	{
		g_Message("EE", "개별식단분류를 선택하여 주십시오.");
		cbo_S_MENU_CLASS.setFocus();
		return;
	}
	// 초기화
	ds_list.clearData();
	ds_Master.clearData();
	ds_Detail1.clearData();
	ds_Detail2.clearData();
	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	inData			= "ds_input=ds_input";
	outData			= "ds_Master=ds_list";
	callBackFnc		= "fn_afterSearchList";
	fsp_clear(this); 
    fsp_addSearch(this, "fs/fsm:FSM00010E_S001");									// 조회 
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);		// 서비스 호출 
}
function fn_print()
{
}

/*******************************************************************************************
 * 함  수  명   : fn_Excel()
 * 기      능   : [엑셀버튼] 엑셀 시 처리되는 작업
*******************************************************************************************/ 
function fn_Excel()
{
	gfn_exportExcel(grd_Detail, "Sheet1");
}

/*******************************************************************************************
 * 함  수  명   : fn_Close()
 * 기      능   : [닫기버튼] 화면을 닫을때 처리되는 작업
*******************************************************************************************/
function fn_Close()
{
	this.close();
}
/*******************************************************************************************
 * 함  수  명   : fn_Help()
 * 기      능   : [도움말버튼] 도움말
*******************************************************************************************/
function fn_help()
{
}
//=========================================================================================
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
//
//=========================================================================================
/*
 ******************************************************************************************
 * 함  수  명   : fn_SearchSub(nRow)
 * 입      력   : nRow = Master Row
 * 반      환   : 없음
 * 기      능   : 상세내역 조회
 * 작  성  자   : 박지영
 * 작성  일자   : 2007-12-12  
 ******************************************************************************************
 */
function fn_SearchSub(nRow)
{
	// 초기화
	ds_Detail1.clearData();
	ds_Detail2.clearData();
	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	ds_input.setColumn(0,"SINGLE_MENU_CD",ds_Master.getColumn(nRow,"SINGLE_MENU_CD"));
	inData			= "ds_input=ds_input";
	outData			= "ds_Detail1=ds_Detail1 ds_Detail2=ds_Detail2";
	callBackFnc		= "fn_afterSearch";
	fsp_clear(this); 
    fsp_addSearch(this, "fs/fsm:FSM00010E_S002");									// 조회 
    fsp_addSearch(this, "fs/fsm:FSM00010E_S003");									// 조회 
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);		// 서비스 호출 
}
/*******************************************************************************************
 * 함  수  명   : fn_SaveCheck()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 저상시 필수입력 체크
 * 작  성  자   : 박지영
 * 작성  일자   : 2007-12-10  
*******************************************************************************************/
function fn_SaveCheck()
{
	var nFRow,nRow,strValue,btp,strmsg;
	nRow = ds_Master.rowposition;	
	// 필수 입력 사항 확인 
	// 개별식단분류
	nFRow = ds_Master.findRowExpr("gfn_length(gfn_trim(MENU_CLASS))==0");
	if( nFRow !=-1 )
	{
		ds_Master.rowposition = nFRow;
		g_Message("EE", "개별식단분류를 선택해주십시오.");
		cbo_MENU_CLASS.setFocus();
		return;
	}
	// 식단명
	nFRow = ds_Master.findRowExpr("gfn_length(gfn_trim(MENU_NAME))==0");
	if( nFRow !=-1 )
	{
		ds_Master.rowposition = nFRow;
		g_Message("EE", "식단명을 입력해주십시오.");
		ed_MENU_NAME.setFocus();
		return;
	}
	// 비율
	nFRow = ds_Detail2.findRowExpr("toNumber(ITEM_RATE) <= 0");
	if( nFRow !=-1 )
	{
		ds_Detail2.rowposition = nFRow;
		g_Message("EE", "1인량 비율조정을 입력해주십시오.");
		grd_Detail.setFocus();
		grd_Detail.setCellPos(11);
		return;
	}
	// 상세내역체크
	if( ds_Detail2.rowcount <= 0 )
	{
		g_Message("EE", "레시피를 추가해 주십시오.");
		btn_pop6.setFocus();
		return;
	}
    return true;
}
/*******************************************************************************************
 * 함  수  명   : fn_formSetting()
 * 입      력   : 없음
 * 반      환   : 없음
 * 기      능   : 화면버튼셋팅
 * 작  성  자   : 박지영
 * 작성  일자   : 2007-12-10  
*******************************************************************************************/
function fn_formSetting()
{
	var btp;
	if (gfn_length(ds_Master.getColumn(ds_Master.rowposition,"MENU_CLASS") + ds_Master.getColumn(ds_Master.rowposition,"MENU_NAME"))==0 )
	{
		btp = false;
	}
	else
	{
		btp = true;
	}	
	btn_pop5.enable = btp;
	btn_pop6.enable = btp;
	if (ds_Detail1.rowcount==0)
	{
		btp = false;
	}
	else
	{
		btp = true;
	}
	btn_Del_Recipe.enable = btp;
	if (ds_Detail2.rowcount==0)
	{
		btp = false;
	}
	else
	{
		btp = true;
	}
	
	btn_pop1.enable = btp;
	btn_pop2.enable = btp;
	btn_pop3.enable = btp;
	btn_pop4.enable = btp;
		
	btn_pop5.enable = false;        //식단복사
	btn_pop6.enable = false;	    //레시피추가
	btn_Del_Recipe.enable = false;  //레시피삭제
}

/*******************************************************************************************
 * 함  수  명   : fn_afterSearchList()
 * 입      력   : errCode 	= 에러코드
				  errMsg	= 에러메세지
 * 반      환   : 없음
 * 기      능   : 개별 표준 식단 조회 후 실행 함수
 * 작  성  자   : 박지영
 * 작성  일자   : 2007-12-10  
 ******************************************************************************************/
function fn_afterSearchList(errCode, errMsg)
{
	if(errCode!=0)
	{
		g_Message("EE", "서비스 오류:시스템 관리자에게 문의하십시오");
		return;
	}	
	// 식단원가 filter
	if (ds_Master.rowcount > 0)
	{
		var strFilter = "";			// Filter Script
		if (toNumber(med_F_MENU_COST.value)>0)
		{
			strFilter	+= "MENU_COST>=" + toNumber(med_F_MENU_COST.value) + " ";
		}
		if (toNumber(med_T_MENU_COST.value)>0)
		{
			strFilter	+= " MENU_COST<=" + toNumber(med_T_MENU_COST.value);
		}
		strFilter	= gfn_replace(strFilter,"  "," && ");
		ds_Master.filter(strFilter);
	}
	CopyF(ds_list,ds_Master);
	ds_Master.rowposition = -1;
}
/*******************************************************************************************
 * 함  수  명   : fn_afterSearch()
 * 입      력   : errCode 	= 에러코드
				  errMsg	= 에러메세지
 * 반      환   : 없음
 * 기      능   : 사업장 조회 후 실행 함수
 * 작  성  자   : 박지영
 * 작성  일자   : 2007-12-10  
*******************************************************************************************/
function fn_afterSearch(errCode, errMsg)
{
	if(errCode!=0)
	{
		g_Message("EE", "서비스 오류:시스템 관리자에게 문의하십시오");
		return;
	}
	fn_formSetting();
}
//=========================================================================================
// [ PART 6 ]
// component Event 정의 ( User Define function )
// --> component Event의 기요,기능,동작 등 상세내용은 MiPlatform 메뉴얼을 참조하시기 바랍니다.
//=========================================================================================
/******************************************************************************************
 * 함  수  명   : grd_List_OnHeadClick(obj,nCell,nX,nY,nPivotIndex)
 * 기      능   : 그리드헤드 더블클릭시 Sort
 * 작  성  자   : 노규완
 * 작성  일자   : 2009-05-06
*******************************************************************************************/
function grd_List_OnHeadClick(obj:Grid, e:GridClickEventInfo)
{
	if (e.cell == 0)
	{
		gfn_exportExcel(obj, "Sheet1");
	}
	else
	{
		gfn_gridSort(obj, e); //(eval(obj.binddataset), obj, e.cell);
	}
}
/*******************************************************************************************
 * 함  수  명   : grd_list_OnCellClick(obj,nRow,nCell,nX,nY,nPivotIndex)
 * 기      능   : 사진팝업
 * 작  성  자   : 노규완
 * 작성  일자   : 2009-05-06
 ******************************************************************************************/
function grd_list_OnCellClick(obj:Grid, e:GridClickEventInfo)
{
	if (e.cell==6)	// 사진팝업
	{
		if (gfn_length(ds_list.getColumn(e.row,"SPHOTO_PATH_1"))+ gfn_length(ds_list.getColumn(e.row,"SPHOTO_PATH_2"))> 0)
		{
			ds_list.rowposition = e.row;
			gfn_dialog("", "U_FSM::FSM00010P.xfdl","fa_Enable=false fa_ObjDs=ds_list");
		}
	}
}
/*******************************************************************************************
 * 함  수  명   : grd_list_OnCellDblClick(obj,nRow,nCell,nX,nY,nPivotIndex)
 * 기      능   : 상세내역조회
 * 작  성  자   : 노규완
 * 작성  일자   : 2009-05-06
 ******************************************************************************************/
function grd_list_OnCellDblClick(obj:Grid, e:GridClickEventInfo)
{
	var strMsg = "변경된 내역이 있습니다. 저장하시겠습니까?\n(취소하신경우 자료는 초기화됩니다.)";
	var nFRow;
	nFRow = ds_Master.findRow("SINGLE_MENU_CD",ds_list.getColumn(e.row,"SINGLE_MENU_CD"));
	if (nFRow != ds_Master.rowposition)
	{
		if (gfn_dsIsUpdated(ds_Master)==true || gfn_dsIsUpdated(ds_Detail1)==true || gfn_dsIsUpdated(ds_Detail2)==true)
		{
			if (g_Confirm("02",strMsg))
			{
				fn_save();
				return;
			}
		}
	}
	ds_Master.reset();
	ds_Master.rowposition = nFRow;
	fn_SearchSub(nFRow);
}
/*******************************************************************************************
 * 함  수  명   : btn_pop_common_OnClick(obj)
 * 기      능   : 팝업
 * 작  성  자   : 노규완
 * 작성  일자   : 2009-05-06
 *******************************************************************************************/
function btn_pop_common_OnClick(obj:Button, e:ClickEventInfo)
{
	var sgbn = '';
    var sRECIPE = '';
    var sSINGLE_MENU_CD = '';
    var sRECIPE_CD      = '';
    var sITEM_CODE      = '';
	
	nRow = ds_Detail2.rowposition;
	
	switch(obj.name)
	{
		case "btn_pop1" : 		// 레시피정보
			strURL	= "U_FSR::FSR00013V.xfdl";
			sgbn    = '0';
			sRECIPE = ds_Detail2.getColumn(nRow,"RECIPE_CD");			
			strArg	= {gbn:sgbn,RECIPE:sRECIPE};
			break;
		case "btn_pop2" : 		// 자재영양성분
			strURL		    = "U_FSM::FSM00014P.xfdl";
            sSINGLE_MENU_CD = ds_Detail2.getColumn(nRow,"SINGLE_MENU_CD");
            sRECIPE_CD      = ds_Detail2.getColumn(nRow,"RECIPE_CD");
            sTEM_CODE       = ds_Detail2.getColumn(nRow,"ITEM_CODE");   
                     
            trace('sSINGLE_MENU_CD sRECIPE_CD sTEM_CODE => ' + sSINGLE_MENU_CD + ' ' + sRECIPE_CD + ' ' + sTEM_CODE);
                     
			strArg	        = {strSINGLE_MENU_CD:sSINGLE_MENU_CD,strRECIPE_CD:sRECIPE_CD,strITEM_CODE:sTEM_CODE};
			break;
		case "btn_pop3" : 		// 식단영양성분
		
			// 변경여부 확인
			if(gfn_dsIsUpdated(ds_Master)==true || gfn_dsIsUpdated(ds_Detail1)==true || gfn_dsIsUpdated(ds_Detail2)==true)
			{
				g_Message("EE", "저장 후 조회해주세요.");
				return;
			}
			
			strURL		    = "U_FSM::FSM00011P.xfdl";
			sSINGLE_MENU_CD = ds_Detail2.getColumn(nRow,"SINGLE_MENU_CD");
			
			trace('sSINGLE_MENU_CD => ' + sSINGLE_MENU_CD  );
			
			strArg		    = {strSINGLE_MENU_CD:sSINGLE_MENU_CD};
			break;
		case "btn_pop4" : 		// 식단사진정보
			// 변경여부 확인
			if(gfn_dsIsUpdated(ds_Master)==true || gfn_dsIsUpdated(ds_Detail1)==true || gfn_dsIsUpdated(ds_Detail2)==true)
			{
				g_Message("EE", "변경된 데이터가 있습니다.\n저장 후 작업해주세요.");
				return;
			}
			strURL		= "U_FSM::FSM00010P.xfdl";
			break;
	} 

	strReturn = gfn_dialog("", strURL,strArg);
}
/*******************************************************************************************
 * 함  수  명   : btn_pop5_OnClick(obj)
 * 기      능   : 식단복사 팝업
 * 작  성  자   : 노규완
 * 작성  일자   : 2009-05-06
 *******************************************************************************************/
function btn_pop5_OnClick(obj:Button, e:ClickEventInfo)
{
	// 복사될 DS컬럼 복사
	Copy(ds_Copy1,ds_Detail1);
	Copy(ds_Copy2,ds_Detail2);
	var nRow,strArg,btp,strMsg,nCnt;
	nRow = ds_Master.rowposition;	
	strArg	= "strSINGLE_MENU_CD="	+ wrapQuote(ds_Master.getColumn(nRow,"SINGLE_MENU_CD"));
	strArg	+= " strMENU_CLASS="	+ wrapQuote(ds_Master.getColumn(nRow,"MENU_CLASS"));
	strArg	+= " strMENU_CLASS_NM="	+ wrapQuote(cbo_MENU_CLASS.text);
	strArg	+= " strMENU_NAME="		+ wrapQuote(ed_MENU_NAME.value);
	strReturn = gfn_dialog("", "U_FSM::FSM00012P.xfdl",strArg);
	if (strReturn == "ok")
	{
		// 레시피정보추가
		strMsg = fn_RecipeAdd();
		vValue	 = ds_Detail2.getSum("UNIT_COST");
		ds_Master.setColumn(ds_Master.rowposition,"MENU_COST",vValue);
	}
}
/*******************************************************************************************
 * 함  수  명   : btn_pop6_OnClick(obj)
 * 기      능   : 레시피추가 팝업
 * 작  성  자   : 노규완
 * 작성  일자   : 2009-05-06
 *******************************************************************************************/
function btn_pop6_OnClick(obj:Button, e:ClickEventInfo)
{
	// 복사될 DS컬럼 복사
	Copy(ds_Copy1,ds_Detail1);
	Copy(ds_Copy2,ds_Detail2);
	// 개별식단분류에 따라 레시피분류 셋팅
	var nFRow,strArg,strMsg;
	nFRow 	= ds_MENU_CLASS.findRow("CODE",ds_Master.getColumn(ds_Master.rowposition,"MENU_CLASS"));
	strArg	= "strRECIPE_CLASS=" + wrapQuote(ds_MENU_CLASS.getColumn(nFRow,"SET1"));
	gfn_dialog("", "U_FSM::FSM00013P.xfdl",strArg);
}
/*******************************************************************************************
 * 함  수  명   : ds_Detail2_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
 * 기      능   : 값 변경시 셋팅
 * 작  성  자   : 노규완
 * 작성  일자   : 2009-05-06
 *******************************************************************************************/
function ds_Detail2_OnColumnChanged(obj:Dataset, e:DSColChangeEventInfo)
{
	// 1인량 비율조정(%)
	if (e.columnid == "ITEM_RATE")
	{
		var nFRow,nValue,strValue;	
		strValue 	= ds_Detail2.getColumn(e.row,"RECIPE_CD");
		nFRow 		= ds_Detail1.findRow("RECIPE_CD",strValue);		
		// Recipe셋팅
		if (nFRow>=0)
		{
			ds_Detail1.setColumn(nFRow,"ITEM_RATE",e.newvalue);
		}		
		fn_RecipeSetting(e.columnid);		
		// 조정1인량
		vValue	 = Math.round(toNumber(ds_Detail2.getColumn(e.row,"NEED_QTY")) * toNumber(e.newvalue) / 100,2);
		ds_Detail2.setColumn(e.row,"NEED_QTY_RATE",vValue);		
		// 1인당원가
		vValue	 = Math.round(toNumber(ds_Detail2.getColumn(e.row,"ITEM_COST")) * toNumber(e.newvalue) / 100);
		ds_Detail2.setColumn(e.row,"UNIT_COST",vValue);	
		vValue	 = ds_Detail2.getSum("UNIT_COST");
		ds_Master.setColumn(ds_Master.rowposition,"MENU_COST",vValue);
	}	
	// 구성요소
	if (e.columnid == "DISH_INFO")
	{
		var nFRow,strValue;		
		strValue 	= ds_Detail2.getColumn(e.row,"RECIPE_CD");
		nFRow 		= ds_Detail1.findRow("RECIPE_CD",strValue);
		if (nFRow>=0)
		{
			ds_Detail1.setColumn(nFRow,"DISH_INFO",e.newvalue);
		}
		fn_RecipeSetting(e.columnid);
	}	
	// 순서
	if (e.columnid == "RECIPE_SEQ")
	{
		var nFRow,strValue;		
		strValue 	= ds_Detail2.getColumn(e.row,"RECIPE_CD");
		nFRow 		= ds_Detail1.findRow("RECIPE_CD",strValue);		
		if (nFRow>=0)
		{
			ds_Detail1.setColumn(nFRow,"RECIPE_SEQ",e.newvalue);
		}
		fn_RecipeSetting(e.columnid);
	}
}
/*******************************************************************************************
 * 함  수  명   : ds_OnRowPosChanged(obj,nOldRow,nRow)
 * 기      능   : 레시피삭제버튼
 * 작  성  자   : 노규완
 * 작성  일자   : 2009-05-06
 *******************************************************************************************/
function ds_OnRowPosChanged(obj:Dataset, e:DSRowPosChangeEventInfo)
{
	fn_formSetting();
}
/*******************************************************************************************
 * 함  수  명   : cbo_OnKillFocus(obj) /cbo_OnChar(obj,strPreText,nChar,strPostText,LLParam,HLParam)
 * 기      능   : 레시피명 자동완성기능
 * 작  성  자   : 노규완
 * 작성  일자   : 2009-05-06
 *******************************************************************************************/
function cbo_OnKillFocus(obj:Combo, e:KillFocusEventInfo)
{
	var strValue,nFRow,objDs,strDataColumn;
	strValue 		= obj.userdata;
	objDs			= obj.innerdataset;
	strDataColumn	= obj.datacolumn;
	if (gfn_length(strValue)==0) return;
 
 	nFRow = eval(objDs).findRow(strDataColumn,strValue);
	if (nFRow == -1)
	{
		var nRow = eval(objDs).addRow();
		eval(objDs).setColumn(nRow,strDataColumn,strValue);
		obj.value = strValue;
	}
}
function cbo_OnChar(obj:Combo, e:CharEventInfo)
{
	if (e.chartext == 13)
	{
		div_cmnBtn.btn_search.setFocus();
		div_cmnBtn.btn_search.click();
	}
	else
	{
		obj.userdata = e.posttext;
	}
}
/*******************************************************************************************
 * 함  수  명   : grd_list_OnMouseOver(obj,nPosX,nPosY,nRow,nCell,nPivotIndex)
 * 기      능   : 레시피구성
 * 작  성  자   : 노규완
 * 작성  일자   : 2009-05-06
 *******************************************************************************************/
function grd_list_OnMouseOver(obj:Grid, e:GridMouseEventInfo)
{
	var strMsg = "";
	var v_Value;
	// 레시피구성
	if (e.cell == 5)
	{
		strMsg = "** 레시피구성 ** \n  " + gfn_replace(ds_list.getColumn(e.row,"RECIPE_INFO"),", ",", \n  ");
	}
	grd_list.tooltiptext = strMsg;
}
/*******************************************************************************************
 * 함  수  명   : grd_Detail_OnMouseOver(obj,nPosX,nPosY,nRow,nCell,nPivotIndex)
 * 기      능   : 전략자재,금지자내 오버랩
 * 작  성  자   : 노규완
 * 작성  일자   : 2009-05-06
 *******************************************************************************************/
function grd_Detail_OnMouseOver(obj:Grid, e:GridMouseEventInfo)
{
	var strMsg = "";
	var v_Value;
	if (e.cell == 4 || e.cell == 5)
	{
		if (ds_Detail2.getColumn(e.row,"RESTRICT_YN") == "1")	// 금지자재인경우
		{
			strMsg = " - 금지기간 : " + ds_Detail2.getColumn(e.row,"RESTRICT_PERIOD");
			strMsg += " - 금지사유 : " + ds_Detail2.getColumn(e.row,"RESTRICT_REASON");
		}
	}
	grd_Detail.tooltiptext = strMsg;
}]]></Script>
  </Form>
</FDL>
