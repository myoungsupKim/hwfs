<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="..\..\..\default_typedef.xml"/>
  <Form id="GainRateSetMngt" classname="COMP_GUIDE_13" inheritanceid="" position="absolute 0 0 1252 725" titletext="이익율 설정관리" scrollbars="autoboth" onload="form_onload">
    <Layouts>
      <Layout>
        <Static id="Static06" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1237 0 1252 710" anchor="top right"/>
        <Div id="div_cmnBtn" anchor="left top right" taborder="1" url="cmn::CmnBtn.xfdl" text="Div00" scrollbars="none" position="absolute 0 0 1237 30" tabstop="false"/>
        <Static id="Static30" text="w10" class="Guide01_AreaRed" visible="false" position="absolute 456 26 466 710"/>
        <Div id="div_001" taborder="32" text="Div00" position="absolute 0 30 465 725" anchor="left top bottom">
          <Layouts>
            <Layout>
              <Grid id="grd_listStd" taborder="6" binddataset="ds_listStd" scrollbars="autoboth" autoenter="select" useinputpanel="false" cellsizingtype="col" autofittype="none" oncelldblclick="grd_listStd_oncelldblclick" position="absolute 0 137 456 680" anchor="all">
                <Formats>
                  <Format id="default">
                    <Columns>
                      <Column size="36"/>
                      <Column size="95"/>
                      <Column size="103"/>
                      <Column size="70"/>
                      <Column size="172"/>
                      <Column size="40"/>
                      <Column size="57"/>
                      <Column size="229"/>
                      <Column size="61"/>
                    </Columns>
                    <Rows>
                      <Row size="41" band="head"/>
                      <Row size="24"/>
                    </Rows>
                    <Band id="head">
                      <Cell class="head_Excel"/>
                      <Cell col="1" text="팀"/>
                      <Cell col="2" text="CC"/>
                      <Cell col="3" text="업장코드"/>
                      <Cell col="4" text="업장명"/>
                      <Cell col="5" text="설정"/>
                      <Cell col="6" text="고정단가건수" wordwrap="word"/>
                      <Cell col="7" text="비고"/>
                      <Cell col="8" text="CC코드"/>
                    </Band>
                    <Band id="body">
                      <Cell text="bind:NO" expr="currow+1"/>
                      <Cell col="1" displaytype="text" text="bind:tmNm"/>
                      <Cell col="2" displaytype="text" text="bind:ccNm"/>
                      <Cell col="3" displaytype="text" edittype="none" style="align:center middle;" text="bind:stdUpjang" combodataset="ds_tm_grd" combocodecol="tmCd" combodatacol="tmNm"/>
                      <Cell col="4" edittype="none" style="align:left;" text="bind:stdUpjangNm"/>
                      <Cell col="5" displaytype="text" style="align:center middle;font:,9;" text="expr:stdCnt==0?'':'◎'"/>
                      <Cell col="6" displaytype="number" text="bind:fixedCnt"/>
                      <Cell col="7" displaytype="text" edittype="text" text="bind:attr11"/>
                      <Cell col="8" text="bind:stdCc"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
              <Button id="btn_select" taborder="4" text="조회" onclick="fn_searchStd" class="btn_WF_Function" position="absolute 365 108 410 128" anchor="top right"/>
              <Static id="Static13" text="w02" class="Guide01_AreaRed" visible="false" position="absolute 231 110 233 130" anchor="top right"/>
              <Static id="Static12" text="w02" class="Guide01_AreaRed" visible="false" position="absolute 409 108 411 128" anchor="top right"/>
              <Static id="Static36" text="단가업장목록" class="sta_WF_Title01" position="absolute 0 116 275 134" anchor="left top"/>
              <Static id="Static08" class="sta_WFSA_Labelbg" position="absolute 0 0 456 95" anchor="left top right"/>
              <Static id="Static05" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 84 93 94" anchor="left top"/>
              <Static id="Static07" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 63 15 84" anchor="left top"/>
              <Edit id="edt_stdUpjang" taborder="3" imemode="hangul" onkeydown="edt_stdUpjang_onkeydown" position="absolute 102 63 312 84" anchor="left top"/>
              <Static id="Static09" text="업장코드/명" class="sta_WFSA_label" position="absolute 15 63 95 84" anchor="left top"/>
              <Static id="Static10" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 92 64 102 85" anchor="left top"/>
              <Button id="btn_save" taborder="5" text="저장" class="btn_WF_Function" position="absolute 411 108 456 128" anchor="top right" onclick="div_001_btn_save_onclick"/>
              <Static id="Static18" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 0 95 456 108" anchor="left top"/>
              <Static id="Static00" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 93 12 103 33" anchor="left top"/>
              <Static id="Static01" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 1 93 11" anchor="left top"/>
              <Static id="Static02" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 11 15 32" anchor="left top"/>
              <Static id="Static06" text="팀" class="sta_WFSA_label" position="absolute 15 11 95 32" anchor="left top"/>
              <Static id="Static11" text="CC" class="sta_WFSA_label" position="absolute 15 37 95 58" anchor="left top"/>
              <Static id="Static16" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 37 15 58" anchor="left top"/>
              <Static id="Static19" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 93 38 103 59" anchor="left top"/>
              <Static id="Static51" text="W05." visible="false" position="absolute 0 32 538 37" style="background:#ff000055;align:center middle;" anchor="default"/>
              <Static id="Static03" text="W05." visible="false" position="absolute 1 58 539 63" style="background:#ff000055;align:center middle;" anchor="default"/>
              <TmSearchComponent id="comp_tm" titletext="팀 검색용 Component" taborder="0" onkeydown="comp_tm_onkeydown" text="TmSearchComponent00" position="absolute 102 12 312 33" bindDataset="ds_search" bindTmCdColumn="schTm" bindTmNmColumn="schTmNm" qoBuCd="" qoMuCd="" qoUseYn="" eventAfterTrigger="" eventBeforeTrigger="" anchor="default"/>
              <Edit id="edt_ccCd" taborder="1" readonly="true" onkeydown="edt_ccCd_onkeydown" position="absolute 102 37 292 58" anchor="left top"/>
              <Button id="btn_ccCd" taborder="2" class="btn_WF_popSearch" position="absolute 291 37 312 58" anchor="default"/>
              <MuSearchComponent id="comp_mu" titletext="사업부 선택 Component" taborder="7" text="MuSearchComponent00" class="cmb_WF_Essential" visible="false" position="absolute 6 87 108 108" bindDataset="ds_search" bindMuCdColumn="schMu" appendText="NOT" onItemChangedEvent="" anchor="default"/>
              <Button id="Button00" taborder="8" text="Button00" position="absolute 387 73 433 88" onclick="div_001_Button00_onclick" visible="false" anchor="default"/>
            </Layout>
          </Layouts>
        </Div>
        <Static id="Static16" text="h06" class="Guide01_AreaRed" visible="false" position="absolute 0 161 460 167" anchor="top right"/>
        <Static id="Static71" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 710 1252 725" anchor="left bottom"/>
        <Splitter id="Splitter" position="absolute 462 31 469 709" anchor="left top bottom">
          <Formats>
            <Format id="default">
              <SplitterItems id="items">
                <SplitterItem id="item00" position="leftortop" bindtype="resize" offset="0" componentid="div_001"/>
                <SplitterItem id="item01" position="rightorbottom" bindtype="resize" offset="5" componentid="div_002"/>
              </SplitterItems>
            </Format>
          </Formats>
        </Splitter>
        <Div id="div_002" taborder="33" text="Div00" position="absolute 473 31 1244 712" style="background:antiquewhite;" anchor="top right bottom">
          <Layouts>
            <Layout>
              <Static id="Static17" class="sta_WFSA_Labelbg" position="absolute 0 0 770 41" anchor="left top right"/>
              <Static id="Static20" text="h06" class="Guide01_AreaRed" visible="false" position="absolute 1 70 297 76" anchor="top right"/>
              <Static id="Static21" text="h06" class="Guide01_AreaRed" visible="false" position="absolute 475 41 771 47" anchor="top right"/>
              <Static id="Static22" text="w02" class="Guide01_AreaRed" visible="false" position="absolute 669 45 671 65" anchor="top right"/>
              <Static id="Static29" text="h06" class="Guide01_AreaRed" visible="false" position="absolute 560 379 856 385" anchor="top right"/>
              <Static id="Static38" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 0 11 15 32" anchor="left top"/>
              <Static id="Static39" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 1 93 11" anchor="left top"/>
              <Static id="Static40" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 0 31 93 41" anchor="left top"/>
              <Static id="Static41" text="선택업장" class="sta_WFSA_label" position="absolute 17 10 79 31" anchor="left top"/>
              <Static id="Static42" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 81 11 91 32" anchor="left top"/>
              <Static id="Static24" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 451 48 461 69" anchor="left top"/>
              <Edit id="edt_selUpjangNm" taborder="0" tabstop="false" readonly="true" position="absolute 91 10 431 31" anchor="left top"/>
              <Edit id="edt_selUpjang" taborder="1" tabstop="false" readonly="true" position="absolute 435 10 504 31" anchor="left top" style="align:center middle;"/>
              <Tab id="tabMain" anchor="all" taborder="2" canchange="tabMain_canchange" tabindex="0" scrollbars="autoboth" position="absolute 0 52 770 680">
                <Tabpages>
                  <Tabpage id="tabP1" text="이익율 설정" scrollbars="none" dragscrolltype="horz" taborder="0">
                    <Layouts>
                      <Layout>
                        <Grid id="grd_listClass" taborder="10" binddataset="ds_listClass" autoenter="select" useinputpanel="false" selecttype="multirow" cellsizingtype="col" autofittype="none" nodataimage="URL('theme://images/grd_WF_NoDataImg.png')" position="absolute -1 0 766 326" anchor="left top right" autosizingtype="none">
                          <Formats>
                            <Format id="default">
                              <Columns>
                                <Column size="44"/>
                                <Column size="86"/>
                                <Column size="121"/>
                                <Column size="131"/>
                                <Column size="136"/>
                                <Column size="151"/>
                                <Column size="81"/>
                                <Column size="100"/>
                                <Column size="156"/>
                                <Column size="0"/>
                                <Column size="0"/>
                                <Column size="0"/>
                                <Column size="0"/>
                                <Column size="0"/>
                              </Columns>
                              <Rows>
                                <Row size="24" band="head"/>
                                <Row size="20"/>
                              </Rows>
                              <Band id="head">
                                <Cell class="head_Excel"/>
                                <Cell col="1" edittype="none" text="세분류코드"/>
                                <Cell col="2" text="대분류명"/>
                                <Cell col="3" text="중분류명"/>
                                <Cell col="4" text="소분류명"/>
                                <Cell col="5" text="세분류명"/>
                                <Cell col="6" text="판매율"/>
                                <Cell col="7" text="생성자"/>
                                <Cell col="8" text="생성일시"/>
                                <Cell col="9" text="stdUpjang"/>
                                <Cell col="10" text="clsCd1"/>
                                <Cell col="11" text="clsCd2"/>
                                <Cell col="12" text="clsCd3"/>
                                <Cell col="13" text="useYn"/>
                              </Band>
                              <Band id="body">
                                <Cell text="expr:currow+1"/>
                                <Cell col="1" displaytype="text" edittype="none" style="align:center middle;" text="bind:clsCd4"/>
                                <Cell col="2" displaytype="text" edittype="none" style="align:left middle;" text="bind:clsNm1" suppress="1"/>
                                <Cell col="3" displaytype="text" style="align:left middle;" text="bind:clsNm2" suppress="2"/>
                                <Cell col="4" displaytype="number" style="align:left middle;" text="bind:clsNm3" suppress="3"/>
                                <Cell col="5" style="align:left middle;" text="bind:clsNm4"/>
                                <Cell col="6" displaytype="number" edittype="expr:clsCd4 == 'F271011' ? 'none' : 'masknumber'" style="align:right middle;color:blue;color2:blue;" text="bind:saleRate" mask="##0.#" editautoselect="true"/>
                                <Cell col="7" displaytype="text" style="align:center middle;" text="bind:inputUser"/>
                                <Cell col="8" displaytype="text" text="bind:inputDate"/>
                                <Cell col="9" displaytype="text" text="bind:stdUpjang"/>
                                <Cell col="10" displaytype="text" text="bind:clsCd1"/>
                                <Cell col="11" displaytype="text" text="bind:clsCd2"/>
                                <Cell col="12" displaytype="text" text="bind:clsCd3"/>
                                <Cell col="13" displaytype="text" text="bind:useYn"/>
                              </Band>
                            </Format>
                          </Formats>
                        </Grid>
                        <Static id="Static32" text="자재별목록" class="sta_WF_Title01" position="absolute 4 343 279 361" anchor="left top"/>
                        <Static id="Static33" text="h13" class="Guide01_AreaRed" visible="false" position="absolute -2 326 282 339" anchor="left top"/>
                        <Static id="Static34" text="h06" class="Guide01_AreaRed" visible="false" position="absolute -1 355 295 361" anchor="top right"/>
                        <Grid id="grd_listItem" taborder="11" binddataset="ds_listItem" autoenter="select" useinputpanel="false" selecttype="multirow" cellsizingtype="col" autofittype="none" position="absolute 0 361 767 601" anchor="all">
                          <Formats>
                            <Format id="default">
                              <Columns>
                                <Column size="22"/>
                                <Column size="69"/>
                                <Column size="75"/>
                                <Column size="83"/>
                                <Column size="74"/>
                                <Column size="105"/>
                                <Column size="139"/>
                                <Column size="40"/>
                                <Column size="76"/>
                                <Column size="76"/>
                                <Column size="98"/>
                                <Column size="150"/>
                              </Columns>
                              <Rows>
                                <Row size="24" band="head"/>
                                <Row size="24"/>
                              </Rows>
                              <Band id="head">
                                <Cell class="head_Excel"/>
                                <Cell col="1" text="중분류" taborder="undefined"/>
                                <Cell col="2" text="소분류" taborder="undefined"/>
                                <Cell col="3" text="세분류" taborder="undefined"/>
                                <Cell col="4" text="자재코드"/>
                                <Cell col="5" text="자재명"/>
                                <Cell col="6" text="규격"/>
                                <Cell col="7" text="단위"/>
                                <Cell col="8" text="판매율"/>
                                <Cell col="9" text="고정단가"/>
                                <Cell col="10" text="생성자"/>
                                <Cell col="11" text="생성일시"/>
                              </Band>
                              <Band id="body">
                                <Cell style="align:center middle;selectcolor: ;" text="expr:currow+1"/>
                                <Cell col="1" style="align:left middle;selectcolor: ;" text="bind:className2"/>
                                <Cell col="2" style="align:left middle;selectcolor: ;" text="bind:className3"/>
                                <Cell col="3" style="align:left middle;selectcolor: ;" text="bind:className4"/>
                                <Cell col="4" displaytype="normal" edittype="normal" style="align:center middle;background:EXPR(fn_checkDupCode('b', itemCode));background2:EXPR(fn_checkDupCode('b', itemCode));selectbackground:EXPR(fn_checkDupCode('b', itemCode));" text="bind:itemCode"/>
                                <Cell col="5" displaytype="normal" style="align:left middle;background: ;" text="bind:itemName"/>
                                <Cell col="6" style="align:left middle;selectcolor: ;" text="bind:itemSize"/>
                                <Cell col="7" style="align:center middle;selectcolor: ;" text="bind:itemUnit"/>
                                <Cell col="8" displaytype="number" edittype="masknumber" style="align:right middle;color:blue;color2:blue;selectbackground: ;" text="bind:saleRate" mask="#,##0.#" editautoselect="true"/>
                                <Cell col="9" displaytype="number" edittype="masknumber" style="align:right middle;color:blue;color2:blue;selectbackground: ;" text="bind:fixedPrice" mask="#,##0" editautoselect="true"/>
                                <Cell col="10" displaytype="text" style="align:center middle;selectcolor: ;" text="bind:inputUser"/>
                                <Cell col="11" displaytype="text" style="selectcolor: ;" text="bind:inputDate"/>
                              </Band>
                            </Format>
                          </Formats>
                        </Grid>
                        <Static id="Static31" text="w02" class="Guide01_AreaRed" visible="false" position="absolute 666 331 668 351" anchor="top right"/>
                        <Button id="btn_itemSave" taborder="12" text="자재율 저장" onclick="btn_itemSave_onclick" class="btn_WF_Function" position="absolute 668 332 765 352" anchor="top right"/>
                        <Button id="btn_itemUpload" taborder="14" text="불러오기" onclick="btn_itemUpload_onclick" class="btn_WF_Function" position="absolute 601 332 666 352" anchor="top right"/>
                        <Static id="Static62" text="w02" class="Guide01_AreaRed" visible="false" position="absolute 584 333 586 353" anchor="top right"/>
                        <Static id="Static00" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 427 331 437 352" anchor="left top"/>
                        <Button id="btn_itemDel" taborder="15" text="삭제" onclick="btn_itemDel_onclick" class="btn_WF_Function" position="absolute 389 332 434 352" anchor="top right"/>
                        <Static id="Static01" text="w02" class="Guide01_AreaRed" visible="false" position="absolute 372 334 374 354" anchor="top right"/>
                        <Button id="btn_itemAdd" taborder="16" text="추가" onclick="btn_itemAdd_onclick" class="btn_WF_Function" position="absolute 342 332 387 352" anchor="top right"/>
                        <Static id="Static03" text="판매율" class="sta_WFDA_Label03" position="absolute 437 329 599 356" anchor="top right" style="align:left middle;"/>
                        <MaskEdit id="msk_itemRate" taborder="17" value="0" displaynulltext="0" mask="+#,##0.0" maskchar="-" position="absolute 494 332 524 353" anchor="top right" style="align:center middle;" autoselect="true"/>
                        <Edit id="Edit05" taborder="18" value="%" imemode="hangul" ontextchanged="Edit00_ontextchanged" position="absolute 523 332 546 353" anchor="top right" style="align:right middle;"/>
                        <Button id="btn_itemRate" taborder="19" text="적용" onclick="btn_itemRate_onclick" class="btn_WF_Function" position="absolute 550 332 595 352" anchor="top right"/>
                        <Radio id="rdo_selType" taborder="20" columncount="0" rowcount="1" index="0" codecolumn="codecolumn" datacolumn="datacolumn" value="0" onitemchanged="rdo_selType_onitemchanged" position="absolute 101 339 312 360">
                          <Dataset id="innerdataset">
                            <ColumnInfo>
                              <Column id="codecolumn" size="256"/>
                              <Column id="datacolumn" size="256"/>
                            </ColumnInfo>
                            <Rows>
                              <Row>
                                <Col id="codecolumn">0</Col>
                                <Col id="datacolumn">일반자재</Col>
                              </Row>
                              <Row>
                                <Col id="codecolumn">1</Col>
                                <Col id="datacolumn">테마자재</Col>
                              </Row>
                            </Rows>
                          </Dataset>
                        </Radio>
                        <Grid id="grd_listTheme" taborder="21" binddataset="ds_listTheme" autoenter="select" useinputpanel="false" selecttype="multirow" cellsizingtype="col" position="absolute 0 361 767 601" anchor="all" ontextchange="grd_listTheme_ontextchange" oncellclick="grd_listTheme_oncellclick" ontextchanged="grd_listTheme_ontextchanged">
                          <Formats>
                            <Format id="default">
                              <Columns>
                                <Column size="22"/>
                                <Column size="69"/>
                                <Column size="75"/>
                                <Column size="83"/>
                                <Column size="74"/>
                                <Column size="105"/>
                                <Column size="139"/>
                                <Column size="40"/>
                                <Column size="0"/>
                                <Column size="76"/>
                                <Column size="72"/>
                                <Column size="73"/>
                                <Column size="98"/>
                                <Column size="150"/>
                                <Column size="55"/>
                              </Columns>
                              <Rows>
                                <Row size="24" band="head"/>
                                <Row size="24"/>
                              </Rows>
                              <Band id="head">
                                <Cell class="head_Excel"/>
                                <Cell col="1" text="중분류" taborder="undefined"/>
                                <Cell col="2" text="소분류" taborder="undefined"/>
                                <Cell col="3" text="세분류" taborder="undefined"/>
                                <Cell col="4" text="자재코드"/>
                                <Cell col="5" text="자재명"/>
                                <Cell col="6" text="규격"/>
                                <Cell col="7" text="단위"/>
                                <Cell col="8" text="판매율"/>
                                <Cell col="9" text="고정단가"/>
                                <Cell col="10" text="가이드율"/>
                                <Cell col="11" text="가이드단가"/>
                                <Cell col="12" text="생성자"/>
                                <Cell col="13" text="생성일시"/>
                                <Cell col="14" text="일반여부"/>
                              </Band>
                              <Band id="body">
                                <Cell style="align:center middle;selectcolor: ;" text="expr:currow+1"/>
                                <Cell col="1" style="align:left middle;selectcolor: ;" text="bind:className2"/>
                                <Cell col="2" style="align:left middle;selectcolor: ;" text="bind:className3"/>
                                <Cell col="3" style="align:left middle;selectcolor: ;" text="bind:className4"/>
                                <Cell col="4" displaytype="normal" edittype="normal" style="align:center middle;background:EXPR(fn_checkDupCode('b', itemCode));background2:EXPR(fn_checkDupCode('b', itemCode));selectbackground:EXPR(fn_checkDupCode('b', itemCode));" text="bind:itemCode"/>
                                <Cell col="5" displaytype="normal" style="align:left middle;background: ;" text="bind:itemName"/>
                                <Cell col="6" style="align:left middle;selectcolor: ;" text="bind:itemSize"/>
                                <Cell col="7" style="align:center middle;selectcolor: ;" text="bind:itemUnit"/>
                                <Cell col="8" displaytype="number" edittype="masknumber" style="align:right middle;color:blue;color2:blue;selectbackground: ;" text="bind:saleRate" mask="#,##0.#" editautoselect="true"/>
                                <Cell col="9" displaytype="number" edittype="masknumber" style="align:right middle;color:blue;color2:blue;selectbackground: ;" text="bind:fixedPrice" mask="#,##0" editautoselect="true"/>
                                <Cell col="10" displaytype="number" text="bind:guideRate" mask="#,##0"/>
                                <Cell col="11" displaytype="number" text="bind:guidePrice" mask="#,##0"/>
                                <Cell col="12" displaytype="text" style="align:center middle;selectcolor: ;" text="bind:inputUser"/>
                                <Cell col="13" displaytype="text" style="selectcolor: ;" text="bind:inputDate"/>
                                <Cell col="14" text="bind:stdYn"/>
                              </Band>
                            </Format>
                          </Formats>
                        </Grid>
                      </Layout>
                    </Layouts>
                  </Tabpage>
                  <Tabpage id="tabP2" text="이익율 복사" scrollbars="none">
                    <Layouts>
                      <Layout>
                        <Grid id="grd_listStd" taborder="0" binddataset="ds_listCopy" scrollbars="autovert" autoenter="select" useinputpanel="false" cellsizingtype="col" autofittype="col" position="absolute -1 0 767 602" anchor="all">
                          <Formats>
                            <Format id="default">
                              <Columns>
                                <Column size="36"/>
                                <Column size="81"/>
                                <Column size="215"/>
                                <Column size="40"/>
                              </Columns>
                              <Rows>
                                <Row size="24" band="head"/>
                                <Row size="24"/>
                              </Rows>
                              <Band id="head">
                                <Cell class="head_Excel"/>
                                <Cell col="1" text="업장코드"/>
                                <Cell col="2" text="업장명"/>
                                <Cell col="3" text="선택"/>
                              </Band>
                              <Band id="body">
                                <Cell text="bind:NO" expr="currow+1"/>
                                <Cell col="1" displaytype="text" edittype="none" style="align:center middle;" text="bind:stdUpjang" combodataset="ds_tm_grd" combocodecol="tmCd" combodatacol="tmNm"/>
                                <Cell col="2" edittype="none" style="align:left;" text="bind:stdUpjangNm"/>
                                <Cell col="3" displaytype="checkbox" edittype="expr:iif(stdChk == -1, &quot;none&quot; , &quot;checkbox&quot;)" text="bind:stdChk"/>
                              </Band>
                            </Format>
                          </Formats>
                        </Grid>
                      </Layout>
                    </Layouts>
                  </Tabpage>
                </Tabpages>
              </Tab>
              <Static id="Static02" text="판매율 전체적용" class="sta_WFDA_Label03" position="absolute 287 47 503 74" anchor="top right" style="align:left middle;"/>
              <MaskEdit id="msk_clsRate" taborder="3" value="0" displaynulltext="0" mask="+#,##0.0" maskchar="-" position="absolute 396 50 426 71" anchor="top right" style="align:center middle;" autoselect="true"/>
              <Edit id="Edit03" taborder="5" value="%" imemode="hangul" ontextchanged="Edit00_ontextchanged" position="absolute 425 50 448 71" anchor="top right" style="align:right middle;"/>
              <Button id="btn_clsDiv" taborder="6" text="분류별 적용 ▼" class="btn_WF_Function" position="absolute 505 50 602 70" anchor="top right" onclick="div_002_btn_clsDiv_onclick"/>
              <Button id="btn_clsUpload" taborder="7" text="불러오기" onclick="btn_clsUpload_onclick" class="btn_WF_Function" position="absolute 604 50 669 70" anchor="top right"/>
              <Button id="btn_clsSave" taborder="8" text="분류율 저장" onclick="btn_clsSave_onclick" class="btn_WF_Function" position="absolute 671 50 768 70" anchor="top right"/>
              <Button id="btn_Copy" taborder="9" text="이익율 복사" onclick="btn_Copy_onclick" class="btn_WF_Function" visible="false" position="absolute 671 50 768 70" anchor="top right"/>
              <Combo id="cbo_class" taborder="10" innerdataset="@ds_class" codecolumn="classCode" datacolumn="className" position="absolute 582 14 748 35" anchor="top right" visible="false"/>
              <Button id="btn_clsRateAll" taborder="4" text="적용" class="btn_WF_Function" position="absolute 452 50 497 70" anchor="top right" onclick="div_002_btn_clsRateAll_onclick"/>
              <Static id="Static00" text="w02" class="Guide01_AreaRed" visible="false" position="absolute 602 49 604 69" anchor="top right"/>
            </Layout>
          </Layouts>
        </Div>
        <Div id="div_margin" taborder="34" style="background:#f0f5ffff;border:1 solid #808080ff ;" visible="false" position="absolute 1376 133 1601 370" scrollbars="none">
          <Layouts>
            <Layout>
              <Static id="Static11" text="w10" visible="false" position="absolute 0 118 10 139" style="background:#f97878ff;" anchor="default"/>
              <Static id="Static09" text="w10" visible="false" position="absolute 214 27 224 167" style="background:#f97878ff;" anchor="default"/>
              <Static id="Static24" text=" ◎ 분류별 판매율적용" class="sta_WF_CalWeek" position="absolute 0 0 224 28" anchor="top right" style="background:khaki;border:1 solid silver ;color:black;align:left middle;"/>
              <Grid id="grd_class" taborder="1" binddataset="ds_class" scrollbars="autovert" autoenter="select" useinputpanel="false" cellsizingtype="col" position="absolute 10 33 214 230" anchor="left top bottom">
                <Formats>
                  <Format id="default">
                    <Columns>
                      <Column size="146"/>
                      <Column size="68"/>
                    </Columns>
                    <Rows>
                      <Row size="26" band="head"/>
                      <Row size="24"/>
                    </Rows>
                    <Band id="head">
                      <Cell text="분류"/>
                      <Cell col="1" class="grd_WF_Essential" text="판매율"/>
                    </Band>
                    <Band id="body">
                      <Cell displaytype="text" text="bind:className"/>
                      <Cell col="1" displaytype="number" edittype="masknumber" style="align:right middle;" text="bind:saleRate" mask="#,##0.0" editautoselect="true"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
              <Button id="btn_clsRate2" taborder="2" text="적용" class="btn_WF_Function" position="absolute 167 4 212 24" anchor="top right" onclick="div_margin_btn_clsRate2_onclick"/>
            </Layout>
          </Layouts>
        </Div>
      </Layout>
    </Layouts>
    <Bind>
      <BindItem id="item0" compid="div_001.edt_stdUpjang" propid="value" datasetid="ds_search" columnid="schStdUpjang"/>
      <BindItem id="item5" compid="div_001.edt_ccCd" propid="value" datasetid="ds_search" columnid="schCcNm"/>
    </Bind>
    <Objects>
      <Dataset id="ds_listClass" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="rowNum" type="STRING" size="256"/>
          <Column id="clsCd4" type="STRING" size="256"/>
          <Column id="clsNm1" type="STRING" size="256"/>
          <Column id="clsNm2" type="STRING" size="256"/>
          <Column id="clsNm3" type="STRING" size="256"/>
          <Column id="clsNm4" type="STRING" size="256"/>
          <Column id="saleRate" type="STRING" size="256"/>
          <Column id="inputUser" type="STRING" size="256"/>
          <Column id="inputDate" type="STRING" size="256"/>
          <Column id="stdUpjang" type="STRING" size="256"/>
          <Column id="clsCd1" type="STRING" size="256"/>
          <Column id="clsCd2" type="STRING" size="256"/>
          <Column id="clsCd3" type="STRING" size="256"/>
          <Column id="useYn" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_listItem" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="rowNum" type="STRING" size="256"/>
          <Column id="className2" type="STRING" size="256"/>
          <Column id="className3" type="STRING" size="256"/>
          <Column id="className4" type="STRING" size="256"/>
          <Column id="itemCode" type="STRING" size="256"/>
          <Column id="itemName" type="STRING" size="256"/>
          <Column id="itemSize" type="STRING" size="256"/>
          <Column id="itemUnit" type="STRING" size="256"/>
          <Column id="saleRate" type="STRING" size="256"/>
          <Column id="fixedPrice" type="STRING" size="256"/>
          <Column id="guidePrice" type="STRING" size="256"/>
          <Column id="inputUser" type="STRING" size="256"/>
          <Column id="inputDate" type="STRING" size="256"/>
          <Column id="stdUpjang" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_search" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="schMu" type="STRING" size="256"/>
          <Column id="schTm" type="STRING" size="256"/>
          <Column id="schTmNm" type="STRING" size="256"/>
          <Column id="schCc" type="STRING" size="256"/>
          <Column id="schCcNm" type="STRING" size="256"/>
          <Column id="schStdUpjang" type="STRING" size="256"/>
          <Column id="schGainYn" type="STRING" size="256"/>
          <Column id="partSalesSabun" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_searchRow" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="selStdUpjang" type="STRING" size="256"/>
          <Column id="schClassType" type="STRING" size="256"/>
          <Column id="schCc" type="STRING" size="256"/>
          <Column id="schCenter" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_listStd" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="tmNm" type="STRING" size="256"/>
          <Column id="ccNm" type="STRING" size="256"/>
          <Column id="stdUpjang" type="STRING" size="256"/>
          <Column id="stdUpjangNm" type="STRING" size="256"/>
          <Column id="stdCnt" type="STRING" size="256"/>
          <Column id="fixedCnt" type="STRING" size="256"/>
          <Column id="stdChk" type="STRING" size="256"/>
          <Column id="attr11" type="STRING" size="256"/>
          <Column id="stdCc" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_deleteItem" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="false" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="itemCode" type="STRING" size="256"/>
          <Column id="stdUpjang" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_listClassValid" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="rowNum" type="STRING" size="256"/>
          <Column id="clsCd4" type="STRING" size="256"/>
          <Column id="clsNm1" type="STRING" size="256"/>
          <Column id="clsNm2" type="STRING" size="256"/>
          <Column id="clsNm3" type="STRING" size="256"/>
          <Column id="clsNm4" type="STRING" size="256"/>
          <Column id="saleRate" type="STRING" size="256"/>
          <Column id="stdUpjang" type="STRING" size="256"/>
          <Column id="clsCd1" type="STRING" size="256"/>
          <Column id="clsCd2" type="STRING" size="256"/>
          <Column id="clsCd3" type="STRING" size="256"/>
          <Column id="useYn" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="clsCd4">title:소분류,required:true</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_listItemValid" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="rowNum" type="STRING" size="256"/>
          <Column id="className2" type="STRING" size="256"/>
          <Column id="className3" type="STRING" size="256"/>
          <Column id="className4" type="STRING" size="256"/>
          <Column id="itemCode" type="STRING" size="256"/>
          <Column id="itemName" type="STRING" size="256"/>
          <Column id="itemSize" type="STRING" size="256"/>
          <Column id="itemUnit" type="STRING" size="256"/>
          <Column id="saleRate" type="STRING" size="256"/>
          <Column id="fixedPrice" type="STRING" size="256"/>
          <Column id="stdUpjang" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="itemCode">title:자재코드,required:true</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_listCopy" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="stdUpjang" type="STRING" size="256"/>
          <Column id="stdUpjangNm" type="STRING" size="256"/>
          <Column id="stdCnt" type="STRING" size="256"/>
          <Column id="stdChk" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_class" preload="true" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep">
        <ColumnInfo>
          <Column id="classCode" type="STRING" size="256"/>
          <Column id="className" type="STRING" size="256"/>
          <Column id="saleRate" type="STRING" size="256"/>
          <Column id="simuGubun" type="STRING" size="256"/>
          <Column id="chk" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_saveItem" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="rowNum" type="STRING" size="256"/>
          <Column id="className2" type="STRING" size="256"/>
          <Column id="className3" type="STRING" size="256"/>
          <Column id="className4" type="STRING" size="256"/>
          <Column id="itemCode" type="STRING" size="256"/>
          <Column id="itemName" type="STRING" size="256"/>
          <Column id="itemSize" type="STRING" size="256"/>
          <Column id="itemUnit" type="STRING" size="256"/>
          <Column id="saleRate" type="STRING" size="256"/>
          <Column id="fixedPrice" type="STRING" size="256"/>
          <Column id="inputUser" type="STRING" size="256"/>
          <Column id="inputDate" type="STRING" size="256"/>
          <Column id="stdUpjang" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_listTheme" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="rowNum" type="STRING" size="256"/>
          <Column id="className2" type="STRING" size="256"/>
          <Column id="className3" type="STRING" size="256"/>
          <Column id="className4" type="STRING" size="256"/>
          <Column id="itemCode" type="STRING" size="256"/>
          <Column id="itemName" type="STRING" size="256"/>
          <Column id="itemSize" type="STRING" size="256"/>
          <Column id="itemUnit" type="STRING" size="256"/>
          <Column id="saleRate" type="STRING" size="256"/>
          <Column id="fixedPrice" type="STRING" size="256"/>
          <Column id="guideRate" type="STRING" size="256"/>
          <Column id="guidePrice" type="STRING" size="256"/>
          <Column id="inputUser" type="STRING" size="256"/>
          <Column id="inputDate" type="STRING" size="256"/>
          <Column id="stdUpjang" type="STRING" size="256"/>
          <Column id="stdYn" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_saveTheme" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" cancolumnchange="ds_saveTheme_cancolumnchange">
        <ColumnInfo>
          <Column id="rowNum" type="STRING" size="256"/>
          <Column id="className2" type="STRING" size="256"/>
          <Column id="className3" type="STRING" size="256"/>
          <Column id="className4" type="STRING" size="256"/>
          <Column id="itemCode" type="STRING" size="256"/>
          <Column id="itemName" type="STRING" size="256"/>
          <Column id="itemSize" type="STRING" size="256"/>
          <Column id="itemUnit" type="STRING" size="256"/>
          <Column id="saleRate" type="STRING" size="256"/>
          <Column id="fixedPrice" type="STRING" size="256"/>
          <Column id="guideRate" type="STRING" size="256"/>
          <Column id="guidePrice" type="STRING" size="256"/>
          <Column id="inputUser" type="STRING" size="256"/>
          <Column id="inputDate" type="STRING" size="256"/>
          <Column id="stdUpjang" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_listThemeValid" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="rowNum" type="STRING" size="256"/>
          <Column id="className2" type="STRING" size="256"/>
          <Column id="className3" type="STRING" size="256"/>
          <Column id="className4" type="STRING" size="256"/>
          <Column id="itemCode" type="STRING" size="256"/>
          <Column id="itemName" type="STRING" size="256"/>
          <Column id="itemSize" type="STRING" size="256"/>
          <Column id="itemUnit" type="STRING" size="256"/>
          <Column id="saleRate" type="STRING" size="256"/>
          <Column id="fixedPrice" type="STRING" size="256"/>
          <Column id="stdUpjang" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="itemCode">title:자재코드,required:true</Col>
          </Row>
        </Rows>
      </Dataset>
    </Objects>
    <Script type="xscript4.0"><![CDATA[/*
  화 면 명 : GainRateSetMngt
  파 일 명 : GainRateSetMngt.xfdl
  기    능 : 식재영업 / 기준관리 / 단가관리 / 이익율 설정관리
              (매입가/물류비/추가/전략/관리)

    수정일    수정자                  수정내용
  ----------   -------  --------------------------------------------------
  2015.03.10   최성연   최초 생성
  2015.04.13   최성연   화면UI 변경(팀, 판매그룹 삭제)
  2015.05.12   최성연   화면UI 변경(AS_IS 방식으로 재작성)	 
  
  1) 추가 반영해야될 사항 
  
  2) 화면 상단 공통 버튼 
  - 닫기, 도움말 버튼만 활성화 함
*/

/************************************************************************************************
 * 공통 라이브러리 INCLUDE 영역 (필수)
************************************************************************************************/
include "lib::lib_com.xjs";
include "lib::lib_prototype.xjs";

/************************************************************************************************
 * FORM 변수 선언 영역 (필수)
************************************************************************************************/
var fv_processCnt = 0;			//처리건수
var fv_objColInfo;				//데이터셋 컬럼정보
var fv_objColInfo1;				//데이터셋 컬럼정보
var fv_sToday = gfn_today();
var fv_grdFormat = "";			//그리드포맷
var fv_excelFlag2 = false;		//엑셀업로드 저장 여부 CHECK
var fv_excelFlag3 = false;		//엑셀업로드 저장 여부 CHECK



/************************************************************************************************
 * FORM EVENT 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : Form Load (필수)
 *---------------------------------------------------------------------------------------------*/
function form_onload(obj:Form, e:LoadEventInfo)
{	
	// Form Load 시 공통 기능 처리(obj:Form, bCreateEvent:이벤트 생성 여부)
	gfn_formOnLoad(this);
	
	// 초기값 셋팅
	fn_init();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 초기값 셋팅 
 *---------------------------------------------------------------------------------------------*/
function fn_init()
{
	// 업데이트여부를 체크할 DataSet, 여러개 있을 경우 ;로 구분
	v_ds_check = "ds_listClass;ds_listItem";
	
	//조회조건을 초기화한다.
	var nRow= ds_search.addRow();
	ds_search.setColumn(nRow, "schStdUpjang", "");				// 단가기준업장
	ds_search.setColumn(nRow, "schGainYn", "Y");				// 이익율여부 표시

	//div_001.comp_mu.setMuCode('2004')
	// 팀 초기화
	div_001.comp_tm.applyAuthLevel(div_001.comp_mu);
	
	// 자재별목록 초기화
	div_002.tabMain.tabP1.grd_listItem.visible = true;
	div_002.tabMain.tabP1.grd_listTheme.visible = false;
		
	SCPopup.bind(this, "CcCode", "div_001.edt_ccCd", "div_001.btn_ccCd", null, {muCd:"", tmCd:""}, {before:"fn_ccBeforeEvent", after:"fn_ccAfterEvent"});

	var nRow= ds_searchRow.addRow();
	ds_searchRow.setColumn(nRow, "selStdUpjang", "");			// 선택업장
	ds_searchRow.setColumn(nRow, "schCc", "");			// CcCode
	fn_searchClassType();
	
	div_002.tabMain.tabP1.grd_listItem.onheadclick.addHandler(function (obj, e) { 
																var ds = this.objects[obj.binddataset];
																if (ds.rowcount == 0 ) {
																	obj.enableredraw = false;
																	//ds.enableevent = false;
																	var nRow = ds.addRow();
																	gfn_exportExcel(obj);
																	ds.deleteRow(nRow);
																	//ds.enableevent = true;
																	obj.enableredraw = true;
																}
															} );
}
/*----------------------------------------------------------------------------------------------
 * 설명      : 화면 닫기 전 변경 유무 체크 (필수-Frame에서 창 닫힐때 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_close()
{	
//	// v_ds_check 미사용시 변경사항 체크(입력 프로그램일때 변경되는 Dataset 전체 기술)
// 	if (gfn_dsIsUpdated(ds_list) == true) 
// 	{
// 		// 변경된 데이터가 있습니다. 현재 화면을 닫겠습니까?
//         if (!gfn_confirm("confirm.before.movepage")) return false;
//     }
//     
//	// 조회프로그램에도 Return true; 기술해 주세요!
// 	return true;

	// v_ds_check 사용시 변경사항 체크
	if(gfn_length(v_ds_check) == 0) 
	{	
		// v_ds_check 설정기준 변경사항 체크
		if (gfn_isDataChange() == true) 
		{		
			// 변경된 데이터가 있습니다. 현재 화면을 닫겠습니까?
			if (!gfn_confirm("confirm.before.movepage")) return false;
		}
	}
    
	// 조회프로그램에도 Return true; 기술해 주세요!
	return true;
}


/************************************************************************************************
 * 공통기능 FUNCTION 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 조회 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_search()
{
	fn_searchStd();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 신규 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_insert()
{	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 삭제 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_delete()
{
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 저장 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_save()
{
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 출력 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_print()
{
	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 도움말 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_help()
{
	
}

/************************************************************************************************
 * TRANSACTION 및 CallBack 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 트랜잭션 콜백 함수 (필수)
 *---------------------------------------------------------------------------------------------*/
function fn_callBack(strSvcID, nErrorCode, strErrorMsg)
{
	// 에러시 gfn_callBack에서 메시지 제공, 화면별 특정 에러 발생시에만 사용하세요.
	if (nErrorCode < 0) 
	{
		return;
	}
	
    switch(strSvcID)
    {
            
		// 기준업장목록 조회
        case "searchStd" :
            if (ds_listStd.getRowCount() == 0) {
				//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
				gfn_loadDatasetInfo (ds_listStd, fv_objColInfo);
            }else{
				ds_listCopy.copyData(ds_listStd);
            }
            
            //-----이익율 설정 및 자재별 목록 재조회 시작
            
            // 조건 관련 DataSet 초기화
			ds_searchRow.clearData();
			// 선택한 팀, 판매그릅코드를 조건 Dataset에 대입
			var iIdx = ds_searchRow.addRow();
			ds_searchRow.setColumn(iIdx, "selStdUpjang", ds_listStd.getColumn(ds_listStd.rowposition, "stdUpjang"));	// 기준업장 선택
			ds_searchRow.setColumn(iIdx, "schCc", ds_listStd.getColumn(ds_listStd.rowposition, "stdCc"));			// CcCode
			
			// 조회된 업장정보 가 없을 경우
			var nRowCnt = ds_listStd.getRowCount();	// DataSet Count

			// 분류목록 여부 CHECK
			if(nRowCnt < 1) 
			{
				gfn_alert("msg.err.grid.noselect", "선택한 row");	// 선택된 항목이 없습니다.
				break;
			}
			
			// 선택한 업장정보 표시
			div_002.edt_selUpjangNm.value =  "(" + ds_listStd.getColumn(ds_listStd.rowposition, "stdUpjang") + ")" + ds_listStd.getColumn(ds_listStd.rowposition, "stdUpjangNm");
			div_002.edt_selUpjang.value =  ds_listStd.getColumn(ds_listStd.rowposition, "stdUpjang");
			
			// 분류율 초기화 : 전체
			div_002.msk_clsRate.value = 0;
			div_002.tabMain.tabP1.msk_itemRate.value = 0;

			// 분류율 초기화 : 선택
			for (var i = 0 ; i < ds_class.getRowCount() ; i++)
			{
				ds_class.setColumn(i, "saleRate", "0");	
			}
	
			// 분류별 조회
			fn_searchClass();
			
			// 자재별 조회
			fn_searchItem();
			
			// 자재별 조회 테마자재
			fn_searchTheme();
			
			fn_tabCopy();
			
			//-------이익율 설정 및 자재별 목록 재조회 끝
			
            break;
        
		// 분류별목록  조회
        case "searchClass" :
            //trace(ds_listClass.saveXML());
            if (ds_listClass.getRowCount() == 0) {
				//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
				gfn_loadDatasetInfo (ds_listClass, fv_objColInfo);
            }
			fv_excelFlag2 = false;			
            break;
        
            // 분류별목록  조회
        case "searchClassType" :
            //trace(ds_listClass.saveXML());
            //var nRow = ds_class.insertRow(0);
            //ds_class.setColumn(nRow,"className" , "전체");
            //ds_class.setColumn(nRow,"classCode" , "");
            //div_002.cbo_class.index = 0;
            break;

        // 저장
        case "saveClass" :
			//trace("처리건수 : " + fv_processCnt);
			gfn_alert("msg.save.success");	// 저장 되었습니다.
			fn_searchClass();				// 저장 후 재조회
            break;    


        // 판매그룹 저장
        case "saveGroup" :
			//trace("처리건수 : " + fv_processCnt);
			gfn_alert("msg.save.success");	// 저장 되었습니다.
            //fn_searchInit();				
            fn_searchGroup();	// 재조회
            break;   

        // 판매그룹 삭제
        case "deleteGroup" :
			//trace("처리건수 : " + fv_processCnt);
			gfn_alert("msg.delete.success");	// 삭제 되었습니다.
            //fn_searchInit();				
            fn_searchGroup();	// 재조회
            break;   
            


		// 자재별목록  조회
        case "searchItem" :
            //trace(ds_listItem.saveXML());
            if (ds_listItem.getRowCount() == 0) {
				//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
				gfn_loadDatasetInfo (ds_listItem, fv_objColInfo1);
            }
			fv_excelFlag3 = false;			
            break;
            


		// 자재별목록  조회
        case "searchTheme" :
            //trace(ds_listItem.saveXML());
            if (ds_listTheme.getRowCount() == 0) {
				//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
				gfn_loadDatasetInfo (ds_listTheme, fv_objColInfo1);
            }
            
			// 조회(신규라인) 후에 Rowtype 속성 변경
			if (ds_listTheme.getRowCount() > 0) { 
				ds_listTheme.updatecontrol = false;
				for(var i=0; i<ds_listItem.rowcount; i++)
				{	
					ds_listTheme.setRowType(i, Dataset.ROWTYPE_INSERT);
				}
				ds_listTheme.updatecontrol = true; 
			} 		
            break;

        // 저장 : 자재별, 전체기준으로 삭제 후 처리
        case "saveItem" :
			//trace("처리건수 : " + fv_processCnt);
			gfn_alert("msg.save.success");	// 저장 되었습니다.
			fn_searchItem();				// 저장 후 재조회
			fn_searchTheme();				// 저장 후 재조회 테마자재
            break;    
            
        // 저장 : 자재별, 변경Dataset 기준으로 처리
        case "saveTheme" :
			//trace("처리건수 : " + fv_processCnt);
			gfn_alert("msg.save.success");	// 저장 되었습니다.
			fn_searchItem();				// 저장 후 재조회
			fn_searchTheme();				// 저장 후 재조회 테마자재
            break;    
            
        // 삭제 : 자재별
        case "deleteItem" :
			//trace("처리건수 : " + fv_processCnt);
			gfn_alert("msg.delete.success");// 삭제 되었습니다.
			fn_searchItem();				// 삭제 후 재조회
			fn_searchTheme();				// 저장 후 재조회 테마자재
            break;    
		// 삭제 : 이익율 복사
        case "rateCopy" :
			//trace("처리건수 : " + fv_processCnt);
			gfn_alert("msg.save.success");// 저장 되었습니다.
			
			fn_search();			  // 삭제 후 재조회
			div_002.tabMain.tabindex = 0;
            break;                

		// 단가계약 업장 비고 저장
		case "saveAttr":
			//trace("처리건수 : " + fv_processCnt);
			gfn_alert("msg.save.success");// 저장 되었습니다.
			fn_searchStd();				// 저장 후 재조회
            break;    
    
    }
}


/************************************************************************************************
 * 사용자 FUNCTION 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : CC 조회 이벤트 before, after
 *---------------------------------------------------------------------------------------------*/
function fn_ccBeforeEvent(p)
{
	p.option.muCd = ds_search.getColumn(0, "schMu");
	p.option.tmCd = ds_search.getColumn(0, "schTm");
	return true;
}

function fn_ccAfterEvent(p)
{
	ds_search.setColumn(0, "schCc", div_001.edt_ccCd.userdata);
	ds_search.setColumn(0, "schCcNm", div_001.edt_ccCd.value);
	return true;
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 분류정보 조회
 *---------------------------------------------------------------------------------------------*/
function fn_searchClassType()
{
    var strSvcID    = "searchClassType";
    var strURL      = "fm/fms/estPaperWrite/selectClass.xdo";
    var strInDs     = "";
    var strOutDs    = "ds_class=ds_class";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}
/*----------------------------------------------------------------------------------------------
 * 설명      : 대상업장 조회
 *---------------------------------------------------------------------------------------------*/
function fn_searchStd()
{	
    // Grid sort 표시 초기화(필수)
    gfn_clearSortMark(div_001.grd_listStd);

   	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
	fv_objColInfo = gfn_getDatasetInfo (ds_listStd);
	
	//로그인한 사용자가 프레임타입6을쓰면(영업사원) 조회조건에 영업사원 조건 만듬
	if(gds_userInfo.getColumn(0,"introPage") == "IntroFrameType06.xfdl")
	{
		ds_search.setColumn(0,"partSalesSabun",gds_userInfo.getColumn(0,"sabun"));
	}
    
    ds_listItem.clearData();
    ds_listTheme.clearData();
    ds_listClass.clearData();
    var strSvcID    = "searchStd";
    var strURL      = "fm/fms/gainRateSetMngt/selectStd.xdo";
    var strInDs     = "ds_search=ds_search:A";
    var strOutDs    = "ds_listStd=ds_listStd";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}




/*----------------------------------------------------------------------------------------------
 * 설명      : 분류별목록, 자재별목록 조회
 * 조회 시 분류별 목록 및 자재별 목록 Ds Clear
 *---------------------------------------------------------------------------------------------*/
function fn_searchClass()
{
// 	if(ds_listStd.rowposition == -1) 
// 	{
// 		gfn_alert("msg.noselect", "단가기준업장");	// 기준업장을 선택해 주십시오.
// 		return;
// 	}

    // Grid sort 표시 초기화(필수)
    gfn_clearSortMark(div_002.tabMain.tabP1.grd_listClass);

   	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
	fv_objColInfo = gfn_getDatasetInfo (ds_listClass);

    var strSvcID    = "searchClass";
    var strURL      = "fm/fms/gainRateSetMngt/selectClass.xdo";
    var strInDs     = "ds_searchRow=ds_searchRow:A";
    var strOutDs    = "ds_listClass=ds_listClass";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 자재별목록 조회
 * 조회 시 자재별 목록 Ds SET
 *---------------------------------------------------------------------------------------------*/
function fn_searchItem()
{
    // Grid sort 표시 초기화(필수)
    gfn_clearSortMark(div_002.tabMain.tabP1.grd_listItem);

   	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장  
	fv_objColInfo1 = gfn_getDatasetInfo (ds_listItem);

    var strSvcID    = "searchItem";
    var strURL      = "fm/fms/gainRateSetMngt/selectItem.xdo";
    var strInDs     = "ds_searchRow=ds_searchRow:A";
    var strOutDs    = "ds_listItem=ds_listItem";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 자재별목록 조회 - 테마자재
 * 조회 시 자재별 목록 Ds SET
 *---------------------------------------------------------------------------------------------*/
function fn_searchTheme() 
{
    // Grid sort 표시 초기화(필수)
    gfn_clearSortMark(div_002.tabMain.tabP1.grd_listTheme);

   	//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장  
	fv_objColInfo1 = gfn_getDatasetInfo (ds_listTheme);
	
	//var nRowCnt1 = ds_searchRow.getRowCount();	// 조건 DataSet Count
	//gfn_alert(nRowCnt1) ;
    //gfn_alert(ds_searchRow.getColumn(0, "schCenter")) ;

    var strSvcID    = "searchTheme";
    var strURL      = "fm/fms/gainRateSetMngt/selectTheme.xdo";
    var strInDs     = "ds_searchRow=ds_searchRow:A";
    var strOutDs    = "ds_listTheme=ds_listTheme";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 분류별 목록의 분류율 정보 저장 
 * 저장 시 변경된 Dataset 이 아닌 전체를 기준으로 저장함
 *---------------------------------------------------------------------------------------------*/
function fn_saveClass()
{
	var nRowCnt = ds_listClass.getRowCount();	// DataSet Count
	var nRowCnt1 = ds_searchRow.getRowCount();	// 조건 DataSet Count
	
	// 저장할 자료 여부 CHECK 
	if(nRowCnt == 0) 
	{
		gfn_alert("msg.save.nodata", "저장할 데이터");	// 저장할 데이터가 없습니다.
		return;
	}

	// 선택한 단가업장 자료여부 CHECK
	if(nRowCnt1 == 0) 
	{
		gfn_alert("msg.noselect", "단가업장");	// 단가업장을 선택해 주십시요.
		return;
	}


	if (fv_excelFlag2 == false) {
		// 변경내역 여부 CHECK : 엑셀 업로드 시에는 변경내역 CHECK X
		// 0인 이익율도 저장함 : 2015-12-31, 김진희 PI 요청
// 		if (gfn_dsIsUpdated(ds_listClass) == false) 
// 		{
// 			gfn_alert("msg.save.nochange");	// 변경된 내역이 없습니다.
// 			return;
// 		}
	}


	// 저장시 Validation Check : 소분류코드
	if (gfn_validCheck(ds_listClass, ds_listClassValid, true) == false) return;


	// 저장시 중복 CHECK
	if (!fn_saveClassChk())
	{
		return;
	}	

	var iCnt = 0;
	
	// 판매율 0인 자료 CEHCK
	for (var i = 0 ; i < nRowCnt ; i++)
	{
		if (ds_listClass.getColumn(i, "saleRate") <> "0")
		{
			iCnt++;
		}
	}

	// 저장할 자료 여부 CHECK : 0인 자료만 존재 시 오류메시지 표시
	// 0인 자료도 저장할 수 있게 처리, 2015-12-31, 김진희 PI 요청
// 	if(iCnt == 0) 
// 	{
// 		gfn_alert("msg.save.nodata", "저장할 데이터");	// 저장할 데이터가 없습니다.
// 		return;
// 	}

	var sMsg = "소분류에 대한 판매율을 저장합니다.\n계속 진행 하시겠습니까?";
	if (!gfn_confirm(sMsg, "", "C")) return;

	// 저장 시 조건(KEY)을 ds_listClass의 KEY 값으로 복사
	var nRow= ds_searchRow.rowposition;
	//trace(ds_searchRow.getColumn(nRow, "selStdUpjang"));

	for (var i = 0 ; i < nRowCnt ; i++)
	{
		ds_listClass.setColumn(i, "stdUpjang", ds_searchRow.getColumn(nRow, "selStdUpjang"));		
	}
	
    var strSvcID    = "saveClass";
    var strURL      = "fm/fms/gainRateSetMngt/saveClass.xdo";
	var strInDs     = "ds_listClass=ds_listClass:A";
    var strOutDs    = "";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);

}

/*----------------------------------------------------------------------------------------------
 * 설명      : 분류별 목록 저장 시 중복 CHECK
 * 엑셀 업로드 후 저장 시 중복코드 발생 할 수 있음 
 *---------------------------------------------------------------------------------------------*/
function fn_saveClassChk()
{
	var nRowCnt = ds_listClass.getRowCount();	// DataSet Count
	var v_itemCode = "";

	for (var i = 0 ; i < nRowCnt ; i++)
	{
		v_itemCode = ds_listClass.getColumn(i, "clsCd4");
		for (var j = 0 ; j < nRowCnt ; j++) {
			if (v_itemCode==ds_listClass.getColumn(j, "clsCd4")) {
				if (i!=j) {
					sMsg = "중복된 소분류코드가 존재합니다.\r\r";
					sMsg = sMsg + "- 소분류코드 : " + ds_listClass.getColumn(j, "clsCd4");
					gfn_alert(sMsg, "", "A");
					ds_listClass.selectRow(i);	// MultiRow 일 경우 rowposition 사용 X
					return false;
				}
			}
		}
		
	}
	return true;
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 자재별 목록의 자재율 정보 저장
 * 저장 시 변경된 Dataset 을 기준으로 저장
 *---------------------------------------------------------------------------------------------*/
function fn_saveItem()
{
	var nRowCnt = ds_listItem.getRowCount();	// DataSet Count
	var nRowCnt1 = ds_searchRow.getRowCount();	// 조건 DataSet Count
	var iCnt = 0;
	
	// 저장할 자료 여부 CHECK 
	if(nRowCnt == 0) 
	{
		gfn_alert("msg.save.nodata", "저장할 데이터");	// 저장할 데이터가 없습니다.
		return;
	}

	// 선택한 단가업장 자료여부 CHECK
	if(nRowCnt1 == 0) 
	{
		gfn_alert("msg.noselect", "단가업장");	// 단가업장을 선택해 주십시요.
		return;
	}
	
	// 변경내역 여부 CHECK : 엑셀업로드 후 저장 시에는 CHECK X
	if (fv_excelFlag3 == false) {
		if (gfn_dsIsUpdated(ds_listItem) == false) 
		{
			gfn_alert("msg.save.nochange");	// 변경된 내역이 없습니다.
			return;
		}
	}
	
	// 저장시 Validation Check : 자재코드
	if (gfn_validCheck(ds_listItem, ds_listItemValid, true) == false) return;

	// 저장시 중복 CHECK
	if (!fn_saveItemChk())
	{
		return;
	}	
	
	var iCnt = 0;
	var sMsg = "";

	var iFindRowIdx;
	iFindRowIdx = ds_listItem.findRowExpr("gfn_nvl(saleRate,0)==0 && gfn_nvl(fixedPrice,0)==0");
	
	if (iFindRowIdx >= 0)
	{
		sMsg = "판매율 또는 고정단가가 0인 자재가 존재합니다.";
		gfn_alert(sMsg, "", "A");
		ds_listItem.rowposition = iFindRowIdx;
		div_002.tabMain.tabP1.grd_listItem.setFocus();
		div_002.tabMain.tabP1.grd_listItem.setCellPos(div_002.tabMain.tabP1.grd_listItem.getBindCellIndex("Body", "saleRate"));
		return;
	}
	
// 	// 판매율-고정단가 0인 자료 CEHCK
// 	for (var i = 0 ; i < nRowCnt ; i++)
// 	{
// 		if (gfn_nvl(ds_listItem.getColumn(i, "saleRate"), "0") <> "0")
// 		{
// 			iCnt++;
// 		}
// 
// 		if (gfn_nvl(ds_listItem.getColumn(i, "fixedPrice"), "0") <> "0")
// 		{
// 			iCnt++;
// 		}
// 	}
// 
// 
// 	// 저장할 자료 여부 CHECK : 0인 자료만 존재 시 오류메시지 표시
// 	if(iCnt == 0) 
// 	{
// 		gfn_alert("msg.save.nodata", "저장할 데이터");	// 저장할 데이터가 없습니다.
// 		return;
// 	}


	var sMsg = "자재별에 대한 판매율을 저장합니다.\n계속 진행 하시겠습니까?";
	if (!gfn_confirm(sMsg, "", "C")) return;


	/////////////////////////////////////////////////////////////////////////////////////////////
	// 저장할 Dataset Clear
	ds_saveItem.clearData();

	// 저장 대상 개수 
	for (var i = 0 ; i < nRowCnt ; i++)
	{
		// 엑셀업로드일 경우 - 전체, 그외 변경분만 처리
		if (fv_excelFlag3 == false) {
			// 신규 및 수정건에 대해서만 처리
			if (ds_listItem.getRowType(i) == Dataset.ROWTYPE_INSERT || ds_listItem.getRowType(i) == Dataset.ROWTYPE_UPDATE) {
				iCnt++;
				// 대상을 ds_saveItem 복사
				ds_saveItem.addRow();
				iRow = ds_saveItem.rowposition;
				ds_saveItem.copyRow(iRow, ds_listItem, i);
			}
		} else {
			iCnt++;
			// 전체를 ds_saveItem 복사
			ds_saveItem.addRow();
			iRow = ds_saveItem.rowposition;
			ds_saveItem.copyRow(iRow, ds_listItem, i);
		}
	}
	
	
	var nRow = ds_searchRow.rowposition;
	// 저장 시 조건(KEY)을 ds_list의 KEY 값으로 복사
	for (var i = 0 ; i < iCnt ; i++)
	{
		ds_saveItem.setColumn(i, "stdUpjang", ds_searchRow.getColumn(nRow, "selStdUpjang"));
	}
	///////////////////////////////////////////////////////////////////////////////////
	
	var strSvcID    = "saveItem2";
	var strURL      = "fm/fms/gainRateSetMngt/saveItem2.xdo";
	var strInDs     = "ds_saveItem=ds_saveItem:A";
	var strOutDs    = "";
	var strArg      = "";
	var strCallback = "fn_callBack";
	var bAsync      = true;
	
	gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);	
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 테마자재별 목록의 자재율 정보 저장
 * 저장 시 변경된 Dataset 을 기준으로 저장
 *---------------------------------------------------------------------------------------------*/
function fn_saveTheme()
{
	var nRowCnt = ds_listTheme.getRowCount();	// DataSet Count
	var nRowCnt1 = ds_searchRow.getRowCount();	// 조건 DataSet Count
	var iCnt = 0;
	
	// 저장할 자료 여부 CHECK 
	if(nRowCnt == 0) 
	{
		gfn_alert("msg.save.nodata", "저장할 데이터");	// 저장할 데이터가 없습니다.
		return;
	}

	// 선택한 단가업장 자료여부 CHECK
	if(nRowCnt1 == 0) 
	{
		gfn_alert("msg.noselect", "단가업장");	// 단가업장을 선택해 주십시요.
		return;
	}
	
	// 변경내역 여부 CHECK : 엑셀업로드 후 저장 시에는 CHECK X
	//if (fv_excelFlag3 == false) {
		if (gfn_dsIsUpdated(ds_listTheme) == false) 
		{
			gfn_alert("msg.save.nochange");	// 변경된 내역이 없습니다.
			return;
		}
	//}
	
	// 저장시 Validation Check : 자재코드
	if (gfn_validCheck(ds_listTheme, ds_listThemeValid, true) == false) return;

	// 저장시 중복 CHECK
	if (!fn_saveThemeChk())
	{
		return;
	}	
	
	//var iCnt = 0;
	//var sMsg = "";
  //
	//var iFindRowIdx;
	//iFindRowIdx = ds_listTheme.findRowExpr("gfn_nvl(saleRate,0)==0 && gfn_nvl(fixedPrice,0)==0");
	//
	//if (iFindRowIdx >= 0)
	//{
	//	sMsg = "판매율 또는 고정단가가 0인 자재가 존재합니다.";
	//	gfn_alert(sMsg, "", "A");
	//	ds_listTheme.rowposition = iFindRowIdx;
	//	div_002.tabMain.tabP1.grd_listTheme.setFocus();
	//	div_002.tabMain.tabP1.grd_listTheme.setCellPos(div_002.tabMain.tabP1.grd_listTheme.getBindCellIndex("Body", "saleRate"));
	//	return;
	//}
	
// 	// 판매율-고정단가 0인 자료 CEHCK
// 	for (var i = 0 ; i < nRowCnt ; i++)
// 	{
// 		if (gfn_nvl(ds_listTheme.getColumn(i, "saleRate"), "0") <> "0")
// 		{
// 			iCnt++;
// 		}
// 
// 		if (gfn_nvl(ds_listTheme.getColumn(i, "fixedPrice"), "0") <> "0")
// 		{
// 			iCnt++;
// 		}
// 	}
// 
// 
// 	// 저장할 자료 여부 CHECK : 0인 자료만 존재 시 오류메시지 표시
// 	if(iCnt == 0) 
// 	{
// 		gfn_alert("msg.save.nodata", "저장할 데이터");	// 저장할 데이터가 없습니다.
// 		return;
// 	}


	var sMsg = "테마자재별에 대한 판매율을 저장합니다.\n계속 진행 하시겠습니까?";
	if (!gfn_confirm(sMsg, "", "C")) return; 

	/////////////////////////////////////////////////////////////////////////////////////////////
	// 저장할 Dataset Clear
	ds_saveTheme.clearData();

	// 저장 대상 개수 
	for (var i = 0 ; i < nRowCnt ; i++)
	{
		// 엑셀업로드일 경우 - 전체, 그외 변경분만 처리 
		//if (fv_excelFlag3 == false) {
		//	// 신규 및 수정건에 대해서만 처리
		//	if (ds_listTheme.getRowType(i) == Dataset.ROWTYPE_INSERT || ds_listTheme.getRowType(i) == Dataset.ROWTYPE_UPDATE) {
		//		iCnt++;
		//		// 대상을 ds_saveItem 복사
		//		ds_saveTheme.addRow();
		//		iRow = ds_saveTheme.rowposition;
		//		ds_saveTheme.copyRow(iRow, ds_listTheme, i);
		//	}
		//} else {
			iCnt++;
			// 전체를 ds_saveItem 복사
			ds_saveTheme.addRow();
			iRow = ds_saveTheme.rowposition;
			ds_saveTheme.copyRow(iRow, ds_listTheme, i);
		//}
	}
	 
	var nRow = ds_searchRow.rowposition;
	// 저장 시 조건(KEY)을 ds_list의 KEY 값으로 복사
	for (var i = 0 ; i < iCnt ; i++)
	{
		ds_saveTheme.setColumn(i, "stdUpjang", ds_searchRow.getColumn(nRow, "selStdUpjang"));
	}
	///////////////////////////////////////////////////////////////////////////////////
	
	var strSvcID    = "saveTheme";
	var strURL      = "fm/fms/gainRateSetMngt/saveTheme.xdo";
	var strInDs     = "ds_saveTheme=ds_saveTheme:A";
	var strOutDs    = "";
	var strArg      = "";
	var strCallback = "fn_callBack";
	var bAsync      = true;
	
	gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 자재별 목록의 자재율 정보 저장
 * 저장 시 변경된 Dataset 이 아닌 전체를 기준으로 저장함
 *---------------------------------------------------------------------------------------------*/
function fn_saveItem_old()
{
	var nRowCnt = ds_listItem.getRowCount();	// DataSet Count
	var nRowCnt1 = ds_searchRow.getRowCount();	// 조건 DataSet Count
	
	// 저장할 자료 여부 CHECK 
	if(nRowCnt == 0) 
	{
		gfn_alert("msg.save.nodata", "저장할 데이터");	// 저장할 데이터가 없습니다.
		return;
	}

	// 선택한 단가업장 자료여부 CHECK
	if(nRowCnt1 == 0) 
	{
		gfn_alert("msg.noselect", "단가업장");	// 단가업장을 선택해 주십시요.
		return;
	}
	
	// 변경내역 여부 CHECK : 엑셀업로드 후 저장 시에는 CHECK X
	if (fv_excelFlag3 == false) {
		if (gfn_dsIsUpdated(ds_listItem) == false) 
		{
			gfn_alert("msg.save.nochange");	// 변경된 내역이 없습니다.
			return;
		}
	}
	
	// 저장시 Validation Check : 자재코드
	if (gfn_validCheck(ds_listItem, ds_listItemValid, true) == false) return;

	// 저장시 중복 CHECK
// 	if (!fn_saveItemChk())
// 	{
// 		return;
// 	}	
	
	var iCnt = 0;
	var sMsg = "";

	var iFindRowIdx;
	iFindRowIdx = ds_listItem.findRowExpr("gfn_nvl(saleRate,0)==0 && gfn_nvl(fixedPrice,0)==0");
	
	if (iFindRowIdx >= 0)
	{
		sMsg = "판매율 또는 고정단가가 0인 자재가 존재합니다."; 
		gfn_alert(sMsg, "", "A");
		ds_listItem.rowposition = iFindRowIdx;
		div_002.tabMain.tabP1.grd_listItem.setFocus();
		div_002.tabMain.tabP1.grd_listItem.setCellPos(div_002.tabMain.tabP1.grd_listItem.getBindCellIndex("Body", "saleRate"));
		return;
	}
	
// 	// 판매율-고정단가 0인 자료 CEHCK
// 	for (var i = 0 ; i < nRowCnt ; i++)
// 	{
// 		if (gfn_nvl(ds_listItem.getColumn(i, "saleRate"), "0") <> "0") 
// 		{
// 			iCnt++; 
// 		}
// 
// 		if (gfn_nvl(ds_listItem.getColumn(i, "fixedPrice"), "0") <> "0")
// 		{
// 			iCnt++;
// 		}
// 	}
// 
// 
// 	// 저장할 자료 여부 CHECK : 0인 자료만 존재 시 오류메시지 표시
// 	if(iCnt == 0) 
// 	{
// 		gfn_alert("msg.save.nodata", "저장할 데이터");	// 저장할 데이터가 없습니다.
// 		return;
// 	}


	var sMsg = "자재별에 대한 판매율을 저장합니다.\n계속 진행 하시겠습니까?";
	if (!gfn_confirm(sMsg, "", "C")) return;

	// 저장 시 조건(KEY)을 ds_listItem KEY 값으로 복사
	var nRow= ds_searchRow.rowposition;
	
	for (var i = 0 ; i < nRowCnt ; i++)
	{
		ds_listItem.setColumn(i, "stdUpjang", ds_searchRow.getColumn(nRow, "selStdUpjang"));		
	}
	
    var strSvcID    = "saveItem";
    var strURL      = "fm/fms/gainRateSetMngt/saveItem.xdo";
	var strInDs     = "ds_listItem=ds_listItem:A";
    var strOutDs    = "";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 자재별 목록 저장 시 중복 CHECK
 * 엑셀 업로드 후 저장 시 중복코드 발생 할 수 있음 
 *---------------------------------------------------------------------------------------------*/
function fn_saveItemChk()
{
	var nRowCnt = ds_listItem.getRowCount();	// DataSet Count
	var v_itemCode = "";

	for (var i = 0 ; i < nRowCnt ; i++)
	{
		v_itemCode = ds_listItem.getColumn(i, "itemCode");
		for (var j = 0 ; j < nRowCnt ; j++) {
			if (v_itemCode==ds_listItem.getColumn(j, "itemCode")) {
				if (i!=j) {
					sMsg = "중복된 자재코드가 존재합니다.\r\r";
					sMsg = sMsg + "- 자재코드 : " + ds_listItem.getColumn(j, "itemCode");
					gfn_alert(sMsg, "", "A");
					ds_listItem.selectRow(i);	// MultiRow 일 경우 rowposition 사용 X
					return false;
				}
			}
		}
		
		if ( v_itemCode.length != 7 && v_itemCode.startsWith("F") != 0 ) {
			gfn_alert("유효한 자재코드정보가 아닙니다.", "", "A");
			ds_listItem.selectRow(i);
			return false;
		}
		
	}
	return true;
}


/*----------------------------------------------------------------------------------------------
 * 설명      테마자재별 목록 저장 시 중복 CHECK
 * 엑셀 업로드 후 저장 시 중복코드 발생 할 수 있음 
 *---------------------------------------------------------------------------------------------*/
function fn_saveThemeChk()
{
	var nRowCnt = ds_listTheme.getRowCount();	// DataSet Count
	var v_itemCode = "";

	for (var i = 0 ; i < nRowCnt ; i++)
	{
		v_itemCode = ds_listTheme.getColumn(i, "itemCode");
		for (var j = 0 ; j < nRowCnt ; j++) {
			if (v_itemCode==ds_listTheme.getColumn(j, "itemCode")) {
				if (i!=j) {
					sMsg = "중복된 자재코드가 존재합니다.\r\r";
					sMsg = sMsg + "- 자재코드 : " + ds_listTheme.getColumn(j, "itemCode");
					gfn_alert(sMsg, "", "A");
					ds_listTheme.selectRow(i);	// MultiRow 일 경우 rowposition 사용 X
					return false;
				}
			}
		}
		
		if ( v_itemCode.length != 7 && v_itemCode.startsWith("F") != 0 ) {
			gfn_alert("유효한 자재코드정보가 아닙니다.", "", "A");
			ds_listTheme.selectRow(i);
			return false;
		}
		
	}
	return true;
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 단가계약 업장의 비고사항을 저장(FMS_UPJANG의 ATTR11)
 * 저장 시 변경된 Dataset 만 저장
 *---------------------------------------------------------------------------------------------*/
function fn_saveAttr()
{
	var nRowCnt = ds_listStd.getRowCount();	// DataSet Count
	
	// 저장할 자료 여부 CHECK 
	if(nRowCnt == 0) 
	{
		gfn_alert("msg.save.nodata", "저장할 데이터");	// 저장할 데이터가 없습니다.
		return;
	}


	// 변경내역 여부 CHECK
  	if (gfn_dsIsUpdated(ds_listStd) == false) 
  	{
  		gfn_alert("msg.save.nochange");	// 변경된 내역이 없습니다.
  		return;
  	}


	var sMsg = "이익율관련 비고사항을 저장합니다.\n계속 진행 하시겠습니까?";
	if (!gfn_confirm(sMsg, "", "C")) return;

	
    var strSvcID    = "saveAttr";
    var strURL      = "fm/fms/upriceContractUpjangSet/saveAttr.xdo";
	var strInDs     = "ds_listStd=ds_listStd:U";
    var strOutDs    = "";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}



/*----------------------------------------------------------------------------------------------
 * 설명      : 단가업장목록을 복사해 이익율 복사그리드에 표시한다. ( 선택된 업장 제외 )
 *---------------------------------------------------------------------------------------------*/
function fn_tabCopy()
{
	div_002.tabMain.tabindex = 0;
	ds_listCopy.clearData();
	ds_listCopy.copyData(ds_listStd);
	ds_listCopy.addColumn("upjang","String",255);
	//선택업장 찾기.
	var fRow = ds_listCopy.findRow("stdUpjang", ds_listStd.getColumn(ds_listStd.rowposition,"stdUpjang"));
	//선택한 업장 삭제
	ds_listCopy.deleteRow(fRow);
}

/************************************************************************************************
 * 각 COMPONENT 별 EVENT 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : form에서 Key Down시 단축키들 지정(공통에서 자동생성, 화면에 스크립트 작성시 화면 스크립트만 실행됨)
 *---------------------------------------------------------------------------------------------*/
// function form_onkeydown(obj:Form, e:KeyEventInfo)
// {
// 	gfn_formKeyDown(obj, e);
// }

/*----------------------------------------------------------------------------------------------
 * 설명      : Grid Double Click시 이벤트
 * 계약업장 목록 조회 호출             
 *---------------------------------------------------------------------------------------------*/
function grd_listStd_oncelldblclick(obj:Grid, e:GridClickEventInfo)
{
	if(e.row < -1) return;

	// 조건 관련 DataSet 초기화
	ds_searchRow.clearData();
	// 선택한 팀, 판매그릅코드를 조건 Dataset에 대입
	var iIdx = ds_searchRow.addRow();
	ds_searchRow.setColumn(iIdx, "selStdUpjang", ds_listStd.getColumn(ds_listStd.rowposition, "stdUpjang"));		// 기준업장 선택
	ds_searchRow.setColumn(iIdx, "schCc", ds_listStd.getColumn(ds_listStd.rowposition, "stdCc"));		// CcCode
	ds_searchRow.setColumn(iIdx, "schCenter", div_001.edt_ccCd.userdata);		// Center
	
	// 선택한 업장정보 표시
	div_002.edt_selUpjangNm.value =  "(" + ds_listStd.getColumn(ds_listStd.rowposition, "stdUpjang") + ")" + ds_listStd.getColumn(ds_listStd.rowposition, "stdUpjangNm");
	div_002.edt_selUpjang.value =  ds_listStd.getColumn(ds_listStd.rowposition, "stdUpjang");
	
	// 분류율 초기화 : 전체
	div_002.msk_clsRate.value = 0;
	div_002.tabMain.tabP1.msk_itemRate.value = 0;

	// 분류율 초기화 : 선택
	for (var i = 0 ; i < ds_class.getRowCount() ; i++)
	{
		ds_class.setColumn(i, "saleRate", "0");	
	}
		
	
	// 분류별 조회
	fn_searchClass();
	
	// 자재별 조회-일반자재
	fn_searchItem();
	
	// 자재별 조회-테마자재
	fn_searchTheme();
	
	fn_tabCopy();
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 분류별 목록에서 지정한 소분류에 대하여 판매율을 일괄 적용한다.
 *---------------------------------------------------------------------------------------------*/
function btn_clsRate_onclick(obj:Button,  e:ClickEventInfo)
{
	var nRowCnt = ds_listClass.getRowCount();	// DataSet Count
	var v_clsRate = div_002.msk_clsRate.value;			// 적용할 판매율
	var iCnt = 0;

	// 분류목록 여부 CHECK
	if(nRowCnt < 1) 
	{
		gfn_alert("msg.err.grid.noselect", "선택한 row");	// 선택된 항목이 없습니다.
		return;
	}


	if (v_clsRate.valueOf() == "undefined" || v_clsRate == "") v_clsRate = 0;
	
	var sMsg = "선택한 분류에 대해 판매율을 일괄 적용합니다.\n계속 진행 하시겠습니까?\n\n";
		sMsg = sMsg + " - 적용할 분류 : " + div_002.cbo_class.text;
	
	
	if (!gfn_confirm(sMsg, "", "C")) return;
	
	var v_class = div_002.cbo_class.value;		// 대분류 COMBO
	
	var v_arr_class;
	if(v_class != null)v_arr_class = v_class.split(",");
	for (var i = 0 ; i < nRowCnt ; i++)
	{
		var rate = false;
// 		// Dataset이 선택된 것만 적용
// 		if (ds_listClass.getSelect(i))	
// 		{
// 			iCnt++;
// 			ds_listClass.setColumn(i, "saleRate", v_clsRate);	// 판매율에 적용
// 		}
		if (v_class != "") {
			// 선택한 대분류 기준만 적용
			for(var j=0; j < v_arr_class.length ; j++){
				if(ds_listClass.getColumn(i, "clsCd2") == v_arr_class[j])rate = true;
			}
			if (rate) {
				iCnt++;
				ds_listClass.setColumn(i, "saleRate", v_clsRate);	// 판매율에 적용
			}
		} else {
			iCnt++;
			ds_listClass.setColumn(i, "saleRate", v_clsRate);	// 판매율에 적용
		}
	}

	if(iCnt == 0)
	{
		sMsg = "선택한 분류 정보가 없습니다.";
		gfn_alert(sMsg, "", "A");
	} else {
		gfn_alert("msg.action.success");	// 처리 되었습니다.
	}

}

/*----------------------------------------------------------------------------------------------
 * 설명      : 분류별 목록에 대한 엑셀 업로드 
 * 주) 연동 시 SQL 항목 순서와 Dataset 순서를 동일하게 해야 함
 *---------------------------------------------------------------------------------------------*/
function btn_clsUpload_onclick(obj:Button,  e:ClickEventInfo)
{
	var nRowCnt = ds_listClass.getRowCount();	// DataSet Count
	var v_upjang = ds_searchRow.getColumn(ds_searchRow.rowposition, "selStdUpjang");
	
	// 분류목록 여부 CHECK
// 	if(nRowCnt < 1) 
// 	{
// 		gfn_alert("msg.err.grid.noselect", "선택한 row");	// 선택된 항목이 없습니다.
// 		return;
// 	}

	
	if (v_upjang=="") {
		gfn_alert("msg.noselect", "단가업장");	// 단가업장을 선택해 주십시요.
		return;
	}


	this.setWaitCursor(true);

	// 파일 선택
	var strFileName = gfn_excelFileDialog("LOAD", "EXCEL");

	if (strFileName.length == 0)
	{
		this.setWaitCursor(false);
		return;
	}

	/*********************************************************************************************
	** argument             : strFileName		파일명 (경로 포함)
	**                        strDsName			Import 대상 Dataset Name
	**                        nStartRow			Import 시작 행(사용된 Range 기준, 1 base)
	**						  bKeepColInfo		Dataset의 컬럼 정보를 유지할지 여부
	*********************************************************************************************/
	
	var rtn = gfn_importExcel(strFileName, "ds_listClass", 2, true);
	
	//if (ds_listClass.getRowCount()>0) {
	//	fv_excelFlag2 = true;
	//	gfn_alert("msg.action.success");	// 처리 되었습니다.
	//}
		
	// 엑셀 업로드 후에 Rowtype 속성 변경
	if (ds_listClass.getRowCount() > 0) {
		fv_excelFlag2 = true;
		ds_listClass.updatecontrol = false;
		for(var i=0; i<ds_listClass.rowcount; i++)
		{				
			if(ds_listClass.getColumn(i, "clsCd4") == 'F271011') 
			{
				ds_listClass.setColumn(i, "saleRate", "0");	// 0값 강제 적용
			}
		}
		ds_listClass.updatecontrol = true;
		gfn_alert("msg.action.success");	// 처리 되었습니다.
	} 
	
	this.setWaitCursor(false);
	
	//trace(ds_listClass.saveXML());
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 분류별 목록의 분류율 정보 저장
 * 저장 시 변경된 Dataset 이 아닌 전체를 기준으로 저장함
 *---------------------------------------------------------------------------------------------*/
function btn_clsSave_onclick(obj:Button,  e:ClickEventInfo)
{
	fn_saveClass();
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 자재별 목록에서 지정한 자재에 대하여 판매율을 일괄 적용한다.
 *---------------------------------------------------------------------------------------------*/
function btn_itemRate_onclick(obj:Button,  e:ClickEventInfo)
{
	if(div_002.tabMain.tabP1.rdo_selType.value == 0){
		var nRowCnt = ds_listItem.getRowCount();	// DataSet Count
		var v_itemRate = div_002.tabMain.tabP1.msk_itemRate.value;		// 적용할 판매율
		var iCnt = 0;

		// 자재목록 여부 CHECK
		if(nRowCnt < 1) 
		{
			gfn_alert("msg.err.grid.noselect", "선택한 row");	// 선택된 항목이 없습니다.
			return;
		}

		if (v_itemRate.valueOf() == "undefined" || v_itemRate == "") v_itemRate = 0;
		
		if (v_itemRate == 0) {
			gfn_alert("판매율 값을 입력하세요.", "A");
			div_002.tabMain.tabP1.msk_itemRate.setFocus();
			return;
		}
		
		var sMsg = "선택한 자재에 대해 판매율을 일괄 적용합니다.\n계속 진행 하시겠습니까?";
		
		
		if (!gfn_confirm(sMsg, "", "C")) return;
		
		for (var i = 0 ; i < nRowCnt ; i++)
		{
			// Dataset이 선택된 것만 적용
			if (ds_listItem.getSelect(i))	
			{
				iCnt++;
				ds_listItem.setColumn(i, "saleRate", v_itemRate);	// 판매율에 적용
			}
		}

		if(iCnt == 0)
		{
			sMsg = "선택한 자재 정보가 없습니다.";
			gfn_alert(sMsg, "", "A");
		} else {
			gfn_alert("msg.action.success");	// 처리 되었습니다.
		}
	} else { // 테마자재의 경우,
		var nRowCnt = ds_listTheme.getRowCount();	// DataSet Count
		var v_itemRate = div_002.tabMain.tabP1.msk_itemRate.value;		// 적용할 판매율
		var iCnt = 0;

		// 자재목록 여부 CHECK
		if(nRowCnt < 1) 
		{
			gfn_alert("msg.err.grid.noselect", "선택한 row");	// 선택된 항목이 없습니다.
			return;
		}

		if (v_itemRate.valueOf() == "undefined" || v_itemRate == "") v_itemRate = 0;
		
		if (v_itemRate == 0) {
			gfn_alert("판매율 값을 입력하세요.", "A");
			div_002.tabMain.tabP1.msk_itemRate.setFocus();
			return;
		}
		
		var sMsg = "선택한 자재에 대해 판매율을 일괄 적용합니다.\n계속 진행 하시겠습니까?";
		
		
		if (!gfn_confirm(sMsg, "", "C")) return;
		
		for (var i = 0 ; i < nRowCnt ; i++)
		{
			// Dataset이 선택된 것만 적용
			if (ds_listTheme.getSelect(i))	
			{
				iCnt++;
				ds_listTheme.setColumn(i, "saleRate", v_itemRate);	// 판매율에 적용
			}
		}

		if(iCnt == 0)
		{
			sMsg = "선택한 자재 정보가 없습니다.";
			gfn_alert(sMsg, "", "A");
		} else {
			gfn_alert("msg.action.success");	// 처리 되었습니다.
		}
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 자재별 목록에 대한 엑셀 업로드 
 * 주) 연동 시 SQL 항목 순서와 Dataset 순서를 동일하게 해야 함
 *---------------------------------------------------------------------------------------------*/
function btn_itemUpload_onclick(obj:Button,  e:ClickEventInfo)
{
	var nRowCnt = ds_listItem.getRowCount();	// DataSet Count
	var v_upjang = ds_searchRow.getColumn(ds_searchRow.rowposition, "selStdUpjang");
	
	// 자재목록 여부 CHECK
// 	if(nRowCnt < 1) 
// 	{
// 		gfn_alert("msg.err.grid.noselect", "선택한 row");	// 선택된 항목이 없습니다.
// 		return;
// 	}

	if (v_upjang=="") {
		gfn_alert("msg.noselect", "단가업장");	// 단가업장을 선택해 주십시요.
		return;
	}


	this.setWaitCursor(true);

	// 파일 선택
	var strFileName = gfn_excelFileDialog("LOAD", "EXCEL");

	if (strFileName.length == 0)
	{
		this.setWaitCursor(false);
		return;
	}

	/*********************************************************************************************
	** argument             : strFileName		파일명 (경로 포함)
	**                        strDsName			Import 대상 Dataset Name
	**                        nStartRow			Import 시작 행(사용된 Range 기준, 1 base)
	**						  bKeepColInfo		Dataset의 컬럼 정보를 유지할지 여부
	*********************************************************************************************/
	
	var rtn = gfn_importExcel(strFileName, "ds_listItem", 2, true);


	// 엑셀 업로드 후에 Rowtype 속성 변경
	if (ds_listItem.getRowCount() > 0) {
		fv_excelFlag3 = true;
		ds_listItem.updatecontrol = false;
		for(var i=0; i<ds_listItem.rowcount; i++)
		{	
			ds_listItem.setRowType(i, Dataset.ROWTYPE_INSERT);
		}
		ds_listItem.updatecontrol = true;
		gfn_alert("msg.action.success");	// 처리 되었습니다.
	}


	this.setWaitCursor(false);
	
	//trace(ds_listClass.saveXML());
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 자재별 목록의 자재율 정보 저장
 * 저장 시 변경된 Dataset 이 아닌 전체를 기준으로 저장함
 *---------------------------------------------------------------------------------------------*/
function btn_itemSave_onclick(obj:Button,  e:ClickEventInfo)
{
	if(div_002.tabMain.tabP1.rdo_selType.value == 0){
		fn_saveItem();
	} else { // 테마자재의 경우,
		fn_saveTheme();		
	}
}


/*----------------------------------------------------------------------------------------------
 * @class 기준업장명의 Key Down Event
 * @param obj - Event Dataset/Component
 * @param e - Event 발생정보
 * @return 
 *---------------------------------------------------------------------------------------------*/
function edt_stdUpjang_onkeydown(obj:Edit, e:KeyEventInfo)
{
	// Enter 키
	if(e.keycode == 13) 
	{		
		div_001.edt_stdUpjang.updateToDataset();
		fn_searchStd();
	}
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 자재별목록에서 추가 버튼 클릭 시 팝업화면 호출
 * 
 *---------------------------------------------------------------------------------------------*/
function btn_itemAdd_onclick(obj:Button,  e:ClickEventInfo)
{
	var v_upjang = ds_searchRow.getColumn(ds_searchRow.rowposition, "selStdUpjang");
	
	if (v_upjang=="") {
		gfn_alert("msg.noselect", "단가업장");	// 단가업장을 선택해 주십시요.
		return;
	}
	
	var arrParam = new Array();
	var dsRtn = new Dataset();

	var dsObj = gfn_dialog("GainRateItemSearchPop"				// Dialog ID
							, "X_FMS::GainRateItemSearchPop.xfdl"	// Form URL
							, {fv_Contents:arrParam}					// 배열
							, null, null, null, null, null, false, true, -1);

	if(dsObj != null)
	{
		for(var i=0; i<dsObj.rowcount; i++)
		{	
			// 자재별 목록에 추가 : 중복된 자재는 추가하지 않음, 별도 메시지 표시 X
			var iFindRowIdx = ds_listItem.findRowExpr("itemCode == '"+dsObj.getColumn(i, "itemCode")+"'", 0, ds_listItem.rowcount);
			// 검색된 행이 존재할 시에는 다음 ROW로 이동
			if (iFindRowIdx == -1)
			{
				ds_listItem.addRow();
				ds_listItem.setColumn(ds_listItem.rowposition, "className2", dsObj.getColumn(i, "className2"));	
				ds_listItem.setColumn(ds_listItem.rowposition, "className3", dsObj.getColumn(i, "className3"));	
				ds_listItem.setColumn(ds_listItem.rowposition, "className4", dsObj.getColumn(i, "className4"));	
				ds_listItem.setColumn(ds_listItem.rowposition, "itemCode", dsObj.getColumn(i, "itemCode"));	
				ds_listItem.setColumn(ds_listItem.rowposition, "itemName", dsObj.getColumn(i, "itemName"));	
				ds_listItem.setColumn(ds_listItem.rowposition, "itemSize", dsObj.getColumn(i, "itemSize"));	
				ds_listItem.setColumn(ds_listItem.rowposition, "itemUnit", dsObj.getColumn(i, "itemUnit"));	
			}
		}
		//trace(ds_listItem.saveXML());
		gfn_alert("msg.action.success");	// 처리 되었습니다.
	}
	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 자재별목록에서 삭제 버튼 클릭 시 
 * 
 *---------------------------------------------------------------------------------------------*/
function btn_itemDel_onclick(obj:Button,  e:ClickEventInfo)
{
	// 선택한 행의 자재를 바로 삭제
	var nRowCnt = ds_listItem.getRowCount();	// DataSet Count
	var iCnt = 0;
	
	
	for (var i = 0 ; i < nRowCnt ; i++)
	{
 		// Dataset이 선택된 것만 적용
 		if (ds_listItem.getSelect(i))	
 		{
 			iCnt++;
 		}
	}

	if(iCnt == 0)
	{
		sMsg = "삭제할 자재 정보가 없습니다.";
		gfn_alert(sMsg, "", "A");
		return;
	}	
	
	
//	var sItemCode = ds_listItem.getColumn(nRow, "itemCode");
//	var sItemName = ds_listItem.getColumn(nRow, "itemName");
	
	var sMsg = "선택한 자재를 삭제합니다.\n계속 진행 하시겠습니까?\n\n";
//		sMsg = sMsg + " - 자재코드 : " + sItemCode + "\n";
//		sMsg = sMsg + " - 자재명   : " + sItemName + "\n";


	var rtVal = gfn_confirm(sMsg, "", "C");	// 선택된 자료를 삭제 하시겠습니까?

	iCnt = 0;
	if (rtVal == true) 
	{	
	
		// 삭제용 dataset Clear
		ds_deleteItem.clearData();
		
		// 삭제할 대상 dataset 생성
		for (var i = 0 ; i < nRowCnt ; i++)
		{
			// Dataset이 선택된 것만 적용
			if (ds_listItem.getSelect(i))	
			{
				// 신규추가된 ROW 해당 ROW를 삭제
				if (ds_listItem.getRowType(i) != Dataset.ROWTYPE_INSERT)
				{
					//var bSucc = ds_listItem.deleteRow(i);
					//trace("bSucc : " + bSucc);
					iCnt++;

					// 삭제용 dataset SET
					ds_deleteItem.addRow();
					ds_deleteItem.setRowType(ds_deleteItem.rowposition, Dataset.ROWTYPE_DELETE);

					ds_deleteItem.setColumn(ds_deleteItem.rowposition, "stdUpjang", ds_searchRow.getColumn(ds_searchRow.rowposition, "selStdUpjang"));	// 단가업장		
					ds_deleteItem.setColumn(ds_deleteItem.rowposition, "itemCode", ds_listItem.getColumn(i, "itemCode"));							// 자재코드
				}
			}
		}
	
		if (iCnt == 0) {	// TR 필요없으면 메시지 호출 후 종료
			var bSucc = ds_listItem.deleteSelectedRows();
			trace("bSucc : " + bSucc);
			gfn_alert("msg.delete.success");// 삭제 되었습니다.
			return;
		}
	
		
		// Transaction 바로 호출해서 삭제 처리 함 
		var strSvcID    = "deleteItem";
		var strURL      = "fm/fms/gainRateSetMngt/deleteItem.xdo";
		var strInDs     = "ds_deleteItem=ds_deleteItem:U";
		var strOutDs    = "";
		var strArg      = "";
		var strCallback = "fn_callBack";
		var bAsync      = true;
		
		gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
	}
	
}

function tabMain_canchange(obj:Tab, e:TabIndexChangeEventInfo)
{
	if(gfn_dsIsUpdated(ds_listClass) && e.postindex == 1){
		if(!gfn_confirm("저장하지 않은 이익율은 반영되지 않습니다.\n계속 하시겠습니까?"))return false;
	}
	
	div_002.Static02.visible = !div_002.Static02.visible;
	div_002.msk_clsRate.visible = !div_002.msk_clsRate.visible;
	div_002.Edit03.visible = !div_002.Edit03.visible;
	div_002.btn_clsRateAll.visible = !div_002.btn_clsRateAll.visible;
	div_002.btn_clsDiv.visible = !div_002.btn_clsDiv.visible;
	
	div_002.btn_clsUpload.visible = !div_002.btn_clsUpload.visible;
	div_002.btn_clsSave.visible = !div_002.btn_clsSave.visible;
	div_002.btn_Copy.visible = !div_002.btn_Copy.visible;
	//div_002.cbo_class.visible = !div_002.cbo_class.visible;
}

function btn_Copy_onclick(obj:Button,  e:ClickEventInfo)
{
	if(ds_listCopy.getRowCount() == 0 || ds_listCopy.findRow("stdChk" , 1) == -1){
		gfn_alert("이익율 복사 할 대상 업장이 없습니다.");
		return;
	}
	if(ds_listClass.getRowCount() == 0){
		gfn_alert("이익율 설정 자료가 존재하지 않습니다.");
		return;
	}
	
	var msg = "";
	
	msg = "복사되는 업장에 기존데이터는 삭제됩니다.\n\n";
	msg = msg + "- 기준업장 : " + div_002.edt_selUpjangNm.value + "\n\n";
	msg = msg + "이익율 복사를 실행하시겠습니까?";
	if(!gfn_confirm(msg))return;
	
	
	var strSvcID    = "rateCopy";
	var strURL      = "fm/fms/gainRateSetMngt/rateCopy.xdo";
	var strInDs     = "ds_listCopy=ds_listCopy:U";
	var strOutDs    = "";
	var strArg      = "upjang="+div_002.edt_selUpjang.value;
	var strCallback = "fn_callBack";
	var bAsync      = true;
	
	gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}

function div_001_btn_save_onclick(obj:Button,  e:ClickEventInfo)
{
	fn_saveAttr();	
}


/*----------------------------------------------------------------------------------------------
 * 설명      : 판매율 전체 적용 처리
 * 
 *---------------------------------------------------------------------------------------------*/
function div_002_btn_clsRateAll_onclick(obj:Button,  e:ClickEventInfo)
{
	var nRowCnt = ds_listClass.getRowCount();	// DataSet Count
	var v_clsRate = div_002.msk_clsRate.value;			// 적용할 판매율
	var iCnt = 0;

	// 분류목록 여부 CHECK
	if(nRowCnt < 1) 
	{
		gfn_alert("msg.err.grid.noselect", "선택한 row");	// 선택된 항목이 없습니다.
		return;
	}

	if (v_clsRate.valueOf() == "undefined" || v_clsRate == "") v_clsRate = 0;

	// 0도 처리할 수 있도록 (2015-12-31, 김진희 PI요청)
// 	if (v_clsRate == 0) {
// 		gfn_alert("판매율 값을 입력하세요.", "A");
// 		div_002.msk_clsRate.setFocus();
// 		return;
// 	}
	
	var sMsg = "전체 분류에 대해 판매율을 일괄 적용합니다.\n계속 진행 하시겠습니까?\n\n";
		sMsg = sMsg + " - 적용할 분류 : 전체";
	
	
	if (!gfn_confirm(sMsg, "", "C")) return;
	
	for (var i = 0 ; i < nRowCnt ; i++)
	{
		iCnt++;
		if(ds_listClass.getColumn(i, "clsCd4") != 'F271011')    // CSR190700320	SRR201907_4234
		{
			ds_listClass.setColumn(i, "saleRate", v_clsRate);	// 판매율에 적용
		}
	}

	if(iCnt == 0)
	{
		sMsg = "선택한 분류 정보가 없습니다.";
		gfn_alert(sMsg, "", "A");
	} else {
		gfn_alert("msg.action.success");	// 처리 되었습니다.
	}
	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 분류별 판매율 적용 처리 Div Show
 * 
 *---------------------------------------------------------------------------------------------*/
function div_002_btn_clsDiv_onclick(obj:Button,  e:ClickEventInfo)
{
	var nRowCnt = ds_listClass.getRowCount();	// DataSet Count

	div_margin.position.right = div_002.btn_Copy.position.right - 230;
	div_margin.position.width = 225;

	if (div_margin.visible) {
		div_margin.visible = false;
		div_002.btn_clsDiv.text = "분류별 적용 ▼";
	}
	else {
		// 자료 여부 CHECK
		if(nRowCnt == 0) 
		{
			gfn_alert("msg.err.grid.nodata", "");	// 데이타가 없습니다.
			return;
		}
		div_margin.visible = true;
		div_002.btn_clsDiv.text = "분류별 적용 ▲";
	}
	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 분류별 판매율 적용 처리 
 * 
 *---------------------------------------------------------------------------------------------*/
function div_margin_btn_clsRate2_onclick(obj:Button,  e:ClickEventInfo)
{
	var nRowCnt = ds_listClass.getRowCount();	// DataSet Count
	var nRowCnt1 = ds_class.getRowCount();		// DataSet Count : 분류정보
	var v_clsRate = div_002.msk_clsRate.value;			// 적용할 판매율
	var iCnt = 0;

	// 분류목록 여부 CHECK
	if(nRowCnt < 1) 
	{
		gfn_alert("msg.err.grid.noselect", "선택한 row");	// 선택된 항목이 없습니다.
		return;
	}

	// 판매율목록 여부 CHECK
	if(nRowCnt1 < 1) 
	{
		gfn_alert("분류별 판매율 정보가 없습니다.", "A");
		return;
	}

	// 판매율 Value Check 제외 : 2015-12-31 김진희 PT 요청
	for (var i = 0 ; i < nRowCnt1 ; i++)
	{
		if (gfn_nvl(ds_class.getColumn(i, "saleRate"), "0") != "0")  iCnt++;
	}

// 	if (iCnt < 1) {
// 		gfn_alert("판매율 값을 최소한 1개 이상 입력하세요.", "A");
// 		return;
// 	}

	iCnt = 0;
	

	var sMsg = "선택한 분류에 대해 판매율을 일괄 적용합니다.\n계속 진행 하시겠습니까?\n\n";
		//sMsg = sMsg + " - 판매율이 0 인 분류는 적용하지 않습니다."
	
	
	if (!gfn_confirm(sMsg, "", "C")) return;

	var v_class = "";
	var v_arr_class = "";
	var rate = false;
	
	// 분류별 판매율 일괄 적용
	for (var i = 0 ; i < nRowCnt1 ; i++)
	{
		v_class = ds_class.getColumn(i, "classCode");					// 분류코드
		v_clsRate = gfn_nvl(ds_class.getColumn(i, "saleRate"), "0");	// 판매율
		
		if(v_class != null)v_arr_class = v_class.split(",");
		
		// 분류 및 판매율이 0이 아니면 처리, 0도 포함(2015-12-31, 김진희 PI요청)
		//if (v_class != "" && v_clsRate != "0") {
		if (v_class != "") {
			// 분류별 적용
			for (var j = 0 ; j < nRowCnt ; j++)
			{
				rate = false;
				for(var k=0; k < v_arr_class.length ; k++){
					if(ds_listClass.getColumn(j, "clsCd2") == v_arr_class[k])rate = true;
				}
				if (rate) {
					iCnt++;
					ds_listClass.setColumn(j, "saleRate", v_clsRate);	// 판매율에 적용
				}
			}			
		}		
	
	}	

	if(iCnt == 0)
	{
		sMsg = "선택한 분류 정보 판매율이 적용되지 않았습니다.";
		gfn_alert(sMsg, "", "A");
	} else {
		gfn_alert("msg.action.success");	// 처리 되었습니다.
	}
	
}

function comp_tm_onkeydown(obj:TmSearchComponent, e:KeyEventInfo)
{
	if(e.keycode == 46){
		div_001.comp_tm.setTmCode("");
		div_001.comp_tm.setTmName("");
		// CC정보 초기화
		ds_search.setColumn(0, "schCc", "");
		ds_search.setColumn(0, "schCcNm", "");
		
	}
}

function edt_ccCd_onkeydown(obj:Edit, e:KeyEventInfo)
{
	if(e.keycode == 46){
		ds_search.setColumn(0, "schCc", "");
		ds_search.setColumn(0, "schCcNm", "");
	}
}

function div_001_Button00_onclick(obj:Button,  e:ClickEventInfo)
{
	fn_searchItem();
	fn_searchTheme();
}

function fn_checkDupCode(type, code) {
	
	switch ( type ) {
		case "b" :
			return (ds_listItem.getCaseCount("itemCode == '" + code + "'") > 1 ? '#fffbccff' : '');
			break;
		case "c" :
			return (ds_listItem.getCaseCount("itemCode == '" + code + "'") > 1 ? 'red' : '');
			break;
		
	}	
}

function rdo_selType_onitemchanged(obj:Radio, e:ItemChangeEventInfo)
{
	if(div_002.tabMain.tabP1.rdo_selType.value == 0){
		div_002.tabMain.tabP1.grd_listItem.visible = true;
		div_002.tabMain.tabP1.grd_listTheme.visible = false;
		div_002.tabMain.tabP1.btn_itemAdd.visible = true;
		div_002.tabMain.tabP1.btn_itemDel.visible = true;
		div_002.tabMain.tabP1.btn_itemUpload.visible = true;
		
		div_002.tabMain.tabP1.Static03.visible = true;	
		div_002.tabMain.tabP1.btn_itemRate.visible = true;	
		div_002.tabMain.tabP1.Edit05.visible = true;	
		div_002.tabMain.tabP1.msk_itemRate.visible = true;	
			
		
	} else {
		div_002.tabMain.tabP1.grd_listItem.visible = false;
		div_002.tabMain.tabP1.grd_listTheme.visible = true;
		div_002.tabMain.tabP1.btn_itemAdd.visible = false;
		div_002.tabMain.tabP1.btn_itemDel.visible = false;
		div_002.tabMain.tabP1.btn_itemUpload.visible = false;
		
		div_002.tabMain.tabP1.Static03.visible = false;	
		div_002.tabMain.tabP1.btn_itemRate.visible = false;	
		div_002.tabMain.tabP1.Edit05.visible = false;	
		div_002.tabMain.tabP1.msk_itemRate.visible = false;	
	} 
	
}

function grd_listTheme_ontextchange(obj:Grid, e:GridEditTextChangeEventInfo)
{
	if(ds_listTheme.getColumn(e.row,"stdYn") == "Y")
	{ 
		ds_listTheme.setColumn(e.row, "fixedPrice", ""); 
		gfn_alert("일반자재가 존재합니다.(입력불가)");
		return;
	}	
}

function grd_listTheme_oncellclick(obj:Grid, e:GridClickEventInfo)
{ 
	if(ds_listTheme.getColumn(e.row,"stdYn") == "Y")
	{
		ds_listTheme.setColumn(e.row, "fixedPrice", ""); 
		gfn_alert("일반자재가 존재합니다.(입력불가)");
		return;
	}	
}

function grd_listTheme_ontextchanged(obj:Grid, e:GridEditTextChangedEventInfo)
{
	if(ds_listTheme.getColumn(e.row,"stdYn") == "Y")
	{
		ds_listTheme.setColumn(e.row, "fixedPrice", ""); 
	}	
	
}
]]></Script>
  </Form>
</FDL>
