<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="..\..\..\default_typedef.xml"/>
  <Form id="ReturnOrderByCust" classname="COMP_GUIDE_13" inheritanceid="" position="absolute 0 0 1252 725" titletext="반환주문-고객사용" scrollbars="autoboth" onload="form_onload" onactivate="ReturnOrderByCust_onactivate" ondeactivate="ReturnOrderByCust_ondeactivate" onkeydown="fn_FormKeyDown" ontimer="ReturnOrderByCust_ontimer">
    <Layouts>
      <Layout>
        <Static id="Static08" class="sta_WFSA_Labelbg" position="absolute 0 30 1237 71" anchor="left top right"/>
        <Combo id="cbo_Subinv" taborder="1" innerdataset="ds_Subinv" codecolumn="SUBINV_CODE" datacolumn="SUBINV_NAME" type="filter" displayrowcount="10" position="absolute 390 40 606 61"/>
        <Static id="st_Upjang" text="사업장" class="sta_WFSA_label" position="absolute 15 40 68 61" userdata="strQuery_FMUpjang"/>
        <Static id="Static6" text="식당(창고)" class="sta_WFSA_label" position="absolute 310 40 387 61"/>
        <Static id="sta_NeedDate" text="반환회수일" class="sta_WFSA_label" position="absolute 636 40 709 61"/>
        <Div id="div_cmnBtn" anchor="left top right" taborder="6" url="cmn::CmnBtn.xfdl" text="Div0" scrollbars="none" position="absolute 0 0 1237 30"/>
        <Static id="Static06" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1237 0 1252 710" anchor="top right"/>
        <Static id="Static02" class="sta_WFDA_Labelbg" position="absolute 0 84 1237 111" anchor="left top right"/>
        <Static id="Static19" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 0 71 754 84"/>
        <Static id="Static20" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 0 111 450 116" anchor="left top"/>
        <Static id="Static2" text="발주내역" class="sta_WF_Title01" position="absolute 0 389 123 407"/>
        <Static id="Static44" text="과발주한 상품은 없는지 다시 한번 확인하시고 저장버튼을 클릭해 주시기 바랍니다. 상품 추가/수정 후 저장버튼을 눌러야 반영됩니다.." class="sta_WF_DiscPoint" position="absolute 96 388 942 403"/>
        <Static id="Static71" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 710 1252 725" anchor="left bottom"/>
        <Combo id="cbo_NeedDate" taborder="2" codecolumn="needDate" datacolumn="needDateDesc" displayrowcount="10" position="absolute 718 40 870 61" onkeydown="cbo_NeedDate_onkeydown" onitemchanged="cbo_NeedDate_onitemchanged" innerdataset="@ds_needDateList"/>
        <Static id="Static00" text="#. 업장 초기 설정&#13;&#10;    - 사업장 : 로그인한 사용자의 소속 사업장으로 화면이 열리는 시점에 설정하고 사용자가 임의로 변경할 수 없도록 비활성화&#13;&#10;    - RTN_YN@FMS_UPJANG의 값이 'Y'가 아닌 경우, 메시지 처리[&quot;반환 주문이 가능한 업장이 아닙니다. 담당 영업사원에게 문의하세요.&quot;]&#13;&#10;    - 창고 : FMZ_PO_SUBINV_S001.xml&#13;&#10;    - 반환회수일 : 명일부터 정상주문내역이 있는 일자 정보 리스트[ YYYY-MM-DD (DY) ]&#13;&#10;    - 주문가능한 입고 예정일이 존재하지 않을 경우, 메시지 처리 [&quot;반환주문가능한 정상주문 내역이 존재하지 않습니다.&quot;]&#13;&#10;    - 반환회수일 재조회(&lt;- 정상발주 내역이 존재해야 반환발주 가능)&#13;&#10;" position="absolute 1263 17 2098 216" style="linespace:8;background:antiquewhite;padding:20 20 20 20;align:left top;" visible="false"/>
        <Static id="Static01" text="#. 상품검색&#13;&#10;    - 상품을 검색하기 전, 입고예정일 정보가 존재하지 않을 경우, 입고예정일 정보를 다시 조회 후, 최근일자로 입고 예정일을 자동 선택하고, &#13;&#10;      입고예정일 정보가 존재하지 않을 경우, 메시지 처리[&quot;반환주문가능한 정상주문 내역이 존재하지 않아 상품검색이 불가합니다.&quot;]&#13;&#10;    - 상품발주(브랜드) 프로그램내 상품검색의 프로그램에 반환상품관리 데이터(RTN_ITEM_MST) 조건 추가&#13;&#10;    - 조회결과 double click 발주내역에 추가&#13;&#10;      (FICS/상품발주 동일 구현 내용 참조)&#13;&#10;    - 조회결과 상품코드/88코드/상품명 영역에서 click event 발생시 상품정보 팝업&#13;&#10;      (FICS/상품발주 상품정보 팝업 내용 참고)" position="absolute 1261 221 2096 440" style="linespace:8;background:antiquewhite;padding:20 20 20 20;align:left top;" visible="false"/>
        <Button id="btn_soprNeedDate" taborder="5" class="btn_WF_Reload" position="absolute 876 40 901 61" onclick="fn_searchSoprNeedDate"/>
        <Static id="st_Timer" text="마감시간 : 00일 00시간 00분 전" class="sta_WF_RedhelpB" position="absolute 958 92 1231 104" anchor="top right" style="color:red;align:right middle;font:굴림,9,bold;" visible="true"/>
        <Static id="Static03" text="#. 주문정보&#13;&#10;    - 바코드, 박스수량, 낱개수량 정보에 대한 처리는 상품발주(브랜드)와 동일하게 구현" position="absolute 1261 459 2096 601" style="linespace:8;background:antiquewhite;padding:20 20 20 20;align:left top;" visible="false"/>
        <UpjangSearchComponent id="comp_upjang" titletext="업장 검색용 Component" taborder="0" text="UpjangSearchComponent" position="absolute 70 40 280 61" bindDataset="" bindUpjangCodeColumn="" bindUpjangNameColumn="" eventBeforeTrigger="fn_Trigger_bef" eventAfterTrigger="fn_Trigger_aft" roleSetId="" enable="false"/>
        <Combo id="cbo_Gbn" taborder="8" tabstop="false" value="88" text="바코드" innerdataset="@ds_searchGbn" codecolumn="codecolumn" datacolumn="datacolumn" index="0" displayrowcount="10" class="cmb_WF_Essential" position="absolute 3 86 87 109" onitemchanged="cbo_Gbn_onitemchanged"/>
        <Edit id="ed_Item" taborder="3" imemode="hangul" autoselect="true" onkeydown="ed_Item_OnKeyDown" class="edt_WF_Essential" position="absolute 97 86 283 109" tooltiptype="inplace,mouseleave" style="padding:1 20 0 5;"/>
        <Button id="btn_search" taborder="4" tabstop="false" text="검색" onclick="btn_search_OnClick" onkeydown="btn_search_OnKeyDown" class="btn_WF_Find" position="absolute 293 86 348 109"/>
        <CheckBox id="chk_autoList" taborder="9" tabstop="false" text="자동등록" value="1" truevalue="1" falsevalue="0" position="absolute 377 86 463 110"/>
        <Static id="st_Week" text="(월)" position="absolute 918 41 946 62" style="font:Gulim,9,bold;"/>
        <Static id="st_Days" text="(발주 마감 : D-0 00시)" position="absolute 955 41 1112 62" style="font:Gulim,9, bold;"/>
        <Grid id="gd_list" taborder="10" binddataset="ds_List" wheelscrollrow="1" autoenter="select" useinputpanel="false" cellsizingtype="both" cellmovingtype="col" autofittype="col" autofitminwidth="959" nodataimage="URL('theme://images/grd_WF_NoDataImg.png')" onkeydown="gd_list_OnKeyDown" oncellclick="gd_list_OnCellClick" onheadclick="gd_list_OnHeadClick" oncelldblclick="gd_list_OnCellDblClick" position="absolute 0 116 1238 364" anchor="left top right">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="26"/>
                <Column size="85"/>
                <Column size="100"/>
                <Column size="220"/>
                <Column size="120"/>
                <Column size="70"/>
                <Column size="70"/>
                <Column size="100"/>
                <Column size="70"/>
                <Column size="70"/>
                <Column size="0"/>
              </Columns>
              <Rows>
                <Row size="26" band="head"/>
                <Row size="20"/>
              </Rows>
              <Band id="head">
                <Cell class="head_Excel"/>
                <Cell col="1" displaytype="text" text="상품코드"/>
                <Cell col="2" displaytype="text" text="바코드"/>
                <Cell col="3" displaytype="text" text="상품명"/>
                <Cell col="4" displaytype="text" text="규격"/>
                <Cell col="5" displaytype="text" text="단위"/>
                <Cell col="6" displaytype="text" text="보관"/>
                <Cell col="7" displaytype="text" text="단가"/>
                <Cell col="8" displaytype="text" text="과/면세"/>
                <Cell col="9" displaytype="text" text="마감일"/>
                <Cell col="10" displaytype="text" text="g당단가"/>
              </Band>
              <Band id="body">
                <Cell displaytype="image" style="background2: ;" text="expr:fn_SetRowImg(D_DAYS,D_TIMES,WEEK_ITEM_CODE,UNUSE_YN,VAL_STP_YN,PO_STATUS,DANGAWEEK_STATUS)"/>
                <Cell col="1" displaytype="text" style="align:center;background2: ;" text="bind:ITEM_CODE"/>
                <Cell col="2" displaytype="text" style="align:center;background2: ;" text="bind:WIN_ITEM_CD"/>
                <Cell col="3" displaytype="text" style="align:left;background2: ;backgroundimage:EXPR(gfn_isNull(FEATURE_ICON) ? &quot;&quot; : FEATURE_ICON);" text="bind:ITEM_NAME" expr="expr:gfn_isNull(FEATURE_ICON) ? ITEM_NAME : &quot; &quot;.padLeft(11, &quot; &quot;)   +  ITEM_NAME"/>
                <Cell col="4" displaytype="text" style="align:left;background2: ;" text="bind:ITEM_SIZE"/>
                <Cell col="5" displaytype="text" style="align:center;background2: ;" text="bind:PO_UOM"/>
                <Cell col="6" displaytype="text" style="align:center middle;" text="bind:KEEPING_TYPE"/>
                <Cell col="7" displaytype="number" style="background2: ;" text="bind:OP_PRICE_TAX" mask="#,##0"/>
                <Cell col="8" displaytype="text" style="align:center;background2: ;" text="bind:TAX_CODE" expr="expr:decode(TAX_CODE, &quot;100&quot;, &quot;과세&quot;, &quot;210&quot;, &quot;면세&quot;, &quot;영세&quot;)"/>
                <Cell col="9" displaytype="text" style="align:center;background2: ;" text="bind:D_DAY_DISP"/>
                <Cell col="10" displaytype="number" style="background2: ;" text="bind:G_PRICE" mask="#,##0.0"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Grid id="gd_listb" taborder="11" binddataset="ds_Listb" wheelscrollrow="1" autoenter="select" useinputpanel="false" cellsizingtype="both" cellmovingtype="col" autofitminwidth="981" nodataimage="URL('theme://images/grd_WF_NoDataImg.png')" onkeydown="gd_listb_onkeydown" oncellclick="gd_list_oncellclick" onheadclick="gd_list_OnHeadClick1" onselectchanged="gd_list_OnCellPosChanged" position="absolute 0 407 1237 711" anchor="all">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="25"/>
                <Column size="80"/>
                <Column size="120"/>
                <Column size="200"/>
                <Column size="100"/>
                <Column size="0"/>
                <Column size="50"/>
                <Column size="50"/>
                <Column size="80"/>
                <Column size="70"/>
                <Column size="70"/>
                <Column size="70"/>
                <Column size="0"/>
                <Column size="100"/>
                <Column size="80"/>
                <Column size="100"/>
                <Column size="0"/>
                <Column size="120"/>
                <Column size="120"/>
                <Column size="80"/>
                <Column size="70"/>
                <Column size="80"/>
                <Column size="85"/>
                <Column size="140"/>
                <Column size="100"/>
                <Column size="120"/>
                <Column size="100"/>
                <Column size="0"/>
              </Columns>
              <Rows>
                <Row size="26" band="head"/>
                <Row size="20"/>
                <Row size="22" band="summ"/>
              </Rows>
              <Band id="head">
                <Cell displaytype="text" class="head_Excel"/>
                <Cell col="1" displaytype="text" text="상품코드"/>
                <Cell col="2" text="바코드"/>
                <Cell col="3" displaytype="text" text="상품명"/>
                <Cell col="4" displaytype="text" text="규격"/>
                <Cell col="5" displaytype="text" text="원산지"/>
                <Cell col="6" displaytype="text" text="단위"/>
                <Cell col="7" displaytype="text" text="보관"/>
                <Cell col="8" displaytype="text" text="단가"/>
                <Cell col="9" text="박스수량"/>
                <Cell col="10" text="낱개수량"/>
                <Cell col="11" displaytype="text" text="수량총계"/>
                <Cell col="12" text="총중량(㎏)"/>
                <Cell col="13" displaytype="text" text="금액"/>
                <Cell col="14" displaytype="text" text="부가세"/>
                <Cell col="15" displaytype="text" text="합계"/>
                <Cell col="16" text="총중량(㎏)"/>
                <Cell col="17" class="grd_WF_Essential" text="반환유형"/>
                <Cell col="18" displaytype="text" text="비고(50자)"/>
                <Cell col="19" displaytype="text" text="발주상태"/>
                <Cell col="20" displaytype="text" text="마감"/>
                <Cell col="21" displaytype="text" text="마감일"/>
                <Cell col="22" text="업체직송여부"/>
                <Cell col="23" displaytype="text" text="주문번호"/>
                <Cell col="24" displaytype="text" text="발주구분"/>
                <Cell col="25" text="발주시간"/>
                <Cell col="26" displaytype="text" text="최종변경자"/>
                <Cell col="27" text="등록자"/>
              </Band>
              <Band id="body">
                <Cell celltype="head" displaytype="text" style="align:right;backgroundimage:EXPR(expr_GetRowTypeImg(currow));" expr="expr:currow + 1"/>
                <Cell col="1" displaytype="text" style="align:center;background:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));background2:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));" text="bind:itemCode"/>
                <Cell col="2" displaytype="text" style="align:center;background:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));background2:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));" text="bind:winItemCd"/>
                <Cell col="3" displaytype="text" style="align:left;background:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));background2:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));color:EXPR(iif(itemStatus == &quot;E&quot;,&quot;red&quot;,&quot;default&quot;));color2:EXPR(iif(itemStatus == &quot;E&quot;,&quot;red&quot;,&quot;default&quot;));" text="bind:itemName"/>
                <Cell col="4" displaytype="text" style="align:left;background:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));background2:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));" text="bind:itemSize"/>
                <Cell col="5" displaytype="text" style="align:left;background:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));background2:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));" text="bind:originType"/>
                <Cell col="6" displaytype="text" style="align:center;background:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));background2:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));" text="bind:poUom"/>
                <Cell col="7" displaytype="text" style="align:center middle;background:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));background2:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));" text="bind:keepingType"/>
                <Cell col="8" displaytype="number" style="background:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));background2:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));" text="bind:opPriceTax" mask="#,##0"/>
                <Cell col="9" displaytype="number" edittype="expr:setEditExpr(iif((clsStatus=='마감' || itemStatus=='E'),&quot;none&quot;,&quot;masknumber&quot;))" editfilter="expr:setfilterExpr(iif((clsStatus=='마감' || itemStatus=='E'),&quot;none&quot;,&quot;integer&quot;))" style="align:right;background:EXPR(iif(clsStatus=='마감',&quot;thistle&quot;,iif(itemStatus=='E',&quot;white&quot;,&quot;lightyellow&quot;)));background2:EXPR(iif(clsStatus=='마감',&quot;thistle&quot;,iif(itemStatus=='E',&quot;white&quot;,&quot;lightyellow&quot;)));" text="bind:prBoxQty" mask="#,##0" editautoselect="true"/>
                <Cell col="10" displaytype="number" edittype="expr:setEditExpr(iif((clsStatus=='마감' || itemStatus=='E'),&quot;none&quot;,&quot;number&quot;))" style="align:right;background:EXPR(iif(clsStatus=='마감',&quot;thistle&quot;,iif(itemStatus=='E',&quot;white&quot;,&quot;lightyellow&quot;)));background2:EXPR(iif(clsStatus=='마감',&quot;thistle&quot;,iif(itemStatus=='E',&quot;white&quot;,&quot;lightyellow&quot;)));" text="bind:prPcQty" mask="#,##0.0" editautoselect="true"/>
                <Cell col="11" displaytype="number" style="background:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));background2:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));color:EXPR(iif(prQty&lt;minOrdQty,&quot;red&quot;,&quot;default&quot;));color2:EXPR(iif(prQty&lt;minOrdQty,&quot;red&quot;,&quot;default&quot;));" text="bind:prQty" mask="#,##0.0"/>
                <Cell col="12" displaytype="number" style="background:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));background2:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));color2: ;" text="bind:totWght" mask="#,##0.0"/>
                <Cell col="13" displaytype="number" style="background:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));background2:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));" text="bind:opAmount" mask="#,##0"/>
                <Cell col="14" displaytype="number" style="background:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));background2:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));" expr="expr:Math.round(iif(taxCode==&quot;100&quot;,0.1,0)* opAmount)" mask="#,##0"/>
                <Cell col="15" displaytype="number" style="background:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));background2:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));" expr="expr:Math.round(iif(taxCode==&quot;100&quot;,1.1,1)* opAmount)" mask="#,##0"/>
                <Cell col="16" displaytype="number" style="background:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));background2:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));" text="bind:totWght" mask="#,##0.0#"/>
                <Cell col="17" displaytype="combo" edittype="expr:setEditExpr(iif((clsStatus=='마감' || itemStatus=='E'),&quot;none&quot;,&quot;combo&quot;))" style="background:EXPR(iif(clsStatus=='마감',&quot;thistle&quot;,iif(itemStatus=='E',&quot;white&quot;,&quot;lightyellow&quot;)));background2:EXPR(iif(clsStatus=='마감',&quot;thistle&quot;,iif(itemStatus=='E',&quot;white&quot;,&quot;lightyellow&quot;)));" text="bind:rtnOrdType" combodataset="ds_rtnOrdType" combocodecol="code" combodatacol="codeName"/>
                <Cell col="18" displaytype="text" edittype="expr:setEditExpr(iif((clsStatus=='마감' || itemStatus=='E'),&quot;none&quot;,&quot;normal&quot;))" editfilter="expr:setfilterExpr(iif((clsStatus=='마감' || itemStatus=='E'),&quot;none&quot;,&quot;normal&quot;))" style="align:left;background:EXPR(iif(clsStatus=='마감',&quot;thistle&quot;,iif(itemStatus=='E',&quot;white&quot;,&quot;lightyellow&quot;)));background2:EXPR(iif(clsStatus=='마감',&quot;thistle&quot;,iif(itemStatus=='E',&quot;white&quot;,&quot;lightyellow&quot;)));" text="bind:prRemark" editlimit="100" editimemode="native" editautoselect="true"/>
                <Cell col="19" style="align:center;background:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));background2:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));" text="bind:poLineStatus"/>
                <Cell col="20" displaytype="text" style="align:center;background:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));background2:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));" text="bind:clsStatus"/>
                <Cell col="21" displaytype="text" style="align:center;background:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));background2:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));" text="bind:dDayDisp"/>
                <Cell col="22" style="background:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));background2:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));" text="bind:vcYn"/>
                <Cell col="23" displaytype="text" style="align:center;background:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));background2:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));" text="bind:prNum"/>
                <Cell col="24" displaytype="text" style="align:center;background:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));background2:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));" text="bind:docuSource"/>
                <Cell col="25" style="background:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));background2:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));" text="bind:approveTime"/>
                <Cell col="26" displaytype="text" style="align:center;background:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));background2:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));color:EXPR(iif(itemStatus == &quot;E&quot;,&quot;red&quot;,&quot;default&quot;));color2:EXPR(iif(itemStatus == &quot;E&quot;,&quot;red&quot;,&quot;default&quot;));" text="bind:updateByNm"/>
                <Cell col="27" style="background:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));background2:EXPR(iif(clsStatus==&quot;마감&quot;,&quot;thistle&quot;,&quot;white&quot;));" text="bind:createBy"/>
              </Band>
              <Band id="summary">
                <Cell displaytype="text" style="align:left;"/>
                <Cell col="1" displaytype="text" style="align:center;" text="합  계"/>
                <Cell col="2"/>
                <Cell col="3" displaytype="number" style="align: ;" expr="expr:getCaseCount(&quot;prQty&gt;0&quot;)" mask="#,##0"/>
                <Cell col="4" displaytype="text" style="align:left;" text="건"/>
                <Cell col="5" displaytype="text" style="align:left;"/>
                <Cell col="6" displaytype="text" style="align:left;"/>
                <Cell col="7" displaytype="text" style="align:left;"/>
                <Cell col="8" displaytype="number" style="align:right middle;" expr="expr:getSum(&quot;opPriceTax&quot;)" mask="#,##0"/>
                <Cell col="9" displaytype="number" expr="expr:getSum(&quot;prBoxQty&quot;)" mask="#,##0"/>
                <Cell col="10" displaytype="number" expr="expr:getSum(&quot;prPcQty&quot;)" mask="#,##0.0"/>
                <Cell col="11" displaytype="number" style="align: ;" expr="expr:getSum(&quot;prQty&quot;)" mask="#,##0.0"/>
                <Cell col="12" displaytype="number" expr="expr:getSum(&quot;totWght&quot;)" mask="#,##0.0"/>
                <Cell col="13" displaytype="number" style="align: ;" expr="expr:getSum(&quot;opAmount&quot;)" mask="#,##0"/>
                <Cell col="14" displaytype="number" style="align: ;" expr="expr:getCaseSum(&quot;taxCode=='100'&quot;,&quot;Math.round(opAmount/10)&quot;)" mask="#,##0"/>
                <Cell col="15" displaytype="number" style="align: ;" expr="expr:getSum(&quot;Math.round(iif(taxCode=='100',1.1,1)* opAmount)&quot;)" mask="#,##0"/>
                <Cell col="16"/>
                <Cell col="17"/>
                <Cell col="18" displaytype="text" style="align:left;"/>
                <Cell col="19" displaytype="text" style="align:left;"/>
                <Cell col="20" displaytype="text" style="align:left;"/>
                <Cell col="21" displaytype="text" style="align:left;"/>
                <Cell col="22"/>
                <Cell col="23" displaytype="text" style="align:left;"/>
                <Cell col="24" displaytype="text" style="align:left;"/>
                <Cell col="25"/>
                <Cell col="26"/>
                <Cell col="27"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <ProgressBar id="pgb_order" taborder="12" text="처리중..( 65% )" max="100" min="0" pos="65" blockgap="0" visible="false" position="absolute 1072 810 1248 828"/>
        <Static id="sta_rtnOrdType" text="반환유형" class="sta_WFSA_label" position="absolute 990 390 1050 402" anchor="top right" visible="true"/>
        <Combo id="cbo_rtnOrdType" taborder="13" innerdataset="@ds_rtnOrdTypeAllChg" displayrowcount="10" position="absolute 1056 385 1176 405" anchor="top right" index="-1" codecolumn="code" datacolumn="codeName" visible="true"/>
        <Button id="btn_rtnOrdTypeAllChg" taborder="14" position="absolute 1180 385 1237 405" text="일괄적용" anchor="top right" onclick="btn_rtnOrdTypeAllChg_onclick" class="btn_WF_Custom" visible="true"/>
        <CheckBox id="chk_Only" taborder="15" tabstop="false" text="주문가능 상품" value="1" truevalue="1" falsevalue="0" position="absolute 471 85 580 109" visible="false"/>
        <Splitter id="sp_line" type="vertical" class="spt_WF_2" position="absolute 0 364 1237 375" anchor="left top right" onmove="sp_line_onmove">
          <Formats>
            <Format id="default">
              <SplitterItems id="items">
                <SplitterItem id="item00" position="leftortop" bindtype="resize" componentid="gd_list"/>
                <SplitterItem id="item01" bindtype="move" position="rightorbottom" offset="4" componentid="btn_rtnOrdTypeAllChg"/>
                <SplitterItem id="item02" bindtype="move" position="rightorbottom" offset="4" componentid="cbo_rtnOrdType"/>
                <SplitterItem id="item03" bindtype="move" position="rightorbottom" offset="4" componentid="sta_rtnOrdType"/>
                <SplitterItem id="item04" bindtype="move" position="rightorbottom" offset="4" componentid="Static44"/>
                <SplitterItem id="item05" bindtype="move" position="rightorbottom" offset="4" componentid="Static2"/>
                <SplitterItem id="item06" bindtype="resize" position="rightorbottom" offset="30" componentid="gd_listb"/>
              </SplitterItems>
            </Format>
          </Formats>
        </Splitter>
      </Layout>
    </Layouts>
    <Bind/>
    <Objects>
      <Dataset id="ds_List" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CENTER_CODE" size="22" type="INT"/>
          <Column id="CENTER_FLAG" size="1" type="STRING"/>
          <Column id="CLS_STATUS" size="50" type="STRING"/>
          <Column id="CUSTCD" size="22" type="INT"/>
          <Column id="INVAT_FLAG" size="1" type="STRING"/>
          <Column id="ITEM_CODE" size="50" type="STRING"/>
          <Column id="ITEM_NAME" size="200" type="STRING"/>
          <Column id="ITEM_SIZE" size="100" type="STRING"/>
          <Column id="LINE_STATUS" size="50" type="STRING"/>
          <Column id="MARGIN_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="MIN_ORD_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="MAX_ORD_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="MULTIPLIER_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="NEED_DATE" size="8" type="STRING"/>
          <Column id="OTCUSTCD" size="50" type="STRING"/>
          <Column id="OUTVAT_FLAG" size="1" type="STRING"/>
          <Column id="PO_UOM" size="10" type="STRING"/>
          <Column id="POINT_FLAG" size="1" type="STRING"/>
          <Column id="PR_QTY" size="22" type="BIGDECIMAL"/>
          <Column id="PR_REMARK" size="300" type="STRING"/>
          <Column id="PR_UPJANG" size="22" type="INT"/>
          <Column id="RC_UPJANG" size="22" type="INT"/>
          <Column id="SALE_AMOUNT" size="22" type="BIGDECIMAL"/>
          <Column id="SALE_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="SUBINV_CODE" size="8" type="STRING"/>
          <Column id="TAX_CODE" size="3" type="STRING"/>
          <Column id="UNIT_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="OP_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="OP_AMOUNT" size="22" type="BIGDECIMAL"/>
          <Column id="G_PRICE" size="22" type="BIGDECIMAL"/>
          <Column id="D_DAYS" size="4" type="INT"/>
          <Column id="D_DAY_DISP" size="50" type="STRING"/>
          <Column id="D_TIMES" size="4" type="INT"/>
          <Column id="OTCUSTNM" size="100" type="STRING"/>
          <Column id="KG_CONVERT_RATE" size="22" type="BIGDECIMAL"/>
          <Column id="FEATURE_NAME" size="100" type="STRING"/>
          <Column id="IMAGE_PATH" size="200" type="STRING"/>
          <Column id="LIMIT_ITEM" size="50" type="STRING"/>
          <Column id="LIMIT_REASON" size="300" type="STRING"/>
          <Column id="WEEK_ITEM_CODE" size="300" type="STRING"/>
          <Column id="CONSUM_YN" size="1" type="STRING"/>
          <Column id="IMAGE_YN" size="2" type="STRING"/>
          <Column id="KEEPING_TYPE" type="STRING" size="256"/>
          <Column id="APPLY_SD" type="STRING" size="256"/>
          <Column id="VD_SN" type="STRING" size="256"/>
          <Column id="ORIGIN_TYPE" type="STRING" size="256"/>
          <Column id="MOBILE_GUBUN" type="STRING" size="256"/>
          <Column id="MAX_SO_QTY" type="STRING" size="256"/>
          <Column id="UPJANG_GRP" type="STRING" size="256"/>
          <Column id="OP_RATE" type="STRING" size="256"/>
          <Column id="UNUSE_YN" type="STRING" size="256"/>
          <Column id="VAL_STP_YN" type="STRING" size="256"/>
          <Column id="WIN_ITEM_CD" type="STRING" size="256"/>
          <Column id="OP_PRICE_TAX" size="22" type="BIGDECIMAL"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_Listb" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" cancolumnchange="ds_List_CanColumnChange" oncolumnchanged="ds_List_OnColumnChanged">
        <ColumnInfo>
          <Column id="centerCode" size="22" prop="default" type="INT"/>
          <Column id="centerFlag" size="1" prop="default" type="STRING"/>
          <Column id="clsStatus" size="50" prop="default" type="STRING"/>
          <Column id="custcd" size="22" prop="default" type="INT"/>
          <Column id="invatFlag" size="1" prop="default" type="STRING"/>
          <Column id="itemCode" size="50" prop="default" type="STRING"/>
          <Column id="itemName" size="200" prop="default" type="STRING"/>
          <Column id="itemSize" size="100" prop="default" type="STRING"/>
          <Column id="lineStatus" size="50" prop="default" type="STRING"/>
          <Column id="marginPrice" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="minOrdQty" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="maxOrdQty" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="multiplierQty" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="needDate" size="8" prop="default" type="STRING"/>
          <Column id="otcustcd" size="50" prop="default" type="STRING"/>
          <Column id="outvatFlag" size="1" prop="default" type="STRING"/>
          <Column id="poUom" size="10" prop="default" type="STRING"/>
          <Column id="pointFlag" size="1" prop="default" type="STRING"/>
          <Column id="prId" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="prNum" size="50" prop="default" type="STRING"/>
          <Column id="prQty" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="prRemark" size="300" prop="default" type="STRING"/>
          <Column id="prUpjang" size="22" prop="default" type="INT"/>
          <Column id="rcUpjang" size="22" prop="default" type="INT"/>
          <Column id="saleAmount" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="salePrice" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="subinvCode" size="8" prop="default" type="STRING"/>
          <Column id="taxCode" size="3" prop="default" type="STRING"/>
          <Column id="unitPrice" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="opPrice" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="opAmount" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="dDays" size="4" prop="default" type="BIGDECIMAL"/>
          <Column id="dTimes" size="4" prop="default" type="BIGDECIMAL"/>
          <Column id="dDayDisp" size="200" prop="default" type="STRING"/>
          <Column id="imagePath" size="200" prop="default" type="STRING"/>
          <Column id="opAmountOld" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="docuSource" size="256" prop="default" type="STRING"/>
          <Column id="keepingType" type="STRING" size="256"/>
          <Column id="applySd" type="STRING" size="256"/>
          <Column id="vdSn" type="STRING" size="256"/>
          <Column id="mobileGubun" type="STRING" size="256"/>
          <Column id="originType" type="STRING" size="256"/>
          <Column id="maxSoQty" type="STRING" size="256"/>
          <Column id="upjangGrp" type="STRING" size="256"/>
          <Column id="poLineStatus" type="STRING" size="256"/>
          <Column id="opRate" type="STRING" size="256"/>
          <Column id="approveTime" type="STRING" size="256"/>
          <Column id="createBy" type="STRING" size="256"/>
          <Column id="prRemarkRecent" type="STRING" size="256"/>
          <Column id="tOrder" type="STRING" size="256"/>
          <Column id="kgConvertRate" type="STRING" size="256"/>
          <Column id="uomConvertRate" type="STRING" size="256"/>
          <Column id="totWght" type="STRING" size="256"/>
          <Column id="vcYn" type="STRING" size="256"/>
          <Column id="winItemCd" type="STRING" size="256"/>
          <Column id="prBoxQty" type="BIGDECIMAL" size="256"/>
          <Column id="prPcQty" type="BIGDECIMAL" size="256"/>
          <Column id="eventId" type="BIGDECIMAL" size="256"/>
          <Column id="boxQty" type="BIGDECIMAL" size="256"/>
          <Column id="inputType" type="STRING" size="256"/>
          <Column id="itemStatus" type="STRING" size="256"/>
          <Column id="weekItemCode" type="STRING" size="256"/>
          <Column id="limitItem" type="STRING" size="256"/>
          <Column id="limitReason" type="STRING" size="256"/>
          <Column id="unuseYn" type="STRING" size="256"/>
          <Column id="valStpYn" type="STRING" size="256"/>
          <Column id="dangaweekStatus" type="STRING" size="256"/>
          <Column id="consumYn" type="STRING" size="256"/>
          <Column id="approveNum" type="STRING" size="256"/>
          <Column id="opPriceS" type="STRING" size="256"/>
          <Column id="rtnOrdType" type="STRING" size="256"/>
          <Column id="sNeedDate" type="STRING" size="256"/>
          <Column id="gUpjang" type="STRING" size="256"/>
          <Column id="tabName" type="STRING" size="256"/>
          <Column id="opPriceTax" size="22" prop="default" type="BIGDECIMAL"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_Cond">
        <ColumnInfo>
          <Column id="ITEM_NAME" size="100" type="STRING"/>
          <Column id="NEED_DATE" size="8" type="STRING"/>
          <Column id="UPJANG" size="22" type="INT"/>
          <Column id="SUBINV_CODE" size="8" type="STRING"/>
          <Column id="CONSUM_YN" size="1" type="STRING"/>
          <Column id="QTY_CONTROL_YN" size="1" type="STRING"/>
          <Column id="CENTER_CODE" size="22" type="INT"/>
          <Column id="AP_UNITPRICE_UPJANG" size="22" type="INT"/>
          <Column id="OTCUST_PRICE_UPJANG" size="22" type="INT"/>
          <Column id="FAVOR_GROUP" size="50" type="STRING"/>
          <Column id="NEED_DATEP" size="8" type="STRING"/>
          <Column id="UPJANGP" size="22" type="INT"/>
          <Column id="SUBINV_CODEP" size="8" type="STRING"/>
          <Column id="ITEM_CLASS2" size="8" type="STRING"/>
          <Column id="ITEM_CLASS3" size="8" type="STRING"/>
          <Column id="ITEM_CLASS4" size="8" type="STRING"/>
          <Column id="ITEM_CODE" size="256" type="STRING"/>
          <Column id="NEED_DATET" type="STRING" size="256"/>
          <Column id="UPJANGT" type="STRING" size="256"/>
          <Column id="SUBINV_CODET" type="STRING" size="256"/>
          <Column id="GBN" type="STRING" size="256"/>
          <Column id="TAB_NAME" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_Subinv">
        <ColumnInfo>
          <Column id="SUBINV_CODE" size="8" type="STRING"/>
          <Column id="SUBINV_NAME_DISP" size="100" type="STRING"/>
          <Column id="CONSUM_YN" size="1" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_searchGbn" useclientlayout="true">
        <ColumnInfo>
          <Column id="codecolumn" type="STRING" size="255"/>
          <Column id="datacolumn" type="STRING" size="255"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="codecolumn">88</Col>
            <Col id="datacolumn">바코드</Col>
          </Row>
          <Row>
            <Col id="datacolumn">상품코드</Col>
            <Col id="codecolumn">ITEM_CODE</Col>
          </Row>
          <Row>
            <Col id="datacolumn">상품명</Col>
            <Col id="codecolumn">ITEM_NAME</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_Days">
        <ColumnInfo>
          <Column id="D_DAYS" size="22" type="INT"/>
          <Column id="D_TIMES" size="4" type="STRING"/>
          <Column id="DAYS" size="50" type="STRING"/>
          <Column id="D_OVER_DAYS" size="22" type="INT"/>
          <Column id="QTY_CONTROL_YN" size="1" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_CtUpj">
        <ColumnInfo>
          <Column id="AP_UNITPRICE_UPJANG" size="22" type="INT"/>
          <Column id="CENTER_CODE" size="22" type="INT"/>
          <Column id="OTCUST_PRICE_UPJANG" size="22" type="INT"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_OrdCtrl">
        <ColumnInfo>
          <Column id="CTRL_TYPE" size="50" type="STRING"/>
          <Column id="FRI" size="1" type="STRING"/>
          <Column id="ITEM_TYPE" size="50" type="STRING"/>
          <Column id="MON" size="1" type="STRING"/>
          <Column id="SAT" size="1" type="STRING"/>
          <Column id="SUN" size="1" type="STRING"/>
          <Column id="THU" size="1" type="STRING"/>
          <Column id="TUE" size="1" type="STRING"/>
          <Column id="WED" size="1" type="STRING"/>
          <Column id="CHK_TYPE" size="100" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_ListCheck" cancolumnchange="ds_List_CanColumnChange" oncolumnchanged="ds_List_OnColumnChanged">
        <ColumnInfo>
          <Column id="CENTER_CODE" size="22" prop="default" type="INT"/>
          <Column id="CENTER_FLAG" size="1" prop="default" type="STRING"/>
          <Column id="CLS_STATUS" size="50" prop="default" type="STRING"/>
          <Column id="CUSTCD" size="22" prop="default" type="INT"/>
          <Column id="INVAT_FLAG" size="1" prop="default" type="STRING"/>
          <Column id="ITEM_CODE" size="50" prop="default" type="STRING"/>
          <Column id="ITEM_NAME" size="200" prop="default" type="STRING"/>
          <Column id="ITEM_SIZE" size="100" prop="default" type="STRING"/>
          <Column id="LINE_STATUS" size="50" prop="default" type="STRING"/>
          <Column id="MARGIN_PRICE" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="MIN_ORD_QTY" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="MAX_ORD_QTY" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="MULTIPLIER_QTY" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="NEED_DATE" size="8" prop="default" type="STRING"/>
          <Column id="OTCUSTCD" size="50" prop="default" type="STRING"/>
          <Column id="OUTVAT_FLAG" size="1" prop="default" type="STRING"/>
          <Column id="PO_UOM" size="10" prop="default" type="STRING"/>
          <Column id="POINT_FLAG" size="1" prop="default" type="STRING"/>
          <Column id="PR_ID" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="PR_NUM" size="50" prop="default" type="STRING"/>
          <Column id="PR_QTY" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="PR_REMARK" size="300" prop="default" type="STRING"/>
          <Column id="PR_UPJANG" size="22" prop="default" type="INT"/>
          <Column id="RC_UPJANG" size="22" prop="default" type="INT"/>
          <Column id="SALE_AMOUNT" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="SALE_PRICE" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="SUBINV_CODE" size="8" prop="default" type="STRING"/>
          <Column id="TAX_CODE" size="3" prop="default" type="STRING"/>
          <Column id="UNIT_PRICE" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="OP_PRICE" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="OP_AMOUNT" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="D_DAYS" size="4" prop="default" type="BIGDECIMAL"/>
          <Column id="D_TIMES" size="4" prop="default" type="BIGDECIMAL"/>
          <Column id="D_DAY_DISP" size="200" prop="default" type="STRING"/>
          <Column id="IMAGE_PATH" size="200" prop="default" type="STRING"/>
          <Column id="OP_AMOUNT_OLD" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="DOCU_SOURCE" size="256" prop="default" type="STRING"/>
          <Column id="KEEPING_TYPE" type="STRING" size="256"/>
          <Column id="APPLY_SD" type="STRING" size="256"/>
          <Column id="VD_SN" type="STRING" size="256"/>
          <Column id="MOBILE_GUBUN" type="STRING" size="256"/>
          <Column id="ORIGIN_TYPE" type="STRING" size="256"/>
          <Column id="MAX_SO_QTY" type="STRING" size="256"/>
          <Column id="UPJANG_GRP" type="STRING" size="256"/>
          <Column id="PO_LINE_STATUS" type="STRING" size="256"/>
          <Column id="OP_RATE" type="STRING" size="256"/>
          <Column id="APPROVE_TIME" type="STRING" size="256"/>
          <Column id="CREATE_BY" type="STRING" size="256"/>
          <Column id="PR_REMARK_RECENT" type="STRING" size="256"/>
          <Column id="T_ORDER" type="STRING" size="256"/>
          <Column id="OP_PRICE_TAX" size="22" prop="default" type="BIGDECIMAL"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_BarcodeCond">
        <ColumnInfo>
          <Column id="ITEM_NAME" size="100" type="STRING"/>
          <Column id="NEED_DATE" size="8" type="STRING"/>
          <Column id="UPJANG" size="22" type="INT"/>
          <Column id="SUBINV_CODE" size="8" type="STRING"/>
          <Column id="CONSUM_YN" size="1" type="STRING"/>
          <Column id="QTY_CONTROL_YN" size="1" type="STRING"/>
          <Column id="CENTER_CODE" size="22" type="INT"/>
          <Column id="AP_UNITPRICE_UPJANG" size="22" type="INT"/>
          <Column id="OTCUST_PRICE_UPJANG" size="22" type="INT"/>
          <Column id="FAVOR_GROUP" size="50" type="STRING"/>
          <Column id="NEED_DATEP" size="8" type="STRING"/>
          <Column id="UPJANGP" size="22" type="INT"/>
          <Column id="SUBINV_CODEP" size="8" type="STRING"/>
          <Column id="ITEM_CLASS2" size="8" type="STRING"/>
          <Column id="ITEM_CLASS3" size="8" type="STRING"/>
          <Column id="ITEM_CLASS4" size="8" type="STRING"/>
          <Column id="ITEM_CODE" size="256" type="STRING"/>
          <Column id="NEED_DATET" type="STRING" size="256"/>
          <Column id="UPJANGT" type="STRING" size="256"/>
          <Column id="SUBINV_CODET" type="STRING" size="256"/>
          <Column id="GBN" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_Barcode" useclientlayout="true">
        <ColumnInfo>
          <Column id="BARCODE" type="STRING" size="256"/>
          <Column id="ITEM_STATUS" type="STRING" size="256"/>
          <Column id="ROW" type="INT" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_BarcodeResult">
        <ColumnInfo>
          <Column id="ITEM_CODE" type="STRING" size="50"/>
          <Column id="ITEM_NAME" type="STRING" size="1202"/>
          <Column id="ITEM_SIZE" type="STRING" size="2000"/>
          <Column id="PO_UOM" type="STRING" size="36"/>
          <Column id="UNIT_PRICE" type="BIGDECIMAL" size="22"/>
          <Column id="MARGIN_PRICE" type="BIGDECIMAL" size="22"/>
          <Column id="SALE_PRICE" type="BIGDECIMAL" size="22"/>
          <Column id="PR_QTY" type="BIGDECIMAL" size="39"/>
          <Column id="SALE_AMOUNT" type="BIGDECIMAL" size="39"/>
          <Column id="LINE_STATUS" type="STRING" size="3"/>
          <Column id="CLS_STATUS" type="STRING" size="6"/>
          <Column id="PR_REMARK" type="STRING" size="255"/>
          <Column id="SUBINV_CODE" type="STRING" size="32"/>
          <Column id="NEED_DATE" type="STRING" size="32"/>
          <Column id="PRE_NEED_DATE" type="STRING" size="255"/>
          <Column id="TAX_CODE" type="STRING" size="3"/>
          <Column id="CUSTCD" type="BIGDECIMAL" size="39"/>
          <Column id="CENTER_FLAG" type="STRING" size="10"/>
          <Column id="CENTER_CODE" type="STRING" size="6"/>
          <Column id="POINT_FLAG" type="STRING" size="1"/>
          <Column id="PR_UPJANG" type="STRING" size="32"/>
          <Column id="RC_UPJANG" type="STRING" size="32"/>
          <Column id="INVAT_FLAG" type="STRING" size="1"/>
          <Column id="OUTVAT_FLAG" type="STRING" size="1"/>
          <Column id="MIN_ORD_QTY" type="BIGDECIMAL" size="39"/>
          <Column id="MAX_ORD_QTY" type="BIGDECIMAL" size="39"/>
          <Column id="MULTIPLIER_QTY" type="BIGDECIMAL" size="39"/>
          <Column id="OTCUSTCD" type="STRING" size="50"/>
          <Column id="OP_RATE" type="BIGDECIMAL" size="39"/>
          <Column id="OP_AMOUNT_OLD" type="BIGDECIMAL" size="39"/>
          <Column id="D_DAYS" type="BIGDECIMAL" size="39"/>
          <Column id="D_TIMES" type="BIGDECIMAL" size="39"/>
          <Column id="D_DAY_DISP" type="STRING" size="42"/>
          <Column id="OTCUSTNM" type="STRING" size="100"/>
          <Column id="KG_CONVERT_RATE" type="BIGDECIMAL" size="39"/>
          <Column id="FEATURE_NAME_CHK" type="STRING" size="255"/>
          <Column id="IMAGE_PATH" type="STRING" size="1512"/>
          <Column id="IMAGE_YN" type="STRING" size="1"/>
          <Column id="CONSUM_YN" type="STRING" size="1"/>
          <Column id="PR_ID" type="STRING" size="255"/>
          <Column id="KEEPING_TYPE" type="STRING" size="120"/>
          <Column id="APPLY_SD" type="STRING" size="8"/>
          <Column id="VD_SN" type="STRING" size="50"/>
          <Column id="ORIGIN_TYPE" type="STRING" size="120"/>
          <Column id="MOBILE_GUBUN" type="STRING" size="1"/>
          <Column id="UPJANG_GRP" type="STRING" size="18"/>
          <Column id="PO_STATUS" type="STRING" size="4000"/>
          <Column id="UNUSE_YN" type="STRING" size="4000"/>
          <Column id="VAL_STP_YN" type="STRING" size="4000"/>
          <Column id="FMP_STATUS" type="STRING" size="4000"/>
          <Column id="PO_WEEK_STATUS" type="STRING" size="4000"/>
          <Column id="DANGA_ITEM_CODE" type="STRING" size="255"/>
          <Column id="UOM_CONVERT_RATE" type="BIGDECIMAL" size="39"/>
          <Column id="TOT_WGHT" type="STRING" size="255"/>
          <Column id="FAVOR_GROUP_FLAG" type="STRING" size="50"/>
          <Column id="WIN_ITEM_CD" type="STRING" size="60"/>
          <Column id="EVENT_PRICE" type="BIGDECIMAL" size="39"/>
          <Column id="MAX_SO_QTY" type="BIGDECIMAL" size="39"/>
          <Column id="TOT_SO_AMT" type="BIGDECIMAL" size="39"/>
          <Column id="WEEK_ITEM_CODE" type="STRING" size="50"/>
          <Column id="DANGAWEEK_STATUS" type="STRING" size="2"/>
          <Column id="BOX_QTY" type="BIGDECIMAL" size="39"/>
          <Column id="OP_PRICE" type="BIGDECIMAL" size="39"/>
          <Column id="OP_AMOUNT" type="BIGDECIMAL" size="39"/>
          <Column id="G_PRICE" type="BIGDECIMAL" size="39"/>
          <Column id="EVENT_ID" type="BIGDECIMAL" size="39"/>
          <Column id="FEATURE_ICON" type="STRING" size="36"/>
          <Column id="FEATURE_NAME" type="STRING" size="8"/>
          <Column id="OP_PRICE_TAX" type="BIGDECIMAL" size="39"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_delListb" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="false" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="centerCode" size="22" prop="default" type="INT"/>
          <Column id="centerFlag" size="1" prop="default" type="STRING"/>
          <Column id="clsStatus" size="50" prop="default" type="STRING"/>
          <Column id="custcd" size="22" prop="default" type="INT"/>
          <Column id="invatFlag" size="1" prop="default" type="STRING"/>
          <Column id="itemCode" size="50" prop="default" type="STRING"/>
          <Column id="itemName" size="200" prop="default" type="STRING"/>
          <Column id="itemSize" size="100" prop="default" type="STRING"/>
          <Column id="lineStatus" size="50" prop="default" type="STRING"/>
          <Column id="marginPrice" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="minOrdQty" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="maxOrdQty" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="multiplierQty" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="needDate" size="8" prop="default" type="STRING"/>
          <Column id="otcustcd" size="50" prop="default" type="STRING"/>
          <Column id="outvatFlag" size="1" prop="default" type="STRING"/>
          <Column id="poUom" size="10" prop="default" type="STRING"/>
          <Column id="pointFlag" size="1" prop="default" type="STRING"/>
          <Column id="prId" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="prNum" size="50" prop="default" type="STRING"/>
          <Column id="prQty" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="prRemark" size="300" prop="default" type="STRING"/>
          <Column id="prUpjang" size="22" prop="default" type="INT"/>
          <Column id="rcUpjang" size="22" prop="default" type="INT"/>
          <Column id="saleAmount" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="salePrice" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="subinvCode" size="8" prop="default" type="STRING"/>
          <Column id="taxCode" size="3" prop="default" type="STRING"/>
          <Column id="unitPrice" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="opPrice" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="opAmount" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="dDays" size="4" prop="default" type="BIGDECIMAL"/>
          <Column id="dTimes" size="4" prop="default" type="BIGDECIMAL"/>
          <Column id="dDayDisp" size="200" prop="default" type="STRING"/>
          <Column id="imagePath" size="200" prop="default" type="STRING"/>
          <Column id="opAmountOld" size="22" prop="default" type="BIGDECIMAL"/>
          <Column id="docuSource" size="256" prop="default" type="STRING"/>
          <Column id="keepingType" type="STRING" size="256"/>
          <Column id="applySd" type="STRING" size="256"/>
          <Column id="vdSn" type="STRING" size="256"/>
          <Column id="mobileGubun" type="STRING" size="256"/>
          <Column id="originType" type="STRING" size="256"/>
          <Column id="maxSoQty" type="STRING" size="256"/>
          <Column id="upjangGrp" type="STRING" size="256"/>
          <Column id="poLineStatus" type="STRING" size="256"/>
          <Column id="opRate" type="STRING" size="256"/>
          <Column id="approveTime" type="STRING" size="256"/>
          <Column id="createBy" type="STRING" size="256"/>
          <Column id="prRemarkRecent" type="STRING" size="256"/>
          <Column id="tOrder" type="STRING" size="256"/>
          <Column id="kgConvertRate" type="STRING" size="256"/>
          <Column id="uomConvertRate" type="STRING" size="256"/>
          <Column id="totWght" type="STRING" size="256"/>
          <Column id="vcYn" type="STRING" size="256"/>
          <Column id="winItemCd" type="STRING" size="256"/>
          <Column id="prBoxQty" type="BIGDECIMAL" size="256"/>
          <Column id="prPcQty" type="BIGDECIMAL" size="256"/>
          <Column id="eventId" type="BIGDECIMAL" size="256"/>
          <Column id="boxQty" type="BIGDECIMAL" size="256"/>
          <Column id="inputType" type="STRING" size="256"/>
          <Column id="itemStatus" type="STRING" size="256"/>
          <Column id="weekItemCode" type="STRING" size="256"/>
          <Column id="limitItem" type="STRING" size="256"/>
          <Column id="limitReason" type="STRING" size="256"/>
          <Column id="unuseYn" type="STRING" size="256"/>
          <Column id="valStpYn" type="STRING" size="256"/>
          <Column id="dangaweekStatus" type="STRING" size="256"/>
          <Column id="consumYn" type="STRING" size="256"/>
          <Column id="approveNum" type="STRING" size="256"/>
          <Column id="opPriceS" type="STRING" size="256"/>
          <Column id="rtnOrdType" type="STRING" size="256"/>
          <Column id="sNeedDate" type="STRING" size="256"/>
          <Column id="gUpjang" type="STRING" size="256"/>
          <Column id="tabName" type="STRING" size="256"/>
          <Column id="opPriceTax" size="22" prop="default" type="BIGDECIMAL"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_rtnOrdType" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="code" type="STRING" size="256"/>
          <Column id="codeName" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_rtnOrderYn" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="rtnYn" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_WeekendTime">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="256"/>
          <Column id="CODE_NAME" type="STRING" size="256"/>
          <Column id="USE_YN" type="STRING" size="256"/>
          <Column id="SET1" type="STRING" size="256"/>
          <Column id="SET2" type="STRING" size="256"/>
          <Column id="SET3" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_common" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="code" type="STRING" size="256"/>
          <Column id="codename" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_msg" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="NO" type="STRING" size="256"/>
          <Column id="TYPE" type="STRING" size="256"/>
          <Column id="MSG" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_msg_out" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="NO" type="STRING" size="256"/>
          <Column id="TYPE" type="STRING" size="256"/>
          <Column id="MSG" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_ListbValid" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" cancolumnchange="ds_List_CanColumnChange" oncolumnchanged="ds_List_OnColumnChanged">
        <ColumnInfo>
          <Column id="rtnOrdType" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="rtnOrdType">title:반환유형,required:true</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_needDateList" useclientlayout="true">
        <ColumnInfo>
          <Column id="rcUpjang" type="STRING" size="256"/>
          <Column id="needDate" type="STRING" size="256"/>
          <Column id="needDateDesc" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_needDateChkList" useclientlayout="true">
        <ColumnInfo>
          <Column id="rcUpjang" type="STRING" size="256"/>
          <Column id="needDate" type="STRING" size="256"/>
          <Column id="needDateDesc" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_rtnOrdTypeAllChg" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="code" type="STRING" size="256"/>
          <Column id="codeName" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Script type="xscript4.0"><![CDATA[/*
  화 면 명 : ReturnOrderByCust
  파 일 명 : ReturnOrderByCust.xfdl
  기    능 : 반환발주(브랜드)

    수정일    수정자                  수정내용
  ----------   -------  --------------------------------------------------
  2021.09.XX   Jaey      최초 생성  
  
*/

/************************************************************************************************
 * 공통 라이브러리 INCLUDE 영역 (필수)
************************************************************************************************/
include "lib::lib_com.xjs";
include "U_lib::lib_conversionCom.xjs";
//=========================================================================================
// [ PART 1 ]
// Form에서 Include 할 내용을 정의
//
//=========================================================================================
//@@컨버터에서 주석처리 #include "lib::sc_comon.js"			// 시스템 공통
//@@컨버터에서 주석처리 #include "LIB::lib_comm_0001.js"		//JAVA 코딩시
//@@컨버터에서 주석처리 #include "LIB::tit_comm_0001.js"		// X-Framework Lib
//@@컨버터에서 주석처리 #include "lib::sc_sql_common.js"		// 공통팝업
//@@컨버터에서 주석처리 #include "lib::fm_common.js"			// FM공통
//=========================================================================================
// [ PART 2 ]    
// Form에서 사용될 전역변수를 선언
//
//=========================================================================================
var fa_Sql;
var fa_sDay;
var pre_need_date = gfn_addDate(gfn_today(),1);  				  //날짜 변경전 이전 날짜 기억
var fa_weekendTimeCheck = "N"; // 주말 발주 통제 여부
var fa_startTime; // 통제시작시간
var fa_endTime; // 통제종료시간

var fv_objColInfo;				//데이터셋 컬럼정보
var fv_stTimeFlag = false; //타이머표시flag

//최초등록시 주문번호 채번, 이후에는 같은 주문번호로 발주되도록 함
var fn_dsListbCnt = 0;
var pre_need_date_temp = ""; //달력 컴포넌트 날짜 변경 전 이전 날짜 기억 2017.10.13 김호석 추가
var fv_chkMsg = "";

//[PJT]주문채널통합
var fv_isCopyPaste = false;     //ctrl + v 작업중인지 확인하는 flag
var fv_searchBarcodeRowCnt = 3; //바코드 처리를 위한 row값(PAGING)
var fv_searchBarcodeRowIdx = 0; //바코드 처리를 위한 row값 저장변수 (설정 X)
//copyrow 변환값
var fv_copyColumInfo = "itemCode=ITEM_CODE,itemName=ITEM_NAME,itemSize=ITEM_SIZE,poUom=PO_UOM,unitPrice=UNIT_PRICE,marginPrice=MARGIN_PRICE,salePrice=SALE_PRICE,prQty=PR_QTY,saleAmount=SALE_AMOUNT,lineStatus=LINE_STATUS,clsStatus=CLS_STATUS,prRemark=PR_REMARK,subinvCode=SUBINV_CODE,needDate=NEED_DATE,preNeedDate=PRE_NEED_DATE,taxCode=TAX_CODE,custcd=CUSTCD,centerFlag=CENTER_FLAG,centerCode=CENTER_CODE,pointFlag=POINT_FLAG,prUpjang=PR_UPJANG,rcUpjang=RC_UPJANG,invatFlag=INVAT_FLAG,outvatFlag=OUTVAT_FLAG,minOrdQty=MIN_ORD_QTY,maxOrdQty=MAX_ORD_QTY,multiplierQty=MULTIPLIER_QTY,otcustcd=OTCUSTCD,opPrice=OP_PRICE,opPriceTax=OP_PRICE_TAX,opRate=OP_RATE,opAmount=OP_AMOUNT,gPrice=G_PRICE,opAmountOld=OP_AMOUNT_OLD,dDays=D_DAYS,dTimes=D_TIMES,dDayDisp=D_DAY_DISP,otcustnm=OTCUSTNM,kgConvertRate=KG_CONVERT_RATE,featureNameChk=FEATURE_NAME_CHK,imagePath=IMAGE_PATH,imageYn=IMAGE_YN,consumYn=CONSUM_YN,prId=PR_ID,keepingType=KEEPING_TYPE,applySd=APPLY_SD,vdSn=VD_SN,originType=ORIGIN_TYPE,mobileGubun=MOBILE_GUBUN,upjangGrp=UPJANG_GRP,poStatus=PO_STATUS,unuseYn=UNUSE_YN,valStpYn=VAL_STP_YN,fmpStatus=FMP_STATUS,poWeekStatus=PO_WEEK_STATUS,dangaItemCode=DANGA_ITEM_CODE,uomConvertRate=UOM_CONVERT_RATE,totWght=TOT_WGHT,favorGroupFlag=FAVOR_GROUP_FLAG,winItemCd=WIN_ITEM_CD,eventId=EVENT_ID,eventPrice=EVENT_PRICE,maxSoQty=MAX_SO_QTY,totSoAmt=TOT_SO_AMT,featureName=FEATURE_NAME,featureIcon=FEATURE_ICON,weekItemCode=WEEK_ITEM_CODE,dangaweekStatus=DANGAWEEK_STATUS,boxQty=BOX_QTY,prBoxQty=PR_BOX_QTY,prPcQty=PR_PC_QTY";
//=========================================================================================
// [ PART 3 ]
// Form Loading 시 작업 정의
//
//=========================================================================================
function form_onload(obj:Form, e:LoadEventInfo)
{
	gfn_formOnLoad(obj, false);
	//gfn_formOnLoad(this);
	
	//간혹..onactivate의 setTimer가 안먹히는 경우 발생..load시 먼저 해준다.
	setTimer(777,30000); //일단 30초 세팅
	
	//초기화
	fsp_init(this);
	
	// 업데이트여부를 체크할 DataSet, 여러개 있을 경우 ;로 구분
	v_ds_check = "ds_Listb";
	
	// 공통코드 조회	
	
	//반환/교환유형코드 ( 공통코드 )
	SCDataset.bind(this, "ComCode", "ds_rtnOrdType", {groupCode:"RTN_ORD_TYPE", useYn:"Y"}, "fn_callbakRtnOrdType");
	
	comp_upjang.setRoleSetId("BrandUpjang");	// 브랜드 유통사업장 roleSetId
	comp_upjang.isUpjangControl = true; 		//반환의경우 RTN_YN == Y 
	
	//마감시간
	var v_dsT;
	SCDataset.bind(this, "ComCode", "v_dsT", {groupCode:"SYS_PROPERTY", useYn:"Y", code:"SO_PR_RTN"});
	
	////////////////////////////////////임시
	//comp_upjang.setUpjangCode("190303");
	//comp_upjang.setUpjangName("(주)서원유통_브랜드");
	
	//comp_upjang.setUpjangCode("190171");
	//comp_upjang.setUpjangName("주식회사_대한마트_브랜드");
	////////////////////////////////////임시
				
	//초기화
	fn_ResetData();
	
	//반환가능업장 확인				
	fn_searchRtnOrderYn();

}

//반환 주문유형의 주문일자 선택시 정상주문 유형여부 확인
function fn_searchRtnOrderYn()
{
	// 초기화
	ds_Cond.clearData();

	ds_Cond.addRow();	
	ds_Cond.setColumn(0, "UPJANG",    comp_upjang.getUpjangCode());
		
    var strSvcID    = "search";
    var strURL      = "fm/fms/returnOrderByCust/selectRtnOrderYn.xdo";
    var strInDs     = "ds_Cond=ds_Cond:A";
    var strOutDs    = "ds_rtnOrderYn=ds_List";
    var strArg      = "";
    var strCallback = "fn_CallBack_searchRtnOrderYn";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}

function fn_CallBack_searchRtnOrderYn(SvcID, errCode, errMsg)
{
	if (errCode == 0)
	{
		if(ds_rtnOrderYn.getColumn(0, "rtnYn") != "Y"){
			g_Message("EE", "반환 주문이 가능한 업장이 아닙니다. \n담당 영업사원에게 문의하세요.");	
 			cbo_Subinv.readonly = true;
 			cbo_NeedDate.readonly = true;
 			btn_soprNeedDate.enable = false;
 			cbo_Gbn.enable = false;
 			ed_Item.enable = false;
 			btn_search.enable = false;
 			chk_autoList.enable = false;
 			chk_Only.enable = false;
 			gd_listb.enable = false; 
 			fv_stTimeFlag = false;
			st_Timer.visible = false;
		} else {		
			//fv_stTimeFlag = true;
			//st_Timer.visible = true;
			//Init 조회 서비스(속도 개선 async 통신으로 변경) 	
			fn_InitService();
		}
	}
	else
	{
		g_Message("EE",fn_AlertMsg("002"));
	}
}

//정상주문일자조회
function fn_searchSoprNeedDate()
{
	// 초기화
	ds_Cond.clearData();	
	ds_Cond.addRow();				
	ds_Cond.setColumn( 0, "UPJANG", comp_upjang.getUpjangCode() );		
    var strSvcID    = "searchSoprNeedDate";
    var strURL      = "fm/fms/returnOrderByCust/selectSoPrGetNeedDate.xdo";
    var strInDs     = "ds_Cond=ds_Cond:A";
    var strOutDs    = "ds_needDateList=ds_needDateList";
    var strArg      = "";
    var strCallback = "fn_callBack_SoprNeedDate";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}

//정상주문일자조회callback
function fn_callBack_SoprNeedDate(SvcID, errCode, errMsg)
{
	if (errCode == 0)
	{
 		if (ds_needDateList.rowcount < 1){
 			ds_List.clearData();
 			ds_Listb.clearData();
 			fv_stTimeFlag = false;
			st_Timer.visible = false;
 			g_Message("EE","반환주문 가능 일자가 존재하지 않습니다."); 			 			
			cbo_Subinv.readonly = true;
 			cbo_Gbn.enable = false;
 			ed_Item.enable = false;
 			btn_search.enable = false;
 			chk_autoList.enable = false;
 			chk_Only.enable = false;
 			gd_listb.enable = false; 
 		} else {
 		 	fv_stTimeFlag = true;
 			st_Timer.visible = true;
 			cbo_NeedDate.index = 0;
 			cbo_Subinv.readonly = false;
			cbo_Gbn.enable = true;
 			ed_Item.enable = true;
 			btn_search.enable = true;
 			chk_autoList.enable = true;
 			chk_Only.enable = true;
 			gd_listb.enable = true;
 			
			////////// 3. 디데이 조회
			ds_Days.clearData();
			var actionName, cmdName, inData, outData, otherArg, callBackFnc, trId;
			trId  = "searchDays";
			outData		= "ds_Days=ds_List";
			otherArg	= "UPJANG=" + gfn_nvl(wrapQuote(comp_upjang.getUpjangCode()),"") + " SUBINV_CODE=" + wrapQuote(cbo_Subinv.value) + " NEED_DATE=" + wrapQuote(cbo_NeedDate.value);
			callBackFnc = "fn_CallbakInitService";
			fsp_clear(this); 
			fsp_addSearch(this, "fm/fmz:FMZ_GETDAYS_S001");					
			fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc, "", "", "", trId);
			
			////////// 4. 주문통제 조회
			ds_OrdCtrl.clearData();
			var actionName, cmdName, inData, outData, otherArg, callBackFnc, trId;
			trId  = "searchOrdCtrl";
			outData		= "ds_OrdCtrl=ds_List";
			otherArg	= "UPJANG=" + gfn_nvl(wrapQuote(comp_upjang.getUpjangCode()),"");
			callBackFnc = "fn_CallbakInitService";
			fsp_clear(this); 
			fsp_addSearch(this, "fm/fmz:FMZ_ORD_CTRL_S001");			
			fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc, "", "", "", trId);
			
			
			//자동조회
			//fn_search(); 			
 		}
	} else {
		g_Message("EE",fn_AlertMsg("002"));
	}
}

function fn_InitService()
{
   	////////// 1. 센터단가업장정보 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc, trId;
	trId  = "searchCtUpj";
    outData		= "ds_CtUpj=ds_List";
    otherArg	= "UPJANG=" + gfn_nvl(wrapQuote(comp_upjang.getUpjangCode()),"");
    callBackFnc = "fn_CallbakInitService";
	fsp_clear(this); 
	fsp_addSearch(this, "fm/fmz:FMZ_GET_CTUPJ_S001");
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc, "", "", "", trId);
}

function fn_CallbakInitService(errCode, errMsg, svcId)
{	
	if (errCode == 0)
	{	    
	    switch(svcId)
		{
			case "searchCtUpj":
				
				if (ds_CtUpj.rowcount <= 0)
				{
					g_Message("EE","업장기초정보를 확인할 수 없습니다.!" + "\n\n" + "관리자에게 문의하세요.");
					return;
				}
				
			    ////////// 2. 창고 조회
				ds_Subinv.clearData();
				var actionName, cmdName, inData, outData, otherArg, callBackFnc, trId;
				trId  = "searchSubinv";
				outData		= "ds_Subinv=ds_List";
				otherArg	= "UPJANG=" + gfn_nvl(wrapQuote(comp_upjang.getUpjangCode()),"");
				callBackFnc = "fn_CallbakInitService";				
				fsp_clear(this); 
				fsp_addSearch(this, "fm/fmz:FMZ_PO_SUBINV_S001");
				fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc, true, "", "", trId); 
				
			    break;
			
			case "searchSubinv":
				//기본창고지정
	            if (ds_Subinv.rowcount > 0) cbo_Subinv.index = 0;
	            
	            //정상주문일자조회
				fn_searchSoprNeedDate();
	            
				break;
				
			case "searchDays":
				
				//디데이 표시				
				if (ds_Days.rowcount > 0) {
					var set1 = v_dsT.getColumn(0, "set1");
					var set2 = v_dsT.getColumn(0, "set2");
					var attr01 = v_dsT.getColumn(0, "attr01");
					var attr02 = v_dsT.getColumn(0, "attr02");		
					if(set1 <= cbo_NeedDate.value && set2 >= cbo_NeedDate.value){		
						ds_Days.setColumn(0,"D_TIMES" ,attr01);		
						ds_Days.setColumn(0,"DAYS", "D-"+ds_Days.getColumn(0,"D_DAYS")+" "+attr01.substr(0,2)+":"+attr01.substr(2,2));		
					} else {		
						ds_Days.setColumn(0,"D_TIMES" ,attr02);		
						ds_Days.setColumn(0,"DAYS", "D-"+ds_Days.getColumn(0,"D_DAYS")+" "+attr02.substr(0,2)+":"+attr02.substr(2,2));		
					}				
				
					st_Days.text = "(발주 마감 : " + ds_Days.getColumn(0,"DAYS") + ")";
					fn_search();	 	
				} else {
					g_Message("EE","발주마감정보를 확인할 수 없습니다.!" + "\n\n" + "관리자에게 문의하세요.");
				}
	            
				break;	
				
			default:
				break;
		}
	    
	} else {
		g_Message("EE",fn_AlertMsg("002"));
	}
}

//정상주문일자조회(저장전 서버체크)
function fn_searchSoprNeedDateChk(flag)
{
	// 초기화
	ds_Cond.clearData();	
	ds_Cond.addRow();				
	ds_Cond.setColumn( 0, "UPJANG", comp_upjang.getUpjangCode() );		
	ds_Cond.setColumn( 0, "NEED_DATE", cbo_NeedDate.value );
	
	var strSvcID    = "";
	if(flag == "sav"){			
		strSvcID    = "searchSoprNeedDateSavChk";
    }else if(flag == "del"){
		strSvcID    = "searchSoprNeedDateDelChk";
    }
    var strURL      = "fm/fms/returnOrderByCust/selectSoPrGetNeedDate.xdo";
    var strInDs     = "ds_Cond=ds_Cond:A";
    var strOutDs    = "ds_needDateChkList=ds_needDateList";
    var strArg      = "";
    var strCallback = "fn_callBack_SoprNeedDateChk";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}

//정상주문일자조회(저장전 서버체크)callback
function fn_callBack_SoprNeedDateChk(SvcID, errCode, errMsg)
{
	if (errCode == 0)
	{
 		if (ds_needDateChkList.rowcount < 1){
//  			ds_List.clearData();
//  			ds_Listb.clearData();
// 			g_Message("EE",cbo_NeedDate.text+" 에 반환주문 가능 일자가 존재하지 않습니다. \n반환회수일을 새로고침 하세요."); 			 			 			
// 			cbo_Subinv.readonly = true;
//  			cbo_Gbn.enable = false;
//  			ed_Item.enable = false;
//  			btn_search.enable = false;
//  			chk_autoList.enable = false;
//  			gd_listb.enable = false; 	
			g_Message("EE",cbo_NeedDate.text+" 에는 반환주문 일자가 존재하지 않습니다."); 			 			
			fn_searchSoprNeedDate();
 		} else { 
			if(SvcID == "searchSoprNeedDateSavChk"){
				fn_saveData();
			} else if(SvcID == "searchSoprNeedDateDelChk"){
				fn_deleteData();
			}
 		}
	} else {
		g_Message("EE",fn_AlertMsg("002"));
	}
}
//=========================================================================================
// [ PART 4 ] 
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,도움말,form닫기)
//
//=========================================================================================
/*------------------------------------------------------------(60)
	1. Function ID : fn_Search()
	2. 개       요 : 업무프로세스에 따른 조회작업
	3. 기       능 : 검색조건에 해당하는 정보를 조회
	4. 인 수 설 명 : 
*/
function fn_search(isSave)
{

	// 발주저장전 발주상태 재확인
	if ( gfn_isNull(isSave) ) {
		isSave = false;
	}
		
	//필수항목 
	if (fn_ChkManNull()) return;
	
	//입고통제일 체크 
	if (fn_NeedDateCheck()) 
	{
	    g_Message("EE","해당일자는 입고통제일 입니다.");
	    ds_List.clearData();
	    ds_Listb.clearData();
	    st_Timer.text = "마감시간 : 00일 00시간 00분 전";
		return;
	}	
	
	//2017.10.13 김호석 추가 입고일자 변경 전으로 되돌림
	pre_need_date_temp = cbo_NeedDate.value;
		
	fn_SetTimer();
	//최종발주정보
	
	// 초기화
	ds_Cond.clearData();
	
	//st_ctrlAmt.visible = false;
	
	if ( !isSave ) {
		ds_Listb.clearData();
	}
	ds_Cond.addRow();	
	ds_Cond.setColumn(0, "TAB_NAME",       "tab1");
	ds_Cond.setColumn(0, "SUBINV_CODE",    cbo_Subinv.value);
	ds_Cond.setColumn(0, "NEED_DATE",      cbo_NeedDate.value);
	ds_Cond.setColumn(0, "QTY_CONTROL_YN", ds_Days.getColumn(0,"QTY_CONTROL_YN"));
	
    //서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보가 사라지는 현상을 복원하기 위해 현재 컬럼정보 저장 
	fv_objColInfo = gfn_getDatasetInfo(ds_Listb);
    
    if ( isSave ) {
		var strOutDs	= "ds_ListCheck=ds_List";
		var strCallback	= "";
    } else {					  
		var strOutDs	= "ds_Listb=ds_List";
		var strCallback	= "fn_CallBack_Search";
    }
    
    var strSvcID    = "search";
    var strURL      = "fm/fms/returnOrderByCust/selectReturnOrderByCustList.xdo";
    var strInDs     = "ds_Cond=ds_Cond:A";    
    var strArg      = "";    
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
    
    
    //trace(ds_ListCheck.saveXML());
    if ( isSave ) {
		// save check 로직에서 dateset 확인
		return ds_ListCheck;
    }
 
}
function fn_NeedDateCheck()
{
	//ds임시생성
	var dsObjin, dsObjot;
		
	create("Dataset", "ds_Dummyin");
	create("Dataset", "ds_Dummyot");
	
	dsObjin = eval("ds_Dummyin");
	dsObjin.addColumn("UPJANG", "INT", 22);
	dsObjin.addColumn("NEED_DATE", "STRING", 8);
	dsObjot = eval("ds_Dummyot");
	dsObjot.addColumn("CNT", "INT", 22);
	
	/*-------------*/
	http.Sync = true;
	/*-------------*/
	// 초기화
	ds_Dummyin.clearData();
	ds_Dummyot.clearData();
	ds_Dummyin.addRow();
	ds_Dummyin.setColumn(0, "UPJANG",         comp_upjang.getUpjangCode());
	ds_Dummyin.setColumn(0, "NEED_DATE",      cbo_NeedDate.value);
	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	// 파라미터셋팅
    inData		= "ds_Cond=ds_Dummyin";
    outData		= "ds_Dummyot=ds_List";
	//action 정보 초기화 
	fsp_clear(this); 
    // 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "fm/fmz:FMZ_ORD_CTRL_S002");
	// 서버 호출 
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);
	/*-------------*/
	http.Sync = false;
	/*-------------*/
	var bYn = (ds_Dummyot.getColumn(0, "CNT") > 0);
	//ds임시생성 해제
	Destroy("ds_Dummyin");
	Destroy("ds_Dummyot");
	
	return bYn;
}

function fn_SearchItem()
{
	if ( ffn_ChkNull(ed_Item.value)) {
		g_Message("EE", "상품검색어를 입력하세요.");
		ed_Item.setFocus();
		//return false;
	}
	
	var gbn = cbo_Gbn.value;
	var itemName = ed_Item.text;

	//바코드 의 입력값의 길이는 6 이상이어야 합니다.
	if(gbn == "88" && !ffn_ChkNull(itemName) && itemName.length < 6){
		g_Message("EE", "바코드의 입력값의 길이는 6 이상이어야 합니다.");
		ed_Item.setFocus();
		return false;
	}

	//필수항목 
	if (fn_ChkManNull()) return;
	
	//발주가능 체크
	if (! fn_OrdChk())
	{
		cbo_NeedDate.setFocus();
		return;
	}

	// 초기화
	ds_Cond.clearData();
	ds_List.clearData();
	
	ds_Cond.addRow();
	ds_Cond.setColumn(0, "UPJANG",        comp_upjang.getUpjangCode());
	ds_Cond.setColumn(0, "SUBINV_CODE",   cbo_Subinv.value);
	ds_Cond.setColumn(0, "NEED_DATE",     cbo_NeedDate.value);
	ds_Cond.setColumn(0, "CONSUM_YN",     ds_Subinv.getColumn(ds_Subinv.rowposition,"CONSUM_YN"));
	ds_Cond.setColumn(0, "QTY_CONTROL_YN",ds_Days.getColumn(0,"QTY_CONTROL_YN"));
	ds_Cond.setColumn(0, "CENTER_CODE",   			ds_CtUpj.getColumn(0,"CENTER_CODE"));
	ds_Cond.setColumn(0, "AP_UNITPRICE_UPJANG",     ds_CtUpj.getColumn(0,"AP_UNITPRICE_UPJANG"));
	ds_Cond.setColumn(0, "OTCUST_PRICE_UPJANG",     ds_CtUpj.getColumn(0,"OTCUST_PRICE_UPJANG"));
	ds_Cond.setColumn(0, "ITEM_NAME",     itemName);
	ds_Cond.setColumn(0, "GBN",           gbn); //[PJT]주문채널통합
	
	// 조회
	var strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc;
	// 경로 설정
	strSvcID = "FMP00082E_T003"; //[PJT]주문채널통합
	strURL   = "hwfs_svc/fm/fmp/FMP00082E_T003.jsp";	// renwebind ㅜㅜ //[PJT]주문채널통합
	
	// 데이터셋 설정
	strInDatasets  = "ds_Cond=ds_Cond";
	strOutDatasets = "ds_List=ds_List";
	
	// 파라메터 설정
	strArgument  = "g_Upjang=" + wrapQuote(g_Upjang);
	strArgument += " g_EmpNo=" + wrapQuote(g_EmpNo);
	strArgument += " Holiday_YN=" + wrapQuote(application.g_HOLIDAY_CHK_YN);	
	strArgument += " strIndex='1'";	 //반환가능품목등록에 등록된 상품만..
	strArgument += " strTabIndex='0'";
	strArgument += " strWeekendTimeCheck=" + wrapQuote(fa_weekendTimeCheck);
	
	
	strArgument += " strOnly='TRUE'"; //주문가능상품만..
// 	if (chk_Only.value == "1") {
// 		strArgument += " strOnly='TRUE'"; //주문가능상품만..
//     } else {
// 		strArgument += " strOnly='FALSE'";
//     }
    

	// 최근 n개월
	strArgument += " nMonth=0";//+wrapQuote(tab_list.tab1.cbo_month.value);	
	strArgument += " sType='DC'";

	// 콜백함수 지정
	strCallbackFunc = "fn_CallBack_SearchItem";
	// 서버 호출 
	//jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, false, false, true); 
	gfn_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, false, true, true); 
}


//바코드로 상품조회
function fn_SearchItemBarcode()
{
	if(ds_Listb.rowcount <= fv_searchBarcodeRowIdx) {
		pgb_order.visible = false;
		fn_checkTempItem(ds_Listb); //조회결과 check
		return;
	}

	// 초기화
	ds_BarcodeCond.clearData();   //바코드 조회조건1
	ds_Barcode.clearData();       //바코드 조회조건2
	ds_BarcodeResult.clearData(); //바코드 조회결과
	
	ds_BarcodeCond.addRow();
	ds_BarcodeCond.setColumn(0, "UPJANG",                  comp_upjang.getUpjangCode());
	ds_BarcodeCond.setColumn(0, "SUBINV_CODE",             cbo_Subinv.value);
	ds_BarcodeCond.setColumn(0, "NEED_DATE",               cbo_NeedDate.value);
	ds_BarcodeCond.setColumn(0, "CONSUM_YN",               ds_Subinv.getColumn(ds_Subinv.rowposition,"CONSUM_YN"));
	ds_BarcodeCond.setColumn(0, "QTY_CONTROL_YN",          ds_Days.getColumn(0,"QTY_CONTROL_YN"));
	ds_BarcodeCond.setColumn(0, "CENTER_CODE",   		   ds_CtUpj.getColumn(0,"CENTER_CODE"));
	ds_BarcodeCond.setColumn(0, "AP_UNITPRICE_UPJANG",     ds_CtUpj.getColumn(0,"AP_UNITPRICE_UPJANG"));
	ds_BarcodeCond.setColumn(0, "OTCUST_PRICE_UPJANG",     ds_CtUpj.getColumn(0,"OTCUST_PRICE_UPJANG"));
	ds_BarcodeCond.setColumn(0, "ITEM_NAME"          ,     "");
	ds_BarcodeCond.setColumn(0, "GBN",                     "BARCODE");
	
	var tempRowCnt = ((ds_Listb.rowcount - fv_searchBarcodeRowIdx));
	var maxRow =  Math.min(tempRowCnt, fv_searchBarcodeRowCnt); //(tempRowCnt > fv_searchBarcodeRowCnt ? fv_searchBarcodeRowCnt : tempRowCnt) + fv_searchBarcodeRowIdx;
	
	//trace("maxRow : " + maxRow);
	//trace("tempRowCnt : " + tempRowCnt);
	//trace("fv_searchBarcodeRowCnt : " + fv_searchBarcodeRowCnt);
	
	for(var i = 0; i < maxRow; i++){
		//trace("index : " + (fv_searchBarcodeRowIdx));
		if(ds_Listb.getColumn(fv_searchBarcodeRowIdx, "itemStatus") == "N"){
			var nRow = ds_Barcode.addRow();
			ds_Barcode.setColumn(nRow, "BARCODE", ds_Listb.getColumn(fv_searchBarcodeRowIdx, "winItemCd"));
			ds_Barcode.setColumn(nRow, "ROW", fv_searchBarcodeRowIdx);
		}

		fv_searchBarcodeRowIdx++;
	}

	//trace("ds_Barcode.rowcount : [" + ds_Barcode.rowcount + "] >>>> [" + traceArr.join(",") + "]");
	var nCnt = ds_Listb.getCaseCount("inputType == 'P' ");
	var nStartRow = ds_Listb.findRowExpr("inputType == 'P' ");
	var nPos =  parseInt((fv_searchBarcodeRowIdx - nStartRow) / nCnt * 100, 10);

	pgb_order.pos = nPos;
	pgb_order.text = (nPos < 100 ? "처리중.." : "처리완료") + "( " + nPos + "% )";
	//trace("pgb_order.text " + pgb_order.text);

	//검색할 바코드가 없으면 다시 호출
	if(ds_Barcode.rowcount == 0){
		fn_SearchItemBarcode();
		return;
	}

	
	// 조회
	var strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc;
	// 경로 설정
	strSvcID = "FMP00082E_T003"; //[PJT]주문채널통합
	strURL   = "hwfs_svc/fm/fmp/FMP00082E_T003.jsp";	// renwebind ㅜㅜ //[PJT]주문채널통합
	
	// 데이터셋 설정
	strInDatasets  = "ds_Cond=ds_BarcodeCond:A ds_Barcode=ds_Barcode:A";
	strOutDatasets = "ds_BarcodeResult=ds_List";
	// 파라메터 설정
	strArgument  = "g_Upjang=" + wrapQuote(g_Upjang);
	strArgument += " g_EmpNo=" + wrapQuote(g_EmpNo);
	strArgument += " Holiday_YN=" + wrapQuote(application.g_HOLIDAY_CHK_YN);	
	strArgument += " strIndex='1'";
	strArgument += " strTabIndex='0'";
	strArgument += " strWeekendTimeCheck=" + wrapQuote(fa_weekendTimeCheck);
	strArgument += " strOnly='TRUE'";

	// 최근 n개월
	strArgument += " nMonth=0";//+wrapQuote(tab_list.tab1.cbo_month.value);
	strArgument += " sType='DC'";
	
	// 콜백함수 지정
	strCallbackFunc = "fn_CallBack_SearchItemBarcode";
	// 서버 호출 
	//jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, false, false, true); //동기
	//jsp_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, true, false, true); //비동기
	gfn_transaction(this, strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc, true, false, true); //비동기

}


/*------------------------------------------------------------
	1. Function ID : fn_Insert()
	2. 개       요 : 업무프로세스에 따른 입력작업
	3. 기       능 : 입력버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*/
function fn_insert()
{
}
/*------------------------------------------------------------
	1. Function ID : fn_Delete()
	2. 개       요 : 업무프로세스에 따른 입력작업
	3. 기       능 : 입력버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*/

function fn_delete(){
	//정상주문일자조회(저장전 서버체크)
	fn_searchSoprNeedDateChk("del");
}

function fn_deleteData()
{	
	if (ds_Listb.rowcount < 1)
	{
		g_Message("EE", fn_AlertMsg("006"));
		return;
	}
	
	if (ds_Listb.rowposition < 0 || ds_Listb.getSelect(ds_Listb.rowposition) == false)
	{
		g_Message("EE", "삭제할 상품을 선택하세요.");
		return;
	}
	
	//실제 Table자료 삭제 시 Table에서 즉시 삭제처리
	//필수항목 
	if (fn_ChkManNull()) return;
	
	if (ds_Listb.getColumn(ds_Listb.rowposition,"clsStatus") == "마감")
	{
		g_Message("EE", "해당상품은 마감이 완료되어 삭제가 불가합니다.");
		return;
	}
	
	//발주가능 체크
	if (! fn_OrdChk()) return;
	
	//기존 자료인 경우 디데이 체크
	if (GetRowType(ds_Listb, ds_Listb.rowposition) <> 'insert')
	{
		if (fn_GetDayStatus(ds_Listb.getColumn(ds_Listb.rowposition,"dDays"), ds_Listb.getColumn(ds_Listb.rowposition,"dTimes")) == "0")
		{
			g_Message("EE","해당 상품은 마감시간(D-Days)이 초과되어 삭제가 불가합니다.");
			return;
		}
	}
	
	var checkDs = fn_search(true);
	
	if (! g_Confirm("01", '선택하신 주문상품을 삭제하시겠습니까?!')) return;
	
	if (GetRowType(ds_Listb, ds_Listb.rowposition)== 'insert')
	{
		ds_Listb.deleteRow(ds_Listb.rowposition);
		return;
	}
	
	var rtnCheckMsg = fn_checkLineStatus("delete", checkDs);
	if ( !gfn_isNull(rtnCheckMsg) ) {
		g_Message("EE", rtnCheckMsg);
		fn_search();
		return;
	}
	
	//삭제행만 처리...	
	ds_delListb.clearData();	
	ds_delListb.addRow();	
	ds_delListb.copyRow(0, ds_Listb, ds_Listb.rowposition);	
	ds_delListb.setRowType(0, 8);	
	ds_Listb.updatecontrol = false;
	ds_Listb.deleteRow(ds_Listb.rowposition);
	ds_Listb.updatecontrol = true;	
		
    var strSvcID    = "deleteReturnOrderByCustInfo";
    var strURL      = "fm/fms/returnOrderByCust/saveReturnOrderByCustInfo.xdo";    
    var strInDs     = "ds_IUD=ds_delListb:U";
    var strOutDs    = "";
    var strArg      = "";
    var strCallback = "fn_CallBack_Delete";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);	
}
/*------------------------------------------------------------
	1. Function ID : fn_Save(confirmYn)
	2. 개       요 : 업무프로세스에 따른 입력작업
	3. 기       능 : 입력버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : confirmYn = null 이면 저장하시겠습니까라는 창을 띄움
	                 confirmYn = 1 이면 저장하시겠습니까라는 창을 안띄움
*/
function fn_save(){
	//정상주문일자조회(저장전 서버체크)
	fn_searchSoprNeedDateChk("sav");
}

function fn_saveData()
{
	//저장 버튼 누른 후 팝업 상태에서 마감시간 이후 저장 체크를 위한 변경
	//[HISTORY] : 수정일 > 2009/01/19
	//            수정자 > 노규완
	//            수정 내용 > 저장 Confirm 팝업 메시지를 제일 먼저 띄어 줌.

// 	//변경여부 확인
// 	if ( (! gfn_dsIsUpdated(ds_Listb) ) )
// 	{
// 		return g_Message("EE", fn_AlertMsg("007"));
// 	}

	//필수항목 
	if (fn_ChkManNull()) return;

	// 구멍 매꾸기
	if ( div_cmnBtn.btn_save.enable == false || div_cmnBtn.btn_save.visible == false ) {
		g_Message("EE","발주 정보를 저장할 권한이 없습니다.");
		return;
	}
	
	//[PJT]주문채널통합
	var nErrRow = ds_Listb.findRowExpr(" itemStatus == 'E' ");
	if (nErrRow > -1){
		ds_Listb.rowposition = nErrRow;
		g_Message("EE","오류가 있는 발주내역을 삭제 하세요.");
		return;
	}
	
	/*시스템 통제 시간 체크 - 특정일자에 사용을 할 수 없게 한다.*/
	mfn_GetSystemWorkCheck("PO");		
	if (ds_common.getColumn(0, 0) == "Y")
	{
		g_Message("EE", "시스템 변경 작업중이라 현 화면을 사용할 수 없습니다. \n사용불가시간(" + ds_common.getColumn(0, 1) + " ~ " + ds_common.getColumn(0, 2) + ") ");
		return false; 
	}

	//입고예정일 변경 확인 2017.10.18 김호석(하단 주문내역 그리드의 입고예정일과 검색조건 입고예정일 비교) 시작
	//그리드의 입고예정일은 검색조건의 입고예정일로 조회 후 표시또는 추가되므로 조회 시(fn_search함수) 이전 입고예정일 저장(pre_need_date_temp)	
	var from_need_date = "";
	var to_need_date = "";
	from_need_date = pre_need_date_temp;
	to_need_date = cbo_NeedDate.value;
	
	if (from_need_date.length  == 8) 
	{
		from_need_date = from_need_date.slice(0,4) + "-" + from_need_date.slice(4,6) + "-" + from_need_date.slice(6,8);
	}
	if (to_need_date.length  == 8) 
	{
		to_need_date = to_need_date.slice(0,4) + "-" + to_need_date.slice(4,6) + "-" + to_need_date.slice(6,8);
	}

// 	if (pre_need_date_temp != cbo_NeedDate.value) {
// 		
// 		// 저장 전 사용자 메세지 전달
// 		//if (g_Confirm("02", "입고예정일이 " + from_need_date + "에서 " + to_need_date + "로 변경되었습니다. \n입고예정일 " + from_need_date + "로 주문내역을 저장하시겠습니까? "))
// 		if (g_Confirm("02", sta_NeedDate.text+" " + from_need_date + "에서 " + to_need_date + "로 변경되었습니다. \n"+sta_NeedDate.text+" " + from_need_date + "로 주문내역을 저장하시겠습니까? "))
// 		//g_Message("EE","변경된 내역이 있습니다. 저장해 주십시요");
// 		{ 	
// 			cbo_NeedDate.value = pre_need_date_temp;			
// 		} else {
// 			cbo_NeedDate.value = pre_need_date_temp;
// 			//g_Message("EE","입고예정일이 " + from_need_date + "에서 " + to_need_date + "로 변경되었습니다.");
// 			g_Message("EE",sta_NeedDate.text+" " + from_need_date + "에서 " + to_need_date + "로 변경되었습니다.");
// 			return;		
// 		}
// 		
// 	}

	// Validation Check
	if(!gfn_validCheck(ds_Listb, ds_ListbValid, true)) return;
	
	var checkDs = fn_search(true);
	
	// 저장 전 사용자 메세지 전달
	if (! g_Confirm("", "주문내역을 저장하시겠습니까?"))
	{
		return;
	}
	
	//발주량 0상품 확인
	var nRow;
	nRow = ds_Listb.findRowExpr("prQty==0");
	if (nRow >= 0)
	{	
		if (! g_Confirm("02", "발주량이 0인 상품이 있습니다.\n\n그대로 저장하시겠습니까?"))
		{
			ds_Listb.rowposition = nRow;
			gd_listb.setFocus();
			gd_listb.setCellPos(ffn_Get_HeaderTitleColIdx(gd_listb,"수량"));
			return;
		}
	}
	
	//현재시간 초기화. 
	//발주가능, 데이타체크에서 현재시간을 통해 계산하기때문에
	fn_SetTimer();
	
	//발주가능 체크(창고)
	if (! fn_OrdChk()) return;
	
	// 데이타체크(여신및 상품별 디데이체크) //여신부분 제거..
	var sRtn = fn_ChkData(checkDs);
	
	if (sRtn != null)
	{
		g_Message("EE", sRtn);
		return;
	}
	
    var strSvcID    = "saveReturnOrderByCustInfo";
    var strURL      = "fm/fms/returnOrderByCust/saveReturnOrderByCustInfo.xdo";    
    var strInDs     = "ds_IUD=ds_Listb:U";
    var strOutDs    = "";
    var strArg      = "";
    var strCallback = "fn_CallBack_Save";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);	
}
/*------------------------------------------------------------
	1. Function ID : fn_Print()
	2. 개       요 : 업무프로세스에 따른 입력작업
	3. 기       능 : 입력버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*/
function fn_print()
{
	//gd_listE.ExportExcelEx("단가표");
}
/*------------------------------------------------------------
	1. Function ID : fn_Close()
	2. 개       요 : 업무프로세스에 따른 입력작업
	3. 기       능 : 입력버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*/
function fn_Close()
{
	This.close();
}
/*------------------------------------------------------------
	1. Function ID : fn_Help()
	2. 개       요 : 업무프로세스에 따른 입력작업
	3. 기       능 : 입력버튼 입력 시 처리되는 작업
	4. 인 수 설 명 : 
*/
function fn_help()
{
}
//=========================================================================================
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
//
//=========================================================================================
/*------------------------------------------------------------
	1. Function ID : fn_AlertMsg(cd)
	2. 개       요 : 메세지 처리
	3. 기       능 : 화면에 나타나는 메시지 코드및 텍스트 리턴
	4. 인 수 설 명 : cd : 원하는 메시지 코드
*/
function fn_AlertMsg(cd)
{
	var v_Msg="";
	switch(cd)
	{
		case "000":
			v_Msg= "이(가) 저장되었습니다.";
			break;
		case "001":
			v_Msg= "버튼이 정의 되어 있지않습니다.";
			break;
		case "002":
			v_Msg="서비스 오류:시스템 관리자에게 문의하십시오";
			break;
		case "003":
			v_Msg="필수항목은 반드시 선택하시기 바랍니다.";
			break;	
		case "004":
			v_Msg="작업대상 본사를 선택하세요.";
			break;
		case "005":
			v_Msg="을(를) 입력하세요";
			break;
		case "006":
			v_Msg="삭제할 데이터가 없습니다.";
			break;
		case "007":
			v_Msg="변경된 데이터가 없습니다.";
			break;
		case "008":
			v_Msg="시스템ID가 없습니다.";
			break;			
/*			
		case "":
			v_Msg="";
			break;
*/			
		default:
			break;			
	}
	return v_Msg;
}
//콜백
//function fn_CallBack_Search(errCode, errMsg)
function fn_CallBack_Search(SvcID, errCode, errMsg)
{
//alert("SvcID:"+SvcID+" errCode:"+errCode+" errMsg:"+errMsg);
	if (errCode == 0)
	{
		if (ds_Listb.rowcount < 1)
		{
			g_Message("EE","주문등록한 상품이 없습니다.");
			
			//서비스 쿼리 결과로 데이터가 없는 경우 데이터셋 컬럼정보 복원
			gfn_loadDatasetInfo (ds_Listb, fv_objColInfo);
		} else {
			fn_CLS_STATUS_Setting();
		}
		
		//최초등록시 주문번호 채번, 이후에는 같은 주문번호로 발주
		ds_Listb.filter("otcustcd=='0000'");
		fn_dsListbCnt = 0;
		fn_dsListbCnt = ds_Listb.rowcount;
		ds_Listb.filter("");		
		ed_Item.setFocus();
		
		//반환타입attr01~02 기간 적용
		//ds_rtnOrdType.filter("attr01 <= '"+cbo_NeedDate.value+"' && attr02 >= '"+cbo_NeedDate.value+"'");
		ds_rtnOrdType.filter("code != 'G01' && code != 'H01' && code != 'I01' && attr01 <= '"+cbo_NeedDate.value+"' && attr02 >= '"+cbo_NeedDate.value+"'");
		ds_rtnOrdTypeAllChg.copyData(ds_rtnOrdType, true);
		cbo_rtnOrdType.index = 0;
		//trace(eval("ds_Listb" + gfn_toString(tab_list.tabindex+1)).saveXML());			
	}
	else
		g_Message("EE",fn_AlertMsg("002"));
}
//function fn_CallBack_SearchItem(errCode, errMsg)
function fn_CallBack_SearchItem(SvcID, errCode, errMsg)
{
	if (errCode == 0)
	{
		if (ds_List.rowcount < 1)
		{
			g_Message("EE","검색된 상품이 없습니다.");
			ed_Item.setFocus();
		}
		else
		{
			gd_list.setFocus();			
			var dsObj = ds_List;//.rowposition = 0;
			dsObj.rowposition = 0;
			//[PJT]주문채널통합 
			//자동등록 체크 & dataset 1건이면 등록 처리
 			if (dsObj.rowcount == 1 && chk_autoList.isChecked())
 			{
				fn_CopyRow(dsObj, dsObj.rowposition, "S");
 			}
		}
	}
	else
		g_Message("EE","주문상품 조회하는 중에 오류가 발생하였습니다! \n 관리자에게 문의하세요.");
}


//바코드 상품 조회
//function fn_CallBack_SearchItemBarcode(errCode, errMsg)
function fn_CallBack_SearchItemBarcode(SvcID, errCode, errMsg)
{
//trace("fn_CallBack_SearchItemBarcode===>"+ds_BarcodeResult.saveXML());
	if (errCode == 0)
	{	
		//조회조건 만큼 loop
		for(var i = 0; i < ds_Barcode.rowcount; i++){
			var sCode = ds_Barcode.getColumn(i, "BARCODE");
			var nRow  = ds_Barcode.getColumn(i, "ROW");
			var nCnt  = ds_BarcodeResult.getCaseCount( " WIN_ITEM_CD == '" + sCode + "'");

			if(nCnt == 0){
				// 검색결과 바코드가 매칭되는 데이터가 없는 경우 발주불가 또는 미존재 바코드 정보. 표시
				ds_Listb.setColumn(nRow, "itemName",   "미존재 바코드 정보");
				ds_Listb.setColumn(nRow, "itemStatus", "E");
			} else if(nCnt > 1){
				// 검색결과 바코드가 1:N으로 매칭되지 경우 :  상품코드와 매칭된 바코드 정보가 올바르지 않습니다. 표시
				ds_Listb.setColumn(nRow, "itemName",   "상품코드와 매칭된 바코드 정보가 올바르지 않습니다");
				ds_Listb.setColumn(nRow, "itemStatus", "E");
			} else if(nCnt == 1){
				//정상
				var nFindRow = ds_BarcodeResult.findRowExpr( " WIN_ITEM_CD == '" + sCode + "'");
				fn_CopyRowPaste(ds_BarcodeResult, nRow, nFindRow, "P");
			}
		
		}//end for
		
		if(ds_Listb.rowcount <= fv_searchBarcodeRowIdx) {
			pgb_order.visible = false;
			fn_checkTempItem(ds_Listb);//조회결과 check
			return;
		}
		fn_SearchItemBarcode(); //남은 건수 재조회
	}
	else {
		g_Message("EE","바코드 상품 조회하는 중에 오류가 발생하였습니다! \n 관리자에게 문의하세요.");
	}
}


//function fn_CallBack_Delete(errCode, errMsg)
function fn_CallBack_Delete(SvcID, errCode, errMsg)
{
	if (errCode == 0)
	{
		//신규추가부분 
		ds_msg_out.clearData();
		ds_msg_out.copyData(ds_msg);

		if ( ds_msg_out.rowcount != 0 )  {
			var strMsg ="";
			for ( var q=0; q<ds_msg_out.rowcount; q++ ) {
				if ( ds_msg_out.getColumn(q, "TYPE") == "I" ) {
					strMsg += ds_msg_out.getColumn(q, "MSG")+"\r\n";
				}
			}
			
			if ( !gfn_isNull(strMsg) ) { 
				g_Message("", strMsg);
				fn_search();
			}
			
			var rowPos = ds_msg_out.findRow("TYPE", "N");
			if ( rowPos != -1 ) {
				g_Message("", ds_msg_out.getColumn(rowPos, "MSG"));
				
				//trace("MENU_ID=="+this.parent._fv_menuId);
				application.afrm_Bottom.form.fn_reOpenMenu(this.parent._fv_menuId);
				this.getOwnerFrame().form.close();
				return;
			}
			
			ds_msg_out.clearData();
		}
	}
	else
		g_Message("EE",fn_AlertMsg("002"));
}
function fn_CallBack_Save(SvcID, errCode, errMsg)
//function fn_CallBack_Save(errCode, errMsg)
{
	if (errCode == 0)
	{
// [속도개선 Project 시작] 2017. 8. 21. 최범주 여신정보조회 함수 대체
//		if ( !fn_GetCredit() ) return; // 여신정보 조회
// [속도개선 Project   끝] 2017. 8. 21. 최범주
		//fn_search();
		g_Message("02","주문자료" + fn_AlertMsg("000"));
		
		//trace(ds_msg_out.saveXML());
		
		//신규추가부분 
		ds_msg_out.clearData();
		ds_msg_out.copyData(ds_msg);

		if ( ds_msg_out.rowcount != 0 )  {
			var strMsg ="";
			for ( var q=0; q<ds_msg_out.rowcount; q++ ) {
				if ( ds_msg_out.getColumn(q, "TYPE") == "I" ) {
					strMsg += ds_msg_out.getColumn(q, "MSG")+"\r\n";
				}
			}
			
			if ( !gfn_isNull(strMsg) ) {
				g_Message("", strMsg);
			}
			
			var rowPos = ds_msg_out.findRow("TYPE", "N");
			if ( rowPos != -1 ) {
				g_Message("", ds_msg_out.getColumn(rowPos, "MSG"));
				
				//trace("MENU_ID=="+this.parent._fv_menuId);
				application.afrm_Bottom.form.fn_reOpenMenu(this.parent._fv_menuId);
				this.getOwnerFrame().form.close();
				return;
			}
			
			ds_msg_out.clearData();
		}
		
		fn_search();	// 재조회
		
	} else {
		g_Message("EE",fn_AlertMsg("002"));
	}
	
		
}
function fn_ChkManNull()
{
	if (ffn_ChkNull(comp_upjang.getUpjangCode()))
	{
		g_Message("EE", "사업장" + fn_AlertMsg("005"));
		if (comp_upjang.enable) comp_upjang.setFocus();
		return true;
	}
	if (ffn_ChkNull(cbo_Subinv.value))
	{
		g_Message("EE", "식당을 선택하세요.");
		if (cbo_Subinv.enable) cbo_Subinv.setFocus();
		return true;
	}
	if ( ffn_ChkNull(cbo_NeedDate.value) || (gfn_length(cbo_NeedDate.value)< 8) )
	{
		g_Message("EE", "반환회수일을 정확하게 입력하세요.");
		cbo_NeedDate.setFocus();
		return true;
	}

	//
	return false;
}
function fn_ChkData(checkDs)
{
	//변경여부 확인
	if ( (! gfn_dsIsUpdated(ds_Listb)) )
	{
		return fn_AlertMsg("007");
	}

	//상품별 디데이 체크
	for (i=0; i < ds_Listb.rowcount; i++)
	{
		if (GetRowType(ds_Listb, i) <> 'normal')
		{
			//수량 0인건 어차피 지울꺼니 패스...
			//if ( NumFormat(ds_List.GetColumn(i,"PR_QTY"),1) == "0.0" ) continue;
			if (( GetRowType(ds_Listb, i)== 'insert' ) && ( gfn_numFormat(gfn_trim(ds_Listb.getColumn(i,"prQty")),1)== "0" )) continue;
			//기존자료이거나 무통제면 패스...
			if ( numFormat(ds_Listb.getColumn(i,"dDays"))== "0" ) continue;

			if (fn_GetDayStatus(ds_Listb.getColumn(i,"dDays"), ds_Listb.getColumn(i,"dTimes")) == "0")
			{
				ds_Listb.rowposition = i;
				return ("[" + ds_Listb.getColumn(i,"itemName") + "]상품은 마감시간(D-Days)을 초과하여 주문이 불가합니다.");
			}
		}
        //-----------------------------------------------------------------------------------
		//--- 체크로직 추가 
		//    수정일    : 2010/10/28 BY 노규완
		//    수정내용  : 상품 수량 입력 시 기존에는 라인별로 최대발주량 체크 하였으나,
		//                추가 상품으로 동일 상품을 등록 한 다음 최대 발주량만 넘지 않으면 
		//                추가로 상품이 저장 되는 문제가 발생하여, 입고 예정일 기준으로 
		//                동일 상품의 총 합계를 체크 하여 최대 발주량을 넘는지 체크 한다.
		//    수정일    : 2013/08/01 BY 박용대
		//    수정내용  : 상품을 저장할때 아이리스에서 취소한 목록들이 발주내역에 올라오게되는데
		//                이것들이 최대 발주량계산에 포함되어 있어 발주상태가 003,005인 항목을
		//                제외하고 CASESUM 하는 부분을 추가.
		//-----------------------------------------------------------------------------------		
		if ((ds_Listb.getColumn(i,"maxOrdQty") > 0) && ( ds_Listb.getCaseSum("itemCode=='"+ds_Listb.getColumn(i,"itemCode")+"'&& (lineStatus <> '001' && lineStatus <> '003' && lineStatus <> '004')","prQty") > ds_Listb.getColumn(i,"maxOrdQty")))  
		{   
		    if (toNumber(ds_Listb.getColumn(i,"prNum")) <> 0)
		    {
		        //동일상품의 다른 주문날짜일 경우 합산은 최대발주량을 넘어도 상관없다.
		        if ( ds_Listb.getCaseSum("prNum=='"+ds_Listb.getColumn(i,"prNum")+"'","prQty") <= ds_Listb.getColumn(i,"maxOrdQty"))
		            continue;
		    }
       	    ds_Listb.rowposition = i;
		    return ("[" + ds_Listb.getColumn(i,"itemName") + "] 상품이 최대 발주량" + ds_Listb.getColumn(i,"maxOrdQty") + ")를 초과하여 주문이 불가합니다.");		    
		}		
	}
	
	var rtnCheckMsg = fn_checkLineStatus(null, checkDs);
	if ( !gfn_isNull(rtnCheckMsg) ) {
		return rtnCheckMsg;
	}
	
	// 저장 시 수량이 0 이거나 NULL 인 자재 삭제 처리
	for( var i = ds_Listb.getRowCount()-1; i >= 0; i-- ) {		
		if( ds_Listb.getColumn(i, "prQty") == 0 || gfn_length(gfn_trim(ds_Listb.getColumn(i, "prQty"))) == 0 ) {
			ds_Listb.deleteRow(i);
		}		
	}
}

function fn_FormKeyDown(obj:Form, e:KeyEventInfo)
{
	if(e.ctrlKey == true && e.keycode == 86) {
		//'true'를 반환하면 상위 컴포넌트에서 onkeydown 이벤트가 발생하지 않습니다.
		return true;
	}
	
	gfn_formKeyDown(obj, e); //(obj,e.fromreferenceobject,e.keycode,e.shiftKey,e.ctrlKey,e.altKey,-1,-1);
	
	//입고예정일에서 엔터시 조회
	//if ( (nChar == 13) && (objSenderObj == cbo_NeedDate) ) fn_Search();
	//임시로...'F12'입력시 타이머 작동중지
	if (e.keycode == 123) killTimer(777);
}	

function fn_Trigger_bef(o, c) {
   	
//    	if(gfn_dsIsUpdated(ds_Listb))
//    	{
// 		if(g_Confirm("02","변경된 내역이 있습니다. 변경된 내역을 저장하시겠습니까?"))
// 		{
// 			fn_save(1);			
// 		} 
// 	}
// 	
// 	return true;
}

function fn_Trigger_aft(obj, arrRtn)
{
// // 	switch(obj.name)
// // 	{
// // 		case "comp_upjang":						
// 			//초기화
// 			fn_ResetData();
// 
// 			if (! ffn_ChkNull(comp_upjang.getUpjangCode()))
// 			{
// 				//센터단가업장정보
// 				if(!fn_SetCtUpj()) return;
// 				
// 				//창고세팅
// 				fn_SetSubinv(ds_Subinv);
// 				
// 				//디데이
// 				fn_GetDays();
// 				
// 				//자동조회				
// 				fn_search();
// 			}
// // 			break;
// // 
// // 		default:
// // 			break;
// // 	}
}
function fn_ResetData()
{
	ds_Subinv.clearData();	
	st_Days.text = "(발주 마감 : - -)";
	st_Timer.text = "";	
	cbo_Subinv.value = ""; 	
	ds_List.clearData();
	ds_Listb.clearData(); 	
	//var strCurrent = fn_CurrDateWeek();
	//cbo_NeedDate.value  = gfn_addDate(strCurrent,1); //addDate(today(),1);
 	
 	if(gfn_nvl(cbo_NeedDate.value,"") != ""){ 	
		//날자 셋팅 후 일자도 변경
		st_Week.text = "(" + ffn_DayToWeek(cbo_NeedDate.value) + ")";
		if (st_Week.text == "(토)")
			st_Week.style.color = "blue";
		else if (st_Week.text == "(일)")
			st_Week.style.color = "red";
		else
			st_Week.style.color = "black";
		//공휴일색변경	
		if(gfn_length(fn_isHoliday(cbo_NeedDate.value))>0)
		{
			st_Week.style.color = "red";
		}
	}else{
		st_Week.text = "(-)";
		st_Week.style.color = "black";
	}

}
function fn_SetSubinv(ds_Obj)
{
	/*-------------*/
	http.Sync = true;
	/*-------------*/
	// 초기화
	ds_Obj.clearData();
	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	// 파라미터셋팅
    outData		= ds_Obj.name + "=ds_List";
	otherArg	= "UPJANG=" + gfn_nvl(wrapQuote(comp_upjang.getUpjangCode()),"");
		
	//action 정보 초기화 
	fsp_clear(this); 
    // 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "fm/fmz:FMZ_PO_SUBINV_S001");
	// 서버 호출 
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);
	/*-------------*/
	http.Sync = false;
	/*-------------*/
	//기본창고지정
	if (ds_Obj.rowcount > 0) cbo_Subinv.index = 0;
}

function fn_GetDays()
{
	// 초기화(디데이)
	ds_Days.clearData();
	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	// 파라미터셋팅
    outData		= "ds_Days=ds_List";
    otherArg	= "UPJANG=" + gfn_nvl(wrapQuote(comp_upjang.getUpjangCode()),"") + " SUBINV_CODE=" + wrapQuote(cbo_Subinv.value) + " NEED_DATE=" + wrapQuote(cbo_NeedDate.value);
	//action 정보 초기화 
	fsp_clear(this); 
    // 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "fm/fmz:FMZ_GETDAYS_S001");
	// 서버 호출 
	http.Sync = true;
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);
	http.Sync = false;
	//디데이 표시
	if (ds_Days.rowcount > 0){
		var set1 = v_dsT.getColumn(0, "set1");
		var set2 = v_dsT.getColumn(0, "set2");
		var attr01 = v_dsT.getColumn(0, "attr01");
		var attr02 = v_dsT.getColumn(0, "attr02");		
		if(set1 <= cbo_NeedDate.value && set2 >= cbo_NeedDate.value){		
			ds_Days.setColumn(0,"D_TIMES" ,attr01);		
			ds_Days.setColumn(0,"DAYS", "D-"+ds_Days.getColumn(0,"D_DAYS")+" "+attr01.substr(0,2)+":"+attr01.substr(2,2));		
		} else {		
			ds_Days.setColumn(0,"D_TIMES" ,attr02);		
			ds_Days.setColumn(0,"DAYS", "D-"+ds_Days.getColumn(0,"D_DAYS")+" "+attr02.substr(0,2)+":"+attr02.substr(2,2));		
		}	
		st_Days.text = "(발주 마감 : " + ds_Days.getColumn(0,"DAYS") + ")";
	}
	else
	{
		g_Message("EE","발주마감정보를 확인할 수 없습니다.!" + "\n\n" + "관리자에게 문의하세요.");
		//close();
	}
	// 초기화(주문통제)
	ds_OrdCtrl.clearData();
	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	// 파라미터셋팅
    outData		= "ds_OrdCtrl=ds_List";
    otherArg	= "UPJANG=" + gfn_nvl(wrapQuote(comp_upjang.getUpjangCode()),"");
	//action 정보 초기화 
	fsp_clear(this); 
    // 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "fm/fmz:FMZ_ORD_CTRL_S001");
	// 서버 호출 
	http.Sync = true;
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);
	http.Sync = false;
}

function fn_OrdChk()
{
	fn_GetDays();
	fn_CurrDateWeek();

	//입고통제일 체크 
	if (fn_NeedDateCheck()) 
	{
	    g_Message("EE","해당일자는 입고통제일 입니다.");
   	    ds_List.clearData();
	    ds_Listb.clearData();
		st_Timer.text = "마감시간 : 00일 00시간 00분 전";
		return false;
	}

	//발주통제일자
	if (toNumber(ds_Days.getColumn(0,"D_OVER_DAYS")) > 0)
	{
		if (cbo_NeedDate.value > gfn_addDate(gds_currdate.getColumn(0, "YMD"),toNumber(ds_Days.getColumn(0,"D_OVER_DAYS"))))
		{
			g_Message("EE", ds_Days.getColumn(0,"D_OVER_DAYS") + "일을 초과하여 반환회수일을 지정할 수 없습니다.");
			return false;
		}
	}
	//발주제한일자
	if (toNumber(ds_Days.getColumn(0,"D_DAYS")) > 0)
	{
		if (cbo_NeedDate.value < gfn_addDate(gds_currdate.getColumn(0, "YMD"),toNumber(ds_Days.getColumn(0,"D_DAYS"))))
		{
			g_Message("EE", "발주마감은 " + ds_Days.getColumn(0,"DAYS") + "입니다.");
			return false;
		}
		if (cbo_NeedDate.value == gfn_addDate(gds_currdate.getColumn(0, "YMD"),toNumber(ds_Days.getColumn(0,"D_DAYS"))))
		{
			if (gfn_subStr(gds_currdate.getColumn(0, "YMD_TM"),8,6)> ds_Days.getColumn(0,"D_TIMES"))
			{
				g_Message("EE", "발주마감은 " + ds_Days.getColumn(0,"DAYS") + "입니다.");
				return false;
			}
		}
	}
	//창고가 식재 또는 소모품 전용창고인 경우 주문통제 점검
	if (! ffn_ChkNull(ds_Subinv.getColumn(ds_Subinv.rowposition,"CONSUM_YN")))
	{
		//주문통제(주문일자)
		var nRow;
		nRow = ds_OrdCtrl.findRowExpr("CTRL_TYPE=='주문'&&ITEM_TYPE==decode('" + ds_Subinv.getColumn(ds_Subinv.rowposition,"CONSUM_YN") + "','Y','소모품','식자재')");
		if (nRow >= 0)
		{
			if (ds_OrdCtrl.getColumn(nRow,ToUpper(gds_currdate.getColumn(0, "WEEK_ENG"))) == "Y")
			{
				g_Message("EE", gds_currdate.getColumn(0, "WEEK_KOR") + "요일은 주문불가 요일입니다.");
				return false;
			}
		}
		//주문통제(입고일자)
		nRow = ds_OrdCtrl.findRowExpr("CTRL_TYPE=='입고'&&ITEM_TYPE==decode('" + ds_Subinv.getColumn(ds_Subinv.rowposition,"CONSUM_YN") + "','Y','소모품','식자재')");
		if (nRow >= 0)
		{
			if (ds_OrdCtrl.getColumn(nRow,ToUpper(ffn_DayToWeek(cbo_NeedDate.value,"1"))) == "Y")
			{
				g_Message("EE", ffn_DayToWeek(cbo_NeedDate.value) + "요일은 입고불가 요일입니다." + "\n\n" + "반환회수일을 변경하세요.");
				return false;
			}
		}
	}else{
		//주문통제(입고일자)
		nRow = ds_OrdCtrl.findRowExpr("CTRL_TYPE=='입고'&&ITEM_TYPE=='공통'");
		if (nRow >= 0)
		{
			if (ds_OrdCtrl.getColumn(nRow,ToUpper(ffn_DayToWeek(cbo_NeedDate.value,"1"))) == "Y")
			{
				g_Message("EE", ffn_DayToWeek(cbo_NeedDate.value) + "요일은 입고불가 요일입니다." + "\n\n" + "반환회수일을 변경하세요.");
				return false;
			}
		}	
	}
	//
	return true;
}

function fn_SetCtUpj()
{
	/*-------------*/
	http.Sync = true;
	/*-------------*/
	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	// 파라미터셋팅
    outData		= "ds_CtUpj=ds_List";
    otherArg	= "UPJANG=" + gfn_nvl(wrapQuote(comp_upjang.getUpjangCode()),"");
	//action 정보 초기화 
	fsp_clear(this); 
    // 서버에서 조회할 정보 추가 
	fsp_addSearch(this, "fm/fmz:FMZ_GET_CTUPJ_S001");
	// 서버 호출 
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);
	/*-------------*/
	http.Sync = false;
	/*-------------*/
	if (ds_CtUpj.rowcount <= 0)
	{
		g_Message("EE","업장기초정보를 확인할 수 없습니다.!" + "\n\n" + "관리자에게 문의하세요.");
		return false;
	}
	return true;
}

//[PJT]주문채널통합
function fn_CopyRow(obj,nRow, sInputType)
{

	if(gfn_isNull(sInputType)) sInputType = "S";
	
	if ( ds_Listb.findRowExpr("itemCode=="+wrapQuote(obj.getColumn(nRow,"ITEM_CODE"))) >= 0 )
	{
		if (! g_Confirm("01", '이미 주문등록한 상품입니다.\n\n추가주문 하시겠습니까?!')) return;
	}
	//trace(eval("ds_Listb" + gfn_toString(tab_list.tabindex+1)).saveXML());
	var nAddRow = ds_Listb.addRow();
	ds_Listb.copyRow(ds_Listb.rowposition, obj, nRow, fv_copyColumInfo);
	//기본적으로 신청수량은 기본 0으로 설정한다.
	ds_Listb.setColumn(ds_Listb.rowposition, "prQty", 0);   //수량
	ds_Listb.setColumn(ds_Listb.rowposition, "opAmount", 0); //금액

	ds_Listb.setColumn(ds_Listb.rowposition, "sNeedDate", cbo_NeedDate.value); //ds처리
	ds_Listb.setColumn(ds_Listb.rowposition, "gUpjang", g_Upjang); //ds처리	
	//ds_Listb.setColumn(ds_Listb.rowposition, "tabName", "tab1"); //ds처리

	//반환타입 기본세팅값
// 	if(gfn_toString(tab_list.tabindex+1) != 3){
// 		eval("ds_Listb" + gfn_toString(tab_list.tabindex+1)).setColumn(eval("ds_Listb" + gfn_toString(tab_list.tabindex+1)).rowposition, "rtnOrdType", "A01"); 
// 	}
	
	ds_Listb.setColumn(ds_Listb.rowposition, "inputType", sInputType);
	
	// for only 화성네트웍스-상지대학교부속한방병원[162851]
	if ( obj.getColumn(obj.rowposition, "RC_UPJANG") == "162851" ) {
		ds_Listb.setColumn(ds_Listb.rowposition, "prRemark", obj.getColumn(obj.rowposition, "PR_REMARK_RECENT"));
	}
	
}

//[PJT]주문채널통합
function fn_CopyRowPaste(obj, nSetRow, nRow, sInputType)
{
	if(gfn_isNull(sInputType)) sInputType = "S";

	ds_Listb.copyRow(nSetRow, obj, nRow, fv_copyColumInfo);
	//기본적으로 신청수량은 기본 0으로 설정한다.
	ds_Listb.setColumn(nSetRow, "prQty", 0);
	ds_Listb.setColumn(nSetRow, "inputType", sInputType);
	//반환/교환일경우만 기본세팅값
// 	if(gfn_toString(tab_list.tabindex+1) != 3){
// 		eval("ds_Listb" + gfn_toString(tab_list.tabindex+1)).setColumn(nSetRow, "rtnOrdType", "A01"); 		
// 	}
	ds_Listb.setColumn(nSetRow, "sNeedDate", cbo_NeedDate.value);	//ds처리
	ds_Listb.setColumn(nSetRow, "gUpjang", g_Upjang);	//ds처리	
	//ds_Listb.setColumn(nSetRow, "tabName", "tab1");	//ds처리
}

function fn_SetRowImg(nDdays,nDtimes,sWeekItemCode,sUnuseYn,sValSptYn,sPoStatus,sDangaWeekStatus)
{	
	//품목별 D-Day설정과 전체 D-Day설정을 비교하여 빠른것을 기준으로 한다.
	var nDdays1 = greatest(toNumber(nDdays), toNumber(ds_Days.getColumn(0,"D_DAYS")));
	
	var nDtimes1;
	if ( toNumber(nDdays) > toNumber(ds_Days.getColumn(0,"D_DAYS")) )
		nDtimes1 = nDtimes;
	else if ( toNumber(nDdays) == toNumber(ds_Days.getColumn(0,"D_DAYS")) )
		nDtimes1 = least(nDtimes,ds_Days.getColumn(0,"D_TIMES"));
	else if ( toNumber(nDdays) < toNumber(ds_Days.getColumn(0,"D_DAYS")) )
		nDtimes1 = ds_Days.getColumn(0,"D_TIMES");
	
	if (sUnuseYn=="UK" || sValSptYn=="TK" || sPoStatus =="HE" || sDangaWeekStatus =="FE") //구매불용, 구매중지, 수발주스케쥴, 단가업장 수발주 스케쥴
	{
		return "theme://convertImages\\img_RC.png";
	}else{
		return decode(fn_GetDayStatus(nDdays,nDtimes,sWeekItemCode),"0","theme://convertImages\\img_RC.png","1","theme://convertImages\\img_YC.png","2","theme://convertImages\\img_GC.png","");
	}
}

function fn_SetRowColor(nDdays,nDtimes,sWeekItemCode,sUnuseYn,sValSptYn,sPoStatus,sDangaWeekStatus)
{
	var bDayStatus;
	
	if(fn_GetDayStatus(nDdays,nDtimes,sWeekItemCode) == "0")
	{
		bDayStatus = true;
	}else{
		bDayStatus = false;
	}
	
	if(sUnuseYn=="UK" || sValSptYn=="TK" || bDayStatus || sPoStatus =="HE" || sDangaWeekStatus =="FE") //구매불용, 구매중지, 수발주스케쥴, 단가업장 수발주 스케쥴 
	{
		return "thistle";
	}else{
		return "white";
	}
}

function fn_GetDayStatus(nDdays,nDtimes,sWeekItemCode)
{
	//리조트 물류스케주울 체크
	if (! ffn_ChkNull(sWeekItemCode)) return "0";
	//무통제면 패스...
	if ( numFormat(nDdays)== "0" )	return "2";
	//디데이체크
	if ( gfn_addDate(gds_currdate.getColumn(0,"YMD"),nDdays)> cbo_NeedDate.value )
		return "0";
	else if ( gfn_addDate(gds_currdate.getColumn(0,"YMD"),nDdays)== cbo_NeedDate.value )
	{
		//디타임체크
		if ( gfn_subStr(gds_currdate.getColumn(0, "YMD_TM"),8,4)> nDtimes )
			return "0";
		else if ( G_fn_GapTime(0, gfn_subStr(gds_currdate.getColumn(0, "YMD_TM"),8,4), nDtimes, "") <= "0030" )
			return "1";
		else
			return "2";
	}
	else
		return "2";
}

//=========================================================================================
// [ PART 6 ]
// component Event 정의 ( User Define function )
// --> component Event의 기요,기능,동작 등 상세내용은 MiPlatform 메뉴얼을 참조하시기 바랍니다.
//=========================================================================================
function gd_list_OnHeadClick(obj:Grid, e:GridClickEventInfo)
{
	var strHeadClass = obj.getCellProperty("head", e.col,"class");
    //if(strHeadClass == "head_Excel")
    //{
		// 출력용 그리드
		//gfn_exportExcel(tab_list.tabpages["tab"+parseInt(tab_list.tabindex+1)].gd_list);
		//return;
    //} else {
		gfn_gridSort(obj, e); //(eval(obj.binddataset), obj, e.cell);
	//}
}

// 발주내역 그리드
function gd_list_OnHeadClick1(obj:Grid, e:GridClickEventInfo)
{
	gfn_gridSort(obj, e); //(eval(obj.binddataset), obj, e.cell);
}

function cbo_Subinv_OnChanged(obj:Combo, e:ItemChangeEventInfo)
{
	//데이타셑 위치변경
	eval(obj.innerdataset).rowposition = e.postindex;
	//초기화
	if (obj == cbo_Subinv)
	{
		ed_Pcnt.value = "";
		ed_Pamt.value = "";
		ds_Listb.clearData();
		ds_List.clearData();		
		
		//디데이
		fn_GetDays();
		
		//자동조회
		fn_search();
	} 
}

function cbo_Subinv_canitemchange(obj:Combo, e:ItemChangeEventInfo)
{
	if(gfn_dsIsUpdated(ds_Listb)==true)
	{
		if(g_Confirm("02","변경된 내역이 있습니다. 변경된 내역을 저장하시겠습니까?"))
		{	
			fn_save();
			return true;
		}   else {
			return false;
		}
	} else {
		return true;
	}
}

function ds_List_CanColumnChange(obj:Dataset, e:DSColChangeEventInfo)
{
	//[PJT]주문채널통합
	if(fv_isCopyPaste == true){
		//trace("copy and paste CanColumnChange return");
		return true;
	}

	//[PJT]주문채널통합
	//박스수량 OR 낱개수량 변경
	if (e.columnid == "prBoxQty" || e.columnid == "prPcQty")
	{
		var nPrQty = e.columnid == "prBoxQty" 
		                 ? (toNumber(e.newvalue, 0) * toNumber(obj.getColumn(e.row, "boxQty"), 0)) + toNumber(obj.getColumn(e.row, "prPcQty"), 0)
		                 : (toNumber(obj.getColumn(e.row, "prBoxQty"), 0) * toNumber(obj.getColumn(e.row, "boxQty"), 0)) + toNumber(e.newvalue, 0);
		//(-)발주여부
		if ( toNumber(nPrQty) < 0 )
		{
			g_Message("EE","(-)발주는 불가합니다.");
			return false;
		}
		//발주마감체크
		fn_CurrDateWeek();
		if (fn_GetDayStatus(obj.getColumn(e.row,"dDays"), obj.getColumn(e.row,"dTimes")) == "0")
		{
			g_Message("EE","해당 상품은 마감시간(D-Days)이 초과되어 수정이 불가합니다.");
			return false;
		}
		//수량통제 안하는 업장의 경우 이하 패스...
		//if (ds_Days.GetColumn(0,"QTY_CONTROL_YN") = "N") return;
		//
		//수량통제 안하는 업장의 경우 소숫점발주가 Y이면 무조건 최소발주량/발주승수량을 무조건 0.1로 세팅하여 조회
		if ( toNumber(nPrQty) > 0 )
		{
			//trace("발주수량 " + obj.getColumn(e.row,"MIN_ORD_QTY") + " >= " + nPrQty + "(" + obj.getColumn(e.row,"BOX_QTY") + ") <= " + obj.getColumn(e.row,"MAX_ORD_QTY"));
			//최소발주량 체크
			if ( (toNumber(obj.getColumn(e.row,"minOrdQty")) > 0) && (toNumber(obj.getColumn(e.row,"minOrdQty")) > toNumber(nPrQty)) && obj.getColumn(e.row,"keepingType") != "냉동" )
			{
				g_Message("EE","해당 상품은 최소발주량이 " + obj.getColumn(e.row,"minOrdQty") + "입니다.");
				return false;
			}
			
			//최대발주량 체크
			/**
			if ( (toNumber(obj.getColumn(e.row,"MAX_ORD_QTY")) > 0) && (toNumber(obj.getColumn(e.row,"MAX_ORD_QTY")) < toNumber(nPrQty)) )
			{
				g_Message("EE","해당 상품은 최대발주량이 " + obj.getColumn(e.row,"MAX_ORD_QTY") + "입니다.");
				return false;
			}
			**/
			// canColumnChange Event에서 obj.getCaseSum()의 올바른 연산을 위해 함수로 대체
			if ( fn_isOverQty(obj, e, nPrQty) ) {
				g_Message("EE","해당 상품은 최대발주량이 " + obj.getColumn(e.row,"maxOrdQty") + "입니다.");
				// 고객인 경우만 제한
				if( g_EmpNo.substr(0,2) == "CS" ) {
					return false;
				}
			}
			
			//소숫점발주여부
			if ( (obj.getColumn(e.row,"pointFlag") != "Y") && (Math.ceil(toNumber(nPrQty)) != toNumber(nPrQty)) )
			{
				g_Message("EE","해당 상품은 소숫점발주가 불가합니다.");
				return false;
			}
			//발주승수량
			trace("nPrQty " + nPrQty);
			if ( (toNumber(obj.getColumn(e.row,"multiplierQty")) > 0) && ((Math.round(toNumber(nPrQty) * 1000) % Math.round(toNumber(obj.getColumn(e.row,"multiplierQty")) * 1000)) <> 0) )
			{
				g_Message("EE","해당 상품은 발주승수량이 " + obj.getColumn(e.row,"multiplierQty") + "입니다.");
				return false;
			}
		}
		
		//alert(obj.getRowType(e.row) +" : "+ toNumber(nPrQty));
		
// ◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆
// [PJT]주문채널통합
// copy & paste 기능 구현 중 return 처리 없는 case에서 오류발생으로 주석 처리
// grid onkeydown event(ctrl + v)  보다 dataset cancolumnchange event가 선행으로 발생하는 문제
// 		//3개월치 최대발주량 초과시 알람
// 		if ( toNumber(nPrQty) >  toNumber(obj.getColumn(e.row,"MAX_SO_QTY")) )
// 		{
// 			g_Message("EE","해당 상품은 최근 3개월 최대발주량 " + obj.getColumn(e.row,"MAX_SO_QTY") + " 을 초과 하였습니다. ");
// 		}
// ◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆		
		
	} 
	if ( e.columnid == "prRemark" ) {
		if ( gfn_lengthByte(e.newvalue) > 100 ) {
			g_Message("EE","최대 입력 길이(100byte)를 초과 하였습니다.");
			return false;
		} 
	}
	
	return true;
}
function ds_List_OnColumnChanged(obj:Dataset, e:DSColChangeEventInfo)
{
	//[PJT]주문채널통합
	if(fv_isCopyPaste == true){
		//trace("copy and paste CanColumnChange return");
		return true;
	}
	
	//박스수량 OR 낱개수량 변경
	if (e.columnid == "prBoxQty" || e.columnid == "prPcQty"){
	
		// 입수량이 0일경우 경고창 
		if(e.columnid == "prBoxQty" && toNumber(obj.getColumn(e.row, "boxQty"), 0) == 0) {
			g_Message("EE", obj.getColumn(e.row, "itemName")+ " 자재의 입수량이 0입니다.");
			obj.setColumn(e.row, "prBoxQty", 0);
		} 

		var nPrQty = (toNumber(obj.getColumn(e.row, "prBoxQty"), 0) * toNumber(obj.getColumn(e.row, "boxQty"), 0)) + toNumber(obj.getColumn(e.row, "prPcQty"), 0);
		obj.setColumn(e.row, "prQty", nPrQty);
		
		
		//금액계산
		var nAmt = Math.round(toNumber(obj.getColumn(e.row,"salePrice")) * toNumber(nPrQty));
		obj.setColumn(e.row, "saleAmount", nAmt);
		nAmt = Math.round(toNumber(obj.getColumn(e.row,"opPrice")) * toNumber(nPrQty));
		obj.setColumn(e.row, "opAmount", nAmt);
		
		//var nTotWght = Math.round(toNumber(obj.getColumn(e.row, "KG_CONVERT_RATE")) * toNumber(obj.getColumn(e.row, "UOM_CONVERT_RATE")) * toNumber(e.newvalue));
		//var nTotWght = Math.round(toNumber(obj.getColumn(e.row, "KG_CONVERT_RATE")) * toNumber(e.newvalue));
		var nTotWght = Math.round(toNumber(obj.getColumn(e.row, "kgConvertRate")) * toNumber(nPrQty), 3);
		obj.setColumn(e.row, "totWght", nTotWght);
	}

}
function ReturnOrderByCust_ontimer(obj:Form, e:TimerEventInfo)
{
	if (e.timerid == 777) {
		fn_SetTimer();
	}
}
function fn_SetTimer()
{
	//입고통제일 체크 
	if (fn_NeedDateCheck()) 
	{
		st_Timer.text = "마감시간 : 00일 00시간 00분 전";
		return;
	}
	
	//마감시간 표시
	if(fv_stTimeFlag){
		st_Timer.visible = true;
	}else{
		st_Timer.visible = false;
	}

	fn_CurrDateWeek();
	
	// FICS 발주제한요일, 시간 설정 	
	//fn_setWeekendTime();
		
	var sChkDate, sDay, sTime;
	if ( gfn_subStr(gds_currdate.getColumn(0, "YMD_TM"),8,4)>= gfn_trim(ds_Days.getColumn(0,"D_TIMES")) )
	{
		sChkDate = gfn_addDate(cbo_NeedDate.value, (-1 * (toNumber(gfn_trim(ds_Days.getColumn(0,"D_DAYS"))) + 1)));	
		sTime = G_fn_GapTime("1", gfn_subStr(gds_currdate.getColumn(0, "YMD_TM"),8,4), toNumber(gfn_trim(ds_Days.getColumn(0,"D_TIMES"))), "");	
	}
	else
	{
		sChkDate = gfn_addDate(cbo_NeedDate.value, (-1 * toNumber(gfn_trim(ds_Days.getColumn(0,"D_DAYS")))));
		sTime = G_fn_GapTime("0", gfn_subStr(gds_currdate.getColumn(0, "YMD_TM"),8,4), gfn_trim(ds_Days.getColumn(0,"D_TIMES")), "");
	}
	
	if (parseInt(gds_currdate.getColumn(0, "YMD")) <= parseInt(sChkDate))
		sDay = G_fn_CalcDay(gds_currdate.getColumn(0, "YMD"), sChkDate);		
	else
		sDay = G_fn_CalcDay(sChkDate, gds_currdate.getColumn(0, "YMD")) * (-1);		
		
	if ((toNumber(sDay) >= 0) && (toNumber(sDay) < 10)) sDay = "0" + sDay;	
	st_Timer.text = "마감시간 : " + sDay + "일 " + gfn_left(sTime,2)+ "시간 " + gfn_right(sTime,2)+ "분 전";
	
	if(gfn_nvl(cbo_NeedDate.value,"") != ""){
		st_Week.text = "(" + ffn_DayToWeek(cbo_NeedDate.value) + ")";
	}else{
	 	st_Week.text = "(-)";
	 	st_Week.style.color = "black";
	}
	
	if (st_Week.text == "(토)")
		st_Week.style.color = "blue";
	else if (st_Week.text == "(일)")
		st_Week.style.color = "red";
	else
		st_Week.style.color = "black";
	//공휴일색변경	
	if(gfn_length(fn_isHoliday(cbo_NeedDate.value))>0)
	{
		st_Week.style.color = "red";
	}
	
		
	fa_sDay = sDay;	
	if (toNumber(sDay) < 0) fn_CLS_STATUS_Setting(); 	
}

function fn_CLS_STATUS_Setting()
{	
    if (fa_sDay >= 0) return;
    
    ds_Listb.updatecontrol = false;
	for (i=0; i < ds_Listb.rowcount; i++)
	{		
		if (ds_Listb.getColumn(i, "otcustcd") != "0000")
		{		
			ds_Listb.setColumn(i, "clsStatus", "마감");
			ds_Listb.setRowType(i, Dataset.ROWTYPE_NORMAL);
		}
	}
	ds_Listb.updatecontrol = true;	
}
function ed_Item_OnKeyDown(obj, e)
{
	if ( e.keycode == 13 ) fn_SearchItem();
}
function btn_search_OnClick(obj:Button, e:ClickEventInfo)
{
	fn_SearchItem();
}
function btn_search_OnKeyDown(obj:Button, e:KeyEventInfo)
{
	if ( e.keycode == 13 ) btn_search_OnClick(obj);
}
function gd_list_OnCellDblClick(obj:Grid, e)
{
	/*
	  주문시점의 업장, 창고, 입고일자를 저장한다.
	  왜냐하면 주문을 하고 발주내역에 등록이 된 뒤에
	  날짜를 변경하면 발주된된 데이터에 대해서 
	  변경을 하겠습니까? 라고 확인메세지를 주는데
	  여기서 아니오라고 해도 업장과 창고 입고일자는 
	  바뀌어 버리기 때문에(공통함수라서) 
	  아니오 일때는 주문시점의 데이터를 다시 불러와야함
	*/
	pre_need_date = cbo_NeedDate.value;


	//if (obj == gd_list) return;
	if (eval(obj.binddataset).rowcount < 1) return;
	if (e.row < 0) return;
	
	//리조트 물류스케주울 체크
// 	if (! ffn_ChkNull(eval(obj.binddataset).getColumn(e.row,"WEEK_ITEM_CODE")))
// 	{
// 		g_Message("EE","해당 상품은 요일통제 상품입니다!");
// 		return;
// 	}
	//주문통제체크	
// 	if (!ffn_ChkNull(eval(obj.binddataset).getColumnInfo("LIMIT_ITEM"))) {	
// 		if (! ffn_ChkNull(eval(obj.binddataset).getColumn(e.row,"LIMIT_ITEM")))
// 		{
// 			g_Message("EE","해당 상품은 주문통제 상품입니다!" + "\n\n" + "통제내용:" + eval(obj.binddataset).getColumn(e.row,"LIMIT_REASON"));
// 			return;
// 		}
// 	}

// 	if (eval(obj.binddataset).getColumn(eval(obj.binddataset).rowposition,"UNUSE_YN") == "UK" || eval(obj.binddataset).getColumn(eval(obj.binddataset).rowposition,"VAL_STP_YN") == "TK" ) 
// 	{	
// 		g_Message("EE","해당 상품은 주문불가 상품입니다!");
// 		return;
// 	}	
	
	//단가업장 수발주 요일 제한 상품 체크
// 	if (eval(obj.binddataset).getColumn(eval(obj.binddataset).rowposition,"DANGAWEEK_STATUS") == "FE")
// 	{
// 		g_Message("EE","해당 상품은 단가업장 수발주 요일 제한 상품입니다!");
// 		return;
// 	}	

	//발주마감체크
	if (fn_GetDayStatus(eval(obj.binddataset).getColumn(e.row,"D_DAYS"), eval(obj.binddataset).getColumn(e.row,"D_TIMES")) == "0")
	{
		//g_Message("EE","마감시간이 초과되어 주문이 불가합니다.");
		return;
	}
	//창고가 식재/소모품 통합창고인 경우 주문통제 점검
	if (ffn_ChkNull(ds_Subinv.getColumn(ds_Subinv.rowposition,"CONSUM_YN")))
	{
		//주문통제(주문일자)
		var jRow;
		jRow = ds_OrdCtrl.findRowExpr("CTRL_TYPE=='주문'&&ITEM_TYPE==iif('" + eval(obj.binddataset).getColumn(e.row,"CONSUM_YN") + "','Y','소모품','식자재')");
		if (jRow >= 0)
		{
			if (ds_OrdCtrl.getColumn(jRow,ToUpper(gds_currdate.getColumn(0, "WEEK_ENG"))) == "Y")
			{
				g_Message("EE", gds_currdate.getColumn(0, "WEEK_KOR") + "요일은 " + ds_OrdCtrl.getColumn(jRow,"ITEM_TYPE") + " 주문불가 요일입니다.");
				return;
			}
		}
		//주문통제(입고일자)
		jRow = ds_OrdCtrl.findRowExpr("CTRL_TYPE=='입고'&&ITEM_TYPE==iif('" + eval(obj.binddataset).getColumn(e.row,"CONSUM_YN") + "','Y','소모품','식자재')");
		if (jRow >= 0)
		{
			if (ds_OrdCtrl.getColumn(jRow,ToUpper(ffn_DayToWeek(cbo_NeedDate.value,"1"))) == "Y")
			{
				g_Message("EE", ffn_DayToWeek(cbo_NeedDate.value) + "요일은 " + ds_OrdCtrl.getColumn(jRow,"ITEM_TYPE") + " 입고불가 요일입니다." + "\n\n" + "반환회수일을 변경하세요.");
				return;
			}
		}
	}else{
		//주문통제(입고일자)
		jRow = ds_OrdCtrl.findRowExpr("CTRL_TYPE=='입고'&&ITEM_TYPE=='공통'");
		if (jRow >= 0)
		{
			if (ds_OrdCtrl.getColumn(jRow,ToUpper(ffn_DayToWeek(cbo_NeedDate.value,"1"))) == "Y")
			{
				g_Message("EE", ffn_DayToWeek(cbo_NeedDate.value) + "요일은 " + ds_OrdCtrl.getColumn(jRow,"ITEM_TYPE") + " 입고불가 요일입니다." + "\n\n" + "반환회수일을 변경하세요.");
				return;
			}
		}	
	}
	
	//라인복사
	fn_CopyRow(eval(obj.binddataset), e.row, "S");
	
	//obj.SetFocus();
	
	gd_listb.setFocus();
	gd_listb.setCellPos(9); //[PJT]주문채널통합
	
}

function gd_list_OnCellClick(obj:Grid, e:GridClickEventInfo)
{

 	if (eval(obj.binddataset).rowcount < 1) return;
 	if (e.row < 0) return;
 	if (e.cell <> 1) return;

	var arrParam = new Array();
	
	arrParam[0] = eval(obj.binddataset).getColumn(e.row, "ITEM_CODE");
	
	var rtnVal = gfn_dialog("FMP00010P"			// dialogId
				   , "U_FMP::FMP00010P.xfdl"		// Url
				   , {fv_Contents:arrParam}					// 배열
				   , null, null, null, null, null, false, true, -1);

}
function ReturnOrderByCust_onactivate(obj:Form, e:ActivateEventInfo)
{
	//화면 액트브시 타이머 재설정	
	fn_SetTimer();
	setTimer(777,30000); //일단 30초 세팅
	
}
function ReturnOrderByCust_ondeactivate(obj:Form, e:ActivateEventInfo)
{
	//타이머 종료...(타이머 발생으로 쿼리 수행하여 결과값 가져오면 화면이 앞으로 올라온다.
	killTimer(777);
}

function gd_listb_onkeydown(obj:Grid, e:KeyEventInfo)
{
	if (e.keycode == 13) {		
		if ((ds_Listb.getCountNF() == ds_Listb.rowposition + 1) && (gd_listb.getCellPos() == 18)) { //18
			//trace(ds_List.getCountNF() +"::"+ (ds_List.rowposition + 1) + "::" + gd_list.getCellPos());
			ed_Item.setFocus();
			return true; //Focus 이상으로 추가함.
		}	
	}
	
	//[PJT]주문채널통합
	// Ctrl + V	: Paste
	else if(e.ctrlKey == true && e.keycode == 86) {

		var sClip = new String(system.getClipboard("CF_UNICODETEXT"));
		
		if(gfn_isNull(gfn_trim(sClip, ""))){
			g_Message("EE", "붙여넣기 할 데이터가 없습니다.");
			return true;
		}
		
		//필수항목 
		if (fn_ChkManNull()) return true;
		
		//입고통제일 체크 
		if (fn_NeedDateCheck()) 
		{
			g_Message("EE","해당일자는 입고통제일 입니다.");
			ds_Listb.clearData();
			ds_List.clearData();
			st_Timer.text = "마감시간 : 00일 00시간 00분 전";
			return true;
		}
		
		fv_isCopyPaste = true;
		
		var nCellPos = Math.max(0, gd_listb.getCellPos());
		var sColumn  = gfn_replace( gfn_toString(gd_listb.getCellProperty("body", nCellPos, "text")), "bind:", "");
		var nRowPos  = ds_Listb.rowposition;
		var sDataArr = sClip.split("\r\n");
		var bNum     = false; 
		
		//ctrl + v 제외 처리 T_ORDER 실발주자, PR_REMARK 비고
		//if(sColumn == "T_ORDER" ||  sColumn == "prRemark") {
		if(sColumn == "prRemark") {					
			fv_isCopyPaste = false;
			return true;
		}

		//PR_BOX_QTY 박스수량, PR_PC_QTY 낱개수량, PR_REMARK 비고
		else if(sColumn != "prBoxQty" && sColumn != "prPcQty"){
			//입력가능한  컬럼이 아니면 바코드로 설정
			sColumn = "winItemCd";
		}
		//trace("sColumn :: " + sColumn);
		//숫자만 입력 컬럼
		if(sColumn == "prBoxQty" || sColumn == "prPcQty"){
			bNum = true;
		}
		
		//마지막 빈값이면 배열에서 제거함. >> 뒤부터 빈값이면 제거
		for(var i = sDataArr.length-1; i >= 0; i--){
			if(gfn_isNull(gfn_trim(sDataArr[i]))){
				sDataArr.pop();
			} else {
				break;
			}
		}
		
		//붙여넣기 row find
		var nFindRow = ds_Listb.findRowExpr("inputType == 'P'"); //P : PASTE(발주내역 그리드 붙여넣기), S : SELECT(상품검색 그리드 더블클릭), N : NOMAL(조회)
		if(sColumn == "winItemCd"){

			if(nFindRow > -1 && gfn_confirm("이전에 붙여넣기된 데이터가 사라집니다.\n계속 진행 하시겠습니까?") == false){
				fv_isCopyPaste = false;			
				return true;
			}
			
			//삭제 처리
			if(nFindRow > -1){
				ds_Listb.enableevent = false;
				for(var i = ds_Listb.rowcount-1; i >= 0; i--){
					if(ds_Listb.getColumn(i, "inputType") == "P"){
						ds_Listb.deleteRow(i);
					}
				}
				ds_Listb.enableevent = true;
			}
			nRowPos  = ds_Listb.rowcount-1;

			//바코드는 temp dataset에 입력 & 상품조회.
			ds_Listb.enableevent = false;
			for(var i = 0; i < sDataArr.length; i++){
				
				var sItemStatus = "N";
				var sItemName = "바코드 상품 조회중";
				var nAddRow = ds_Listb.addRow();
				var sValue = gfn_trim(sDataArr[i]);
				ds_Listb.setColumn(nAddRow, sColumn, sValue);
				
				if(!gfn_isDigit(sValue)){
					sItemStatus = "E";
				    sItemName = "올바른 바코드 형식이 아닙니다.";
				}
				
				//기본값 설정
				ds_Listb.setColumn(nAddRow, "itemName"  , sItemName);//상품명
				ds_Listb.setColumn(nAddRow, "opPrice"   , 0);//단가
				ds_Listb.setColumn(nAddRow, "opPriceTax"   , 0);//단가
				ds_Listb.setColumn(nAddRow, "minOrdQty", 0);//박스수량
				ds_Listb.setColumn(nAddRow, "prBoxQty" , 0);//최소단위주문수량
				ds_Listb.setColumn(nAddRow, "prPcQty"  , 0);//낱개수량
				ds_Listb.setColumn(nAddRow, "prQty"     , 0);//수량총계
				ds_Listb.setColumn(nAddRow, "opAmount"  , 0);//금액
				ds_Listb.setColumn(nAddRow, "totWght"   , 0);//총중량
				
				//상태값
				ds_Listb.setColumn(nAddRow, "inputType" , "P");
				ds_Listb.setColumn(nAddRow, "itemStatus", sItemStatus);

			}
			ds_Listb.enableevent = true;

			//바코드 처리를 위한 row값 저장변수
			fv_searchBarcodeRowIdx = nRowPos+1;
			
			//바코드로 상품코드 조회 시작
			var nX = parseInt(this.position.width/2, 10) - parseInt(pgb_order.position.width/2, 10) ;
			var nY = parseInt(this.position.height/2, 10) - parseInt(pgb_order.position.height/2, 10);		
			pgb_order.move(nX, nY);			
			pgb_order.visible = true;
			fn_SearchItemBarcode();
			
		} // end if(sColumn == "WIN_ITEM_CD")
		else {
		
			var nForCnt = Math.min((ds_Listb.rowcount - nRowPos ), sDataArr.length);
			
			//단건이면 pass
			if(nForCnt == 1){
				fv_isCopyPaste = false;			
				return true;
			}
			
			//발주마감체크
			fn_CurrDateWeek(); // 일자조회???
			
			gd_listb.setCellPos(0);// 다른 cell로 이동하지 않으면 첫 row에 이상한 값이 들어온다.
			var validMsgArr = new Array(); //validation
			ds_Listb.enableevent = false;
			
			var boxQtyZeroIndex = 0;
			var boxQtyZeroMsg = "";
			
			for(var i = 0; i < nForCnt ; i++){
			
				var nCurRow = nRowPos+i;
				var sValue = gfn_trim(sDataArr[i]);				
			
				//붙여넣기 Row만 처리
				if(ds_Listb.getColumn(nCurRow, "inputType") != "P"){
					continue;
				}
				//상품검색 오류 Row pass
				if(ds_Listb.getColumn(nCurRow, "itemStatus") == "E"){
					continue;
				}
				//nLastRow = nCurRow;
				
				if(bNum == true){
					// ,등이 들어올 수 있으니 replace 처리					
					sValue = gfn_nvl(sValue.replace(/[^0-9\. ]/g,""),0);					
				}
				
				// 박스입수량이 0인데 입력한숫자가 0보다 크다면 alert 후 0으로 값 변경
				if(sColumn == "prBoxQty") { 
					if( ds_Listb.getColumn(nCurRow, "boxQty") == 0 && (sValue > 0) ) {
						if(boxQtyZeroMsg==""){ boxQtyZeroMsg += gfn_toString(ds_Listb.getColumn(nCurRow, "itemName")); }
						boxQtyZeroIndex++;
						sValue=0;
					}
					//trace(boxQtyZeroMsg + " 외 " + (boxQtyZeroIndex-1) + " 개의 입수량이 0입니다.");
				}
				
				var objOldValue = ds_Listb.getColumn(nCurRow, sColumn); // 이전값 저장
				ds_Listb.setColumn(nCurRow, sColumn, sValue);
				
				var sWinItemCd = ds_Listb.getColumn(nCurRow, "winItemCd");
				if(ds_Listb.getColumn(nCurRow, "itemStatus") == "E"){
					ds_Listb.setColumn(nCurRow, sColumn, objOldValue); // 값 원복
					validMsgArr.push("[" + sWinItemCd + "] 오류로 발주 정보를 등록 할 수 없습니다.");
					continue;
				}
				
				
				// 유효성 검사 시작
				var validMsg = fn_checkTempData(ds_Listb, nCurRow, sColumn);
				var bSum     = false; //합계, 계산 등 처리 여부
				if(!gfn_isNull(validMsg)){
					validMsgArr.push(validMsg);
					
					if(validMsg.indexOf("해당 상품은 최대발주량이") > -1){
						
						// 고객인 경우만 제한
						if( g_EmpNo.substr(0,2) == "CS" ) {
							ds_Listb.setColumn(nCurRow, sColumn, objOldValue);
						} else {
							bSum = true; //본사 합계처리함.
						}
					} else {
						ds_Listb.setColumn(nCurRow, sColumn, objOldValue);
					}

				} else {
					bSum = true; //정상 합계처리함.
				}
				
				//임시데이터 합계처리
				if(bSum == true && bNum == true){
					fn_sumTempData(ds_Listb, nCurRow, sColumn);
				}
				
			} // end for
			ds_Listb.enableevent = true;
			
			
			// 입수량0의 경우 경고창
			if(boxQtyZeroMsg != "") {
				if(boxQtyZeroIndex == 1) { 
					g_Message("EE",boxQtyZeroMsg + " 자재의 입수량이 0입니다.");
				} else {
					g_Message("EE",boxQtyZeroMsg + " 자재 외 " + (boxQtyZeroIndex-1) + " 개의 입수량이 0입니다.");
				}
				
			}
			
			if(validMsgArr.length > 0){
				g_Message("EE",validMsgArr.join("\n"));
			}
			fv_isCopyPaste = false;
			return true; //종료
			
		} // end else
		fv_isCopyPaste = false;

	} // end if e.keycode

}

function gd_list_OnCellPosChanged(obj:Grid, e:GridSelectEventInfo)
{
	//2010/03/22 수량 입력 클릭 시 공백 처리 == by Noh Kyu Wan ==
	if (e.cell == 8)
	{
	    if (ds_Listb.getColumn(e.row,"prQty") <> 0)
	    {}
	    else	    
		ds_Listb.setColumn(e.row,"prQty","");		
     }	
}

function gd_list_OnKeyDown(obj:Grid, e:KeyEventInfo)
{
	var nRow = ds_List.rowposition;
	var nCell = '0';
	var nPivotIndex = '-1';
	
	//엔터키일때 입력
	if(e.keycode == '13')
	{
		var e = new EventInfo();
		e.row = this[obj.binddataset].rowposition;	
		gd_list_OnCellDblClick(obj,e);		
		return true; //Form의 onkeydown 이벤트를 발생시키지 않는다
	}
}

function fn_setInitForm()
{		
	cbo_Gbn.index = 0;//[PJT]주문채널통합
	ed_Item.value = ""; 
	ds_List.clearData();
	ed_Item.setFocus();
}

// FICS 발주제한요일, 시간 설정 조회
function fn_getWeekendTime()
{
	fn_CurrDateWeek();
	
	// 조회
	var actionName, cmdName, inData, outData, otherArg, callBackFnc;
	// 파라미터셋팅
    outData		= "ds_WeekendTime=ds_List";
    callBackFnc = "callBackWeekendTime"
    //action 정보 초기화 
	fsp_clear(this); 
    // 서버에서 조회할 정보 추가 
	//fsp_addSearch(this, "fm/fmz:FMZ_GET_WEEKENDTIME_S001");
	fsp_addSearch(this, "fm/fmz:FMZ_GET_WEEKENDTIME_S001");
	
	// 서버 호출 
    fsp_callService(this, actionName, cmdName, inData, outData, otherArg, callBackFnc);
}

function callBackWeekendTime(errCode, errMsg)
{
	if (errCode == 0)
	{
	    fn_setWeekendTime();
	} else {
		g_Message("EE",fn_AlertMsg("002"));
	}
}

// FICS 발주제한요일, 시간 설정에 따른 화면 제어 	
function fn_setWeekendTime()
{
	var sCurWeekCd = gds_currdate.getColumn(0, "WEEK_CD");
	var sCurTm = gfn_subStr(gds_currdate.getColumn(0, "YMD_TM"),8,4);
	var nRow = ds_WeekendTime.findRow("CODE", sCurWeekCd);
	
	if ( nRow > -1 ) {
		
		fa_startTime = ds_WeekendTime.getColumn(nRow, "SET2");
		fa_endTime = ds_WeekendTime.getColumn(nRow, "SET3");
		
		if ( sCurTm >= fa_startTime && sCurTm <= fa_endTime ) {
			
			// 발주 통제 함
			fa_weekendTimeCheck = "Y"; 
		} else {
		    // 발주 통제 안함
			fa_weekendTimeCheck = "N"; 
		}
		
		//trace("fn_setWeekendTime 상품발주: "+fa_weekendTimeCheck);
	}
}

function gd_list_oncellclick(obj:Grid, e:GridClickEventInfo)
{
	if ( e.cell == 1 ) { //[PJT]주문채널통합 - 자재정보 팝업
		var arrParam = new Array();
		arrParam[0] = eval(obj.binddataset).getColumn(e.row, "itemCode");
		
		//바코드 조회로 상품코드가 없는 경우 팝업 처리 안함.
		if(!gfn_isNull(arrParam[0])){
			var rtnVal = gfn_dialog("FMP00010P"			// dialogId
						   , "U_FMP::FMP00010P.xfdl"		// Url
						   , {fv_Contents:arrParam}					// 배열
						   , null, null, null, null, null, false, true, -1);
		}//바코드 조회로 상품코드가 없는 경우 팝업 처리 안함.
	}
	
}

function fn_isHoliday(sDate)
{
	var i;
	var aHolidays;
	
	aHolidays = gfn_getHolidays(parseInt(gfn_today().substr(0,4), 10));

	for( i = 0 ; i < aHolidays.length ; i++ )
	{
		if( aHolidays[i].substr(0,8) == sDate )
			return aHolidays[i].substr(8);
	}

	return "";	
}

function cbo_NeedDate_onkeydown(obj:Combo, e:KeyEventInfo)
{
	if (e.keycode == 13) 
	{
		//trace("cbo_NeedDate_onkeydown");
		g_Date_OnKillFocus(obj); 
	
		//초기화		
		ds_Listb.clearData();		
		//디데이
		fn_GetDays();
		//날짜변경
		st_Week.text = "(" + ffn_DayToWeek(cbo_NeedDate.value) + ")";
		
		//날짜색변경
		if (st_Week.text == "(토)")
			st_Week.style.color = "blue";
		else if (st_Week.text == "(일)")
			st_Week.style.color = "red";
		else
			st_Week.style.color = "black";
		//공휴일색변경	
		if(gfn_length(fn_isHoliday(cbo_NeedDate.value))>0)
		{
			st_Week.style.color = "red";
		}
	}
}


function cbo_NeedDate_onkillfocus(obj:MaskEdit, e:KillFocusEventInfo)
{
	//trace("cbo_NeedDate_onkillfocus");
	//변경되면 포커스를 잃고 글로벌 함수 실행(여기서 글자수를 체크하여 제대로 된 데이터 넘김)
// 	g_Date_OnKillFocus(obj);
// 	
// 	//변경된 사항이 있는지 확인
// 	if(gfn_dsIsUpdated(ds_Listb)==true)
// 	{
// 		g_Message("EE","변경된 내역이 있습니다. 저장해 주십시요");		
// 		return;
// 	}else{
// 		// 상단그리드 초기화
// 		fn_setInitForm();
// 		fn_search();
// 	}
}

function cbo_NeedDate_onitemchanged(obj:Combo, e:ItemChangeEventInfo)
{
	//날짜변경
	st_Week.text = "(" + ffn_DayToWeek(cbo_NeedDate.value) + ")";
	//날짜색변경
	if (st_Week.text == "(토)")
		st_Week.style.color = "blue";
	else if (st_Week.text == "(일)")
		st_Week.style.color = "red";
	else
		st_Week.style.color = "black";
	//공휴일색변경	
	if(gfn_length(fn_isHoliday(cbo_NeedDate.value))>0)
	{
		st_Week.style.color = "red";
	}
	
	//변경되면 포커스를 잃고 글로벌 함수 실행(여기서 글자수를 체크하여 제대로 된 데이터 넘김)
	//g_Date_OnKillFocus(cbo_NeedDate);
		
	//변경된 사항이 있는지 확인
	if(gfn_dsIsUpdated(ds_Listb)==true)
	{
		//g_Message("EE","변경된 내역이 있습니다. 저장해 주십시요");
		var retValue = gfn_confirm("confirm.before.search");	// 검색을 진행하면 변경된 데이터가 사라집니다. 계속 진행 하시겠습니까?
 		if (retValue == true) {		
			fn_setInitForm();
			fn_search();
						
			return true;
 		} else {			
			//2017.10.13 김호석 추가 입고일자 변경 전으로 되돌림
			cbo_NeedDate.value = pre_need_date_temp;	//변경전의 날짜를 되돌림
			//날짜변경
			st_Week.text = "(" + ffn_DayToWeek(cbo_NeedDate.value) + ")";
			//날짜색변경

			if (st_Week.text == "(토)")
				st_Week.style.color = "blue";
			else if (st_Week.text == "(일)")
				st_Week.style.color = "red";
			else
				st_Week.style.color = "black";
			//공휴일색변경	
			if(gfn_length(fn_isHoliday(cbo_NeedDate.value))>0)
			{
				st_Week.style.color = "red";
			}
			return false;
 		}
 		//날짜변경
		st_Week.text = "(" + ffn_DayToWeek(cbo_NeedDate.value) + ")";
		//날짜색변경

		if (st_Week.text == "(토)")
			st_Week.style.color = "blue";
		else if (st_Week.text == "(일)")
			st_Week.style.color = "red";
		else
			st_Week.style.color = "black";
		//공휴일색변경	
		if(gfn_length(fn_isHoliday(cbo_NeedDate.value))>0)
		{
			st_Week.style.color = "red";
		}
		cbo_NeedDate.value = pre_need_date_temp;	//변경전의 날짜를 되돌림
		return false;
	}else{
		// 상단그리드 초기화	
		fn_setInitForm();
		fn_search();
		
		return true;
	}

}

function fn_isOverQty(obj:Dataset, e:DSColChangeEventInfo, nPrQty) {
	var maxQty = toNumber(obj.getColumn(e.row, "maxOrdQty"));
	if ( maxQty == 0 ) {	// MAX_ORD_QTY == 0 이면 발주수량제한 없음
		return false;
	}
	var itemCd = obj.getColumn(e.row, "itemCode");
	var nSum = toNumber(obj.getCaseSum("itemCode == '" + itemCd + "' && rowidx != " + e.row , "prQty"));//현재 행을 제외한 합계
	var nReal = nSum+toNumber(nPrQty);
	//trace("fn_isOverQty.nReal : " + nReal);
	return (maxQty < nReal);
}

function fn_checkLineStatus(flag, checkDs) {

	fv_chkMsg = "";
	ds_msg.clearData();
	//var checkDs = fn_search(true);
	for ( var k=0; k<ds_Listb.rowcount; k++ ) {
		var nRowType = ds_Listb.getRowType(k);
		var strExpr = "prId == '" + ds_Listb.getColumn(k, "prId")+ "'";
			strExpr += " && prNum == '" + ds_Listb.getColumn(k, "prNum") + "'";
			strExpr += " && itemCode == '" + ds_Listb.getColumn(k, "itemCode") + "'";
		var nRow1 = ds_Listb.findRowExpr(strExpr);
		var nRow2 = checkDs.findRowExpr(strExpr);
		
		var sLine1 = ds_Listb.getColumn(nRow1, "poLineStatus");
		var sLine2 = checkDs.getColumn(nRow2, "poLineStatus");
		//trace(strExpr);
		//trace(nRow1+"||"+nRow2+"||"+sLine1+"||"+sLine2);
		//if ( nRowType == Dataset.ROWTYPE_UPDATE ) {
			if ( nRow1 != -1 && nRow2 != -1 ) {
				if ( sLine1 != sLine2 ) {
					ds_Listb.updatecontrol = false;
					ds_Listb.setColumn(nRow1, "prQty", ds_Listb.getOrgColumn(nRow1, "prQty"));
					ds_Listb.setColumn(nRow1, "prRemark", ds_Listb.getOrgColumn(nRow1, "prRemark"));
					ds_Listb.setColumn(nRow1, "poLineStatus", checkDs.getColumn(nRow2, "poLineStatus"));
					ds_Listb.setColumn(nRow1, "clsStatus", "마감");
					ds_Listb.setRowType(nRow1, Dataset.ROWTYPE_NORMAL);	// for skip save
					//return ("["+ds_List.getColumn(nRow1, "ITEM_NAME")+"] 상품의 발주상태가 " + checkDs.getColumn(nRow2, "PO_LINE_STATUS") +"로 변경되어 해당 내용을 수정할 수 없습니다.");
					fv_chkMsg = "["+ds_Listb.getColumn(nRow1, "itemCode")+":"+ds_Listb.getColumn(nRow1, "itemName")+"] 상품의 발주상태가 [" + checkDs.getColumn(nRow2, "poLineStatus") +"]로 변경되어 해당 내용을 수정할 수 없습니다.";
					var nRow = ds_msg.addRow();
					ds_msg.setColumn(nRow, "NO", nRow);
					ds_msg.setColumn(nRow, "TYPE", "I");
					ds_msg.setColumn(nRow, "MSG", fv_chkMsg);
					ds_Listb.updatecontrol = true;
				}
			}
		//}
	}
	
	if ( !gfn_dsIsUpdated(ds_Listb) ) {
		if ( !gfn_isNull(flag) ) {
			if ( flag == "delete" ) {
				return fv_chkMsg;
			} else {
				return "주문한 자재의 발주상태가 변경되어 수정할 수 없습니다.\r\n발주내역을 다시 조회하여 상태를 확인하시기바랍니다.";
			}
		} else {
			return "주문한 자재의 발주상태가 변경되어 수정할 수 없습니다.\r\n발주내역을 다시 조회하여 상태를 확인하시기바랍니다.";
		}
	}
}

function fn_callBack(strSvcID, nErrorCode, strErrorMsg) {
	if ( nErrorCode < 0 ) {
		return;
	}
}

// 상품에 대한 오류 check
// 바코드로 발주 상품 조회 완료 후 check
function fn_checkTempItem(objDs:Dataset){
	
	var nRow = objDs.findRowExpr("inputType == 'P' && itemStatus == 'N'"); //붙여넣기한 정상건만 check
	if(nRow < 0) return;
	
	var validMsgArr = new Array(); //validation
	objDs.enableevent = false;
	for(var i = nRow; i < objDs.rowcount; i++){
		
		if(objDs.getColumn(i, "inputType") != "P" || objDs.getColumn(i, "itemStatus") != "N"){
			continue;
		}

		// 유효성 검사 시작
		var validMsg = fn_checkTempItemRow(ds_Listb, i);
		
		if(!gfn_isNull(validMsg)){
			validMsgArr.push(validMsg);
			objDs.setColumn(i, "itemStatus", "E");	//발주 못하도록 에러로 처리함.
		}
		
	} // end for
	objDs.enableevent = true;
	
	if(validMsgArr.length > 0){
		g_Message("EE",validMsgArr.join("\n"));
	}
}

function fn_checkTempItemRow(objDs:Dataset, nRow){

	var sWinItemCd = objDs.getColumn(nRow, "winItemCd");

	//리조트 물류스케주울 체크
// 	if (! ffn_ChkNull(objDs.getColumn(nRow,"weekItemCode")))
// 	{
// 		return ("[" + sWinItemCd + "] 해당 상품은 요일통제 상품입니다!");
// 	}
	
	//주문통제체크	
// 	if (!ffn_ChkNull(objDs.getColumnInfo("limitItem"))) {	
// 		if (! ffn_ChkNull(objDs.getColumn(nRow,"limitItem")))
// 		{
// 			return ("[" + sWinItemCd + "] 해당 상품은 주문통제 상품입니다!" + "-" + "통제내용:" + objDs.getColumn(nRow,"limitReason"));
// 		}
// 	}
	

	//상품조회
// 	if (objDs.getColumn(nRow,"unuseYn") == "UK" || objDs.getColumn(nRow,"valStpYn") == "TK" ) 
// 	{	
// 		return ("[" + sWinItemCd + "] 해당 상품은 주문불가 상품입니다!");
// 	}	
	
	//단가업장 수발주 요일 제한 상품 체크
// 	if (objDs.getColumn(nRow,"dangaweekStatus") == "FE")
// 	{
// 		return ("[" + sWinItemCd + "] 해당 상품은 단가업장 수발주 요일 제한 상품입니다!");
// 	}	


	//발주마감체크
	if (fn_GetDayStatus(objDs.getColumn(nRow,"dDays"), objDs.getColumn(nRow,"dTimes")) == "0")
	{
		return ("[" + sWinItemCd + "] 마감시간이 초과되어 주문이 불가합니다.");
	}
	
	//창고가 식재/소모품 통합창고인 경우 주문통제 점검	
	if (ffn_ChkNull(ds_Subinv.getColumn(ds_Subinv.rowposition,"CONSUM_YN")))
	{
		//주문통제(주문일자)
		var jRow;
		jRow = ds_OrdCtrl.findRowExpr("CTRL_TYPE=='주문'&&ITEM_TYPE==iif('" + objDs.getColumn(nRow,"consumYn") + "','Y','소모품','식자재')");
		if (jRow >= 0)
		{
			if (ds_OrdCtrl.getColumn(jRow,ToUpper(gds_currdate.getColumn(0, "WEEK_ENG"))) == "Y")
			{
				return ("[" + sWinItemCd + "] " + gds_currdate.getColumn(0, "WEEK_KOR") + "요일은 " + ds_OrdCtrl.getColumn(jRow,"ITEM_TYPE") + " 주문불가 요일입니다.");
			}
		}
		
		//주문통제(입고일자)
		jRow = ds_OrdCtrl.findRowExpr("CTRL_TYPE=='입고'&&ITEM_TYPE==iif('" + objDs.getColumn(nRow,"consumYn") + "','Y','소모품','식자재')");
		if (jRow >= 0)
		{
			if (ds_OrdCtrl.getColumn(jRow,ToUpper(ffn_DayToWeek(cbo_NeedDate.value,"1"))) == "Y")
			{
				return ("[" + sWinItemCd + "] " + ffn_DayToWeek(cbo_NeedDate.value) + "요일은 " + ds_OrdCtrl.getColumn(jRow,"ITEM_TYPE") + " 입고불가 요일입니다." + "\n\n" + "반환회수일을 변경하세요.");
			}
		}
	}else{
		//주문통제(입고일자)
		jRow = ds_OrdCtrl.findRowExpr("CTRL_TYPE=='입고'&&ITEM_TYPE=='공통'");
		if (jRow >= 0)
		{
			if (ds_OrdCtrl.getColumn(jRow,ToUpper(ffn_DayToWeek(cbo_NeedDate.value,"1"))) == "Y")
			{
				return ("[" + sWinItemCd + "] " + ffn_DayToWeek(cbo_NeedDate.value) + "요일은 " + ds_OrdCtrl.getColumn(jRow,"ITEM_TYPE") + " 입고불가 요일입니다." + "\n\n" + "반환회수일을 변경하세요.");

			}
		}	
	}
}


//임시 data 유효성 검사
function fn_checkTempData(obj:Dataset, nCurRow, sColumn){

	var sWinItemCd = obj.getColumn(nCurRow, "winItemCd");
// 	if(obj.getColumn(nCurRow, "ITEM_STATUS") == "E"){
// 		return ("[" + sWinItemCd + "] 오류로 발주 정보를 등록 할 수 없습니다.");
// 	}
	
	if(sColumn == "prRemark"){
		if ( gfn_lengthByte(obj.getColumn(nCurRow, sColumn)) > 100 ) {
			return ("[" + sWinItemCd + "] 최대 입력 길이(100byte)를 초과 하였습니다.");
		}
	} else {
		var nPrQty = (toNumber(obj.getColumn(nCurRow, "prBoxQty"), 0) * toNumber(obj.getColumn(nCurRow, "boxQty"), 0)) + toNumber(obj.getColumn(nCurRow, "prPcQty"), 0);

		//(-)발주여부
		if ( toNumber(nPrQty) < 0 )
		{
			return ("[" + sWinItemCd + "] (-)발주는 불가합니다.");
		}
		
		if (fn_GetDayStatus(obj.getColumn(nCurRow,"dDays"), obj.getColumn(nCurRow,"dTimes")) == "0")
		{
			return ("[" + sWinItemCd + "] 해당 상품은 마감시간(D-Days)이 초과되어 수정이 불가합니다.");
		}
		
		if ( toNumber(nPrQty) > 0 )
		{
			//최소발주량 체크
			if ( (toNumber(obj.getColumn(nCurRow,"minOrdQty")) > 0) && (toNumber(obj.getColumn(nCurRow,"minOrdQty")) > toNumber(nPrQty)) && obj.getColumn(nCurRow,"keepingType") != "냉동" )
			{
				return ("[" + sWinItemCd + "] 해당 상품은 최소발주량이 " + obj.getColumn(nCurRow,"minOrdQty") + "입니다.");
			}
			
			// canColumnChange Event에서 obj.getCaseSum()의 올바른 연산을 위해 함수로 대체
			if ( toNumber(obj.getColumn(nCurRow,"maxOrdQty")) != 0 && toNumber(nPrQty) > toNumber(obj.getColumn(nCurRow,"maxOrdQty")) ) {
				return ("[" + sWinItemCd + "] 해당 상품은 최대발주량이 " + obj.getColumn(nCurRow,"maxOrdQty") + "입니다.");
			}
			
			//소숫점발주여부
			if ( (obj.getColumn(nCurRow,"pointFlag") != "Y") && (Math.ceil(toNumber(nPrQty)) != toNumber(nPrQty)) )
			{
				return ("[" + sWinItemCd + "] 해당 상품은 소숫점발주가 불가합니다.");
			}
			//발주승수량
			if ( (toNumber(obj.getColumn(nCurRow,"multiplierQty")) > 0) && ((Math.round(toNumber(nPrQty) * 1000) % Math.round(toNumber(obj.getColumn(nCurRow,"multiplierQty")) * 1000)) <> 0) )
			{
				return ("[" + sWinItemCd + "] 해당 상품은 발주승수량이 " + obj.getColumn(nCurRow,"multiplierQty") + "입니다.");
			}
		}

// ◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆
// [PJT]주문채널통합
// copy & paste 기능 구현 중 return 처리 없는 case에서 오류발생으로 주석 처리
// grid onkeydown event(ctrl + v)  보다 dataset cancolumnchange event가 선행으로 발생하는 문제
// 		//3개월치 최대발주량 초과시 알람
// 		if ( toNumber(nPrQty) >  toNumber(obj.getColumn(nCurRow,"MAX_SO_QTY")) )
// 		{
// 			return ("[" + sWinItemCd + "] 해당 상품은 최근 3개월 최대발주량 " + obj.getColumn(nCurRow,"MAX_SO_QTY") + " 을 초과 하였습니다. ");
// 		}
// ◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆		

	}
	
	return ""; //정상
}

//임시 data 합계처리
function fn_sumTempData(obj:Dataset, nCurRow, sColumn){

	var nPrQty = (toNumber(obj.getColumn(nCurRow, "prBoxQty"), 0) * toNumber(obj.getColumn(nCurRow, "boxQty"), 0)) + toNumber(obj.getColumn(nCurRow, "prPcQty"), 0);
					
	//합계처리
	obj.setColumn(nCurRow, "prQty", nPrQty); 
		
	//금액계산
	var nAmt = Math.round(toNumber(obj.getColumn(nCurRow,"salePrice")) * toNumber(nPrQty));
	obj.setColumn(nCurRow, "saleAmount", nAmt);
	nAmt = Math.round(toNumber(obj.getColumn(nCurRow,"opPrice")) * toNumber(nPrQty));
	obj.setColumn(nCurRow, "opAmount", nAmt);
	
	//무게계산
	var nTotWght = Math.round(toNumber(obj.getColumn(nCurRow, "kgConvertRate")) * toNumber(nPrQty), 3);
	obj.setColumn(nCurRow, "totWght", nTotWght);

}

//반환타입attr01~02 기간 적용
function fn_callbakRtnOrdType(){	
	ds_rtnOrdType.filter("code != 'G01' && code != 'H01' && code != 'I01' && attr01 <= '"+cbo_NeedDate.value+"' && attr02 >= '"+cbo_NeedDate.value+"'");		
}

//반환유형 일괄적용
function btn_rtnOrdTypeAllChg_onclick(obj:Button,  e:ClickEventInfo)
{
	ds_Listb.enableevent = false;
	for(var i = 0 ; i < ds_Listb.getRowCount() ; i++){
		if(! (ds_Listb.getColumn(i, "clsStatus") == "마감" || ds_Listb.getColumn(i, "itemStatus") == "E") ){
			ds_Listb.setColumn(i ,"rtnOrdType", cbo_rtnOrdType.value);
		}
	}
	ds_Listb.enableevent = true;
}
/*----------------------------------------------------------------------------------------------
 * 설명      : 구분 변경 이벤트
 *---------------------------------------------------------------------------------------------*/
function cbo_Gbn_onitemchanged(obj:Combo, e:ItemChangeEventInfo)
{
	 //구분정보 변경시 keyword reset
	 ed_Item.value = "";	
}
]]></Script>
  </Form>
</FDL>
