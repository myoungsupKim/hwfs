<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.4">
  <TypeDefinition url="..\..\..\default_typedef.xml"/>
  <Form id="SmsSendMgmt" classname="COMP_GUIDE_13" inheritanceid="" position="absolute 0 0 1252 725" titletext="SMS발송관리" scrollbars="autoboth" onload="form_onload">
    <Layouts>
      <Layout>
        <Static id="Static06" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 1237 0 1252 710" anchor="top right"/>
        <Static id="Static71" text="h15" class="Guide01_AreaRed" visible="false" position="absolute 0 710 1252 725" anchor="left bottom"/>
        <Div id="div_cmnBtn" anchor="left top right" taborder="0" url="cmn::CmnBtn.xfdl" text="Div00" scrollbars="none" position="absolute 0 0 1237 30" tabstop="false"/>
        <Tab id="tab_main" anchor="all" taborder="2" tabindex="0" scrollbars="autoboth" position="absolute 3 30 1237 710" style="showextrabutton:false;">
          <Tabpages>
            <Tabpage id="tpg_send" style="anchor:default;" text="SMS/LMS 발송">
              <Layouts>
                <Layout width="1232" height="652">
                  <Static id="Static15" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 10 53 460 66" anchor="left top"/>
                  <Static id="Static22" text="업장리스트" class="sta_WF_Title01" position="absolute 7 66 457 84" anchor="left top"/>
                  <Static id="Static16" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 7 79 457 84" anchor="left top"/>
                  <Grid id="grd_mstList" taborder="4" binddataset="ds_upjangList" autoenter="select" useinputpanel="false" position="absolute 7 84 1215 352" anchor="all" autofittype="col" cellsizingtype="col" cellmovingtype="col">
                    <Formats>
                      <Format id="default">
                        <Columns>
                          <Column size="30" band="left"/>
                          <Column size="30"/>
                          <Column size="70"/>
                          <Column size="70"/>
                          <Column size="150"/>
                          <Column size="220"/>
                          <Column size="150"/>
                          <Column size="120"/>
                          <Column size="120"/>
                          <Column size="120"/>
                        </Columns>
                        <Rows>
                          <Row size="26" band="head"/>
                          <Row size="24"/>
                        </Rows>
                        <Band id="head">
                          <Cell displaytype="checkbox" edittype="checkbox"/>
                          <Cell col="1"/>
                          <Cell col="2" text="구분" taborder="undefined"/>
                          <Cell col="3" text="코드"/>
                          <Cell col="4" text="본사명"/>
                          <Cell col="5" text="사업장명"/>
                          <Cell col="6" text="담당자/영양사"/>
                          <Cell col="7" text="휴대전화"/>
                          <Cell col="8" text="영업사원"/>
                          <Cell col="9" text="CS사원"/>
                        </Band>
                        <Band id="body">
                          <Cell displaytype="checkbox" edittype="checkbox" text="bind:chk"/>
                          <Cell col="1" expr="expr:currow+1"/>
                          <Cell col="2" style="align:left;padding: ;" text="bind:upjangType"/>
                          <Cell col="3" displaytype="text" style="align:center;" text="bind:mainUpjang"/>
                          <Cell col="4" style="align:left;padding: ;" text="bind:mainUpjangNm"/>
                          <Cell col="5" displaytype="normal" style="align:left;padding: ;" text="bind:upjangNm"/>
                          <Cell col="6" style="align:left;padding: ;" text="bind:partName"/>
                          <Cell col="7" style="align:left;padding: ;" text="bind:custHpNo"/>
                          <Cell col="8" style="align: ;" text="bind:partSalesSabunNm"/>
                          <Cell col="9" style="align: ;" text="bind:csSabunNm"/>
                        </Band>
                      </Format>
                    </Formats>
                  </Grid>
                  <Static id="Static26" text="h06" class="Guide01_AreaRed" visible="false" position="absolute 301 352 385 358" anchor="top right"/>
                  <Static id="Static25" text="h05" class="Guide01_AreaRed" visible="false" position="absolute 301 378 385 383" anchor="top right"/>
                  <Static id="Static00" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 0 377 450 382" anchor="left top"/>
                  <Static id="Static17" text="수신대상" class="sta_WF_Title01" position="absolute 7 364 77 382" anchor="left bottom"/>
                  <Grid id="grd_sendList" taborder="5" autoenter="select" useinputpanel="false" cellsizingtype="col" position="absolute 7 382 712 640" anchor="left right bottom" binddataset="ds_sendList" autofittype="col" onlbuttonup="tab_main_tpg_send_grd_sendList_onlbuttonup">
                    <Formats>
                      <Format id="default">
                        <Columns>
                          <Column size="30" band="left"/>
                          <Column size="28" band="left"/>
                          <Column size="120"/>
                          <Column size="120"/>
                          <Column size="120"/>
                          <Column size="40"/>
                        </Columns>
                        <Rows>
                          <Row size="26" band="head"/>
                          <Row size="24"/>
                        </Rows>
                        <Band id="head">
                          <Cell displaytype="checkbox" edittype="checkbox"/>
                          <Cell col="1"/>
                          <Cell col="2" text="사업장명"/>
                          <Cell col="3" text="담당자/영양사"/>
                          <Cell col="4" text="핸드폰"/>
                          <Cell col="5"/>
                        </Band>
                        <Band id="body">
                          <Cell displaytype="checkbox" edittype="checkbox" text="bind:chk"/>
                          <Cell col="1" expr="expr:currow+1"/>
                          <Cell col="2" style="align:left;padding:0 0 0 8;" text="bind:upjangNm"/>
                          <Cell col="3" style="align:center middle;" text="bind:partName"/>
                          <Cell col="4" edittype="normal" style="align:center middle;" text="bind:custHpNo"/>
                          <Cell col="5" displaytype="button" edittype="button" text="삭제"/>
                        </Band>
                      </Format>
                      <Format id="work">
                        <Columns>
                          <Column size="30" band="left"/>
                          <Column size="28" band="left"/>
                          <Column size="120"/>
                          <Column size="120"/>
                          <Column size="40"/>
                        </Columns>
                        <Rows>
                          <Row size="26" band="head"/>
                          <Row size="24"/>
                        </Rows>
                        <Band id="head">
                          <Cell displaytype="checkbox" edittype="checkbox"/>
                          <Cell col="1"/>
                          <Cell col="2" text="발송시각"/>
                          <Cell col="3" text="핸드폰"/>
                          <Cell col="4"/>
                        </Band>
                        <Band id="body">
                          <Cell displaytype="checkbox" edittype="checkbox" text="bind:chk"/>
                          <Cell col="1" expr="expr:currow+1"/>
                          <Cell col="2" edittype="masknumber" style="align:center middle;padding:0 0 0 8;" text="bind:reqDate" mask="####-##-## ##:##"/>
                          <Cell col="3" edittype="normal" style="align:center middle;" text="bind:custHpNo"/>
                          <Cell col="4" displaytype="button" edittype="button" text="삭제"/>
                        </Band>
                      </Format>
                    </Formats>
                  </Grid>
                  <Static id="Static18" text="SMS발송정보" class="sta_WF_Title01" position="absolute 720 364 1170 382" anchor="right bottom"/>
                  <Static id="Static48" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 720 377 1170 382" anchor="right bottom"/>
                  <Static id="Static62" class="sta_WFDA_Labelbg" position="absolute 720 408 1221 642" anchor="right bottom"/>
                  <Static id="Static34" class="sta_WFDA_Labelbg" position="absolute 720 382 1221 409" anchor="right bottom"/>
                  <Static id="Static65" text="발송내용" class="sta_WFDA_Label01" position="absolute 720 460 822 620" anchor="right bottom"/>
                  <Static id="Static20" text="발송번호" class="sta_WFDA_Label01" position="absolute 720 382 822 409" anchor="right bottom"/>
                  <Static id="Static23" text="h06" class="Guide01_AreaRed" visible="false" position="absolute 1138 352 1222 358" anchor="right bottom"/>
                  <Static id="Static08" class="sta_WFSA_Labelbg" position="absolute 7 12 1222 53" anchor="left top right"/>
                  <Button id="btn_smsSend" taborder="12" text="SMS 발송" class="btn_WF_Function" position="absolute 1145 358 1222 378" anchor="right bottom" onclick="tab_main_tpg_send_btn_smsSend_onclick"/>
                  <TextArea id="txt_content" taborder="8" scrollbars="fixedvert" position="absolute 825 464 1215 619" anchor="right bottom" ontextchanged="Tab00_tabpage_txt_content_ontextchanged" wordwrap="word" maxlength="80" class="txt_WF_Essential" lengthunit="ascii" imemode="hangul"/>
                  <Static id="Static01" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 5 0 455 13" anchor="left top"/>
                  <Static id="Static28" text="본사" class="sta_WFSA_label" position="absolute 22 23 84 44" anchor="left top"/>
                  <Static id="Static04" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 7 13 100 23" anchor="left top"/>
                  <Static id="Static07" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 7 23 22 44" anchor="left top"/>
                  <Static id="Static11" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 54 23 64 44" anchor="left top"/>
                  <Static id="Static09" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 204 23 234 44" anchor="left top"/>
                  <Static id="Static02" text="사업장" onclick="Static00_onclick" class="sta_WFSA_label" position="absolute 234 23 295 44" anchor="left top"/>
                  <Static id="Static03" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 280 23 290 44" anchor="left top"/>
                  <Static id="Static05" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 431 23 461 44" anchor="left top"/>
                  <Edit id="edt_mainUpjang" taborder="0" position="absolute 64 23 205 44" anchor="left top" onkeydown="common_onkeydown"/>
                  <Static id="Static29" text="현재 입력한 문자수 (byte) :" position="absolute 827 622 982 640" style="linespace:4;" anchor="right bottom"/>
                  <Edit id="edt_count" taborder="13" displaynulltext="0" oneditclick="Div00_Div00_edt_accnm11_oneditclick" enable="false" position="absolute 982 620 1030 640" anchor="right bottom" tooltiptext="검색어" style="align:center middle;"/>
                  <Static id="Static19" text="w10" class="Guide01_AreaRed" visible="false" position="absolute 711 358 721 641" anchor="right bottom"/>
                  <Static id="stc_length" text="80(byte) 제한 " position="absolute 1038 625 1146 638" anchor="right bottom" style="linespace:4;"/>
                  <Static id="Static27" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 640 23 670 44" anchor="left top"/>
                  <Combo id="cbo_custType" taborder="2" innerdataset="ds_custType" position="absolute 529 23 640 44" anchor="left top" onkeydown="common_onkeydown"/>
                  <Static id="Static30" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 519 23 529 44" anchor="left top"/>
                  <Static id="Static31" text="고객구분" onclick="Static00_onclick" class="sta_WFSA_label" position="absolute 461 23 522 44" anchor="left top"/>
                  <Static id="Static32" text="사원명" onclick="Static28_onclick" class="sta_WFSA_label" position="absolute 670 22 732 43" anchor="left top"/>
                  <Static id="Static33" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 715 22 725 43" anchor="left top"/>
                  <Edit id="edt_empNm" taborder="3" position="absolute 725 23 836 44" anchor="left top" onkeydown="common_onkeydown"/>
                  <Edit id="edt_upjang" taborder="1" position="absolute 290 23 431 44" anchor="left top" onkeydown="common_onkeydown"/>
                  <MaskEdit id="msk_senderPh" taborder="16" position="absolute 825 385 1215 405" mask="###########" limitbymask="integer" style="padding:1 5 0 8;align:left middle;" type="string" maskchar=" " anchor="right bottom" class="msk_WF_Essential"/>
                  <Calendar id="cal_sendDate" taborder="17" position="absolute 825 353 963 373" dateformat="yyyy-MM-dd HH:mm" value="null" editformat="yyyy-MM-dd HH:mm" locale="ko_KR" anchor="right bottom" visible="false"/>
                  <Static id="Static10" class="sta_WFDA_Labelbg" position="absolute 720 434 1221 461" anchor="right bottom"/>
                  <Static id="Static06" text="발송형태" class="sta_WFDA_Label01" position="absolute 720 434 822 461" anchor="right bottom"/>
                  <Radio id="rdo_type" taborder="18" columncount="2" rowcount="0" index="1" codecolumn="codecolumn" datacolumn="datacolumn" value="L" position="absolute 828 438 1022 458" onitemchanged="tab_main_tpg_send_rdo_type_onitemchanged" anchor="right bottom" canitemchange="tab_main_tpg_send_rdo_type_canitemchange">
                    <Dataset id="innerdataset">
                      <ColumnInfo>
                        <Column id="codecolumn" size="256"/>
                        <Column id="datacolumn" size="256"/>
                      </ColumnInfo>
                      <Rows>
                        <Row>
                          <Col id="codecolumn">S</Col>
                          <Col id="datacolumn">SMS(14원)</Col>
                        </Row>
                        <Row>
                          <Col id="codecolumn">L</Col>
                          <Col id="datacolumn">LMS(30원)</Col>
                        </Row>
                      </Rows>
                    </Dataset>
                  </Radio>
                  <Button id="btn_checkDel" taborder="19" text="선택삭제" class="btn_WF_Function" position="absolute 641 358 710 378" anchor="right bottom" onclick="tab_main_tpg_send_btn_checkDel_onclick"/>
                  <Static id="Static12" text="체크는 선택 삭제를 위한 기능이며, 발송 시 수신 대상자 정보 리스트 대상에게 발송됩니다." position="absolute 148 362 640 380" anchor="right bottom" style="linespace:4;"/>
                  <Static id="Static14" class="sta_WFDA_Labelbg" position="absolute 720 408 1221 435" anchor="right bottom"/>
                  <Static id="Static13" text="발송유형" class="sta_WFDA_Label01" position="absolute 720 408 822 435" anchor="right bottom"/>
                  <Combo id="cbo_smsType" taborder="20" position="absolute 826 411 1007 432" anchor="right bottom" codecolumn="codecolumn" datacolumn="datacolumn" index="0" text="직접작성" onitemchanged="tab_main_tpg_send_cbo_custType00_onitemchanged">
                    <Dataset id="innerdataset">
                      <ColumnInfo>
                        <Column id="codecolumn" size="256"/>
                        <Column id="datacolumn" size="256"/>
                      </ColumnInfo>
                      <Rows>
                        <Row>
                          <Col id="codecolumn"/>
                          <Col id="datacolumn">직접작성</Col>
                        </Row>
                        <Row>
                          <Col id="codecolumn">[푸디스트]
모바일발주앱
설치주소(안드로이드)
https://goo.gl/DMqC92</Col>
                          <Col id="datacolumn">모바일발주_안드로이드</Col>
                        </Row>
                        <Row>
                          <Col id="codecolumn">[푸디스트]
모바일발주앱
설치주소(ios)
https://goo.gl/NZvVDT</Col>
                          <Col id="datacolumn">모바일발주_ios</Col>
                        </Row>
                        <Row>
                          <Col id="codecolumn">[푸디스트]
PC원격지원접속주소
https://939.co.kr/hnrit/</Col>
                          <Col id="datacolumn">PC원격지원</Col>
                        </Row>
                        <Row>
                          <Col id="codecolumn">[푸디스트]
모바일원격지원앱
설치주소(안드로이드)
https://goo.gl/8ip5dE</Col>
                          <Col id="datacolumn">모바일원격지원_안드로이드</Col>
                        </Row>
                      </Rows>
                    </Dataset>
                  </Combo>
                  <Combo id="cbo_mainYn" taborder="21" onkeydown="common_onkeydown" position="absolute 947 23 1024 44" anchor="left top" codecolumn="codecolumn" datacolumn="datacolumn" index="0" text="전체">
                    <Dataset id="innerdataset">
                      <ColumnInfo>
                        <Column id="codecolumn" size="256"/>
                        <Column id="datacolumn" size="256"/>
                      </ColumnInfo>
                      <Rows>
                        <Row>
                          <Col id="codecolumn"/>
                          <Col id="datacolumn">전체</Col>
                        </Row>
                        <Row>
                          <Col id="codecolumn">Y</Col>
                          <Col id="datacolumn">Y</Col>
                        </Row>
                        <Row>
                          <Col id="codecolumn">N</Col>
                          <Col id="datacolumn">N</Col>
                        </Row>
                      </Rows>
                    </Dataset>
                  </Combo>
                  <Static id="Static21" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 937 23 947 44" anchor="left top"/>
                  <Static id="Static24" text="메인연락처" onclick="Static00_onclick" class="sta_WFSA_label" position="absolute 866 23 943 44" anchor="left top"/>
                  <Static id="Static35" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 836 23 866 44" anchor="left top"/>
                  <Static id="Static36" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 1024 23 1054 44" anchor="left top"/>
                  <CheckBox id="chk_loginSabunYn" taborder="22" text="본인담당업장" position="absolute 1054 23 1169 43" truevalue="1" falsevalue="0"/>
                  <Button id="btn_excel" taborder="23" text="엑셀" class="btn_WF_Excel" position="absolute 81 359 131 380" visible="false" onclick="tab_main_tpg_send_btn_excel_onclick"/>
                </Layout>
              </Layouts>
            </Tabpage>
            <Tabpage id="tpg_log" text="SMS/LMS 발송내역">
              <Layouts>
                <Layout>
                  <Static id="Static15" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 10 53 460 66" anchor="left top"/>
                  <Static id="Static22" text="SMS 발송내역" class="sta_WF_Title01" position="absolute 7 66 457 84" anchor="left top"/>
                  <Static id="Static16" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 7 79 457 84" anchor="left top"/>
                  <Static id="Static08" class="sta_WFSA_Labelbg" position="absolute 7 12 1222 53" anchor="left top right"/>
                  <Static id="Static01" text="h13" class="Guide01_AreaRed" visible="false" position="absolute 5 0 455 13" anchor="left top"/>
                  <Static id="Static04" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 7 13 100 23" anchor="left top"/>
                  <Static id="Static07" text="w15" class="Guide01_AreaRed" visible="false" position="absolute 7 23 22 44" anchor="left top"/>
                  <Static id="Static11" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 886 23 896 44" anchor="left top"/>
                  <Static id="Static58" text="w10" class="Guide01_AreaRed" visible="false" position="absolute 1 61 11 371"/>
                  <Static id="Static61" text="w10" class="Guide01_AreaRed" visible="false" position="absolute 1226 58 1236 439"/>
                  <Grid id="grd_smsLog" taborder="5" binddataset="ds_smsLogList" autoenter="select" useinputpanel="false" cellsizingtype="both" position="absolute 11 84 770 642" anchor="all" autofittype="col" cellsizebandtype="body">
                    <Formats>
                      <Format id="default">
                        <Columns>
                          <Column size="30" band="left"/>
                          <Column size="180"/>
                          <Column size="100"/>
                          <Column size="104"/>
                          <Column size="104"/>
                          <Column size="100"/>
                          <Column size="140"/>
                          <Column size="60"/>
                          <Column size="200"/>
                        </Columns>
                        <Rows>
                          <Row size="26" band="head"/>
                          <Row size="24"/>
                        </Rows>
                        <Band id="head">
                          <Cell class="head_Excel"/>
                          <Cell col="1" text="사업장명"/>
                          <Cell col="2" text="수신자" taborder="undefined"/>
                          <Cell col="3" text="수신번호"/>
                          <Cell col="4" text="발송자"/>
                          <Cell col="5" text="발송번호"/>
                          <Cell col="6" text="발송일자"/>
                          <Cell col="7" text="발송형태"/>
                          <Cell col="8" text="발송내용"/>
                        </Band>
                        <Band id="body">
                          <Cell text="expr:currow+1"/>
                          <Cell col="1" style="align:left middle;padding:0 0 0 8;" text="bind:upjangnm"/>
                          <Cell col="2" style="align:left;padding:0 0 0 8;" text="bind:revUserNm"/>
                          <Cell col="3" text="bind:sendHpNo" mask="expr:sendHpNo.toString().length == 10 ? '###-###-####' : '###-####-####'" maskchar=" "/>
                          <Cell col="4" text="bind:nmKor"/>
                          <Cell col="5" text="bind:callbackNo" mask="expr:callbackNo.toString().length == 10 ? '###-###-####' : '###-####-####'"/>
                          <Cell col="6" displaytype="text" style="align:center middle;" text="bind:sendDate" mask="####-##-## ##:##:##" maskchar=" "/>
                          <Cell col="7" expr="expr:attr01 == &quot;L&quot; ? 'LMS' : 'SMS'"/>
                          <Cell col="8" displaytype="text" edittype="none" style="align:left top;padding:0 0 0 8;" text="bind:contents" editscrollbar="autovert" tooltiptype="bottom"/>
                        </Band>
                      </Format>
                    </Formats>
                  </Grid>
                  <Static id="Static02" text="발송일자" onclick="Static28_onclick" class="sta_WFSA_label" position="absolute 22 23 84 44" anchor="left top"/>
                  <Static id="Static00" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 80 23 90 44" anchor="left top"/>
                  <Static id="Static03" class="Guide01_AreaRed" visible="false" position="absolute 190 30 198 37"/>
                  <Static id="Static17" text="~" class="sta_WF_Dash" position="absolute 198 24 214 45"/>
                  <Static id="Static18" class="Guide01_AreaRed" visible="false" position="absolute 206 30 214 37"/>
                  <ObjCalendar id="ObjCalendar_stDate" titletext="캘린더" taborder="0" text="ObjCalendar00" scrollbars="none" position="absolute 90 23 190 44" onkeydown="common_onkeydown" class="cal_WF_Essential"/>
                  <ObjCalendar id="ObjCalendar_edDate" titletext="캘린더" taborder="1" text="ObjCalendar00" scrollbars="none" position="absolute 214 23 314 44" onkeydown="common_onkeydown"/>
                  <Static id="Static05" text="발신자" onclick="Static28_onclick" class="sta_WFSA_label" position="absolute 846 23 908 44" anchor="left top" visible="false"/>
                  <Edit id="edt_se" taborder="4" position="absolute 896 23 1056 44" anchor="left top" onkeydown="common_onkeydown" visible="false"/>
                  <Static id="Static06" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 760 23 790 44" anchor="left top"/>
                  <Static id="Static48" text="글자기준간격 h05" class="Guide01_AreaRed" visible="false" position="absolute 720 79 1170 84" anchor="right bottom"/>
                  <Static id="Static62" class="sta_WFDA_Labelbg" position="absolute 780 84 1222 645" anchor="top right bottom"/>
                  <Static id="Static65" text="발송내용" class="sta_WFDA_Label01" position="absolute 784 87 862 642" anchor="top right bottom"/>
                  <TextArea id="txt_content" taborder="6" scrollbars="fixedvert" wordwrap="word" maxlength="80" ontextchanged="Tab00_tabpage_txt_content_ontextchanged" position="absolute 865 87 1219 642" anchor="top right bottom" readonly="true"/>
                  <Static id="Static19" text="w10" class="Guide01_AreaRed" visible="false" position="absolute 770 62 780 345" anchor="right bottom"/>
                  <Static id="Static13" text="w10" class="Guide01_AreaRed" visible="false" position="absolute 1226 266 1236 528"/>
                  <Static id="Static09" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 314 23 344 44" anchor="left top"/>
                  <Edit id="edt_upjangNm" taborder="2" position="absolute 402 23 562 44" anchor="left top" onkeydown="common_onkeydown"/>
                  <Static id="Static28" text="사업장" onclick="Static28_onclick" class="sta_WFSA_label" position="absolute 344 23 398 44" anchor="left top"/>
                  <Static id="Static33" text="본인이 발송한 내역만 조회 가능합니다." class="sta_WF_DiscInfo" position="absolute 964 65 1218 84" anchor="top right"/>
                  <Static id="Static10" text="w30" class="Guide01_AreaRed" visible="false" position="absolute 562 23 592 44" anchor="left top"/>
                  <Static id="Static12" text="수신번호" onclick="Static28_onclick" class="sta_WFSA_label" position="absolute 593 23 655 44" anchor="left top"/>
                  <Static id="Static14" text="글자간격기준 w10" class="Guide01_AreaRed" visible="false" position="absolute 651 23 661 44" anchor="left top"/>
                  <MaskEdit id="msk_telNo" taborder="3" position="absolute 661 23 821 44" onkeydown="common_onkeydown" style="padding:1 5 0 5;align:left middle;" type="string" mask="###########" maskchar=" " autoselect="true"/>
                </Layout>
              </Layouts>
            </Tabpage>
          </Tabpages>
        </Tab>
        <Static id="Static58" text="w10" class="Guide01_AreaRed" visible="false" position="absolute 1 61 11 371"/>
        <Static id="Static61" text="w10" class="Guide01_AreaRed" visible="false" position="absolute 1226 58 1236 439"/>
        <Static id="Static59" text="h10" class="Guide01_AreaRed" visible="false" position="absolute 33 702 1248 712"/>
        <Static id="Static16" text="w10" class="Guide01_AreaRed" visible="false" position="absolute 1226 442 1236 704"/>
      </Layout>
    </Layouts>
    <Bind>
      <BindItem id="item6" compid="tab_main.tpg_log.edt_upjangNm" propid="value" datasetid="ds_search" columnid="logUpjang"/>
      <BindItem id="item0" compid="tab_main.tpg_send.edt_mainUpjang" propid="value" datasetid="ds_search" columnid="mainUpjangNm"/>
      <BindItem id="item10" compid="tab_main.tpg_send.txt_content" propid="value" datasetid="ds_smsForm" columnid="trMsg"/>
      <BindItem id="item8" compid="tab_main.tpg_send.cbo_custType" propid="value" datasetid="ds_search" columnid="custType"/>
      <BindItem id="item2" compid="tab_main.tpg_send.edt_empNm" propid="value" datasetid="ds_search" columnid="empNm"/>
      <BindItem id="item3" compid="tab_main.tpg_log.edt_se" propid="value" datasetid="ds_search" columnid="logUserNm"/>
      <BindItem id="item4" compid="tab_main.tpg_log.txt_content" propid="value" datasetid="ds_smsLogList" columnid="contents"/>
      <BindItem id="item1" compid="tab_main.tpg_send.edt_upjang" propid="value" datasetid="ds_search" columnid="upjangNm"/>
      <BindItem id="item9" compid="tab_main.tpg_send.msk_senderPh" propid="value" datasetid="ds_smsForm" columnid="trCallback"/>
      <BindItem id="item5" compid="tab_main.tpg_send.cal_sendDate" propid="value" datasetid="ds_smsForm" columnid="trSendDate"/>
      <BindItem id="item7" compid="tab_main.tpg_log.ObjCalendar_stDate" propid="text" datasetid="ds_search" columnid="logFrDate"/>
      <BindItem id="item11" compid="tab_main.tpg_log.ObjCalendar_edDate" propid="text" datasetid="ds_search" columnid="logToDate"/>
      <BindItem id="item12" compid="tab_main.tpg_log.msk_telNo" propid="value" datasetid="ds_search" columnid="logTelNum"/>
      <BindItem id="item13" compid="tab_main.tpg_send.rdo_type" propid="value" datasetid="ds_smsForm" columnid="trType"/>
      <BindItem id="item15" compid="tab_main.tpg_send.cbo_mainYn" propid="value" datasetid="ds_search" columnid="mainYn"/>
    </Bind>
    <Objects>
      <Dataset id="ds_custType">
        <ColumnInfo>
          <Column id="CODE" size="256" type="STRING"/>
          <Column id="CODE_NAME" size="256" type="STRING"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_search" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" oncolumnchanged="ds_search_oncolumnchanged">
        <ColumnInfo>
          <Column id="maskAuth" type="STRING" size="256"/>
          <Column id="loginPersMask" type="STRING" size="256"/>
          <Column id="mainUpjangNm" type="STRING" size="256"/>
          <Column id="upjangNm" type="STRING" size="256"/>
          <Column id="custType" type="STRING" size="256"/>
          <Column id="empNm" type="STRING" size="256"/>
          <Column id="chk" type="STRING" size="256"/>
          <Column id="ujUpjang" type="STRING" size="256"/>
          <Column id="trSendUser" type="STRING" size="256"/>
          <Column id="logUpjang" type="STRING" size="256"/>
          <Column id="logUserNm" type="STRING" size="256"/>
          <Column id="logFrDate" type="STRING" size="256"/>
          <Column id="logToDate" type="STRING" size="256"/>
          <Column id="logTelNum" type="STRING" size="256"/>
          <Column id="mainYn" type="STRING" size="256"/>
          <Column id="loginSabunYn" type="STRING" size="256"/>
          <Column id="sabun" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="mainYn">Y</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_upjangList" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" oncolumnchanged="ds_upjangList_oncolumnchanged">
        <ColumnInfo>
          <Column id="chk" type="STRING" size="255"/>
          <Column id="mainUpjang" type="BIGDECIMAL" size="255"/>
          <Column id="mainUpjangNm" type="STRING" size="255"/>
          <Column id="upjang" type="BIGDECIMAL" size="255"/>
          <Column id="upjangNm" type="STRING" size="255"/>
          <Column id="custType" type="STRING" size="255"/>
          <Column id="useYn" type="STRING" size="255"/>
          <Column id="custcd" type="BIGDECIMAL" size="255"/>
          <Column id="custnm" type="STRING" size="255"/>
          <Column id="upjangType" type="STRING" size="255"/>
          <Column id="csSabunNm" type="STRING" size="255"/>
          <Column id="partSalesTelNo" type="STRING" size="255"/>
          <Column id="partSalesSabunNm" type="STRING" size="255"/>
          <Column id="csTelNo" type="STRING" size="255"/>
          <Column id="partName" type="STRING" size="255"/>
          <Column id="custHpNo" type="STRING" size="255"/>
          <Column id="rownum" type="BIGDECIMAL" size="255"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_sendList" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" oncolumnchanged="ds_custList_oncolumnchanged">
        <ColumnInfo>
          <Column id="chk" type="STRING" size="255"/>
          <Column id="mainUpjang" type="BIGDECIMAL" size="255"/>
          <Column id="mainUpjangNm" type="STRING" size="255"/>
          <Column id="upjang" type="BIGDECIMAL" size="255"/>
          <Column id="upjangNm" type="STRING" size="255"/>
          <Column id="custType" type="STRING" size="255"/>
          <Column id="useYn" type="STRING" size="255"/>
          <Column id="custcd" type="BIGDECIMAL" size="255"/>
          <Column id="custnm" type="STRING" size="255"/>
          <Column id="upjangType" type="STRING" size="255"/>
          <Column id="csSabunNm" type="STRING" size="255"/>
          <Column id="partSalesTelNo" type="STRING" size="255"/>
          <Column id="partSalesSabunNm" type="STRING" size="255"/>
          <Column id="csTelNo" type="STRING" size="255"/>
          <Column id="partName" type="STRING" size="255"/>
          <Column id="custHpNo" type="STRING" size="255"/>
          <Column id="rownum" type="BIGDECIMAL" size="255"/>
          <Column id="reqDate" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_smsForm" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="trSendUser" type="STRING" size="256"/>
          <Column id="trSendDate" type="STRING" size="256"/>
          <Column id="trCallback" type="STRING" size="256"/>
          <Column id="trMsg" type="STRING" size="256"/>
          <Column id="trType" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="trType">L</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_smsLogList" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false" oncolumnchanged="ds_custList_oncolumnchanged">
        <ColumnInfo>
          <Column id="upjangCd" type="BIGDECIMAL" size="255"/>
          <Column id="upjangnm" type="STRING" size="255"/>
          <Column id="sendHpNo" type="STRING" size="255"/>
          <Column id="callbackNo" type="STRING" size="255"/>
          <Column id="sendUserId" type="STRING" size="255"/>
          <Column id="nmKor" type="STRING" size="255"/>
          <Column id="sendDate" type="STRING" size="255"/>
          <Column id="contents" type="STRING" size="255"/>
          <Column id="revUserNm" type="STRING" size="255"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_upload" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="Column0" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <InitValue/>
    <Script type="xscript4.0"><![CDATA[/*
  화 면 명 : SmsSendMgmt
  파 일 명 : SmsSendMgmt.xfdl
  기    능 : SMS 발송관리

    수정일    수정자                  수정내용
  ----------   -------  --------------------------------------------------
  2016.07.25	kihoon	최초 생성 
  2017.02.03	kihoon	[CH201702_00137] SMS/LMS 중복발송 에러 수정
  2017.03.07	kihoon	[CH201703_00160] 조회조건 key-in 시 고객구분 dropdown 제어 / 메시지 한글 입력 / SMS*LMS 자동 전환
*/

/************************************************************************************************
 * 공통 라이브러리 INCLUDE 영역 (필수)
************************************************************************************************/
include "lib::lib_com.xjs";


/************************************************************************************************
 * FORM 변수 선언 영역 (필수)
************************************************************************************************/
var fv_processCnt;

/************************************************************************************************
 * FORM EVENT 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : Form Load (필수)
 *---------------------------------------------------------------------------------------------*/
function form_onload(obj:Form, e:LoadEventInfo) {	
	gfn_formOnLoad(this);
	fn_init();
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 초기값 셋팅
 *---------------------------------------------------------------------------------------------*/
function fn_init() {
	var g_PersInfoMask_Before;
	SCCombo.bind(this, "ComCode", "tab_main.tpg_send.cbo_custType", "", {groupCode:"고객구분", useYn:"Y"}, SCCombo.ALL);
	
	ds_search.setColumn(0, 'maskAuth', "0");
	//발송번호 수정 : 마스킹 처리때문에 번호표시 불가하여 마스킹 정보 보정
	g_PersInfoMask_Before = g_PersInfoMask;
	g_PersInfoMask =  "YYYYNNNNNNNNNNN";
	ds_search.setColumn(0, "loginPersMask", g_PersInfoMask);
	ds_search.setColumn(0, "mainYn", "Y");

	
//	if ( gfn_getUserInfo("deptId") == "312430" ) { // 식재고객팀
//발송번호 수정 : 기본적으로 회사 번호 표시, 회사 번호가 없는 경우 휴대폰 번호로 표시 요청자:김진희 20171018 
		var rtn = SCAuth.getLoginUserInfo(this);
		var tel = rtn["telNo1"]+rtn["telNo2"]+rtn["telNo3"]
		if ( gfn_isNull(tel) ) {
			ds_smsForm.setColumn(0, "trCallback", gfn_getUserInfo("hpNo"));
		} else {
			ds_smsForm.setColumn(0, "trCallback", tel);
		}
//	} else {
//		ds_smsForm.setColumn(0, "trCallback", gfn_getUserInfo("hpNo"));
//	}
		
	var fv_sToday = gfn_today();

	tab_main.tpg_log.ObjCalendar_stDate.fn_initMonthCal(this, fv_sToday, "", ds_search, "logFrDate",  "Y");
	tab_main.tpg_log.ObjCalendar_edDate.fn_initMonthCal(this, fv_sToday, "", ds_search, "logToDate", "Y");	
	//alert(g_PersInfoMask);
	//발송번호 수정 : 마스킹 처리때문에 번호표시 불가하여 마스킹 정보 보정
	g_PersInfoMask = g_PersInfoMask_Before;
	//alert(g_PersInfoMask);	
	
	// 노무지원팀 or FC정보기획팀
	var bCond = (gfn_getUserInfo("deptId") == "307240") || ( application.g_Upjang == "148682" );
	tab_main.tpg_send.btn_excel.visible = bCond;
	
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 화면 닫기 전 변경 유무 체크 (필수-Frame에서 창 닫힐때 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_close() {	
	return true;
}


/************************************************************************************************
 * 공통기능 FUNCTION 영역 (필수)
************************************************************************************************/
/**
 * 메시지 데이터 변경 시 입력한 글자 수를 표시한다.
 * @param obj TextArea
 * @param e TextChangedEventInfo
 * @return none
 */
function Tab00_tabpage_txt_content_ontextchanged(obj:TextArea,  e:TextChangedEventInfo) {
	//입력한 글자수를 표시
	tab_main.tpg_send.edt_count.value = fn_getLengthB(e.posttext);
	
	var sType;
	if ( fn_getLengthB(e.posttext) <= 80 ) {
		sType = "S";
	} else {
		sType = "L";
	}
	
	fn_setByteLength("L");
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 조회 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_search() {
    switch ( tab_main.tabindex ) {
		case 0 :
			fn_searchUpjang();
			break;
		case 1 :
			fn_searchLog();
			break;
    }	
}

// 업장조회
function fn_searchUpjang() {
    var g_PersInfoMask_Before;
    
	gfn_clearSortMark(tab_main.tpg_send.grd_mstList);
    gfn_clearSortMark(tab_main.tpg_send.grd_sendList);
    
    tab_main.tpg_send.cbo_smsType.index = 0;
    ds_smsForm.clearData();
	ds_smsForm.addRow();

	
	//발송번호 수정 : 마스킹 처리때문에 번호표시 불가하여 마스킹 정보 보정
	g_PersInfoMask_Before = g_PersInfoMask;
	g_PersInfoMask =  "YYYYNNNNNNNNNNN";
	//if ( gfn_getUserInfo("deptId") == "312430" ) { // 식재고객팀
		var rtn = SCAuth.getLoginUserInfo(this);
		var tel = rtn["telNo1"]+rtn["telNo2"]+rtn["telNo3"]
		if ( gfn_isNull(tel) ) {
			ds_smsForm.setColumn(0, "trCallback", gfn_getUserInfo("hpNo"));
		} else {
			ds_smsForm.setColumn(0, "trCallback", tel);
		}
	//} else {
	//	ds_smsForm.setColumn(0, "trCallback", gfn_getUserInfo("hpNo"));
	//}
	
	tab_main.tpg_send.edt_count.value = 0;
	
	//본인담당업장
	ds_search.setColumn(0, "loginSabunYn", tab_main.tpg_send.chk_loginSabunYn.value);
	ds_search.setColumn(0, "sabun", g_EmpNo);
	
    var strSvcID    = "searchUpjang";
    var strURL      = "fm/fms/smsSendMgmt/selectUpjangList.xdo";
    var strInDs     = "ds_search=ds_search:A";
    var strOutDs    = "ds_upjangList=ds_upjangList";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
    
    g_PersInfoMask = g_PersInfoMask_Before;
}

// 발송로그 조회
function fn_searchLog() {
	gfn_clearSortMark(tab_main.tpg_log.grd_smsLog);
    
    var strSvcID    = "searchSmsLog";
    var strURL      = "fm/fms/smsSendMgmt/selectSmsLogList.xdo";
    var strInDs     = "ds_search=ds_search:A";
    var strOutDs    = "ds_smsLogList=ds_smsLogList";
    var strArg      = "";
    var strCallback = "fn_callBack";
    var bAsync      = true;
    
    gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
}

/*----------------------------------------------------------------------------------------------
 * 설명      : 출력 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_print() {

}

/*----------------------------------------------------------------------------------------------
 * 설명      : 도움말 버튼 클릭 시 (필수-공통버튼에서 호출됨)
 *---------------------------------------------------------------------------------------------*/
function fn_help() {
	
}

/************************************************************************************************
 * TRANSACTION 및 CallBack 영역 (필수)
************************************************************************************************/
/*----------------------------------------------------------------------------------------------
 * 설명      : 트랜잭션 콜백 함수 (필수)
 *---------------------------------------------------------------------------------------------*/
function fn_callBack(strSvcID, nErrorCode, strErrorMsg) {
	if ( nErrorCode < 0 ) 	{
		return;
	}
	
    switch( strSvcID ) {
		// 업장조회
        case "searchUpjang" :
			fn_setByteLength("L");
            break;
        
        // SMS 발송
        case "send" :
			gfn_alert(fv_processCnt + "건을 전송했습니다.");
			fn_search();
            break;  
              
        case "searchSmsLog" :
			break;
    }
}


/************************************************************************************************
 * 사용자 FUNCTION 영역 (필수)
************************************************************************************************/
function fn_checkValidation() {
	ds_sendList.enableevent = false;
	for ( var i=0; i<ds_sendList.rowcount; i++ ) {
		var pno = ds_sendList.getColumn(i, "custHpNo");
		var regTel = /^01([0|1|6|7|8|9]?)?([0-9]{3,4})?([0-9]{4})$/;
		
		if ( !regTel.test(pno) || pno.length < 10) {
			gfn_alert("휴대전화번호가 올바르지 않습니다.\r\n특수문자 없이 숫자만 입력하세요.");
			ds_sendList.rowposition = i;
			tab_main.tpg_send.grd_sendList.setCellPos(2);
			tab_main.tpg_send.grd_sendList.showEditor(true);
			tab_main.tpg_send.grd_sendList.setFocus();
			ds_sendList.enableevent = true;
			
			return false;
		}
		
	}
	
	if ( gfn_isNull(tab_main.tpg_send.msk_senderPh.value) ) {
		gfn_alert("발송번호를 입력하세요.");
		tab_main.tpg_send.msk_senderPh.setFocus();
		ds_sendList.enableevent = true;
		return false;
	}
	
	if ( gfn_isNull( tab_main.tpg_send.rdo_type.value ) ) {
		gfn_alert("발송형태를 선택하세요.");
		tab_main.tpg_send.rdo_type.setFocus();
		ds_sendList.enableevent = true;
		return false;
	}
	
	if ( gfn_isNull(tab_main.tpg_send.txt_content.value) ) {
		gfn_alert("발송메시지를 입력하세요.");
		tab_main.tpg_send.txt_content.setFocus();
		ds_sendList.enableevent = true;
		return false;
	}
	 
	if ( fn_getLengthB(tab_main.tpg_send.txt_content.value) <= 80 && tab_main.tpg_send.rdo_type.value == "L" ) {
		if ( gfn_confirm("발송내용이 80byte이하 입니다. \r\nSMS형태로 발송하시겠습니까?") ) {
			fn_setByteLength("S");
		} else {
			//return false;
		}
	}
	
	ds_sendList.enableevent = true;
	return true;
}

// 전화번호 데이터 조정
function fn_viewNo(no) {
	var val = no;
	//var pattern = /[^(가-힣ㄱ-ㅎㅏ-ㅣa-zA-Z0-9)]/gi;   // 특수문자 제거
	var pattern = /[^0-9]/gi;   // 숫자이외는 제거
 
	if ( pattern.test(val) ) {
		return val.replace(pattern,"");
	} else {
		return val;
	}
}

/************************************************************************************************
 * 각 COMPONENT 별 EVENT 영역 (필수)
************************************************************************************************/
// SMS 발송
function tab_main_tpg_send_btn_smsSend_onclick(obj:Button,  e:ClickEventInfo) {
	if( ds_sendList.rowcount > 0 ) {
		if ( !fn_checkValidation() ) {
			return;
		}
		var rtVal = gfn_confirm(ds_sendList.rowcount +"명에게 메시지를 발송 하시겠습니까?");
		if ( rtVal == true ) {	
			var strSvcID    = "send";
			var strURL      = "fm/fms/smsSendMgmt/saveList.xdo";
			// CH201701_00580
			var strInDs     = "ds_sendList=ds_sendList:A ds_smsForm=ds_smsForm:A";
			var strOutDs    = "";
			var strArg      = "";
			var strCallback = "fn_callBack";
			var bAsync      = true;
			
			gfn_transaction(this, strSvcID, strURL, strInDs, strOutDs, strArg, strCallback, bAsync);
		}
	} else {
		gfn_alert("메시지 발송 대상자가 없습니다.");
		return;
	}
}

// 발송리스트 추가
function ds_upjangList_oncolumnchanged(obj:Dataset, e:DSColChangeEventInfo) {
	if ( e.columnid == "chk" ) {
		obj.enableevent = false;
		ds_sendList.enableevent = false;
		var nPos = ds_sendList.findRow("rownum", obj.getColumn(e.row, "rownum"));
		if ( e.newvalue == "1" ) {  
			
			if ( nPos == -1 ) {
				var nNext = ds_sendList.addRow();
				ds_sendList.copyRow(nNext, obj, e.row);
				ds_sendList.setColumn(nNext, "custHpNo", fn_viewNo(obj.getColumn(e.row, "custHpNo")));
			} else {
				gfn_alert("동일한 발송자가 존재합니다.");
				ds_sendList.enableevent = true;
				obj.enableevent = true;
				return;
			}
		} else if ( e.newvalue == "0" ) {
			if ( nPos != -1 ) {
				ds_sendList.deleteRow(nPos);
			}
		}
		ds_sendList.enableevent = true;
		obj.enableevent = true;
	}
}

// 발송리스트 삭제
function tab_main_tpg_send_grd_sendList_onlbuttonup(obj:Grid, e:GridMouseEventInfo) {
	if ( e.row != -1 && e.cell != -1 ) {
		if ( obj.getCellProperty("body", e.cell, "displaytype") == "button" ) {
			var ds = this.objects[obj.binddataset];
			ds.enableevent = false;
			ds_upjangList.enableevent = false;
			ds_upjangList.setColumn(ds_upjangList.findRowExpr("rownum == '"+ds.getColumn(e.row, "rownum")+"'" ), "chk", 0);
			ds.deleteRow(e.row);
			ds_upjangList.enableevent = true;
			ds.enableevent = true;
			ds_sendList.applyChange();
		}
	}
}

// 선택삭제
function tab_main_tpg_send_btn_checkDel_onclick(obj:Button,  e:ClickEventInfo) {
	var ds = ds_sendList;
	
	ds_sendList.enableevent = false;
	ds_upjangList.enableevent = false;
	for ( var i=ds_sendList.rowcount; i>=0 ; i-- ) {
		if ( ds_sendList.getColumn(i, "chk") == "1" ) {
			ds_upjangList.setColumn(ds_upjangList.findRowExpr("rownum == '"+ds.getColumn(i, "rownum")+"'" ), "chk", 0);
			ds.deleteRow(i);
		}
	}
	ds_upjangList.enableevent = true;	
	ds_sendList.enableevent = true;
	// CH201701_00641
	ds_sendList.applyChange();
}

// 조회
function common_onkeydown(obj, e:KeyEventInfo) {
	switch ( e.keycode ) {
		case 13 :
			var next = this.getNextComponent(obj);
			if ( next.name == "cbo_custType" ) {
				this.getNextComponent(next).setFocus();
			}
			obj.updateToDataset();
			
			fn_search();
			break;
	}
}

// 발송일자 정합성 확인
function ds_search_oncolumnchanged(obj:Dataset, e:DSColChangeEventInfo) {
	switch ( e.columnid ) {
		case "logFrDate" :
		case "logToDate" :
			if ( !gfn_isNull(obj.getColumn(e.row, "logFrDate")) && !gfn_isNull(obj.getColumn(e.row, "logToDate")) ) {
				if ( obj.getColumn(e.row, "logFrDate") > obj.getColumn(e.row, "logToDate") ) {
					gfn_alert("선택한 발송일자 조회조건이 올바르지 않습니다.");
					obj.enableevent = false;
					obj.setColumn(e.row, e.columnid, "");
					obj.enableevent = true;
					
				}
			}
			break;
	}
}

// 발송양식선택
function tab_main_tpg_send_cbo_custType00_onitemchanged(obj:Combo, e:ItemChangeEventInfo) {

	tab_main.tpg_send.txt_content.value = e.postvalue;
	var contentsL = fn_getLengthB(e.postvalue);
	//trace(contentsL);
	fn_setByteLength(contentsL <= 80 ? "S" : "L");
}


// SMS/LMS 전환
function tab_main_tpg_send_rdo_type_canitemchange(obj:Radio, e:ItemChangeEventInfo) {
	switch ( e.postvalue ) {
		case "S" :
			if ( fn_getLengthB(tab_main.tpg_send.txt_content.value) > 80 ) {
				if ( gfn_confirm("발송내용이 80byte이상입니다.\r\n80byte이상 입력된 내용은 삭제됩니다. \r\n변경하시겠습니까?") ) {
					return true;
				} else {
					return false;
				}
			}
			break;
			
		case "L" : 
			break;
	}
	return true;
}

// SMS/LMS 전환
function tab_main_tpg_send_rdo_type_onitemchanged(obj:Radio, e:ItemChangeEventInfo) {
	
	if ( gfn_isNull(tab_main.tpg_send.cbo_smsType.value) ) {
		var temp = tab_main.tpg_send.txt_content.value;
		tab_main.tpg_send.txt_content.value = fn_GetStringByte(temp, 0, e.postvalue == "S" ? 80 : 2000);
		
		fn_setByteLength(e.postvalue);
	} else if ( !gfn_isNull(tab_main.tpg_send.cbo_smsType.value) && e.postvalue == "L" ) {
		tab_main.tpg_send.txt_content.maxlength = 2000;
		tab_main.tpg_send.stc_length.text = "2000(byte) 제한";
	} else {	// 기존선택되어 있는 발송양식이 있다면
		var msg = tab_main.tpg_send.cbo_smsType.value;
		tab_main.tpg_send.txt_content.value = msg;
	}
	
	tab_main.tpg_send.btn_smsSend.text = (e.postvalue == "S" ? "SMS" : "LMS") + " 발송";
}

// byte로 문자열 자르기
function fn_GetStringByte(sValue, StartByte, EndByte) {
	
	if ( gfn_isNull(sValue) ) return "";
	
	var buf = sValue.toString();
	var Len = 0;
	var strText = "";
 
	for ( var i=0; i<buf.length; i++ ) {
        if ( buf.charCodeAt(i) > 127 ) {
            Len += 2;
        } else {
            Len += 1;
        }         
        
        if ( Len >= StartByte && Len <= EndByte ) {
			strText += String.fromCharCode(buf.charCodeAt(i));       
		} 
	}

	return strText;
}

function ds_custList_oncolumnchanged(obj:Dataset, e:DSColChangeEventInfo) {
	if ( e.columnid == "custHpNo" ) {
		if ( !gfn_isNum(e.newvalue) ) {
			obj.enableevent = false;
			obj.setColumn(e.row, e.columnid, (e.newvalue).replace("-", ""));
			obj.enableevent = true;
		}
	}
}

// CH201701_00580
function fn_getLengthB(sValue) {
	
	if ( gfn_isNull(sValue) ) return 0;
	
	var v_ChkStr = sValue.toString();
	var v_cnt = 0;

	for ( var i=0; i<v_ChkStr.length; i++ ) {
		if (v_ChkStr.charCodeAt(i) > 127) {
			v_cnt += 2;
		} else {
			v_cnt += 1;
		}
	}
	return v_cnt;
}


function fn_setByteLength(sMode) {

	var nLength;
	switch ( sMode ) {
		case "S" :
			nLength = 80;
			break;
			
		case "L" :
			nLength = 2000;
			break;
			
		default :
			nLength = 80;
			sMode = "S";
			break;
	}
	
	tab_main.tpg_send.txt_content.maxlength = nLength;
	ds_smsForm.setColumn(0, "trType", sMode);
	tab_main.tpg_send.stc_length.text = nLength +"(byte) 제한";
	
	tab_main.tpg_send.edt_count.value = fn_getLengthB(tab_main.tpg_send.txt_content.value);
	
	tab_main.tpg_send.btn_smsSend.text = (sMode == "S" ? "SMS" : "LMS") + " 발송";
}


function tab_main_tpg_send_btn_excel_onclick(obj:Button,  e:ClickEventInfo) {
	fn_excel();
}

function fn_excel() {
	
	var strFileName = gfn_excelFileDialog("LOAD", "EXCEL");

	if ( strFileName.length == 0 ){
		this.setWaitCursor(false);
		return;
	}
	
	this.setWaitCursor(true, true);
	
	var rtn = gfn_importExcel(strFileName, "ds_upload", 1, false);
	
	try {
		if ( ds_upload.getRowCount() > 0 ) {
			
			ds_sendList.clearData();
			
			for ( var i=0; i<ds_upload.rowcount; i++ ) {
				var pHpNo = ds_upload.getColumn(i, "Col01");
				var pTime = ds_upload.getColumn(i, "Col02");
				
				if ( !gfn_isNull(pHpNo) && !gfn_isNull(pTime) ) {
					if ( pTime.length <> 4 ) {
						gfn_alert("발송시각 정보가 부정확합니다.["+pTime+"]");
						return;
					}
					var nPos = ds_sendList.addRow();
					ds_sendList.setColumn(nPos, "upjang", "169190");			// 노무지원팀
					ds_sendList.setColumn(nPos, "partName", "FC노무지원팀");	// 노무지원팀
					ds_sendList.setColumn(nPos, "custHpNo", pHpNo.replace("-",""));
					ds_sendList.setColumn(nPos, "reqDate", gfn_today() + pTime);
				}
			}
			
			tab_main.tpg_send.grd_sendList.formatid = "work";
		} else {
			gfn_alert("msg.err.grid.nodata");	// 데이타가 없습니다
		}
	} catch (e) {
	
	} finally {
		this.setWaitCursor(false, true);
	}
}
function tab_main_tpg_send_txt_content_oneditclick(obj:TextArea,  e:EditClickEventInfo)
{
	
}
]]></Script>
  </Form>
</FDL>
