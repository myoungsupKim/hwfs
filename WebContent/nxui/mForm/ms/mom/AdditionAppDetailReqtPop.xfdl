<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.5">
  <TypeDefinition url="..\..\..\default_typedef.xml"/>
  <Form id="AdditionAppDetailReqtPop" classname="frmCalendar" inheritanceid="" position="absolute" titletext="추가발주승인상세등록팝업" onload="form_onload" left="0" top="0" width="520" height="376" scrollbars="none" enable="true">
    <Layouts>
      <Layout>
        <Static id="staFormSize" position="absolute" left="0" top="0" width="520" height="377" cssclass="sta_POP_Bg"/>
        <Static id="Static00" taborder="7" left="0" top="0" height="70" cssclass="sta_POP_TitleBg" width="520" text="상세신청"/>
        <Button id="btnClose" taborder="6" onclick="btnClose_onclick" cssclass="btn_POP_XBtn" top="0" height="70" width="70" right="0"/>
        <Static id="Static02" taborder="9" text="h10" cssclass="sta_GUIDE_Area" visible="false" left="442" top="366" width="102" height="10" style="align:right middle;"/>
        <Static id="Static03" taborder="10" text="w10" cssclass="sta_GUIDE_Area" visible="false" left="0" top="588" width="10" height="100" style="align:left bottom;"/>
        <Static id="Static04" taborder="11" text="w10" cssclass="sta_GUIDE_Area" visible="false" left="510" top="336" width="10" height="100" style="align:left bottom;"/>
        <Static id="Static05" taborder="12" left="29.23%" top="80" right="26.92%" height="84" onclick="Static05_onclick"/>
        <Static id="Static06" taborder="13" cssclass="sta_WF_TopLine" left="0" top="70" right="0" height="2"/>
        <Static id="Static43" taborder="19" text="글자사이간격w20" cssclass="sta_GUIDE_Area2" visible="false" left="119" top="89" width="20" height="29"/>
        <Static id="Static09" taborder="20" cssclass="sta_WFSA_LabelBg" left="10" top="80" right="10" height="59" style="background:#ffffffff;"/>
        <Static id="Static01" taborder="22" cssclass="sta_WFSA_LabelBg" left="10" top="138" right="10" height="59" style="background:#ffffffff;"/>
        <Static id="Static07" taborder="24" cssclass="sta_WFSA_LabelBg" left="10" top="196" right="10" height="59" style="background:#ffffffff;"/>
        <Static id="Static08" taborder="27" cssclass="sta_WFSA_LabelBg" left="10" top="254" right="10" height="59" style="background:#ffffffff;"/>
        <Button id="btn_insert" taborder="32" text="입력" cssclass="btn_WF_Function" left="445" top="319" width="65" height="47" onclick="btn_insert_onclick"/>
        <Static id="Static11" taborder="34" text="신청시작일" cssclass="sta_WF_Label02" left="10" top="80" width="182" height="59"/>
        <Static id="Static13" taborder="36" text="신청종료일" cssclass="sta_WF_Label02" left="10" top="139" width="169" height="59"/>
        <Static id="Static12" taborder="37" text="사유" cssclass="sta_WF_Label02" left="10" top="196" width="169" height="59"/>
        <Calendar id="cal_startDate" taborder="44" autoselect="true" dateformat="yyyy-MM-dd" left="196" top="86" right="10" height="47" style="padding:0 10 0 0;" enable="true"/>
        <Combo id="cbo_gubunMaster" taborder="45" innerdataset="@ds_reson_m" codecolumn="cd" datacolumn="cdNm" left="196" top="202" right="10" height="47" ondropdown="cbo_gubunMaster_ondropdown" displaynulltext="선택"/>
        <Combo id="cbo_gubunSub" taborder="46" innerdataset="@ds_reson_s5" codecolumn="cd" datacolumn="cdNm" left="196" top="260" right="10" height="47" ondropdown="cbo_gubunSub_ondropdown" enable="false"/>
        <Calendar id="cal_endDate" taborder="48" autoselect="true" dateformat="yyyy-MM-dd" left="196" top="144" right="10" height="47" style="padding:0 10 0 0;"/>
        <Static id="Static15" taborder="49" text="상세사유" cssclass="sta_WF_Label02" left="10" top="254" width="198" height="59"/>
        <Static id="sta_startDate" taborder="50" left="196" top="86" width="314" height="47" onclick="sta_startDate_onclick" enable="true"/>
        <Static id="sta_endDate" taborder="51" left="196" top="144" width="314" height="47" onclick="sta_endDate_onclick"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_list" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="false" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="checked" type="STRING" size="256"/>
          <Column id="reqQty" type="STRING" size="256"/>
          <Column id="poId" type="STRING" size="256"/>
          <Column id="poNum" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_reson_m" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="cd" type="STRING" size="100"/>
          <Column id="cdNm" type="STRING" size="50"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_reson_s1" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="cd" type="STRING" size="100"/>
          <Column id="cdNm" type="STRING" size="50"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_reson_s2" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="cd" type="STRING" size="100"/>
          <Column id="cdNm" type="STRING" size="50"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_reson_s3" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="cd" type="STRING" size="100"/>
          <Column id="cdNm" type="STRING" size="50"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_reson_s4" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="cd" type="STRING" size="100"/>
          <Column id="cdNm" type="STRING" size="50"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_reson_s5" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="cd" type="STRING" size="100"/>
          <Column id="cdNm" type="STRING" size="50"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_check"/>
      <Dataset id="ds_check_input" oncolumnchanged="ds_input_oncolumnchanged">
        <ColumnInfo>
          <Column id="UPJANG" size="256" type="STRING"/>
          <Column id="UPJANG_NM" size="256" type="STRING"/>
          <Column id="FROM_DT" size="256" type="STRING"/>
          <Column id="TO_DT" size="256" type="STRING"/>
          <Column id="APRV_YN" size="256" type="STRING"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="APRV_YN"/>
            <Col id="FROM_DT"/>
            <Col id="TO_DT"/>
            <Col id="UPJANG"/>
            <Col id="UPJANG_NM"/>
          </Row>
        </Rows>
      </Dataset>
    </Objects>
    <Bind/>
    <Script type="xscript5.0"><![CDATA[//########################################################
// [프로젝트]		FC종합전산 모바일시스템 구축
// [시스템명]		클레임신청상세현황
// [부시스템명]	클레임신청상세현황
// [설명]		    클레임신청상세현황.
// [작성자명] 		강대성
// [작성일자]		2015.05.26
// -----------------[수정이력]--------------------------
// 수정일자 : 수정자 : 수정내용
// 2015.05.26 : 강대성 : 클레임신청상세현황 신규
//########################################################
include "lib::lib_Com.xjs"
/*================================================================================
 * 1. 변수 선언
 *===============================================================================*/
this.dsGubun = this.ds_reson_s5;
this.gubun = undefined; 
this.upjang = undefined; 
var strDataGroup = "U_svc";

/*================================================================================
 * 2. Form관련 Script
 *===============================================================================*/
/** 
 * Form의 모든 컴포넌트가 생성되고, 모든 Object가 Load 되었을 때에 발생하는 Event
 * @param
	obj : Event가 발생한 Object
	e : Event Object
 * @return : 없음
 */ 
this.form_onload = function(obj:Form, e:nexacro.LoadEventInfo)
{
	//필수
	this.fn_init();
	
}

// 데이터 초기화
this.fn_init = function ()
{
	this.fsp_init();
	
	this.arg = application.goMain.gfn_POP_getArg();
	
	application.goMain.gfn_POP_resize(this);
	
	//추가구매승인사유 대분류
	this.fn_common_code("FS0123", "", "", "");	
	this.ds_reson_m.copyData(application.gds_common_code);
	
	//추가구매승인사유 소분류1
	this.fn_common_code("FS0124", "", "1", "");	
	this.ds_reson_s1.copyData(application.gds_common_code);
	
	//추가구매승인사유 소분류2
	this.fn_common_code("FS0124", "", "2", "");	
	this.ds_reson_s2.copyData(application.gds_common_code);
	
	//추가구매승인사유 소분류3
	this.fn_common_code("FS0124", "", "3", "");	
	this.ds_reson_s3.copyData(application.gds_common_code);
	
	//추가구매승인사유 소분류4
	this.fn_common_code("FS0124", "", "4", "");	
	this.ds_reson_s4.copyData(application.gds_common_code);
	
	if(!this.gfn_isNull(this.arg[0]))
	{
		if(this.arg[2] == "1")
		{
			this.dsGubun = this.ds_reson_s1;
			this.ds_reson_s5.copyData(this.ds_reson_s1);
			this.cbo_gubunSub.set_enable(true);
		}
		else if(this.arg[2] == "2")
		{
			this.dsGubun = this.ds_reson_s2;
			this.ds_reson_s5.copyData(this.ds_reson_s2);
			this.cbo_gubunSub.set_enable(true);
		}
		else if(this.arg[2] == "3")
		{
			this.dsGubun = this.ds_reson_s3;
			this.ds_reson_s5.copyData(this.ds_reson_s3);
			this.cbo_gubunSub.set_enable(true);
		}
		else if(this.arg[2] == "4")
		{
			this.dsGubun = this.ds_reson_s4;
			this.ds_reson_s5.copyData(this.ds_reson_s4);
			this.cbo_gubunSub.set_enable(true);
		}
		
		this.cal_startDate.set_value(this.arg[0]);
		this.cal_endDate.set_value(this.arg[1]);
		this.cbo_gubunMaster.set_text(this.arg[3]);
		this.cbo_gubunSub.set_text(this.arg[4]);
				
	}	
	else
	{
		this.cbo_gubunSub.set_enable(false);
	}
	
	this.upjang = this.arg[5];
	
	//row값이 입력일경우 시작 및 종료일 입력 가능하게
	if(this.arg[6] == 2)
	{
		this.sta_startDate.set_enable(true);
		this.sta_endDate.set_enable(true);
		this.cal_startDate.set_enable(true);
		this.cal_endDate.set_enable(true);
	}
	//row값이 입력이 아닐경우 시작 및 종료일 입력 불가능하게
	else
	{
		this.sta_startDate.set_enable(false);
		this.sta_endDate.set_enable(false);
		this.cal_startDate.set_enable(false);
		this.cal_endDate.set_enable(false);
	}
	
}

// 달력 클릭 시(구매신청시작일)
this.sta_startDate_onclick = function(obj:Static,  e:nexacro.ClickEventInfo)
{
	var objCalArg = this.cal_startDate.value;
	
	application.goMain.gfn_POP_create("startDate", "cmmn::CmmnCalendarPop.xfdl", "fn_callbackPOP", this, objCalArg, "POP", application.goMain.divBase);
	return false;
}

// 달력 클릭 시(구매신청종료일)
this.sta_endDate_onclick = function(obj:Static,  e:nexacro.ClickEventInfo)
{
	var objCalArg = this.cal_endDate.value;
	
	application.goMain.gfn_POP_create("endDate", "cmmn::CmmnCalendarPop.xfdl", "fn_callbackPOP", this, objCalArg, "POP", application.goMain.divBase);
	return false;
}

//추가구매승인사유 대분류
this.cbo_gubunMaster_ondropdown = function(obj:Combo, e:nexacro.EventInfo)
{
	var arg = new Array();
	arg[0] = this.ds_reson_m;
	arg[1] = "사유";
	arg[2] = "";
	arg[3] = "cdNm";
	application.goMain.gfn_POP_create("gubunMaster", "cmmn::CmmnComboList.xfdl", "fn_callbackPOP", this, arg, "POP", application.goMain.divBase);
	return false;
}

//추가구매승인사유 소분류
this.cbo_gubunSub_ondropdown = function(obj:Combo, e:nexacro.EventInfo)
{
	if(this.gubun == "0")
	{
		this.ds_reson_s5.copyData(this.ds_reson_s1);
	}
	else if(this.gubun == "1")
	{
		this.ds_reson_s5.copyData(this.ds_reson_s2);
	}
	else if(this.gubun == "2")
	{
		this.ds_reson_s5.copyData(this.ds_reson_s4);
	}
	else if(this.gubun == "3")
	{
		this.ds_reson_s5.copyData(this.ds_reson_s3);
	}
	
	var arg = new Array();
	arg[0] = this.dsGubun;
	arg[1] = "상세사유";
	arg[2] = "";
	arg[3] = "cdNm";
	application.goMain.gfn_POP_create("gubunSub", "cmmn::CmmnComboList.xfdl", "fn_callbackPOP", this, arg, "POP", application.goMain.divBase);
	return false;
}

/*******************************************************************************
* 기      능   :  중복체크
* 설      명   :  중복체크
********************************************************************************/
this.fn_CheckSearch = function()
{
	var nRow = 0;
	var sSvcID;			// 서비스 ID
	var sUrl;			// jsp 경로
	var sInDs;			// 입력 데이터셋
	var sOutDs;			// 출력 데이터셋
	var sArg;			// 추가 파라미터
	var sCallFunc;		// 콜백함수명
    
    // 초기화
	this.ds_check.clearData();
	this.ds_check_input.clearData();
	
	nRow = this.ds_check_input.addRow();
	
	this.ds_check_input.setColumn(nRow,"UPJANG" , this.upjang); 
	this.ds_check_input.setColumn(nRow,"FROM_DT", this.cal_startDate.value);
	this.ds_check_input.setColumn(nRow,"TO_DT"  , this.cal_endDate.value);
	
	sSvcID		= "CHK_SEARCH";
	sUrl		= application.services[strDataGroup].url + "fs/fsa/FSA00090E_S002.jsp";
	sInDs		= "ds_check_input=ds_check_input";
    sOutDs		= "ds_check=ds_check";
    sArg		= "";
    sCallFunc	= "fn_callback";
    
    this.jsp_transaction(this,sSvcID, sUrl ,sInDs ,sOutDs,sArg,sCallFunc,false,false,false);
				
}

/*******************************************************************************
* 기      능   :  입력 항목 체크
* 설      명   :  입력 항목 체크
********************************************************************************/ 
this.fn_insertChk = function()
{
	// 기간 유효성 체크
	if (this.cal_startDate.value > this.cal_endDate.value){
		application.goMain.gfn_Msg("OK", "알림", "시작일이 종료일보다 클 수 없습니다.", "OK", "OK");
		return false;
	}	
	
	// 기간 유효성 체크
	if (this.gfn_AddDate(this.cal_startDate.value, 3) < this.cal_endDate.value){
		application.goMain.gfn_Msg("OK", "알림", "시작일과 종료일간의 차이는 3일을 넘을 수 없습니다.", "OK", "OK");
		return false;
	}
	
	return true;
}

/*******************************************************************************
* 기      능   :  입력버튼 클릭시
* 설      명   :  입력버튼 클릭시
********************************************************************************/ 
this.btn_insert_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{

	if (this.gfn_isNull(this.cal_startDate.value)){
		application.goMain.gfn_Msg("OK", "알림", "구매신청일(시작일)을 입력하세요.", "OK", "OK");
        return;		
	}
	
	if (this.gfn_isNull(this.cal_endDate.value)){
		application.goMain.gfn_Msg("OK", "알림", "구매신청일(종료일)을 입력하세요.", "OK", "OK");
        return;		
	}
	
	if (this.gfn_isNull(this.cbo_gubunMaster.value)){
		application.goMain.gfn_Msg("OK", "알림", "사유를 선택하세요.", "OK", "OK");
		return;		
	}
	
	if (this.gfn_isNull(this.cbo_gubunSub.value)){
		application.goMain.gfn_Msg("OK", "알림", "상세사유를 선택하세요.", "OK", "OK");
		return;		
	}	
	
	// 기간 유효성 체크
	if (this.cal_startDate.value > this.cal_endDate.value){
		application.goMain.gfn_Msg("OK", "알림", "시작일이 종료일보다 클 수 없습니다.", "OK", "OK");
		return;
	}	
	
	// 기간 유효성 체크
	if (this.gfn_AddDate(this.cal_startDate.value, 3) < this.cal_endDate.value){
		application.goMain.gfn_Msg("OK", "알림", "시작일과 종료일간의 차이는 3일을 넘을 수 없습니다.", "OK", "OK");
		return;
	}
	
	var arg = new Array();
	arg[0] = this.cal_startDate.value;    // 구매신청일(시작일)
	arg[1] = this.cal_endDate.value;      // 구매신청일(종료일)	
	arg[2] = this.cbo_gubunMaster.value;  // 사유	
	arg[3] = this.cbo_gubunSub.value;     // 상세사유	
	
	application.goMain.gfn_POP_close(this, arg);
	
}

this.btnClose_onclick = function (obj:Button, e:ClickEventInfo)
{
	application.goMain.gfn_POP_close(this, "CLOSEONLY");
}

/*================================================================================
 * 5. UserFunction관련 Script
 *===============================================================================*/
/*----------------------------------------------------------------------------------------------
 * 설명      : JSP트랜잭션 콜백 함수 (필수)
 *---------------------------------------------------------------------------------------------*/
this.fn_callback = function(nErrorCode, sErrorMag, sSvcID)
{
	// 에러일 경우
	if(nErrorCode!=0){
		application.goMain.gfn_Msg("EE", "알림", "서비스 오류:시스템 관리자에게 문의하십시오" + sErrorMag, "OK", "OK");
		return;
	}
	
	switch(sSvcID){		
		
		case "CHK_SEARCH" :
			if(this.ds_check.getRowCount() > 0){
				application.goMain.gfn_Msg("duplication", "알림", "중복된 신청내역이 있습니다.\n확인해주십시오.", "OK", true, this);
				return;
			}
			break;		
	}
}
/** 
 * 팝업 callBack
 * @param  : popname - 팝업을 구분짓는 id
 rtn : 팝업이 닫히면서 전달된 값
 * @return : 없음
 */
this.fn_callbackPOP = function (popname, rtn)
{
	switch (popname)
	{
		case "startDate":
			this.cal_startDate.set_value(rtn);
			
			if (!this.gfn_isNull(this.cal_endDate.value)){
				
				//필수항목 
				if (!this.fn_insertChk()) return;
				
				// 중복체크(server)
				this.fn_CheckSearch();
			}
			
			break;
		case "endDate":
			this.cal_endDate.set_value(rtn);
			
			//필수항목 
			if (!this.fn_insertChk()) return;
				
			// 중복체크(server)
			this.fn_CheckSearch();
			
			break;	
		case "gubunMaster":
			this.cbo_gubunMaster.set_index(rtn);			
			this.gubun = rtn;
			this.cbo_gubunSub.set_text("");
			if(rtn == 0)
			{					
				this.dsGubun = this.ds_reson_s1;
				this.cbo_gubunSub.set_enable(true);
			}
			else if(rtn == 1)
			{
				this.dsGubun = this.ds_reson_s2;
				this.cbo_gubunSub.set_enable(true);
			}
			else if(rtn == 2)
			{
				this.dsGubun = this.ds_reson_s4;
				this.cbo_gubunSub.set_enable(true);
			}
			else if(rtn == 3)
			{
				this.dsGubun = this.ds_reson_s3;
				this.cbo_gubunSub.set_enable(true);
			}
			
			this.ds_reson_s5.clearData();
			
			break;	
		case "gubunSub":
			trace(this.ds_reson_s5.saveXML("this.ds_reson_s5 >>>", "V"));
			this.cbo_gubunSub.set_index(rtn);			
			break;	
	}
}

/** 
 * 팝업 callBack
 * @param  : popname - 팝업을 구분짓는 id
 rtn : 팝업이 닫히면서 전달된 값
 * @return : 없음
 */
this.msg_callback = function (id, rtn)
{
	if (id == "ALERT_0") // 조회 시 오류
	{
		// 아무 일도 안함.
	}
	
	// 중복체크(중복건이 있을경우) 입력건 초기화시킴
	if (id == "duplication")
	{
		this.cal_endDate.set_value("");
	}	
}
]]></Script>
  </Form>
</FDL>
