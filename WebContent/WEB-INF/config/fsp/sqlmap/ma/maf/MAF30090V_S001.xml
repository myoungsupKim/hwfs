<?xml version="1.0" encoding="euc-kr"?>
<query dynamic="true">
	<type>select</type>
	<description><![CDATA[손익보고서(추정)]]></description>
	<reload>true</reload>
	<monitoring>true</monitoring>
	<result-count>1</result-count>
	<statement>
SELECT  TM_CD,
    TM_NAME,
    UPJANG,
    UPJANG_NAME, 
	NEW_GUBUN,
	DECODE(NEW_GUBUN,'O','기존','신규') NEW_GUBUN_NAME,
	SUM(NVL(PLAN_SALE_AMT,0)) AS PLAN_SALE_AMT,
	SUM(NVL(PLAN_SALE_PROFIT,0)) AS PLAN_SALE_PROFIT,
	SUM(NVL(SALE_AMT,0)) AS SALE_AMT,
	SUM(NVL(COST_AMT,0)) AS COST_AMT,
	ROUND(DECODE(SUM(NVL(SALE_AMT,0)),0,0,SUM(NVL(COST_AMT,0))/SUM(NVL(SALE_AMT,0))*100),1) AS COST_RATE,
	SUM(NVL(LABOR_AMT,0)) AS LABOR_AMT,
	ROUND(DECODE(SUM(NVL(SALE_AMT,0)),0,0,SUM(NVL(LABOR_AMT,0))/SUM(NVL(SALE_AMT,0))*100),1) AS LABOR_RATE,
	SUM(NVL(EXP_AMT,0)) AS EXP_AMT,
	ROUND(DECODE(SUM(NVL(SALE_AMT,0)),0,0,SUM(NVL(EXP_AMT,0))/SUM(NVL(SALE_AMT,0))*100),1) AS EXP_RATE,
	SUM(NVL(SALE_PROFIT,0)) AS SALE_PROFIT,
	ROUND(DECODE(SUM(NVL(SALE_AMT,0)),0,0,SUM(NVL(SALE_PROFIT,0))/SUM(NVL(SALE_AMT,0))*100),1) AS SALE_PROFIT_RATE,
	ROUND(DECODE(SUM(NVL(PLAN_SALE_AMT,0)),0,0,SUM(NVL(SALE_AMT,0))/SUM(NVL(PLAN_SALE_AMT,0))*100),1) AS SALE_DIFF_RATE,
	SUM(NVL(PROFIT_DIFF_AMT,0)) AS PROFIT_DIFF_AMT
 FROM MAF_PL_V2
 WHERE SCENARIO_CODE = #SCENARIO_CODE#
   AND YY||MM = #YYMM#
   <isNotNull col="TM_CD">
   AND TM_CD = #TM_CD#
   </isNotNull>
   <isNotNull col="UPJANG">
   AND UPJANG = #UPJANG#
   </isNotNull>
   <isNotNull col="SUB_JOB_CD">
   AND SUB_JOB_CD = #SUB_JOB_CD#
   </isNotNull>
   <isNotNull col="LOC_CD">
   AND LOC_CD = #LOC_CD#
   </isNotNull>
   <isNotNull col="NEW_GUBUN">
   AND NEW_GUBUN = #NEW_GUBUN#
   </isNotNull>
   <isEqual col="CLOSE_TYPE" value="C05C">
   AND NVL(CLOSE_TYPE,'0') IN ('C05C','0')
   </isEqual>
   <isEqual col="CLOSE_TYPE" value="C05D">
   AND NVL(CLOSE_TYPE,'0') IN ('C05D','0')
   </isEqual>
  GROUP BY TM_CD,
           TM_NAME,
           UPJANG,
           UPJANG_NAME, 
	       NEW_GUBUN 
  ORDER BY NEW_GUBUN, TM_NAME, UPJANG_NAME 	
  </statement>
	<input default-name="ds_in">
	   <col name="SCENARIO_CODE" size="20" type="VARCHAR" description="시나리오" /> 
	   <col name="YYMM" size="6" type="VARCHAR" description="" />
	   <col name="TM_CD" size="3" type="VARCHAR" description="팀" /> 
	   <col name="UPJANG" size="6" type="VARCHAR" description="업장" />
	   <col name="SUB_JOB_CD" size="10" type="VARCHAR" description="" />
	   <col name="LOC_CD" size="10" type="VARCHAR" description="" />
	   <col name="NEW_GUBUN" size="10" type="VARCHAR" description="" />
	   <col name="CLOSE_TYPE" size="10" type="VARCHAR" description="" /> 
	</input>
	<output default-name="ds_out">
	   <col name="TM_CD" size="60" type="VARCHAR" description="" />
	   <col name="TM_NAME" size="100" type="VARCHAR" description="" />
	   <col name="UPJANG" size="60" type="VARCHAR" description="" />
	   <col name="UPJANG_NAME" size="100" type="VARCHAR" description="" />
	   <col name="NEW_GUBUN" size="10" type="VARCHAR" description="" />
	   <col name="NEW_GUBUN_NAME" size="10" type="VARCHAR" description="" />
	   <col name="PLAN_SALE_AMT" size="22" type="NUMERIC" description="" /> 
	   <col name="PLAN_SALE_PROFIT" size="22" type="NUMERIC" description="" />
	   <col name="SALE_AMT" size="22" type="NUMERIC" description="" />
	   <col name="COST_AMT" size="22" type="NUMERIC" description="" />
	   <col name="COST_RATE" size="22" type="NUMERIC" description="" />
	   <col name="LABOR_AMT" size="22" type="NUMERIC" description="" />
	   <col name="LABOR_RATE" size="22" type="NUMERIC" description="" />
	   <col name="EXP_AMT" size="22" type="NUMERIC" description="" />
	   <col name="EXP_RATE" size="22" type="NUMERIC" description="" />
	   <col name="SALE_PROFIT" size="22" type="NUMERIC" description="" />
	   <col name="SALE_PROFIT_RATE" size="22" type="NUMERIC" description="" />
	   <col name="SALE_DIFF_RATE" size="22" type="NUMERIC" description="" />
	   <col name="PROFIT_DIFF_AMT" size="22" type="NUMERIC" description="" />
	</output>
</query>
