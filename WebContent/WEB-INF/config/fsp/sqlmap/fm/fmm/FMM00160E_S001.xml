<?xml version="1.0" encoding="euc-kr"?>
<query>
	<type>select</type>
	<description><![CDATA[]]></description>
	<reload>true</reload>
	<monitoring>true</monitoring>
	<result-count>1</result-count>
	<statement>
<![CDATA[
SELECT SUBSTR(MENU_DATE,7,2) ||'일('|| TO_CHAR(TO_DATE(MENU_DATE,'YYYYMMDD'),'DY','NLS_DATE_LANGUAGE=KOREAN') ||')' AS DAYS
-- 최근 4주간 실식수 현황
-- 1주전
     , WDESC -- 날씨
     , A.EXPECT_MEAL_QTY -- 예상식수
     , D.REAL_MEAL_QTY -- 실식수
     , FMM_RECIPENAME_FUN(A.UPJANG,A.MENU_CD,'1') AS SIKDAN -- 제공식단
     , MENU_FEATURE
     , (SELECT CODE_NAME FROM SCC_COMMON_CODE WHERE GROUP_CODE = 'FS0023' AND CODE = A.MEAL) MEAL_NAME --끼니명
     , (SELECT CODE_NAME FROM SCC_COMMON_CODE WHERE GROUP_CODE = 'FS0022' AND CODE = A.CORNER) CORNER_NAME --코너명
  FROM FMM_MENU A
     , UPOS_SC_WEATHER_INFO_V B
     , FMS_UPJANG C
     , FMO_OP_MENU D     
 WHERE A.UPJANG = #UPJANG#
   AND MENU_DATE = TO_CHAR(TO_DATE(#SEL_DATE#,'YYYYMMDD') - 7,'YYYYMMDD')
   AND A.SUBINV_CODE = #SUBINV_CODE#
   AND A.MEAL = #MEAL#
   AND A.CORNER = #CORNER#
   AND A.UPJANG = C.UPJANG
   AND C.LOCAL1 = B.AREA_CODE(+)
   AND B.CUR_DATE(+) = TO_CHAR(TO_DATE(#SEL_DATE#,'YYYYMMDD') - 7,'YYYYMMDD')
   AND D.UPJANG(+) = A.UPJANG
   AND D.OP_DATE(+) = TO_CHAR(TO_DATE(#SEL_DATE#,'YYYYMMDD') - 7,'YYYYMMDD')
   AND D.SUBINV_CODE(+) = A.SUBINV_CODE
   AND D.MEAL(+) = A.MEAL
   AND D.CORNER(+) = A.CORNER   
 UNION ALL
-- 2주전 
SELECT SUBSTR(MENU_DATE,7,2) ||'일('|| TO_CHAR(TO_DATE(MENU_DATE,'YYYYMMDD'),'DY','NLS_DATE_LANGUAGE=KOREAN') ||')' AS DAYS
     , WDESC -- 날씨
     , A.EXPECT_MEAL_QTY -- 예상식수
     , D.REAL_MEAL_QTY -- 실식수
     , FMM_RECIPENAME_FUN(A.UPJANG,A.MENU_CD,'1') AS SIKDAN -- 제공식단
     , MENU_FEATURE
     , (SELECT CODE_NAME FROM SCC_COMMON_CODE WHERE GROUP_CODE = 'FS0023' AND CODE = A.MEAL) MEAL_NAME --끼니명
     , (SELECT CODE_NAME FROM SCC_COMMON_CODE WHERE GROUP_CODE = 'FS0022' AND CODE = A.CORNER) CORNER_NAME --코너명
  FROM FMM_MENU A
     , UPOS_SC_WEATHER_INFO_V B
     , FMS_UPJANG C
     , FMO_OP_MENU D       
 WHERE A.UPJANG = #UPJANG#
   AND MENU_DATE = TO_CHAR(TO_DATE(#SEL_DATE#,'YYYYMMDD') - 14,'YYYYMMDD')
   AND A.SUBINV_CODE = #SUBINV_CODE#
   AND A.MEAL = #MEAL#
   AND A.CORNER = #CORNER#
   AND A.UPJANG = C.UPJANG
   AND C.LOCAL1 = B.AREA_CODE(+)
   AND B.CUR_DATE(+) = TO_CHAR(TO_DATE(#SEL_DATE#,'YYYYMMDD') - 14,'YYYYMMDD')
   AND D.UPJANG(+) = A.UPJANG
   AND D.OP_DATE(+) = TO_CHAR(TO_DATE(#SEL_DATE#,'YYYYMMDD') - 14,'YYYYMMDD')
   AND D.SUBINV_CODE(+) = A.SUBINV_CODE
   AND D.MEAL(+) = A.MEAL
   AND D.CORNER(+) = A.CORNER     
 UNION ALL
-- 3주전 
SELECT SUBSTR(MENU_DATE,7,2) ||'일('|| TO_CHAR(TO_DATE(MENU_DATE,'YYYYMMDD'),'DY','NLS_DATE_LANGUAGE=KOREAN') ||')' AS DAYS
     , WDESC -- 날씨
     , A.EXPECT_MEAL_QTY -- 예상식수
     , D.REAL_MEAL_QTY -- 실식수
     , FMM_RECIPENAME_FUN(A.UPJANG,A.MENU_CD,'1') AS SIKDAN -- 제공식단
     , MENU_FEATURE
     , (SELECT CODE_NAME FROM SCC_COMMON_CODE WHERE GROUP_CODE = 'FS0023' AND CODE = A.MEAL) MEAL_NAME --끼니명
     , (SELECT CODE_NAME FROM SCC_COMMON_CODE WHERE GROUP_CODE = 'FS0022' AND CODE = A.CORNER) CORNER_NAME --코너명
  FROM FMM_MENU A
     , UPOS_SC_WEATHER_INFO_V B
     , FMS_UPJANG C
     , FMO_OP_MENU D       
 WHERE A.UPJANG = #UPJANG#
   AND MENU_DATE = TO_CHAR(TO_DATE(#SEL_DATE#,'YYYYMMDD') - 21,'YYYYMMDD')
   AND A.SUBINV_CODE = #SUBINV_CODE#
   AND A.MEAL = #MEAL#
   AND A.CORNER = #CORNER#
   AND A.UPJANG = C.UPJANG
   AND C.LOCAL1 = B.AREA_CODE(+)
   AND B.CUR_DATE(+) = TO_CHAR(TO_DATE(#SEL_DATE#,'YYYYMMDD') - 21,'YYYYMMDD')
   AND D.UPJANG(+) = A.UPJANG
   AND D.OP_DATE(+) = TO_CHAR(TO_DATE(#SEL_DATE#,'YYYYMMDD') - 21,'YYYYMMDD')
   AND D.SUBINV_CODE(+) = A.SUBINV_CODE
   AND D.MEAL(+) = A.MEAL
   AND D.CORNER(+) = A.CORNER     
 UNION ALL
-- 4주전 
SELECT SUBSTR(MENU_DATE,7,2) ||'일('|| TO_CHAR(TO_DATE(MENU_DATE,'YYYYMMDD'),'DY','NLS_DATE_LANGUAGE=KOREAN') ||')' AS DAYS
     , WDESC -- 날씨
     , A.EXPECT_MEAL_QTY -- 예상식수
     , D.REAL_MEAL_QTY -- 실식수
     , FMM_RECIPENAME_FUN(A.UPJANG,A.MENU_CD,'1') AS SIKDAN -- 제공식단
     , MENU_FEATURE
     , (SELECT CODE_NAME FROM SCC_COMMON_CODE WHERE GROUP_CODE = 'FS0023' AND CODE = A.MEAL) MEAL_NAME --끼니명
     , (SELECT CODE_NAME FROM SCC_COMMON_CODE WHERE GROUP_CODE = 'FS0022' AND CODE = A.CORNER) CORNER_NAME --코너명
  FROM FMM_MENU A
     , UPOS_SC_WEATHER_INFO_V B
     , FMS_UPJANG C
     , FMO_OP_MENU D       
 WHERE A.UPJANG = #UPJANG#
   AND MENU_DATE = TO_CHAR(TO_DATE(#SEL_DATE#,'YYYYMMDD') - 28,'YYYYMMDD')
   AND A.SUBINV_CODE = #SUBINV_CODE#
   AND A.MEAL = #MEAL#
   AND A.CORNER = #CORNER#
   AND A.UPJANG = C.UPJANG
   AND C.LOCAL1 = B.AREA_CODE(+)
   AND B.CUR_DATE(+) = TO_CHAR(TO_DATE(#SEL_DATE#,'YYYYMMDD') - 28,'YYYYMMDD')
   AND D.UPJANG(+) = A.UPJANG
   AND D.OP_DATE(+) = TO_CHAR(TO_DATE(#SEL_DATE#,'YYYYMMDD') - 28,'YYYYMMDD')
   AND D.SUBINV_CODE(+) = A.SUBINV_CODE
   AND D.MEAL(+) = A.MEAL
   AND D.CORNER(+) = A.CORNER     
   	]]></statement>
	<input default-name="ds_input">
	</input>
	<output default-name="ds_view">
	</output>
</query>