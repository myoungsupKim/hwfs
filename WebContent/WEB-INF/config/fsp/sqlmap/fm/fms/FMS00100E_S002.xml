<?xml version="1.0" encoding="euc-kr"?>
<query dynamic="true">
	<type>select</type>
	<description><![CDATA[사업장코드에 따라 사업장 조회]]></description>
	<reload>true</reload>
	<monitoring>true</monitoring>
	<result-count>1</result-count>
	<statement>
SELECT  
		 UJ.UPJANG
		,DECODE(UJ.MAIN_UPJANG, 0, NULL, UJ.MAIN_UPJANG) AS MAIN_UPJANG
		,UJ.UPJANGNM_DISP
		,UJ.ZIP_CD
		--,UJ.ADDR_KEY
		--,SCC_ADDR_FUN(UJ.ADDR_KEY, #g_PersInfoMask#, #p_MaskAuth#) AS ADDR_INFO
		--,UJ.ADDR -- 현주소 1
		,NVL(UJ.ADDR_KEY,(SELECT ADDR_KEY FROM ST_UPJANG WHERE UPJANG = UJ.UPJANG)) ADDR_KEY
		,DECODE(UJ.ADDR_KEY,NULL,(SELECT SCC_ADDR_FUN(ADDR_KEY, 'YYYYNNNNNNNNNNN', '0') FROM ST_UPJANG WHERE UPJANG = UJ.UPJANG) ,SCC_ADDR_FUN(UJ.ADDR_KEY, 'YYYYNNNNNNNNNNN', '0')) AS ADDR_INFO
		,NVL(UJ.ADDR,(SELECT ADDR FROM ST_UPJANG WHERE UPJANG = UJ.UPJANG)) ADDR -- 현주소 1		
		,SCC_CRYPTO.MASKAUTH_FUN (UJ.PART_NAME,12,#g_PersInfoMask#, #p_MaskAuth#) AS PART_NAME
		,SCC_CRYPTO.MASKAUTH_FUN (UJ.PART_TEL_NO_ENC,9,#g_PersInfoMask#, #p_MaskAuth#) AS PART_TEL_NO
        ,SCC_CRYPTO.MASKAUTH_FUN (UJ.PART_HP_NO_ENC,9,#g_PersInfoMask#, #p_MaskAuth#) AS PART_HP_NO
        ,SCC_CRYPTO.MASKAUTH_FUN (UJ.PART_FAX_NO_ENC,9,#g_PersInfoMask#, #p_MaskAuth#) AS PART_FAX_NO
        ,SCC_CRYPTO.MASKAUTH_FUN (UJ.PART_EMAIL_ENC,7,#g_PersInfoMask#, #p_MaskAuth#) AS PART_EMAIL
		,UJ.FST_REG_DATE
		,UJ.LST_DEAL_DATE
		,UJ.CONTRACT_TERM
		,UJ.CONTRACT_EDATE
		,UJ.CENTER_FLAG
		,UJ.CUST_TYPE
		,UJ.BIZ_GROUP
		,UJ.SALE_RATE
		,UJ.OP_RATE_YN
		,UJ.OTCUST_OP_RATE_YN
		,UJ.CONSUM_OP_RATE_YN
		,UJ.SM_RATE_YN
		,UJ.OTCUST_SM_RATE_YN
		,UJ.CONSUM_SM_RATE_YN
		,UJ.OTCUST_PRICE_UPJANG
		,UJ.QTY_CONTROL_YN
		,UJ.D_DAYS
		,UJ.D_TIMES
		,UJ.D_OVER_DAYS
		--,UJ.SIGN1
		--,UJ.SIGN2
		--,UJ.SIGN3
		--,UJ.SIGN4
		,SCC_CRYPTO.MASKAUTH_FUN (UJ.SIGN1,12,#g_PersInfoMask#, #p_MaskAuth#) AS SIGN1
		,SCC_CRYPTO.MASKAUTH_FUN (UJ.SIGN2,12,#g_PersInfoMask#, #p_MaskAuth#) AS SIGN2
		,SCC_CRYPTO.MASKAUTH_FUN (UJ.SIGN3,12,#g_PersInfoMask#, #p_MaskAuth#) AS SIGN3
		,SCC_CRYPTO.MASKAUTH_FUN (UJ.SIGN4,12,#g_PersInfoMask#, #p_MaskAuth#) AS SIGN4
		,UJ.PWD_CHG_YN
		,UJ.PWD_CHG_CYCLE
		,UJ.DEPT_ID
		,UJ.CONT_SALES_SABUN
		,UJ.PART_SALES_SABUN
		,SCC_CRYPTO.MASKAUTH_FUN (UJ.PART_SALES_TEL_NO_ENC,9,#g_PersInfoMask#, #p_MaskAuth#) AS PART_SALES_TEL_NO
		,UJ.CS_SABUN
		,SCC_CRYPTO.MASKAUTH_FUN (UJ.CS_TEL_NO_ENC,9,#g_PersInfoMask#, #p_MaskAuth#) AS CS_TEL_NO
		,UJ.EMPLOYEE_CNT
		,UJ.SPECIAL_FACT
		,UJ.CREDIT_GRADE
		,UJ.CAPITAL
		,UJ.FINANCIAL_STATUS
		,UJ.RCV_TYPE
		,UJ.RCV_EXP_DATE
		,UJ.BANK_CD
		--,UJ.ACNTCD
		--,SC_CRYPTO_FUN('DEC', UJ.ACNTCD_ENC,3) AS ACNTCD
		,SCC_CRYPTO.MASKAUTH_FUN (UJ.ACNTCD_ENC,6,#g_PersInfoMask#, #p_MaskAuth#) AS ACNTCD
		,UJ.BANK_DRNM
		,UJ.HEAD_CREDIT_YN
		,UJ.CREDIT_TURN_DAYS
		,UJ.CREDIT_TURN_CONTROL_YN
		,UJ.CREDIT_AMOUNT
		,UJ.CREDIT_OVER_END
		,UJ.CREDIT_OVER_AMOUNT
		,UJ.CREDIT_AMOUNT_CONTROL_YN
		,UJ.CREDIT_START
		,UJ.CREDIT_END
		,UJ.CREDIT_CONTROL_YN
		,UJ.GUAR_INSUR_INFO
		,UJ.MORTGAGE_INFO
		,UJ.CLASS_CNT
		,UJ.FREE_CNT
		,UJ.CLASS1_CNT
		,UJ.CLASS2_CNT
		,UJ.CLASS3_CNT
		,UJ.CLASS4_CNT
		,UJ.CLASS5_CNT
		,UJ.CLASS6_CNT
		,UJ.REMARK
		,UJ.USE_YN
		,UJ.ATTR01
		,UJ.ATTR02
		,UJ.ATTR03
		,UJ.ATTR04
		,UJ.ATTR05
		,UJ.ATTR06
		,UJ.ATTR07
		,UJ.ATTR08
		,UJ.ATTR09
		,UJ.ATTR10
		,UJ.CUSER
		,UJ.CDATE
		,UJ.UUSER
		,UJ.UDATE
		,UJ.UPJANGNM_DISP2
		,UJ.MAIN_UPJANG_IMG
		,UJ.STAMP_IMG
		,UJ.SAUPNO
		,SCC_CRYPTO.MASKAUTH_FUN (UJ.DRNAME,12,#g_PersInfoMask#, #p_MaskAuth#) AS DRNAME
		,SCC_CRYPTO.MASKAUTH_FUN(UJ.ADDR2_ENC,10,#g_PersInfoMask#, #p_MaskAuth#) AS ADDR2 -- 매출처 상세주소
		,UJ.ADDR2_KEY
		,SCC_ADDR_FUN(UJ.ADDR2_KEY, #g_PersInfoMask#, #p_MaskAuth#) AS ADDR2_INFO
		,UJ.DELIVERY_DETAIL
		,UJ.EXCEL_EXPORT_YN
		,UJ.CTPRT_FLAG
		,UJ.CTPRT_PRICEGB
		,UJ.CTPRT_TYPE
		,UJ.PART_CODE
		,UJ.BIZ_KIND
		,UJ.BIZ_DETAIL
		,UJ.DRNAME2
		,UJ.SPECIAL_NOTE
		,UJ.HOLIDAY_CHK_YN
		,UJ.CTPRT_CRDGB
		,UJ.CTPRT_ALLGB
		,UJ.ACNTCD_ENC
		,SCC_CRYPTO.MASKAUTH_FUN(UJ.ADDR_DETAIL_ENC,10,#g_PersInfoMask#, #p_MaskAuth#) AS ADDR_DETAIL -- 현주소 상세 2
		,UJ.ADDR2_ENC
		,UJ.PART_EMAIL_ENC
		,UJ.PART_FAX_NO_ENC
		,UJ.PART_TEL_NO_ENC
		,UJ.PART_HP_NO_ENC
		,UJ.JIBUN_ZIP_CD_BAK
		,UJ.JIBUN_ADDR_BAK
        , TO_CHAR(UJ.UDATE,'YYYY-MM-DD') AS CREDIT_UDATE
        --, HSU2.UPJANGNM AS MAIN_UPJANG_NM
        ,(SELECT Z.UPJANGNM_DISP FROM FMS_UPJANG Z WHERE Z.UPJANG = UJ.MAIN_UPJANG) AS MAIN_UPJANG_NM
        , UJ.CLASS1_CNT + UJ.CLASS2_CNT + UJ.CLASS3_CNT AS TOT_CNT
        , CASE WHEN UJ.MAIN_UPJANG=UJ.UPJANG THEN '본사'
               ELSE '사업장' END AS UPJANG_TYPE
        , CUST_V.ADDR_KEY AS CUST_ADDR_KEY
        , SCC_ADDR_FUN(CUST_V.ADDR_KEY, #g_PersInfoMask#, #p_MaskAuth#) AS CUST_ADDR_INFO
        , CUST_V.POST_NO AS MAIL_NUM
        , CUST_V.ADDR AS CUST_ADDR -- 소재지 주소 1
        , SCC_CRYPTO.MASKAUTH_FUN(CUST_V.DETAIL_ADDR_ENC, 10,#g_PersInfoMask#, #p_MaskAuth#) CUST_ADDR_DETAIL -- 소재지 주소 2
        , UJ.ADDR_GUBUN
        , CUST_V.CUSTNM AS CUST_NAME
        , CUST_V.SAUPNO AS BIZ_NUM
        , CUST_V.UP_TAE AS BIZ_TYPE
        , CUST_V.UP_JONG AS BIZ_CAT
        , RTRIM(CASE WHEN UJ.OTCUST_PRICE_UPJANG=UJ.UPJANG THEN '대표업장'
               ELSE '대상업장' END) AS OTCUST_UPJANG_TYPE
        , CASE WHEN UJ.CREDIT_TURN_CONTROL_YN = 'Y' AND UJ.CREDIT_AMOUNT_CONTROL_YN = 'Y' THEN '여신일+여신액'
               WHEN UJ.CREDIT_AMOUNT_CONTROL_YN = 'Y' THEN '여신액'
               WHEN UJ.CREDIT_TURN_CONTROL_YN = 'Y' THEN '여신일'
               ELSE '관리안함' END AS CREDIT_TYPE
       -- , '' CREDIT_EXT_AMOUNT		 /*여신 연장금액 07-24 제거*/
       -- , '' CREDIT_EXT_DAYS		 /*여신 연장일 07-24 제거*/
        , (SELECT UPJANGNM FROM HLDC_ST_UPJANG WHERE UPJANG=UJ.OTCUST_PRICE_UPJANG) AS OTCUST_PRICE_UPJANG_NM
        , (SELECT CC_NM FROM HLDC_SC_DEPT_V WHERE DEPT_ID=UJ.DEPT_ID) AS DEPT_ID_NM
        , (SELECT NM_KOR FROM HLDC_HR_PERSONAL WHERE SABUN=UJ.CONT_SALES_SABUN) AS CONT_SALES_SABUN_NM
        , (SELECT SCC_CRYPTO.MASKAUTH_FUN (NM_KOR, 12, #g_PersInfoMask#, #p_MaskAuth#) FROM HLDC_HR_PERSONAL WHERE SABUN=UJ.PART_SALES_SABUN) AS PART_SALES_SABUN_NM
        , (SELECT SCC_CRYPTO.MASKAUTH_FUN (NM_KOR, 12, #g_PersInfoMask#, #p_MaskAuth#) FROM HLDC_HR_PERSONAL WHERE SABUN=UJ.CS_SABUN) AS CS_SABUN_NM
        , CASE WHEN UJ.MAIN_UPJANG=UJ.UPJANG THEN '0'
               ELSE '1' END AS M_LEVEL
        , #FILEURL# || '/' || NVL(MAIN_UPJANG_IMG,'hwrc-logo.jpg') AS IMG_URL
        --, '' AS IMG_URL
        , (SELECT BANKNM FROM HLDC_ST_BANK WHERE BANKCD=UJ.BANK_CD) AS BANKNM
        , PAY_GUBUN_CD
        , PAY_DATE
        , UJ.DOCU_FILE1
        , UJ.DOCU_FILE2
        , UJ.DOCU_FILE3
        , UJ.DOCU_FILE4
        , UJ.DOCU_FILE5
        , UJ.SDOCU_FILE1
        , UJ.SDOCU_FILE2
        , UJ.SDOCU_FILE3
        , UJ.SDOCU_FILE4
        , UJ.SDOCU_FILE5
        , UJ.SDOCU_FILE_SIZE1
        , UJ.SDOCU_FILE_SIZE2
        , UJ.SDOCU_FILE_SIZE3
        , UJ.SDOCU_FILE_SIZE4
        , UJ.SDOCU_FILE_SIZE5
        , UJ.SAFE_KEY   
        , UJ.ACNT_PROC
        , UJ.LOCAL1
        , UJ.LOCAL2    
        , UJ.GANAP_SALE_PART_NAME  
        , SCC_CRYPTO.MASKAUTH_FUN(UJ.GANAP_SALE_PART_TEL_NO_ENC, 9,#g_PersInfoMask#, #p_MaskAuth#) GANAP_SALE_PART_TEL_NO
        , UJ.GANAP_CS_PART_NAME  
        , SCC_CRYPTO.MASKAUTH_FUN(UJ.GANAP_CS_PART_TEL_NO_ENC, 9,#g_PersInfoMask#, #p_MaskAuth#) GANAP_CS_PART_TEL_NO
        ,(SELECT SCC.CODE_NAME FROM SCC_COMMON_CODE SCC WHERE SCC.GROUP_CODE ='MA0040' AND SCC.CODE = UJ.LOCAL1) AS LOCAL1_NM
        ,(SELECT SCC.CODE_NAME FROM SCC_COMMON_CODE SCC WHERE SCC.GROUP_CODE ='MA0041' AND SCC.CODE = UJ.LOCAL2) AS LOCAL2_NM         
        , GANAP_YN
        , UJ.ARRIVAL_TIME_FROM
        , UJ.ARRIVAL_TIME_TO
        , UJ.GANAP_BANK_CD
        , SCC_CRYPTO.DEC_FUN(UJ.GANAP_BANK_ACCT_NO) AS GANAP_BANK_ACCT_NO
        , UJ.GANAP_BANK_ACCT_NAME
        , UJ.GANAP_CREDIT_YN
        , UJ.GANAP_BANK_YN
        , (SELECT MIN(A.SHIP_ID) FROM HLDC_PO_SUBINVENTORY A WHERE A.UPJANG = UJ.UPJANG) AS SHIP_ID
        , (SELECT COUNT(DISTINCT(A.SHIP_ID)) FROM HLDC_PO_SUBINVENTORY A WHERE A.UPJANG = UJ.UPJANG AND A.USE_YN = 'Y') AS TRANS_CNT
        , '' AS ADDR_TEMP1
        , '' AS ADDR_TEMP2
        , NVL(UJ.BUDGET_FLAG, 'N') AS BUDGET_YN
        <isNotNull col="UJ_UPJANG">
        , (SELECT X.SET1 FROM SCC_COMMON_CODE X WHERE X.GROUP_CODE = 'FM003' AND X.CODE = #UJ_UPJANG# ) AS BIZ_GNB
        </isNotNull>    
        , CUST_V.DRNAME1
        , UJ.FIRST_NEED_DATE
	       , UJ.MASTERCLASS0
	       , UJ.MASTERCLASS1
	       , UJ.MASTERCLASS2
	       , UJ.MASTERCLASS3
	       , UJ.MASTERCLASS4
	    , DECODE(NVL(UJ.POP_REQ_CNT, 0), 0, 'N', 'Y') AS POP_REQ_YN
        , NVL(UJ.POP_REQ_CNT, 0) AS POP_CNT
        , UJ.INTERFACE_ATTR01
        , DECODE(INSTR(NVL(UJ.AR_DESC_CD,'-'), 'AA'), 0, 'N', 'Y') AS AR_DESC_AA_YN /* 사고채권여부 */
        , (SELECT DECODE(COUNT(*), 0, 'N', 'Y') FROM SO_PR WHERE RC_UPJANG = #UJ_UPJANG#)  AS ORDER_EXIST_YN /* 주문이력존재여부 */
        , SCC_CRYPTO.DEC_FUN(UJ.EMAIL_ENC) AS EMAIL
        , SCC_CRYPTO.DEC_FUN(UJ.FAX_NO_ENC) AS FAX_NO
        , RTN_YN
FROM    FMS_UPJANG UJ, HLDC_ST_UPJANG HSU, HLDC_ST_UPJANG HSU2
        , HLDC_ST_CUST CUST_V
        , ( SELECT UPJANG
                 , MAX(PAY_GUBUN_CD) AS PAY_GUBUN_CD
                 , MAX(PAY_DATE) AS PAY_DATE
              FROM SCO_UPJANG_CUST
             GROUP BY UPJANG  
          ) SUC           
WHERE   UJ.UPJANG = HSU.UPJANG
AND     UJ.UPJANG = HSU2.UPJANG
AND     HSU.CUSTCD = CUST_V.CUSTCD(+)
AND     UJ.UPJANG = SUC.UPJANG(+)
<isNotNull col="UJ_UPJANG">
AND     UJ.UPJANG = #UJ_UPJANG#
</isNotNull>
<isNotNull col="UPJANG_NM">
AND     HSU.UPJANGNM LIKE '%' || #UPJANG_NM# || '%'
</isNotNull>
<isNotNull col="MAIN_UPJANG">
	 AND UJ.MAIN_UPJANG = #MAIN_UPJANG#
</isNotNull>
ORDER BY UJ.MAIN_UPJANG, DECODE(UJ.MAIN_UPJANG,UJ.UPJANG,'0','1'), UJ.UPJANG	</statement>
	<input default-name="ds_input">
		<col name="UJ_UPJANG" size="255" type="NUMERIC" description="사업장코드" /> 
		<col name="UPJANG_NM" size="100" type="VARCHAR" description="사업장명" /> 
	</input>
	<output default-name="ds_main">
	</output>
</query>
